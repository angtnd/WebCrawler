KISSY.add("discover/c/base/module",["node","event"],function(o,t){var n=(t("node"),t("event")),e=o.all,a=function(){this.bindEvents()};return a.tap=n.Gesture.tap,a.prototype.bindEvents=function(){var t=this;t.el&&t.events&&o.each(t.events,function(o,n){if(n&&o&&~n.indexOf(" ")){var a=n.replace(" ","^").split("^"),r=a[0],i=a[1],o=t[o]||o;e(t.el).delegate(r,i,o,t)}})},a.prototype.getAjaxUrl=function(o){var t=new RegExp("daily.taobao.net").test(location.href.split("?")[0]),n=t&&"//www.daily.taobao.net/"||"//www.taobao.com/";return n+"2014/ajax/"+o+".php"},a.prototype.getTMSHook=function(t){var n=t.split("_");return o.each(n,function(o,t){n[t]=o.substring(0,1).toUpperCase()+o.substring(1)}),"#J_"+n.join("")},a.prototype.isInit=function(o){var t=FP.modules;return t[o]&&t[o].init===!0?!0:(t[o]={},t[o].init=!0,!1)},a.prototype.trackPoint=function(t){var n=FP.load,e=FP.trackQueue,a=function(o){var t=new Image,n="_img_"+Math.random();window[n]=t,t.onload=t.onerror=function(){window[n]=null},t.src=o};t&&e.push(t),n&&(o.each(e,function(o){a(o)}),e.length=0)},a.prototype.loadTanxAd=function(o){tanx_ssp_lazy=window.tanx_ssp_lazy||[],tanx_ssp_lazy.push(o)},a.prototype.loadTanx=function(t,n){var e=window,a={i:t,sd:"ecpm.tanx.com"};return n&&(a.sd="toruk.tanx.com"),e.tanxssp_show?void e.tanxssp_show(a):(e.tanx_ssp_onload=e.tanx_ssp_onload||[],e.tanx_ssp_onload.push(a),void o.getScript("//cdn.tanx.com/t/tanxssp.js",function(){},"gbk"))},a.prototype.goldlog=function(t,n,e){return window.goldlog?void(goldlog.record&&(n&&(n=o.param(n)),goldlog.record("/tbindex.2014."+t,"",n||"",e||""))):!1},a.prototype.trace=function(o,t){return window.goldlog?(t||(t="H46896569"),void(goldlog.trace&&goldlog.trace("/tbindex.2014."+o,"","",t))):!1},a});KISSY.add("discover/c/discover/tpl/goods.xtpl",function(n,a,t,r){return function(n,a,t){var e,i="",o=this.config,s=this,l=o.utils;"undefined"!=typeof r&&r.kissy&&(e=r);var c=l.runBlockCommand,d=l.renderOutput,u=l.getProperty,v=l.runInlineCommand,p=l.getPropertyOrRunCommand;i+="";var m={},f=[],h=u(s,n,"auctions",0,1);f.push(h),m.params=f,m.fn=function(n){var a="";a+='\n<div class="discover-item J_DiscoverItem J_DItem">\n  ';var t={},r=[],e=u(s,n,"promotional",0,3);r.push(e),t.params=r,t.fn=function(n){var a="";return a+='\n  <div class="two11"></div>\n  '},a+=c(s,n,t,"if",3),a+='\n    <a href="';var i=p(s,n,{},"url",0,6);a+=d(i,!0),a+='" title="';var o=p(s,n,{},"title",0,6);a+=d(o,!0),a+='">\n        <img src="';var l=p(s,n,{},"pictUrl",0,7);a+=d(l,!0),a+='" />\n        <div class="item-desc">\n            <h4>';var m=p(s,n,{},"title",0,9);a+=d(m,!0),a+="</h4>\n          ";var f={},h=[],g=u(s,n,"monthSellCount",0,10);h.push(g),f.params=h,f.fn=function(n){var a="";a+="\n            ";var t={},r=[],e=u(s,n,"hongbao",0,11);r.push(e),t.params=r,t.fn=function(n){var a="";a+='\n            <div class="item-comment">\u53c2\u52a01212\u5927\u4fc3,';var t={},r=[],e=u(s,n,"hongbao",0,12);return r.push(e>5),t.params=r,t.fn=function(n){var a="";a+='\u8d2d\u7269\u5238\u53ef\u62b5<em class="bold">';var t=p(s,n,{},"hongbao",0,12);return a+=d(t,!0),a+="\u5143</em>"},t.inverse=function(n){var a="";return a+="<em>\u53ef\u4f7f\u75281212\u8d2d\u7269\u5238</em>"},a+=c(s,n,t,"if",12),a+="</div>\n            "},t.inverse=function(n){var a="";a+='\n            <div class="item-comment">';var t=p(s,n,{},"reason",0,14);return a+=d(t,!0),a+="</div>\n            "},a+=c(s,n,t,"if",11),a+='\n          <div class="item-sell-count">\u5df2\u552e';var i=p(s,n,{},"monthSellCount",0,16);return a+=d(i,!0),a+="\u4ef6</div>\n          "},f.inverse=function(n){var a="";a+='\n            <div class="item-comment">';var t=p(s,n,{},"reason",0,18);a+=d(t,!0),a+='</div>\n            <p class="item-count">';var r={},e=[];e.push("COLLECT"),r.params=e;var i=v(s,n,r,"lang",19);a+=d(i,!0),a+=" <em>";var o=p(s,n,{},"ordercost",0,19);return a+=d(o,!0),a+="</em></p>\n          "},a+=c(s,n,f,"if",10),a+='\n        </div>\n    </a>\n    <div class="preference-trigger-wrapper">\n        <ul>\n            <li>\n                <a data-spm-click="gostr=/tbindex;locaid=d13"  data-id="';var _=p(s,n,{},"id",0,26);a+=d(_,!0),a+='" data-category="';var y=p(s,n,{},"category_id",0,26);a+=d(y,!0),a+='" href="//favorite.taobao.com/popup/add_collection.htm?id=';var b=p(s,n,{},"id",0,26);a+=d(b,!0),a+="&_tb_token_=";var I=p(s,n,{},"_tb_token_",0,26);a+=d(I,!0),a+='&itemtype=1" class="J_TDialogTrigger">\u6536\u85cf</a>\n            </li>\n            <li>\n                <a data-spm-click="gostr=/tbindex;locaid=d14" href="" data-id="';var x=p(s,n,{},"id",0,29);a+=d(x,!0),a+='" data-category="';var w=p(s,n,{},"category_id",0,29);a+=d(w,!0),a+='" class="J_DelDiscoverItem">';var C={},T=[];T.push("NOT_LIKE"),C.params=T;var S=v(s,n,C,"lang",29);a+=d(S,!0),a+='</a>\n            </li>\n            <li>\n                <a data-spm-click="gostr=/tbindex;locaid=d15" href="" class="J_ShowPreference show-preference">';var k={},J=[];J.push("SELF_CONFIG"),k.params=J;var D=v(s,n,k,"lang",32);return a+=d(D,!0),a+='</a>\n            </li>\n        </ul>\n        <div class="bottom-border"></div>\n    </div>\n</div>\n'},i+=c(s,n,m,"each",1),i+="\n";var g={},_=[],y=u(s,n,"gridData.length",0,39);_.push(y),g.params=_,g.fn=function(n){var a="";a+='\n<div class="wall J_Wall clearfix">\n    ';var t={},r=[],e=u(s,n,"gridData",0,41);return r.push(e),t.params=r,t.fn=function(n){var a="";a+='\n    <a href="';var t=p(s,n,{},"url",0,42);a+=d(t,!0),a+='" class="mod wall-item">\n        <img src="';var r=p(s,n,{},"pictUrl",0,43);a+=d(r,!0),a+='" alt="" />\n      ';var e={},i=[],o=u(s,n,"promotional",0,44);i.push(o),e.params=i,e.fn=function(n){var a="";return a+='\n      <div class="two11-mini"></div>\n      '},a+=c(s,n,e,"if",44),a+='\n        <div class="wall-item-desc">\n            <p>';var l=p(s,n,{},"title",0,48);a+=d(l,!0),a+='</p>\n            <div class="item-count">\u2605';var v=p(s,n,{},"ordercost",0,49);return a+=d(v,!0),a+="</div>\n        </div>\n    </a>\n    "},a+=c(s,n,t,"each",41),a+="\n</div>\n"},i+=c(s,n,g,"if",39),i+="\n";var b={},I=[],x=u(s,n,"noBtn",0,55);return I.push(x),b.params=I,b.fn=function(n){var a="";return a+=""},b.inverse=function(n){var a="";a+='\n<a class="preference-btn J_ShowPreference J_TopShowPreference" href="" data-spm-click="gostr=/tbindex;locaid=d16">';var t={},r=[];r.push("BOOK_HOBBY"),t.params=r;var e=v(s,n,t,"lang",56);return a+=d(e,!0),a+="</a>\n"},i+=c(s,n,b,"if",55)}}),KISSY.add("discover/c/discover/tpl/shop.xtpl",function(n,a,t,r){return function(n,a,t){var e,i="",o=this.config,s=this,l=o.utils;"undefined"!=typeof r&&r.kissy&&(e=r);var c=l.runBlockCommand,d=l.renderOutput,u=l.getProperty,v=l.runInlineCommand,p=l.getPropertyOrRunCommand;i+='<div class="hidden J_ItemHover">\n    ';var m={},f=[],h=u(s,n,"shops",0,2);return f.push(h),m.params=f,m.fn=function(n){var a="";a+='\n    <div class="shop">\n        <a href="';var t=p(s,n,{},"url",0,4);a+=d(t,!0),a+='" class="shop-title">\n            <div class="fpicon shop-logo s-discover-logo">\n                ';var r={},e=[],i=u(s,n,"pictUrl",0,6);e.push(i),r.params=e,r.fn=function(n){var a="";a+='\n                    <img src="//g.alicdn.com/s.gif" style="background-image:url(';var t=p(s,n,{},"pictUrl",0,7);return a+=d(t,!0),a+=')" />\n                '},a+=c(s,n,r,"if",6),a+='\n            </div>\n            <div class="shop-desc">\n                <h4>';var o=p(s,n,{},"shopTitle",0,11);a+=d(o,!0),a+="</h4>\n                <p>";var l={},m=[];m.push("MAIN_MANAGER"),l.params=m;var f=v(s,n,l,"lang",12);a+=d(f,!0),a+="\uff1a";var h=p(s,n,{},"industry",0,12);a+=d(h,!0),a+="</p>\n            </div>\n        </a>\n        ";var g={},_=[],y=u(s,n,"xindex",0,15);return _.push(3>y),g.params=_,g.fn=function(n){var a="";a+='\n        <ul class="wall J_Wall clearfix">\n            ';var t={},r=[],e=u(s,n,"subItems",0,17);return r.push(e),t.params=r,t.fn=function(n){var a="";a+='\n                <li class="mod wall-item">\n                    <a href="';var t=p(s,n,{},"url",0,19);a+=d(t,!0),a+='">\n                        <img src="';var r=p(s,n,{},"pictUrl",0,20);a+=d(r,!0),a+='" alt="';var e=p(s,n,{},"title",0,20);a+=d(e,!0),a+='" />\n                        <div class="wall-item-desc">\n                            <p>';var i=p(s,n,{},"title",0,22);a+=d(i,!0),a+='</p>\n                            <div class="item-count">\u2605 ';var o=p(s,n,{},"collectCount",0,23);return a+=d(o,!0),a+="</div>\n                        </div>\n                    </a>\n                </li>\n            "},a+=c(s,n,t,"each",17),a+="\n        </ul>\n        "},a+=c(s,n,g,"if",15),a+="\n    </div>\n    "},i+=c(s,n,m,"each",2),i+="\n</div>"}}),KISSY.add("discover/c/discover/index",["node","event","io","json","xtemplate","../base/i18n","./tpl/goods.xtpl","./tpl/shop.xtpl","gallery/offline/1.1/","../loadtms/index"],function(n,a){function t(n,a){return n?(a||(a="160x160"),"//img.alicdn.com/tps/"+n+"_"+a+".jpg"):""}var r=a("node"),e=a("event"),i=a("io"),o=a("json"),s=a("xtemplate"),l=a("../base/i18n"),c=a("./tpl/goods.xtpl"),d=a("./tpl/shop.xtpl"),u=a("gallery/offline/1.1/"),v=a("../loadtms/index"),p=r.all,m="discover-shop-data",f="discover-goods-data",h="discover-shop-ref",g="discover-goods-ref",_=864e5,y=function(a){var t=this,r=a.target;return a&&a.target?(a.target=p(r),t.changeTarget=a.target.next(".J_ChangeDiscover"),n.mix(a,"goods"==a.type&&y.goods_config||y.shop_config),n.mix(t,a),void t.init()):!1};return n.mix(y,{goods_config:{api:"//tui.taobao.com/recommend?appid=406&type=new",tpl:c},shop_config:{api:"//tui.taobao.com/recommend?appid=1671",tpl:d}}),n.augment(y,e.Target),n.augment(y,{init:function(){var n=this;n.offline=new u,n.load(1);var a=n.changeTarget;a.length&&(a.on("click",function(){var a=n.offline,t=a.getItem(g);"shop"==n.type&&(t=a.getItem(h)),t||(t=0),t++,"goods"==n.type?a.setItem(g,t.toString(),_):a.setItem(h,t.toString(),_),n.nReflesh=t,n.load(t),n.fire("change")}),a.on("mouseenter",function(){a.children("s").addClass("s-change")}).on("mouseleave",function(){a.children("s").removeClass("s-change")}))},load:function(a){var t=this,r=t.api,e={nReflesh:a,count:this.len,t:n.now()};"zh-tw"==l.localLang&&(e._lang="zh_CN:TB-GBK"),new i({type:"get",url:r,data:e,timeout:10,dataType:"jsonp"}).then(function(n){var a=n[0];return a?void("fail"===a.status?t._afterFail():(a=t._mapData(a),t.render(a))):!1}).fail(function(n){t._afterFail()})},_mapData:function(n){var a=this,t=a.type,r=a.offline;return"goods"==t?(n=a._goodsMap(n),r.setItem(f,o.stringify(n))):(n=a._shopMap(n),r.setItem(m,o.stringify(n))),n},_afterFail:function(){var n=this,a=n._loadCache(),t=n.type;"goods"==t?a&&a.auctions.length?n.render(a):n._loadTms():a?n.render(a):n._loadTms()},_loadCache:function(){var a=this,t=a.type,r={},e=a.offline;return r=e.getItem("goods"==t?f:m),n.isString(r)&&(r=o.parse(r)),r},_loadTms:function(){var a=this,t=a.type;v([t]).then(function(r){var e=r.result[0];return n.log("\u53d1\u73b0\u63a5\u53e3\u6302\u4e86\uff0c\u8bfb\u53d6TMS\u7684\u515c\u5e95\u5185\u5bb9\uff01"),(e=e.cont)?("shop"==t&&n.each(e.shops,function(n,a){var t=n.subItems;e.shops[a]=n[0],e.shops[a].subItems=t}),"goods"==t&&(n.each(e.auctions,function(n,a){var t=n.url;e.auctions[a].url="//item.taobao.com/item.htm?id="+t}),e.result=e.auctions),e=a._mapData(e),void a.render(e)):!1})},_goodsMap:function(a){var r=this,e=a.result,i=[],o=[],s=r.listLength||9,l=p("#J_Tb_Token").val();return n.each(e,function(n,a){var r=n.pict_url;s>a?(n.pictUrl=t(r),i.push(n)):(n.pictUrl=t(r),o.push(n)),n._tb_token_=l}),{auctions:i,gridData:o}},_shopMap:function(a){if(!a)return a;var r=a.shops;return n.each(r,function(a){a.url="//shop"+a.shopId+".taobao.com/shop/view_shop.htm?scm="+a.scm||"";var r=a.pictUrl;r&&(a.pictUrl=t(r,"60x60")),n.each(a.subItems,function(n){n.pictUrl=t(n.pictUrl),n.url="//item.taobao.com/item.htm?id="+n.itemId+"&scm="+n.scm||""}),a.impression&&(a.comments=a.impression.split(":"),a.comments=n.filter(a.comments,function(n,a){return 3>a}))}),a},render:function(n){if(!n)return!1;var a=this;a.displayLoading(!1);var t=a.tpl,r=a.target,e=new s(t,{commands:{lang:l.lang}}).render(n),i=r.children();i.length&&i.fadeOut(.3);var o=a.type;return"goods"==o&&r.css("overflow","hidden"),r.html(e).children().fadeIn(.3),a.fire("render"),a},displayLoading:function(n){var a=this,t=a.target;return t[n&&"addClass"||"removeClass"]("loading"),a},_goldlog:function(n){},addItem:function(a){var t=this,r=t.target,e=r.all(".J_Wall");a=t._goodsMap(a),n.mix(a,{noBtn:!0});var i=new s(c,{commands:{lang:l.lang}}).render(a);return a.$item=p(i).insertBefore(e),t.fire("addItem",a),t}}),y});KISSY.add("discover/c/preference/tpl/preference.xtpl",function(a,t,e,n){return function(a,t,e){var r,s="",i=this.config,o=this,c=i.utils;"undefined"!=typeof n&&n.kissy&&(r=n);var u=c.runBlockCommand,d=c.renderOutput,l=c.getProperty,v=c.runInlineCommand,g=c.getPropertyOrRunCommand;s+='<div class="preference-box J_PreferenceBox">\n    <div class="padding-box">\n        <h2>';var p={},m=[];m.push("HOBBY_SETTING"),p.params=m;var h=v(o,a,p,"lang",3);s+=d(h,!0),s+='</h2>\n        <a class="preference-btn J_BackPage" href="" data-spm-click="">';var f={},b=[];b.push("RETURN_FINDGOODS"),f.params=b;var T=v(o,a,f,"lang",4);s+=d(T,!0),s+="</a>\n        <h4>";var C={},_=[];_.push("TAG_SUGGEST"),C.params=_;var x=v(o,a,C,"lang",5);s+=d(x,!0),s+='\uff1a</h4>\n        <ul class="preference-list history-list J_HistoryList">\n            ';var y={},w=[],S=l(o,a,"historyTags",0,7);w.push(S),y.params=w,y.fn=function(a){var t="";t+='\n            <li class="tag ';var e={},n=[],r=l(o,a,"flag",0,8);n.push(0>r),e.params=n,e.fn=function(a){var t="";return t+="status-remove"},t+=u(o,a,e,"if",8),t+='" data-name="';var s=g(o,a,{},"name",0,8);t+=d(s,!0),t+='" data-id="';var i=g(o,a,{},"hashcode",0,8);t+=d(i,!0),t+='" data-position="';var c=g(o,a,{},"position",0,8);t+=d(c,!0),t+='" >';var v=g(o,a,{},"name",0,8);return t+=d(v,!0),t+='<span class="tag-action">x</span></li>\n            '},s+=u(o,a,y,"each",7),s+='\n        </ul>\n    </div>\n    <div class="padding-box">\n        <div class="J_TagListWrapper">\n            <h4 class="tag-header">';var L={},J=[];J.push("SELF_CHOOSE_TAG"),L.params=J;var $=v(o,a,L,"lang",14);s+=d($,!0),s+=' <em class="J_TagCount">';var k=g(o,a,{},"customTagsCount",0,14);s+=d(k,!0),s+='</em>/8</h4>\n            <ul class="preference-list tag-list J_TagList">\n                ';var U={},I=[],R=l(o,a,"customTags",0,16);I.push(R),U.params=I,U.fn=function(a){var t="";t+='\n                <li data-index="';var e=g(o,a,{},"xindex",0,17);t+=d(e,!0),t+='"  data-id="';var n=g(o,a,{},"hashcode",0,17);t+=d(n,!0),t+='"  data-position="';var r=g(o,a,{},"position",0,17);t+=d(r,!0),t+='" ';var s={},i=[],c=l(o,a,"name",0,17);i.push(c),s.params=i,s.fn=function(a){var t="";t+='data-name="';var e=g(o,a,{},"name",0,17);return t+=d(e,!0),t+='"'},s.inverse=function(a){var t="";return t+=' class="add"'},t+=u(o,a,s,"if",17),t+=">\n                    ";var v={},p=[],m=l(o,a,"name",0,18);return p.push(m),v.params=p,v.fn=function(a){var t="";t+="\n                    ";var e=g(o,a,{},"name",0,19);return t+=d(e,!0),t+='<span class="tag-action">x</span>\n                    '},v.inverse=function(a){var t="";return t+="\n                    +\n                    "},t+=u(o,a,v,"if",18),t+="\n                </li>\n                "},s+=u(o,a,U,"each",16),s+='\n            </ul>\n        </div>\n        <div class="preference-tab J_PreferenceTab">\n            <h4 class="tag-header">';var B={},D=[];D.push("TAG_LIB"),B.params=D;var P=v(o,a,B,"lang",28);s+=d(P,!0),s+='</h4>\n            <ul class="tab-pannel preference-list J_TabContent">\n                ';var A={},G=[],N=l(o,a,"newTags",0,30);return G.push(N),A.params=G,A.fn=function(a){var t="";t+='\n                <li class="tag ';var e={},n=[],r=l(o,a,"remove",0,31);n.push(r),e.params=n,e.fn=function(a){var t="";return t+="status-remove"},t+=u(o,a,e,"if",31),t+='" data-name="';var s=g(o,a,{},"name",0,31);t+=d(s,!0),t+='" data-id="';var i=g(o,a,{},"hashcode",0,31);t+=d(i,!0),t+='" data-position="';var c=g(o,a,{},"position",0,31);t+=d(c,!0),t+='" >';var v=g(o,a,{},"name",0,31);return t+=d(v,!0),t+='<span class="tag-action">+</span></li>\n                '},s+=u(o,a,A,"each",30),s+="\n            </ul>\n        </div>\n    </div>\n\n</div>"}}),KISSY.add("discover/c/preference/mods/tag-tab",["discover/c/base/base","io"],function(a,t){var e=t("discover/c/base/base"),n=(t("io"),e.$);return e.extend({initializer:function(){var a=this,t=a.get("$target"),e=a.get("host");t.all(".J_TabContent").on("click",function(r){if(!e.isLogin(!0))return!1;var s=n(r.target);if(s.hasClass("status-remove"))return!1;if(s.hasClass("tag-action")&&(s=s.parent()),!s.hasClass("tag"))return!1;var i=s.attr("data-id"),o=s.attr("data-name"),c=a.get("tagList");c.add({tag:i,name:o}),t.all(".tag").removeClass("primary"),s.addClass("status-remove")})},show:function(){var a=this,t=a.get("$target");t.fadeIn(.3)},primary:function(a){var t=this,e=(t.get("slide"),t.get("$target")),n=e.all(".tag");n.removeClass("primary");var r=n.item(0);return a.text(r.attr("data-name")),r.addClass("primary"),t},statusRemove:function(a){var t=this,e=t.get("$target"),n=e.all(".tag");n.each(function(t){t.attr("data-name")===a&&t.removeClass("status-remove")})}},{ATTRS:{host:{value:""},$target:{value:".J_PreferenceTab",getter:function(a){return n(a)}},slide:{value:{}},tagList:{value:{}}}})}),KISSY.add("discover/c/preference/mods/tag-list",["discover/c/base/base","io"],function(a,t){var e=t("discover/c/base/base"),n=t("io"),r=e.$;return e.extend({initializer:function(){var a=this,t=a.get("$target"),e=a.get("tagTab");e.set("tagList",a);var n=t.children(".J_TagList"),s=a.get("host");n.on("click",function(t){if(!s.isLogin(!0))return!1;var i=r(t.target);i.hasClass("add")?(a.set("$current",i),e.show(),n.all("li").removeClass("selected"),i.addClass("selected")):(i.hasClass("tag-action")&&(i=i.parent()),a.remove(i))})},add:function(a){var t=this,e=t.get("addUrl"),r=t.get("$current");return r.hasClass("add")?(a.pos=Number(r.attr("data-position")),n.jsonp(e,a).then(function(e){var n=Number(r.attr("data-index"));r.html(a.name+'<span class="tag-action">x</span>'),r.attr("data-name",a.name),r.attr("data-id",a.tag);var s=t.get("data");s[n]=a,t.update(r)})):t.remove(r).then(function(){t.add(a)}),t},remove:function(a){var t=this,e=t.get("delUrl"),r=a.attr("data-id"),s=Number(a.attr("data-index")),i=a.attr("data-name");return n.jsonp(e,{tag:r}).then(function(e){var n=e[0];if("success"===n.status){n=t.get("data"),n[s]={},t.update(a,!0);var r=t.get("tagTab");return r.statusRemove(i),n}})},update:function(a,t){var e=this;t?(a.addClass("add"),a.html("+")):a.removeClass("add");var n=e.get("$target"),r=e.get("count"),s=n.all(".J_TagCount");return s.text(r),e}},{ATTRS:{host:{value:""},$target:{value:".J_TagListWrapper",getter:function(a){return r(a)}},tagTab:{value:""},data:{value:[]},$current:{value:""},count:{value:0,getter:function(t){var e=this,n=e.get("data"),r=a.filter(n,function(t){return a.isString(t.name)});return r.length}},addUrl:{value:"//tui.taobao.com/recommend?appid=406&type=addtag"},delUrl:{value:"//tui.taobao.com/recommend?appid=406&type=removetag"}}})}),KISSY.add("discover/c/preference/mods/history-list",["discover/c/base/base","io"],function(a,t){var e=t("discover/c/base/base"),n=t("io"),r=e.$;return e.extend({initializer:function(){var a=this,t=a.get("$target"),e=a.get("host");t.on("click",function(t){if(!e.isLogin(!0))return!1;var n=r(t.target);return n.hasClass("tag-action")&&(n=n.parent()),n.hasClass("tag")?void(n.hasClass("status-remove")?a.back(n):a.del(n)):!1})},del:function(a){var t=this,e=t.get("delUrl"),r=a.attr("data-id");n.jsonp(e,{tag:r}).then(function(t){var e=t[0];"success"===e.status&&a.addClass("status-remove")})},back:function(a){var t=this,e=t.get("backUrl"),r=a.attr("data-id");n.jsonp(e,{tag:r}).then(function(t){a.removeClass("status-remove")})}},{ATTRS:{host:{value:""},$target:{value:".J_PreferenceBox .J_HistoryList",getter:function(a){return r(a)}},delUrl:{value:"//tui.taobao.com/recommend?appid=406&type=disliketag"},backUrl:{value:"//tui.taobao.com/recommend?appid=406&type=liketag"}}})}),KISSY.add("discover/c/preference/index",["discover/c/base/base","io","./tpl/preference.xtpl","./mods/tag-tab","./mods/tag-list","./mods/history-list","../base/i18n","anim"],function(a,t){var e=t("discover/c/base/base"),n=t("io"),r=t("./tpl/preference.xtpl"),s=t("./mods/tag-tab"),i=t("./mods/tag-list"),o=t("./mods/history-list"),c=t("../base/i18n"),u=t("anim"),d=e.$;return e.extend({initializer:function(){var t=this,e=t.get("target");e.on("render",function(){d(".J_ShowPreference").on("click",function(a){if(a.halt(),!t.isLogin(!0))return!1;t.render().then(function(){t.show()});var e=d("#J_BdSide").offset().top-100,n=new u(d(window),{scrollTop:e},.4,"easeOutStrong");n.run()}),a.use("tbc/favorite/1.0.16/,tbc/mini-login/1.4.3/",function(a,e,n){t.set("M",new e({callback:function(){}})),t.set("ML",n)})});var r=1;e.on("change",function(){r=e.nReflesh});var s=e.target;s.on("click",function(a){var s=d(a.target),i=s.attr("data-id")||"",o=s.attr("data-category")||"",c="";if(s.hasClass("J_DelDiscoverItem")){if(a.halt(),!t.isLogin(!0))return!1;c=t.get("delUrl"),n.jsonp(c,{itemid:i,category:o,nReflesh:r}).then(function(a){var t=a[0];e.addItem(t);var n=s.index(".J_DelDiscoverItem");d(".J_DiscoverItem").item(n).slideUp(.2)})}else if(s.hasClass("J_TDialogTrigger")){if(a.preventDefault(),!t.isLogin(!0))return!1;c=t.get("favoriteUrl"),n.jsonp(c,{itemid:i,category:o})}})},render:function(){var t=this,u=t.get("target"),l=t.get("url");return n.jsonp(l).then(function(n){var l=n[0],v=l.result;if(!v||!v.length)return!1;l={historyTags:[],customTags:[{position:1},{position:2},{position:3},{position:4},{position:5},{position:6},{position:7},{position:8}],customTagsCount:0,newTags:[]},a.each(v,function(a){switch(Number(a.type)){case 1:l.historyTags.push(a);break;case 2:var t=a.position;l.customTags[t-1]=a;break;case 3:l.newTags.push(a)}}),a.each(l.customTags,function(t){t.name&&l.customTagsCount++,a.each(l.newTags,function(a,e){t.name===a.name&&(l.newTags[e].remove=!0)})});var g=e.renderTpl(r,l,{commands:{lang:c.lang}}),p=d(g).appendTo(u.target);t.set("$box",p);var m=new s({host:t});return new i({tagTab:m,data:l.customTags,host:t}),new o({host:t}),d(".J_BackPage").on("click",function(a){a.halt(),t.hide()}),p})},show:function(){var a=this,t=a.get("$box");t.slideDown(.3)},hide:function(){var a=this,t=a.get("$box");t.slideUp(.3);var e=a.get("target");e.load(1)},isLogin:function(a,t){var e=this,n=e.get("ML"),r=n.check();return!r&&a&&e.showLogin(t),r},showLogin:function(a){var t=this,e=t.get("ML");return a?e.show({},a):e.show(),e}},{ATTRS:{isRender:{value:!1},$box:{value:""},$topShowBtn:{value:".J_TopShowPreference",getter:function(a){return d(a)}},url:{value:"//tui.taobao.com/recommend?appid=406&type=usertag"+("zh-tw"==c.localLang?"&_lang=zh_CN%3ATB-GBK":"")},delUrl:{value:"//tui.taobao.com/recommend?appid=406&type=delete"},favoriteUrl:{value:"//tui.taobao.com/recommend?appid=406&type=collect&nReflesh=1"},ML:{value:""}}})});