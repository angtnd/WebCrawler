/*
 countdown_timer-1.1.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-04-09 14:40:31
*/
(function(){if(void 0!==window.jQuery){var f=jQuery.noConflict(),l=function(a){this.$config=0<a.length?a:f();this.targetSelector=this.$config.attr("data-target")||this.defaults.selectors.target;this.daySelector=this.$config.attr("data-day")||this.defaults.selectors.day;this.hourSelector=this.$config.attr("data-hour")||this.defaults.selectors.hour;this.minuteSelector=this.$config.attr("data-minute")||this.defaults.selectors.minute;this.secondSelector=this.$config.attr("data-second")||this.defaults.selectors.second;
this.tenSelector=this.$config.attr("data-ten")||this.defaults.selectors.ten;this.oneSelector=this.$config.attr("data-one")||this.defaults.selectors.one;this.apiURL=this.$config.attr("data-apiURL")||this.defaults.apiURL;this.updateInterval=+this.$config.attr("data-updateInterval")||this.defaults.updateInterval;this.$targets=void 0;this.startTime=[];this.endTime=[];this.dayTen=[];this.dayOne=[];this.hourTen=[];this.hourOne=[];this.minuteTen=[];this.minuteOne=[];this.secondTen=[];this.secondOne=[];this.currentTimeDigits=
[];this.isTimerActive=[];this.hideAfterEnd=[];this.autoStart=[];this.serverTime=void 0;this.updateID=0;this.isTestMode=this.checkTestMode(location.search);this.getTimeFromServer()};l.prototype={defaults:{selectors:{target:".timeWrap",day:".day",hour:".hour",minute:".minute",second:".second",ten:".ten",one:".one"},events:{COUNTDOWN_TIMER_INITIALIZED:"countdowntimerinitialized"},JST:-324E5,DAY:864E5,HOUR:36E5,MINUTE:6E4,SECOND:1E3,apiURL:"http://gettime.r10s.jp/",updateInterval:1E3},getTimeFromServer:function(){var a=
this;if(this.isTestMode){var c=location.search.split("countdowntimertest=")[1];a.serverTime=a.getTimeValueFromString(c);a.getElements()}else f.ajax({url:this.apiURL,dataType:"jsonp",scriptCharset:"utf-8",cache:!0,error:function(){},success:function(c){var d=new Date;d.setTime(1E3*c.epoch);a.serverTime=d.getTime();a.getElements()}})},getElements:function(){var a=this;this.$targets=f(this.targetSelector);this.$targets.each(function(c,e){var d=f(e),o=d.attr("data-startDate"),k=d.attr("data-endDate");
a.hideAfterEnd[c]="true"===d.attr("data-hideAfterEnd");a.autoStart[c]="true"===d.attr("data-autoStart");var h=d.find(a.daySelector+" "+a.tenSelector),i=d.find(a.daySelector+" "+a.oneSelector),j=d.find(a.hourSelector+" "+a.tenSelector),g=d.find(a.hourSelector+" "+a.oneSelector),b=d.find(a.minuteSelector+" "+a.tenSelector),l=d.find(a.minuteSelector+" "+a.oneSelector),m=d.find(a.secondSelector+" "+a.tenSelector),n=d.find(a.secondSelector+" "+a.oneSelector);a.startTime[c]=a.getTimeValueFromString(o,0);
a.endTime[c]=a.getTimeValueFromString(k,0);a.dayTen[c]=0<h.length?h:f();a.hourTen[c]=0<j.length?j:f();a.minuteTen[c]=0<b.length?b:f();a.secondTen[c]=0<m.length?m:f();a.dayOne[c]=0<i.length?i:f();a.hourOne[c]=0<g.length?g:f();a.minuteOne[c]=0<l.length?l:f();a.secondOne[c]=0<n.length?n:f();a.currentTimeDigits[c]=[0,0,0,0];a.startTime[c]<=a.serverTime&&a.serverTime<=a.endTime[c]?(a.isTimerActive[c]=!0,d.show()):(a.isTimerActive[c]=!1,d.hide())});this.setCountDownTimer()},setCountDownTimer:function(){var a=
this;this.updateElements();this.updateID=setInterval(function(){a.updateElements()},this.updateInterval);this.fireEvent(this.$config,this.defaults.events.COUNTDOWN_TIMER_INITIALIZED,{time:this.serverTime})},updateElements:function(){for(var a=!1,c=0,e=0,d=0,f=0,k=0,h=0,i=0,j=0,g=0,b=0;b<this.$targets.length;b++)this.startTime[b]<=this.serverTime&&this.serverTime<=this.endTime[b]?(this.autoStart[b]&&!this.isTimerActive[b]&&(this.$targets.eq(b).show(),this.isTimerActive[b]=!0),a=0<this.dayTen[b].length?
!0:!1,g=this.endTime[b]-this.serverTime,c=this.currentTimeDigits[b][0],e=this.currentTimeDigits[b][1],d=this.currentTimeDigits[b][2],f=this.currentTimeDigits[b][3],k=g/this.defaults.DAY|0,h=a?g%this.defaults.DAY/this.defaults.HOUR|0:g/this.defaults.HOUR|0,i=g%this.defaults.HOUR/this.defaults.MINUTE|0,j=g%this.defaults.MINUTE/this.defaults.SECOND|0,a?0>g?this.isTimerActive[b]=!0:(c!==k&&this.changeTimeElement(this.dayTen[b],this.dayOne[b],k),e!==h&&this.changeTimeElement(this.hourTen[b],this.hourOne[b],
h),d!==i&&this.changeTimeElement(this.minuteTen[b],this.minuteOne[b],i),f!==j&&this.changeTimeElement(this.secondTen[b],this.secondOne[b],j),this.currentTimeDigits[b][0]=k,this.currentTimeDigits[b][1]=h,this.currentTimeDigits[b][2]=i,this.currentTimeDigits[b][3]=j):0>g?this.isTimerActive[b]=!0:(e!==h&&this.changeTimeElement(this.hourTen[b],this.hourOne[b],h),d!==i&&this.changeTimeElement(this.minuteTen[b],this.minuteOne[b],i),f!==j&&this.changeTimeElement(this.secondTen[b],this.secondOne[b],j),this.currentTimeDigits[b][0]=
k,this.currentTimeDigits[b][1]=h,this.currentTimeDigits[b][2]=i,this.currentTimeDigits[b][3]=j)):this.isTimerActive[b]&&(this.hideAfterEnd[b]&&this.$targets.eq(b).hide(),this.isTimerActive[b]=!1);this.serverTime+=this.updateInterval},changeTimeElement:function(a,c,e){var d=10>e?"0"+e:""+e,e=d.charAt(0),d=d.charAt(1);"0"===e?a.children().eq(0).show().nextAll().hide():a.children().eq(0).hide().end().eq(+e).show().nextAll().hide();"0"===d?c.children().eq(0).show().nextAll().hide():c.children().eq(0).hide().end().eq(+d).show().nextAll().hide()},
getTimeValueFromString:function(a,c){if(a){var e=a.split(/-|:|\s/);return(new Date(Date.UTC(+e[0],+e[1]-1,+e[2],+e[3],+e[4],+e[5])-324E5)).getTime()}return c},checkTestMode:function(a){return/\?countdowntimertest/.test(a)},fireEvent:function(a,c,e){c=f.Event(c);c.customData=e||{};a.trigger(c)}};var p=f("#RJSCountDownTimerConfig");new l(p)}})();
