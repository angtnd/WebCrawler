var BF_UniversalDOM=function(){this.UNIVERSAL_DOM_CLASS="bf_dom";this.UNIVERSAL_DOM_ATTR="rel:bf_bucket";this.UNIVERSAL_DOM_DATA_ATTR="rel:bf_bucket_data";this.UNIVERSAL_DOM_BUCKET_DATA_ATTR="rel:bf_data";this._bucket={};this._element_assignment_lookup={};this.init=function(){universal_dom._bucket={};bfjs.each(bfjs.$("."+universal_dom.UNIVERSAL_DOM_CLASS),function(t){universal_dom._assign(t)})};this.get_bucket_elements=function(t){if(typeof universal_dom._bucket[t]=="undefined")return[];var i=[];bfjs.each(universal_dom._bucket[t].elements,function(t){i.push(t.element)});return i};this.get_bucket_elements_with_data=function(t,i){if(typeof universal_dom._bucket[t]=="undefined")return[];var a=[];universal_dom._bucket[t].elements.each(function(t){var s=true;for(var r in i){if(typeof t.data[r]=="undefined"||t.data[r]!=i[r])s=false}if(s)a.push(t.element)});return a};this.class_regex=new RegExp(this.UNIVERSAL_DOM_CLASS);this.update=function(t){var i=$(t);if(i){var a=i.select('[class~="'+universal_dom.UNIVERSAL_DOM_CLASS+'"]')||[];if(i.hasClassName(this.UNIVERSAL_DOM_CLASS))a.push(i);a.each(function(t){universal_dom._assign(t)})}};this.assign_handler=function(t){var i=t.bucket;var a=t.handler;var s=t.event||"immediate";var r=true;var n=universal_dom._bucket[i]||{};var o=n.handlers||{};var l=o[s]||[];bfjs.each(l,function(t){if(t==a)r=false});if(r){l.push(a);o[s]=l;n.handlers=o;universal_dom._bucket[i]=n}universal_dom._assign_handler(i)};this.add_element_to_bucket=function(t){var i=t.bucket;var a=t.element;var s=t.data;var r=universal_dom._bucket[i]||{};var n=r.elements||[];n.push({element:a,data:s});r.elements=n;universal_dom._bucket[i]=r;universal_dom._assign_handler(i);var o=universal_dom._element_assignment_lookup[a]||[];o.push(i);universal_dom._element_assignment_lookup[a]=o};this.remove_element_from_buckets=function(t){var i=universal_dom._element_assignment_lookup[t];if(i){i.each(function(i){var a=[];universal_dom._bucket[i].elements.each(function(i){if(i.element!=t)a.push(i)});universal_dom._bucket[i].elements=a})}};this.refresh_immediate_bucket=function(t){if(universal_dom._bucket[t].elements){universal_dom._bucket[t].elements.each(function(i){if(universal_dom._bucket[t].handlers.immediate){universal_dom._bucket[t].handlers.immediate.each(function(t){t(i.element,i.data)})}})}};this._assign_handler=function(t){var i=universal_dom._bucket[t];var a=i.handlers;if(typeof i.elements=="undefined")i.elements=[];for(var s=0;s<i.elements.length;s++){var r=i.elements[s].element;var n=i.elements[s].data;n.element=r;for(var o in a){a[o].each(function(i){var a=n.assigned||{};if(typeof a[i.toString()]=="undefined"){if(o=="immediate")i(r,n);else{var l=Object.clone(n);r.observe(o,function(e){for(var t in l){e[t]=l[t]}i(e)})}}a[i.toString()]=true;n.assigned=a;universal_dom._bucket[t].elements[s].data=n})}}};this._assign=function(t){if(t.hasAttribute(this.UNIVERSAL_DOM_ATTR))this.bucket_attr(t);else if(t.hasAttribute(this.UNIVERSAL_DOM_DATA_ATTR))this.bucket_data_attr(t);else{}};this.update_or_add_element_in_bucket=function(t){var i=t.bucket;var a=t.element;var s=t.data;var r=universal_dom._bucket[i];if(typeof r=="undefined"||typeof r.elements=="undefined"||r.elements.length==0){universal_dom.add_element_to_bucket({bucket:i,element:a,data:s});return}var n=0;r.elements.each(function(t,i){if(t.element==a){r.elements[i].data=s;n=1;throw $break}});if(!n){universal_dom.add_element_to_bucket({bucket:i,element:a,data:s})}};this.bucket_attr=function(t){var i="";try{i=t.getAttribute(universal_dom.UNIVERSAL_DOM_ATTR);var a={};var s=t.getAttribute(universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR);if(s)a=JSON.parse(s);var r=i.split(" ");r.each(function(i){universal_dom.update_or_add_element_in_bucket({element:t,bucket:i,data:a})})}catch(e){console.error(e+i+t.id+universal_dom.UNIVERSAL_DOM_BUCKET_DATA_ATTR)}};this.bucket_data_attr=function(t){var i=t.getAttribute(universal_dom.UNIVERSAL_DOM_DATA_ATTR);try{var a=JSON.parse(i)}catch(e){console.error("Failed to parse JSON ("+i+") for element "+t+" (id:"+t.id+",class:"+t.className+",tag:"+t.tagName+")")}for(var s in a){universal_dom.update_or_add_element_in_bucket({element:t,bucket:s,data:a[s]})}};this.remove_bucket_elements=function(t){t.each(function(t){if(typeof universal_dom._bucket[t]!="undefined"){delete universal_dom._bucket[t].elements}})};this.assign_ids_to_elements_in_bucket=function(t,i){universal_dom._bucket[t].elements.each(function(t,a){if(typeof t.element!="undefined"&&!t.element.id)t.element.id=i(a)})}};var universal_dom=new BF_UniversalDOM;universal_dom.init();universal_dom.assign_handler({bucket:"toggle",event:"click",handler:function(e){e.stop();var t=function(t){if(t.style.display=="none")t.toggle();else if(t.hasClassName("hidden"))t.removeClassName("hidden");else t.addClassName("hidden")};if(typeof e.el!="undefined"){t($(e.el))}if(typeof e.els!="undefined"){e.els.each(function(i){t($(i))})}}});universal_dom.assign_handler({bucket:"stop",event:"click",handler:Event.stop});BF_ProgLoad_Images=function(){this.images=new Hash;this.index=1;this.DEBUG=false;this.bad_browser=0;this.autoload=false;this.autoload_interval=1e3;this.min_lookahead_pixels=400;this.init_total_delay=0;this.init_max_delay=1e4;this.init_delay_interval=250;var t=this;this.init=function(){bf_prog_load.media=new Hash;if(document.location.search.match(/progload_debug=true/)){this.DEBUG=true;console.debug("init progressive image loader...")}try{this.lookahead_pixels=document.viewport.getHeight();if(window["BF_IS_TOP_LIST"]&&this.lookahead_pixels<2e3)this.lookahead_pixels=2e3;if(this.lookahead_pixels<t.min_lookahead_pixels&&t.init_total_delay<t.init_max_delay){t.init_total_delay+=t.init_delay_interval;setTimeout(bf_prog_load.init,t.init_delay_interval);return}var i=document.viewport.getScrollOffsets();var a=i[1];a=document.viewport.getHeight()+a;universal_dom.get_bucket_elements("progload").each(function(i){var s=i.getAttribute("rel:bf_image_src");var r=i.cumulativeOffset()[1];if(bf_prog_load.DEBUG){console.log("INIT viewport: %s image offset: %s image: %s lookahead: %s pixels",a,r,s,bf_prog_load.lookahead_pixels);i.title=r}if(r!==0&&a>r-bf_prog_load.lookahead_pixels){if(bf_prog_load.DEBUG){i.style.border="solid red 1px"}t.load_image(i,s.match("^http(?:s?)://")?s:BF_STATIC.image_root+s)}else{var n={el:i,position:r,src:s};bf_prog_load.media.set(""+bf_prog_load.index,n);bf_prog_load.index++}});universal_dom.get_bucket_elements("progload_video").each(function(e){var t=e.cumulativeOffset()[1];bf_prog_load.media.set(""+bf_prog_load.index,{data:e,position:t,type:"video"});bf_prog_load.index++});if(Prototype.Browser.IE&&parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))==6||Prototype.Browser.Opera||!!window.fb_app){bf_prog_load.bad_browser=1;setTimeout(function(){bf_prog_load.scrolled("all")},500)}else{Event.observe(window,"scroll",function(e){bf_prog_load.scrolled()})}}catch(e){console.error(e)}universal_dom.assign_handler({bucket:"add_to_prog_load",handler:bf_prog_load.add});t.autoload_media()};this.autoload_media=function(){t.autoload=true;if(t.DEBUG){console.info("Starting image autoload")}var i;i=setInterval(function(){if(!bf_prog_load.media.size()){if(t.DEBUG){console.info("End image autoload")}t.autoload=false;clearInterval(i)}else{bf_prog_load.media.each(function(i){var a=false;if(!i.value.type){var s=i.value.el.getAttribute("rel:bf_image_src");if(i.value.position===0||s==i.value.el.src){return false}if(t.DEBUG){i.value.el.style.border="solid orange 1px"}t.load_image(i.value.el,i.value.src.match("^http(?:s?)://")?i.value.src:BF_STATIC.image_root+i.value.src);a=true}else if(i.value.type=="video"){if(i.value.data){embed_video.load_video(i.value.data,true);a=true}}if(a){bf_prog_load.media.unset(i.key);throw $break}})}},t.autoload_interval)};this.image_watcher=function(i,a,s,r){this.maxRetries=3;this.retry=0;this.retryTimeout=[1e4,2e4,3e4];this.el=i;this.src=a;this.success=s;this.error=r;this.load=function(){if(t.DEBUG){console.log((this.retry==0?"First":"Try #"+this.retry)+" load "+this.src)}this.image=new Image;this.image.onload=function(t){return function(){t.onsuccess.call(t)}}(this);this.image.onabort=function(t){return function(){t.timeout.call(t)}}(this);this.image.onerror=function(t){return function(){t.timeout.call(t)}}(this);this.image.src=this.src};this.onsuccess=function(){this.image=null;this.success(this)};this.timeout=function(){this.image=null;if(this.retry>=this.maxRetries){this.error(this);return}if(t.DEBUG){console.log("Waiting "+this.retryTimeout[this.retry]+" ms on "+this.src)}setTimeout(function(t){return function(){t.load.call(t)}}(this),this.retryTimeout[this.retry]);this.retry++}};this.load_image=function(i,a){if(!i)return false;if(i.className.match(/progload-tweet/)){bf_prog_load.loadTwitterEmbed(i);return false}else if(i.className.match(/progload-instagram/)){bf_prog_load.loadInstagramEmbed(i);return false}var s=(new Date).getTime();new this.image_watcher(i,a,function(r){if(t.DEBUG){console.info("Image %s was loaded successfully.",r.src)}i.src=a;var n=(new Date).getTime();if(/anigif/.test(a)&&window.mPulse!==undefined){mPulse.sendTimer("gif_loadtime",n-s)}},function(a){if(t.DEBUG){console.error("Image %s wasn't loaded.",a.src)}i.src=trans_gif_1x1_base64}).load()};this.loadInstagramEmbed=function(t){var i=t.getAttribute("rel:bf_instagram_el"),a=document.getElementById(i);if(a){a.className="instagram-media";if(typeof instgrm!="undefined"&&typeof instgrm.Embeds!="undefined")instgrm.Embeds.process()}};this.loadTwitterEmbed=function(t){if(typeof EventManager!="undefined"){EventManager.fire("progload:tweet",{el:t})}};this.scrolled=function(i){try{bf_prog_load.media.each(function(a){var s=document.viewport.getScrollOffsets();var r=s[1];r=document.viewport.getHeight()+r;if(a.value.position!==0&&(r>a.value.position-bf_prog_load.lookahead_pixels||i)){if(bf_prog_load.DEBUG){console.log("SCROLL viewport: %s image offset: %s image: %s",r,a.value.position,a.value.src);if(i){a.value.el.style.border="solid green 1px"}else{a.value.el.style.border="solid blue 1px"}}if(a.value.data){embed_video.load_video(a.value.data,true)}else{t.load_image(a.value.el,a.value.src.match("^http(?:s?)://")?a.value.src:BF_STATIC.image_root+a.value.src)}bf_prog_load.media.unset(a.key)}})}catch(e){console.error(e)}};this.add=function(i){var a=i.getAttribute("rel:bf_image_src");var s=i.cumulativeOffset()[1];var r=document.viewport.getScrollOffsets();var n=r[1];n=document.viewport.getHeight()+n;if(s!==0&&(n>s-bf_prog_load.lookahead_pixels||bf_prog_load.bad_browser)){if(bf_prog_load.DEBUG){i.style.border="solid yellow 1px";console.log("SHOW (add). offset: %s image: %s lookahead: %s pixels",s,a,bf_prog_load.lookahead_pixels)}t.load_image(i,a.match("^http(?:s?)://")?a:BF_STATIC.image_root+a)}else{var o={el:i,position:s,src:a};if(bf_prog_load.DEBUG){console.log("ADDING image. offset: %s image: %s lookahead: %s pixels",s,a,bf_prog_load.lookahead_pixels)}bf_prog_load.media.set(""+bf_prog_load.index,o);bf_prog_load.index++;if(!t.autoload){t.autoload_media()}}var l=i.getAttribute("rel:bf_bucket");var u=l.replace("add_to_prog_load","xx");i.setAttribute("rel:bf_bucket",u)}};var bf_prog_load=new BF_ProgLoad_Images;BuzzLoader.register(function(){bf_prog_load.init()},2);var BFPinterestReferer=function(){this.COOKIE="bf_referer";this.PAGE_TYPE;this.PROMO_INDEX=5;this.PROMO_PER_ROW=2;this.PROMO_ROWS=2;this.SPONSOR_INDEX=1;this.pinit_ps={};this.init=function(){var t=true;if(BF_STATIC.tt_page.match(/^(MobileHome|MobileDiy|MobileFood|MobileHealth|MobileParents|MobileStyle|MobileTravel|MobileWeddings)$/i)){bf_pinterest_referer.PAGE_TYPE="vertical";bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page.match(/^MobileBuzz$/)){bf_pinterest_referer.PAGE_TYPE="bpage-mobile";bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page.match(/^(DIY|Food|Health|Parents|Style|Travel|Weddings)$/i)){bf_pinterest_referer.PAGE_TYPE="vertical"}else if(BF_STATIC.hp_type&&BF_STATIC.hp_type.match(/^Life$/i)){bf_pinterest_referer.PAGE_TYPE="life";bf_pinterest_referer.PROMO_PER_ROW=6;bf_pinterest_referer.PROMO_ROWS=1}else if(BF_STATIC.tt_page=="Buzz"){bf_pinterest_referer.PAGE_TYPE="bpage";if(document.getElementById("hotOnPinterestWrap")){var a=document.getElementById("hotOnPinterestWrap").getElementsByClassName("hot-on-pinterest");for(i=0;i<a.length;i++){pinterestunit=a[i];pinterestunit.setAttribute("data-promo_per_row",3);pinterestunit.setAttribute("data-promo_rows",1);pinterestunit.setAttribute("data-unit_type","bpage_bottom")}}}else{t=false}if(t)bf_pinterest_referer._init()};this._init=function(){bf_pinterest_referer.setup_observers();bf_pinterest_referer._loadPinterestScript();var t=document.getElementsByClassName("hot-on-pinterest__more");for(i=0;i<t.length;i++){bf_pinterest_referer.show_more(t[i])}};this.setup_observers=function(){var t=document.getElementsByClassName("hot-on-pinterest__more");for(i=0;i<t.length;i++){t[i].addEventListener("click",bf_pinterest_referer.show_more)}};this.show_more=function(t){var i=false;if(t.target){t=t.target;i=true}var a=t.parentNode.parentNode;var s=a.getAttribute("data-revealed");if(!s||i){var r=a.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;var n=a.getAttribute("data-promo_rows")||bf_pinterest_referer.PROMO_ROWS;var o=r*n;if(s==o)o=12;if(s==12)o=21;if(o==21)t.className+=" hidden";bf_pinterest_referer.reveal_promos(a,o)}};this.reveal_promos=function(t,i){t.setAttribute("data-revealed",i);var a=bf_pinterest_referer._get_the_promos(t);for(var s in a){var r=t.getElementsByClassName("js-sponsored");r=Object.keys(r).map(function(t){return r[t]});for(var n=0;n<a[s].length;n++){if(r.indexOf(a[s][n])!=-1)a[s].splice(n,1)}}var o=function(t){for(var s in a){for(var r=0;r<i&&r<a[s].length;r++){t.call(null,a[s][r])}}};o(function(i){if(i.className&&!i.className.match("js-backfill")||t.getElementsByClassName("js-sponsored hidden").length){i.className=i.className.toString().replace("hidden","")}var a=i.getElementsByClassName("pinterest-list__link");if(a.length){a[0].setAttribute("data-pin-do","buttonPin");var s=a[0].parentNode;s.className=s.className.toString().replace(/\s+hidden/,"");if(!i.getElementsByClassName("js-get_repin_count").length&&i.getElementsByClassName("pinterest-list__pin-count").length){var r=i.getElementsByClassName("pinterest-list__pin-count")[0];var n=r.getAttribute("data-pin-url");var o=document.createElement("script");o.type="text/javascript";o.async=true;o.className="js-get_repin_count";o.src="//api.pinterest.com/v1/urls/count.json?callback=bf_pinterest_referer.set_repin_count&url="+n;r.parentNode.insertBefore(o,r)}}if(typeof window.buildPinterestBtns!="undefined")window.buildPinterestBtns(i)});var l=t.getElementsByClassName("pinterest-list__li hidden");l=Object.keys(l).map(function(t){return l[t]});if(l.length){for(var n=0;n<l.length;n++){if(l[n].className&&l[n].className.match(/js-sponsored|js-backfill/)){l.splice(n,1)}}var u=t.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;if(l.length<u)l=[]}if(!l.length){t.getElementsByClassName("hot-on-pinterest__more")[0].className+=" hidden"}if(bf_pinterest_referer.PAGE_TYPE&&(!bf_pinterest_referer.PAGE_TYPE.match("bpage")||t.getAttribute("data-unit_type")=="bpage_bottom")){t.className=t.className.toString().replace("hidden","")}};this._get_the_promos=function(t){var i={};var a="pinterest_promo";var s=t.getElementsByClassName("pinterest-list__li");s=Object.keys(s).map(function(t){return s[t]});var r=t.getElementsByClassName("js-sponsored");r=Object.keys(r).map(function(t){return r[t]});var n=t.getElementsByClassName("js-backfill");n=Object.keys(n).map(function(t){return n[t]});r=r.concat(n);if(r.length<s.length){var o=[];var l=t.getAttribute("data-promo_per_row")||bf_pinterest_referer.PROMO_PER_ROW;for(var u=s.length-1;u>0&&s.length%l!=0;u--){if(r.indexOf(s[u])==-1){var d=s.splice(u,1);o.push(d[0])}}var c=t.getElementsByClassName("js-sponsored").length;if(o.length>=c){while(o.length&&c>0){s.push(o.pop());c--}}else{var _=l-c;for(var u=s.length-1;u>0&&_>0;u--){if(r.indexOf(s[u])==-1){s.splice(u,1);_--}}}}i[a]=s;return i};this.set_repin_count=function(t){if(t&&t.count&&(t.count=parseInt(t.count))){var i=document.querySelectorAll('div[data-pin-url="'+t.url+'"]');for(var a=0;i[a];a++){var s=i[a];s.innerHTML=t.count.toLocaleString()+" repins"}}};this._loadPinterestScript=function(){if(!BF_STATIC.bf_test_mode){if(typeof window.buildPinterestBtns=="undefined"){var t,i,a=document;i=a.createElement("SCRIPT");i.type="text/javascript";i.async=true;i.setAttribute("data-pin-color","red");i.setAttribute("data-pin-build","buildPinterestBtns");i.src="//assets.pinterest.com/js/pinit.js";t=a.getElementsByTagName("SCRIPT")[0];t.parentNode.insertBefore(i,t)}}else{console.info("disable Dynamically load assets.pinterest.com/js/pinit.js for test mode")}}};bf_pinterest_referer=new BFPinterestReferer;bf_pinterest_referer.init();BF_DID_REGISTER=false;BF_Register=function(){this.highlight_field=new Array;this.ajax=new BF_Request;this.ERR_MISSING_PARAMS="Please complete all fields.";this.ERR_BAD_USERNAME="Your username may only contain letters and numbers.";this.ERR_USERNAME_LENGTH="Your username must be between 3 and 30 characters in length.";this.ERR_PW_LENGTH="Your password must be at least 6 characters in length.";this.ERR_MUST_AGGEE=local.t("You must agree to the Terms of Service in order to register.");this.ERR_PW_MUST_MATCH="Your passwords do not match.";this.ERR_DUP_USERNAME="Sorry, that username is not available. Please try another.";this.ERR_DUP_SITENAME="Sorry, that domain name is not available. Please try another.";this.ERR_BAD_INVITE="Sorry, the invite code you entered is not valid.";this.ERR_DUP_EMAIL="There is already an account with that email address.";this.ERR_FB_DUP_EMAIL="The email address that belongs to your Facebook account has already been used by another BuzzFeed account.";this.BANNED_FB_UID=local.t("You cannot register with that Facebook user.");this.ERR_BAD_EMAIL="You have entered an invalid email address.";this.ERR_NO_ALIASES="Sorry, you don't have enough site aliases left to create a tracked site.";this.ERR=local.t("Sorry, we are unable to process your request at this time.");this.ERR_ALREADY_REGISTERED="You have already registered for an account";this.highlight_field[this.ERR_BAD_USERNAME]="register-username";this.highlight_field[this.ERR_USERNAME_LENGTH]="register-username";this.highlight_field[this.ERR_PW_LENGTH]="register-pw1";this.highlight_field[this.ERR_PW_MUST_MATCH]="register-pw2";this.highlight_field[this.ERR_MUST_AGGEE]="register-agree";this.highlight_field[this.ERR_DUP_USERNAME]="register-username";this.highlight_field[this.ERR_DUP_EMAIL]="bfe";this.highlight_field[this.ERR_BAD_EMAIL]="bfe";this.SUCCESS1="Thanks for registering. We've created your account and saved your post, but before we post it we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br /><br />Your post will appear automatically once you validate.";this.SUCCESS1_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook, created your account and saved your post. ");this.SUCCESS2="Thanks for registering. We've created your account, but before you can vote we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.";this.SUCCESS2_VALIDATED=local.t("Thanks for registering. We've validated your email address with Facebook and created your account. You now can vote.");this.SUCCESS3="<h3>Please Validate Your Email</h3><p>Thanks for registering. We've created your account, but before you can log in we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.</p>";this.SUCCESS3_VALIDATED="<h3>Your Email Has Been Validated</h3><p>"+local.t("Thanks for registering. We've created your account and validated your email address with Facebook. Some of your profile data has been prepopulated with information from your Facebook profile. You can log in now.")+"</p>";this.SUCCESS4="Thanks for registering. We've created your account, but before you can post we need you to validate your email address. We've sent you a confirmation email with instructions. If you don't receive the mail in a few minutes, please check your spam folder.<br/><br/>Once you validate <a id='register_this_page_url' href=''>click here</a> to make a post.";this.SUCCESS4_VALIDATED="Thanks for registering. We've created your account and validated your email address with Facebook.";this.fb_link_handler=function(){var t=function(t){t.stop();$("facebook-login").hide();$("facebook-registration-form").hide();bf_login.switch_to_link_accounts()}.bind(this);if($("fb-link-submit"))$("fb-link-submit").observe("click",t);if($("fb-link-submit2"))$("fb-link-submit2").observe("click",t)};this.fb_register_handler=function(t,i){if(BF_Register.registered_fb_handler)return;BF_Register.registered_fb_handler=true;this.fb_link_handler();if(typeof t=="undefined")t=true;if(i)this.args=i;var a=function(t){t.stop();this.facebook_register()}.bind(this);if($("facebook-registration-form"))$("facebook-registration-form").stopObserving("submit",a);if($("facebook-registration-form"))$("facebook-registration-form").observe("submit",a);if($("fb-register-submig"))$("fb-register-submit").disabled=false;if(t&&$("facebook-registration-form"))$("facebook-registration-form").reset()};this.alias_register_handler=function(t,i){if(BF_Register.alias_registered_handler)return;BF_Register.alias_registered_handler=true;if(typeof t=="undefined")t=true;if(i)this.args=i;var a=function(t){t.stop();this.alias_register()}.bind(this);BF_UserSwitcher.count_aliases(function(t){var i=(new BF_User).getUserInfo();var a=parseInt(i.max_aliases)-parseInt(t.count);if($("alias-sites-left")&&t.success){$("alias-sites-left").update(a);if(a==1)$("alias-sites-left-plural").hide();if(t.unlimited==1)$("alias-count-message").hide();else $("alias-count-message").show();if(a<=0&&i.max_aliases!=0){$("alias-registration-fieldset").hide();$("alias-registration-hit-limit").show()}}});if($("alias-registration-form"))$("alias-registration-form").stopObserving("submit",a);if($("alias-registration-form"))$("alias-registration-form").observe("submit",a);if($("alias-registration-form"))$("alias-register-submit").disabled=false;if(t&&$("alias-registration-form"))$("alias-registration-form").reset()};this.register_handler=function(t,i){if(BF_Register.registered_handler)return;BF_Register.registered_handler=true;if(typeof t=="undefined")t=true;if(i)this.args=i;var a=function(t){t.stop();this.register()}.bind(this);if($("regsitration-form"))$("regsitration-form").stopObserving("submit",a);if($("regsitration-form"))$("regsitration-form").observe("submit",a);if($("register-submit"))$("register-submit").disbaled=false;if(t&&$("regsitration-form"))$("regsitration-form").reset()};this.facebook_register=function(){var t=$F("fb-register-name").strip();var i="get_from_facebook@buzzfeed.com";try{i=facebook.user_data.email}catch(e){}var a=$F("fb-register-username").strip();var s=$F("fb-register-pw1").strip();var r=true;var n=0;var o=$("import_fb_profile_checkbox").checked?"true":"false";if(o=="false")t=a;var l=$("fb-facebook-uid")?$("fb-facebook-uid").value:"";this.username=a;this.password=s;if($("fb-email-me").checked){n=1}var u=function(t){this.response(t)}.bindAsEventListener(this);var d=function(t){this.err(t)}.bindAsEventListener(this);var c={name:t,username:a,pw:s,email:i,contribute:1,allow_email_updates:n,facebook_uid:l,import_fb_profile:o,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:c,onSuccess:u,onFailure:d})};this.alias_register=function(){var t=$("alias-register-username").value.strip();if(!t.match(/^[a-zA-Z0-9]+$/)){this._alias_register({success:0,message:"Site URL must consist of only alphanumeric characters"});return}var i=$("alias-register-display_name").value;if($("alias-registering-status"))$("alias-registering-status").show();if(!t||!i){this._alias_register({success:0,message:"missing username"})}else{BF_UserSwitcher.create_alias({username:t,display_name:i},this._alias_register)}};this._alias_register=function(t){if(t.success==0||t.status!=200){$("alias-message").show();if(t.message.match(/missing username/i)){$("alias-message").update("please fill out all fields")}else if(t.message.match(/logged in/i)){$("alias-message").update("please log in and try again")}else if(t.message.match(/privileges/i)){$("alias-message").update("you don't have permission to create an alias")}else if(t.message.match(/limit/i)){$("alias-message").update("Sorry, but you are over your alias limit")}else if(t.message.match(/username/i)){$("alias-message").update("this site URL already is taken, please select another")}else{$("alias-message").update(t.message)}}else{if($("alias-registration-fieldset"))$("alias-registration-fieldset").hide();if($("alias-registration-creating-site"))$("alias-registration-creating-site").show();BF_UserSwitcher.switchTo(t.userid,function(){})}if($("alias-registering-status"))$("alias-registering-status").hide()};this.register=function(){if($("registering-status"))$("registering-status").show();var t="";var i="";if(typeof this.args=="undefined"){this.args={action:"vote"}}var a=$F("register-name").strip();var s=$F("bfe").strip();var r=$F("register-username").strip();var n=$F("register-pw1").strip();var o=$F("register-pw2").strip();var l=false;var u="";var d="";var c="";var _="";var f=false;if(BF_STATIC.facebook_enabled){c=$("facebook-uid")?$("facebook-uid").value:"";f=$("import_fb_profile_checkbox").checked}if($("register-agree").checked){l=true}if($("email-me").checked){u=1}var p=true;if(!a||!s||!r||!n||!o){this.update_registration_message(this.ERR_MISSING_PARAMS)}else if(!r.match(/^[a-zA-Z0-9]+$/)){this.update_registration_message(this.ERR_BAD_USERNAME)}else if(r.length<3||r.length>30){this.update_registration_message(this.ERR_USERNAME_LENGTH)}else if(n!=o){this.update_registration_message(this.ERR_PW_MUST_MATCH)}else if(!l){this.update_registration_message(this.ERR_MUST_AGGEE)}else if(typeof n=="undefined"||n.length<6){this.update_registration_message(this.ERR_PW_LENGTH)}else if(typeof s=="undefined"||!s.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){this.update_registration_message(this.ERR_BAD_EMAIL)}else if(t=="yoursite.com"||i=="invite code"){this.update_registration_message("Please enter your site's domain.")}else if(t!=""&&!t.match(/\w\.\w/)){this.update_registration_message("Please enter a valid domain for site (example.com).")}else{p=false;this.username=r;this.password=n;var m=function(t){this.response(t)}.bindAsEventListener(this);var h=function(t){this.err(t)}.bindAsEventListener(this);$("register-submit").disbaled=true;var g={name:a,username:r,pw:n,email:s,contribute:1,allow_email_updates:u,facebook_uid:c,location:d,link:_,import_fb_profile:f,registered_from_url:window.location.href,reg_user_agent:navigator.userAgent};new Ajax.Request("/buzzfeed/_contribute_register",{method:"post",parameters:g,onSuccess:m,onFailure:h})}if(p){if($("register-submit"))$("register-submit").disabled=false;$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()}};this.update_registration_message=function(t){if(Prototype.Browser.IE){$("registration-message").innerText=t;$("facebook-registration-message").innerText=t}else{$("registration-message").update(t);$("facebook-registration-message").update(t)}if(this.__error_field){this.__error_field.style.border="1px solid gray";this.__error_field=null}if(this.highlight_field[t]&&$(this.highlight_field[t])){$(this.highlight_field[t]).style.border="1px solid red";this.__error_field=$(this.highlight_field[t])}};this.response=function(t){var i=this.username;var a=this.password;$("registering-status").hide();try{$("register-submit").disbaled=false;obj=JSON.parse(t.responseText);if(!obj||!obj.status){this.err()}else{if(obj.status=="success"){__reg_ok=true;BF_DID_REGISTER=true;$("regsitration-form").reset();if(this.args&&this.args.action=="signin"){if($("contribute-success"))$("contribute-success").hide();if($("registered-success"))$("registered-success").show();if($("registration-div"))$("registration-div").hide();if($("reg-success-message")){var s=this.SUCCESS3;if(obj.user_validated)s=this.SUCCESS3_VALIDATED;$("reg-success-message").update(s);$("reg-success-message").show();if(typeof return_tracker!="undefined")return_tracker.track_goal("register_signin");if(obj.user_validated){var r={username:i,password:a,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:r,onSuccess:function(t){bf_login.loggedIn(t);if(window.location.href.indexOf("/signin")!=-1)window.location.href="/"+i},onFailure:bf_login.err})}}}else if(this.args&&this.args.action=="badge_vote"){if(typeof return_tracker!="undefined")return_tracker.track_goal("register_badge_vote");if(badge_vote_manager&&badge_vote_manager.onRegister){badge_vote_manager.onRegister()}else{if($("registered-vote-success"))$("registered-vote-success").show();if($("registration-div"))$("registration-div").hide()}}else if(this.args&&this.args.action=="contest_entry"){if(typeof return_tracker!="undefined")return_tracker.track_goal("register_contest_entry");if(typeof contest_manager!="undefined"&&contest_manager.onLogin)contest_manager.onLogin()}else if(this.args&&this.args.action=="micosite_submission"){if(typeof return_tracker!="undefined")return_tracker.track_goal("register_microsite");if(typeof picks_controller!="undefined"&&picks_controller.onLogin)picks_controller.onLogin()}else if(this.args&&this.args.onRegister){if(typeof return_tracker!="undefined")return_tracker.track_goal("register");this.args.onRegister(obj)}else{if(typeof return_tracker!="undefined")return_tracker.track_goal("register");if($("contribute-success"))$("contribute-success").hide();if($("registered-success"))$("registered-success").show();if($("registration-div"))$("registration-div").hide();if(bf_contribute&&bf_contribute.type=="image"){var s=this.SUCCESS4;if(obj.user_validated)s=this.SUCCESS4_VALIDATED;if($("reg-success-message"))$("reg-success-message").update(s)}else{var s=this.SUCCESS1;if(obj.user_validated){s=this.SUCCESS1_VALIDATED;if($("please-validate-your-email"))$("please-validate-your-email").update("We Have Validated Your Email");var r={username:i,password:a,contribute:1};new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:r,onSuccess:function(t){bf_login.loggedIn(t,this.args);if(window.location.href.indexOf("/signin")!=-1)window.location.href="/"+i},onFailure:bf_login.err})}if($("reg-success-message"))$("reg-success-message").update(s)}bf_contribute.submit({})}if($("register_this_page_url")){var n=document.location.href;n=n.replace(/#.*/,"");$("register_this_page_url").href=n}}else{var o=true;if(obj.message=="bad beta key"){this.update_registration_message(this.ERR_BETA_KEY)}else if(obj.message=="duplicate username"||obj.message=="url already taken"){this.update_registration_message(this.ERR_DUP_USERNAME)}else if(obj.message=="duplicate site name"){this.update_registration_message(this.ERR_DUP_SITENAME)}else if(obj.message=="Your invite code is not valid."){this.update_registration_message(this.ERR_BAD_INVITE)}else if(obj.message=="duplicate email"){if(facebook.is_logged_in())this.update_registration_message(this.BANNED_FB_UID);else this.update_registration_message(this.ERR_DUP_EMAIL)}else{this.err();o=false}if(o){if($("register-submit"))$("register-submit").disabled=false;$("facebook-registration-message").addClassName("error");
$("facebook-registration-message").show();$("registration-message").addClassName("error");$("registration-message").show()}}}}catch(e){console.dir({e:e});this.err()}};this.err=function(t){$("register-submit").disabled=false;$("facebook-registration-message").update(this.ERR);$("facebook-registration-message").addClassName("error");$("facebook-registration-message").show();$("registration-message").update(this.ERR);$("registration-message").addClassName("error");$("registration-message").show();$("registering-status").hide()};this.redirect_to=function(t){window.location.href=BF_STATIC.web_root+"/"+t};this.form_values=function(t){if(typeof t.pw=="undefined"){if($("register-password").value!=$("register-password").getAttribute("defaultvalue")){t.pw=$("register-password").value}}if(typeof t.username=="undefined"){if(bf_register.signup_page()){if($(signup_page.currentNameBox()).value!=$(signup_page.currentNameBox()).getAttribute("defaultvalue")){t.name=t.username=$(signup_page.currentNameBox()).value}}else{t.name=t.username=$("register-uri-text").value}}if(typeof t.email=="undefined"){if($("register-email").value!=$("register-email").getAttribute("defaultvalue")){t.email=$("register-email").value}}return t};this.create_advertiser_account=function(t){if(!acl.user_can("partners_manage"))return;var i=[];var a={create_advertiser_account:1,pw:t.pw||"",pw2:t.pw||"",name:t.name||t.username||"",username:t.username||"",email:t.email||"",contribute:1};var s=false;var r=new Array("email","username","pw");var n={email:"email",username:"username",pw:"password"};r.each(function(t){if(typeof a[t]!="undefined"&&typeof a[t].strip!="undefined")a[t]=a[t].strip();if(typeof a[t]=="undefined"||a[t]==""){i.push("Missing "+n[t]);if(t=="email")s=true}});if(!s&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){i.push(local.t("Please enter a valid email address"));if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var o=bf_register.currentErrorBox();var l=function(t){i=true;if(o){o.update(t);o.show()}};if(i.length)return l(i.join(", "));if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:a,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(t){var i=JSON.parse(t.responseText);bf_register._new_register(a,i)}})};this.create_contributor_account=function(t){if(!acl.user_can("editors_manage"))return;var i=[];var a={create_contributor_account:1,pw:t.pw||"",pw2:t.pw||"",name:t.name||t.username||"",username:t.username||"",email:t.email||"",contribute:1};var s=false;var r=new Array("email","username","pw");var n={email:"email",username:"username",pw:"password"};r.each(function(t){if(typeof a[t]!="undefined"&&typeof a[t].strip!="undefined")a[t]=a[t].strip();if(typeof a[t]=="undefined"||a[t]==""){i.push("Missing "+n[t]);if(t=="email")s=true}});if(!s&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){i.push("Please enter a valid email address");if($("register-email")){$("register-email").style.border="1px solid red";$("register-email").observe("blur",function(){$("register-email").style.border="1px solid #D9D9D9"})}}var o=bf_register.currentErrorBox();var l=function(t){i=true;if(o){o.update(t);o.show()}};if(i.length)return l(i.join(", "));if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:a,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(t){var i=JSON.parse(t.responseText);bf_register._new_register(a,i)}})};this.newRegisterCallbacks=[];this.new_register=function(t){if(t.create_advertiser_account)return bf_register.create_advertiser_account(t);if(t.create_contributor_account)return bf_register.create_contributor_account(t);if(typeof t.pw2=="undefined")t.pw2=t.pw;if(typeof t.name=="undefined")t.name=t.username;var i=false;var a={username:local.t("Please enter a username."),email:local.t("Please enter a valid email address"),pw:local.t("Please enter a password")};var s=bf_register.currentErrorBox();var r=function(t){i=true;if(s){s.update(t);s.show()}};t=this.form_values(t);var n=new Array("name","email","username","pw");n.each(function(i){if(typeof t[i]!="undefined")t[i]=t[i].strip()});if(t.username=="username"){t.username=""}for(var o in a){if(typeof t[o]=="undefined"||t[o]==""){r(a[o]);break}}if(t.username=="url"){t.username=""}if(t.pw=="password"){t.pw=""}if(t.email=="your@email.com"){t.email=""}if(!i&&!t.email.match(/^([^@]+)@([^\.]+)\.([a-zA-Z])+/)){r("Please enter a valid email address")}if(!i&&(t.username.length<3||t.username.length>30)){r("Please enter a URL between 3 and 30 characters")}if(!i&&t.pw.length<6){r("Your password must have at least 6 characters")}if(!i){if(document.location.search.indexOf("registered_from=")){var l=document.location.search.substring(1);var u=l.split("&");u.each(function(i){var a=i.split("=");if(a[0]=="registered_from"){t.registered_from_url=a[1]}})}if(bf_register.signup_page()){signup_page.toggleSpinner(1)}bf_register.ajax.request("/buzzfeed/_contribute_register",{method:"post",parameters:t,while_processing:{show:"registration-spinner",hide:"new-registration-form"},onSuccess:function(i){var a=JSON.parse(i.responseText);bf_register._new_register(t,a)}})}};this._new_register=function(t,i){if(i.status=="failed")bf_register._error(i);else bf_register._success(t,i)};this._error=function(t){var i={"duplicate email":bf_register.ERR_DUP_EMAIL,"duplicate username":bf_register.ERR_DUP_USERNAME};if($("registration-success-message")){old_msg.hide()}var a=bf_register.currentErrorBox();if(bf_register.signup_page()){signup_page.toggleSpinner(0)}if(a){var s;if(s=t.message.match(/^(.*) at lib/)){t.message=s[1]}a.update(i[t.message]||t.message);a.show()}};this._success=function(t,i){if(bf_register.currentErrorBox()){bf_register.currentErrorBox().hide()}i.user_validated=i.user_validated==true||i.user_validated=="true";if(i.user_validated){var a={username:t.username,password:t.pw,contribute:1};bf_register.dont_switch=i.dont_switch||0;bf_register.ajax.request("/buzzfeed/_www_login",{method:"post",parameters:a,while_processing:{show:"logging-in",hide:"new-registration-form"},onSuccess:function(t){if(bf_register.dont_switch){var i=JSON.parse(t.responseText);bf_register.redirect_to("settings/"+i.username)}else{if(typeof return_tracker!="undefined")return_tracker.track_goal("register");bf_login.loggedIn(t);bf_register.redirect_to("settings?firstTime=true")}}})}else{if(bf_register.signup_page()){signup_page.toggleSpinner(0);signup_page.openDialog("old")}if(typeof return_tracker!="undefined")return_tracker.track_goal("register");var s=$("new-registration-form");var r=$("registration-success-message");if(s)s.hide();if(r)r.show()}if(this.newRegisterCallbacks.length){this.newRegisterCallbacks.each(function(a){a(t,i)})}};this.register_alias=function(t){var i=false;var a=bf_register.currentErrorBox();var s=function(t){i=true;if(a){a.update(t);a.show()}};if(!t.username||t.username.length<3||t.username.length>30){if(bf_register.signup_page()){s("Please enter a username between 3 and 30 characters")}else{s("Please enter a URL between 3 and 30 characters")}}if(!i){if(bf_register.signup_page()){signup_page.toggleSpinner(1)}BF_UserSwitcher.create_alias({username:t.username,display_name:typeof t.name=="undefined"?t.username:t.name},bf_register._register_alias)}};this._register_alias=function(t){if(t.success==0||t.status!=200){bf_register._error({message:t.message||"Unable to create an alias at this time"})}else{BF_UserSwitcher.switchTo(t.userid,function(){window.location.href=BF_STATIC.web_root+"/"+t.username})}};this.signup_page=function(){return BF_STATIC.tt_page=="Signup"?true:false};this.currentErrorBox=function(){return bf_register.signup_page()?$(signup_page.currentErrorBox()):$("registration-error-message")}};if(!window.AJAX_TEST_STATUS)window.AJAX_TEST_STATUS={};var qq=qq||{};qq.extend=function(t,i){for(var a in i){t[a]=i[a]}};qq.indexOf=function(t,i,a){if(t.indexOf)return t.indexOf(i,a);a=a||0;var s=t.length;if(a<0)a+=s;for(;a<s;a++){if(a in t&&t[a]===i){return a}}return-1};qq.getUniqueId=function(){var t=0;return function(){return t++}}();qq.attach=function(t,i,a){if(t.addEventListener){t.addEventListener(i,a,false)}else if(t.attachEvent){t.attachEvent("on"+i,a)}};qq.detach=function(t,i,a){if(t.removeEventListener){t.removeEventListener(i,a,false)}else if(t.attachEvent){t.detachEvent("on"+i,a)}};qq.preventDefault=function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};qq.insertBefore=function(t,i){i.parentNode.insertBefore(t,i)};qq.remove=function(t){t.parentNode.removeChild(t)};qq.contains=function(t,i){if(t==i)return true;if(t.contains){return t.contains(i)}else{return!!(i.compareDocumentPosition(t)&8)}};qq.toElement=function(){var t=document.createElement("div");return function(i){t.innerHTML=i;var a=t.firstChild;t.removeChild(a);return a}}();qq.css=function(t,i){if(i.opacity!=null){if(typeof t.style.opacity!="string"&&typeof t.filters!="undefined"){i.filter="alpha(opacity="+Math.round(100*i.opacity)+")"}}qq.extend(t.style,i)};qq.hasClass=function(t,i){var a=new RegExp("(^| )"+i+"( |$)");return a.test(t.className)};qq.addClass=function(t,i){if(!qq.hasClass(t,i)){t.className+=" "+i}};qq.removeClass=function(t,i){var a=new RegExp("(^| )"+i+"( |$)");t.className=t.className.replace(a," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(t,i){t.innerText=i;t.textContent=i};qq.children=function(t){var i=[],a=t.firstChild;while(a){if(a.nodeType==1){i.push(a)}a=a.nextSibling}return i};qq.getByClass=function(t,i){if(t.querySelectorAll){return t.querySelectorAll("."+i)}var a=[];var s=t.getElementsByTagName("*");var r=s.length;for(var n=0;n<r;n++){if(qq.hasClass(s[n],i)){a.push(s[n])}}return a};qq.ie=function(){"use strict";return navigator.userAgent.indexOf("MSIE")!==-1};qq.ie10=function(){"use strict";return navigator.userAgent.indexOf("MSIE 10")!==-1};qq.obj2url=function(t,i,a){var s=[],r="&",n=function(t,a){var r=i?/\[\]$/.test(i)?i:i+"["+a+"]":a;if(r!="undefined"&&a!="undefined"){s.push(typeof t==="object"?qq.obj2url(t,r,true):Object.prototype.toString.call(t)==="[object Function]"?encodeURIComponent(r)+"="+encodeURIComponent(t()):encodeURIComponent(r)+"="+encodeURIComponent(t))}};if(!a&&i){r=/\?/.test(i)?/\?$/.test(i)?"":"&":"?";s.push(i);s.push(qq.obj2url(t))}else if(Object.prototype.toString.call(t)==="[object Array]"&&typeof t!="undefined"){for(var o=0,l=t.length;o<l;++o){n(t[o],o)}}else if(typeof t!="undefined"&&t!==null&&typeof t==="object"){for(var o in t){n(t[o],o)}}else{s.push(encodeURIComponent(i)+"="+encodeURIComponent(t))}return s.join(r).replace(/^&/,"").replace(/%20/g,"+")};qq.isObject=function(t){"use strict";return t!==null&&t&&typeof t==="object"&&t.constructor===Object};qq.isFunction=function(t){"use strict";return typeof t==="function"};qq.each=function(t,i){"use strict";var a,s;if(t){for(a in t){if(Object.prototype.hasOwnProperty.call(t,a)){s=i(a,t[a]);if(s===false){break}}}}};qq.obj2FormData=function(t,i,a){"use strict";if(!i){i=new FormData}qq.each(t,function(t,s){t=a?a+"["+t+"]":t;if(qq.isObject(s)){qq.obj2FormData(s,i,t)}else if(qq.isFunction(s)){i.append(t,s())}else{i.append(t,s)}});return i};qq.obj2Inputs=function(t,i){"use strict";var a;if(!i){i=document.createElement("form")}qq.obj2FormData(t,{append:function(t,s){a=document.createElement("input");a.setAttribute("name",t);a.setAttribute("value",s);i.appendChild(a)}});return i};var qq=qq||{};qq.FileUploaderBasic=function(t){var i=this;this._options={debug:false,action:"/server/upload",params:{},button:null,multiple:true,maxConnections:3,autoUpload:true,sendAsForm:false,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(t,i){},onProgress:function(t,i,a,s){},onComplete:function(t,i,a){},onCancel:function(t,i){},onValidate:function(t,i,a){},onError:function(t,i,a){},urlHandler:false,messages:{typeError:"{file} has an invalid extension. Permitted file types are {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",onLeave:"The files are being uploaded, if you leave now the upload will be cancelled.",noFiles:"Only files on your computer can be uploaded."},showMessage:function(t){alert(t)}};qq.extend(this._options,t);this._filesInProgress=0;this._storedFiles=[];this._handler=this._createUploadHandler();if(this._options.button){this._button=this._createUploadButton(this._options.button)}this._preventLeaveInProgress()};qq.FileUploaderBasic.prototype={setParams:function(t){this._options.params=t},getInProgress:function(){return this._filesInProgress},uploadStoredFiles:function(){for(var t=0;t<this._storedFiles.length;t++){var i=this._getItemByFileId(this._storedFiles[t]);this._find(i,"spinner").style.display="";this._filesInProgress++;this._handler.upload(this._storedFiles[t],this._options.params)}},clearStoredFiles:function(){this._storedFiles=[];this._options.listElement.innerHTML=""},_createUploadButton:function(t){var i=this;return new qq.UploadButton({element:t,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(a){i._onInputChange(a);i._createUploadButton(t)}})},_createUploadHandler:function(){var t=this,i;if(qq.UploadHandlerXhr.isSupported()){i="UploadHandlerXhr"}else{i="UploadHandlerForm"}var a=new qq[i]({debug:this._options.debug,action:this._options.action,maxConnections:this._options.maxConnections,onProgress:function(i,a,s,r){t._onProgress(i,a,s,r);t._options.onProgress(i,a,s,r)},onComplete:function(i,a,s){t._onComplete(i,a,s);t._options.onComplete(i,a,s)},onCancel:function(i,a){t._onCancel(i,a);t._options.onCancel(i,a)}});return a},_preventLeaveInProgress:function(){var t=this;qq.attach(window,"beforeunload",function(e){if(!t._filesInProgress){return}var e=e||window.event;e.returnValue=t._options.messages.onLeave;return t._options.messages.onLeave})},_onSubmit:function(t,i){this._filesInProgress++},_onProgress:function(t,i,a,s){},_onComplete:function(t,i,a){this._filesInProgress--;if(a.error){this._options.showMessage(a.error)}},_onCancel:function(t,i){this._filesInProgress--},_onInputChange:function(t){if(this._handler instanceof qq.UploadHandlerXhr){this._uploadFileList(t.files)}else{if(this._validateFile(t)){this._uploadFile(t)}}this._button.reset()},_uploadFileList:function(t){var i,a;i=this._getValidationDescriptors(t);if(i.length>1){a=this._options.onValidate(i,true)===false}if(!a){if(typeof t=="undefined"||t.length<1){return false}for(var s=0;s<t.length;s++){if(!this._validateFile(t[s])){return}}for(var s=0;s<t.length;s++){this._uploadFile(t[s])}}},_uploadFile:function(t){var i=this._handler.add(t);var a=this._handler.getName(i);if(this._options.onSubmit(i,a,t)!==false){this._handler._options.action=this._options.action;this._handler._options.sendAsForm=this._options.sendAsForm;this._onSubmit(i,a);if(this._options.autoUpload){this._handler.upload(i,this._options.params)}else{this._filesInProgress--;var s=this._getItemByFileId(i);this._find(s,"spinner").style.display="none";this._storedFiles.push(i)}}},_validateFile:function(t){var i,a,s;i=this._getValidationDescriptor(t);if(this._options.onValidate(i,false,t)===false){return false}if(t.value){a=t.value.replace(/.*(\/|\\)/,"")}else{a=t.fileName!=null?t.fileName:t.name;s=t.fileSize!=null?t.fileSize:t.size}if(!this._isAllowedExtension(a)){this._error("typeError",a);return false}else if(s===0){this._error("emptyError",a);return false}else if(s&&this._options.sizeLimit&&s>this._options.sizeLimit){this._error("sizeError",a);return false}else if(s&&s<this._options.minSizeLimit){this._error("minSizeError",a);return false}return true},_error:function(t,i){var a=this._options.messages[t];function s(t,i){a=a.replace(t,i)}s("{file}",this._formatFileName(i));s("{extensions}",this._options.allowedExtensions.join(", "));s("{sizeLimit}",this._formatSize(this._options.sizeLimit));s("{minSizeLimit}",this._formatSize(this._options.minSizeLimit));this._options.onError(null,i,a);this._options.showMessage(a);if(this._options.onError(a,i)!==false){this._options.onError(a,i)}},_formatFileName:function(t){if(t.length>33){t=t.slice(0,19)+"..."+t.slice(-13)}return t},_isAllowedExtension:function(t){var i=-1!==t.indexOf(".")?t.replace(/.*[.]/,"").toLowerCase():"";var a=this._options.allowedExtensions;if(!a.length){return true}for(var s=0;s<a.length;s++){if(a[s].toLowerCase()==i){return true}}return false},_formatSize:function(t){var i=-1;do{t=t/1024;i++}while(t>99);return Math.max(t,.1).toFixed(1)+["kB","MB","GB","TB","PB","EB"][i]},_parseFileName:function(t){var i;if(t.value){i=t.value.replace(/.*(\/|\\)/,"")}else{i=t.fileName!==null&&t.fileName!==undefined?t.fileName:t.name}return i},_parseFileSize:function(t){var i;if(!t.value){i=t.fileSize!==null&&t.fileSize!==undefined?t.fileSize:t.size}return i},_getValidationDescriptor:function(t){var i,a,s;s={};i=this._parseFileName(t);a=this._parseFileSize(t);s.name=i;if(a){s.size=a}return s},_getValidationDescriptors:function(t){var i,a;a=[];for(i=0;i<t.length;i++){a.push(t[i])}return a}};qq.FileUploader=function(t){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,dropElement:null,listElement:null,skipDropElement:false,skipUploadElement:false,template:'<div class="qq-uploader">'+'<div class="qq-upload-drop-area" style="display:none"><span>Drop files here to upload</span></div>'+'<div type="button" class="qq-upload-button button2 small">Upload Image</div>'+'<ul class="qq-upload-list" style="display:none;"></ul>'+"</div>",fileTemplate:"<li>"+'<span class="qq-upload-file"></span>'+'<span class="qq-upload-spinner loader loader--small"></span>'+'<span class="qq-upload-size"></span>'+'<a class="qq-upload-cancel" href="#">Cancel</a>'+'<span class="qq-upload-failed-text">Failed</span>'+"</li>",classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"},additionalUploadIds:false});qq.extend(this._options,t);this._element=this._options.element;if(!this._options.skipDropTemplate){this._dropElement=this._options.dropElement?this._options.dropElement:this._options.element}if(!this._options.skipUploadTemplate){this._element.innerHTML=this._options.template;this._button=this._createUploadButton(this._find(this._element,"button"))}if(this._options.additionalUploadIds){for(var i=0;i<this._options.additionalUploadIds.length;i++){this._createUploadButton($(this._options.additionalUploadIds[i]))}}this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._bindCancelEvent();if(!this._options.skipDropTemplate)this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);qq.extend(qq.FileUploader.prototype,{_find:function(t,i){var a=qq.getByClass(t,this._options.classes[i])[0];if(!a){throw new Error("element not found "+i)}return a},_setupDragDrop:function(){var t=this,i=this._find(this._dropElement,"drop");var a=new qq.UploadDropZone({element:i,onEnter:function(e){qq.addClass(i,t._classes.dropActive);e.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(e){qq.removeClass(i,t._classes.dropActive)},onDrop:function(e){gtrack.track_events("[ttp]:sidebar/minisuper","drag-n-drop","");var i=qq.getByClass(document,t._options.classes["drop"]);for(var a=0;a<i.length;a++){if(i[a]){qq.removeClass(i[a],t._classes.dropActive);i[a].style.display="none";$$("body")[0].removeClassName("qq-dragging")}}if(t._options.urlHandler&&e.dataTransfer.files.length==0){if(e.dataTransfer.types.indexOf&&-1!=e.dataTransfer.types.indexOf("text/uri-list")||e.dataTransfer.types.contains&&-1!=e.dataTransfer.types.contains("text/uri-list")){var s=e.dataTransfer.getData("text/uri-list");return t._options.urlHandler(e,s)}}t._uploadFileList(e.dataTransfer.files);if($(e.target).descendantOf($("suplist_omnibox_modules"))){gtrack.track_events("[ttp]:edit-item","drag-drop-image")}}});i.style.display="none";i.hide_fn=function(){this.style.display="none";$$("body")[0].removeClassName("qq-dragging")}.bind(i);qq.attach(document,"dragenter",function(e){$$("body")[0].addClassName("qq-dragging");if(!a._isValidFileDrag(e)||i.className.match(/disabled/))return;i.style.display="block"});qq.attach(document,"dragleave",function(e){var t=document.elementFromPoint(e.clientX,e.clientY);if(!t||t.nodeName=="HTML"||t.nodeName=="BODY"){i.hide_fn()}})},_onSubmit:function(t,i){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(t,i)},_onProgress:function(t,i,a,s){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var r=this._getItemByFileId(t);if(!r){var n=t;var o=0;while(!r){n++;o++;if(o>50)break;r=this._getItemByFileId(n)}}var l=this._find(r,"size");l.style.display="inline";var u;if(a!=s){u=Math.round(a/s*100)+"% from "+this._formatSize(s)}else{u=this._formatSize(s)}qq.setText(l,u)},_onComplete:function(t,i,a){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var s=this._getItemByFileId(t);if(!s){var r=t;var n=0;while(!s){r++;n++;if(n>50)break;s=this._getItemByFileId(r)}}qq.remove(this._find(s,"cancel"));qq.remove(this._find(s,"spinner"));if(a.success){qq.addClass(s,this._classes.success)}else{qq.addClass(s,this._classes.fail)}},_addToList:function(t,i){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=t;var s=this._find(a,"file");qq.setText(s,this._formatFileName(i));this._find(a,"size").style.display="none";this._listElement.appendChild(a)},_getItemByFileId:function(t){var i=this._listElement.firstChild;while(i){if(i.qqFileId==t)return i;i=i.nextSibling}},_bindCancelEvent:function(){var t=this,i=this._listElement;if(i){qq.attach(i,"click",function(e){e=e||window.event;var i=e.target||e.srcElement;if(qq.hasClass(i,t._classes.cancel)){qq.preventDefault(e);var a=i.parentNode;t._handler.cancel(a.qqFileId);qq.remove(a)}})}}});qq.UploadDropZone=function(t){this._options={element:null,onEnter:function(e){},onLeave:function(e){},onLeaveNotDescendants:function(e){},onDrop:function(e){}};qq.extend(this._options,t);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};qq.UploadDropZone.prototype={_disableDropOutside:function(e){if(!qq.UploadDropZone.dropOutsideDisabled){qq.attach(document,"dragover",function(e){if(e.dataTransfer){e.dataTransfer.dropEffect="none";e.preventDefault()}});qq.UploadDropZone.dropOutsideDisabled=true}},_attachEvents:function(){var t=this;qq.attach(t._element,"dragover",function(e){if(!t._isValidFileDrag(e))return;var i=e.dataTransfer.effectAllowed;if(i=="move"||i=="linkMove"){e.dataTransfer.dropEffect="move"}else{e.dataTransfer.dropEffect="copy"}e.stopPropagation();e.preventDefault()});qq.attach(t._element,"dragenter",function(e){if(!t._isValidFileDrag(e))return;t._options.onEnter(e)});qq.attach(t._element,"dragleave",function(e){if(!t._isValidFileDrag(e))return;t._options.onLeave(e);var i=document.elementFromPoint(e.clientX,e.clientY);if(qq.contains(this,i))return;t._options.onLeaveNotDescendants(e)});qq.attach(t._element,"drop",function(e){if(!t._isValidFileDrag(e))return;e.preventDefault();t._options.onDrop(e)})},_isValidFileDrag:function(e){if(qq.ie()&&!qq.ie10()){return false}var t=e.dataTransfer,i=navigator.userAgent.indexOf("AppleWebKit")>-1;return t&&t.effectAllowed!="none"&&(t.files||!i&&t.types&&t.types.contains&&t.types.contains("Files"))}};qq.UploadButton=function(t){this._options={element:null,multiple:false,name:"file",onChange:function(t){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,t);this._element=this._options.element;qq.css(this._element,{position:"relative"});this._input=this._createInput()};qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){if(this._input.parentNode){qq.remove(this._input)}qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var t=$(this._element).down("input[type=file]");if(t){return t}var i=document.createElement("input");if(this._options.multiple){i.setAttribute("multiple","multiple")}i.setAttribute("type","file");i.setAttribute("name",this._options.name);i.setAttribute("rel:gt_act","ignore");qq.css(i,{position:"absolute",right:0,top:0,fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0,width:"100%",height:"100%"});i.addClassName("file_mask");this._element.appendChild(i);var a=this;qq.attach(i,"change",function(){a._options.onChange(i)});qq.attach(i,"mouseover",function(){qq.addClass(a._element,a._options.hoverClass)});qq.attach(i,"mouseout",function(){qq.removeClass(a._element,a._options.hoverClass)});qq.attach(i,"focus",function(){qq.addClass(a._element,a._options.focusClass)});qq.attach(i,"blur",function(){qq.removeClass(a._element,a._options.focusClass)});if(window.attachEvent){i.setAttribute("tabIndex","-1")}return i}};qq.UploadHandlerAbstract=function(t){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(t,i,a,s){},onComplete:function(t,i,a){},onCancel:function(t,i){}};qq.extend(this._options,t);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(t){if(this._options.debug&&window.console)console.log("[uploader] "+t)},add:function(t){},upload:function(t,i){var a=this._queue.push(t);var s={};qq.extend(s,i);this._params[t]=s;if(a<=this._options.maxConnections){this._upload(t,this._params[t])}},cancel:function(t){this._cancel(t);this._dequeue(t)},cancelAll:function(){for(var t=0;t<this._queue.length;t++){this._cancel(this._queue[t])}this._queue=[]},getName:function(t){},getSize:function(t){},getQueue:function(){return this._queue},_upload:function(t){},_cancel:function(t){},_dequeue:function(t){var i=qq.indexOf(this._queue,t);this._queue.splice(i,1);var a=this._options.maxConnections;if(this._queue.length>=a&&i<a){var s=this._queue[a-1];this._upload(s,this._params[s])}}};qq.UploadHandlerForm=function(t){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerForm.prototype,{add:function(t){t.setAttribute("name","image");var i="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[i]=t;if(t.parentNode){qq.remove(t)}return i},getName:function(t){return this._inputs[t].value.replace(/.*(\/|\\)/,"")},_cancel:function(t){this._options.onCancel(t,this.getName(t));delete this._inputs[t];var i=document.getElementById(t);if(i){i.setAttribute("src","javascript:false;");qq.remove(i)}},_upload:function(t,i){var a=this._inputs[t];if(!a){throw new Error("file with passed id was not added, or already uploaded or cancelled")}var s=this.getName(t);var r=this._createIframe(t);var n=this._createForm(r,i);n.appendChild(a);var o=this;this._attachLoadEvent(r,function(){o.log("iframe loaded");var i=o._getIframeContentJSON(r);o._options.onComplete(t,s,i);o._dequeue(t);delete o._inputs[t];setTimeout(function(){qq.remove(r)},1)});n.submit();qq.remove(n);return t},_attachLoadEvent:function(t,i){qq.attach(t,"load",function(){if(!t.parentNode){return}try{if(t.contentDocument&&t.contentDocument.body&&t.contentDocument.body.innerHTML=="false"){return}}catch(e){}i()})},_getIframeContentJSON:function(t){try{var i=t.contentDocument?t.contentDocument:t.contentWindow.document,a;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+i.body.innerHTML);try{a=JSON.parse(i.body.innerHTML)}catch(s){a={}}}catch(e){a={success:false}}return a},_createIframe:function(t){var i=qq.toElement('<iframe src="javascript:false;" name="'+t+'" />');i.setAttribute("id",t);i.style.display="none";document.body.appendChild(i);return i},_createForm:function(t,i){var a=qq.toElement('<form method="post" enctype="multipart/form-data"></form>');qq.obj2Inputs(i,a);a.setAttribute("action",this._options.action);a.setAttribute("target",t.name);a.style.display="none";document.body.appendChild(a);return a}});qq.UploadHandlerXhr=function(t){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){try{var t=document.createElement("input");t.type="file";var i=false;var a=navigator.userAgent.toLowerCase();if(a.indexOf("safari")!=-1){i=true;if(a.indexOf("chrome")>-1){i=false}}var s=typeof FileReader!="undefined"&&typeof(new FileReader).readAsBinaryString=="undefined";return"multiple"in t&&typeof File!="undefined"&&typeof(new XMLHttpRequest).upload!="undefined"&&typeof FileReader!="undefined"&&typeof window.WebKitBlobBuilder=="undefined"&&!i&&!s}catch(e){console.error(e);return false}};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(t){if(!(t instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(t)-1},getName:function(t){var i=this._files[t];return i.fileName!=null?i.fileName:i.name},getSize:function(t){var i=this._files[t];return i.fileSize!=null?i.fileSize:i.size},getLoaded:function(t){return this._loaded[t]||0},_upload:function(t,i){var a=this._files[t],s=this.getName(t),r=this.getSize(t);this._loaded[t]=0;var n=this._xhrs[t]=new XMLHttpRequest;var o=this;var l=(new Date).getTime();n.upload.onprogress=function(e){if(e.lengthComputable){o._loaded[t]=e.loaded;o._options.onProgress(t,s,e.loaded,e.total)}};n.onreadystatechange=function(){if(n.readyState==4){try{if(BF_Request&&qp_superlist){var i=/\.gif/.test(s)?"gif":"image";var a=(new Date).getTime()-l;BF_Request.statsd.timer("superposter.image.client."+i+"_upload",a);BF_Request.statsd.timer("superposter.image.client.upload",a)}}catch(r){}o._onComplete(t,n)}};i=i||{};var u=qq.obj2url(i,this._options.action);n.open("POST",u,true);if(this._options.sendAsForm){try{if(typeof XMLHttpRequest.prototype.sendAsBinary=="undefined"){XMLHttpRequest.prototype.sendAsBinary=function(t){var i=new ArrayBuffer(t.length);var a=new Uint8Array(i,0);for(var s=0;s<t.length;s++)a[s]=t.charCodeAt(s)&255;this.send(a)}}}catch(e){console.error(e)}var d="---------------------------";d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);d+=Math.floor(Math.random()*32768);var c=new FileReader;c.readAsBinaryString(a);c.onload=function(t){i["Filedata"]=c.result;i["Filename"]=encodeURIComponent(a.name);var s="";$H(i).each(function(t){if(s!="")s+="\r\n";s+="--"+d+"\r\n"+'Content-Disposition: form-data; charset: utf-8; accept-charset: utf-8; name="'+t.key+'"';if(t.key=="Filedata")s+='; filename="'+encodeURIComponent(a.name)+'"\r\nContent-Type: application/octet-stream';s+="\r\n\r\n"+t.value});s+="\r\n";s+="--"+d+"--\r\n";n.setRequestHeader("Content-Type","multipart/form-data; charset: utf-8; accept-charset: utf-8; boundary="+d);n.sendAsBinary(s)}}else{n.setRequestHeader("X-Requested-With","XMLHttpRequest");n.setRequestHeader("X-File-Name",encodeURIComponent(s));n.setRequestHeader("X-Filesize-On-Client",r);n.setRequestHeader("Content-Type","application/octet-stream");n.send(a)}},_onComplete:function(t,i){if(!this._files[t])return;var a=this._xhrs[t];if(BF_STATIC.bf_env==="dev"&&BF_STATIC.bf_test_mode){var s=window.AJAX_TEST_STATUS[this._options.action];if(!s)s=new RequestStack;var r={xhr_request:a};r.status=i.status;if(s.push)s.push(r);else if(s.stack&&s.stack.push)s.stack.push(r);window.AJAX_TEST_STATUS[this._options.action]=s}var n=this.getName(t);var o=this.getSize(t);this._options.onProgress(t,n,o,o);if(i.status==200){this.log("xhr - server response received");this.log("responseText = "+i.responseText);
var l;try{l=JSON.parse(i.responseText)}catch(u){l={}}try{if(acl.user_can("general_admin")&&l.uploaded&&(l.uploaded==="false"||l.uploaded===false)&&l.filesize_on_server){(new Image).src="/buzzfeed/_error_logger?z="+(new Date).getTime()+"&error="+encodeURIComponent(JSON.stringify(l))}}catch(u){console.dir(u)}this._options.onComplete(t,n,l)}else{this._options.onComplete(t,n,{})}this._files[t]=null;this._xhrs[t]=null;this._dequeue(t)},_cancel:function(t){this._options.onCancel(t,this.getName(t));this._files[t]=null;if(this._xhrs[t]){this._xhrs[t].abort();this._xhrs[t]=null}}});var audioplayer_swfobject=function(){var t="undefined",i="object",a="Shockwave Flash",s="ShockwaveFlash.ShockwaveFlash",r="application/x-shockwave-flash",n="SWFObjectExprInst",o="onreadystatechange",l=window,u=document,d=navigator,c=false,_=[I],f=[],p=[],m=[],h,g,b,v,w=false,y=false,k,z,T=true,E=function(){var n=typeof u.getElementById!=t&&typeof u.getElementsByTagName!=t&&typeof u.createElement!=t,o=d.userAgent.toLowerCase(),_=d.platform.toLowerCase(),f=_?/win/.test(_):/win/.test(o),p=_?/mac/.test(_):/mac/.test(o),m=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,h=!+"1",g=[0,0,0],b=null;if(typeof d.plugins!=t&&typeof d.plugins[a]==i){b=d.plugins[a].description;if(b&&!(typeof d.mimeTypes!=t&&d.mimeTypes[r]&&!d.mimeTypes[r].enabledPlugin)){c=true;h=false;b=b.replace(/^.*\s+(\S+\s+\S+$)/,"$1");g[0]=parseInt(b.replace(/^(.*)\..*$/,"$1"),10);g[1]=parseInt(b.replace(/^.*\.(.*)\s.*$/,"$1"),10);g[2]=/[a-zA-Z]/.test(b)?parseInt(b.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof l.ActiveXObject!=t){try{var v=new ActiveXObject(s);if(v){b=v.GetVariable("$version");if(b){h=true;b=b.split(" ")[1].split(",");g=[parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10)]}}}catch(e){}}return{w3:n,pv:g,wk:m,ie:h,win:f,mac:p}}(),S=function(){if(!E.w3){return}if(typeof u.readyState!=t&&u.readyState=="complete"||typeof u.readyState==t&&(u.getElementsByTagName("body")[0]||u.body)){C()}if(!w){if(typeof u.addEventListener!=t){u.addEventListener("DOMContentLoaded",C,false)}if(E.ie&&E.win){u.attachEvent(o,function(){if(u.readyState=="complete"){u.detachEvent(o,arguments.callee);C()}});if(l==top){(function(){if(w){return}try{u.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()})()}}if(E.wk){(function(){if(w){return}if(!/loaded|complete/.test(u.readyState)){setTimeout(arguments.callee,0);return}C()})()}N(C)}}();function C(){if(w){return}try{var t=u.getElementsByTagName("body")[0].appendChild(H("span"));t.parentNode.removeChild(t)}catch(e){return}w=true;var i=_.length;for(var a=0;a<i;a++){_[a]()}}function A(t){if(w){t()}else{_[_.length]=t}}function N(i){if(typeof l.addEventListener!=t){l.addEventListener("load",i,false)}else if(typeof u.addEventListener!=t){u.addEventListener("load",i,false)}else if(typeof l.attachEvent!=t){V(l,"onload",i)}else if(typeof l.onload=="function"){var a=l.onload;l.onload=function(){a();i()}}else{l.onload=i}}function I(){if(c){B()}else{q()}}function B(){var a=u.getElementsByTagName("body")[0];var s=H(i);s.setAttribute("type",r);var n=a.appendChild(s);if(n){var o=0;(function(){if(typeof n.GetVariable!=t){var i=n.GetVariable("$version");if(i){i=i.split(" ")[1].split(",");E.pv=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}a.removeChild(s);n=null;q()})()}else{q()}}function q(){var i=f.length;if(i>0){for(var a=0;a<i;a++){var s=f[a].id;var r=f[a].callbackFn;var n={success:false,id:s};if(E.pv[0]>0){var o=D(s);if(o){if(W(f[a].swfVersion)&&!(E.wk&&E.wk<312)){Y(s,true);if(r){n.success=true;n.ref=x(s);r(n)}}else if(f[a].expressInstall&&F()){var l={};l.data=f[a].expressInstall;l.width=o.getAttribute("width")||"0";l.height=o.getAttribute("height")||"0";if(o.getAttribute("class")){l.styleclass=o.getAttribute("class")}if(o.getAttribute("align")){l.align=o.getAttribute("align")}var u={};var d=o.getElementsByTagName("param");var c=d.length;for(var _=0;_<c;_++){if(d[_].getAttribute("name").toLowerCase()!="movie"){u[d[_].getAttribute("name")]=d[_].getAttribute("value")}}O(l,u,s,r)}else{U(o);if(r){r(n)}}}}else{Y(s,true);if(r){var p=x(s);if(p&&typeof p.SetVariable!=t){n.success=true;n.ref=p}r(n)}}}}}function x(a){var s=null;var r=D(a);if(r&&r.nodeName=="OBJECT"){if(typeof r.SetVariable!=t){s=r}else{var n=r.getElementsByTagName(i)[0];if(n){s=n}}}return s}function F(){return!y&&W("6.0.65")&&(E.win||E.mac)&&!(E.wk&&E.wk<312)}function O(i,a,s,r){y=true;b=r||null;v={success:false,id:s};var o=D(s);if(o){if(o.nodeName=="OBJECT"){h=R(o);g=null}else{h=o;g=s}i.id=n;if(typeof i.width==t||!/%$/.test(i.width)&&parseInt(i.width,10)<310){i.width="310"}if(typeof i.height==t||!/%$/.test(i.height)&&parseInt(i.height,10)<137){i.height="137"}u.title=u.title.slice(0,47)+" - Flash Player Installation";var d=E.ie&&E.win?"ActiveX":"PlugIn",c="MMredirectURL="+l.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+u.title;if(typeof a.flashvars!=t){a.flashvars+="&"+c}else{a.flashvars=c}if(E.ie&&E.win&&o.readyState!=4){var _=H("div");s+="SWFObjectNew";_.setAttribute("id",s);o.parentNode.insertBefore(_,o);o.style.display="none";(function(){if(o.readyState==4){o.parentNode.removeChild(o)}else{setTimeout(arguments.callee,10)}})()}L(i,a,s)}}function U(t){if(E.ie&&E.win&&t.readyState!=4){var i=H("div");t.parentNode.insertBefore(i,t);i.parentNode.replaceChild(R(t),i);t.style.display="none";(function(){if(t.readyState==4){t.parentNode.removeChild(t)}else{setTimeout(arguments.callee,10)}})()}else{t.parentNode.replaceChild(R(t),t)}}function R(t){var a=H("div");if(E.win&&E.ie){a.innerHTML=t.innerHTML}else{var s=t.getElementsByTagName(i)[0];if(s){var r=s.childNodes;if(r){var n=r.length;for(var o=0;o<n;o++){if(!(r[o].nodeType==1&&r[o].nodeName=="PARAM")&&!(r[o].nodeType==8)){a.appendChild(r[o].cloneNode(true))}}}}}return a}function L(a,s,n){var o,l=D(n);if(E.wk&&E.wk<312){return o}if(l){if(typeof a.id==t){a.id=n}if(E.ie&&E.win){var u="";for(var d in a){if(a[d]!=Object.prototype[d]){if(d.toLowerCase()=="data"){s.movie=a[d]}else if(d.toLowerCase()=="styleclass"){u+=' class="'+a[d]+'"'}else if(d.toLowerCase()!="classid"){u+=" "+d+'="'+a[d]+'"'}}}var c="";for(var _ in s){if(s[_]!=Object.prototype[_]){c+='<param name="'+_+'" value="'+s[_]+'" />'}}l.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+u+">"+c+"</object>";p[p.length]=a.id;o=D(a.id)}else{var f=H(i);f.setAttribute("type",r);for(var m in a){if(a[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){f.setAttribute("class",a[m])}else if(m.toLowerCase()!="classid"){f.setAttribute(m,a[m])}}}for(var h in s){if(s[h]!=Object.prototype[h]&&h.toLowerCase()!="movie"){j(f,h,s[h])}}l.parentNode.replaceChild(f,l);o=f}}return o}function j(t,i,a){var s=H("param");s.setAttribute("name",i);s.setAttribute("value",a);t.appendChild(s)}function M(t){var i=D(t);if(i&&i.nodeName=="OBJECT"){if(E.ie&&E.win){i.style.display="none";(function(){if(i.readyState==4){P(t)}else{setTimeout(arguments.callee,10)}})()}else{i.parentNode.removeChild(i)}}}function P(t){var i=D(t);if(i){for(var a in i){if(typeof i[a]=="function"){i[a]=null}}i.parentNode.removeChild(i)}}function D(t){var i=null;try{i=u.getElementById(t)}catch(e){}return i}function H(t){return u.createElement(t)}function V(t,i,a){t.attachEvent(i,a);m[m.length]=[t,i,a]}function W(t){var i=E.pv,a=t.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return i[0]>a[0]||i[0]==a[0]&&i[1]>a[1]||i[0]==a[0]&&i[1]==a[1]&&i[2]>=a[2]?true:false}function G(a,s,r,n){if(E.ie&&E.mac){return}var o=u.getElementsByTagName("head")[0];if(!o){return}var l=r&&typeof r=="string"?r:"screen";if(n){k=null;z=null}if(!k||z!=l){var d=H("style");d.setAttribute("type","text/css");d.setAttribute("media",l);k=o.appendChild(d);if(E.ie&&E.win&&typeof u.styleSheets!=t&&u.styleSheets.length>0){k=u.styleSheets[u.styleSheets.length-1]}z=l}if(E.ie&&E.win){if(k&&typeof k.addRule==i){k.addRule(a,s)}}else{if(k&&typeof u.createTextNode!=t){k.appendChild(u.createTextNode(a+" {"+s+"}"))}}}function Y(t,i){if(!T){return}var a=i?"visible":"hidden";if(w&&D(t)){D(t).style.visibility=a}else{G("#"+t,"visibility:"+a)}}function J(i){var a=/[\\\"<>\.;]/;var s=a.exec(i)!=null;return s&&typeof encodeURIComponent!=t?encodeURIComponent(i):i}var X=function(){if(E.ie&&E.win){window.attachEvent("onunload",function(){var t=m.length;for(var i=0;i<t;i++){m[i][0].detachEvent(m[i][1],m[i][2])}var a=p.length;for(var s=0;s<a;s++){M(p[s])}for(var r in E){E[r]=null}E=null;for(var n in audioplayer_swfobject){audioplayer_swfobject[n]=null}audioplayer_swfobject=null})}}();return{registerObject:function(t,i,a,s){if(E.w3&&t&&i){var r={};r.id=t;r.swfVersion=i;r.expressInstall=a;r.callbackFn=s;f[f.length]=r;Y(t,false)}else if(s){s({success:false,id:t})}},getObjectById:function(t){if(E.w3){return x(t)}},embedSWF:function(a,s,r,n,o,l,u,d,c,_){var f={success:false,id:s};if(E.w3&&!(E.wk&&E.wk<312)&&a&&s&&r&&n&&o){Y(s,false);A(function(){r+="";n+="";var p={};if(c&&typeof c===i){for(var m in c){p[m]=c[m]}}p.data=a;p.width=r;p.height=n;var h={};if(d&&typeof d===i){for(var g in d){h[g]=d[g]}}if(u&&typeof u===i){for(var b in u){if(typeof h.flashvars!=t){h.flashvars+="&"+b+"="+u[b]}else{h.flashvars=b+"="+u[b]}}}if(W(o)){var v=L(p,h,s);if(p.id==s){Y(s,true)}f.success=true;f.ref=v}else if(l&&F()){p.data=l;O(p,h,s,_);return}else{Y(s,true)}if(_){_(f)}})}else if(_){_(f)}},switchOffAutoHideShow:function(){T=false},ua:E,getFlashPlayerVersion:function(){return{major:E.pv[0],minor:E.pv[1],release:E.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(t,i,a){if(E.w3){return L(t,i,a)}else{return undefined}},showExpressInstall:function(t,i,a,s){if(E.w3&&F()){O(t,i,a,s)}},removeSWF:function(t){if(E.w3){M(t)}},createCSS:function(t,i,a,s){if(E.w3){G(t,i,a,s)}},addDomLoadEvent:A,addLoadEvent:N,getQueryParamValue:function(t){var i=u.location.search||u.location.hash;if(i){if(/\?/.test(i)){i=i.split("?")[1]}if(t==null){return J(i)}var a=i.split("&");for(var s=0;s<a.length;s++){if(a[s].substring(0,a[s].indexOf("="))==t){return J(a[s].substring(a[s].indexOf("=")+1))}}}return""},expressInstallCallback:function(){if(y){var t=D(n);if(t&&h){t.parentNode.replaceChild(h,t);if(g){Y(g,true);if(E.ie&&E.win){h.style.display="block"}}if(b){b(v)}}y=false}}}}();var AudioPlayer=function(){var t=[];var i={};var a={};var s="";var r={};var n=-1;var o="9";function l(t){if(document.all&&!window[t]){for(var i=0;i<document.forms.length;i++){if(document.forms[i][t]){return document.forms[i][t];break}}}return document.all?window[t]:document[t]}function u(t,i,a){l(t).addListener(i,a)}return{setup:function(t,i){s=t;r=i;if(audioplayer_swfobject.hasFlashPlayerVersion(o)){audioplayer_swfobject.switchOffAutoHideShow();audioplayer_swfobject.createCSS("p.audioplayer_container span","visibility:hidden;height:24px;overflow:hidden;padding:0;border:none;")}},getPlayer:function(t){return l(t)},addListener:function(t,i,a){u(t,i,a)},embed:function(a,n){var l={};var u;var d={};var c={};var _={};for(u in r){l[u]=r[u]}for(u in n){l[u]=n[u]}if(l.transparentpagebg=="yes"){d.bgcolor="#FFFFFF";d.wmode="transparent"}else{if(l.pagebg){d.bgcolor="#"+l.pagebg}d.wmode="opaque"}d.menu="false";for(u in l){if(u=="pagebg"||u=="width"||u=="transparentpagebg"){continue}c[u]=l[u]}_.name=a;_.style="outline: none";c.playerID=a;audioplayer_swfobject.embedSWF(s,a,l.width.toString(),"24",o,false,c,d,_);t.push(a);if(n.group){i[a]=n.group}},syncVolumes:function(a,s){if(i[a])return;n=s;for(var r=0;r<t.length;r++){if(!i[t[r]]&&t[r]!=a){l(t[r]).setVolume(n)}}},activate:function(t,s){for(var r in a){if(r==t){continue}if(i[t]!=i[r]){this.close(r);continue}if(!(i[t]||i[r])){this.close(r)}}a[t]=1},load:function(t,i,a,s){l(t).load(i,a,s)},close:function(t){l(t).close();if(t in a){delete a[t]}},open:function(t,i){if(i==undefined){i=1}l(t).open(i==undefined?0:i-1)},getVolume:function(t){return n}}}();var BF_GplusSignin=function(){this.callback=function(t){if(!t["status"]["signed_in"]){return}else if(t["status"]["signed_in"]){new Ajax.Request("/buzzfeed/_www_login",{method:"post",parameters:{googleplus:"1",otc:t["code"]},onSuccess:function(t){gplus._result(t)},onFailure:function(t){return}})}};this._result=function(t){var i=JSON.parse(t.responseText),a=new BF_User,s=BF_STATIC.language||"en",r,n;if(i.username.match("[^A-Za-z0-9]"))i.username=i.username.replace(i.username.match("[^A-Za-z0-9]")[0],"");if(!a.isLoggedIn()&&i.login=="false"&&i.username&&i.password){n={name:i.username,username:i.username.replace(/\W/g,""),pw:i.password,email:i.email,contribute:"1",allow_email_updates:"1",googleplus_uid:i.googleplus_uid,import_fb_profile:"false",language:i.language||s,googleplus_image:i.googleplus_image,display_name:i.display_name};bf_register.new_register(n)}else if(i.login=="true"){gplus.login(i)}};this.login=function(t){if(t&&t.username){BFW_Util.saveEarnedReactions({value:t});bf_login.cookieLogin()}}};var BF_UserSwitcher={controller:"/buzzfeed/_switch",template:'<li><a href="" onclick="return false" class="switch-to-user" rel:id="#{id}"><div class="default_user #{default_div}"><svg width="25" height="25" viewbox="0 0 512 512"><use xlink:href="#icon-user-avatar"></use></svg></div><img src="#{root}#{image}" class="#{user_img}"/>#{display_name}</a></li>',template_bottom_div:'<li class="#{hl}"><a href="" onclick="return false" rel:username="#{username}"><span class="list-username" rel:username="#{username}">#{username}</span> #{display_name}</a><span class="hl chosen"></span></li>',latest_switch_list:[],latest_switch_list_loaded:false,was_ajax:false,switcher:null,bottom_warning_div:null,bottom_warning_select:null,is_user_switcher:false,selected_user:null,init:function(t){try{if(!acl.user_can("general_admin"))return false;if(t!=null)BF_UserSwitcher.selected_user=t;if(BF_UserSwitcher.is_user_switcher){BF_UserSwitcher.apply_visibility();return false}BF_UserSwitcher.switcher=$("quickpost-user-switcher");if(BF_UserSwitcher.switcher)BF_UserSwitcher.is_user_switcher=true;BF_UserSwitcher.apply_visibility();if(acl.user_can("general_admin")){BF_UserSwitcher._switch_list_ui([""],"bottom");universal_dom.get_bucket_elements("switch_users").each(function(t){var i=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.observe("click",function(){if(i.style.display=="block")return false;i.style.display="block";universal_dom.get_bucket_elements("switch_user_dialog").each(function(t){t.update("Loading...")});BF_UserSwitcher.getSwitchList(BF_UserSwitcher._switch_list_ui,"bottom",true)});Event.observe(window,"click",function(e){if(!$(e.target).childOf||!$(e.target).childOf(BF_UserSwitcher.switcher)){i.style.display="none"}})})}}catch(e){console.error(e)}},apply_visibility:function(){try{if(!BF_UserSwitcher.is_user_switcher)return false;var t=(new BF_User).getUserInfo();if(BF_UserSwitcher.selected_user==null){if(typeof edit_post!="undefined"){BF_UserSwitcher.selected_user=edit_post.buzz.username}else{BF_UserSwitcher.selected_user=t.username;$$(".switched-display_name").each(function(i){if(i.hasClassName("bottom_display_name"))i.update(t.display_name)})}}if(acl.user_can("general_admin")){var i;if(typeof edit_post!="undefined")i=edit_post.buzz.username;else i=t.default_user.username}else{BF_UserSwitcher.switcher.style.display="none"}}catch(e){console.error(e)}},sw_bottom_div:function(e){try{e.stop();var t=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.select("li a").each(function(t){if(e.target==t||e.target.parentNode==t){BF_UserSwitcher.selected_user=t.getAttribute("rel:username");t.parentNode.addClassName("hl");superlist_bylines.set_add_bylines(BF_UserSwitcher.selected_user,true);universal_dom.get_bucket_elements("switch_user_dialog")[0].hide()}else t.parentNode.removeClassName("hl")});BF_UserSwitcher.apply_visibility()}catch(e){console.error(e)}},fill_switch_div:function(t){try{if(!BF_UserSwitcher.is_user_switcher)return false;var i=new Template(BF_UserSwitcher.template_bottom_div);var a="<ul>";var s=(new BF_User).getUserInfo();u=s.default_user;t.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:u.image,userid:u.userid});if(typeof edit_post!="undefined")t.unshift({display_name:decodeURIComponent(edit_post.buzz.user_displayname.unescapeHTML()),not_user:true,username:edit_post.buzz.username,image:edit_post.buzz.user_image,userid:edit_post.buzz.userid});t.each(function(t){if(t.p_disable_quickpost=="1")return false;if(typeof edit_post!="undefined"&&t.username==edit_post.buzz.username&&!t.not_user)return false;var s=BF_UserSwitcher.selected_user==t.username?true:false;a+=i.evaluate({display_name:t.display_name,username:t.username,hl:s?"hl":""})});var t=BF_UserSwitcher.switcher.select(".switch_user_list")[0];t.update(a+"</ul>");t.select("ul a").each(function(t){t.observe("click",BF_UserSwitcher.sw_bottom_div)})}catch(e){console.error(e)}},switch_callback:function(){try{var t=(new BF_User).getUserInfo();if(typeof edit_post=="undefined"){if(BF_UserSwitcher.is_user_switcher)BF_UserSwitcher.selected_user=t.username;$$(".switched-display_name").each(function(i){i.update(t.display_name)})}else{$$(".switched-display_name").each(function(i){if(!i.hasClassName("bottom_display_name"))i.update(t.display_name)})}if(t.p_disable_quickpost=="true"){BF_Request.location({reload_track:true});return false}if(BF_UserSwitcher.is_user_switcher){var i=BF_UserSwitcher.switcher.select(".switch_user_list")[0];i.style.display="none";BF_UserSwitcher.apply_visibility()}}catch(e){console.error(e)}},swfunction:function(e){try{e.stop();var t=e.target.getAttribute("rel:id");BF_UserSwitcher.switchTo(t,BF_UserSwitcher.switch_callback)}catch(e){console.error(e)}},switch_list_ui:function(e){try{if(typeof e.stop!=="boolean")e.stop();if($("switch-list-spinner"))$("switch-list-spinner").show();this.getSwitchList(BF_UserSwitcher._switch_list_ui,"top")}catch(e){console.error(e)}},_switch_list_ui:function(t,i,a){if(!$("usernav-switch-list"))return;try{if(a&&BF_UserSwitcher.is_user_switcher){var s=t.slice(0);BF_UserSwitcher.fill_switch_div(s)}var r=(new BF_User).getUserInfo();var n=new Template(BF_UserSwitcher.template);var o='<a class="close_switch_list_ui" href="javascript:;" onclick="BF_UserSwitcher.hide_switch_list_ui();return false;"><div class="closeBtn">x</div></a><ul>';var l=typeof r.default_user.image=="undefined"||r.default_user_image==null?"":r.default_user.image;var u=l==null||l==""?"":"hidden";var d=l==null||l==""?"hidden":"";t.unshift({image:decodeURIComponent(l.unescapeHTML()),display_name:decodeURIComponent(r.default_user.display_name.unescapeHTML()),userid:r.default_user.userid});t.each(function(t){if(typeof t.image=="undefined"||t.image==""||t.image==null){u="";d="hidden"}else{u="hidden";d=""}o+=n.evaluate({image:t.image||trans_gif_1x1_base64,display_name:t.display_name,id:t.userid,root:BF_STATIC.image_root,default_div:u,user_img:d})});if(r.p_alias=="true"||typeof r.default_user!="undefined"&&r.default_user.p_alias=="true"){o+='<li><a href="'+BF_STATIC.web_root+'/signup"><span class="microsite-new logo">+ </br></span><span class="microsite-new text"><i>Create Another BuzzFeed</i></span></a></li>'}$("usernav-switch-list").update(o+"</ul>");if(i=="top"){$("usernav-switch-list").show();if($("switch-list-spinner"))$("switch-list-spinner").hide()}$$(".switch-to-user").each(function(t){t.observe("click",BF_UserSwitcher.swfunction)});$$(".switched-display_name").each(function(t){if(!t.hasClassName("bottom_display_name"))t.update(r.display_name)});BF_UserSwitcher.apply_visibility()}catch(e){console.error(e)}},hide_switch_list_ui:function(){$("usernav-switch-list").hide()},switchTo:function(t,i){try{var a=new BF_User;if(a.isLoggedIn()){var s=a.getUserInfo();if(typeof s.default_user!="undefined"){if(s.userid==t){$("usernav-switch-list").hide();if($("switch-list-spinner"))$("switch-list-spinner").hide()}else{$("usernav-switch-list").hide();if($("switch-list-spinner"))$("switch-list-spinner").show();var r=new BF_Request;r.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch",default_username:s.default_user.username,switch_id:t},onSuccess:function(t){BF_UserSwitcher._switchTo(t,i)}})}}}}catch(e){console.error(e)}},_switchTo:function(t,i){try{var a={};if(window.location.href.match("/signup")){a={no_reload:true}}bf_login.loggedIn(t,a);i();if($("switch-list-spinner"))$("switch-list-spinner").hide()}catch(e){console.error(e)}},getSwitchListFor:function(t,i){try{if(!acl.user_can("edit_user_accounts"))return;var a=new BF_Request;a.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list_for",username:t},onSuccess:function(t){BF_UserSwitcher._getSwitchList(t.responseText,i)}})}catch(e){console.error(e)}},getSwitchList:function(t,i,a){try{if(BF_UserSwitcher.was_ajax){var s=BF_UserSwitcher.latest_switch_list;s.shift();s=JSON.stringify(s);BF_UserSwitcher._getSwitchList('{"success" : 1, "switch_list" :'+s+"}",t,i,a)}else{if(typeof a=="undefined")a=false;var r=new BF_User;if(r.isLoggedIn()){var n=r.getUserInfo();if(typeof n.default_user!="undefined"){var o=new BF_Request;o.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"switch_list",default_username:n.default_user.username},onSuccess:function(s){BF_UserSwitcher._getSwitchList(s.responseText,t,i,a);BF_UserSwitcher.was_ajax=true},on401:function(){console.warn("Insufficient Permissions")}})}}}}catch(e){console.error(e)}},_getSwitchList:function(t,i,a,s){try{if(i==undefined)return false;var r=JSON.parse(t);if(r.success=="1"){BF_UserSwitcher.latest_switch_list=r.switch_list.slice(0);var n=(new BF_User).getUserInfo();u=n.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:decodeURIComponent(u.display_name.unescapeHTML()),username:u.username,image:decodeURIComponent(u.image.unescapeHTML()),userid:u.userid});BF_UserSwitcher.latest_switch_list_loaded=true;i(r.switch_list,a,s)}}catch(e){console.error(e)}},show_warning:function(){try{var t=new BF_User;if(t.isLoggedIn()){var i=t.getUserInfo();if(!window.location.pathname.match("/dashboard$")&&typeof i.default_user!="undefined"&&i.default_user.username!=i.username){$$(".switched-display_name").each(function(t){t.update(i.display_name)});$$(".switch-warning").each(function(t){t.show()})}else{$$(".switch-warning").each(function(t){t.hide()})}}}catch(e){console.error(e)}},_getSwitchList:function(t,i,a,s){if(i==undefined)return false;var r=JSON.parse(t);if(r.success=="1"){if(typeof r.switch_list.users!=="undefined"){BF_UserSwitcher.latest_switch_list=r.switch_list.users.slice(0)}else{BF_UserSwitcher.latest_switch_list=r.switch_list.slice(0)}var n=(new BF_User).getUserInfo();u=n.default_user;BF_UserSwitcher.latest_switch_list.unshift({display_name:unescape(u.display_name),username:unescape(u.username),userid:unescape(u.userid)});BF_UserSwitcher.latest_switch_list_loaded=true;i(r.switch_list,a,s)}},disable_private_fields:function(){try{var t=new BF_User;if(t.isLoggedIn()){var i=t.getUserInfo();if(typeof i.default_user!="undefined"&&i.default_user.username!=i.username){var a=["user-settings-button"];a.each(function(t){if($(t))$(t).style.display="none"})}}}catch(e){console.error(e)}},create_alias_for:function(t,i){if(typeof t.username=="undefined"||typeof t.alias_username=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},i);return}if(!acl.user_can("edit_user_accounts"))return;(new BF_Request).request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias_for",username:t.username,alias_username:t.alias_username},onSuccess:function(t){BF_UserSwitcher._create_alias(t,i)},onFailure:function(t){BF_UserSwitcher._create_alias(t,i)}})},create_alias:function(t,i){if(typeof t.username=="undefined"||typeof t.display_name=="undefined"){BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Oops! You need to tell us your desired URL"})},i);return}var a=new BF_User;if(a.isLoggedIn()){var s=a.getUserInfo();if(typeof s.default_user!="undefined"){var r=new BF_Request;if(t.self_serve==1){r.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:t.username,display_name:t.display_name,default_username:s.default_user.username,self_serve:1},onSuccess:function(a){BF_UserSwitcher._create_alias(a,t.username,i)},onFailure:function(a){BF_UserSwitcher._create_alias(a,t.username,i)}})}else{r.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"add_alias",username:t.username,display_name:t.display_name,default_username:s.default_user.username},onSuccess:function(t){BF_UserSwitcher._create_alias(t,i)},onFailure:function(t){BF_UserSwitcher._create_alias(t,i)}})}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"Insufficient privileges"})},i)}}else{BF_UserSwitcher._create_alias({status:500,responseText:Object.toJSON({success:0,message:"User not logged in"})},i)}},_create_alias:function(t,i){var a=JSON.parse(t.responseText);a.status=t.status;i(a)},count_aliases:function(t){var i=new BF_User;if(i.isLoggedIn()){var a=i.getUserInfo();if(typeof a.default_user!="undefined"){var s=new BF_Request;s.request(BF_UserSwitcher.controller,{method:"post",parameters:{action:"count_aliases",default_username:a.default_user.username},onComplete:function(i){BF_UserSwitcher._count_aliases(i,t)}})}}},_count_aliases:function(t,i){var a=JSON.parse(t.responseText);a.status=t.status;i(a)}};if(typeof edit_post=="undefined")BuzzLoader.register(BF_UserSwitcher.init,1);bf_badge_vote_manager=function(){var t=this;this.VOTE_CONTROLLER="/buzzfeed/_badge_vote";this.VOTE_DEFINITIONS={badge:{onSuccess:function(t){badge_vote_manager.badgeResponse(t)},parameters:{badge_id:function(t){if(t.className.match(/bf_dom/)){var i=JSON.parse(t.getAttribute("rel:data"));return i.vote.badge_id}else return t.getAttribute("rel:badge_id")}}},love_or_hate:{onSuccess:function(t){badge_vote_manager.loveHateResponse(t)},parameters:{value:function(t){if(t.className.match(/bf_dom/)){var i=JSON.parse(t.getAttribute("rel:data"));return i.vote.value=="loves"?1:0}else return t.getAttribute("rel:value")=="loves"?1:0}}}};this.initialized=false;this.initialization=false;this.badgeResponse=function(t){var i=JSON.parse(t.responseText);if($("spinner-badge"))$("spinner-badge").hide();if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(i.success){BFW_Util.updateInfoCookie({last_active:i.last_active});if(!!window.fb_app){fb_app.badge_vote_success(i)}else{var a=$(i.element_id);var s=a;var r=a.getAttribute("rel:category");while(s.parentNode&&!s.getAttribute("rel:buzz_id"))s=s.parentNode;Event.stopObserving(a,"click",badge_vote_manager.vote);a.removeAttribute("href");$(a).up("li").addClassName("voted");if(i.already_voted){if(BF_STATIC.tt_page!="Video"){return badge_vote_manager._already_voted(i)}}if(BF_STATIC.tt_page!="Video"){badge_vote_manager.show_reaction_share_box(a.getAttribute("rel:badge_name"),a.getAttribute("rel:message"))}var n=new BF_User;var o=badge_vote_manager.VOTE_DEFINITIONS[r];var l=o.success_template;var u={username:n.getUserInfo().username,display_name:n.getUserInfo().display_name,title:decodeURIComponent(s.getAttribute("rel:buzz_title")),uri:s.getAttribute("rel:buzz_uri"),badge:a.getAttribute("rel:badge_name")};if(BF_STATIC.tt_page!="Video"){badge_vote_manager._hide_social_messages();if(a.getAttribute("rel:message"))$("badge-message").update(unescape(a.getAttribute("rel:message")));if($("social_message")){$("social_message").show();var d=$("social_message").select("a")[0];if(d)d.setAttribute("target","_none")}if($("number_of_contribs_header"))$("number_of_contribs_header").show();this._update_reaction_count(a.getAttribute("rel:badge_id"));if(typeof i.earned_reactions!="undefined"){BFW_Util.updateInfoCookie({earned_reactions:i.earned_reactions})}}gtrack.trackShares(23,"numReactions_"+u.badge.toLowerCase());gtrack.track_events("[ttp]","react/"+u.badge.toLowerCase(),"");EventManager.fire("badge_vote:success",u.badge)}}else{}};this.loveHateResponse=function(t){var i=JSON.parse(t.responseText);if($("spinner-love_or_hate"))$("spinner-love_or_hate").hide();if(badge_vote_manager._spinner){$(badge_vote_manager._spinner).hide();badge_vote_manager._spinner=null}if(i.success&&i.element_id){BFW_Util.updateInfoCookie({last_active:i.last_active});var a=$(i.element_id);if(a.parentNode.id.match(/(love|hate)_button-\d+/)){$(a.parentNode).show()}var s=a;while(s.parentNode&&!s.getAttribute("rel:buzz_id"))s=s.parentNode;Event.stopObserving(a,"click",badge_vote_manager.vote);a.removeAttribute("href");if(a.parentNode.nodeName=="LI")$(a.parentNode).addClassName("voted");else if(a.parentNode.nodeName=="A")$(a.parentNode).up().addClassName("voted");if(i.already_voted)return badge_vote_manager._already_voted(i);var r=new BF_User;var n=a.getAttribute("rel:category");var o=badge_vote_manager.VOTE_DEFINITIONS[n];var l=o.success_template;var u={display_name:r.getUserInfo().display_name,title:decodeURIComponent(s.getAttribute("rel:buzz_title")),uri:s.getAttribute("rel:buzz_uri"),loves:a.getAttribute("rel:value")};var d=u.loves=="loves"?"feed-love":"feed-hate";badge_vote_manager._hide_social_messages();if(!badge_vote_manager.is_contribution(a)){var c=u.loves.match(/love/)?"love":"hate";badge_vote_manager.show_reaction_share_box(c);if($("number_of_contribs_header"))$("number_of_contribs_header").show();this._update_reaction_count(c)}else{var _=$("social_message-"+s.getAttribute("rel:buzz_id"));var f=u.loves=="loves"?local.t("Yeah!"):local.t("Awww");_.update(f);_.show()}}else{}};this._already_voted=function(t){badge_vote_manager._hide_social_messages();if($("share-reaction-box"))$("share-reaction-box").hide();var i=$(t.element_id);if(badge_vote_manager.is_contribution(i)){var a=i;while(a.parentNode&&!a.getAttribute("rel:buzz_id"))a=a.parentNode;var s=$("social_message-"+a.getAttribute("rel:buzz_id"));if(s){s.update(local.t("Okay!"));s.style.width="100%";s.show()}}else{$("social_message-already-voted").show()}};this._exceeded_maximum_badge_votes=function(){if(typeof fb_app=="undefined"){var t=$$(".vote-badge");for(var i=0;i<t.length;i++){Event.stopObserving(t[i],"click",badge_vote_manager.vote);t[i].observe("click",badge_vote_manager._show_vote_exceeded)}badge_vote_manager._show_vote_exceeded()}else{if($("badge_vote_msg"))$("badge_vote_msg").update("<h4>"+local.t("Sorry")+"</h4>, <p>"+local.t("you can only react up to three times")+'.<p> <a href="javascript:;" onclick="javascript:$(\'badge_vote_msg\').hide()" class="close">&times;</a>');if(typeof fb_app.error_msg_timeout!="undefined")clearTimeout(fb_app.error_msg_timeout);fb_app.error_msg_timeout=setTimeout("Effect.Fade('badge_vote_msg',{'duration':2.0})",3e3)}};this._show_vote_exceeded=function(e){if(typeof e!="undefined")e.stop();badge_vote_manager._hide_social_messages();if($("social_message-badge-votecount-exceeded"))$("social_message-badge-votecount-exceeded").show()};this._hide_social_messages=function(){if($("social_message-badge-votecount-exceeded"))$("social_message-badge-votecount-exceeded").hide();if($("social_message-already-voted"))$("social_message-already-voted").hide();if($("social_message"))$("social_message").hide();if($("social_message-loves"))$("social_message-loves").hide();if($("social_message-hates"))$("social_message-hates").hide()};this.init=function(){if(badge_vote_manager.initialized){return false}if(badge_vote_manager.initialization){setTimeout(this.init.bind(this,args),300)}badge_vote_manager.initialization=true;try{bf_login.init();this.ajax=new BF_Request;if($("badge_voting")&&BF_STATIC.tt_page!="Video"){var t=$("badge_voting").getElementsByTagName("UL")[0];badge_vote_manager.earned_reactions_buttons(t)}var i=new BF_User;$$(".add-pick").each(function(t){if(i.isLoggedIn()){t.removeClassName("hidden");t.up().removeClassName("hidden")}else{t.addClassName("hidden");t.up().addClassName("hidden");
}});var a=i.getUserInfo();if(a&&typeof a.p_disable_reaction!="undefined"&&a.p_disable_reaction=="true"){$$("#lovehate_buttons, #badge_voting, .lovehate-buttons").each(function(t){t.style.visibility="hidden"})}else{for(var s in badge_vote_manager.VOTE_DEFINITIONS){var r=$$(".vote-"+s);for(var n=0;n<r.length;n++){var o=r[n];if(o.className.match(/bf_dom/))continue;o.setAttribute("rel:category",s);if(!o.id){o.id="vote-"+s+"-"+parseInt(Math.random()*1e7)}o.observe("click",badge_vote_manager.vote)}}}var l=$("filter-show_everything");if(l){l.observe("click",function(e){e.stop();if($("contribution-list"))$("contribution-list").show();$(e.target.parentNode).addClassName("current")})}var u=$$(".contrib");for(var n=0;n<u.length;n++){var d=u[n].getAttribute("rel:buzz_id");if(d){u[n].observe("mouseout",function(e){var t=e.target;while(t.parentNode&&!t.getAttribute("rel:buzz_id"))t=t.parentNode;var i=t.getAttribute("rel:buzz_id");var a="tools-"+i;if($(a)){$(a).removeClassName("selected_tools")}});u[n].observe("mouseover",function(e){var t=e.target;while(t.parentNode&&!t.getAttribute("rel:buzz_id"))t=t.parentNode;var i=t.getAttribute("rel:buzz_id");var a="tools-"+i;if($(a)){$(a).addClassName("selected_tools")}})}}badge_vote_manager.initialized=true}catch(e){console.error(e);badge_vote_manager.initialization=false}};this.reset_sharing_box=function(){if($("social-sharing-box")){$("sharing-message").value="";$("sharing-box-caption").update("");$("sharing-box-submit").value=local.t("Post to Facebook");$("sharing-box-submit").stopObserving("click",fbtl_session.add_message);$("sharing-box-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}if($("share-reaction-box")){$("reaction-sharing-message").value="";$("reaction-share-submit").value=local.t("Share Link");$("reaction-share-submit").stopObserving("click",badge_vote_manager.sharing_box_handler)}};this.show_reaction_share_box=function(t,i){if($("share-reaction-box")){$("share-reaction-box").show();$("reaction-sharing-message").value="";if($("share-reaction-success-wrapper").visible()){$("share-reaction-success-wrapper").hide()}if(!$("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-content-wrapper")}$("reaction-share-submit").observe("click",badge_vote_manager.sharing_box_handler);if(typeof bf_rdio=="object"){var a=bf_rdio.fetch_rdio_buzz(t.toLowerCase());if(a&&$("share-reaction-box_title")){var s="I know, right? Now check out the Rdio"+" <span class='react_box'>"+t+"</span> playlist <a onClick=\"trackPixel('https://ad.doubleclick.net/clk;267621454;93691579;z');\" href='http://buzzfeed.com"+a+"'>"+local.t("HERE")+"</a>";$("share-reaction-box_title").innerHTML=s}}["Nom Nom"].each(function(a){if(a==t&&i){$("share-reaction-box_title").innerHTML=unescape(i)}})}};this.show_sharing_box=function(t,i){if($("social-sharing-box")){var a=$("social-sharing-box");var s=badge_vote_manager.find_position(t);if(typeof s=="undefined")return;var r=parseInt(s[0]);var n=t.getAttribute("rel:category");var o=n&&n=="badge"?parseInt(s[1])+7:parseInt(s[1])-1;var l=$(t.getAttribute("id"));var u=parseInt(l.getWidth());var d=parseInt(a.getWidth());var c=300;var _=r<d/2-u/2?10:r-(d/2-u/2);a.setStyle({top:o+35+"px",left:_+"px"});var f=10;var p=r<d/2-u/2?r-10+u/2:d/2;p=p-10;$("arrowBorder").setStyle({top:-f+"px",left:p+"px",borderBottom:f+"px solid #444"});$("arrowFill").setStyle({top:-f+2+"px",left:p+"px",borderBottom:f+"px solid #F2F2F2"});if(typeof i!="undefined"&&i=="fbtl"){$("sharing-box-caption").update(local.t("Add a message?"));$("sharing-box-submit").value=local.t("Add A Message");$("sharing-box-submit").observe("click",fbtl_session.add_message)}else{$("sharing-box-caption").update(local.t("I know, right? Will your friends agree?"));var m=t.getAttribute("rel:badge_name")?t.getAttribute("rel:badge_name")+"!":"";$("sharing-message").value=m;$("sharing-box-submit").observe("click",badge_vote_manager.sharing_box_handler)}a.show()}};this.find_position=function(t){var i=curtop=0;if(t.offsetParent){do{i+=t.offsetLeft;curtop+=t.offsetTop}while(t=t.offsetParent);return[i,curtop]}};this.sharing_box_handler=function(e){var t="";var i=document.getElementsByTagName("meta");var a=["image","title","description","url"];var s={};if(objExists(e.target.id)){if(e.target.id="reaction-share-submit"){t=$("reaction-sharing-message").value}else if(e.target.id="sharing-box-submit"){t=$("sharing-message").value}}for(var r=0;r<i.length;r++){for(var n=0;n<a.length;n++){var o="og:"+a[n];if(i[r].getAttribute("property")==o)s[a[n]+""]=i[r].getAttribute("content")}}if(typeof BF_STATIC.pound_enabled!="undefined"&&BF_STATIC.pound_enabled&&!BF_STATIC.mobile_app){s.url=pound.urls.unescaped.hashAndQueryString()}var l={};l["description"]=s.description;l["name"]=s.title;l["link"]=s.url;l["picture"]=s.image;l["message"]=t;facebook.publish_to_stream(l,function(){if($("social-sharing-box").visible()){$("social-sharing-box").hide()}if($("share-reaction-box")){if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideUp("share-reaction-content-wrapper")}if($("share-reaction-content-wrapper").visible()){BF_Effect.SlideDown("share-reaction-success-wrapper")}}})};this.show_social_icons=function(){if(typeof ActiveHistory=="undefined")return;ActiveHistory.observe("visited:digg",function(){if($("share_digg_button"))$("share_digg_button").show()});ActiveHistory.observe("visited:twitter",function(){if($("share_twitter_button"))$("share_twitter_button").show()});ActiveHistory.observe("visited:reddit",function(){if($("share_reddit_button"))$("share_reddit_button").show()});ActiveHistory.observe("visited:stumbleupon",function(){if($("share_stumbleupon_button"))$("share_stumbleupon_button").show()});ActiveHistory.observe("visited:delicious",function(){if($("share_delicious_button"))$("share_delicious_button").show()});ActiveHistory.observe("visited:fark",function(){if($("share_fark_button"))$("share_fark_button").show()})};this.vote=function(e){e.stop();var i=new BF_User;var a;if(e.target.nodeName=="SPAN")a=e.target.up();else a=e.target;if(typeof fb_app!="undefined"){var s=a.getAttribute("rel:badge_name");fb_app.show_bubble(s);if(!fb_app.session||!fb_app.bf_user_info){fb_app.log_into_buzzfeed()}else{badge_vote_manager._vote(a)}}else if(i.isLoggedIn()){var r=readCookie("fb-vote-prompt");a.up(".contrib")?badge_vote_manager._comment_vote(a):badge_vote_manager._vote(a)}else{BF_LOGIN_SIGNUP.show({locationName:"reaction",onSuccessLoginCb:function(){BF_LOGIN_SIGNUP.updateUserNav();t.initialized=true;t.vote_by_id(a.up("li").id)}.bind(this)})}EventManager.fire("badge_vote:vote_init",a.getAttribute("rel:badge_name"))};this.vote_by_id=function(t){var i=typeof universal_dom!="undefined"&&badge_vote_manager.initialized&&$$("#"+t+" a").length;if(i){var a=$$("#"+t+" a")[0].fire("click");badge_vote_manager.vote(a)}else setTimeout(badge_vote_manager.vote_by_id.bind(this,t),500)};this._comment_vote=function(t){var i=t.getAttribute("rel:category");if(!i){if(t.up("a")){t=t.up("a");i=t.getAttribute("rel:category");if(!i)return}}Event.stopObserving(t,"click",badge_vote_manager.vote);var a=t.up(".contrib").getAttribute("rel:comment_id");var s=t.getAttribute("rel:value");var r={action:"comment_vote",comment_id:a,badge_name:s};var n=new BF_Request;n.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:r});var o=parseInt(t.down(".count").innerHTML);if(o>=0){t.down(".count").innerHTML=o+1}};this._vote=function(t){var i=t.getAttribute("rel:category");if(!i)return;var a=t;while(a.parentNode&&!a.getAttribute("rel:buzz_id"))a=a.parentNode;var s=a.getAttribute("rel:buzz_id");if(i=="badge"){if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={};_badge_votes_so_far[s]={}}else if(typeof _badge_votes_so_far[s]=="undefined"){_badge_votes_so_far[s]={}}var r=new BF_User;var n=r.getUserInfo();if(typeof _badge_votes_so_far!="undefined"){if(typeof _badge_votes_so_far[""+s][n.username]=="undefined"){_badge_votes_so_far[""+s][n.username]=1}else{if(_badge_votes_so_far[""+s][n.username]>=3){return badge_vote_manager._exceeded_maximum_badge_votes()}else{_badge_votes_so_far[""+s][n.username]+=1}}}}if(badge_vote_manager.is_contribution(t)){$("love_button-"+a.getAttribute("rel:buzz_id")).hide();$("hate_button-"+a.getAttribute("rel:buzz_id")).hide();$("social_message-"+a.getAttribute("rel:buzz_id")).hide();badge_vote_manager._spinner=$("spinner-"+a.getAttribute("rel:buzz_id"));$(badge_vote_manager._spinner).style.width="100%";$(badge_vote_manager._spinner).show()}else if($("spinner-"+i)){$("spinner-"+i).show()}var o=this.VOTE_DEFINITIONS[i];if(!o)return;bf_reactions.grow_up_css(t);var l={action:"vote",element_id:t.id,category:i,uri:"/"+a.getAttribute("rel:buzz_uri"),buzz_id:a.getAttribute("rel:buzz_id")};for(var u in o.parameters){l[u]=o.parameters[u](t)}var d=new BF_Request;d.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:l,onSuccess:o.onSuccess});if(i=="badge"&&t.getAttribute("rel:badge_type")!="earned"){if(typeof _badge_votes_so_far=="undefined"||_badge_votes_so_far[""+s][n.username]<2){var c="react";var _=window.location.toString().replace(/\?.*/i,"");if(BF_STATIC.bf_env!="live"){_=_.replace(/\/\/(stage(\d+)?|dev)\./i,"//www.").replace("/bf2/","/")}var f=t.getAttribute("rel:badge_uri");var p={article:_,badge:"http://www.buzzfeed.com/badge/"+f};try{if(typeof FB!="undefined")fbtl_session.trigger(c,p)}catch(e){console.error(e)}}}(new BF_Targetting_Pixel).add("badge_reaction")};this.simple_love_vote=function(t,i){var a=this.VOTE_DEFINITIONS["love_or_hate"];var s={action:"vote",buzz_id:i,category:"love_or_hate",uri:t,value:1};var r=new BF_Request;r.request(this.VOTE_CONTROLLER,{method:"post",needsToken:true,parameters:s,onSuccess:a.onSuccess})};this.is_contribution=function(t){var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id"))i=i.parentNode;return i.parentNode.className.match(/contribution-lovehate-buttons/)};this._update_reaction_count=function(t){return false;var i=t+"-reaction-count";var a=$(i).innerHTML.replace(/\s+/g,"");var a=parseInt(a);if(!isNaN(a)){a++;$(i).update(a)}};this.find_parent=function(t,i){if(i.tagName.toLowerCase()==t.toLowerCase())return i;else if(i.parentNode!=null)return badge_vote_manager.find_parent(t,i.parentNode);else return console.warn("no "+t+" found in DOM")};this.earned_reactions_buttons=function(t){if(local.non_english){return false}try{var i=new Template('<li id="#{name}_button" class="reaction #{name}"> <a id="vote-badge-#{rand}" class="btn-reaction vote-badge" rel:badge_type="earned" rel:badge_name="#{title}" rel:badge_id="#{badge_id}" rel:message="<b>'+local.t("I know, right?")+"</b> <span class=#{infinite}>"+local.t("You have #{remaining_less_one} of these babies left, use #{itslashthem} wisely")+"...</span><span class=#{none_left}>"+local.t("That was your last #{title} reaction. Go earn some more!")+'</span>"> #{title} <span class="earned-remaining">#{remaining}</span></a> <span id="#{badge_id}-reaction-count" class="badge-vote-count zero"></span> </li>');var a=(new BF_User).getUserInfo().earned_reactions;var s=false;if(a&&t){var r=JSON.parse(a);for(var n in r){if(!r.hasOwnProperty(n)||r[n].remaining==0)continue;var o=n.toLowerCase().replace("[^a-zA-Z]","");if(typeof o==="undefined"||o=="")continue;var l={name:o,rand:parseInt(Math.random()*1e3)+(new Date).getTime(),title:n,remaining:r[n].remaining==-1?"":" "+r[n].remaining+"",badge_id:r[n].badge_id};l.remaining_less_one=r[n].remaining-1;l.infinite=l.remaining_less_one<1?"hidden":"";l.none_left=l.remaining_less_one==0?"":"hidden";l.itslashthem=l.remaining_less_one==1?"it":"them";var u=i.evaluate(l);t.insert(u);s=true}if(s){$s(".reactions_container.special").show();$$(".special-reactions").each(function(t){t.show()});var d={el:$s(".reactions_slider.special"),reactions_class:"reaction"};new BF_Reactions_Slider(d)}}}catch(e){console.error(e)}}};badge_vote_manager=new bf_badge_vote_manager;badge_vote_manager.show_social_icons();BuzzLoader.register(function(){badge_vote_manager.init()},6);bf_user_reaction=function(){var t="/buzzfeed/_badge_vote";var i={success_voted:local.t("Thanks for your vote!"),already_voted:"<span>"+local.t("Oops")+".</span> "+local.t("It looks like you've already voted")+".",reaction_count_exceeded:"<span>"+local.t("Sorry")+"</span>, "+local.t("you can only react up to three times")+"."};var a=this;this.init=function(){var t=new BF_User;$$(".user-reaction").each(function(i,s){if(t.isLoggedIn()){i.removeClassName("hide-user-reaction")}i.select(".reaction-btn").each(function(t,i){t.observe("click",a.add_reaction)})});universal_dom.assign_handler({bucket:"fb-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"tw-share",handler:bf_user_reaction.buzz_share,event:"click"});universal_dom.assign_handler({bucket:"pin-share",handler:bf_user_reaction.buzz_share,event:"click"})};this.buzz_share=function(t){var i=$("user-reaction-social-"+t.id);if(!i){return}var a=encodeURIComponent(i.getAttribute("rel:title"));var s=BF_STATIC.bf_env!="live"?"http://stage.buzzfeed.com/":"http://www.buzzfeed.com/";var r=encodeURIComponent(s+i.getAttribute("rel:link"));var n=encodeURIComponent(BF_STATIC.image_root+i.getAttribute("rel:thumb"));var o="https://twitter.com/intent/tweet?text="+a+"&url="+r;if(BF_STATIC.tt_page="Community")o=o+"&via=buzzfeeders";if(t.element.hasClassName("buzz-facebook-share")){window.open("https://facebook.com/sharer/sharer.php?s=100&p[url]="+r+"&p[title]="+a+"&p[images][0]="+n,"_blank","width=600, height=260")}else if(t.element.hasClassName("buzz-twitter-share")){window.open(o,"_blank","width=600,height=400")}else if(t.element.hasClassName("buzz-pinterest-share")){window.open("https://pinterest.com/pin/create/button/?media="+n+"&url="+r+"&description="+a,"_blank","width=600,height=400")}};this.add_reaction=function(t){var i=t.target;if(i.hasClassName("icon")){i=i.parentNode}var s=a.get_reaction_wrap(i);a.hide_all_reaction_messages(i);var r={action:"vote",element_id:i.id,category:i.getAttribute("rel:category"),buzz_id:s.getAttribute("rel:buzz_id"),uri:"/"+s.getAttribute("rel:buzz_uri")};if(i.getAttribute("rel:category")=="badge"&&!a.is_reaction_available(s.getAttribute("rel:buzz_id"))){a.show_reaction_message(i,"reaction_count_exceeded");return false}if(i.getAttribute("rel:badge_id")){r.badge_id=i.getAttribute("rel:badge_id")}if(i.getAttribute("rel:value")){r.value=i.getAttribute("rel:value")=="loves"?"1":i.getAttribute("rel:value")=="hates"?"0":i.getAttribute("rel:value")}var n=new BF_User;if(!n.isLoggedIn()){console.warn("signin.open is deprecated. Please use BF_LOGIN_SIGNUP.show");return false}a.send_react_request(r);a.show_reaction_loading(i);(new BF_Targetting_Pixel).add("badge_reaction")};this.vote_by_id=function(t){$$("#"+t+" a")[0].scrollIntoView();var i=$$("#"+t+" a")[0].fire("click");bf_user_reaction.add_reaction(i)};this.send_react_request=function(i){var s=new BF_Request;s.request(t,{method:"post",parameters:i,needsToken:true,onSuccess:a.add_reaction_success})};this.is_reaction_available=function(t){var i=new BF_User;var a=i.getUserInfo();if(typeof _badge_votes_so_far=="undefined"){_badge_votes_so_far={}}if(typeof _badge_votes_so_far[t]=="undefined"){_badge_votes_so_far[t]={}}if(typeof _badge_votes_so_far[t][a.username]=="undefined"){_badge_votes_so_far[t][a.username]=1;return true}else{if(_badge_votes_so_far[t][a.username]>=3){return false}_badge_votes_so_far[t][a.username]+=1;return true}};this.add_reaction_success=function(t){var i=JSON.parse(t.responseText);if(i.success){$(i.element_id).stopObserving("click",a.add_reaction);$(i.element_id).addClassName("already-reacted");a.hide_reaction_loading($(i.element_id));if(i.already_voted){a.show_reaction_message($(i.element_id),"already_voted")}else{a.show_reaction_message($(i.element_id),"success_voted")}}else{}};this.get_reaction_wrap=function(t){var i=t;while(i.parentNode&&!i.hasClassName("user-reaction")){i=i.parentNode}return i};this.show_reaction_loading=function(t){var i=a.get_reaction_wrap(t);if(!i.select(".reaction-loading").length){i.insert('<div class="reaction-loading" style="display:none;">'+local.t("Saving")+"...</div>")}i.select(".reaction-loading")[0].show()};this.hide_reaction_loading=function(t){var i=a.get_reaction_wrap(t);if(i.select(".reaction-loading").length){i.select(".reaction-loading")[0].hide()}};this.show_reaction_message=function(t,s){var r=a.get_reaction_wrap(t);if(!r.select(".reaction-message-"+s).length){r.insert('<div class="reaction-message reaction-message-'+s+'" style="display:none;">'+i[s]+"</div>")}r.select(".reaction-message-"+s)[0].show()};this.hide_all_reaction_messages=function(t){var i=a.get_reaction_wrap(t);if(i.select(".reaction-message").length){i.select(".reaction-message").each(function(t,i){t.hide()})}}};bf_user_reaction=new bf_user_reaction;BuzzLoader.register(function(){bf_user_reaction.init()},2);var BF_MAX_UPLOAD=1024*1024*5;var BF_MAX_UPLOAD_TEXT="5 megabytes";var BF_MAX_UPLOAD_PROFILE=1024*1024*5;var BF_MAX_UPLOAD_PROFILE_TEXT="5 megabyte";BF_IMAGE_CROPPER=Class.create({template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="btn--buzz btn--buzz--inline hidden">Save</button>						<button id="preview-thumbs" class="hidden bf_button bf_submit">Save</button>						<button id="approve-thumbs" class="hidden bf_button bf_submit">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="btn--buzz btn--buzz--discrete btn--buzz--inline" value="Cancel" /></li>				</ul>			</div>		</div>',preview_template:'<div id="preview" class="preview hidden"></div>',uploader_template:'		<div id="uploader_container">			<p class="upload-desc">Select an image to use for your post. After uploading you\'ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<fieldset>				<div>Thumbnail</div>				<div id="result" class="results"><div class="scroller"><img id="result-image" rel:width="300" rel:height="45" />&nbsp;</div></div>				<button id="crop-thumb" class="bf_button">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){},fitToScreen:function(){},initialize:function(t){try{var i=this;this.options={cropper_class:"",fitImageAndScreen:false,showThumbs:true,showPreview:true,showCropper:true,minHeight:null,minWidth:null,enforceMin:false,maxHeight:null,maxWidth:null,enforceMax:false,modalIsParent:false,controller:"/bfcgi/_edit_quickpost_image",action:"imageupload"};Object.extend(this.options,t);this.uploader_params={action:this.options.action};this.regions={"default":false};this.setDefaults();this.container=$(t.container);this.container.update(new Template(this.template).evaluate({cropper_class:this.options.cropper_class,static_root:BF_STATIC.static_root,uploader_template:new Template(this.uploader_template).evaluate({static_root:BF_STATIC.static_root}),preview_template:new Template(this.preview_template).evaluate({static_root:BF_STATIC.static_root}),thumbs_template:new Template(this.thumbs_template).evaluate({static_root:BF_STATIC.static_root})}));if(this.options.modalIsParent)this.container=$(this.container.parentNode);this.uploader_container=$$("#"+this.container.id+" #uploader_container")[0];this.cropper_container=$$("#"+this.container.id+" #cropper_container")[0];this.cropper_instance=null;this.preview_button=$$("#"+this.container.id+" #preview-thumbs")[0];this.approve_button=$$("#"+this.container.id+" #approve-thumbs")[0];this.save_button=$$("#"+this.container.id+" #save-image")[0];this.cancel_button=$$("#"+this.container.id+" #image-cancel")[0];this.uploader_element=$$("#"+this.container.id+" #uploader")[0];this.image_element=$$("#"+this.container.id+" #image")[0];this.preview_button.observe("click",this.preview_image.bind(this));this.approve_button.stopObserving("click");this.approve_button.observe("click",this.approve_image.bind(this));this.save_button.observe("click",this.save_image.bind(this));this.cancel_button.observe("click",this.cancel_image.bind(this));this.error_title="";this.error_message="";this.init_uploader();this.cropper_container.addClassName("hidden");this.uploader_container.select(".upload-error, upload-status").each(function(t){t.addClassName("hidden")});$("uploader").removeClassName("hidden");if(this.options.image_data)this.onComplete(0,t.image_data.image,t.image_data)}catch(e){this.close();alert("Unknown error occured. Please try again later.");console.dir(e);console.trace()}},preview_image:function(){try{this.container.scrollTo();this.container.removeClassName("upload").removeClassName("crop").addClassName("thumbs");this.cropper_container.select(".container")[0].addClassName("hidden");$("thumbs").removeClassName("hidden");if(this.options.showThumbs)this.approve_button.removeClassName("hidden");else this.save_button.removeClassName("hidden");this.preview_button.addClassName("hidden");this.show_thumbs()}catch(t){console.error(t)}},show_thumbs:function(){var t=this;var i=this.image_element;$("result-image").each(function(a){var s=t.regions["default"];a.up(".scroller").style.width=a.getAttribute("rel:width")+"px";a.up(".scroller").style.height=a.getAttribute("rel:height")+"px";var r=a.getAttribute("rel:width")*1;var n=a.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*r/s.width);var l=Math.round(s.left*r/s.width);var u=Math.round(n*s.top/s.height);a.src=i.src;a.style.margin="-"+u+"px 0 0 -"+l+"px";a.style.width=o+"px";var d=a.up("fieldset").select("button")[0];d.stopObserving("click");d.observe("click",function(){$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t))})},approve_image:function(e){},save_image:function(e){},cancel_image:function(e){e.stop()},init_uploader:function(){try{this.uploader=new qq.FileUploader({sendAsForm:true,element:this.uploader_element,action:this.options.controller,allowedExtensions:["jpg","jpeg","png","gif"],sizeLimit:BF_MAX_UPLOAD,params:this.uploader_params,onValidate:this.onValidate.bind(this),onProgress:this.onProgress.bind(this),onError:this.onError.bind(this),onComplete:this.onComplete.bind(this)})}catch(e){console.error(e)}},check_image:function(t){try{if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="Small image";i.select(".cerror-message")[0].innerHTML=this.error_message="This image is too small, we need at least "+this.options.minWidth+"x"+this.options.minHeight;return false}return true}catch(e){console.error(e)}},init_cropper:function(){try{this.container.scrollTo();this.cropper_container.select(".container")[0].removeClassName("hidden");if(this.options.showThumbs){this.preview_button.removeClassName("hidden")}else{this.save_button.removeClassName("hidden")}if(this.cropper_instance){this.cropper_instance.remove();delete this.cropper_instance}var t={x1:0,y1:0,x2:this.options.minWidth,y2:this.options.minHeight};var i={autoIncludeCSS:true,displayOnInit:true,onloadCoords:t,ratioDim:{x:this.options.minWidth,y:this.options.minHeight},minWidth:this.options.minWidth,minHeight:this.options.minHeight,maxWidth:this.options.maxWidth,maxHeight:this.options.maxHeight,onEndCrop:this.crop_done.bind(this),captureKeys:false};if(this.options.ratioDim)i["ratioDim"]=this.options.ratioDim;this.customize_cropper(i);this.cropper_instance=new Cropper.Img(this.image_element,i);if(this.options.fitImageAndScreen)this.fitToScreen();if($(this.container).down("#image")!==this.cropper_instance.img){this.close();(new BF_Request).alert("Error: Unknown error occurred.<br>Please save your work, reload page and try upload image again.")}}catch(a){console.dir(a);console.trace()}},customize_cropper:function(t){try{var i=t.onloadCoords;if(this.regions["default"]){i.x1=this.regions["default"].left;i.y1=this.regions["default"].top;i.x2=this.regions["default"].left+this.regions["default"].width;i.y2=this.regions["default"].top+this.regions["default"].height}t.onloadCoords=i}catch(e){console.error(e)}},crop_default_size:function(){},crop_done:function(t,i){try{this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src}}catch(e){console.error(e)}},onValidate:function(t){try{var i=this.uploader_container.select(".upload-error")[0];if(t.size>BF_MAX_UPLOAD){i.removeClassName("hidden");i.select(".error-title")[0].innerHTML="Too big file";i.select(".cerror-message")[0].innerHTML="Max image upload size is "+BF_MAX_UPLOAD_TEXT}else{$("uploader").addClassName("hidden");i.addClassName("hidden");var a=this.container.select(".upload-status")[0];a.removeClassName("hidden");var a=this.uploader_container.select(".upload-status div.red")[0];a.style.width="0px"}}catch(e){console.error(e)}},onProgress:function(t,i,a,s){try{var r=a;var n=s;var o=Math.round(r/n*100);var l=this.uploader_container.select(".upload-status div.red")[0];l.style.width=this.uploader_container.select(".upload-status div.text")[0].getWidth()/100*o+"px"}catch(e){}},onError:function(t,i,a){$("uploader").removeClassName("hidden");var s="A critical error occurred while trying to upload the picture. Please try again in a few minutes.";if(a)s=a;var r=this.uploader_container.select(".upload-error")[0];r.removeClassName("hidden");r.select(".error-title")[0].innerHTML="Error occured";r.select(".cerror-message")[0].innerHTML=s},onComplete:function(t,i,a){try{this.container.removeClassName("thumbs").removeClassName("upload").addClassName("crop");this.uploader_container.select(".upload-status")[0].addClassName("hidden");this.uploader_element.removeClassName("hidden");this.image_data=a;if(!this.check_image(this.image_data)){if(this.options.callbacks&&this.options.callbacks.image_error)this.options.callbacks.image_error(this.error_title,this.error_message);return false}else{if(a.scale){a.width*=a.scale;a.height*=a.scale;this.options.minWidth*=a.scale;this.options.minHeight*=a.scale}this.uploader_container.addClassName("hidden");this.cropper_container.removeClassName("hidden");var s=this.image_element;if(Prototype.Browser.IE){var r=this;s.onload=function(){setTimeout(function(){r.image_element.onload=null;r.image_element.src=r.image_element.src},500)}}s.src=bf_ir+this.image_data.image+"?"+(new Date).getTime();s.width=this.image_data.width;s.height=this.image_data.height;s.removeClassName("hidden");if(!this.options.showCropper){this.crop_default_size()}else{if(a.crop_data){for(var n in a.crop_data){this.regions[n]=a.crop_data[n];this["manual_"+n]=true}this.preview_image()}else{if(Prototype.Browser.IE){setTimeout(function(){this.init_cropper()}.bind(this),1e3)}else{this.init_cropper()}}}}}catch(e){console.error(e)}},close:function(){BF_UI.closeDialog("user-image-edit");BF_UI.closeDialog("super-image-edit");BF_UI.closeDialog("modal-super-image-edit");if(this.preview_button)this.preview_button.addClassName("hidden");if(this.save_button)this.save_button.addClassName("hidden");if(this.approve_button)this.approve_button.addClassName("hidden")}});BF_SETTINGS_CROPPER=Class.create(BF_IMAGE_CROPPER,{uploader_template:'		<div id="uploader_container">			<div class="upload-title">Upload an Image</div>			<p class="upload-desc">Select an image to use for your profile. After uploading you\'ll be able to crop and resize your image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',preview_template:'		<div id="preview" class="preview">			<div class="scroller"><img id="result-image" rel:width="200" rel:height="200" />&nbsp;</div>		</div>',setDefaults:function(){var t={cropper_class:"settings",showThumbs:false,showPreview:true,showCropper:true,minWidth:200,minHeight:200};if(this.options.origin=="custom_user_header"||this.options.origin=="custom_user_channel_header"||this.options.origin=="bgimage")t.showCropper=false;Object.extend(this.options,t);this.uploader_params={action:this.options.action,origin:this.options.origin};BF_MAX_UPLOAD=BF_MAX_UPLOAD_PROFILE;BF_MAX_UPLOAD_TEXT=BF_MAX_UPLOAD_PROFILE_TEXT},cancel_image:function(e){this.close()},save_image:function(){var t=this.regions["default"];this.options.callbacks.save_image_callback(this.image_data.image,this.image_data.name,t,null,this.options.origin);this.close()},crop_done:function(t,i){try{this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src};var a=this.regions["default"];var s=$("result-image");s.up(".scroller").style.width=s.getAttribute("rel:width")+"px";s.up(".scroller").style.height=s.getAttribute("rel:height")+"px";var r=s.getAttribute("rel:width")*1;var n=s.getAttribute("rel:height")*1;var o=Math.round(this.image_data.width*r/a.width);var l=Math.round(a.left*r/a.width);var u=Math.round(n*a.top/a.height);s.src=this.image_element.src;s.style.margin="-"+u+"px 0 0 -"+l+"px";s.style.width=o+"px"}catch(e){console.error("If in IE - deal with it. "+e)}},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");if(this.uploader_params.origin=="custom_user_header")i.select(".error-title")[0].innerHTML=this.error_title="Image error.";else i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.uploader_params.origin=="user"&&(!t.uploaded||this.options.minHeight>t.height||this.options.minWidth>t.width)){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="Image error.";var a="Please upload an image that is at least "+this.options.minWidth+"px wide x "+this.options.minHeight+"px tall";if(!t.uploaded)a=t.message;i.select(".cerror-message")[0].innerHTML=this.error_message=a;return false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,width:this.image_data.width,height:this.image_data.height};this.save_image()}});BF_SUPERPOST_CROPPER=Class.create(BF_IMAGE_CROPPER,{template:'		#{uploader_template}		<div id="cropper_container">			<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>			#{preview_template}			#{thumbs_template}		</div>',uploader_template:'		<div id="uploader_container">			<div class="upload-title hidden">Upload an Image</div>			<p class="upload-desc hidden">Select an image to use for your post. After uploading you&rsquo;ll be able to crop and resize your thumbnail image.</p>			<div class="upload-error hidden"><div class="error-title">No image</div><p class="cerror-message">No image specified</p></div>			<div id="uploader" class="hidden"></div>			<div class="upload-status hidden">				<div class="red"></div>				<div class="text">Uploading...</div>				<div id="ul-spinner" class="loader"></div>			</div>		</div>',
thumbs_template:'		<div id="thumbs" class="hidden">			<div class="thumbs-left">				<fieldset class="normal-result">					<div class="result-header">Normal Thumbnails</div>					<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>					<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>					<button id="crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>				<fieldset class="wide-result">					<div class="result-header">Wide Thumbnail</div>					<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>					<button id="wide-crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>			</div>			<div class="thumbs-right">				<fieldset class="big-result">					<div class="result-header">Big Thumbnail</div>					<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>					<button id="big-crop-thumb" class="btn--buzz btn--buzz--discrete btn--buzz--inline">Re-crop</button>				</fieldset>			</div>		</div>',setDefaults:function(){var t={cropper_class:"",fitImageAndScreen:true,modalIsParent:true,minWidth:625,minHeight:415};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=355;this.wide_height=125;this.big_width=355;this.big_height=236;this.thumb_width=125;this.thumb_height=83;this.fitToScreenOuter=this.fitToScreen.bind(this);Event.stopObserving(window,"resize",this.fitToScreenOuter);Event.observe(window,"resize",this.fitToScreenOuter);Object.extend(this.options,t)},fitToScreen:function(){var t=$("modal-super-image-edit-container");if($$("#cropper_container .container")[0].hasClassName("hidden")){t.setStyle({width:""});t.setStyle({height:""});this.container.setStyle({width:""});this.container.setStyle({height:""})}else{var i=document.documentElement.clientWidth,a=document.documentElement.clientHeight,s=this.image_data.width,r=this.image_data.height,n=parseInt(this.container.getStyle("width")),o=parseInt(this.container.getStyle("height")),l=20,u=20,d=50,c=150;if(typeof this.ctw=="undefined"){this.ctw=n;this.cth=o}else{n=this.ctw;o=this.cth}var _=a-u;if(_<520)_=520;if(_-c-u>r)_=r+c+u;var f=i-l;if(f<400)f=400;if(o<_&&n<f){return}if(o>_){t.setStyle({height:_-c+"px"});this.container.setStyle({height:_+"px"})}if(n>f){t.setStyle({width:f-d>1064-d?1064-d:f-d+"px"});this.container.setStyle({width:f>1064?1064:f+"px"})}}},cancel_image:function(e){if(typeof superlist!="undefined"){superlist.redisplayPreviewIfNecessary()}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter);if(typeof superlist!="undefined"){top.superlist.redisplayPreviewIfNecessary()}},approve_image:function(e){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var a=this.regions.big;t.big_height=a.height;t.big_width=a.width;t.big_top=a.top;t.big_left=a.left}if(typeof superlist!="undefined")superlist.disable_actions();if("image_data"in this&&typeof this.image_data.scale!="undefined")t.scale=this.image_data.scale;bf_standalone_qp.save_image(this.image_data.image,this.image_data.name,t,"/buzzfeed/_edit_quickpost_image");var s=$("buzz-type");var r=s?s.value:"text";if(typeof this.options.callbacks!="undefined"&&typeof this.options.callbacks.finish_save_image!="undefined")this.options.callbacks.finish_save_image(r,this);else user_post.save_quickpost_image(r,this);if(top.$("original_image_crop_data")){top.$("original_image_crop_data").value=Object.toJSON(this.regions)}$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});Event.stopObserving(window,"resize",this.fitToScreenOuter)},customize_cropper:function(t){var i=t.onloadCoords;if(this.regions[this.current_cropping_region]){i.x1=this.regions[this.current_cropping_region].left;i.y1=this.regions[this.current_cropping_region].top;i.x2=this.regions[this.current_cropping_region].left+this.regions[this.current_cropping_region].width;i.y2=this.regions[this.current_cropping_region].top+this.regions[this.current_cropping_region].height;t.minWidth=this[this.current_cropping_region+"_width"];t.minHeight=this[this.current_cropping_region+"_height"];t.ratioDim={x:this[this.current_cropping_region+"_width"],y:this[this.current_cropping_region+"_height"]}}else{var a=this.image_data;var s=a.width/this.options.minWidth;var r=a.height/this.options.minHeight;var n=Math.min(s,r);i.x2=this.options.minWidth*n;i.y2=this.options.minHeight*n}t.onloadCoords=i},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";i.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 625 x 415 pixels. That's as big as the box this message is in! Choose another one below, or hit cancel to try again.";return false}return true},crop_default_size:function(){this.regions.thumb={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.auto_big();this.auto_wide();this.approve_image()},crop_done:function(t,i){this.regions[this.current_cropping_region]={top:t.y1,left:t.x1,height:parseInt(t.y2-t.y1),width:parseInt(t.x2-t.x1),image:this.image_element.src}},auto_big:function(){var t=this.regions.thumb;var i={top:t.top,left:t.left,height:t.height,width:t.width};if(t.width<this.big_width){i.width=this.big_width;i.height=this.big_height;i.top=t.top-parseInt((i.height-t.height)/2);i.left=t.left-parseInt((i.width-t.width)/2);if(i.top<0)i.top=0;if(i.left<0)i.left=0;if(i.top+i.height>this.image_data.height)i.top=this.image_data.height-i.height;if(i.left+i.width>this.image_data.width)i.left=this.image_data.width-i.width}this.regions.big=i},auto_wide:function(){var t=this.regions.big;var i={top:t.top,left:t.left,height:t.height,width:t.width};i.top=t.top+parseInt(t.height/3);i.height=parseInt(this.wide_height*t.width/this.wide_width);this.regions.wide=i},show_thumbs:function(){var t=this;var i=this.image_element;if(!this.manual_big)this.auto_big();if(!this.manual_wide)this.auto_wide();this.cropper_container.select("#big-result-image, #wide-result-image").each(function(a){var s;if(a.id=="wide-result-image")s=t.regions.wide;else if(a.id=="big-result-image")s=t.regions.big;a.up(".scroller").style.width=a.getAttribute("rel:width")+"px";a.up(".scroller").style.height=a.getAttribute("rel:height")+"px";var r=a.getAttribute("rel:width")*1;var n=a.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*r/s.width);var l=Math.round(s.left*r/s.width);var u=Math.round(n*s.top/s.height);a.src=i.src;a.style.margin="-"+u+"px 0 0 -"+l+"px";a.style.width=o+"px";var d=a.up("fieldset").select("button")[0];d.stopObserving("click");d.observe("click",function(e){if(e.target.id=="big-crop-thumb"){this.manual_big=true;this.current_cropping_region="big"}else{this.manual_wide=true;this.current_cropping_region="wide"}$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t))});this.cropper_container.select("#normal-result-image, #small-result-image").each(function(a){var s=t.regions.thumb;a.up(".scroller").style.width=a.getAttribute("rel:width")+"px";a.up(".scroller").style.height=a.getAttribute("rel:height")+"px";var r=a.getAttribute("rel:width")*1;var n=a.getAttribute("rel:height")*1;var o=Math.round(t.image_data.width*r/s.width);var l=Math.round(s.left*r/s.width);var u=Math.round(n*s.top/s.height);a.src=i.src;a.style.margin="-"+u+"px 0 0 -"+l+"px";a.style.width=o+"px"});var a=$("crop-thumb");a.stopObserving("click");a.observe("click",function(){this.current_cropping_region="thumb";$("thumbs").addClassName("hidden");this.approve_button.addClassName("hidden");this.init_cropper()}.bind(t));if(this.options.fitImageAndScreen)this.fitToScreen()}});BF_SUPERPOST_QUIZ_CROPPER=Class.create(BF_IMAGE_CROPPER,{setDefaults:function(){var t={cropper_class:"superpost_quiz",fitImageAndScreen:true,showThumbs:false,showPreview:false,showCropper:true,minWidth:this.options.image_data.crop_width,minHeight:this.options.image_data.crop_height};Object.extend(this.options,t)},fitToScreen:function(){var t=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=this.image_data.width,s=this.image_data.height,r=parseInt(this.container.getStyle("width")),n=parseInt(this.container.getStyle("height")),o=30+0,l=30+0,u=20,d=this.container.select(".bf_dialog_footer")[0].getHeight(),c=20;if(this.container.select("#cropper_container .container")[0].hasClassName("hidden")){var _=this.container.select("#cropper_container #thumbs")[0];a=parseInt(_.getStyle("width"));s=parseInt(_.getStyle("height"))}this.container.setStyle({width:a+"px"});this.container.setAttribute("width",a);this.container.setStyle({height:s+"px"});this.container.setAttribute("height",s);r=parseInt(this.container.getStyle("width"));n=parseInt(this.container.getStyle("height"));this.container.select(".cropperbody")[0].setStyle({width:r+"px"});this.container.select(".cropperbody")[0].setStyle({height:n+"px"});var f=this.container.up(".bf_dialog_content");f.setStyle({width:r+"px"});f.setStyle({height:n+d+"px"});var p=this.container.up(".bf_dialog");p.setStyle({width:r+u+"px"});p.setStyle({height:n+d+c+"px"});var m=document.documentElement.scrollLeft,h=document.body.scrollLeft,g=document.documentElement.scrollTop,b=document.body.scrollTop;p.setStyle({left:((t-r)/2>0?(t-r)/2:0)+(m>h?m:h)+"px"});p.setStyle({top:((i-n)/2>0?(i-n)/2:0)+(g>b?g:b)+"px"});p.setStyle({marginLeft:"0px"});var v=document.documentElement.clientWidth,w=document.documentElement.clientHeight,y=document.body.clientWidth,k=document.body.clientHeight;var z=this.container.up("#super-image-edit").select(".bf_overlay_mask")[0];z.setStyle({width:(v>y?v:y)+"px"});z.setStyle({height:(w>k?w:k)+"px"})},cancel_image:function(e){e.stop();this.close()},save_image:function(e){var t=this.regions["default"];quiz_admin.image_cropper_callback(this.image_data.image,this.image_data.name,this.image_data.format,t);this.close()},customize_cropper:function(t){var i=t.onloadCoords;var a=this.image_data;var s=a.width/this.options.minWidth;var r=a.height/this.options.minHeight;var n=Math.min(s,r);i.x2=this.options.minWidth*n;i.y2=this.options.minHeight*n;t.onloadCoords=i;$("save-image").focus()},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title=t.err||t.message||"Some error happened";i.select(".cerror-message")[0].innerHTML=this.error_message=t.err||t.message;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";i.select(".cerror-message")[0].innerHTML=this.error_message="We need an image at least 170 x 170 pixels. Choose another one below, or hit cancel to try again.";return false}if(this.options.minHeight==t.height&&this.options.minWidth==t.width){this.options.showCropper=false}return true},crop_default_size:function(){this.regions["default"]={top:0,left:0,height:this.options.minHeight,width:this.options.minWidth};this.save_image()},crop_done:function(t,i){this.regions["default"]={top:t.y1,left:t.x1,height:t.y2-t.y1,width:t.x2-t.x1,image:this.image_element.src}}});BF_FLEXPRO_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{template:'		<div class="cropperbody #{cropper_class}">			<div class="content">				#{uploader_template}				<div id="cropper_container">					<div class="container"><img id="image" src="'+trans_gif_1x1_base64+'" class="hidden" /></div>					#{preview_template}					#{thumbs_template}				</div>			</div>			<div class="bf_dialog_footer">				<ul>					<li id="save-button">						<button id="save-image" class="hidden btn--buzz btn--buzz--inline">Save</button>						<button id="preview-thumbs" class="hidden btn--buzz btn--buzz--inline">Save</button>						<button id="approve-thumbs" class="hidden btn--buzz btn--buzz--inline">Looks Good!</button>					</li>					<li><input id="image-cancel" type="button" class="btn--buzz btn--buzz--inline btn--buzz--discrete" value="Cancel" /></li>				</ul>			</div>		</div>',thumbs_template:'		<div id="thumbs" class="hidden">			<div>Are These Thumbnails OK? <span class="help">Thumbnail images may be be used to promote your post so make sure they look good!</span></div>			<fieldset class="big-result">				<div>Big Thumbnail</div>				<div id="big-result" class="results"><div class="scroller"><img id="big-result-image" rel:width="355" rel:height="236" />&nbsp;</div></div>				<button id="big-crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>			<fieldset class="normal-result">				<div>Normal Thumbnails</div>				<div id="normal-result" class="results"><div class="scroller"><img id="normal-result-image" rel:width="125" rel:height="83" />&nbsp;</div></div>				<div id="small-result" class="results"><div class="scroller"><img id="small-result-image" rel:width="90" rel:height="60" />&nbsp;</div></div>				<button id="crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>			<fieldset class="wide-result">				<div>Wide Thumbnail</div>				<div id="wide-result" class="results"><div class="scroller"><img id="wide-result-image" rel:width="355" rel:height="125" />&nbsp;</div></div>				<button id="wide-crop-thumb" class=" btn--buzz btn--buzz--discrete btn--buzz--inline">Change Cropping</button>			</fieldset>		</div>',setDefaults:function(){this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;var t={cropper_class:"flexpro",fitImageAndScreen:false,minWidth:355,minHeight:236};if(this.options.minWidth)t.minWidth=this.options.minWidth;if(this.options.minHeight)t.minHeight=this.options.minHeight;if(this.options.image_data.crop_height!=this.thumb_height||this.options.image_data.crop_width!=this.thumb_width){t={cropper_class:"flexpro",fitImageAndScreen:false,showThumbs:false,showPreview:false,showCropper:true,minHeight:parseInt(this.options.image_data.crop_height),minWidth:parseInt(this.options.image_data.crop_width)}}Object.extend(this.options,t)},check_image:function(t){if(t.uploaded=="false"){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=t.err=="SmallImage"?"That image isn't big enough!":"Some error happened";i.select(".cerror-message")[0].innerHTML=t.err=="SmallImage"?"We need an image that's at least 625px wide x 415px tall. That's as big as the box this message is in! Please choose another one.":t.err;return false}if(this.options.minHeight>t.height||this.options.minWidth>t.width){var i=this.uploader_container.select(".upload-error")[0];i.removeClassName("hidden");i.select(".error-title")[0].innerHTML=this.error_title="That image isn't big enough!";var a;if(this.options.showThumbs)a="We need an image that's at least "+this.options.minWidth+"px wide x "+this.options.minHeight+"px tall. That's as big as the box this message is in! Please choose another one.";else a="We need an image at least "+this.options.image_data.crop_width+" x "+this.options.image_data.crop_height+" pixels. Choose another one below, or hit cancel to try again.";i.select(".cerror-message")[0].innerHTML=this.error_message=a;return false}if(this.options.minHeight==t.height&&this.options.minWidth==t.width){this.options.showCropper=false}return true},save_image:function(){var t=this.regions.thumb;this.options.callbacks.save_image(this.image_data.image,this.image_data.name,t,this.options.controller);this.close()},approve_image:function(){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var a=this.regions.big;t.big_height=a.height;t.big_width=a.width;t.big_top=a.top;t.big_left=a.left}if(this.image_data&&this.image_data.original){t.original={image:this.image_data.original.image,image_width:this.image_data.original.width,height:this.image_data.original.height}}this.options.callbacks.save_image(this.image_data.image,this.image_data.name,t,parent.image_handling.controller);var s=$("buzz-type");var r=s?s.value:"text";this.options.callbacks.finish_save_image(r,this)},cancel_image:function(e){e.stop();$$("#parent-buzz-uploader .qq-upload-list > li").each(function(t){t.remove()});this.close();Event.stopObserving(window,"resize",this.fitToScreenOuter)},fitToScreen:function(){}});BF_OPTIMIZE_CROPPER=Class.create(BF_SUPERPOST_CROPPER,{setDefaults:function(){var t={cropper_class:"",fitImageAndScreen:false,modalIsParent:true,minWidth:355,minHeight:236};this.regions={thumb:false,big:false,wide:false};this.current_cropping_region="thumb";this.manual_wide=false;this.manual_big=false;this.wide_width=625;this.wide_height=220;this.big_width=625;this.big_height=415;this.thumb_width=125;this.thumb_height=83;if(this.options.minWidth)t.minWidth=this.options.minWidth;if(this.options.minHeight)t.minHeight=this.options.minHeight;Object.extend(this.options,t)},fitToScreen:function(){},approve_image:function(e){var t=this.regions.thumb;if(this.regions.wide){var i=this.regions.wide;t.wide_height=i.height;t.wide_width=i.width;t.wide_top=i.top;t.wide_left=i.left}if(this.regions.big){var a=this.regions.big;t.big_height=a.height;t.big_width=a.width;t.big_top=a.top;t.big_left=a.left}if(this.options.image_data.image){t.image=this.options.image_data.image;if(this.options.subid){t.subid=this.options.subid}if(this.options.promoid){t.promoid=this.options.promoid}}if(t.subid){optimize.update_cropping(t)}else if(t.promoid){optimize.update_cropping_in_progress(t)}this.cancel_image()}});BF_PicksController=function(){this.controller="/buzzfeed/_picks";this.switchuser_list=new Template('<option class="pick_switch_user" rel:data="#{user.id}">#{user.display_name}</option>');this.initialized_dialog=false;this.init=function(){if(BF_STATIC&&BF_STATIC["page"]&&BF_STATIC.page.match(/Home/)){return true}if(window.location.pathname.match(/\/submit\/\w+/)){this.init_submissions()}else{var t=(new BF_User).getUserInfo();EventManager.observe("share_button:built",function(t){if(!t.type||!t.el||t.type!="rebuzz_default"){return}t.el.show();t.el.observe("click",picks_controller.launch_pick)});$$(".make_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick)});$$(".microsite-name").each(function(i){i.update(t.display_name)});var i=document.location.pathname.split("/").pop();if(i==t.username){if($("pending-submissions-notice"))$("pending-submissions-notice").show();$$(".delete_pick").each(function(t){$(t.parentNode).show();t.show();t.observe("click",picks_controller.delete_pick)});if(document.location.pathname.match(/\/submissions\//)){$$(".accept_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick_accept)});$$(".delete-pick").each(function(t){t.removeClassName("delete-pick");t.addClassName("accept-pick")})}else{$$(".edit_pick").each(function(t){t.show();t.observe("click",picks_controller.launch_pick_edit)});$$(".add-pick").each(function(i){var a=JSON.parse(i.getAttribute("data"));if(a!=null&&a.username==t.username){$(i.parentNode).hide();i.hide()}else{i.addClassName("edit-pick")}})}}else{$$(".add-pick").each(function(i){var a=JSON.parse(i.getAttribute("rel:data"));if(a&&a.username==t.username){$(i.parentNode).hide();i.hide()}})}}};this.load_picks_dialog=function(t){var i=arguments;if(!this.initialized_dialog){Box.Application.getService("template-engine").load({id:"pick_dialog",returnType:"fragment",callback:function(t){var a=Box.Application.getService("dom");a.appendOnce(t,".js-page-container",".js-pick_dialog");picks_controller.init_picks_dialog.apply(picks_controller,i)}})}else{t()}},this.init_picks_dialog=function(t){if($("pick-buzz-button"))$("pick-buzz-button").observe("click",picks_controller.pick);if($("pick-buzz-cancel-button"))$("pick-buzz-cancel-button").observe("click",function(e){var t=$("pick-buzz-button").getAttribute("rel:buzz_id");if(t){if($(t+"-accept_pick-spinner"))$(t+"-accept_pick-spinner").hide();if($(t+"-make_pick-add"))$(t+"-make_pick-add").show();if($(t+"-make_pick-success"))$(t+"-make_pick-success").hide();if($(t+"-make_pick-spinner"))$(t+"-make_pick-spinner").hide()}});this.initialized_dialog=true;t()};this.init_submissions=function(){picks_controller.add_microsite_id=function(t){t.submit_to_microsite=$("contest-entry-form")&&$("contest-entry-form").getAttribute("rel:submit_to_microsite")};picks_controller.save_image=function(t,i,a,s){var r=a;if(typeof s=="undefined"){s="/buzzfeed/_edit_user_image"}else{r.type=$("buzz-type").value+"buzz"}if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();r.image=t.replace(/\.(jpg|gif)$/,"");r.action="imagecrop";var n=function(t){picks_controller.image_saved(t)};var o=function(){contest_manager.error()};var l=new BF_Request;l.request(s,{method:"post",parameters:r,onSuccess:n,onFailure:o})};picks_controller.image_saved=function(t){if($("user-loading"))$("user-loading").hide();var i=JSON.parse(t.responseText);if(i.saved){if($("quickpost-enhanced-image-file"))$("quickpost-enhanced-image-file").value=i.thumb_image;if($("quickpost-embed-image-file"))$("quickpost-embed-image-file").value=i.thumb_image;if($("quickpost-link-image-file"))$("quickpost-link-image-file").value=i.thumb_image;if($("quickpost-quiz-image-file"))$("quickpost-quiz-image-file").value=i.thumb_image;if($("quickpost-video-image-file"))$("quickpost-video-image-file").value=i.thumb_image;if($("quickpost-image-image-thumb"))$("quickpost-image-image-thumb").value=i.thumb_image;if($("quickpost-image-image-file"))$("quickpost-image-image-file").value=i.large_image;if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+i.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+i.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+i.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+i.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+i.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+i.thumb_image;$("quiz-thumbnail").show()}this.settings.image=i.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};picks_controller.save_ok=function(t){if($("successful-entry"))$("successful-entry").show();if($("select-quickpost-box"))$("select-quickpost-box").hide()};user_post.init();EventManager.observe("user_post:save:success",picks_controller.save_ok);EventManager.observe("user_post:save:preparing",picks_controller.add_microsite_id);var t=new BF_User;if(t.isLoggedIn()){if(t.getUserInfo().terminal_user&&t.getUserInfo().terminal_user=="true"){if($("quickpost-enhanced-settings"))$("quickpost-enhanced-settings").show()}else{if($("quickpost-enhanced-settings"))$("quickpost-enhanced-settings").hide()}var i=new RegExp("/submit/"+t.getUserInfo().username+"$");if(window.location.href.match(i)){if($("error-div"))$("error-div").show()}else if($("contest-entry-form")){$("contest-entry-form").show()}}else{if($("contest-entry-form"))$("contest-entry-form").show();console.warn("signin.open is deprecated. Please use BF_LOGIN_SIGNUP.show")}};this.do_make_request=function(t,i,a,s){var r={action:t,buzz_id:i,note:a};var n=$("pick-buzz-button").getAttribute("rel:switch_user_id");if(typeof n!="undefined"&&n){r.user_id=n}if(typeof legit_switch_users=="undefined")legit_switch_users=[];if(t=="delete"&&"acl"in window&&(acl.user_can("picks_delete_from_anywhere")||legit_switch_users.indexOf((new BF_User).getUserInfo().username)>-1)&&BF_STATIC.tt_page=="User"&&"bf_username"in window){r.username=bf_username}var o=(new BF_User).getUserInfo();if((t=="hide"||t=="show")&&("acl"in window&&acl.user_can("partners_manage")||bf_username==o.username)&&"bf_username"in window){r.username=bf_username}var l=new BF_Request;l.request(picks_controller.controller,{method:"post",parameters:r,onSuccess:s})};this.make_request=function(t,i,a,s){var r=arguments;picks_controller.load_picks_dialog(function(){picks_controller.do_make_request.apply(picks_controller,r)})};this._accept=function(t){var i=JSON.parse(t.responseText);if(i.success){var a=i.buzz_id;if($(a+"-accept_pick-spinner"))$(a+"-accept_pick-spinner").hide();if($("post-"+a))$("post-"+a).appendChild(new Element("span",{"class":"this-post-was-picked"}));if($$("#post-2111731 .accept-pick")&&$$("#post-2111731 .accept-pick")[0])$$("#post-2111731 .accept-pick")[0].hide()}};this.hide_pick=function(e,t){e.stop();var i=e.target;var a=i;while(a.parentNode&&!a.getAttribute("rel:buzz_id")){a=a.parentNode}var s=a.getAttribute("rel:buzz_id");if(s){picks_controller.make_request("hide",s,"",function(i){picks_controller._delete(i);t(i)})}};this.show_pick=function(e,t){e.stop();var i=e.target;var a=i;while(a.parentNode&&!a.getAttribute("rel:buzz_id")){a=a.parentNode}var s=a.getAttribute("rel:buzz_id");if(s){picks_controller.make_request("show",s,"",function(i){picks_controller._delete(i);t(i)})}};this.delete_pick=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var a=i.getAttribute("rel:buzz_id");if(a){if($(a+"-delete_pick-spinner"))$(a+"-delete_pick-spinner").show();picks_controller.make_request("delete",a,"",picks_controller._delete)}};this._delete=function(t){var i=JSON.parse(t.responseText);if(i.success){var a=i.buzz_id;if($(a+"-delete_pick-spinner"))$(a+"-delete_pick-spinner").hide();if($("post-"+a))$("post-"+a).hide()}};this.do_launch_pick=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var a=i.getAttribute("rel:buzz_id");if($("easy_rebuzz"))$("easy_rebuzz").hide();picks_controller.start_spinner(i);(new BF_Request).request(picks_controller.controller,{method:"get",parameters:{buzz_id:a,action:"get_pick"},onSuccess:function(t){picks_controller.easy_rebuzz(e,t)},onFailure:function(t){$("pick-buzz-button").setAttribute("rel:buzz_id",a);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""},evalJSON:true});return};this.launch_pick=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick(e)})};this.do_easy_rebuzz=function(e,t){e.stop();var i=e.target;var a=i;while(a.parentNode&&!a.getAttribute("rel:buzz_id")){a=a.parentNode}var s=a.getAttribute("rel:buzz_id");var r=t.responseText.evalJSON();if(typeof r.success!="undefined"&&r.success==1){if(typeof r.pick!="undefined"&&r.pick!=0){picks_controller.launch_pick_edit(e,t)}else{BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick-buzz-button").setAttribute("rel:buzz_id",s);$("pick-buzz-button").setAttribute("rel:action","pick");$("pick_note").value="";if(typeof r.users!="undefined"){var n='<select id="switchuser_select">';var o=0;for(o=0;o<r.users.length;o++){n+=this.switchuser_list.evaluate({user:r.users[o]})}n+="</select>";if(o>0&&$("rebuzz_switchuser_list")){$("rebuzz_switchuser_list").update(n);if($("easy_rebuzz"))$("easy_rebuzz").show();if($("switchuser_select"))$("switchuser_select").observe("change",function(e){e.stop();$$(".pick_switch_user").each(function(t){if(t.selected){var i=t.getAttribute("rel:data");if(typeof i!=undefined&&i)picks_controller.choose_user(i)}})})}}}}else{$("pick-buzz-button").setAttribute("rel:buzz_id",s);$("pick-buzz-button").setAttribute("rel:action","pick");BF_UI.showDialog("pick_dialog","Add This To Your Feed?");$("pick_note").value=""}};this.easy_rebuzz=function(e,t){picks_controller.load_picks_dialog(function(){picks_controller.do_easy_rebuzz(e,t)})};this.do_launch_pick_edit=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var a=i.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Update Note";$("pick-buzz-button").setAttribute("rel:buzz_id",a);$("pick-buzz-button").setAttribute("rel:action","update_note");$("pick_note").value="";$("pick_note").disabled=true;var s=function(t){$("pick_note").disabled=false;var i=t.responseText.evalJSON();$("pick_note").value=BF_UI.renderEntities(i.pick.note);if(i.pick.is_pick==2&&i.pick.pending_acceptance==1){$("pick-buzz-button").setAttribute("rel:action","accept_pick");$("pick-buzz-button").value="Accept Buzz"}};if(arguments[1]){s(arguments[1])}else{(new BF_Request).request(picks_controller.controller,{method:"get",parameters:{buzz_id:a,action:"get_pick"},onSuccess:s,evalJSON:true})}BF_UI.showDialog("pick_dialog","Edit Your Note")};this.launch_pick_edit=function(e){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_edit(e)})};this.do_launch_pick_accept=function(e){e.stop();var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var a=i.getAttribute("rel:buzz_id");$("pick-buzz-button").value="Accept Buzz";$("pick-buzz-button").setAttribute("rel:buzz_id",a);$("pick-buzz-button").setAttribute("rel:action","accept");BF_UI.showDialog("pick_dialog","Accept a Submission")};this.launch_pick_accept=function(e){if(!picks_controller.initialized_dialog){picks_controller.load_picks_dialog(function(){picks_controller.do_launch_pick_accept(e)})}else{picks_controller.do_launch_pick_accept(e)}};this.choose_user=function(t){$("pick-buzz-button").setAttribute("rel:switch_user_id",t)};this.pick=function(e){e.stop();BF_UI.closeDialog("pick_dialog");var t=e.target;var i=t;while(i.parentNode&&!i.getAttribute("rel:buzz_id")){i=i.parentNode}var a=i.getAttribute("rel:buzz_id");var s=$("pick-buzz-button").getAttribute("rel:action");var r=picks_controller._pick;if(!s)s="pick";if(s=="update_note"){var n=$$("#post-"+a+" .buzznote .what").first();if(n){n.update($F("pick_note").replace(/</g,"&lt;").replace(/>/g,"&gt;"));$$("#post-"+a+" .buzznote").first().show()}}else if(s=="accept"){r=picks_controller._accept}else if(s=="accept_pick"){s="accept"}if(a){picks_controller.make_request(s,a,$F("pick_note"),r);picks_controller.start_spinner(i)}};this._pick=function(t){var i=JSON.parse(t.responseText);if(i.success){var a=i.buzz_id;picks_controller.stop_spinner();var s=new BF_User;if(s.isLoggedIn()){var r=s.getUserInfo().username;var n="your Feed";if(typeof i.username!="undefined"&&i.username&&r!=i.username){n+=" (/"+i.username+")";r=i.username}if($("social_message-rebuzz")){$("social_message-rebuzz").update('<h5><span class="highlight">Rebuzzed!</span> This post has been added to <a href="'+(BF_STATIC?BF_STATIC.web_root:"")+"/"+r+'/">'+n+"</a></h5>");$("social_message-rebuzz").show()}}gtrack.track_events("","share/rebuzz","");
}else{picks_controller.stop_spinner()}};this.stop_spinner=function(){$$(".rebuzz_icon.busy").each(function(e){$(e).removeClassName("busy")})};this.start_spinner=function(t){var i=t.select(".rebuzz_icon");if(i&&i.length){i.first().addClassName("busy")}}};var BoostManager=function(){this.BOOST_DIALOG_ID="bf_boost_dialog";this.BOOST_CALCULATE_CPM_PAGE="/buzzfeed/calculate_cpm";this.BOOST_SUBMIT_PAYMENT="/buzzfeed/buzzboost";this.REGISTER_AND_BOOST_SUBMIT_PAYMENT="/buzzfeed/_temp_wrapper";this.type="paypal";this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.pause=function(t){var i={action:"pause",ad_multiboost_id:t.ad_multiboost_id};var a=t.element.previous(".boost_spinner");a.show();t.element.hide();var s=function(){t.element.siblings().each(function(t){t.show()});a.hide();var i=t.element.up("li");if(i&&i.hasClassName("running")){i.removeClassName("running");i.addClassName("paused")}};var r=new BF_Request;r.request("/buzzfeed/buzzboost",{method:"get",parameters:i,onSuccess:s})};this.unpause=function(t){var i={action:"unpause",ad_multiboost_id:t.ad_multiboost_id};var a=t.element.previous(".boost_spinner");a.show();t.element.hide();var s=function(){t.element.siblings().each(function(t){t.show()});a.hide();var i=t.element.up("li");if(i&&i.hasClassName("paused")){i.removeClassName("paused");i.addClassName("running")}};var r=new BF_Request;r.request("/buzzfeed/buzzboost",{method:"get",parameters:i,onSuccess:s})};this.init=function(t){return;if(t.dialog)this.init_dialog(t);else if(t.create_post)this.init_create_post(t);else{universal_dom.assign_handler({bucket:"boostable",event:"click",handler:bf_boost_manager.load_boost_dialog});universal_dom.assign_handler({bucket:"unpause",event:"click",handler:bf_boost_manager.unpause});universal_dom.assign_handler({bucket:"pause",event:"click",handler:bf_boost_manager.pause});universal_dom.get_bucket_elements("boostable").each(function(t){var i=t.getAttribute("rel:bf_data");if(i){try{var a=JSON.parse(i);var s=parseInt(a.user_id);t.removeClassName("hidden");t.parentNode.removeClassName("hidden")}catch(e){}}});$$(".payment-type").each(function(e){e.observe("click",function(t){bf_boost_manager.toggle_payment()})})}};this.init_dialog=function(t){};this.init_create_post=function(t){if(window.location.href.match(/\/boost(2)?/))return;bf_login.init();user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(t){t.action="save_quickpost";t.anonymous=true});EventManager.observe("user_post:create:opening_form",bf_boost_manager.listen_for_enhanced);EventManager.observe("user_post:save:success",bf_boost_manager.save_ok);if($("facebook_post_to_fanpage_dialog"))$("facebook_post_to_fanpage_dialog").addClassName("hidden");if($("quickpost-save-as-draft"))$("quickpost-save-as-draft").addClassName("hidden");EventManager.observe("user_post:create:opening_form",bf_boost_manager.setup_preview);user_setting={save_image:bf_boost_manager.save_image}};this.setup_preview=function(t){var i=t.buzz_type=="link"?"preview-link-template":"preview-common-template";var a=$(i).innerHTML;a=a.replace(/%7B/g,"{");a=a.replace(/%7D/g,"}");bf_boost_manager.preview_template=new Template(a);var s=new BF_User;var r;if(s.isLoggedIn()){r=s.getUserInfo();if(!r.display_name)r.display_name=r.username;r.user_image=r.image||"/static/images/public/defaults/user.jpg";r.name="Your Title Here!";r.link_buzz="example.com";r.blurb="Your description here.";r.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{r={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}r.form=t.buzz_type;bf_boost_manager.update_preview(r);$("quickpost-title").observe("keyup",function(e){bf_boost_manager.update_preview({name:TT_Filters.html(e.target.value.substr(0,65))})});$("quickpost-description").observe("keyup",function(e){bf_boost_manager.update_preview({blurb:TT_Filters.boost_preview(e.target.value.substr(0,135))})});$("quickpost-link-url").observe("keyup",function(e){bf_boost_manager.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(t){$(t).observe("load",function(e){var t=e.target.getAttribute("src");bf_boost_manager.update_preview({image:t})})})};this.update_preview=function(t){for(var i in t){bf_boost_manager.preview_data[i]=t[i]}var a=bf_boost_manager.preview_template.evaluate(bf_boost_manager.preview_data);$("preview").update(a);$$(".ad_boost_image").each(function(e){e.src=bf_boost_manager.preview_data["image"]});var s=$("preview").getElementsByTagName("A");for(var r=0;r<s.length;r++){s[r].setAttribute("onclick","return false")}};this.listen_for_enhanced=function(t){if(t.buzz_type=="enhanced"){var i=function(t){if(typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined"||typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined"){if(typeof TopList!="undefined")TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper";if(typeof ClassifyQuiz!="undefined")ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}else{if(t<40)setTimeout(function(){i(t+1)},250);else alert("We are unable to process your request at this time")}};i(0)}};this.save_image=function(t,i,a,s){var r=a;if(typeof s=="undefined"){s="/buzzfeed/_edit_user_image"}else{r.type=$("buzz-type").value+"buzz"}if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();r.image=t.replace(/\.(jpg|gif)$/,"");r.action="imagecrop";var n=function(t){bf_boost_manager.image_saved(t)};var o=function(){bf_boost_manager.error()};var l=new BF_Request;l.request(s,{method:"post",parameters:r,onSuccess:n,onFailure:o})};this.image_saved=function(t){if($("user-loading"))$("user-loading").hide();var i=JSON.parse(t.responseText);if(i.saved){if(typeof window["superlist"]!="undefined")return superlist.set_parent_image(t);if($("quickpost-enhanced-image-file"))$("quickpost-enhanced-image-file").value=i.thumb_image;if($("quickpost-embed-image-file"))$("quickpost-embed-image-file").value=i.thumb_image;if($("quickpost-link-image-file"))$("quickpost-link-image-file").value=i.thumb_image;if($("quickpost-quiz-image-file"))$("quickpost-quiz-image-file").value=i.thumb_image;if($("quickpost-video-image-file"))$("quickpost-video-image-file").value=i.thumb_image;if($("quickpost-image-image-thumb"))$("quickpost-image-image-thumb").value=i.thumb_image;if($("quickpost-image-image-file"))$("quickpost-image-image-file").value=i.large_image;if($("quickpost-super-image-file"))$("quickpost-super-image-file").value=i.thumb_image;if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+i.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+i.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+i.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+i.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+i.thumb_image;$("image-preview").show();if($("image-preview-div"))$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+i.thumb_image;$("quiz-thumbnail").show()}if(!Object.isUndefined(this.settings))this.settings.image=i.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(t){if(t.json.updated){window.location.href=BOOST_PAYMENT_FORM+"?buzz_id="+t.json.id}};this.load_boost_dialog=function(t){return;multiboost.get_boosts_setup();var i="boost_modal/select_tier",a=800,s=525;if(multiboost.has_active_multiboost()){if(multiboost.has_added_buzz(t.buzz_id)){i="boost_modal/already_added";s=205}else if(multiboost.has_room_for_more_boosts()){i="boost_modal/add_it";s=190;multiboost.add_buzz_to_boost_list({campaignid:t.buzz_id})}else if(multiboost.tier_id<3){i="boost_modal/upgrade";s=250}else{i="boost_modal/no_more_room";s=260}}BF_UI.create_or_show_dialog({width:a,height:s,scrolling:"no",title:"Boost This!",id:bf_boost_manager.BOOST_DIALOG_ID,url:"/buzzfeed/"+i+"?buzz_id="+t.buzz_id+"&cb="+(new Date).getTime(),onload:[onload]})};this.toggle_payment=function(){var t=$$("input[name=type]:checked").first().value,i=multiboost.tier.default_rate;var a="25";this.type=t;if(t=="paypal"||t=="paypal_account")a="95";if(t=="coupon"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.show()});var s=multiboost.commify(parseInt(parseInt(a)/i,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(t){t.update(s)})}else if(t=="admin"){$("submit").value="Boost It";$$(".cc-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".admin-data-field").each(function(e){e.show()});if($("spend-paypal").value)$("admin-spend").value=$("spend-paypal").value}else if(t=="paypal"){$("submit").value="Charge My Card";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.show()})}else{$("submit").value="Pay with Paypal";$$(".admin-data-field").each(function(e){e.hide()});$$(".coupon-data-field").each(function(e){e.hide()});$$(".cc-data-field").each(function(e){e.hide()});$$(".paypal-data-field").each(function(e){e.show()})}};this.submit=function(t){try{for(var i in t){t[i]=t[i].toString().strip()}if(t["city"]=="City")t["city"]="";if(t["coupon_id"]=="Coupon Code")t["coupon_id"]="";if(t["first_name"]=="First Name")t["first_name"]="";if(t["last_name"]=="Last Name")t["last_name"]="";if(t["street"]=="Street Address")t["street"]="";if(t["zip"]=="Zip Code")t["zip"]="";if(t["cc_type"]=="unknown")t["cc_type"]="";if(this.type=="coupon"&&t["coupon_id"]==""){$("error-dialog").update("Please enter a Coupon Code");$("error-dialog").removeClassName("hidden");$("error-dialog").addClassName("error");return}if(this.type=="admin"){t.amount=$F("admin-spend");t.admin_boost=1}if($("spinner")&&$("payment_form")){$("spinner").removeClassName("hidden");$("submit").addClassName("hidden")}if($("error-dialog"))$("error-dialog").addClassName("hidden");if($("registration-error-dialog"))$("registration-error-dialog").addClassName("hidden");if($("login-error-dialog"))$("login-error-dialog").addClassName("hidden");if(bf_boost_manager.errors){bf_boost_manager.errors.each(function(t){if(document.forms.payment.elements[t]){document.forms.payment.elements[t].removeClassName("error")}})}t.action="multiboost";t.type=this.type;t.amount=Math.floor(t.amount*100)/100;t.amount=t.amount.toString();var a=t.amount.split(".");if(!a[1])a[1]="00";else if(a[1].length==1)a[1]+="0";t.amount=a.join(".");var s=bf_boost_manager.BOOST_SUBMIT_PAYMENT;if(t.register_user=="true"){s=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;t.action="register_user_and_boost";var r=$("registration-error-dialog");if(t.pw.length<6){if(r){r.update("Password must be at least 6 characters");r.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");r.showOnScreen()}return}if(t.username.length<3||t.username.length>30){if(r){r.update("Username must be at least 3 characters and no more than 30 characters");r.removeClassName("hidden");$("spinner").addClassName("hidden");$("submit").removeClassName("hidden");r.showOnScreen()}return}}else if(t.login_user=="true"){s=bf_boost_manager.REGISTER_AND_BOOST_SUBMIT_PAYMENT;t.action="login_user_and_boost"}(new BF_Request).request(s,{method:"post",parameters:t,onComplete:function(t){bf_boost_manager._submit(JSON.parse(t.responseText))}})}catch(e){console.error(e)}};this._submit=function(t){if(t.success==0){var i=$("error-dialog");if(typeof t.login!="undefined"&&!t.login){i=$("login-error-dialog");i.update("Invalid username or password");i.removeClassName("hidden");if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}}else{if($("registration-error-dialog")&&t.error_section=="registration")i=$("registration-error-dialog");if($("login-error-dialog")&&t.error_section=="login")i=$("login-error-dialog");if($("spinner")&&$("payment_form")){$("spinner").addClassName("hidden");$("submit").removeClassName("hidden")}i.removeClassName("hidden");i.update("");var a=document.createElement("ul");a.appendChild(document.createTextNode(t.message));bf_boost_manager.errors=t.errors;var s=false;if("login"==t.error_section)s=true;if("registration"==t.error_section)prepend_register=true;t.errors.each(function(t){if(t=="username"&&s)t="login_username";if(t=="email"&&prepend_register)t="register_email";if(t=="cc_type"){var i=document.createElement("li");i.appendChild(document.createTextNode("Invalid Credit Card"));a.appendChild(i)}if(document.forms.payment.elements[t]){$(document.forms.payment.elements[t]).addClassName("error")}else{var i=document.createElement("li");i.appendChild(document.createTextNode(t));a.appendChild(i)}});i.appendChild(a)}i.showOnScreen()}else if(t.redirect){if(!(new BF_User).isLoggedIn()){bf_login.loggedIn(t)}window.location.href=t.redirect}else if(t.error){var i=$("login-error-dialog");i.removeClassName("hidden");i.update("There is a problem with your account. Please contact us at support@buzzfeed.com");i.showOnScreen()}else{var r=[];["first_name","last_name","street","city","state","zip"].each(function(i){r.push(i+"="+t.params[i])});if(!(new BF_User).isLoggedIn()){bf_login.loggedIn(t)}window.location.href="/buzzfeed/_boost_receipt?transaction_id="+t.transaction_id+"&buzz_id="+t.buzz_id+"&"+r.join("&")}};this.update_expiration_date=function(t){var i=[t.elements.month[t.elements.month.selectedIndex].value,t.elements.year[t.elements.year.selectedIndex].value];var a=true;if(i[0]<10)i[0]="0"+i[0];else i[0]=""+i[0];i.each(function(t){if(t==0)a=false});if(a)t.elements.cc_expires.value=i.join("")};this.cc_checker=[{id:"AMEX",regex:new RegExp("^3")},{id:"VISA",regex:new RegExp("^4")},{id:"MASTERCARD",regex:new RegExp("^5")},{id:"DISCOVER",regex:new RegExp("^6")}];this.update_cc_type=function(t,i,a){var s="unknown";bf_boost_manager.cc_checker.each(function(t){if($(a[t.id]))$(a[t.id]).removeClassName("selected")});bf_boost_manager.cc_checker.each(function(i){if(t.match(i.regex)){s=i.id;if(typeof a[s]!="undefined"&&$(a[s])){$(a[s]).addClassName("selected")}}});if($(i))$(i).value=s}};var bf_boost_manager=new BoostManager;BuzzLoader.register(function(){if(window.location.href.match(/boost_dialog/))bf_boost_manager.init({dialog:true,url:window.location.href});else if(window.location.href.match(/\/boost$/))bf_boost_manager.init({create_post:true});else bf_boost_manager.init({})},2);var BF_MultiBoost=function(){this.debug=function(t,i){if(multiboost.debug){if(!i)i={};i.msg=t;console.dir(i)}};this.preview_data={blurb:"",campaignid:"",display_name:"",form:"",full_uri:"",image:"",name:"",position:"",uri:"",userid:"",username:"",user_image:""};this.boost_list=[];this.TIER_DEFINITIONS={1:{name:"Boost",max_boosts:1,level:1,min_buy:95,max_buy:999,default_rate:.003},2:{name:"Optimized Boost",max_boosts:5,level:2,min_buy:1e3,max_buy:4999,default_rate:.002},3:{name:"Big Seed",max_boosts:10,level:3,min_buy:5e3,max_buy:1e5,default_rate:.002}};this.BOOST_COOKIE_NAME="bf_boost_list";this.FACEBOOK_BUZZ_AD=new Template(' 		<p class="error-message" id="error-message-#{unique_id}" style="display:none;"></p> 		<div class="fb_box c"> 		 <h3 class="bf_dom editable" rel:bf_bucket_data=\'{"edit":{"id":"#{campaignid}","field":"fb_name"}}\'>#{fb_name}</h3><div id="#{campaignid}-fb_name-length" class="blurb_length headline"></div> 		 <div class="c"> 			 <div class="photo"><img src="#{image_root}#{image}" alt="" /></div> 			 <div class="info"> 				 <p class="bf_dom editable" rel:bf_bucket_data=\'{"edit":{"id":"#{campaignid}","field":"fb_blurb"}}\'>#{fb_blurb}</p><div id="#{campaignid}-fb_blurb-length" class="blurb_length"></div> 				 <a rel:gtrack_id="preview/fb-ad/link" class="bf_dom" rel:bf_bucket_data=\'{"edit":{"id":"#{campaignid}","field":"fb_link_url"}}\' href="#{fb_link_url}" onclick="return false" contentEditable="true">#{fb_link_url}</a> 			 </div> 			</div>   		</div> 		<a rel:gtrack_id="preview/fb-ad/edit" class="edit button" href="javascript:;" onclick="multiboost.toggle_fb_contenteditable(this.parentNode); return false;">Edit</a> 		<a rel:gtrack_id="preview/fb-ad/preview" class="bf_dom save button" href="javascript:;" rel:bf_bucket_data=\'{"fb-save":{"id":"#{campaignid}"}}\'>Preview</a> 	');this.FACEBOOK_BUZZ_KEYWORDS=new Template(' 		<div class="c"> 			<div class="interests"> 			  <div class="interest_field"> 					<input rel:gtrack_id="preview/fb-ad/keywords/input" class="keyword" placeholder="Enter an interest" onkeyup="facebook.updateKeywords(\'#{unique_id}\',this.value,true)" type="text" id="kw-#{unique_id}" /> 					<input rel:gtrack_id="preview/fb-ad/keywords/search" id="search-#{unique_id}" onclick="var kw_val = $(\'kw-#{unique_id}\').value; if (kw_val && kw_val.strip() != \'\') {facebook.lookup_keywords(this.parentNode,$(\'kw-#{unique_id}\').value, \'#{unique_id}\');}" type="button" value="+" /> 					<img id="lookup-loading-#{unique_id}" style="display:none;" src="#{static_root}/images/public/spinners/small_on_white.gif" /> 			  	<p style="display:none;" id="users-reach-#{unique_id}">Keyword Reach: <span id="users-#{unique_id}">&hellip;</span></p> 				</div> 				<div style="display: none;" id="keywords-#{unique_id}" onmouseover="clearTimeout(this.hide_timeout);" onmouseout="facebook.keyword_suggest_mouseout(\'#{unique_id}\');" class="keywords_list"></div> 				<ul class="keywords" id="terms-#{unique_id}"></ul> 			</div> 		</div> 		<div class="reach" id="post-reach-#{unique_id}" style="display:none;"><strong>Estimated Reach:</strong> <span id="post-#{unique_id}">&hellip;</span></div> 	');this.COMMA_DELIMITER=/(\d)(\d\d\d)(,\d{3,})*$/;this.get_tier_from_cookie=function(){var t=readCookie(multiboost.BOOST_COOKIE_NAME);var i="1";if(t){var a=JSON.parse(unescape(t));i=a.tier;multiboost.select_tier({tier:i})}return i};this.init=function(){return;try{multiboost.already_boosted=[];multiboost.buzz_cache={};multiboost.set_page({step:"select_tier"});multiboost.get_boosts_setup();multiboost.boost_search_element="search-buzz";multiboost.boost_search_spinner="search-buzz-spinner";multiboost.boost_list_preview_element="selected-buzz";multiboost.boost_list_preview_spinner="selected-buzz-spinner";multiboost.customization_table="customization-table";multiboost.update_cart_icon();if(window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/)){universal_dom.assign_handler({bucket:"update_field",handler:multiboost.update_field});universal_dom.assign_handler({bucket:"select-tier",event:"click",handler:multiboost.select_tier});universal_dom.assign_handler({bucket:"upgrade-tier",event:"click",handler:function(t){multiboost.select_tier({tier:multiboost.tier_id+1});if(t.choose_buzz)multiboost.choose_buzz();if(t.customize_buzz)multiboost.customize_buzz()}});universal_dom.assign_handler({bucket:"upgrade-tier-and-add",event:"click",handler:function(t){multiboost.select_tier({tier:multiboost.tier_id+1});multiboost.add_buzz_to_boost_list({campaignid:t.buzz_id});$("boost_modal_upgrade").hide();$("boost_modal_selected_upgrade").show();if(t.close)multiboost.start_timer(5)}});universal_dom.assign_handler({bucket:"select-tier-and-add",event:"click",handler:function(t){multiboost.select_tier({tier:t.tier});multiboost.add_buzz_to_boost_list({campaignid:t.buzz_id});$("boost_modal_choose_tier").hide();$("boost_modal_selected_tier").show();if(t.close)multiboost.start_timer(8)}});universal_dom.assign_handler({bucket:"confirm-removal-buzz-from-list",event:"click",handler:multiboost.confirm_removal_buzz_from_boost_list});universal_dom.assign_handler({bucket:"close-modal",event:"click",handler:function(){universal_dom.get_bucket_elements("boost-modal").each(function(t){t.hide()})}});universal_dom.assign_handler({bucket:"pull-buzz-from-list",event:"click",handler:multiboost.remove_buzz_from_boost_list});universal_dom.assign_handler({bucket:"add-buzz-to-list",event:"click",handler:multiboost.add_buzz_to_boost_list});universal_dom.assign_handler({bucket:"search-next-page",event:"click",handler:function(e){multiboost.search_page++}});universal_dom.assign_handler({bucket:"search-previous-page",event:"click",handler:function(e){multiboost.search_page--}});universal_dom.assign_handler({bucket:"user-search-input",event:"keypress",handler:function(e){if(e.keyCode==Event.KEY_RETURN){Event.stop(e);multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}}});universal_dom.assign_handler({bucket:"user-search",event:"click",handler:function(e){multiboost.search_page=0;multiboost.search_for_user_posts({username:$("username_search_input").value})}});universal_dom.assign_handler({bucket:"open-search",event:"click",handler:multiboost.open_search});universal_dom.assign_handler({bucket:"change-tier",event:"click",handler:function(){multiboost.set_page({step:"select_tier"})}});universal_dom.assign_handler({bucket:"choose-buzz",event:"click",handler:multiboost.choose_buzz});universal_dom.assign_handler({bucket:"customize-buzz",event:"click",handler:multiboost.customize_buzz});universal_dom.assign_handler({bucket:"edit",event:"keyup",handler:multiboost.edit_buzz});universal_dom.assign_handler({bucket:"fb-save",event:"click",handler:function(t){multiboost.toggle_fb_contenteditable(t.element.parentNode);multiboost.edit_buzz(t)}});universal_dom.assign_handler({bucket:"set-page",event:"click",handler:multiboost.set_page});universal_dom.assign_handler({bucket:"save-buzz",event:"click",handler:function(t){t.target.form=$("edit-quickpost-form");user_post.save_quickpost(t)}});universal_dom.assign_handler({bucket:"boost_payment",event:"click",handler:multiboost.boost_payment});universal_dom.assign_handler({bucket:"update_amount",event:"blur",handler:multiboost.update_amount});universal_dom.assign_handler({bucket:"reboost",event:"click",handler:multiboost.reboost});universal_dom.assign_handler({bucket:"boost-help",event:"click",handler:multiboost.help_dialog});multiboost.refresh_boosted_buzz_preview();multiboost.search_page=1;if(window.location.href.match(/\/(buzz)?(old_)?boost(2)?/)){if(typeof user_post!="undefined"){user_post.init();user_post.CONTRIBUTE_URL="/buzzfeed/_temp_wrapper";user_post.ENHANCED_URL="/buzzfeed/_temp_wrapper";EventManager.observe("user_post:save:preparing",function(t){t.action="save_quickpost";t.anonymous=true;t.manual_moderation=1});EventManager.observe("user_post:create:opening_form",multiboost.listen_for_enhanced);EventManager.observe("user_post:save:success",multiboost.save_ok);EventManager.observe("user_post:create:opening_form",multiboost.setup_preview);user_setting={save_image:multiboost.save_image}}}if(typeof facebook!="undefined"){facebook.FB_KEYWORDS_CONTROLLER="/buzzfeed/_temp_wrapper"}if(multiboost.tier&&window.location.href.indexOf("#customize")!=-1){var t=0,i=function(){try{multiboost.customize_buzz()}catch(e){if(t<=10)setTimeout(i,250);t++}};i()}}}catch(e){}};this.get_boosts_setup=function(){multiboost.boost_list=multiboost.load_boost_list();multiboost.tier_id=multiboost.get_tier_from_cookie();multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id]};this.contact_customer_service=function(){var t=new top.BF_User;return window.location.href.indexOf("/old_boost")!=-1&&t.isLoggedIn()&&t.getUserInfo().f_raw==0};this.commify=function(t){t=t+"";while(t.match(multiboost.COMMA_DELIMITER))t=t.replace(multiboost.COMMA_DELIMITER,"$1,$2$3");return t};this.reboost=function(t){if(!t.ad_multiboost_id)return;var i=new BF_Request;i.request("/buzzfeed/buzzboost",{method:"get",parameters:{action:"reboost",ad_multiboost_id:t.ad_multiboost_id}})};this.has_active_multiboost=function(){var t=readCookie(multiboost.BOOST_COOKIE_NAME);return t!=null};this.has_room_for_more_boosts=function(){if(!multiboost.has_active_multiboost)return false;return multiboost.tier.max_boosts-multiboost.boost_list.length};this.update_field=function(data,args){var value=eval(args.value),comma_delimiter=eval(args.comma_delimiter);if(comma_delimiter)value=multiboost.commify(value);args.element.update(value)};this.update_amount=function(t){$("submit").removeClassName("hidden");var i=parseInt(t.element.value,10),a=multiboost.tier.default_rate,s=multiboost.tier.min_buy,r=multiboost.tier.max_buy;if(!i||i==NaN)i=0;if(i<s||i>r){if($("amount-error-field")&&$("amount-error-field-text")){$("amount-error-field-text").update("Your amount must be between $"+multiboost.commify(s)+" and $"+multiboost.commify(r)+".");$("amount-error-field").show();$("submit").addClassName("hidden")}i=""}else{if($("amount-error-field"))$("amount-error-field").hide()}t.element.value=i;var n=multiboost.commify(parseInt(i/a,10));universal_dom.get_bucket_elements("minimum_impressions").each(function(t){t.update(n)})};this.boost_payment=function(){var t={};var i=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");for(var a in multiboost.buzz_cache){var s=multiboost.buzz_cache[a];if(s.fb_blurb){s.fb_blurb=s.fb_blurb.unescapeHTML();s.fb_blurb=s.fb_blurb.replace(/<[^>]*>/g,"").substr(0,89);s.fb_blurb=s.fb_blurb.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(s.fb_blurb.match(i)){s.fb_blurb=s.fb_blurb.replace(i,"$1 $2")}}if(s.fb_name){s.fb_name=s.fb_name.unescapeHTML();s.fb_name=s.fb_name.replace(/<[^>]*>/g,"").substr(0,24);s.fb_name=s.fb_name.replace(/[^\w\d \.\,\!\'\"\?]/g,"");while(s.fb_name.match(i)){s.fb_name=s.fb_name.replace(i,"$1 $2")}}t[a]={name:multiboost.buzz_cache[a].fb_name,blurb:multiboost.buzz_cache[a].fb_blurb}}var r=readCookie(multiboost.BOOST_COOKIE_NAME);obj=JSON.parse(unescape(r))||{};obj.overrides=t;createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON(obj)),null,".buzzfeed.com");window.location.href=BOOST_PAYMENT_FORM};this.set_page=function(t){universal_dom.get_bucket_elements("step").each(function(t){var i=t.getAttribute("rel:bf_bucket_data");var a=JSON.parse(i);t.removeClassName("selected");universal_dom.get_bucket_elements(a.step).each(function(t){t.addClassName("hidden")})});universal_dom.get_bucket_elements("step").each(function(i){var a=i.getAttribute("rel:bf_bucket_data");var s=JSON.parse(a);if(s.step==t.step){i.addClassName("selected");universal_dom.get_bucket_elements(s.step).each(function(t){t.removeClassName("hidden")})}});multiboost._retrigger_gtrack("1")};this.open_search=function(){$(multiboost.boost_search_element).update("");if(multiboost.exceeded_max_boosts())return;else multiboost.set_page({step:"search"});var t=new BF_User;if(t.isLoggedIn()){universal_dom.get_bucket_elements("user-search-input").each(function(i){i.value=t.getUserInfo().username})}};this.choose_buzz=function(){multiboost.search_page=1;multiboost.set_page({step:"choose"});universal_dom.get_bucket_elements("selected-buzz-count").each(function(t){t.update(multiboost.boost_list.length)});if($("select-quickpost-box"))$("select-quickpost-box").show();if(multiboost.boost_list&&multiboost.boost_list.length>0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(t){t.removeClassName("hidden")})}};this.setup_preview=function(t){var i=t.buzz_type=="link"?"preview-link-template":"preview-common-template";if(!i||!$(i))return;var a=$(i).innerHTML;a=a.replace(/%7B/g,"{");a=a.replace(/%7D/g,"}");multiboost.preview_template=new Template(a);var s=new BF_User;var r;if(s.isLoggedIn()){r=s.getUserInfo();if(!r.display_name)r.display_name=r.username;r.user_image=r.user_image||"/static/images/public/defaults/user.jpg";r.name="Your Title Here!";r.link_buzz="example.com";r.blurb="Your description here.";r.image=BF_STATIC.image_root+"/static/images/public/defaults/thumb.png"}else{r={display_name:"You!",username:"anonymous",userid:0,blurb:"Your description here.",user_image:"/static/images/public/defaults/user.jpg",image:BF_STATIC.image_root+"/static/images/public/defaults/thumb.png",name:"Your Title Here!",link_buzz:"example.com"}}r.form=t.buzz_type;multiboost.update_preview(r);$("quickpost-title").observe("keyup",function(e){multiboost.update_preview({name:TT_Filters.html(e.target.value)})});$("quickpost-description").observe("keyup",function(e){multiboost.update_preview({blurb:TT_Filters.boost_preview(e.target.value)})});$("quickpost-link-url").observe("keyup",function(e){multiboost.update_preview({link_buzz:TT_Filters.html(e.target.value)})});["video-link-thumbnail","image-preview","embed-thumbnail","link-thumbnail"].each(function(t){$(t).observe("load",function(e){var t=e.target.getAttribute("src");multiboost.update_preview({image:t})})});multiboost.set_page({step:"create-buzz"})};this.update_preview=function(t){for(var i in t){multiboost.preview_data[i]=t[i]}var a=multiboost.preview_template.evaluate(multiboost.preview_data);$("preview").update(a);var s=$("preview").getElementsByTagName("A");for(var r=0;r<s.length;r++){s[r].setAttribute("onclick","return false")}};this.save_image=function(t,i,a,s){var r=a;if(typeof s=="undefined"){s="/buzzfeed/_edit_user_image"}else{r.type=$("buzz-type").value+"buzz"}if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();r.image=t.replace(/\.(jpg|gif)$/,"");r.action="imagecrop";var n=function(t){multiboost.image_saved(t)};var o=function(){multiboost.error()};var l=new BF_Request;l.request(s,{method:"post",parameters:r,onSuccess:n,onFailure:o})};this.image_saved=function(t){if($("user-loading"))$("user-loading").hide();var i=JSON.parse(t.responseText);if(i.saved){if($("quickpost-enhanced-image-file"))$("quickpost-enhanced-image-file").value=i.thumb_image;if($("quickpost-embed-image-file"))$("quickpost-embed-image-file").value=i.thumb_image;if($("quickpost-link-image-file"))$("quickpost-link-image-file").value=i.thumb_image;if($("quickpost-quiz-image-file"))$("quickpost-quiz-image-file").value=i.thumb_image;if($("quickpost-video-image-file"))$("quickpost-video-image-file").value=i.thumb_image;if($("quickpost-image-image-thumb"))$("quickpost-image-image-thumb").value=i.thumb_image;if($("quickpost-image-image-file"))$("quickpost-image-image-file").value=i.large_image;if($("enhanced-thumbnail")){$("enhanced-thumbnail").src=bf_ir+i.thumb_image;$("enhanced-thumbnail").show()}if($("embed-thumbnail")){$("embed-thumbnail").src=bf_ir+i.thumb_image;$("embed-thumbnail").show()}if($("link-thumbnail")){$("link-thumbnail").src=bf_ir+i.thumb_image;$("link-thumbnail").show()}if($("video-link-thumbnail")){$("video-link-thumbnail").src=bf_ir+i.thumb_image;$("video-link-thumbnail").show()}if($("image-preview")){$("image-preview").src=bf_ir+i.thumb_image;$("image-preview").show();$("image-preview-div").show()}if($("quiz-thumbnail")){$("quiz-thumbnail").src=bf_ir+i.thumb_image;$("quiz-thumbnail").show()}this.settings.image=i.image}else{this.error(this.IMAGE_ERR);$("enhanced-thumnail").hide();$("embed-thumnail").hide();$("link-thumnail").hide();$("quiz-thumnail").hide();$("video-link-thumbnail").hide()}};this.save_ok=function(t){multiboost.add_buzz_to_boost_list({campaignid:t.json.id});multiboost.set_page({step:"choose"})};this.exceeded_max_boosts=function(){var t=false;if(multiboost.tier&&multiboost.boost_list.length>=multiboost.tier.max_boosts){var i="You cannot create more boosts. ";if(multiboost.tier.max_boosts<10){var a=parseInt(multiboost.tier_id)+1+"";var s=multiboost.TIER_DEFINITIONS[a]?multiboost.TIER_DEFINITIONS[a]:false;
i+="You can upgrade to "+(s?s.name:"a higher plan")+" if you want more boosts."}alert(i);t=true;window.setTimeout(multiboost.choose_buzz,250)}return t};this.listen_for_enhanced=function(t){if(multiboost.exceeded_max_boosts())return;if(t.buzz_type=="enhanced"){var i=function(t){if(typeof TopList!="undefined"&&typeof TopList.EDIT_ENHANCED_IMAGE!="undefined"||typeof ClassifyQuiz!="undefined"&&typeof ClassifyQuiz.EDIT_ENHANCED_IMAGE!="undefined"){if(typeof TopList!="undefined")TopList.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper";if(typeof ClassifyQuiz!="undefined")ClassifyQuiz.EDIT_ENHANCED_IMAGE="/buzzfeed/_temp_wrapper"}else{if(t<40)setTimeout(function(){i(t+1)},250);else alert("We are unable to process your request at this time.")}};i(0)}};this.select_tier=function(t){if(multiboost.contact_customer_service()){alert("There is a problem with your account. Please contact support@buzzfeed.com")}else{multiboost.tier_id=t.tier;multiboost.tier=multiboost.TIER_DEFINITIONS[multiboost.tier_id];if(!multiboost.tier)return;var i=readCookie(multiboost.BOOST_COOKIE_NAME),a=parseInt(multiboost.tier_id)+1+"";var s=multiboost.TIER_DEFINITIONS[a]?multiboost.TIER_DEFINITIONS[a]:false;obj=JSON.parse(unescape(i))||{};if(multiboost.boost_list.length>multiboost.tier.max_boosts)multiboost.boost_list=multiboost.boost_list.splice(0,multiboost.tier.max_boosts);createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");multiboost.refresh_boosted_buzz_preview();multiboost.choose_buzz();universal_dom.get_bucket_elements("current-tier").each(function(t){t.update(multiboost.tier.name)});universal_dom.get_bucket_elements("next-tier").each(function(t){t.update(s&&s.name?s.name:multiboost.tier.name)});universal_dom.get_bucket_elements("max-buzz-for-tier").each(function(t){t.update(multiboost.tier.max_boosts)});if(multiboost.boost_list&&multiboost.boost_list.length>0)universal_dom.get_bucket_elements("has-no-buzz").each(function(t){t.hide()})}};this.load_boost_list=function(){var t=[];var i=readCookie(multiboost.BOOST_COOKIE_NAME);if(i){obj=JSON.parse(unescape(i));t=obj.boosts}return t};this.boost_list_upsell=function(){if(multiboost.boost_list.length>=multiboost.tier.max_boosts&&multiboost.tier.level<3){var t=$(multiboost.boost_list_preview_element);t.select(".upsell").each(function(t){t.remove()});var i=document.createElement("li"),a=parseInt(multiboost.tier_id)+1+"";var s=multiboost.TIER_DEFINITIONS[a]?multiboost.TIER_DEFINITIONS[a]:false;i.className="upsell preview";i.innerHTML='<div class="msg">Want to boost more posts?<br /><a href="javascript:;" rel:gtrack_id="upgrade-tier/choose" class="bf_dom" rel:bf_bucket_data=\'{"upgrade-tier":{"choose_buzz":true}}\' onclick="return false;">'+"Upgrade</a> to "+(s?s.name:"a higher plan")+".</div>";t.appendChild(i);universal_dom.update(t)}};this.already_boosted_this=function(t){alert("This buzz already has been boosted and cannot be reboosted until its current campaign finishes.");multiboost.remove_buzz_from_boost_list({id:t})};this.add_buzz_to_boost_list=function(t){if(multiboost.exceeded_max_boosts())return;var i=t.campaignid;if(!i)multiboost.debug("add_buzz_to_boost_list requires campaignid",t);var a=true;multiboost.already_boosted.each(function(i){if(i==t.campaignid){multiboost.already_boosted_this(i);a=false}});if(a){if(multiboost.boost_list.length<multiboost.tier.max_boosts){var s=false;multiboost.boost_list.each(function(t){if(i==t)s=true});if(!s)multiboost.boost_list.push(i)}var r=readCookie(multiboost.BOOST_COOKIE_NAME);obj=JSON.parse(unescape(r))||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:obj.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(t){t.update(multiboost.boost_list.length)});universal_dom.get_bucket_elements("has-no-buzz").each(function(t){t.hide()});multiboost.refresh_boosted_buzz_preview();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length)universal_dom.get_bucket_elements("requires-selected-buzz").each(function(t){t.removeClassName("hidden")})}multiboost._retrigger_gtrack("2")};this.help_dialog=function(t){if(!t.article)return false;universal_dom.get_bucket_elements("boost-help-dialog").each(function(i){i.select(".article").each(function(i){if(i.id==t.article){i.show()}else{i.hide()}});i.removeClassName("hidden");i.show()})};this.confirm_removal_buzz_from_boost_list=function(t){universal_dom.get_bucket_elements("remove-buzz").each(function(i){i.args=t;universal_dom.assign_handler({bucket:"remove-buzz-button",event:"click",handler:function(e){multiboost.remove_buzz_from_boost_list(i.args);i.hide()}});i.removeClassName("hidden");i.show()})};this.remove_buzz_from_boost_list=function(t){var i=t.campaignid;if(!i)multiboost.debug("add_buzz_to_boost_list requires campaignid",t);var a=[];multiboost.boost_list.each(function(t){if(t!=i)a.push(t)});delete multiboost.buzz_cache[i];multiboost.boost_list=a;var s=readCookie(multiboost.BOOST_COOKIE_NAME);var r=JSON.parse(unescape(s))||{};createCookie(multiboost.BOOST_COOKIE_NAME,encodeURIComponent(Object.toJSON({tier:multiboost.tier_id,boosts:multiboost.boost_list,overrides:r.overrides})),null,".buzzfeed.com");universal_dom.get_bucket_elements("selected-buzz-count").each(function(t){t.update(multiboost.boost_list.length)});if(multiboost.boost_list.length==0)universal_dom.get_bucket_elements("has-no-buzz").each(function(t){t.show()});multiboost.refresh_boosted_buzz_preview();multiboost.update_customized_buzz();try{if(window!=window.top){window.top.multiboost.get_boosts_setup();window.top.multiboost.update_cart_icon()}else{multiboost.update_cart_icon()}}catch(e){}if(multiboost.boost_list.length==0){universal_dom.get_bucket_elements("requires-selected-buzz").each(function(t){t.addClassName("hidden")})}multiboost._retrigger_gtrack("3")};this.refresh_boosted_buzz_preview=function(){if(!window.location.href.match(/\/(buzz|_)?(old_)?boost(2)?(_modal)?/))return;if(!multiboost.tier)return;var t=[];multiboost.boost_list.each(function(i){if(!multiboost.buzz_cache[i])t.push(i)});if(t.length>0){var i=(new BF_Request).request;i("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"get_buzzes",buzz_ids:t.join(",")},onSuccess:multiboost._refresh_boosted_buzz_preview,while_processing:{show:multiboost.boost_list_preview_spinner,hide:multiboost.boost_list_preview_element}})}else{multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(t){return multiboost.buzz_cache[t]})})}};this._refresh_boosted_buzz_preview=function(t){var i=JSON.parse(t.responseText);i.buzzes.each(function(t){multiboost.buzz_cache[t.campaignid]=t});var a=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).map(function(t){return multiboost.buzz_cache[t]});multiboost._refresh_buzz_preview({container:$(multiboost.boost_list_preview_element),buzz_list:a});multiboost.update_customized_buzz()};this._refresh_buzz_preview=function(t){if(!t.container)return;var i=$(t.container),a=t.buzz_list,s={},r=new RegExp("<h3>"),n=new RegExp('<p class="description">');i.innerHTML="";if(a&&a.length>0){a.each(function(a){var r;if(a){a.image_root=BF_STATIC.image_root;a.user_image=a.user_image||"/static/images/public/defaults/user.jpg";if(!t.template){var n=a.form=="link"?"preview-link-template":"preview-common-template";if(!s[n]){template_str=$(n).innerHTML;template_str=template_str.replace(/%7B/g,"{");template_str=template_str.replace(/%7D/g,"}");s[n]=new Template(template_str)}r=s[n]}else{r=t.template}a.static_root=BF_STATIC.static_root;var o=r.evaluate(a);var l=document.createElement("li");l.className="preview"+(multiboost.buzz_cache[a.campaignid]?" selected":"")+(a.boosted?" already_boosted":"");l.innerHTML=o;i.appendChild(l);try{if(a.boosted)multiboost.already_boosted.push(a.campaignid)}catch(e){}}});var o=i.getElementsByTagName("img");for(var l=0;l<o.length;l++){$(o[l]).removeClassName("ad_boost_image")}}multiboost.boost_list_upsell();universal_dom.update(i)};this.search_for_user_posts=function(t){var i=t.username,a=(new BF_Request).request,s=$$("#modal_search .pagination").first();if(i=="")return false;if(s)s.hide();if(multiboost.search_page<1)multiboost.search_page=1;a("/buzzfeed/_temp_wrapper",{method:"get",parameters:{action:"recent_buzz",usernames:i,flag_boosted:1,page:multiboost.search_page},onSuccess:multiboost._search_for_user_posts,while_processing:{show:multiboost.boost_search_spinner,hide:multiboost.boost_search_element}})};this._search_for_user_posts=function(t){var i=JSON.parse(t.responseText),a=$(multiboost.boost_search_element),s=$$("#modal_search .pagination").first();if(i.buzzes&&i.buzzes.length>0){multiboost._refresh_buzz_preview({container:a,buzz_list:i.buzzes});if(s)s.show()}else{a.innerHTML='<p class="suggest">No posts were found. Please check to see if the username exists.</p>';if(s)s.hide()}multiboost._retrigger_gtrack("5")};this.customize_buzz=function(){if(!multiboost.contact_customer_service()){multiboost.set_page({step:"customize"});multiboost.update_customized_buzz()}};this.toggle_fb_contenteditable=function(t){var i=t.hasClassName("contenteditable");t.select(".editable").each(function(t){if(i){t.contentEditable=false;t.removeAttribute("contentEditable");var a=JSON.parse(t.getAttribute("rel:bf_bucket_data"));t.innerHTML=multiboost.buzz_cache[a.edit.id][a.edit.field]}else{t.setAttribute("contentEditable",true)}});if(i){t.removeClassName("contenteditable")}else{t.addClassName("contenteditable")}return false};this.filter_facebook_text=function(t){return t.replace(/<[^>]*>/g,"").replace(/(&rsquo;|&lsquo;)/gi,"'").replace(/(&rdquo;|&ldash;)/gi,'"').replace(/(&mdash;|&ndash;)/gi,"-").replace(/&([A-Z0-9\-\#]+);/gi,"").replace(/[^\w\d \-\;\&\.\,\!\'\"\?]/g,"")};this.update_customized_buzz=function(){var t=multiboost.boost_list.slice(0,multiboost.tier.max_boosts).reject(function(t){return typeof multiboost.buzz_cache[t]=="undefined"}).map(function(t){return multiboost.buzz_cache[t]});var i=document.createElement("ul");i.className="hidden";var a=document.createElement("ul");a.className="hidden";var s=document.createElement("ul");s.className="hidden";document.getElementsByTagName("BODY")[0].appendChild(i);document.getElementsByTagName("BODY")[0].appendChild(a);document.getElementsByTagName("BODY")[0].appendChild(s);var r=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");t.each(function(t){if(!t)return;if(!t.link_url)t.link_url="";if(!t.fb_name){t.fb_name=t.title.unescapeHTML();t.fb_name=multiboost.filter_facebook_text(t.fb_name).substr(0,24).strip();while(t.fb_name.match(r))t.fb_name=t.fb_name.replace(r,"$1 $2")}if(!t.fb_blurb){t.fb_blurb=t.blurb.unescapeHTML();t.fb_blurb=multiboost.filter_facebook_text(t.fb_blurb).substr(0,89).strip();while(t.fb_blurb.match(r))t.fb_blurb=t.fb_blurb.replace(r,"$1 $2")}if(!t.fb_link_url)t.fb_link_url=t.link_url.replace(/<[^>]*>/g,"");t.unique_id=t.campaignid});multiboost._refresh_buzz_preview({container:i,buzz_list:t});multiboost._refresh_buzz_preview({container:a,buzz_list:t,template:multiboost.FACEBOOK_BUZZ_AD});multiboost._refresh_buzz_preview({container:s,buzz_list:t,template:multiboost.FACEBOOK_BUZZ_KEYWORDS});boosts=i.getElementsByTagName("LI");fbs=a.getElementsByTagName("LI");kws=s.getElementsByTagName("LI");var n=$(multiboost.customization_table);n.update("");n.addClassName("loading");for(var o=0;o<boosts.length;o++){var l=document.createElement("tr"),u=document.createElement("td"),d=document.createElement("td"),c=document.createElement("td"),_=document.createElement("td"),f=document.createElement("td");l.id="preview-"+t[o].campaignid;u.className="notice";u.innerHTML='<div class="cellbox c"><span>&nbsp;</span></div>';l.appendChild(u);d.className="boost_preview";d.innerHTML='<div class="cellbox c">'+boosts[o].innerHTML+"</div>";l.appendChild(d);if(multiboost.tier.level==1){c.className="fb_preview upsell";var p=parseInt(multiboost.tier_id)+1+"";var m=multiboost.TIER_DEFINITIONS[p]?multiboost.TIER_DEFINITIONS[p]:false;c.colSpan=2;c.innerHTML='<div class="cellbox c"><div class="msg"><a href="javascript:;" rel:gtrack_id="upgrade-tier/customize" class="bf_dom" rel:bf_bucket_data=\'{"upgrade-tier":{"customize_buzz":true}}\' onclick="return false;">Upgrade</a> to '+(m?m.name:"a higher plan")+" for Facebook promotion. </div></div>";l.appendChild(c)}else{c.className="fb_preview";if(fb_errors){if(fb_errors[t[o].campaignid])c.className+=" fb_err";else c.className+=" fb_ok"}c.innerHTML='<div class="cellbox c">'+fbs[o].innerHTML+"</div>";l.appendChild(c);_.className="targeting";_.innerHTML=multiboost.hide_targeting?"&nbsp;":'<div class="cellbox c">'+kws[o].innerHTML+"</div>";l.appendChild(_)}f.className="actions";f.innerHTML='<div class="cellbox c"><a class="bf_dom pull-it" href="" title="Remove from Campaign" onclick="return false" rel:bf_bucket_data=\'{"confirm-removal-buzz-from-list":{"campaignid":"'+t[o].campaignid+"\"}}'></a></div>";l.appendChild(f);n.appendChild(l);if(multiboost.tier.level!=1)multiboost.toggle_fb_contenteditable($$("#preview-"+t[o].campaignid+" .fb_preview .cellbox").first());multiboost.updateMaxLength(t[o].campaignid+"-fb_name-length",24,t[o].fb_name.length);multiboost.updateMaxLength(t[o].campaignid+"-fb_blurb-length",89,t[o].fb_blurb.length)}universal_dom.update(n);multiboost._retrigger_gtrack("6");n.removeClassName("loading");i.parentNode.removeChild(i);a.parentNode.removeChild(a);s.parentNode.removeChild(s)};this.edit_buzz=function(t){var i=t.target.innerHTML;if(t.update)i=i.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/<[^>]*>/g,"");i=i.replace(/&nbsp;/gi," ");i=i.replace(/<br>/gi,"");var a=t.field=="fb_name"?24:89;if(i.length>a){i=i.substr(0,a)}var s=new RegExp("([^a-z0-9 ])([^a-z0-9 ])","i");i=i.replace(/[^\w\d \.\,\!\']/g,"");while(i.match(s)){i=i.replace(s,"$1 $2")}multiboost.buzz_cache[t.id][t.field]=i;multiboost.buzz_cache[t.id].edited=true;$$("#preview-"+t.id+" td.notice").first().removeClassName("warning");if(t.update){multiboost.update_customized_buzz()}if(t.field=="fb_name"||t.field=="fb_blurb"){multiboost.updateMaxLength(t.id+"-"+t.field+"-length",a,i.length)}};this.i_am_selected=function(t){while(t.tagName.toLowerCase()!="li"&&t.parentNode)t=t.parentNode;if(t.tagName.toLowerCase()=="li")t.addClassName("selected")};this.updateMaxLength=function(t,i,a){var s=i-a;if($(t))$(t).update('<span class="'+(s<=5?"warning":"")+'">'+s+"</span> "+"character"+(s==1?"":"s")+" "+"remaining")};this.has_added_buzz=function(t){var i=false;if(!multiboost.boost_list)multiboost.boost_list=[];multiboost.boost_list.slice(0,multiboost.tier.max_boosts).each(function(a){if(t==a){i=true;throw $break}});return i};this.update_cart_icon=function(){if(!multiboost.tier)return;var t=multiboost.boost_list?multiboost.boost_list.slice(0,multiboost.tier.max_boosts).length:0;universal_dom.get_bucket_elements("boost-cart").each(function(i){if(t>0){if(!i.hasClassName("boost"))i.addClassName("boost");i.update('<a href="'+BF_STATIC.web_root+'/boost" rel:gtrack_id="utils/boost/'+t+'"><span class="text">Boost</span><span class="num">'+t+"</span></a>")}else{i.removeClassName("boost");i.update('<a rel:gtrack_id="utils/advertise" href="'+BF_STATIC.web_root+'/advertise">Advertise</a>')}var a=i.up(".has_gtrack_unit");if(a)gtrack._init(a)})};this._retrigger_gtrack=function(t){var i=$("multiboost_container");if(i&&typeof gtrack!="undefined")gtrack._init(i,{skip_impression:true})};this.start_timer=function(t){$("modal_close_timer_seconds").update(t+" second"+(t!=1?"s":""));$("modal_close_timer").show();var i=setInterval(function(){--t;$("modal_close_timer_seconds").update(t+" second"+(t!=1?"s":""));if(t<1){clearInterval(i);top.BF_UI.closeDialog(bf_boost_manager.BOOST_DIALOG_ID,{})}},1e3)}};var multiboost=new BF_MultiBoost;BuzzLoader.register(multiboost.init,2);var trackToBfa=function(t,i,a,s,r){if(!window.bfa||!(window.bfa instanceof Function)||!window.bfaBinder||s!=="play"){return}var n=bfaBinder.parser.findLocation(t);bfa("track","click","Video-Play",n,"",{videoUrl:a})};var trackVideo=function(t,i,a,s){if(!a){a=""}if(!s){s=""}var r=$(t);var n=r[bfjs.read_attr]("src");if(!n){n=s}var o=n?n.split("?").length>=0?n.split("?")[0].replace(new RegExp(/^http:\/\//i),"").replace(new RegExp(/^www\./i),""):"":"";var l=gtrack.findCatLabel(t);var u=l?l:gtrack.tt_page;var d={ready:function(){gtrack.track_events(u,a+"[nc]video:load",o,null,true)},finish:function(){gtrack.track_events(u,a+"[nc]video:end",o,null,true)},play:function(){gtrack.track_events(u,a+"video-play",o,null,true);document.fire("video:play",{playerid:t})},progression_25:function(){gtrack.track_events(u,a+"[nc]video:progression:25%",o,null,true)},progression_50:function(){gtrack.track_events(u,a+"[nc]video:progression:50%",o,null,true)},progression_75:function(){gtrack.track_events(u,a+"[nc]video:progression:75%",o,null,true)}};if(typeof d[i]!="undefined"){d[i]()}trackToBfa(r,t,n,i,a)};var VimeoTrackVideo=function(){var t=this;var i={};this.init=function(){if(bfjs.isMobile()&&$(".video-embed.vimeo").length||!bfjs.isMobile()&&$$(".video_vimeo").length){if(window.addEventListener){window.addEventListener("message",t.addVideoListener,false)}else{window.attachEvent("onmessage",t.addVideoListener,false)}}};this.addVideoListener=function(e){if(typeof e.origin=="undefined"||e.origin!="http://player.vimeo.com"){return}var a=null,s=null,r=null;if(bfjs.isMobile()){a=JSON.parse(e.data);r="#"+a.player_id}else{a=e.data.evalJSON();r=a.player_id}s=$(r);if(!a||!s){return}if(a.event=="ready"){i[r]={};var n=s[bfjs.read_attr]("src").split("?")[0];if(bfjs.isMobile()){s=$(r)[0]}t.addEvent("addEventListener","play",s,n);t.addEvent("addEventListener","finish",s,n)}if(i[r]&&!i[r][a.event]){trackVideo(r,a.event);i[r][a.event]=true}};this.addEvent=function(t,i,a,s){var r={method:t};if(i){r.value=i}a.contentWindow.postMessage(JSON.stringify(r),s)};this.init()};bfjs.onPageLoad(function(){new VimeoTrackVideo});var YT_PLAYERS={};var YoutubeTrackVideo=function(){var t=this;var i={},a={};this.init=function(){};this.addVideoListener=function(t){i[t]={};var s=$(t).readAttribute("src"),r="";if(s==null){s=a[t].src;if(a[t].dfp){r="dfp/"}}else if(s){r=s.match(/dfp=true/)?"dfp/":""}this.addEvent(t,r,s)};this.getVideoTimestamp=function(t){return Math.floor(yt_player.players[t].getCurrentTime())};var s=function(t){var i=[],a=[25,50,75];a.forEach(function(a){var s=Math.floor(a/100*t);i.push(s)});return i};this.addEvent=function(a,r,n){var o="yt"+Math.floor(Math.random()*1e5);var l={};YT_PLAYERS[a]={pollIntervalID:0,onStateChanged:function(o){var u=t.getEventType(o),d=yt_player.players[a].getDuration();if(u=="play"){var c=s(d);if(this.pollIntervalID===0){this.pollIntervalID=setInterval(function(){var i=t.getVideoTimestamp(a);t.ad_tracking(i,a);if(!l[2]){if(c[0]==i&&!l[0]){trackVideo(a,"progression_25",r,n);l[0]=true}else if(c[1]==i&&!l[1]){trackVideo(a,"progression_50",r,n);l[1]=true}else if(c[2]==i&&!l[2]){trackVideo(a,"progression_75",r,n);l[2]=true}}},500)}}else if(u=="paused"||u=="finish"){clearInterval(this.pollIntervalID);t.ad_tracking(u,a);this.pollIntervalID=0}if(!i[a][o]){if(u){trackVideo(a,u,r,n)}i[a][o]=true}}}};this.ad_tracking=function(t,i){var a=BF_STATIC.generated_timestamp;var s=1438300799;var r=BF_STATIC.campaignid=="3891332";var n=BF_STATIC.campaignid=="3772395";var o=BF_STATIC.campaignid=="3721182";var l=BF_STATIC.campaignid=="3764305";var u=BF_STATIC.campaignid=="3764304";var d=BF_STATIC.campaignid=="3798567";var c=BF_STATIC.campaignid=="3798529";var _=BF_STATIC.campaignid=="3796318";var f=BF_STATIC.campaignid=="3797548";var p=BF_STATIC.campaignid=="3792273";var m=BF_STATIC.campaignid=="3808365";var h=BF_STATIC.campaignid=="3796239";var g=BF_STATIC.campaignid=="3946063";var b=BF_STATIC.campaignid=="3946084";var v=BF_STATIC.campaignid=="3942449";var w=BF_STATIC.campaignid=="4047635";var y=0;if(typeof t!=="undefined")y=parseInt(t,10);if(BF_STATIC.tt_page=="Buzz"){if(o&&t==="finish"){var k=document.createElement("script");k.src="http://cookiechecker.sensic.net/sandbox/upload/buzzfeed/dsmTag4194.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4194Script&clickUrl=";document.getElementsByTagName("head")[0].appendChild(k)}else if(r&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12570/dsmTag5140-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5140Script&clickUrl=";k.id="dsmTag5140Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(d&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12464/dsmTag4857-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4857Script&clickUrl=";k.id="dsmTag4857Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(c&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12397/dsmTag4682-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4682Script&clickUrl=";k.id="dsmTag4682Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(_&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12470/dsmTag4884-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4884Script&clickUrl=";k.id="dsmTag4884Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(f&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12465/dsmTag4864-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4864Script&clickUrl=";k.id="dsmTag4864Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(p&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12455/dsmTag4840-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4840Script&clickUrl=";k.id="dsmTag4840Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(m&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12396/dsmTag4680-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4680Script&clickUrl=";k.id="dsmTag4680Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(h&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12461/dsmTag4848-min.js?identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag4848Script&clickUrl=";k.id="dsmTag4848Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(g&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12533/dsmTag5353-min.js?identifier=&siteId=DMIMACROSvideo1DMIMACROE&adTypeId=&tacticId=&userId=&scriptID=dsmTag5353Script&clickUrl=";k.id="dsmTag5353Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(b&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/tags/v3/12533/dsmTag5354-min.js?identifier=&siteId=DMIMACROSvideo2DMIMACROE&adTypeId=&tacticId=&userId=&scriptID=dsmTag5354Script&clickUrl=";k.id="dsmTag5354Script";document.getElementsByTagName("head")[0].appendChild(k)}else if(v&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/html5/dimestoreTag.js?projectID=12731&playerVersion=5&identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5591&clickUrl=";k.id="dsmTag5591";document.getElementsByTagName("body")[0].appendChild(k)}else if(w&&t==="finish"){var k=document.createElement("script");k.src="http://content-dimestore.dmi.sensic.net/prod/html5/dimestoreTag.js?projectID=12735&playerVersion=5&identifier=&siteId=&adTypeId=&tacticId=&userId=&scriptID=dsmTag5614&clickUrl=";k.id="dsmTag5614";document.getElementsByTagName("body")[0].appendChild(k)}}};this.getEventType=function(t){var i="";switch(t){case-1:i="ready";break;case 0:i="finish";break;case 1:i="play";break;case 2:i="paused";break}return i};this.init()};var youtube_track_video=!bfjs.isMobile()?new YoutubeTrackVideo:"";var BFTestRunner=function(){this.__mock_objects={};this.called={};this.init=function(){test_runner.force_testmode_on_ajax();this.load_files([{type:"text/css",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/logger/assets/logger.css"},{type:"text/css",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yuitest/assets/testlogger.css"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yahoo-dom-event/yahoo-dom-event.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/logger/logger-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yuitest/yuitest-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/yahoo/yahoo-min.js"},{type:"text/javascript",url:"https://cdnjs.cloudflare.com/ajax/libs/yui/2.7.0/json/json-min.js"}]);this.observe("page_load:done",function(){test_runner.load_tests()});document.observe("dom:loaded",function(e){test_runner.fire_event("page_load",{})})};this.on_page=function(t){if(window.location.href.indexOf(t)!=-1)return true;else{var i=window.location.search;if(t.indexOf("?")!=-1)i=i.replace(/\?/,"&");window.location.href=BF_STATIC.web_root+t+i}return false};this.append_to_function=function(old_fn,appendage){this.__mock_objects["special-"+old_fn]=eval(old_fn);this.mock(old_fn,function(){eval("var supr="+test_runner.__mock_objects[old_fn]);supr(eval(old_fn+".arguments"));appendage(eval(old_fn+".arguments"))})};this.force_testmode_on_ajax=function(t){if(typeof test_runner._request=="undefined"){this._request=Ajax.Request;this._request_events=Ajax.Request.Events;this.mock("Ajax.Request",function(t,i){i.parameters.testmode="on";Ajax.Request.Events=test_runner._request_events;new test_runner._request(t,i)},"special")}};this.remove_special=function(method){if(typeof this.__mock_objects[method]!="undefined"){eval(method+"="+this.__mock_objects["special-"+method])}};this.mock=function(method,fn,prefix){if(prefix)prefix+="-";else prefix="";this.__mock_objects[prefix+method]=eval(method);var object_path=method.split(".");var first_word=eval(object_path[0]);if(typeof first_word=="undefined"||typeof first_word=="object"){this._mock_object(object_path,[]);object_path=method.split(".");var fn_name=object_path.pop();var obj=eval(object_path.join("."));obj[fn_name]=fn}else if(typeof first_word=="function"&&object_path[1]){var obj=function(){};var old=first_word;for(var each in old.prototype){obj.prototype[each]=old.prototype[each]}obj.prototype[object_path[1]]=fn}return obj};this.unmock=function(method){if(typeof test_runner.__mock_objects[method]!="undefined"){eval(method+"="+test_runner.__mock_objects[method])}};this.unmock_all=function(){for(var t in test_runner.__mock_objects){if(t.match(/^special-/))continue;test_runner.unmock(t)}};this._mock_object=function(object_to_build,object_built){object_built.push(object_to_build.shift());var test;try{test=eval(object_built.join("."))}catch(e){var str=object_built.join(".")+" = new Object();";eval(str)}if(test=="undefined"){var str=object_built.join(".")+" = new Object();";eval(str)}if(object_to_build.length>0){this._mock_object(object_to_build,object_built)}};this._init_testmode=function(t){if(typeof test_runner=="undefined"){window.setTimeout(function(){test_runner._init_testmode(t)},200);return}test_runner.run=function(i){t.suite=i};t.reload_count=0;t.ajax=function(i,a){try{var s=t.suite.get_response(i,a.parameters);if(a.while_processing.show){$(a.while_processing.show).addClassName("hidden")}a.onSuccess({status:200,responseText:Object.toJSON(s)})}catch(e){if(t.reload_count++<15){window.setTimeout(function(){t.ajax(i,a)},200)}}}};this.generate_event_handler_tests=function(suite,tests){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated event handler tests"});for(var handler in tests){tests[handler].each(function(btn){if(typeof btn.el!="undefined"){btn.id=btn.id||btn.el.className||btn.el.tagName}else{btn.el=$(btn.id)}test_case["test_"+btn.id+"_is_hooked_up_to_"+handler+"_handler"]=function(handler,btn){if(typeof btn.setup!="undefined")btn.setup();var called={};if(typeof btn.preface!="undefined")eval(btn.preface);test_runner.mock(handler,function(){called[handler]=true;called.arguments=arguments});if(btn.el==null)btn.el=$(btn.id);test_runner.Assert.isObject(btn.el,"Found "+btn.id+" element on the page");test_runner.UserAction.click(btn.el);test_runner.Assert.areSame(true,called[handler],"Called "+handler+" from "+btn.el.innerHTML+" element ("+btn.id+")");if(btn.args){btn.args.each(function(t,i){test_runner.Assert.isDeeply(t,called.arguments[i],"Got expected argument in position "+i)})}}.curry(handler,btn)})}suite.add(test_case)};this.generate_dependency_tests=function(suite,dependencies){var test_case=new YAHOO.tool.TestCase({name:"Auto-generated dependency tests"});dependencies.each(function(dependency){if(typeof dependency=="string"){test_case["test_"+dependency+"_element_id_exists"]=function(t){test_runner.Assert.elementIDExists(t)}.curry(dependency)}else if(typeof dependency=="object"){if(dependency.test=="is_defined"){test_case["test_"+dependency.id+"_is_defined"]=function(dependency){test_runner.Assert.isObject(eval(dependency.id),dependency.id+" is loaded")}.curry(dependency)}}});suite.add(test_case)};this.profile=function(t,i){test_runner.call_profile={};YAHOO.tool.TestRunner.subscribe(YAHOO.tool.TestRunner.COMPLETE_EVENT,function(){console.dir({coverage:test_runner.call_profile})});for(var a in i){if(typeof i[a]!="function")continue;var s=a+"_"+(new Date).getTime();i[s]=i[a];test_runner.call_profile[a]=0;i[a]=Function(i[a].argumentNames(),'test_runner.call_profile["'+a+'"]+=1;'+t+"."+s+"("+i[a].argumentNames().join(",")+")")}};var temp=BFW_Util.getCookie("bf_trace_path");this.trace_path=temp==null?new Array:JSON.parse(unescape(temp));this.trace=function(object_name){var object=eval(object_name);var temp={};for(var key in object){temp[key]=object[key]}for(var each in temp){if(typeof object[each]!="function")continue;if(object[each].toString().match(/trace_wrapper/))continue;var rnd_name=each+"_"+(new Date).getTime();object[rnd_name]=object[each];object[each]=Function(object[each].argumentNames(),'				var trace_wrapper = true; var __trace_context="unknown";				try{__trace_context = arguments.callee.caller.toString();}catch(e){} 				var __trace_result;					var __trace_e; 				var __log = {args:arguments,calling:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"calling_'+object_name+"."+each+'":__log}); 				try {					__trace_e="";					__trace_result='+object_name+"."+rnd_name+"("+object[each].argumentNames().join(",")+');				} catch(e){__trace_e=e}; 				__log = {error:__trace_e,_args:arguments,result:__trace_result,called:"'+object_name+"."+each+'",context:__trace_context}; 				test_runner.trace_path.push(__log); 				console.dir({"called_'+object_name+"."+each+'":__log}); 				BFW_Util.setCookie({name:"bf_trace_path",value:escape(Object.toJSON(test_runner.trace_path))}); 				if ( __trace_e != "" ) throw(__trace_e); 				return __trace_result')}};this.dump_trace=function(){var t=window.open("","");test_runner.trace_path.each(function(i){var a="<li>";for(var s in i){a+="<b>"+s+"</b>: "+i[s]+" ("+typeof i[s]+") <br />"}a+="</li>";t.document.writeln(a)})};this.clear_trace=function(){BFW_Util.deleteCookie("bf_trace_path");test_runner.trace_path=new Array;
};this.wait_until=function(t,i,a){if(t())i();else{if(!a){a=(new Date).getTime();Facebook["__deadlock_"+a]=0}else{if(Facebook["__deadlock_"+a]++>100){i()}}window.setTimeout(function(){test_runner.wait_until(t,i,a)},200)}};this.add=function(t){var i=YAHOO.tool.TestRunner;i.add(t)};this.run=function(t){this._run(true,t)};this.local_run=function(t){this._run(false,t)};this._run=function(t,i){var a=YAHOO.tool.TestRunner;a.subscribe(a.TEST_PASS_EVENT,test_runner.unmock_all);a.subscribe(a.TEST_FAIL_EVENT,test_runner.unmock_all);if(t){a.subscribe(a.COMPLETE_EVENT,function(t){var i=new YAHOO.tool.TestReporter(BF_STATIC.web_root+"/_fixtures",YAHOO.tool.TestFormat.JSON);i.report(t.results)})}var s=new YAHOO.tool.TestLogger;if(window.location.href.match(/test_method=/i)){var r=window.location.href.split("&");r.each(function(t){if(t.match(/test_method=/i)){var a=t.split(/=/);var s=a[1];i.items.each(function(t){for(var i in t){if(i.match(/^test_/i)&&i!=s){delete t[i]}}})}})}if(i)a.add(i);a.run()};this.log_in=function(t){var i={session_key:"1234567812345678123456781234567812345678123456781234567812345678marcos",display_name:"Test%20User",image:"",username:"marcos",facebook_uid:"",show_account_settings:"true",registration_path:"signin",is_facebook_user:"false",terminal_user:"false",last_active:123456789,isa:"false",user_id:1234567};var a=t?t:{};for(var s in i){if(typeof a[s]=="undefined"){a[s]=i[s]}}BFW_Util.setCookie({name:BFW_COOKIE,value:a.session_key});var r="display_name="+a.display_name;r+="&image="+a.image;r+="&username="+a.username;r+="&facebook_uid="+a.facebook_uid;r+="&show_account_settings="+a.show_account_settings;r+="&registration_path="+a.registration_path;r+="&is_facebook_user="+a.is_facebook_user;r+="&terminal_user="+a.terminal_user;r+="&isa="+a.isa;BFW_Util.setCookie({name:BFW_INFO_COOKIE,value:r})};this.log_out=function(){BFW_Util.deleteCookie(BFW_COOKIE);BFW_Util.deleteCookie(BFW_INFO_COOKIE);BFW_Util.deleteCookie(DEFAULT_USER)};this.extendAssertions=function(){test_runner.Assert=YAHOO.util.Assert;test_runner.UserAction={};for(var t in YAHOO.util.UserAction){if(t=="click"){test_runner.UserAction[t]=function(t){if(t.click)t.click();else YAHOO.util.UserAction.click(t)}}else{test_runner.UserAction[t]=YAHOO.util.UserAction[t]}}test_runner.Assert.isVisible=function(t,i){var a=$(t).visible()&&!$(t).hasClassName("hidden");test_runner.Assert.areEqual(true,a,i?i:t+" is visible")};test_runner.Assert.isHidden=function(t,i){var a=$(t).visible()&&!$(t).hasClassName("hidden");test_runner.Assert.areEqual(false,a,i?i:t+" is hidden")};test_runner.Assert.isLike=function(t,i,a){test_runner.Assert.isNotNull(t.match(i),a?a:t+" matches regex")};test_runner.Assert.isNotLike=function(t,i,a){test_runner.Assert.isNull(t.match(i),a?a:t+" matches regex")};test_runner.Assert.elementIDExists=function(t,i){test_runner.Assert.isNotNull($(t),i?i:t+" is on the page")};test_runner.Assert.isDeeply=function(t,i,a){if(typeof t=="object"){for(var s in t){test_runner.Assert.isDeeply(t[s],i[s],a)}}else{test_runner.Assert.areSame(t,i,a)}}};this.load_tests=function(){var t=test_runner.parse_params();var i=t.test_suite?test_runner.__test_suites[t.test_suite]():[];if(t.tests){var a=t.tests.split(",");for(var s=0;s<a.length;s++)i.push(test_runner.__tests[a[s]])}if(t.test)i.push(test_runner.__tests[t.test]);test_runner._wait_for_yahoo(test_runner.extendAssertions);test_runner._wait_for_yahoo(function(){test_runner.load_files(i)})};this._wait_for_yahoo=function(t){if(typeof this.__wait_count=="undefined")this.__wait_count=0;else if(this.__wait_count++>1e3){alert("Took too long to load Yahoo files");return}if(typeof YAHOO=="undefined"||typeof YAHOO.util=="undefined"||typeof YAHOO.util.UserAction=="undefined"||typeof YAHOO.util.Assert=="undefined"){window.setTimeout(function(e){test_runner._wait_for_yahoo(t)},200)}else{t()}};this.cookie=function(t){var i=document.cookie.split(";");var a={};for(var s=0;s<i.length;s++){var r=i[s].split("=");r[0]=r[0].replace(/ /g,"");a[r[0]]=r[1]}return unescape(a[t])};this.parse_params=function(t){var i={};if(!t)t=window.location.search.substring(1);var a=t.split("&");for(var s=0;s<a.length;s++){var r=a[s].split("=");if(r.length==2){i[r[0]]=r[1]}else{i[r[0]]=true}}return i};this.$=function(t){if($(t))return $(t);return $(test_runner.DOM_SYNONYMS[t])};this.load_files=function(t){if(typeof t=="string")t=[{type:"text/javascript",url:t}];for(var i=0;i<t.length;i++){var a=t[i];if(typeof a=="undefined"){continue}if(typeof a=="string")a={type:"text/javascript",url:a};if(a.type=="text/javascript")this.load_javascript(a);else if(a.type=="text/css")this.load_css(a);else console.error("unrecognized file type to load: "+a.type)}};this.load_javascript=function(t){var i=document.createElement("script");i.setAttribute("type",t.type);i.setAttribute("src",t.url);i.setAttribute("defer","false");if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(){document.getElementsByTagName("HEAD")[0].appendChild(i)})}else{document.getElementsByTagName("HEAD")[0].appendChild(i)}};this.load_css=function(t){var i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("type",t.type);i.setAttribute("href",t.url);if(document.getElementsByTagName("HEAD")=="undefined"){this.observe("page_load",function(e){document.getElementsByTagName("HEAD")[0].appendChild(i)})}else{document.getElementsByTagName("HEAD")[0].appendChild(i)}};this.observe=function(t,i){if(!this.__EVENTS[t])this.__EVENTS[t]=[];this.__EVENTS[t].push(i)};this.fire_event=function(t,i){var a=test_runner.__EVENTS[t]?test_runner.__EVENTS[t]:[];for(var s=0;s<a.length;s++){a[s](i)}if(t.indexOf(":done")==-1){test_runner.fire_event(t+":done",i)}};this.__EVENTS={};this.DOM_SYNONYMS={};this.__tests={buzz_stats:"/static/js/public/test/buzz_stats.js",demo:"/static/js/public/test/demo.js",login:"/static/js/public/test/login.js",register:"/static/js/public/test/register.js",profile:"/static/js/public/test/profile.js",prepopulated_quickpost:"/static/js/public/test/prepopulated_quickpost_test.js",save_buzz:"/static/js/public/test/save_buzz_test.js",facebook2:"/static/js/public/test/facebook2_test.js",badges:"/static/js/public/test/badge_test.js",session_tracking:"/static/js/public/test/session_test.js",micro_sites:"/static/js/public/test/microsite_test.js",handler_test:"/static/js/public/test/generic_handler.js",signup:"/static/js/public/test/new_signup_page.js",settings:"/static/js/public/test/new_settings.js",quickpost:"/static/js/public/test/quickpost_test.js",dashboard:"/static/js/public/test/dashboard_test.js","dashboard-stats":"/static/js/public/test/dashboard-stats-test.js",dashboard_ad:"/static/js/public/test/dashboard_ad_test.js",dashboard_widget:"/static/js/public/test/dashboard_widget_test.js",dashboard_user_stats:"/static/js/public/test/dashboard_user_stats_test.js",realtimeweb:"/static/js/public/test/realtimeweb_test.js",user_switching:"/static/js/public/test/user_switching_test.js",user_tracking:"/static/js/public/test/user_tracking.js",user_panel:"/static/js/public/test/user_panel_test.js",universal_dom_traversal:"/static/js/public/test/universal_dom_traversal_test.js",social:"/static/js/public/test/social_test.js"};this.__test_suites={all:function(){var t=[];for(var i in test_runner.__tests)t.push(test_runner.__tests[i]);return t}}};test_runner=new BFTestRunner;if(test_runner.parse_params()["testmode"]=="on"){test_runner.init()}window.BF_PIXEL=new function(){"use strict";var t=this;this.save=function(i){if(typeof i!=="object"){return false}if(!i.hasOwnProperty("dir")){return false}var a=new Image;var s=i.hasOwnProperty("params")?i.params:{};var r=t.webPath()+i.dir;s.z=Math.round(Math.random()*1e8);s="?"+t.encodeParams(s);r+=s;a.setAttribute("height","1");a.setAttribute("width","1");if(BF_STATIC.env==="dev"||BF_STATIC.bf_env==="dev"){console.log("BF Pixel: "+r)}else{a.setAttribute("src",r)}return r};this.webPath=function(){if(BF_STATIC.env==="stage"||BF_STATIC.bf_env==="stage"){return"https://pixel-stage.buzzfeed.com/"}else{return"https://pixel.buzzfeed.com/"}};this.encodeParams=function(t){var i=[];for(var a in t)i.push(encodeURIComponent(a)+"="+encodeURIComponent(t[a]));return i.join("&")}};var Carousel=function(){var t={id:"carousel",next:"cc-next",prev:"cc-prev",item:"thumbnail",items:"thumbnails",show:3};var i=function(i){for(var a=0;a<t.show;a++){i[a].removeClassName("hidden")}};var a=function(){return $$("#"+t.id+" ."+t.item+":not(.hidden)")};return{init:function(a){if(a){t=$H(t).merge(a);t=t._object}var s=this;var r=$$("#"+t.id+" ."+t.item);if(r.length>t.show){if($$("#"+t.id+" ."+t.next).length){$$("#"+t.id+" ."+t.next)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_next",event:"click",handler:s.next})}if($$("#"+t.id+" ."+t.prev).length){$$("#"+t.id+" ."+t.prev)[0].removeClassName("hidden");universal_dom.assign_handler({bucket:"carousel_prev",event:"click",handler:s.prev})}}i(r)},next:function(i){Event.stop(i);var s=a();s.each(function(t){t.addClassName("hidden")});for(var r=0;r<s.length;r++){var n=s[r];s[r].remove();$$("."+t.items)[0].insert(n)}var o=$$("#"+t.id+"  ."+t.item);for(var r=0;r<t.show&&o.length>r;r++){o[r].removeClassName("hidden")}},prev:function(i){Event.stop(i);var s=a();s.each(function(t){t.addClassName("hidden")});for(var r=s.length;r>0;r--){var n=s[r-1];s[r-1].remove();$$("."+t.items)[0].insert({top:n})}var o=$$("#"+t.id+"  ."+t.item);for(var r=o.length,l=0;l<t.show;l++,r--){o[r-1].removeClassName("hidden")}}}};var BFcarousel=Carousel();var BF_Click=new function(){var t=this;this.trigger=bfjs.isMobile()&&BF_STATIC.env=="live"?"click":"mousedown";this.el_types=["a","input","button","i"];this.init=function(){bfjs.universal_each(t["el_types"],t.addClickEvents)};this.addClickEvents=function(i){$(document.body).on(t["trigger"],i,function(t){var a=bfjs.eventFindEl(t,i),s=a.tagName.toUpperCase();EventManager.fire("bf_click",{el:a,tag:s})})}};BF_Click.init();EventManager.observe("bf_click",function(e){if(e["tag"]=="A"){var t=e["el"];if(typeof t.href!="undefined"&&t.href.match(/http/)&&(t.href.indexOf("mailto")!==0&&(!t.href.match(/buzzfee?d.com/)||BF_STATIC.tt_page=="StandAloneQP"))){$(t)[bfjs.write_attr]("target","_blank")}}});var BF_Pound=new function(){var t=this;this.position_tag="pound_position";this.init=function(){EventManager.observe("bf_click",function(e){t.click(e["el"])})};this.click=function(i){var a=t.findPosition(i);if(a){store.set(t.position_tag,a);if(BF_STATIC.bf_env!="live"){console.log("Pound Position: "+a)}}};this.findPosition=function(i){try{var a=0,s=99;while(i!=document&&a<s){var r=$(i)[bfjs.up]();if(r[bfjs.read_attr](t.position_tag)){return r[bfjs.read_attr](t.position_tag)}else{i=r;a++}}return null}catch(e){return null}}};if(BF_STATIC.tt_page=="Home"){BF_Pound.init()}bf_report_manager=function(){this.ERR="Sorry, we&rsquo;re unable to process your request at this time. Please try again later.";this.VOTE_UPDATED="Your report has been noted. Thanks for your input.";this.cache={};this.init=function(){if(typeof bf_cache!="undefined")report_manager.cache=bf_cache;var t=$$("a.report-button");t.each(function(t){var i=t.getAttribute("comment_id");if(i){t.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})}});var i=$$("input.flag_comment_submit");i.each(function(t){t.observe("click",function(e){e.stop();report_manager.flag_comment(e);return false})});var t=$$("a.not-iteresting-button");t.each(function(t){var i=t.getAttribute("contributionid");if(i){t.observe("click",function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false})}});if(acl.user_can("edit_user_accounts")){var a=new Array("spam-admin","boring-admin","report_user-admin","not_raw-admin","toggle_raw_user-admin","edit-admin");for(var s=0;s<a.length;s++){var r=null;if(a[s]=="spam-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"flag"});return false}}else if(a[s]=="boring-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"uniteresting"});return false}}else if(a[s]=="report_user-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_user"});return false}}else if(a[s]=="toggle_raw_user-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"toggle_raw"});return false}}else if(a[s]=="not_raw-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"not_raw"});return false}}else if(a[s]=="edit-admin"){r=function(e){e.stop();report_manager.handle_click({e:e,type:"edit_buzz"});return false}}var n=$$("a."+a[s]);for(var o=0;o<n.length;o++){var l=n[o];if(r){l.show();l.observe("click",r)}}}if($("quickpost-tags")&&typeof bf_page!="undefined"&&bf_page=="moderation"){$("quickpost-tags").observe("keydown",user_post.auto_complete_special);$("quickpost-tags").observe("keyup",user_post.auto_complete);$("quickpost-tags").observe("blur",function(){window.setTimeout(function(){$("tag_suggestions").hide()},1e3)})}if($("save-edited-buzz")){$("save-edited-buzz").observe("click",report_manager.save_edited_buzz)}if($("edit_image")){$("edit_image").observe("click",report_manager.edit_image);user_setting={save_image:report_manager.save_image};if(typeof bf_page!="undefined"&&bf_page=="moderation")parent.user_post.save_quickpost_image=function(){}}}if("universal_dom"in window){universal_dom.assign_handler({bucket:"show-badges",event:"click",handler:report_manager.show_badges})}};this.flag_comment=function(e){var t=e.target;var i=t.getAttribute("comment_id");var a=function(t){bf_catcha.catcha_answer="";$("flag_comment").hide();$$('span[comment_id="'+i+'"]')[0].addClassName("reporting")}.bind(this);var s=function(){this.error(t)}.bind(this);var r=new BF_User;var n=r.getUserInfo();if(t.id&&t.id=="flag_submit"||confirm("Report this comment?")){var o={comment_id:i,action:"flag_contribution",anonymus:r.isLoggedIn()?0:1,user_id:n.userid};(new BF_Request).request("/buzzfeed/flag_comment",{method:"post",parameters:o,onSuccess:a,onFailure:s,onCatcha:function(t){flagComment.move_it(i);if(bf_catcha.catcha_answer){alert("Wrong answer!")}}})}};this.show_badges=function(t){var i="badge";var a="show-favorite-link";var s="show-all-link";if(t.for_type=="favorite"){i="favorite";a="show-all-link";s="show-favorite-link"}universal_dom.get_bucket_elements("badge").each(function(t){t.addClassName("hidden")});universal_dom.get_bucket_elements(i).each(function(t){t.removeClassName("hidden")});var r=$(a);if(r)r.removeClassName("hidden");r=$(s);if(r)r.addClassName("hidden")};this.edit_image=function(e){var t=report_manager.cache.buzzes[report_manager.current_buzz];$("user-image-edit-iframe").src="/static/images/public/spinners/big_on_eee.gif";BF_UI.showDialog("user-image-edit");$("user-image-edit-iframe").src="/buzzfeed/_edit_user_contribution_image?action=imageform&template=public/user/quickpost_imageform.tt";var i="link";if(t.form=="image")i="image";else if(t.form=="video")i="video";$("user-image-edit-iframe").observe("load",function(t){t.target.contentWindow.user_image.setBuzzType(i)})};this.save_image=function(t,i,a,s){var r=report_manager.cache.buzzes[report_manager.current_buzz];var n=a;n.type=r.form+"buzz";if($("user-loading"))$("user-loading").show();$("user-image-edit").hide();n.image=t.replace(/\.(jpg|gif)$/,"");n.action="imagecrop";var o=report_manager.image_saved;var l=report_manager.image_errored;var u=new BF_Request;u.request(s,{method:"post",parameters:n,onSuccess:o,onFailure:l})};this.image_errored=function(){alert("There was an error trying to save your image")};this.image_saved=function(t){var i=report_manager.cache.buzzes[report_manager.current_buzz];if($("user-loading"))$("user-loading").hide();var a=JSON.parse(t.responseText);if(a.saved){i.oldimage=i.image;i.image=a.thumb_image;if($("img_preview")){$("img_preview").src=BF_STATIC.image_root+a.thumb_image}}else{this.image_errored()}};this.save_edited_buzz=function(e){if(acl.user_can("edit_user_posts")){var t=report_manager.edit_form;var i=[];var a=["name","blurb"];a.each(function(a){if(t.elements[a].value=="")i.push("Missing required field ("+a+")")});if(!(t.elements["nsfw-btn"].hasClassName("selected")||t.elements["tame-btn"].hasClassName("selected"))){i.push("Please specify if it's NSFW or not")}if(i.length){alert("Cannot save. Please address the following error"+(i.length>1?"s":"")+":\n"+i.join("\n"));return}var s=report_manager.cache.buzzes[report_manager.current_buzz];for(var r in report_manager.buzz_fields_to_text_fields){if(t.elements[report_manager.buzz_fields_to_text_fields[r]].disabled==false){s[r]=t.elements[report_manager.buzz_fields_to_text_fields[r]].value}else{delete s[r]}}var n=$("badge-checkboxes").getElementsByTagName("INPUT");s.badges=[];for(var o=0;o<n.length;o++){var l=n[o];if(l.checked)s.badges.push(l.value)}var u=t.elements.tags.value.split(",");u.each(function(t){s.tags.push(t)});s.nsfw=t.elements["nsfw-btn"].hasClassName("selected")?"true":"false";var d=new BF_Request;s.category_id=t.elements["category"].options[t.elements["category"].selectedIndex].value;var c={action:"update_buzz",buzz:Object.toJSON(s),update_html:1};var _;for(var o=0;o<t.elements.promotion.length;o++){if(t.elements.promotion[o].checked)_=t.elements.promotion[o].value}if(_&&_!="none"){c.promotion=_;c.action="update_and_promote"}if(_=="queue-at"){c["queue-on-day"]=t.elements["queue-on-day"].options[t.elements["queue-on-day"].selectedIndex].value;c["queue-on-hour"]=t.elements["queue-on-hour"].options[t.elements["queue-on-hour"].selectedIndex].value}d.request("/buzzfeed/_admin",{method:"post",parameters:c,onSuccess:report_manager._save_edited_buzz,while_processing:{show:$("save-edited-buzz-spinner"),hide:e.target}})}else{alert("You do not have permission to save edited buzz")}};this._save_edited_buzz=function(t){var i=JSON.parse(t.responseText);if(i.success==1){try{var a=report_manager.cache.buzzes[report_manager.current_buzz];var s=report_manager.edit_form;s.addClassName("hidden");s.parentNode.removeChild(s);document.getElementsByTagName("BODY")[0].appendChild(s);$("buzz-"+a.campaignid).update(i.html)}catch(e){console.dir({e:e})}}};this.cancel_inline_editor=function(){if("bf_post_tools"in window)bf_post_tools.cancel_inline_editor();else{var t=report_manager.cache.buzzes[report_manager.current_buzz];var i=report_manager.edit_form;i.addClassName("hidden");i.parentNode.removeChild(i);document.getElementsByTagName("BODY")[0].appendChild(i);$("buzz-"+t.campaignid).appendChild(report_manager.current_snippet)}};this.buzz_fields_to_text_fields={name:"name",blurb:"blurb",short_description:"short_description"};this.load_inline_editor=function(t){if("bf_post_tools"in window)return bf_post_tools.load_inline_editor(t);var i=$("_converter");if(!i){i=document.createElement("div");i.id="_converter";i.addClassName("hidden");document.getElementsByTagName("BODY")[0].appendChild(i)}if(t.buzz_id&&typeof report_manager.cache.buzzes[t.buzz_id]!="undefined"){var a=$(t.editor_id||"editForm");var s=$("buzz-"+t.buzz_id);report_manager.current_buzz=t.buzz_id;report_manager.edit_form=a;var r=report_manager.cache.buzzes[t.buzz_id];a.parentNode.removeChild(a);report_manager.current_snippet=s.cloneNode(true);s.update("");s.appendChild(a);a.removeClassName("hidden");a.elements.promotion[0].checked=true;for(var n in report_manager.buzz_fields_to_text_fields){i.update(unescape(r[n]));a.elements[report_manager.buzz_fields_to_text_fields[n]].value=i.innerHTML}if(r.form=="enhanced"){a.elements.short_description.disabled=true;a.elements.short_description.value="Use terminal to edit"}else{a.elements.short_description.disabled=false}r.badges.each(function(t){if(typeof a.elements[t]!="undefined")a.elements[t].checked=true});var o=$("tag_list");if(o){o.update("");r.tags.each(function(t,i){if(i>0&&t!="")o.appendChild(document.createTextNode(", "));o.appendChild(document.createTextNode(t))})}if(r.nsfw=="true"){a.elements["nsfw-btn"].removeClassName("selected");a.elements["tame-btn"].removeClassName("selected")}else{a.elements["tame-btn"].addClassName("selected");a.elements["nsfw-btn"].removeClassName("selected")}if($("img_preview")){$("img_preview").setAttribute("src",BF_STATIC.image_root+r.image)}if(r.category_id){var l=a.elements.category.options;for(var u=0;u<l.length;u++){if(l[u].value==r.category_id){l[u].selected=true}}}}else{alert("Invalid ID ("+t.buzz_id+")")}};this.handle_click=function(t){var i=t.e.target;if(t.type=="report_user"){this.deleteUser(i,t.type)}else if(t.type=="edit_user"){this.editUser(i,t.type)}else if(t.type=="toggle_raw"){this.toggle_raw(i,t.type)}else if(t.type=="edit_buzz"){this.edit_buzz(i,t.type)}else this.report(i,t.type)};this.edit_buzz=function(t,i){this.el=t;var a=t.getAttribute("buzz_id");var s=false;if(acl.user_can("edit_user_accounts")){s=true}if(s){window.open(BF_STATIC.static_root+"/html/index.html?action=buzz_edit&bid="+a)}};this.toggle_raw=function(t,i){if(!acl.user_can("edit_user_posts")){return alert("You do not have permission to toggle raw")}if(t.event)t=t.event.target;this.el=t;var a=t.getAttribute("user_id");var s=t.getAttribute("current_state");var r=t.getAttribute("rel:hide_success_dialog")==1;if(s==0)return;t.innerHTML="User Cannot Post to Raw";this.new_raw_state=s=="1"?0:1;var n=false;if(acl.user_can("edit_user_accounts")){n=true}if(n){var o=new BF_Request;o.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"update_flags",id:a,raw:this.new_raw_state},onSuccess:function(i){var a="This user's posts will be shown in the Raw Feed";if(this.new_raw_state==0)a="This user's posts will not be shown in the Raw Feed";if(!r)alert(a);t.setAttribute("current_state",this.new_raw_state)}.bind(this),onFailure:function(t){o.alert("Error contacting server")},bf_auth:true})}};this.editUser=function(t,i){var a="user_admin_panel";if(typeof t.event!="undefined"){t=t.event.target;a+=t.getAttribute("user_id")||(new Date).getTime()}var s=t.getAttribute("user_id");var r=t.getAttribute("username");var n=false;if(acl.user_can("edit_user_accounts")){n=true}if(n){BF_UI.create_or_show_dialog({height:545,scrolling:"no",title:"Edit User",id:a,url:BF_STATIC.web_root+"/user_panel?username="+r,user_id:s})}};this.deleteUser=function(t,i){if(!acl.user_can("edit_user_accounts")){return alert("You do not have permission to delete user")}if(typeof t.event!="undefined")t=t.event.target;var a=t.getAttribute("user_id");if(confirm("Are you sure you want to delete this user?")){var s=new BF_Request;s.request("/buzzfeed/_user_admin",{method:"post",parameters:{action:"delete",id:a},onSuccess:function(t){alert("user deleted")}.bind(this),onFailure:function(t){s.alert("Error contacting server")},bf_auth:true})}};this.report=function(t,i){var a=t.getAttribute("contributionid");var s="boring";if(i=="flag"){s="spam"}if(i=="not_raw"){s="remove_from_raw_feed"}try{var r=new BF_User;var n=false;var o="";if(acl.user_can("edit_user_accounts")){n=true}if(r.isLoggedIn()){var l=r.getUserInfo();if(l.username){o=l.username}}var u={id:a,f:s,username:o};try{t.addClassName("reporting");if(i!=="flag"){t.innerHTML="Reporting..."}}catch(e){}var d="remove this contribution from this page";if(i=="flag"){var d="delete this contribution forever"}else if(i=="not_raw"){var d="remove this contribution from the raw feed"}if(n==true){if(confirm("Are you sure you want to "+d+"?")){this._request(t,u,n,i)}}else{this._request(t,u,n,i)}}catch(e){console.error(e)}};this._request=function(t,i,a,s){var r=function(i){this.report_success(t,s,i)}.bind(this);var n=function(a){this.isa_results(t,s,a,i)}.bind(this);var o=function(){this.error(t)}.bind(this);new Ajax.Request("/buzzfeed/_flag_contribution",{method:"get",parameters:i,onSuccess:r,onFailure:o});if(a==true){var l=new BF_User;if(i.f=="spam"){i.action="delete_buzz";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}else if(i.f=="remove_from_raw_feed"){i.action="remove_from_raw_feed";new Ajax.Request("/buzzfeed/_buzz_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}else{i.action="moderate";new Ajax.Request("/buzzfeed/_contribution_moderator",{method:"get",parameters:i,onSuccess:n,onFailure:o})}}};this.report_success=function(t,i,a){t.removeClassName("reporting");t.addClassName("reported");if(i=="uniteresting"||i!=="flag"){t.innerHTML="Flagged!"}var s=a.responseText.evalJSON()};this.isa_results=function(t,i,a,s){var r="contribwhat_"+s.id.toString();if(i=="uniteresting"){$(r).innerHTML="Item Moderated"}else{$(r).innerHTML="Item Deleted"}};this.error=function(t){}};report_manager=new bf_report_manager;report_manager.init();var HeaderBuzz=function(){this.header_buzz=$A();this.page_one_buzz=$A();this.page_quantity=8;this.start_buzz=0;this.current_page=1;this.clicktrack=false;this.page_buzzid;this.is_video;this.in_progress=0;this.attach_click_handlers=function(){universal_dom.assign_handler({bucket:"abtrack",event:"mousedown",handler:this.click_handler})}.bind(this);this.click_handler=function(t){return}.bind(this);this.draw_next=function(t){if(this.start_buzz>=this.header_buzz.length-this.page_quantity){$("hothead-scripted").hide();$("hothead-unscripted").show();this.start_buzz=0;return}else if(this.start_buzz==0&&$$("#hothead-unscripted .unit").length==8){this.start_buzz=1}this.start_buzz+=t;var i=this.header_buzz.slice(this.start_buzz,this.start_buzz+this.page_quantity);this.make_page(i);this.start_buzz+=this.page_quantity-2}.bind(this);this.make_page=function(t){var i=$A("");var a=0;for(var s=0;s<t.length;s++){if(typeof page_buzzid!="undefined"&&t[s].campaignid==page_buzzid){continue}if(!t[s].badge_type)t[s].no_badge="no-badge";if(t[s].form=="link"&&t[s].link_buzz!=null){t[s].gt_label="external/"+t[s].link_buzz.match(/:\/\/(www\.)?(.[^/:]+)/)[2]}else{if(t[s].login_type=="terminal"){t[s].gt_label="editor/"+t[s].username}else{t[s].gt_label="user/"+t[s].username}}a++;var r=this.buzz_template.evaluate({buzz:t[s],slot:a});i.push(r)}$("hothead-unscripted").hide();$("hothead-scripted").innerHTML=i.join("");$("hothead-scripted").show();universal_dom.update($("hothead-scripted"))};this.init=function(){var t=this.nextone_link();if(t)t.observe("click",this.nextone_handler);$$("meta").each(function(t,i){if(t.readAttribute("property")=="bf:buzzid"){page_buzzid=t.readAttribute("content");this.page_one_buzz.unshift(page_buzzid);var a=9;$$(".HotHead .unit").each(function(t,i){if(t.hasClassName("c"+page_buzzid)&&!t.hasClassName("thumb"+a)){$$(".HotHead div.unit.thumb"+a).each(function(t,a){var s=i>=7?0:"10px";$(t).setStyle({display:"block","margin-left":s})});t.parentNode.removeChild(t);throw $break}});throw $break}}.bind(this))};this.nextone_handler=function(t){if(t)t.stop();if(this.in_progress==1){return}else if(this.header_buzz.length==0){this.load_header_buzz()}else{var i=$$("#hothead .unit");var a=BF_STATIC.tt_page=="Home"&&i[8]&&i[8].getStyle("display")=="block"?1:0;this.draw_next(a)}}.bind(this);this.nextone_link=function(){return $("header_buzz_nextone")};this.load_header_buzz=function(){this.in_progress=1;var t=new BF_Request;var i="us";if(typeof BFW_Util=="object"){i=BFW_Util.getCookie("country")!=null&&BFW_Util.getCookie("country")!="us"?BFW_Util.getCookie("country"):"us"}var a=BF_STATIC.web_root+"/_headerstrip/";if(this.is_video){a+="video/"}else if(i=="uk"||i=="au"){a+=i+"/"}a+=this.page_one_buzz.join(",")+".js";t.request(a,{method:"get",onSuccess:function(e){var t=e.responseText.evalJSON();if(t.success){this.header_buzz=$A(t.buzzes);this.in_progress=0;this.nextone_handler()}}.bind(this)})}.bind(this);this.set_page_one_buzz=function(t){this.page_one_buzz=$A(t)}};var hb=null;function load_header_buzz(){hb=new HeaderBuzz;hb.buzz_template=new Template('<div class="unit abtrack bf_dom thumb#{slot}" onmouseover="header && header.fix_length(event);" rel:bf_bucket="track" track=\'#{buzz.track}\' id="header_buzz_scripted">'+'<a rel:gt_act="post/thumb" rel:gt_label="#{buzz.gt_label}"'+'class="thumbbb bf_dom" rel:buzz_id="#{buzz.campaignid}" rel:bf_bucket="abtrack" href="#{buzz.href_link}">'+'<span class="title">#{buzz.name}</span>'+'<img src="'+BF_STATIC.image_service_root+'#{buzz.image}" alt="" />'+"</a>"+"</div>");hb.page_one_buzz=BF_STATIC.thumbstrip_initial_buzzes;hb.page_quantity=9;hb.clicktrack=$("hothead");hb.is_video=0;BuzzLoader.register(function(){hb.init()},1)}if("undefined"!=typeof BF_STATIC.non_english&&!BF_STATIC.non_english){load_header_buzz()}(function(){var t={};function i(){var t=Array.prototype.slice.call(arguments);function i(){var s=t.shift();if(s){a(s,i)}}i()}function a(i,a){if(t[i]){return false}t[i]=true;var s=document.createElement("script");s.type="text/javascript";s.src=i;s.onerror=function(){t[i]=false};s.onload=function(){a()};document.getElementsByTagName("head")[0].appendChild(s)}window.BF_LOGIN_SIGNUP={show:function(t){if(typeof localStorage!=="undefined"&&typeof delayedCbConf!=="undefined"){localStorage.setItem("bf_login.delayedLoggedInCallbacks",Object.toJSON(t.delayedCbConf))}if(BF_LOGIN_SIGNUP._show){BF_LOGIN_SIGNUP._show(t);return}this.onSuccessLoginCb=t.onSuccessLoginCb||null;this.locationName=t.locationName||null;this.registerParams=t.registerParams||null;this.isMobile=t.isMobile||null;this.isSignout=t.isSignout||null;this.onCancelLoginCb=t.onCancelLoginCb||null;i(BF_STATIC.static_root+"/js/public/amd-common.js?v="+BF_STATIC.version,BF_STATIC.static_root+"/js/public/amd-login-signup.js?v="+BF_STATIC.version)},showMobile:function(t){t.isMobile=true;if(t.toggleNav){$(".page").trigger("touchstart")}this.show(t)}};window.BF_LOGIN_SIGNUP.updateUserNav=function(){if($("usernav-signin"))$("usernav-signin").hide();if($("usernav-signup"))$("usernav-signup").hide();var t=new BF_UserNav;t.init()};function s(){if(typeof localStorage!=="undefined"&&localStorage.getItem("bf_login.delayedLoggedInCallbacks")){try{var t=localStorage.getItem("bf_login.delayedLoggedInCallbacks");if(t!=="undefined")t=t.evalJSON();else t=[];for(var i=0;i<t.length;i++){if(!Object.isArray(t[i].params))t[i].params=[t[i].params];if(typeof window[t[i].obj]!="undefined"){window[t[i].obj][t[i].fn].apply(window[t[i].obj],t[i].params)}else{new PeriodicalExecuter(function(t){return function(i){if(typeof window[t.obj]!=="undefined"){i.stop();window[t.obj][t.fn].apply(window[t.obj],t.params)}}}(t[i]),.5)}}localStorage.removeItem("bf_login.delayedLoggedInCallbacks")}catch(e){console.log(e)}}}s()})();Box.Application.addService("keycode",function(){"use strict";var t={TAB:9,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,ENTER:13};var i={};i.getKeyCode=function(i){if(!t.hasOwnProperty(i)){return-1}return t[i]};i.checkKeyCode=function(i,a){if(!t.hasOwnProperty(i)){return null}return t[i]===a};return i});Box.Application.addService("loading-spinner",function(t){"use strict";var i=t.getGlobal("bf_spinner");var a=t.getService("dom");function s(t){var i=0;this.show=function(){if(i++===0){a.removeClass(t,"hidden")}};this.hide=function(){if(i&&--i===0){a.addClass(t,"hidden")}}}var r=new i;var n={};n.create=function(t){return new s(t)};n.show=function(){r.start()};n.addAttribute=function(t,i){[r.loaderEl,r.overlayEl].forEach(function(a){a.setAttribute(t,i)})};n.hide=function(){r.stop()};return n});Box.Application.addService("validation",function(){"use strict";var t={};t.isEmail=function(t){var i=/^([^@]+)@([^\.]+)\.([a-zA-Z])+/;return t&&i.test(t.trim())};return t});Box.Application.addService("util",function(t){"use strict";var i={};var jQuery=t.getGlobal("jQuery");var a=t.getGlobal("Prototype");var s=t.getGlobal("BF_STATIC");var r=t.getGlobal("$H");var n=t.getGlobal("$A");var o=t.getGlobal("Object");i.hasjQuery=function(){return!!jQuery&&!a}();i.isMobile=function(){if(i.hasjQuery&&/^mobile/i.test(s.tt_page)){return true}else if(i.hasjQuery&&/^ab_debug/i.test(s.tt_page)){return true}else if(i.hasjQuery&&s.tt_page==="BuzzAdvertise"){return true}else{return false}}();i.isMobileApp=function(){return s.mobile_app||false}();i.isDevEnv=function(){return s.bf_env==="dev"}();i.each=function(t,i){if(jQuery){return jQuery.each(t,function(t,a){
i(a,t)})}else{return n(t).each(i)}};i.isNodeList=function(t){var i=Object.prototype.toString.call(t);return typeof t==="object"&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(i)&&typeof t.length!=="undefined"&&(t.length===0||typeof t[0]==="object"&&t[0].nodeType>0)};i.nodeListToArray=function(t){return Array.prototype.slice.call(t)};i.first=function(t){var a=i.isNodeList(t)?i.nodeListToArray(t):t;if(Array.isArray(a)&&a.length){return a[0]}return t};i.last=function(t){var a=i.isNodeList(t)?i.nodeListToArray(t):t;if(Array.isArray(a)&&a.length){return a[a.length-1]}return t};i.isArraylike=function(t){var i=!!t&&"length"in t&&t.length;var a=Array.isArray?Array.isArray(t):t instanceof Array;var s=t!==null&&t===t.window;if(typeof t==="function"||s){return false}return a||i===0||typeof i==="number"&&i>0&&i-1 in t};i.each=function(t,a){var s;var r=0;var n=t.length;var o=i.isArraylike(t);if(o){for(;r<n;r++){s=a.call(t[r],r,t[r],t);if(s===false){break}}}else{for(r in t){s=a.call(t[r],r,t[r],t);if(s===false){break}}}};i.toArray=function(t){if(!t||!t.length){return t}if(Array.isArray&&Array.isArray(t)){return t}var i=[];var a=0;for(;a<t.length;a++){i.push(t[a])}return i};i.extend=function(){var t=i.toArray(arguments);if(typeof t[0]==="boolean"){t.shift()}if(i.hasjQuery){return jQuery.extend.apply(jQuery,t)}else{t.forEach(function(i,a){if(!a){return}t[0]=r(t[0]).merge(i).toObject()});return t[0]}};i.isEmptyObj=function(t){for(var i in t){if(t.hasOwnProperty(i)){return false}}return true};i.throttle=function(t,i){var a;if(!i){return t}return function(){if(a){clearTimeout(a)}a=setTimeout(t,i)}};i.getUniqueEventName=function(t,i){return t+"-"+i.id};i.getKeys=function(t){var i;if(o.keys){return o.keys(t)}else{i=[];for(var a in t){if(t.hasOwnProperty(a)){i.push(a)}}return i}};i.isIOSMobile=function(){var t=navigator.userAgent.toLowerCase();if(t.match(/iphone|ipod/)){return true}return false}();return i});Box.Application.addService("select-box",function(t){"use strict";var i=t.getGlobal("document");var a=t.getService("dom");var s=t.getService("util");var r=t.getService("template-engine");var n=t.getService("keycode");var o=t.getService("log");var l={};var u={selectWrap:"js-bf-select",selectText:"js-bf-select-text",selectList:"js-bf-select-list",selectTextValue:"js-bf-select-text__value",upArrow:"js-bf-select-text__arrow--up",downArrow:"js-bf-select-text__arrow--down",focusedText:"bf-select-text--focused",listItem:"js-bf-select-list__item",activeItem:"bf-select-list__item--active",mobile:"bf-nativeselect-mobile",desktop:"bf-nativeselect-desktop",disabled:"bf-select--disabled",jsDisabled:"js-bf-select--disabled"};var d={autoinsert:true};var c={};function _(t,i){if(!t||!i){return}o.error("[T3 Service] select-box:"+t+" - "+i)}function f(t){if(a.hasClass(t,u.selectWrap)){return t}return a.up(t,"."+u.selectWrap)}function p(t,i){var s=t.getAttribute("data-nativeselectboxid");c[s]={select:i,options:a.find(i,"option"),selectEl:t,selectList:a.find(t,"."+u.selectList)[0],listItems:a.find(t,"."+u.listItem),upArrow:a.find(t,"."+u.upArrow)[0],downArrow:a.find(t,"."+u.downArrow)[0],text:a.find(t,"."+u.selectTextValue)[0]};return s}function m(t,i){var s=a.find(t,"option");var n=[];if(s.length){for(var o=0;o<s.length;o++){n.push({optionIndex:s[o].index,optionName:s[o].text||"&nbsp"})}}else{t.appendChild("<option>&nbsp;</option>");n.push({optionIndex:"0",optionName:"&nbsp;"})}r.load({id:"selectWrap",data:{options:n,value:""},returnType:"fragment",callback:i})}function h(t){t=f(t);var i=t.getAttribute("data-nativeselectboxid");if(c[i]){return c[i]}p(t);return c[i]}function g(t){t.selectList.removeAttribute("style");t.upArrow.removeAttribute("style");a.setStyle(t.downArrow,{display:"none"})}function b(t){var i;if(typeof t.activeItem!=="undefined"){i=f(t.activeItem);t=h(i)}a.setStyle(t.selectList,{display:"none"});a.setStyle(t.upArrow,{display:"none"});t.downArrow.removeAttribute("style")}function v(t){var i=f(t);if(a.hasClass(i,u.jsDisabled)){return true}return false}function w(t){if(!t){return false}var i;for(i in c){if(!c.hasOwnProperty(i)||c[i].select!==t){continue}return c[i]}return false}function y(t,i){var s=h(t);a.removeClass(s.listItems,u.activeItem);s.listItems.forEach(function(t){if(parseInt(t.getAttribute("data-optionIndex"),10)===i){a.addClass(t,u.activeItem);a.updateHTML(s.text,s.options[i].text)}})}function k(){var t=a.find(i.body,"."+u.focusedText);if(t.length){return a.up(t[0],"."+u.selectWrap)}else{return false}}function z(t){var i=a.find(t,"."+u.activeItem);if(i.length){return s.first(i)}return null}function T(t){return a.getStyle(t,"display")!=="none"}function E(t){var i=h(t);a.addClass(i.text,u.focusedText)}function S(t){var i=h(t);a.removeClass(i.text,u.focusedText)}function C(){var t;var s=a.find(i.body,"."+u.selectWrap);if(s.length){s.forEach(function(i){t=h(i);S(i);b(t)})}}function A(t){var i=f(t);var s=h(i);var r=s.listItems;var n=s.text;var o=parseInt(t.getAttribute("data-optionIndex"),10);s.options.forEach(function(t,i){if(i===o){t.selected=true;a.updateHTML(n,t.text)}else{t.selected=false}});a.removeClass(r,u.activeItem);a.addClass(t,u.activeItem);S(i)}function N(t){var i;var r=k();if(!r||v(r)){return}var o=z(r);var l=h(r);if(n.checkKeyCode("ENTER",t)){if(T(l.selectList)){if(o){A(o)}b(l)}else{g(l)}return}if(!n.checkKeyCode("UP_ARROW",t)&&!n.checkKeyCode("DOWN_ARROW",t)){return}if(n.checkKeyCode("UP_ARROW",t)){i=o?a.previous(o):s.last(l.listItems)}else{i=o?a.next(o):s.first(l.listItems)}if(i){l.listItems.forEach(function(t){a.removeClass(t,u.activeItem)});a.addClass(i,u.activeItem)}}function I(t){if(v(t.selectEl)){return}C();g(t);E(t.selectEl)}function B(t){b(t);S(t.selectEl)}function q(t){if(T(t.selectList)){B(t)}else{I(t)}}function x(t){var e=t.data.event;var i=e.target||e.currentTarget;if(!i.className.match(new RegExp(u.selectWrap,"g"))){C()}}function F(t){var e=t.data.event;if(e.altKey||e.ctrlKey){return true}var i=e.keyCode;if(n.checkKeyCode("TAB",i)||n.checkKeyCode("ESCAPE",i)){C();e.stop();return false}N(i);e.stop();return false}function O(t){if(s.isMobile){return}if(v(t.data.element)){return}switch(t.data.elementType){case"bf-select-text":q(h(t.data.element));break;case"bf-select-list__item":A(t.data.element);b({activeItem:t.data.element});break}}function U(t){var i=t.data.element instanceof HTMLSelectElement?t.data.element:a.up(t.data.element,"select");var s=w(i);if(!s){return}y(s.selectEl,i.selectedIndex)}function R(){t.on("select-box:documentclick",x);t.on("select-box:documentkeydown",F);t.on("select-box:click",O);t.on("select-box:change",U)}l.createNativeSelect=function(t){if(!t.length){_("create","No select box options provided");return false}var a=i.createElement("select");var s=i.createDocumentFragment();function r(t){var a=i.createElement("option");a.appendChild(i.createTextNode(t.key));a.value=t.value;if(t.selected){a.selected="selected"}s.appendChild(a)}t.forEach(r);a.appendChild(s);a.className="bf-select-test";a.setAttribute("data-type","select-box");return a};l.init=function(t){t=s.extend({},d,t||{});if(!t.select){_("init",'"select" element wasn\'t passed');return false}var i="bf-native-select-box-"+(new Date).getTime();m(t.select,function(r){var n=r.firstChild;n.setAttribute("data-nativeselectboxid",i);p(n,t.select);y(n,t.select.selectedIndex);if(s.isMobile){a.addClass(t.select,u.mobile)}else{a.addClass(t.select,u.desktop)}if(t.autoinsert){a.after(t.select,n);n.appendChild(t.select)}if(typeof t.callback==="function"){t.callback(n)}})};l.enable=function(t){var i=w(t);if(!i){_("enable","Unable to retrieve elements for given select");return false}a.removeClass(i.selectEl,u.disabled);a.removeClass(i.selectEl,u.jsDisabled)};l.disable=function(t){var i=w(t);if(!i){_("disable","Unable to retrieve elements for given select");return false}a.addClass(i.selectEl,u.disabled);a.addClass(i.selectEl,u.jsDisabled);b(i)};l.toggle=function(t){var i=w(t);if(!i){_("open","Unable to retrieve elements for given select");return false}q(i)};l.open=function(t){var i=w(t);if(!i){_("open","Unable to retrieve elements for given select");return false}I(i)};l.close=function(t){var i=w(t);if(!i){_("open","Unable to retrieve elements for given select");return false}B(i)};R();return l});Box.Application.addBehavior("newsletter-signup",function(t){"use strict";var i;var a;var s;var r;var n;var o;var l;var u;function d(t){u.track_events(i.getAttribute(l.gtrack_cat),t)}function c(t){if(t.length){r.removeClass(a,"hidden");a.innerHTML="<span>"+t.join("</span><span>")+"</span>"}else{r.addClass(a,"hidden")}}function _(){d("signup/email-error");c(["Sorry! Something went wrong. Please try again."])}function f(t){var a=[];if(!o.isEmail(t.email)){a.push("Please enter a valid email address");r.addClass(r.find(i,'input[name="email"]'),"error-border")}if(!t.category||!t.category.length){a.push("Don't forget to select a newsletter!")}c(a);if(a.length){d("signup/validation-error")}return!a.length}function p(i){d("signup/email-success");t.broadcast("newsletter-subscribed",i)}var m={};m.init=function(){i=t.getElement();s=t.getService("ajax");o=t.getService("validation");r=t.getService("dom");n=t.getService("loading-spinner");var d=r.find(i,"[data-type='loading-spinner']")[0];if(d){n=n.create(d)}a=r.find(i,'[data-type="error-message"]')[0];u=t.getGlobal("gtrack");l=t.getGlobal("bfjs")};m.destroy=function(){i=null;s=null;o=null;r=null};m.onsubmit=function(t,i){t.preventDefault();var a=r.serialize(i);if(f(a)){this.subscribe(a)}};m.onclick=function(t,a,s){if(s==="vertical-checkbox"){var n=r.find(a.parentNode,'input[type="checkbox"]')[0];d(n.getAttribute(l.gtrack_act)+"/"+(n.checked?"uncheck":"check"));r.addClass(r.find(i,'[data-type="success-message"]'),"hidden")}};m.subscribe=function(t){n.show();s.request({url:"/buzzfeed/_email",data:t,type:"GET",dataType:"json",success:p,error:_,always:function(){n.hide()}})};return m});Box.Application.addBehavior("select-box",function(t){"use strict";var i={};var a;function s(e){t.application.fire("select-box:documentclick",{event:e})}function r(e){t.application.fire("select-box:documentkeydown",{event:e})}function n(i,a,s){t.application.fire("select-box:click",{event:i,element:a,elementType:s})}function o(i,a,s){t.application.fire("select-box:change",{event:i,element:a,elementType:s})}i.init=function(){a=t.getService("dom");a.on("click",s);a.on("keydown",r)};i.destroy=function(){a.off("click",s);a.off("keydown",r);a=null};i.onclick=function(t,i,a){n(t,i,a)};i.onchange=function(t,i,a){o(t,i,a)};return i});Box.Application.addModule("newsletter-signup",function(t){"use strict";var i;var a;var s={};s.behaviors=["newsletter-signup"];s.messages=["newsletter-subscribed","individual-newsletter-subscribed"];s.onmessage=function(t,s){switch(t){case"newsletter-subscribed":var r=a.find(i,'[data-type="success-message"]')[0];a.removeClass(r,"hidden");r.innerHTML="Great! You'll get your first email soon.";a.removeClass(a.find(i,".js-newsletter-list")[0],"hidden");a.removeClass(a.find(i,'[data-type="subscribe-text"]'),"hidden");a.addClass(a.find(i,'[data-type="unsubscribe-text"]'),"hidden");break;case"individual-newsletter-subscribed":var n=a.find(i,"#signup_"+s.category.toLowerCase())[0];a.removeClass(i,"hidden");a.find(i,'[data-type="newsletter-signup-form"] input[name="email"]')[0].value=s.email;if(n){n.checked=true}break}};s.init=function(){i=t.getElement();a=t.getService("dom")};s.destroy=function(){i=null;a=null};return s});Box.Application.addModule("newsletter-signup-individual",function(t){"use strict";var i;var a;var s;var r={};r.behaviors=["newsletter-signup"];r.messages=["newsletter-subscribed"];r.onmessage=function(r,n){if(r==="newsletter-subscribed"){var o=s.find(i,'[data-type="success-message"]')[0];s.removeClass(o,"hidden");o.innerHTML="<span>Great!</span> You'll get your first email soon.";s.addClass(s.find(i,'[data-type="newsletter-form"]'),"hidden");if(a&&a.hideSelf){setTimeout(function(){s.addClass(i,"hidden");t.broadcast("individual-newsletter-subscribed",n.request.parameters);t.application.stop(i)},1500)}}};r.init=function(){i=t.getElement();a=t.getConfig();s=t.getService("dom")};r.destroy=function(){i=null;a=null;s=null};return r});Box.Application.addService("seed-user-impression-tracking",function(t){"use strict";var i=t.getGlobal("bfjs");var a=t.getGlobal("gtrack");var $=t.getGlobal("$");var s=t.getService("viewport-monitor");var r={};function n(t){var s=this;s.trackIfVisible=function(){try{var s=t.querySelector("["+i.gtrack_cat.replace(":","\\:")+"]");var r=s?s[i.read_attr](i.gtrack_cat):undefined;var n=t.querySelector("["+i.gtrack_act.replace(":","\\:")+"]");var o=n?n[i.read_attr](i.gtrack_act):undefined;var l=t.querySelector("["+i.gtrack_label.replace(":","\\:")+"]");var u=l?l[i.read_attr](i.gtrack_label):undefined;if(r!==undefined&&o!==undefined){a.track_events(r,"[nc]imp:"+o,u,null,true)}}catch(d){console.error(d)}}}r.addImpressionTracking=function(t){var i=new n(t);s.startWatching({target:t,renderLookahead:0,callback:i.trackIfVisible,watchOnce:true})};return r});Box.Application.addService("viewport-monitor",function(t){"use strict";var i={};var a=0;var s=t.getService("dom");var r;function n(t){var i=s.getViewPosition(t.target,t.renderLookahead);if(i.isPartiallyInViewport()||i.isPartiallyInLookahead()){t.callback();if(t.watchOnce){r.stopWatching(t.target)}}}function o(){for(var t in i){if(i.hasOwnProperty(t)){n(i[t])}}}t.getService("scroll-listener").add({callback:o});r={};r.startWatching=function(t){i[a++]=t;n(t)};r.stopWatching=function(t){if(t instanceof HTMLElement){for(var a in i){if(i.hasOwnProperty(a)&&i[a].target===t){delete i[a];break}}}};return r});Box.Application.addService("scroll-listener",function(t){"use strict";var i=350;var a=0;var s={};var r=t.getService("dom");var n=t.getService("util");function o(t){var i=this;var s={};var o=t.throttleTimeout;this.add=function(t){s[++a]=t;return a};this.remove=function(t){delete s[t]};this.trigger=function(t){if(s.hasOwnProperty(t)){s[t]()}else{for(var i in s){if(s.hasOwnProperty(i)){s[i]()}}}};r.on("scroll",n.throttle(i.trigger,o));r.on("resize",n.throttle(i.trigger,o))}var l={};l.add=function(t){if(typeof t.throttleTimeout==="undefined"){t.throttleTimeout=i}var a=s[t.throttleTimeout];if(!a){a=s[t.throttleTimeout]=new o(t)}var r=a.add(t.callback);a.trigger(r);return r};l.remove=function(t){for(var i in s){if(s.hasOwnProperty(i)){s[i].remove(t)}}};return l});Box.Application.addService("seed-user-promo-selector",function(t){"use strict";var i=t.getGlobal("BF_STATIC");var a={};var s=t.hasService("cookies")?t.getService("cookies"):null;var r=t.getService("util");var n={};Box.Application.on("message",function(t){switch(t.data.message){case"bottom-container-updated":a.bottom=t.data.messageData;n.checkPromoCombo();break;case"top-container-updated":a.top=t.data.messageData;n.checkPromoCombo();break;case"inline-container-updated":a.inline=t.data.messageData;n.checkPromoCombo();break}});n.checkPromoCombo=function(){if(a.inline&&a.bottom){if(a.bottom.template&&a.bottom.template.match(/swarm/)!==null){t.broadcast("hide-inline-promo")}}};n.selectPromo=function(t){switch(t.promoArea){case"inline":n.selectInlinePromo(t);break;case"top-container":n.selectTopContainerPromo(t);break;case"bottom-container":n.selectBottomContainerPromo(t);break}};n.selectInlinePromo=function(a){var s=a.swarm;if(s&&i.app_name!=="bfnews"){var n=0;var o=i.os;n=s.os&&s.os[o];if(s.osVersion&&!r.isEmptyObj(s.osVersion[o])){var l;if(i.os_version){l=i.os_version.toString()}n=s.osVersion[o].all||s.osVersion[o][l]}var u=s.testDate||new Date;var d;var c;var _;if(s.displayDates){var f=s.displayDates.mobile[o];if(r.isEmptyObj(f)){return}if(f.news_bpage){d=f.news_bpage.end;c=f.news_bpage.start}else if(f.quiz_bpage){d=f.quiz_bpage.end;c=f.quiz_bpage.start}c=c.replace(/-/g,"/");d=d.replace(/-/g,"/");_=Date.parse(c)<Date.parse(u)&&Date.parse(u)<Date.parse(d)}if(_&&(s.noOSCheck||n)){var p={};p.templateId=s.template;p.data={};var m=s.constants[o];p.data.action=m.action;p.data.campaignStyle=m.campaignStyle;p.data.gtrack=m.gtrack;p.data.href=m.links[s.vertical]||m.links[s.metavertical]||m.links.default;p.data.copy=m.copy[s.vertical]||m.copy[s.metavertical]||m.copy.default;if(typeof window.abtest!=="undefined"&&typeof m.ab_test!=="undefined"&&m.ab_test.name&&m.ab_test.show_variation){window.EventManager.observe_once("abtest:"+m.ab_test.name,function(i){if(i===m.ab_test.show_variation){t.broadcast("display-inline-promo-by-template",p);return}})}else{t.broadcast("display-inline-promo-by-template",p)}return}}var h=a.possiblePromos;if(!h){return}h=h.split(",");var g={};h.forEach(function(t){g[t]=1});if(typeof g.newsletter_signup!=="undefined"){t.broadcast("show-inline-newsletter-signup")}};n.getRandByWeight=function(t){var i;var a;var s=0;var r=0;var n;for(n in t){i=t[n];r+=i}var o=Math.floor(Math.random()*r);for(n in t){i=t[n];s+=i;if(o<=s){a=n;break}}return a};n.selectTopContainerPromo=function(a){var s=a.swarm;if(s){var o=i.os;if(s.noOSCheck||s.os&&s.os[o]!==undefined){var l={};l.templateId=s.template;if(r.isEmptyObj(s.constants)){l.data={}}else{l.data=s.constants}if(typeof s.adParams!=="undefined"){l.data.adParams=s.adParams}t.broadcast("display-top-promo-by-template",l);return}}var u=a.promoConfig;if(r.isEmptyObj(u)){t.broadcast("hide-top-promo");return}var d=n.getRandByWeight(u);var c=n.okToShow(d);if(c){switch(d){case"bf_app":t.broadcast("show-top-bf-app-promo");break;case"fb_follow":t.broadcast("show-top-fb-like-promo");break}}else{delete u[d];n.selectTopContainerPromo(u)}};n.okToShow=function(t){if(!s){return false}if(s.get(t+"_promo_clicked")){return false}if(s.get(t+"_promo_closed")){return false}return true};n.selectBottomContainerPromo=function(a){var s=a.possiblePromos;var r={};var o=i.os;var l=a.swarm;if(l){if(l.os[o]!==undefined||l.noOSCheck){var u={};u.data={};u.templateId=l.template;if(l.constants){u.data=l.constants[o]}if(typeof l.adParams!=="undefined"){u.data.adParams=l.adParams}t.broadcast("display-bottom-promo-by-template",u);return}}if(s){s.split(",").forEach(function(t){r[t]=1})}else{return}if(!window.BF_STATIC.bf_test_mode&&typeof r.goat!=="undefined"&&typeof window.ab_config!=="undefined"&&window.ab_config.new_app_promos&&typeof window.abtest!=="undefined"&&typeof window.abtest.abTests!=="undefined"){if(!window.abtest.abTests.match("new_app_promos")){window.EventManager.observe_once("abtest:new_app_promos",function(){n.selectBottomContainerPromo(a)});return}else{var d=window.abtest.abVariations.match("new_app_promos--(goat1|goat2|corgi|cat|dudephone|dudeyawn|squadgoals|random)(,|$)");if(d.length){t.broadcast("show-bottom-test-bf-app-promo",{data:{testName:d[1],os:o}})}return}}if(typeof r.sponsored!=="undefined"){t.broadcast("show-bottom-sponsored-bf-app-promo")}else if(typeof r.news!=="undefined"){t.broadcast("show-bottom-news-bf-app-promo")}else if(typeof r.quiz!=="undefined"){t.broadcast("show-bottom-quiz-bf-app-promo")}else if(typeof r.goat!=="undefined"){t.broadcast("show-bottom-goat-bf-app-promo")}};return n});Box.Application.addModule("inline-promo",function(t){"use strict";var i;var a;var s;var r;var n;var o;var l={};l.viewed=0;l.messages=["show-inline-newsletter-signup","hide-inline-promo","display-inline-promo-by-template"];l.onmessage=function(t,i){switch(t){case"show-inline-newsletter-signup":l.displayNewsletterSignup();break;case"hide-inline-promo":l.resetHTML();break;case"display-inline-promo-by-template":l.renderTemplate(i.templateId,i.data);break}};l.resetHTML=function(){i.innerHTML=i.innerHTML.match(/<script .*script>/)[0]};l.selectPromo=function(){var i={};i.possiblePromos=t.getConfig("promos");i.swarm=t.getConfig("swarm");i.promoArea="inline";r.selectPromo(i)};l.renderTemplate=function(r,n,o){a.loadRawTemplate({id:r,path:"/components/seed_user_promos/inline/",callback:function(){var l=a.render(r,n);if(l){i.innerHTML=i.innerHTML.match(/<script .*script>/)[0]+l;t.broadcast("inline-container-updated",{template:r})}else{var u="Unable to render "+r+" template.";if(o){u=o+": "+u}s.error(u)}}})};l.displayNewsletterSignup=function(){var i=t.getConfig("vertical");var a=t.getConfig("constants").newsletter_config;var s=t.getConfig("constants").category_to_newsletter;i=typeof s[i]!=="undefined"?s[i]:"buzzfeed";var r=a[i];var n={newsletterTitle:r.prompt_bpage,category:r.email_category};if(o.isMobile){n.gtrackCat="NewsletterPromo";n.gtrackAct="inline-mobile-bpage-promo"}else{n.gtrackCat="NewsletterPromo";n.gtrackAct="inline-desktop-bpage-promo"}var u="mailchimp-newsletter-signup-form";var d="inline-promo.displayNewsletterSignup";l.renderTemplate(u,n,d)};l.init=function(){i=t.getElement();s=t.getService("log");a=t.getService("template-engine");r=t.getService("seed-user-promo-selector");o=t.getService("util");n=t.getService("seed-user-impression-tracking");this.selectPromo();n.addImpressionTracking(i)};l.destroy=function(){i=null;s=null;a=null;r=null};return l});Box.Application.addModule("top-container-promo",function(t){"use strict";var i=t.getGlobal("BF_STATIC");var a;var s;var r;var n;var o;var l;var u;var d={};d.currentPromo={};d.templateIdMap={"fb-like-banner":"fb_follow","bf-app-banner":"bf_app"};d.messages=["show-top-bf-app-promo","show-top-fb-like-promo","hide-top-promo","display-top-promo-by-template"];d.onmessage=function(t,i){switch(t){case"show-top-bf-app-promo":d.displayBFAppPromo();break;case"show-top-fb-like-promo":d.displayFBLikePromo();break;case"hide-top-promo":d.resetAndHide();break;case"display-top-promo-by-template":d.renderTemplate(i.templateId,i.data);break}};d.onclick=function(t,i,a){if(!l){return}var s=d.currentPromo.promo;var r={};r.value=1;r.days=30;if(a==="close_icon"){d.resetAndHide();if(typeof s!=="undefined"){r.name=s+"_promo_closed";l.set(r)}}else{if(typeof s!=="undefined"){r.name=s+"_promo_clicked";l.set(r)}}};d.resetAndHide=function(){u.removeClass(a,"app_promo--loading");u.addClass(a,"app_promo--hidden");a.innerHTML=a.innerHTML.match(/<script .*script>/)[0]};d.renderTemplate=function(n,l,c){l.staticRoot=i.static_root;s.loadRawTemplate({id:n,path:"/components/seed_user_promos/top_container/",callback:function(){var i=s.render(n,l);if(i){u.removeClass(a,"app_promo--loading");u.removeClass(a,"app_promo--hidden");a.innerHTML=a.innerHTML.match(/<script .*script>/)[0]+i;d.currentPromo.template=n;d.currentPromo.promo=d.templateIdMap[n];t.broadcast("top-container-updated",{template:n});if(n.match(/sponsored-swarm/)&&i){d.setSponsoredSwarmTargeting(l.adParams)}o.addImpressionTracking(a)}else{var _="Unable to render "+n+" template.";if(c){_=c+": "+_}r.error(_)}}})};d.setSponsoredSwarmTargeting=function(t){var i=t.size.split("x").map(function(t){return parseInt(t,10)});if(typeof window.loadSwarmAds!=="undefined"){window.loadSwarmAds({wid:t.wid,size:i,pos:t.pos})}};d.selectPromo=function(){var i={};i.swarm=t.getConfig("swarm");i.promoArea="top-container";i.promoConfig=t.getConfig("weightedPromos");n.selectPromo(i)};d.displayBFAppPromo=function(){var t;var a;var s=navigator.userAgent.indexOf(/safari/i)&&navigator.userAgent.indexOf(/crios/i);if(i.os==="android"){t="Browse BuzzFeed faster with the BuzzFeed app!";a="http://bit.ly/1Baaka8"}else if(i.os==="ios"&&!s){t="Save all your favs with the BuzzFeed app!";a="http://bit.ly/1BaamyN"}else{d.resetAndHide();return}var r={copy:t,adjustLink:a};var n="bf-app-banner";var o="top-container-promo.displayBFAppPromo";d.renderTemplate(n,r,o)};d.displayFBLikePromo=function(){var t={};var i="fb-like-banner";var a="top-container-promo.displayFBLikePromo";d.renderTemplate(i,t,a)};d.init=function(){a=t.getElement();r=t.getService("log");s=t.getService("template-engine");n=t.getService("seed-user-promo-selector");o=t.getService("seed-user-impression-tracking");l=t.hasService("cookies")?t.getService("cookies"):null;u=t.getService("dom");this.selectPromo()};d.destroy=function(){a=null;r=null;s=null;n=null};return d});var BF_mPulse=function(){_send_first_paint_timer=function(){var t;var i;if(typeof window.chrome!=="undefined"){t=(window.chrome.loadTimes().firstPaintTime-window.chrome.loadTimes().startLoadTime)*1e3}else{if(typeof window.performance==="undefined"){return false}else if(typeof window.performance.timing.msFirstPaint!=="undefined"){t=window.performance.timing.msFirstPaint-window.performance.timing.startLoadTime}else{t=(new Date).getTime()-window.performance.timing.startLoadTime}}if(window.firstAnimationFrameFired&&window.performance){if(typeof window.chrome!=="undefined"){i=window.firstAnimationFrameFired-window.chrome.loadTimes().startLoadTime*1e3}else{if(typeof window.performance==="undefined"){return false}i=window.firstAnimationFrameFired-window.performance.timing.responseStart}}var a=t;if(i<t)a=i;mPulse.sendTimer("firstPaintTime",a)};_setup_event_handlers=function(){EventManager.observe("mpulse:user_shared",function(t){mPulse.setPageGroup("Shared Group");mPulse.sendMetric("Shared",1)})};this.init=function(){if(window.mPulse===undefined)return;_send_first_paint_timer();_setup_event_handlers()}};var bf_mpulse=new BF_mPulse;bf_mpulse.init();(function(){if(!window.Box||!Box.Application||!Box.Application.getService("template-engine"))return;Box.Application.getService("template-engine").addTemplates({modal_base:new Hogan.Template({code:function(t,i,a){var s=this;s.b(a=a||"");s.b('<div class="modal__wrapper solid">');s.b("\n"+a);s.b('  <div class="modal__content xs-mt0 sm-mt6 xs-col-12 sm-col-9 md-col-7 lg-col-5">');s.b("\n"+a);s.b('    <a class="modal__close" href="javascript:">');s.b("\n"+a);s.b('      <svg class="modal__close-icon" viewBox="0 0 512 512"><use xlink:href="#close--thick"></use></svg>');s.b("\n"+a);s.b("    </a>");s.b("\n"+a);s.b('    <div class="modal__body"></div>');s.b("\n"+a);s.b("  </div>");s.b("\n"+a);s.b("</div>");return s.fl()},partials:{},subs:{}})})})();Box.Application.addService("cookies",function(){"use strict";var t={};t.get=function(t,i){var a=t+"=";var s=document.cookie.split(";");for(var r=0;r<s.length;r++){var n=s[r];while(n.charAt(0)===" "){n=n.substring(1,n.length)}if(n.indexOf(a)===0){return n.substring(a.length,n.length)}}return typeof i!=="undefined"?i:null};t.set=function(t){var i="";if(t.days){var a=new Date;a.setTime(a.getTime()+t.days*24*60*60*1e3);i=";expires="+a.toGMTString()}document.cookie=t.name+"="+t.value+i+"; path=/; domain=.buzzfeed.com"};t.remove=function(t){this.set({name:t,value:"",days:-1})};return t});Box.Application.addBehavior("native-video-embed",function(t){"use strict";var i=t.getElement();var a=[];var s=t.getService("dom");var r=t.getService("util");var n=t.getService("native-video-embed").create(i);var o=t.getService("native-video-collection");var l=false;var u=false;var d=false;var c=false;var _=false;function f(){var i={src:t.getConfig("video-src"),defaultVolume:1,sourceTypes:{mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",m3u8:"application/x-mpegURL"},classes:["native-video__embed"],attributes:{poster:t.getConfig("thumb-src"),"data-type":"native-video-embed","data-control-type":"play"},callbacks:{onloadstart:function(){A()},onwaiting:function(){A()},onplaying:function(){N()},onerror:function(e){var t;var i;for(i in e.target.error){if(i!="code"&&e.target.error[i]==e.target.error.code){t=i;break}}if(!t){return}C(n.getVideoError(t))},onprogress:function(e){var t=[];var i=e.target.buffered;var a=e.target.duration;var s;var r;for(var n=0;n<i.length;n++){t.push({start:i.start(n),end:i.end(n)})}S(a,t)},onplay:function(e){if(!e.target.paused){m()}},onpause:function(e){if(e.target.paused&&e.target.duration!=e.target.currentTime){h()}},oncanplaythrough:function(){N();v()},oncanplay:function(e){N();p();v();w(e.target.duration,e.target.currentTime)},ontimeupdate:function(e){var t=Math.floor(e.target.currentTime/e.target.duration*100);w(e.target.duration,e.target.currentTime);if(t>=25&&t<50&&!u){u=true;b(25,t)}else if(t>=50&&t<75&&!d){d=true;b(50,t)}else if(t>=75&&!c){c=true;b(75,t)}if(e.target.duration==e.target.currentTime&&!_){_=true;g()}},onfullscreen:function(e){e.target.controls=true},onexitfullscreen:function(e){e.target.controls=false;e.target.volume=1;if(e.target.muted){T()}else{E()}if(e.target.paused){z(e.target.paused)}else{k(!e.target.paused)}setTimeout(function(){o.setFullScreenMode(false)},500)}}};n.createVideo(i)}function p(){var a=r.getUniqueEventName("native-video-embed:video-load",i);t.broadcast(a,{videoSrc:t.getConfig("video-src")})}function m(){var a=r.getUniqueEventName("native-video-embed:video-play",i);t.broadcast(a,{videoSrc:t.getConfig("video-src")})}function h(){var a=r.getUniqueEventName("native-video-embed:video-pause",i);t.broadcast(a,{videoSrc:t.getConfig("video-src")})}function g(){var a=r.getUniqueEventName("native-video-embed:video-stop",i);t.broadcast(a,{videoSrc:t.getConfig("video-src")})}function b(a,s){var n=r.getUniqueEventName("native-video-embed:video-progress",i);t.broadcast(n,{videoSrc:t.getConfig("video-src"),percentage:a,realPercentage:s})}function v(){var a=r.getUniqueEventName("native-video-embed:show-video-controls",i);t.broadcast(a)}function w(a,s){var n=r.getUniqueEventName("native-video-embed:update-video-current-time",i);t.broadcast(n,{duration:a,currentTime:s})}function y(){t.broadcast("auto-pause-other-videos",{moduleEl:i})}function k(a){var s=r.getUniqueEventName("native-video-embed:auto-play-video-control",i);t.broadcast(s,{played:a})}function z(a){var s=r.getUniqueEventName("native-video-embed:auto-pause-video-control",i);t.broadcast(s,{paused:a})}function T(){var a=r.getUniqueEventName("native-video-embed:auto-mute-video-control",i);t.broadcast(a)}function E(){var a=r.getUniqueEventName("native-video-embed:auto-unmute-video-control",i);t.broadcast(a)}function S(a,s){var n=r.getUniqueEventName("native-video-embed:update-video-progress-load-control",i);t.broadcast(n,{duration:a,bufferedParts:s})}function C(a){var s=r.getUniqueEventName("native-video-embed:error-video-playing",i);t.broadcast(s,{errorText:a})}function A(){var a=r.getUniqueEventName("native-video-embed:show-video-loader",i);t.broadcast(a)}function N(){var a=r.getUniqueEventName("native-video-embed:hide-video-loader",i);t.broadcast(a)}function I(){R();y();l=false}function B(){n.playVideo();y();l=false}function q(){n.pauseVideo();l=true}function x(){n.muteVideo()}function F(){n.unmuteVideo()}function O(t){n.updateCurrentTimeVideo(t.currentTimePercentage)}function U(){n.fullScreenVideo()}function R(){f();if(n.isVideo()&&!n.isEndedVideo()&&!l&&!r.isIOSMobile){k(n.playVideo())}}function L(){if(n.isVideo()&&!r.isIOSMobile){z(n.pauseVideo())}}function j(t){if(t.moduleEl!=i&&n.isVideo()){n.pauseVideo()}}a[r.getUniqueEventName("native-video-thumb:click-video-thumb",i)]=I;a[r.getUniqueEventName("native-video-controls:click-video-control-play",i)]=B;a[r.getUniqueEventName("native-video-controls:click-video-control-pause",i)]=q;a[r.getUniqueEventName("native-video-controls:click-video-control-unmute",i)]=F;a[r.getUniqueEventName("native-video-controls:click-video-control-mute",i)]=x;a[r.getUniqueEventName("native-video-controls:click-video-control-fullscreen",i)]=U;a[r.getUniqueEventName("native-video-controls:manual-update-video-progress-bar",i)]=O;a[r.getUniqueEventName("native-video-collection:auto-play-video",i)]=R;a[r.getUniqueEventName("native-video-collection:auto-pause-video",i)]=L;a["auto-pause-other-videos"]=j;var M={};M.messages=r.getKeys(a);M.onmessage=function(t,i){var s=a[t];if(typeof s==="function"){s.call(this,i)}};M.init=function(){};M.destroy=function(){i=null;a=[];s=null;r=null;n=null};return M});Box.Application.addBehavior("native-video-controls",function(t){"use strict";var i=t.getElement();var a=[];var s=t.getService("dom");var r=t.getService("util");var n=t.getService("native-video-controls").create(i);function o(e){n.showAndAutoHideControls();n.disableAutoUpdateProgressBar();var t=n.manualUpdateProgressBar(e);p({currentTimePercentage:t})}function l(e){n.showAndAutoHideControls();if(n.disabledAutoUpdateProgressBar){var t=n.manualUpdateProgressBar(e);p({currentTimePercentage:t})}}function u(e){n.showAndAutoHideControls();
n.enableAutoUpdateProgressBar()}function d(){n.controlsEls.progressBar.wrapper.addEventListener("touchstart",o,false);n.controlsEls.progressBar.wrapper.addEventListener("touchmove",l,false);n.controlsEls.progressBar.wrapper.addEventListener("touchend",u,false)}function c(){n.controlsEls.progressBar.wrapper.removeEventListener("touchstart",o);n.controlsEls.progressBar.wrapper.removeEventListener("touchmove",l);n.controlsEls.progressBar.wrapper.removeEventListener("touchend",u)}function _(){n.createControls(function(){d()})}function f(a,s){var n=r.getUniqueEventName("native-video-controls:click-video-control-"+a,i);t.broadcast(n,s)}function f(a,s){var n=r.getUniqueEventName("native-video-controls:click-video-control-"+a,i);t.broadcast(n,s)}function p(a){var s=r.getUniqueEventName("native-video-controls:manual-update-video-progress-bar",i);t.broadcast(s,a)}function m(){t.broadcast("auto-pause-other-videos",{moduleEl:i})}function h(t){if(!t){return}switch(t){case"play":m();f(t);n.updatePlayToPause();n.enableAutoHideControls();break;case"pause":f(t);n.updatePauseToPlay();n.disableAutoHideControls();break;case"mute":f(t);n.updateMuteToUnmute();break;case"unmute":f(t);n.updateUnmuteToMute();break;case"fullscreen":f(t);m();n.hideControls();break}n.showAndAutoHideControls()}function g(){_()}function b(){n.enableDisplayControls();n.showAndAutoHideControls()}function v(t){n.updateTimeline(t.duration,t.currentTime);n.autoUpdateProgressBar(t.duration,t.currentTime);if(t.duration==t.currentTime){n.updatePauseToPlay();n.disableAutoHideControls();n.showAndAutoHideControls()}}function w(t){if(!n.isControls()){_()}if(t.played){n.enableAutoHideControls();n.showAndAutoHideControls();n.updatePlayToPause()}}function y(t){if(t.paused){n.updatePauseToPlay();n.disableAutoHideControls();n.showAndAutoHideControls()}}function k(t){n.updateMuteToUnmute()}function z(t){n.updateUnmuteToMute()}function T(t){if(t.moduleEl!=i){n.disableAutoHideControls();n.updatePauseToPlay()}}function E(t){n.updateProgressLoad(t.duration,t.bufferedParts)}function S(t){n.showError(t.errorText)}function C(){n.showLoader()}function A(){n.hideLoader()}a[r.getUniqueEventName("native-video-thumb:click-video-thumb",i)]=g;a[r.getUniqueEventName("native-video-embed:show-video-controls",i)]=b;a[r.getUniqueEventName("native-video-embed:update-video-current-time",i)]=v;a[r.getUniqueEventName("native-video-embed:auto-play-video-control",i)]=w;a[r.getUniqueEventName("native-video-embed:auto-pause-video-control",i)]=y;a[r.getUniqueEventName("native-video-embed:auto-mute-video-control",i)]=k;a[r.getUniqueEventName("native-video-embed:auto-unmute-video-control",i)]=z;a[r.getUniqueEventName("native-video-embed:update-video-progress-load-control",i)]=E;a[r.getUniqueEventName("native-video-embed:error-video-playing",i)]=S;a[r.getUniqueEventName("native-video-embed:show-video-loader",i)]=C;a[r.getUniqueEventName("native-video-embed:hide-video-loader",i)]=A;a["auto-pause-other-videos"]=T;var N={};N.messages=r.getKeys(a);N.onmessage=function(t,i){var s=a[t];if(typeof s==="function"){s.call(this,i)}};N.init=function(){};N.destroy=function(){i=null;a=[];s=null;r=null;n=null};N.onclick=function(t,i,a){if(a=="native-video-controls"||a=="native-video-embed"){h(i.getAttribute("data-control-type"))}};N.onmousedown=function(t,i,a){var s;if(a=="native-video-controls"){s=i.getAttribute("data-control-type");if(!s){return}if(s=="progress"){o(t)}}};N.onmouseup=function(t,i,a){var s;if(a=="native-video-controls"){s=i.getAttribute("data-control-type");if(!s){return}if(s=="progress"){u(t)}}};N.onmousemove=function(t,i,a){var s;if(a=="native-video-controls"){s=i.getAttribute("data-control-type");if(!s){return}if(s=="progress"){l(t)}}};N.onmouseover=function(t,i,a){n.showAndAutoHideControls()};N.onmouseout=function(t,i,a){var s;if(a=="native-video-controls"){s=i.getAttribute("data-control-type");if(!s){return}if(s=="progress"){u(t)}}};return N});Box.Application.addBehavior("native-video-thumb",function(t){"use strict";var i=t.getElement();var a=t.getService("native-video-thumb").create(i);var s=t.getService("util");var r=[];function n(){var a=s.getUniqueEventName("native-video-thumb:click-video-thumb",i);t.broadcast(a,{moduleEl:i})}function o(){a.thumbIsHidden=true;if(a.isThumb()){a.hideThumb()}}r[s.getUniqueEventName("native-video-collection:auto-play-video",i)]=o;var l={};l.messages=s.getKeys(r);l.onmessage=function(t,i){var a=r[t];if(typeof a==="function"){a.call(this,i)}};l.init=function(){a.createThumb(t.getConfig("thumb-src"))};l.destroy=function(){i=null;a=null;s=null};l.onclick=function(t,i,s){if(s=="native-video-thumb"){a.hideThumb();n()}};return l});Box.Application.addBehavior("native-video-collection",function(t){"use strict";var i=t.getElement();var a=t.getService("util");var s=t.getService("native-video-collection");function r(){var s=a.getUniqueEventName("native-video-collection:auto-play-video",i);t.broadcast(s)}function n(){var s=a.getUniqueEventName("native-video-collection:auto-pause-video",i);t.broadcast(s)}var o={};o.init=function(){s.setToVideoCollection({moduleEl:i,autoPlayVideo:r,autoPauseVideo:n})};o.destroy=function(){i=null;a=null;s=null};return o});Box.Application.addBehavior("native-video-tracking",function(t){"use strict";var i;var a;var s;function r(t,i){if(!window.bfa||!(window.bfa instanceof Function)||!window.bfaBinder){return}bfa(t,i)}function n(t){var i="track/video/load";var a={t:"load",n:"native-video-load",l:"native-video",d:"Video is loaded",data:t};r(i,a)}function o(t){var i="track/video/play";var a={t:"play",n:"native-video-play",l:"native-video",d:"Video is playing",data:t};r(i,a)}function l(t){var i="track/video/pause";var a={t:"pause",n:"native-video-pause",l:"native-video",d:"Video is paused",data:t};r(i,a)}function u(t){var i="track/video/stop";var a={t:"stop",n:"native-video-stop",l:"native-video",d:"Video is stopped",data:t};r(i,a)}function d(t){var i="track/video/progress";var a={t:"progress-"+t.percentage,n:"native-video-progress-"+t.percentage,l:"native-video",d:t.percentage+"% of video is shown",data:t};r(i,a)}function c(){s[a.getUniqueEventName("native-video-embed:video-load",i)]=n;s[a.getUniqueEventName("native-video-embed:video-play",i)]=o;s[a.getUniqueEventName("native-video-embed:video-pause",i)]=l;s[a.getUniqueEventName("native-video-embed:video-stop",i)]=u;s[a.getUniqueEventName("native-video-embed:video-progress",i)]=d;return a.getKeys(s)}var _={};_.onmessage=function(t,i){var a=s[t];if(typeof a==="function"){a.call(this,i)}};_.init=function(){i=t.getElement();a=t.getService("util");s=[];_.messages=c()};_.destroy=function(){i=null;a=null;s=[]};return _});Box.Application.addService("native-video-thumb",function(t){"use strict";var i=t.getService("dom");var a=Box.Application.getService("template-engine");function s(t){this.moduleEl=t;this.thumbEl=null;this.thumbPlayEl=null;this.thumbIsHidden=false}s.prototype.createThumb=function(t){var s=this;a.load({id:"native-video-thumb",data:{thumbSrc:t},returnType:"fragment",callback:function(t){s.moduleEl.appendChild(t);s.thumbEl=i.find(s.moduleEl,".native-video__thumb")[0];s.thumbPlayEl=i.find(s.moduleEl,".native-video__thumb-play")[0];if(s.thumbIsHidden){s.hideThumb()}}})};s.prototype.isThumb=function(){return this.thumbEl?true:false};s.prototype.showThumb=function(){this.thumbIsHidden=false;i.setStyle(that.thumbPlayEl,{display:"block"});i.setStyle(this.thumbEl,{display:"block"})};s.prototype.hideThumb=function(){this.thumbIsHidden=true;i.setStyle(this.thumbPlayEl,{display:"none"});i.setStyle(this.thumbEl,{display:"none"})};return{create:function(t){return new s(t)}}});Box.Application.addService("native-video-embed",function(t){"use strict";var i=t.getService("dom");var a=t.getService("native-video-collection");var s={MEDIA_ERR_ABORTED:"You aborted the media playback",MEDIA_ERR_NETWORK:"A network error caused the media download to fail part-way.",MEDIA_ERR_DECODE:"The media playback was aborted due to a corruption problem or because the media used features your browser did not support.",MEDIA_ERR_SRC_NOT_SUPPORTED:"The media could not be loaded, either because the server or network failed or because the format is not supported.",MEDIA_ERR_ENCRYPTED:"The media is encrypted and we do not have the keys to decrypt it."};var r=function(){if("onfullscreenchange"in document){return"fullscreenchange"}else if("onmozfullscreenchange"in document){return"mozfullscreenchange"}else if("onwebkitfullscreenchange"in document){return"webkitfullscreenchange"}else if("onmsfullscreenchange"in document){return"MSFullscreenChange"}return false}();function n(t){this.moduleEl=t;this.videoEl=null;this.isFullScreen=false}n.prototype.createVideoElement=function(t){var a=this;var s;var n;var o;var l;var u;if(!t.src){return null}this.videoEl=document.createElement("video");if(t.classes){this.videoEl.setAttribute("class",t.classes.join(" "))}if(t.attributes){for(n in t.attributes){this.videoEl.setAttribute(n,t.attributes[n])}}if(t.callbacks){for(o in t.callbacks){this.videoEl[o]=t.callbacks[o]}}if(t.defaultVolume){this.videoEl.volume=t.defaultVolume}else{this.videoEl.volume=1}if(r){document.addEventListener(r,function(){if(!a.isFullScreen){return}if(!document.fullscreen&&!document.webkitIsFullScreen&&!document.mozFullScreen&&!document.msFullscreenElement){a.isFullScreen=false;if(a.videoEl.onexitfullscreen){a.videoEl.onexitfullscreen({target:a.videoEl})}}else{if(a.videoEl.onfullscreen){a.videoEl.onfullscreen({target:a.videoEl})}}})}if(t.sourceTypes){for(l in t.sourceTypes){if(new RegExp("."+l).test(t.src)){s=document.createElement("source");s.type=t.sourceTypes[l];s.src=t.src;this.videoEl.appendChild(s)}}}else{this.videoEl.src=t.src}i.append(this.moduleEl,this.videoEl)};n.prototype.createVideo=function(t){if(this.isVideo()){return}this.createVideoElement(t)};n.prototype.isVideo=function(){return this.videoEl?true:false};n.prototype.playVideo=function(){this.videoEl.play();if(!this.videoEl.paused){this.videoEl.setAttribute("data-control-type","pause")}return!this.videoEl.paused};n.prototype.isEndedVideo=function(){return this.videoEl.duration==this.videoEl.currentTime};n.prototype.pauseVideo=function(){this.videoEl.pause();if(this.videoEl.paused){this.videoEl.setAttribute("data-control-type","play")}return this.videoEl.paused};n.prototype.muteVideo=function(){this.videoEl.muted=true};n.prototype.unmuteVideo=function(){this.videoEl.muted=false};n.prototype.updateCurrentTimeVideo=function(t){this.videoEl.currentTime=Math.min(this.videoEl.duration,this.videoEl.duration*t/100)};n.prototype.fullScreenVideo=function(){var t=false;if(this.videoEl.requestFullscreen){t=true;this.videoEl.requestFullscreen()}else if(this.videoEl.msRequestFullscreen){this.videoEl.controls=true;t=true;this.videoEl.msRequestFullscreen()}else if(this.videoEl.mozRequestFullScreen){t=true;this.videoEl.mozRequestFullScreen()}else if(this.videoEl.webkitRequestFullscreen){t=true;this.videoEl.webkitRequestFullscreen()}if(t){this.isFullScreen=true;a.setFullScreenMode(true)}};n.prototype.getVideoError=function(t){if(t&&s[t]){return s[t]}return""};return{create:function(t){return new n(t)}}});Box.Application.addService("native-video-controls",function(t){"use strict";var i=t.getService("dom");var a=Box.Application.getService("template-engine");function s(t){var i=Math.floor(t/(60*60));var a=t%(60*60);var s=Math.floor(a/60);var r=a%60;var t=Math.floor(r);return{h:i,m:s,s:t}}function r(t){var i=s(t);var a="";if(i.h){a+=i.h+":"}if(i.m){a+=i.m+":"}else{a+="0:"}if(i.s){a+=i.s<10?"0"+i.s:i.s}else{a+="00"}return a}function n(t){this.moduleEl=t;this.controlsEls=null;this.disabledDisplayControls=true;this.disabledAutoHideControls=true;this.disabledAutoUpdateProgressBar=false;this.autoHideControlsTimeout=null;this.controlsLoadCallbacks={}}n.prototype.createControls=function(t){var s=this;var r;if(this.controlsEls){return}a.load({id:"native-video-controls",returnType:"fragment",callback:function(a){s.moduleEl.appendChild(a);s.controlsEls={loader:i.find(s.moduleEl,".native-video-loader")[0],errorWrapper:i.find(s.moduleEl,".native-video-error")[0],wrapper:i.find(s.moduleEl,".native-video-controls")[0],playButton:i.find(s.moduleEl,".native-video__play-button")[0],muteButton:i.find(s.moduleEl,".native-video__mute-button")[0],currentTimeText:i.find(s.moduleEl,".native-video__current-time-text")[0],durationText:i.find(s.moduleEl,".native-video__duration-text")[0],progressBar:{wrapper:i.find(s.moduleEl,".native-video-progress")[0],play:i.find(s.moduleEl,".native-video-progress__play")[0],load:i.find(s.moduleEl,".native-video-progress__load")[0],seekHandle:i.find(s.moduleEl,".native-video-progress__seek-handle")[0]}};if(t){s.controlsLoadCallbacks["createControls"]=t}for(r in s.controlsLoadCallbacks){s.controlsLoadCallbacks[r].call(s)}}})};n.prototype.isControls=function(){return this.controlsEls?true:false};n.prototype.showControls=function(){if(!this.isControls()){this.controlsLoadCallbacks["showControls"]=this.showControls;return}i.setStyle(this.controlsEls.wrapper,{display:"block"})};n.prototype.hideControls=function(){if(!this.isControls()){this.controlsLoadCallbacks["hideControls"]=this.hideControls;return}i.setStyle(this.controlsEls.wrapper,{display:"none"})};n.prototype.updateTimeline=function(t,a){var s=this;if(!this.isControls()){this.controlsLoadCallbacks["updateTimeline"]=function(){s.updateTimeline(t,a)};return}var n=r(Math.max(0,t-a));var o=r(a);i.updateHTML(this.controlsEls.currentTimeText,o);i.updateHTML(this.controlsEls.durationText,"-"+n)};n.prototype.autoUpdateProgressBar=function(t,a){var s=this;if(!this.isControls()){this.controlsLoadCallbacks["autoUpdateProgressBar"]=function(){s.autoUpdateProgressBar(t,a)};return}if(this.disabledAutoUpdateProgressBar){return}i.setStyle(this.controlsEls.progressBar.play,{width:Math.max(0,Math.min(100,a/t*100))+"%"});i.setStyle(this.controlsEls.progressBar.seekHandle,{left:Math.max(0,Math.min(100,a/t*100))+"%"})};n.prototype.manualUpdateProgressBar=function(e){var t=this;if(!this.isControls()){this.controlsLoadCallbacks["manualUpdateProgressBar"]=function(){t.manualUpdateProgressBar(e)};return}if(!this.disabledAutoUpdateProgressBar){return}e.preventDefault();e.stopPropagation();var a=(window.pageXOffset||document.documentElement.scrollLeft)-(document.documentElement.clientLeft||0);var s=e.changedTouches?Math.min(e.changedTouches[0].clientX,e.changedTouches[0].pageX,e.changedTouches[0].screenX):Math.min(e.clientX,e.pageX,e.screenX);var r=this.controlsEls.progressBar.wrapper.clientWidth||this.controlsEls.progressBar.wrapper.offsetWidth;var n=i.offset(this.controlsEls.progressBar.wrapper);var o=Math.min(r,Math.max(0,s-Math.abs(n.left-a)));var l=Math.min(100,Math.max(0,o/r*100));i.setStyle(this.controlsEls.progressBar.play,{width:l+"%"});i.setStyle(this.controlsEls.progressBar.seekHandle,{left:l+"%"});return l};n.prototype.disableAutoUpdateProgressBar=function(){this.disabledAutoUpdateProgressBar=true};n.prototype.enableAutoUpdateProgressBar=function(){this.disabledAutoUpdateProgressBar=false};n.prototype.updatePlayToPause=function(){if(!this.isControls()){this.controlsLoadCallbacks["updatePlayToPause"]=this.updatePlayToPause;return}if(this.controlsEls.playButton.getAttribute("data-control-type")!="play"){return}this.controlsEls.playButton.setAttribute("data-control-type","pause");i.addClass(this.controlsEls.playButton,"native-video__play-button--pause")};n.prototype.updatePauseToPlay=function(){if(!this.isControls()){this.controlsLoadCallbacks["updatePauseToPlay"]=this.updatePauseToPlay;return}if(this.controlsEls.playButton.getAttribute("data-control-type")!="pause"){return}this.controlsEls.playButton.setAttribute("data-control-type","play");i.removeClass(this.controlsEls.playButton,"native-video__play-button--pause")};n.prototype.updateMuteToUnmute=function(){if(!this.isControls()){this.controlsLoadCallbacks["updateMuteToUnmute"]=this.updateMuteToUnmute;return}if(this.controlsEls.muteButton.getAttribute("data-control-type")!="mute"){return}this.controlsEls.muteButton.setAttribute("data-control-type","unmute");i.addClass(this.controlsEls.muteButton,"native-video__mute-button--mute")};n.prototype.updateUnmuteToMute=function(){if(!this.isControls()){this.controlsLoadCallbacks["updateUnmuteToMute"]=this.updateUnmuteToMute;return}if(this.controlsEls.muteButton.getAttribute("data-control-type")!="unmute"){return}this.controlsEls.muteButton.setAttribute("data-control-type","mute");i.removeClass(this.controlsEls.muteButton,"native-video__mute-button--mute")};n.prototype.enableDisplayControls=function(){this.disabledDisplayControls=false};n.prototype.disableDisplayControls=function(){this.disabledDisplayControls=true};n.prototype.enableAutoHideControls=function(){this.disabledAutoHideControls=false};n.prototype.disableAutoHideControls=function(){this.disabledAutoHideControls=true};n.prototype.showAndAutoHideControls=function(){var t=this;if(!this.isControls()||this.disabledDisplayControls){this.controlsLoadCallbacks["showAndAutoHideControls"]=this.showAndAutoHideControls;return}this.showControls();clearTimeout(this.autoHideControlsTimeout);this.autoHideControlsTimeout=setTimeout(function(){if(!t.disabledAutoHideControls){t.hideControls()}},2500)};n.prototype.updateProgressLoad=function(t,a){var s=this;var r;var n;var o;var l;var u;var d;if(!this.isControls()){this.controlsLoadCallbacks["updateProgressLoad"]=function(){s.updateProgressLoad(t,a)};return}if(!a.length){return}n=i.find(this.moduleEl,".native-video-progress__load-part");for(d=0;d<a.length;d++){l=parseFloat((a[d].start/t*100).toFixed(1));u=parseFloat(((a[d].end-a[d].start)/t*100).toFixed(1));if(u<=3){continue}if(n[d]){o=n[d];o.setAttribute("style","left:"+l+"%; width:"+u+"%;")}else{o=document.createElement("div");o.setAttribute("class","native-video-progress__load-part fill-gray");this.controlsEls.progressBar.load.appendChild(o);o.setAttribute("style","left:"+l+"%; width:"+u+"%;")}}n=i.find(this.moduleEl,".native-video-progress__load-part");for(d=n.length;d>a.length;d--){this.controlsEls.progressBar.load.removeChild(n[d-1])}r=a[a.length-1].end/t*100;if(r>99){r=100}i.setStyle(this.controlsEls.progressBar.load,{width:r+"%"})};n.prototype.showError=function(t){var a=this;if(!this.isControls()){this.controlsLoadCallbacks["showError"]=function(){a.showError(t)};return}this.disableDisplayControls();i.updateHTML(this.controlsEls.errorWrapper,t);i.setStyle(this.controlsEls.errorWrapper,{display:"block"})};n.prototype.showLoader=function(){if(!this.isControls()){this.controlsLoadCallbacks["showLoader"]=this.showLoader;return}i.setStyle(this.controlsEls.loader,{display:"block"})};n.prototype.hideLoader=function(){if(!this.isControls()){this.controlsLoadCallbacks["hideLoader"]=this.hideLoader;return}i.setStyle(this.controlsEls.loader,{display:"none"})};return{create:function(t){return new n(t)}}});Box.Application.addService("native-video-collection",function(t){"use strict";var i=t.getService("dom");var a=t.getService("scroll-listener");var s=t.getService("viewport-monitor");var r=[];var n=null;var o=false;var l=false;var u;function d(){return l}function c(t){var a=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0);var s=window.innerHeight||document.documentElement.clientHeight;var r=i.offset(t);var n=t.clientHeight;var o=0;if(s<n){return o}if(r.top-a<0){o=Math.abs(r.top-a)/n*100}else if(r.top+n-(a+s)>0){o=(r.top+n-(a+s))/n*100}return o}if(!o){a.add({callback:function(){if(d()){return}for(u=0;u<r.length;u++){if(n!=r[u].moduleEl){r[u].autoPauseVideo()}}n=null}});o=true}var _={};_.setFullScreenMode=function(t){l=t};_.setToVideoCollection=function(t){r.push(t);s.startWatching({target:t.moduleEl,renderLookahead:0,callback:function(){if(d()){return}if(c(t.moduleEl)>15){return}if(n){return}n=t.moduleEl;t.autoPlayVideo()}})};return _});Box.Application.addModule("native-video",function(t){"use strict";var i=t.getService("util");var a={};a.behaviors=["native-video-thumb","native-video-embed","native-video-collection","native-video-tracking"];if(!i.isIOSMobile){a.behaviors.push("native-video-controls")}return a});