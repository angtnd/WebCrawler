!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";!function(a){function b(b){return a("<div/>").text(b).html()}var c={tmpl_alert:function(a,c,d){return["div",{"class":"message_box small"},["div",{"class":a},c,["span",{"class":"btn2_list_name"},b(d)]]]},tmpl_base:function(b){var c=this,d=a.extend({text:null,href:null,classes:[],attrs:{},type:null,size:null,extra:null,glyph:null},b);return d.classes.push("btn2"),d.size&&d.classes.push(d.size),d.type&&d.classes.push(d.type),d.glyph&&d.classes.push("btn2_glyph_on"),d.extra&&d.classes.push(d.extra),d.text&&d.classes.push("btn2_text_on"),[["div",{"class":"btn2_alert",style:"display:none"}],["a",{"class":d.classes.join(" "),onclick:""},d.attrs,d.href&&{href:d.href},c.tmpl_glyph(d),c.tmpl_text(d)]]},tmpl_glyph:function(a){return["span",{"class":"btn2_glyph"},a.glyph]},tmpl_text:function(a){return["span",{"class":"btn2_text"},a.text]},tmpl_spin:function(){return["div",{"class":"btn2_spin"}]},tmpl_check:function(){return["div",{"class":"btn2_check"},"&#x2714;"]},tmpl_plus:function(){return["div",{"class":"btn2_plus"},"+"]},tmpl_error:function(){return["div",{"class":"btn2_error"},"!"]},tmpl_down:function(){return["div",{"class":"btn2_down"}]}};window.imdb_btn2={templates:c},a.widget("ui.imdb_btn2",{options:{templates:c,model:null},_create:function(){var a=this,b=a.element,c=a.options,d=b.attr("data-size"),e=b.attr("data-type"),f=b.attr("data-extra"),g=(b.attr("data-classes")||"").split(" ");a.templates=c.templates,a.model=c.model,a.model&&(a.model.size=a.model.size||d,a.model.type=a.model.type||e,a.model.classes=a.model.classes||g,a.model.extra=a.model.extra||f,b.children().remove(),b.jsonml(a.templates.tmpl_base(a.model))),b.addClass("btn2_wrapper btn2_active")},modifyGlyph:function(b){var c=this,d=c.element,e=a(".btn2",d);c.model.glyph=b,null!=b?e.addClass("btn2_glyph_on"):e.removeClass("btn2_glyph_on"),a(".btn2_glyph",d).replaceWith(a.jsonml.toDom(c.templates.tmpl_glyph(c.model)))},modifyText:function(b){var c=this,d=c.element,e=a(".btn2",d);c.model.text=b,null!=b?e.addClass("btn2_text_on"):e.removeClass("btn2_text_on"),a(".btn2_text",d).replaceWith(a.jsonml.toDom(c.templates.tmpl_text(c.model)))},show_alert:function(b,c,d,e){var f=a(".btn2_alert",b);f.removeClass("btn2_fail").removeClass("btn2_add_ok").removeClass("btn2_remove_ok"),"error"==c&&f.addClass("btn2_fail"),"success"==c&&"Added to "==d&&f.addClass("btn2_add_ok"),"success"==c&&"Removed from "==d&&f.addClass("btn2_remove_ok"),f.empty();var g=imdb_btn2.templates.tmpl_alert(c,d,e);f.append(a.jsonml.toDom(g)),f.attr("style","display: block;"),f.queue("btn2_alert",function(a){setTimeout(function(){a()},2e3)}).queue("btn2_alert",function(b){a(this).css({display:"none"})}).dequeue("btn2_alert")}})}(jQuery)},{}],2:[function(a,b,c){"use strict";!function(a){a(document).data("wl-button-analytics")||(a(document).data("wl-button-analytics",!0),"_gaq"in window||(window._gaq=[]),a(document).bind("wlb_async_update",function(b,c){var d=a(b.target),e=a("a",d),f=e.filter("[data-list-id="+c.list_id+"]"),g=d.attr("data-tconst"),h=d.attr("data-ga-identifier")||d.attr("data-caller-name")||d.closest("[data-caller-name]").attr("data-caller-name"),i="watchlist",j="add_from";f.closest(".wlb_dropdown").length>0&&(i="list"),c.list_item_id||(j="remove_from"),_gaq.push(["_trackEvent",i,j+"_"+h,g]),_gaq.push(function(){consoleLog(i+" "+j+" "+h+" "+c.tconst,"gaq")})}))}(jQuery)},{}],3:[function(a,b,c){"use strict";!function(a){function b(b){return a("<div/>").text(b).html()}var c={tmpl_view:function(){return["div",{"class":"wlb_drop_item"},["a",{"class":"wlb_message",href:"/list/watchlist",onclick:""},["span",{"class":"wlb_text"},"View Watchlist"]," &raquo;"]]},tmpl_new:function(){return["div",{"class":"wlb_drop_item"},["a",{"class":"wlb_message",href:"/list/create",onclick:""},["span",{"class":"wlb_text"},"New List"]," &raquo;"]]},tmpl_cluster:function(b){var c=this,d=[];return d=a.fn.wl_map(b,c.tmpl_item),[c.tmpl_view(),["div",{"class":"wlb_dropdown_cluster"},d],c.tmpl_new()]},tmpl_item:function(a){var c,d=a.data_list_item_ids;return"CHECKINS"==a.wlb_text&&(a.wlb_text="Check-ins"),c=d?d.join(","):"",["div",{"class":"wlb_drop_item"},["a",{"class":a.className.join(" "),"data-list-id":a.data_list_id,"data-list-item-ids":c,onclick:""},["span",{"class":"wlb_glyph"},a.wlb_glyph],["span",{"class":"wlb_text"},b(a.wlb_text)]],["a",{"class":"wlb_extra wlb_righty",href:a.href},"&raquo;"]]}};a.widget("ui.wlb_dropdown",a.ui.imdb_btn2,{options:{model:{text:null,glyph:["div",{"class":"btn2_down"}],tconst:null,state:"wlb_loading_on"}},_create:function(){var b=this,c=b.element,d=b.options,e=d.model,f=a(".wlb_dropdown_list"),g=(c.attr("data-lcn"),0);if(a.extend(b,{context:c.attr("data-context")||"",required_action:c.attr("data-required-action")||"none",weblab_id:c.attr("data-weblab-id")||"control"}),e.tconst||(e.tconst=c.attr("data-tconst")),a.ui.imdb_btn2.prototype._create.apply(this,arguments),c.addClass("wlb_dropdown"),!e.tconst)return consoleLog("Requires option model.tconst or data-tconst attribute","wlb-lite"),void b._set_state("error");CS.hasAccount()||b._set_state("wlb_enabled_on"),a("a.btn2",c).bind("click.wlb_dropdown_btn",function(){c.trigger("wlb_user_interaction"),"none"===b.required_action?f.is(":visible")?f.hide():(f.show(),b._load_dropdown()):CS.activate_login_lightbox()}),a("a.btn2",c).bind("mouseenter",function(){g&&clearTimeout(g)}),a("a.btn2",c).bind("mouseleave",function(){g=setTimeout(function(){a(".wlb_dropdown_list").hide()},300)});var h=a("div.wlb_classic_wrapper"),i=".wlb_dropdown_list";h.on("click","a.wlb_message.wlb_lefty",function(){var c=a(this);b._request_toggle(c),a(i).hide()}),h.on("mouseenter",i,function(){g&&clearTimeout(g)}),h.on("mouseleave",i,function(){g=setTimeout(function(){a(i).hide()},300)}),c.attr("data-initialized",1),b._set_state("wlb_enabled_on")},destroy:function(){var b=this,c=b.element;a("a.btn2",c).unbind(".wlb_dropdown_btn"),a.ui.imdb_btn2.prototype.destroy.apply(this,arguments)},_is_attached:function(){var a=this,b=a.element;return b.parents("body").length>0},_async_update:function(b){var d=this,e=(d.element,d.options),f=e.model;if(!d._is_attached())return d.destroy();f.tconst===b.tconst&&f.list_id===b.list_id&&(b.list_item_id?f.list_item_id=b.list_item_id:f.list_item_id=null,d._set_state("wlb_enabled_on"),a(".wlb_dropdown_list").empty(),a(".wlb_dropdown_list").jsonml(c.tmpl_cluster(b.dropdown_items)),a(".wlb_dropdown_list").show());var g=a("a.wlb_message.wlb_lefty").filter("[data-list-id="+b.list_id+"]");d._update_membership_status(g,b.list_item_id)},_update_membership_status:function(a,b){b?a.addClass("wlb_selected").attr("data-list-item-ids",b).find(".btn2_glyph, .wlb_glyph").html("&#x2714;"):a.removeClass("wlb_selected").attr("data-list-item-ids","").find(".btn2_glyph, .wlb_glyph").html("+")},_set_state:function(a){var b=this,c=b.options,d=c.model;d.state=a,b._ui_render()},_ui_render:function(){var b,c,d,e=this,f=e.element,g=e.options,h=g.templates,i=g.model;switch(i.state){case"wlb_loading_on":b=null,c=null,d=h.tmpl_down();break;case"wlb_enabled_on":b=null,c=null,d=h.tmpl_down();break;case"error":b="Watchlist currently unavailable",c="Unavailable",d=h.tmpl_error()}e.modifyText(c),e.modifyGlyph(d),a("a.btn2",f).attr("title",b)},_request_toggle:function(b){var c=this,d=c.element,e=c.options,f=(e.templates,e.model),g="/list/_ajax/edit";d.trigger("wlb_user_interaction");var h,i=b.attr("data-list-id"),j=(b.attr("data-list-item-ids")||"").split(","),k=a(".btn2_text, .wlb_text",b).text(),l=b.hasClass("wlb_selected");for(var m in j)h=l?{action:"delete",list_id:i,list_item_id:j[m],ref_tag:"title"}:{"const":f.tconst,list_id:i,ref_tag:"title"},c.extra&&(h[c.extra.name]=c.extra.value),a.ajax({url:g,type:"POST",data:h,beforeSend:window.addClickstreamHeadersToAjax,error:function(){consoleLog("failed to toggle membership","wl_dropdown"),c.show_alert(a(".wlb_dropdown_btn"),"error","Could not update ",k)},success:function(b){var d=b.list_item_id||null;return 200!=b.status?this.error():("watchlist"===i&&b.list_id&&(a("a.wlb_message.wlb_lefty").attr("data-list-id",b.list_id),i=b.list_id),d?c.show_alert(a(".wlb_dropdown_btn"),"success","Added to ",k):c.show_alert(a(".wlb_dropdown_btn"),"success","Removed from ",k),void c._async_update({tconst:f.tconst,list_id:i,list_item_id:d}))}})},_load_dropdown:function(){var b=this,c=b.element,d=b.options,e=d.model;return c.trigger("wlb_user_interaction"),CS.hasAccount()?void a.ajax({url:"/list/_ajax/wlb_dropdown",type:"POST",data:{tconst:e.tconst},beforeSend:window.addClickstreamHeadersToAjax,error:function(){consoleLog("failed to toggle membership","wl_dropdown")},success:function(a){return 200!=a.status?this.error():(a.list_id&&(e.list_id=a.list_id),void b._async_update({tconst:e.tconst,list_id:e.list_id,list_class:"watchlist",list_item_id:a.list_item_id,dropdown_items:a.items}))}}):void CS.activate_login_lightbox()}})}(jQuery)},{}],4:[function(a,b,c){"use strict";jQuery(document).ready(function(){$(".wlb_watchlist_btn").wlb_lite({model:{assets:{glyph:{out:imdb_btn2.templates.tmpl_plus()},text:{out:"Watchlist"}}}}),$(".wlb_dropdown_btn").wlb_dropdown(),$.fn.wl_map=function(a,b){if(a.constructor==Array&&"function"==typeof b){if(a.map&&"function"==typeof a.map)return a.map(b);for(var c=[],d=0;d<a.length;d++)c.push(b(a[d]));return c}}})},{}],5:[function(a,b,c){"use strict";!function(a){var b={glyph:{loading:imdb_btn2.templates.tmpl_spin(),"in":imdb_btn2.templates.tmpl_check(),out:null,pending:imdb_btn2.templates.tmpl_spin(),error:imdb_btn2.templates.tmpl_error()},text:{loading:"Loading","in":"Watchlist",out:"Add to Watchlist",pending:"Watchlist",error:"Unavailable"},title:{loading:"Loading watchlist data","in":"Click to remove from watchlist",out:"Click to add to watchlist",pending:"Updating watchlist data",error:"Watchlist currently unavailable"}};a.widget("ui.wlb_lite_base",a.ui.imdb_btn2,{options:{model:{assets:b,glyph:b.glyph.loading,text:b.text.loading,tconst:null,state:"loading"}},_create:function(){var b=this,c=b.element,d=b.options,e=d.model;return e.tconst||(e.tconst=c.attr("data-tconst")),e.caller_name||(e.caller_name=c.attr("data-caller-name")||c.closest("[data-caller-name]").attr("data-caller-name")),a.ui.imdb_btn2.prototype._create.apply(this,arguments),c.addClass("wlb_lite"),e.tconst?(CS.hasAccount()||b._set_state("out"),a("a.btn2",c).bind("click.wlb_lite",function(){b._request_toggle()}),b.global_handlers={wlb_async_init:function(a,c){b._async_init(c)},wlb_async_update:function(a,c){b._async_update(c)}},a(document).bind("wlb_async_init",b.global_handlers.wlb_async_init).bind("wlb_async_update",b.global_handlers.wlb_async_update),void c.attr("data-initialized",1)):("consoleLog"in window&&consoleLog("Requires option model.tconst or data-tconst attribute","wlb-lite"),void b._set_state("error"))},destroy:function(){var b=this,c=b.element;a("a.btn2",c).unbind(".wlb_lite"),a(document).unbind("wlb_async_init",b.global_handlers.wlb_async_init).unbind("wlb_async_update",b.global_handlers.wlb_async_update),a.ui.imdb_btn2.prototype.destroy.apply(this,arguments)},_is_attached:function(){var a=this,b=a.element;return b.parents("body").length>0},_async_init:function(a){var b=this,c=b.element,d=b.options,e=d.model;return b._is_attached()?(e.extra=a.extra,e.list_id=a.list_id,void(a.checked[e.tconst]&&("consoleLog"in window&&consoleLog("initialization complete","wlb_lite"),a.has[e.tconst]?(e.list_item_id=a.has[e.tconst][0],b._set_state("in")):b._set_state("out"),c.trigger("wlb_ready",{tconst:e.tconst,inwatchlist:a.has[e.tconst]})))):b.destroy()},_async_update:function(a){var b=this,c=(b.element,b.options),d=c.model;return b._is_attached()?("watchlist"===a.list_class&&"watchlist"===d.list_id&&(d.list_id=a.list_id),void(d.tconst===a.tconst&&d.list_id===a.list_id&&(a.list_item_id?(b._set_state("in"),d.list_item_id=a.list_item_id):(b._set_state("out"),d.list_item_id=null)))):b.destroy()},_set_state:function(a){var b=this,c=b.options,d=c.model;d.state=a,b._ui_render()},_ui_render:function(){var b=this,c=b.element,d=b.options,e=(d.templates,d.model),f=e.assets.title[e.state],g=e.assets.text[e.state],h=e.assets.glyph[e.state];b.modifyText(g),b.modifyGlyph(h),a("a.btn2",c).attr("title",f)},_request_toggle:function(){var b,c=this,d=c.element,e=c.options,f=e.model,g=d.data("show-message");if(!CS.hasAccount())return void CS.activate_login_lightbox();if(d.trigger("wlb_user_interaction"),"loading"!==f.state&&"error"!==f.state&&"pending"!==f.state){c._set_state("pending");var h=null;f.list_item_id?(b="/list/_ajax/edit",h={action:"delete",list_id:f.list_id,list_item_id:f.list_item_id,ref_tag:f.caller_name,list_class:"WATCHLIST"}):"watchlist"===f.list_id?(b="/list/_ajax/watchlist_add",h={tconst:f.tconst,lcn:f.caller_name}):(b="/list/_ajax/edit",h={"const":f.tconst,list_id:f.list_id,ref_tag:f.caller_name,list_class:"WATCHLIST"}),f.extra&&(h[f.extra.name]=f.extra.value),a.ajax({url:b,type:"POST",data:h,beforeSend:window.addClickstreamHeadersToAjax,error:function(){"consoleLog"in window&&consoleLog("failed to toggle membership","wl_button"),c._set_state("error"),g&&c.show_alert(d,"error","Could not update ","Watchlist")},success:function(a){return 200!=a.status?this.error():(a.list_id&&(f.list_id=a.list_id),g&&(a.list_item_id?c.show_alert(d,"success","Added to ","Watchlist"):c.show_alert(d,"success","Removed from ","Watchlist")),void d.trigger("wlb_async_update",{tconst:f.tconst,list_id:f.list_id,list_class:"watchlist",list_item_id:a.list_item_id}))}})}}}),a.fn.wlb_lite=function(){var b=a(this).not("[data-initialized=1]"),c=a.fn.wlb_lite_base.apply(this,arguments),d=[],e={};return 0===b.length?c:"string"==typeof arguments[0]?c:(CS.hasAccount()&&(b.each(function(){var b=a(this).data("tconst");b&&0!=b.length&&!e[b]&&(e[b]=!0,d.push(b))}),a.ajax({url:"/list/_ajax/watchlist_has",type:"POST",data:{consts:d,tracking_tag:"wlb-lite"},beforeSend:window.addClickstreamHeadersToAjax,error:function(){"consoleLog"in window&&consoleLog("watchlist_has request failed","wl_button")},success:function(a){return 200!=a.status?this.error():void b.first().trigger("wlb_async_init",{list_id:a.list_id||"watchlist",has:a.has,checked:e,extra:a.extra})}})),c)}}(jQuery)},{}],6:[function(a,b,c){"use strict";a("../jquery/plugins/jquery.jsonml.imdb.js"),a("../app/button/btn2.js"),a("../app/lists/wlb-lite.js"),a("../app/lists/wlb-dropdown.js"),a("../app/lists/wlb-init.js"),a("../app/lists/wl-button-analytics.js")},{"../app/button/btn2.js":1,"../app/lists/wl-button-analytics.js":2,"../app/lists/wlb-dropdown.js":3,"../app/lists/wlb-init.js":4,"../app/lists/wlb-lite.js":5,"../jquery/plugins/jquery.jsonml.imdb.js":7}],7:[function(a,b,c){"use strict";!function(a,b){function c(d,g){var h,i=d;"function"==typeof g&&(g=g(d)),"string"==typeof g||"number"==typeof g?(e&&consoleLog("create text node : "+g,"jsonml"),d.append(g)):a.isPlainObject(g)?(e&&consoleLog("attach attributes","jsonml"),a.each(g,function(a,b){try{d.attr(a,b)}catch(c){f&&consoleLog(d[0].nodeName+" rejected assignment of attribute : "+a+"="+b,"jsonml")}})):g instanceof Array?(a.each(g,function(f,g){"function"==typeof g&&(g=g(d)),0===f&&"string"==typeof g?(e&&consoleLog("create new element : "+g,"jsonml"),h=a(b.createElement(g)),i=h):c(i,g)}),h&&d.append(h)):g?e&&consoleLog("unknown data type","jsonml"):e&&consoleLog("noop","jsonml")}function d(b){var c,f,g,h,i=[],j={};return 1===b.length?(c=b[0].nodeType,f=b[0].nodeName,g=b[0].nodeValue,h=b[0].attributes,1==c?(e&&consoleLog("encode element : "+f,"jsonml"),i.push(f),h.length>0&&(a.each(h,function(a,b){j[b.name]=b.value}),i.push(j)),i.push(d(b.contents()))):3==c?(e&&consoleLog("encode text : "+g,"jsonml"),i=g):8==c?e&&consoleLog("ignoring comment : "+g,"jsonml"):e&&consoleLog("unsupported node type","jsonml")):b.each(function(){var b=d(a(this));"string"==typeof b&&0===i.length&&i.push(void 0),i.push(b)}),i}var e=b.location.hash.search("debug=1")>=0,f=1;a.fn.jsonml=function(b){var e=a(this);return b?(c(e,b),e.trigger("jsonml_ready"),e):d(e.contents())},a.jsonml={toDom:function(b){var c=a("<div>");return c.jsonml(b),c.contents()},fromDom:d}}(jQuery,document)},{}]},{},[6]);