(function(){var n=n||{},i=false,d;var q={impSever:{},uiController:{},util:{}};var r,h,s;var e=function(t){return document.getElementById(t)};var b=function(){};var j=function(){if((navigator.userAgent.match(/Android/i))||(navigator.userAgent.indexOf("iPhone")!=-1)||(navigator.userAgent.indexOf("iPod")!=-1)||(navigator.userAgent.indexOf("iPad")!=-1)){return true}return false};q.util={cookie:{set:function(v,w,u){var t=encodeURIComponent(w);document.cookie=v+"="+t+(u.path?"; path="+u.path:"")+(u.expires?"; expires="+u.expires.toGMTString():"")+(u.domain?"; domain="+u.domain:"")+(u.secure?"; secure":"")},get:function(u){if(!document.cookie){return null}var v=new RegExp("(^| )"+u+"=([^;]*)(;|\x24)"),t=v.exec(document.cookie);if(!t){return null}var w=t[2]||null;if("string"==typeof w){w=decodeURIComponent(w);return w}return null}},json:{parse:function(t){return(new Function("return ("+t+")"))()}}};var g=function(v,u,t){if(v.addEventListener){v.addEventListener(u,t,false)}else{if(v.attachEvent){v.attachEvent("on"+u,t)}}};var o=function(){var u;var x=document.getElementsByTagName("script"),v=x.length;while(v--){var w=x[v].getAttribute("src"),t=x[v].getAttribute("id");if(w&&w.indexOf("imp-fixed.js")!=(-1)&&!t){u=x[v];break}else{u=x[x.length-1]}}return u};var l=function(v){var u=[],t=_py.length;if(v&&v!=undefined){while(t--){if(_py[t][0]==v){u=_py[t];break}}}else{while(t--){var w=e("scriptId_"+_py[t][0]);if(!w){u=_py[t];break}}}return u};var a=function(v,z){var t=document.createElement("div");t.setAttribute("id","frame_sets");t.style.display="none";for(var w=0,u=v.length;w<u;w++){var x=document.createElement("iframe");x.setAttribute("src",v[w]);t.appendChild(x)}var y=o();y.parentNode.insertBefore(t,y)};function k(w){var v=0;for(var u=0,t=w.length;u<t;u++){v=v*31+w.charCodeAt(u);v=c(v)}return v}function c(t){var u=2147483647,v=-2147483648;if(t>u||t<v){return t&=4294967295}return t}function f(){q.util.cookie.set("ipy_loading","",{path:"",expires:new Date(new Date().getTime()+30000)});q.util.cookie.set("ipy_loading","",{path:"",expires:new Date(new Date().getTime()+30000)});q.util.cookie.set("ipy_adIds","",{path:"",expires:new Date(new Date().getTime()+30000)})}q.impSever={getData:function(x){var u=x,w=encodeURIComponent(u.u),z=encodeURIComponent(u.r),v=document.createElement("script"),t="http://i.ipinyou.com/imp?";t+="uid="+u.id;t+="&pid="+u.pid;t+="&aid="+u.aid;t+="&u="+w;t+="&r="+z;if(j()){t+="&video="}t+="&dtype=jsonp";t+="&callback=_ipy.pyCallBack";t+="&rdm="+new Date().getTime();v.setAttribute("id","dataProxy");v.setAttribute("src",t);var y=o();y.parentNode.insertBefore(v,y)},getFailSage:function(v){if(!q.util.cookie.get("ipy_loading")){return}var t=new Date(),u=t.getFullYear()+""+(t.getMonth()+1)+""+t.getDate();q.util.cookie.set("ipy_loading","",{path:""});var w=document.createElement("script"),y=k(v);w.setAttribute("src","http://f1.p0y.cn/fs/"+y%1024+"/"+v+".js?t="+u+".js");w.setAttribute("id","failSafe");var x=o();x.parentNode.insertBefore(w,x)}};q.uiController={setDisplay:function(t){p(t)},setFailSafe:function(t){var u={cpath:t.creativeUrl,clickurl:t.clickUrl,uid:t.uId,ctype:Number(t.ctype),impUrl:t.impUrl};p(u)}};function p(C){var A=l(C.uid),D=C.ctype,z=document.getElementById("scriptId_"+C.uid),F="<style>.py_logo {position:absolute; top:0; right:0;display:block;width:29px;height:20px; background:url(http://file.ipinyou.com.cn/material/py_logo_i.png) no-repeat;cursor: hand; _filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://file.ipinyou.com.cn/material/py_logo_i.png');_background:none} .py_logo:hover {width: 86px;background:url(http://file.ipinyou.com.cn/material/py_logo_t.png) no-repeat;cursor: hand; _filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://file.ipinyou.com.cn/material/py_logo_t.png');_background:none}</style>",I=A[1],E=A[2],v="";if(j()){v='<div style="width:'+I+"px;height:"+E+'px;position:relative;background:white;overflow:hidden;"><div style="z-index:-1;width:'+I+"px;height:"+E+'px;overflow:hidden"><video src="'+C.cpath+'" width="'+I+'" height="'+E+'"  preload autoplay="autoplay" webkit-playsinline></video></div><a id="ipy_cover" style="left:0;top:0;position:absolute;z-index:1;cursor: pointer; width:'+I+"px;height:"+E+'px;background:blue;opacity:0;filter:alpha(opacity=0);" href="'+C.clickurl+'" target="_blank"></a></div>'}else{v='<div style="width:'+I+"px;height:"+E+'px;position:relative;background:white;"><div style="z-index:-1;width:'+I+"px;height:"+E+'px;overflow:hidden"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="'+I+'" height="'+E+'" class="ipy"><param name="movie" value="http://file.ipinyou.com.cn/material/ipy_float.swf"><param name="quality" value="high"><embed src="http://file.ipinyou.com.cn/material/ipy_float.swf" wmode="Opaque" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="'+I+'" height="'+E+'"><param name="wmode" value="Opaque"></object></div><a id="ipy_cover" style="left:0;top:0;position:absolute;z-index:1;cursor: pointer; width:'+I+"px;height:"+E+'px;background:blue;opacity:0;filter:alpha(opacity=0);" href="'+C.clickurl+'" target="_blank"></a></div>'}switch(D){case 1:F+='<a href="'+C.clickurl+'" id="ipy_cover" target="_blank"><img src="'+C.cpath+'" style="width:'+I+"px;height:"+E+'px;border:0"/></a>';break;case 2:F+='<div style="width:'+I+"px;height:"+E+'px;position:relative;background:white;overflow:hidden;"><div style="z-index:-1;width:'+I+"px;height:"+E+'px;overflow:hidden"><object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="'+I+'" height="'+E+'" class="ipy"><param name="movie" value="'+C.cpath+'"><param name="quality" value="high"><embed src="'+C.cpath+'" wmode="Opaque" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="'+I+'" height="'+E+'"><param name="wmode" value="Opaque"></object></div><a  id="ipy_cover" style="left:0;top:0;position:absolute;z-index:1;cursor: pointer; width:'+I+"px;height:"+E+'px;background:blue;opacity:0;filter:alpha(opacity=0);" href="'+C.clickurl+'" target="_blank"></a></div>';break;case 3:F+=v;break;case 7:F+='<iframe src="'+C.cpath.replace(/\s/g,"")+'" width="'+I+'" height="'+E+'" frameBorder="0" scrolling="no"></iframe>';break;case 8:F+='<object id="" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7"classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+I+'" height="'+E+'"type="application/x-shockwave-flash"><param name="Movie" value="'+C.cpath+'"><param name="FlashVars" value="click_url='+encodeURIComponent(C.clickurl)+'"><param name="WMode" value="Opaque"><param name="Quality" value="High"><param name="AllowScriptAccess" value="always"><param name="Scale" value="ShowAll"><param name="AllowNetworking" value="all"><param name="AllowFullScreen" value="false"><embed width="'+I+'" height="'+E+'" src="'+C.cpath+'" quality="High" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" wmode="Opaque" allowscriptaccess="always" flashvars="click_url='+encodeURIComponent(C.clickurl)+'"></object>';break;case 11:F+='<iframe src="'+C.cpath.replace(/\s/g,"")+'" width="'+I+'" height="'+E+'" frameBorder="0" scrolling="no"></iframe>';break}switch(C.al){case 1:F+='<a class="py_logo" href="http://sdsp.ipinyou.com/login/?source=logo" target="_blank"></a>';break;case 2:F+='<a class="py_logo" href="http://sdsp.ipinyou.com/login/?source=logo" target="_blank"></a>';break}var B=document.createElement("iframe");B.style.cssText+="width:"+I+"px;height:"+E+"px;border:0;display:block;overflow:hidden;";B.setAttribute("frameBorder","0");B.setAttribute("scrolling","no");z.parentNode.insertBefore(B,z);try{var x=B.contentWindow,t=x.document;t.open();t.write(F);t.close();var y=t.getElementsByTagName("body")[0];y.style.margin=0}catch(G){var u="http://fm.p0y.cn/j/imp-fixed.html#id="+A[0]+"&w="+I+"&h="+E;B.setAttribute("src",u)}if(C.murls){a(C.murls,y)}if(C.impUrl){var H=[];H.push(C.impUrl);a(H,y)}}var m=function(){if(q.util.cookie.get("ipy_loading")){d=setTimeout(m,100);return}s=_py;var x=l(),E=x[0],B="",v="",F=location.href,t=document.referrer;window.parent!=window&&(F=t,t="");if(document.getElementById("dataProxy")){var w=document.getElementById("dataProxy");w.parentNode.removeChild(w)}r=o();if(q.util.cookie.get("ipy_adIds")){var D=q.util.cookie.get("ipy_adIds").split(",");for(var A=0,y=D.length;A<y;A++){var C=D[A].split("&");B+=","+C[0].replace("pid=","");v+=","+C[1].replace("aid=","")}B=B.replace(",","");v=v.replace(",","")}var z={id:E,pid:B,uid:"",aid:v,u:F,r:t};if(self==top&&j()){g(window,"load",f)}if(d){clearTimeout(d)}r.setAttribute("id","scriptId_"+E+"");q.util.cookie.set("ipy_loading","1",{path:"",expires:new Date(new Date().getTime()+30000)});q.impSever.getData(z);h=setTimeout(function(){q.impSever.getFailSage(E)},10000)};n.pyCallBack=function(w){var u;clearTimeout(h);if(typeof arguments==="object"&&w){u=w}else{if(typeof arguments==="String"&&w){u=q.util.json.parse(w)}}var x=q.util.cookie.get("userId");x+="pid="+u.pid+"&aid="+u.aid;q.util.cookie.set("userId",x,{path:"",expires:new Date(new Date().getTime()+30000)});if(u.error||u.error==0){q.impSever.getFailSage(u.uid)}else{var t;if(q.util.cookie.get("ipy_adIds")){t=q.util.cookie.get("ipy_adIds")+",pid="+u.pid+"&aid="+u.aid}else{t="pid="+u.pid+"&aid="+u.aid}q.util.cookie.set("ipy_adIds",t,{path:"",expires:new Date(new Date().getTime()+30000)});q.util.cookie.set("ipy_loading","",{path:"",expires:new Date(new Date().getTime()+30000)});q.uiController.setDisplay(u)}if(document.getElementById("dataProxy")){var v=document.getElementById("dataProxy");v.parentNode.removeChild(v)}};n.failSafe=function(t){q.uiController.setFailSafe(t)};window._ipy=n;window.onbeforeunload=function(t){q.util.cookie.set("ipy_loading","",{path:"",expires:new Date(new Date().getTime()+30000)});q.util.cookie.set("ipy_adIds","",{path:"",expires:new Date(new Date().getTime()+30000)})};m()})(window,document);
