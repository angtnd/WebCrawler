define(["jssignals-1","idcta/idCookie","idcta/id-config","idcta/apiUtils","idcta/tokenRefresh"],function(c,e,g,b,n){var r={signals:{signedIn:new c.Signal(),signinShown:new c.Signal()},ctas:{}};var j={width:608,height:614};function k(t){this.id=t.id;this.element=document.getElementById(t.id);this.states=t.states;var s=this;r.ctas[s.id]=s;this.useOverlay=t.useOverlay;var u=this;if(g["bbcid-v5"]!=="RED"){t.useOverlay=false;u.useOverlay=false}if(t.publiclyCacheable===true){if(e.getInstance().hasCookie()){f(s)}else{s.element.getElementsByTagName("span")[0].innerHTML=s.states.unauthorised.signedout}}t.ocContainer=s;s.signinHandler=q(s.element.querySelectorAll(".id4-cta-signin")[0],t);if(!t.policyname){s.registerHandler=o(s.element.querySelectorAll(".id4-cta-register")[0],t)}r.signals.signedIn.add(function(){f(s)})}function f(s){if(s.states.authorised){var u=e.getInstance().getNameFromCookie();var t=s.states.authorised.anonymous;if(u){t=s.states.authorised.name.replace("{name}",u)}s.element.getElementsByTagName("span")[0].innerHTML=t}else{if(s.element.parentNode){s.element.parentNode.removeChild(s.element)}}}function o(t,s){if(a(s)){var u=function(v){if(!h(s,"register")){if(v.preventDefault){v.preventDefault()}else{v.returnValue=false}}};if(typeof(t)!=="undefined"&&typeof(t.jquery)!=="undefined"){t=t.get(0)}if(document.addEventListener&&typeof(t)!=="undefined"&&t.addEventListener){t.addEventListener("click",u,false)}else{if(document.attachEvent&&typeof(t)!=="undefined"&&t.attachEvent){t.attachEvent("onclick",u)}}return u}}function q(u,s){if(a(s)){var t=function(v){if(!h(s,"signin")){if(v.preventDefault){v.preventDefault()}else{return false}}};if(!s.ocContainer){s.ocContainer=u}if(typeof(u)!=="undefined"&&typeof(u.jquery)!=="undefined"){u=u.get(0)}if(document.addEventListener&&typeof(u)!=="undefined"&&u.addEventListener){u.addEventListener("click",t,false)}else{if(document.attachEvent&&typeof(u)!=="undefined"&&u.attachEvent){u.attachEvent("onclick",t)}}return t}}function p(s){if(typeof(s.id)!=="undefined"&&typeof(r.ctas[s.id])!=="undefined"&&typeof(r.ctas[s.id].signinHandler)!=="undefined"){if(document.removeEventListener){s.removeEventListener("click",r.ctas[s.id].signinHandler)}else{if(document.detachEvent){s.detachEvent("onclick",r.ctas[s.id].signinHandler)}}}}function a(s){return(s.useOverlay===true&&l())}function l(){return !(navigator.appVersion.indexOf("MSIE 6.")!=-1||navigator.appVersion.indexOf("MSIE 7.")!=-1||navigator.appVersion.indexOf("MSIE 8.")!=-1)}function h(t,s){if(window.innerWidth<=j.width||window.innerHeight<=j.height){return true}else{require(["idcta/overlayManager"],function(u){u.useOverlayController(t,s,r.signals)})}return false}function i(s){if(g["bbcid-v5"]==="RED"){return d()}if(s){return n.refreshTokens()}return n.refreshTokensIfExpired()}function d(){if(g["bbcid-v5"]!=="RED"){return i().then(function(){return true},function(){throw false})}var v=e.getInstance();var s=(v.hasCookie()&&v.getIdFromCookie()&&v.getAccessToken("https")===null&&(!v.isDualMode())&&g.idpurl!==false);if(s){return b.loadUrlInHiddenIframe(g.idpurl,10000,["idapp_end"]).then(function(w){e.getInstance().setDualMode();return true})}else{var t=v.getAccessToken();var u=v.isDualMode();if(t||u){return b.Promise.resolve(true)}else{return b.Promise.reject(false)}}}function m(t,u,w){var s=document.querySelector("#"+t+" span");var v=["small","medium","large"];var x=["blue","white","gray"];if(v.indexOf(u)>-1){s.className=s.className.replace(/small|medium|large/g,u)}if(x.indexOf(w)>-1){s.className=s.className.replace(/blue|white|gray/g,w)}}r.Cta=k;r.unbindSigninClickTo=p;r.bindSigninClickTo=q;r.bindRegisterClickTo=o;r.modifyCta=m;r.initiateTokenRefresh=i;r.initiateUserUplift=d;r.hasCookie=function(){return e.getInstance().hasCookie()};r.getCookieInstance=function(){return e.getInstance()};r.getIdFromCookie=function(){return e.getInstance().getIdFromCookie()};r.getUserDetailsFromCookie=function(){return e.getInstance().getUserDetailsFromCookie()};r.getNameFromCookie=function(){return e.getInstance().getNameFromCookie()};r.getAccessToken=function(s){return e.getInstance().getAccessToken(s)};return r});