_DM.define("Sd_User_Subscribe",function(){var c=false;var d={updateButton:function(b,a){c=$.ajax({url:"/controller/Shared_User_Subscribe",data:a,success:function(g){c=false;var h=$($.parseHTML(g));h.addClass(b.className);$(b).replaceWith(h)}})},updateButtons:function(a){$('.sd_user_subscribe[data-user="'+a+'"]').each(function(){var b={request:"/"+a,config:$(this).attr("data-config"),subscribe_context:$(this).find("button").data("subscribe-context")};d.updateButton(this,b)})},setCount:function(b,g){var h=$('[data-follower-count="'+b+'"]');var a=parseInt(h.data("count"),10)+g;h.data("count",a).text(d.formatNumberWithSuffix(a))},formatNumberWithSuffix:function(b){var j=1,i=["","K","M","G","T"];if(b<0){j=-1;b=Math.abs(b)}var a=Math.log10(b),h=a/3;b.toLocaleString();if(a<4){return j*b}return Math.floor(j*Math.pow(1000,h-Math.floor(h))*10)/10+i[Math.floor(h)]},afterToggleSubscribe:function(l,k){if(c){return false}var a=l.action,i=k.userLogin,j=k.subscribeContext,b={};PubSub.publish("dm:user_logged:"+a,i);if(!d.isSameOrigin()||!l.needed_login){d.updateButtons(i)}if(a=="subscribe"){b.action="follow";if(j){if(j=="from-channel-tooltip"){b.context="from_channel_tooltip"}else{if(j=="push-follow-toolip"){b.context="with_push_tooltip"}}}d.setCount(i,1)}else{b.action="unfollow";d.setCount(i,-1)}DM_Stats.trigger(b);Sd_Navigation_Panel.clearDatas()},isSameOrigin:function(){var b;try{b=top.location.href}catch(a){b=false}return b},onClick:function(b){var k=$(b.currentTarget),n=k.data("href"),l=k.closest(".sd_user_subscribe").data("user"),m=k.data("subscribe-context"),j=k.data("user-uri"),a={request:j,next_url:k.data("next-href"),redirect_url:d.isSameOrigin()?j:document.location.href};if(k.data("no-count")){a.no_count=true}if(DM_Context.is_logged===false){DM_Stats.trigger({action:"follow",context:"unlogged"})}k.prop("disabled",true);k.parents(".sd_user_subscribe").addClass("current");DM_Ajax.jsonCall(n,a,function(g){var e=$.parseJSON(g),f={userLogin:l,subscribeContext:m};d.afterToggleSubscribe(e,f);k.prop("disabled",false)},function(e,f){if(e=="too_many_subscriptions"||e=="cannot_subscribe_yourself"){alert(f)}});PubSub.subscribe("popup:closed",function(){k.prop("disabled",false)})},initEvents:function(){$(document).on("click",".sd_user_subscribe button",d.onClick)},loadLazyButtons:function(){var a=[],b=0;$("[data-lazy-follow-button]").each(function(){var h=$(this).parent(),g="lazy-"+b;h.attr("data-lazy",g);a.push({user:h.data("user"),config:h.data("config"),id:g});b++});if(!a.length){return}DM_Ajax.jsonCall("/controller/Shared_User_Subscribe?method=loadButton",{buttons:JSON.stringify(a)},function(h){h=JSON.parse(h);for(var g in h){$("[data-lazy="+g+"]").replaceWith(h[g])}})},__onDomReady:function(){d.initEvents();d.loadLazyButtons()}};return d},true);_DM.define("Pg_Usercard",function(){var b={userLogin:null,testingStage:"stage-11",stageCdn:"//hapyak-staging.dmcdn.net",prodCdn:"//hapyak.dmcdn.net",onDoubleClicked:function(){if(hapyak.context.player.isEditMode){hapyak.context.startEditing()}},onSubscribedClicked:function(){hapyak.context.tracking.action("follow",{user:b.userLogin,isEditMode:hapyak.context.player.isEditMode})},onToggleSubscribe:function(){var a=$(".card").outerWidth();if($(".sd_user_subscribe .button_action").length>0){var d=$(".sd_user_subscribe .button_action").outerWidth()-$(".sd_user_subscribe .button_default").outerWidth();if(d>0){a+=d}}hapyak.context.width=a},isInIframe:function(){if(window.self!==window.top){return true}return false},initIframeEvents:function(){$(".pg_usercard").on("dblclick",b.onDoubleClicked);$(".pg_usercard").on("click",b.onSubscribedClicked);PubSub.subscribe("dm:user_logged:subscribe",b.onToggleSubscribe);PubSub.subscribe("dm:user_logged:unsubscribe",b.onToggleSubscribe)},loadIframeScript:function(){var a=DM_Environment==b.testingStage?b.stageCdn:b.prodCdn;$.ajax({url:a+"/js/hapyak-iframe.js",dataType:"script",cache:true,success:function(h,f,g){b.initIframeEvents()}})},__initialize:function(){b.userLogin=$(".sd_user_subscribe").data("user");if(b.isInIframe()){b.loadIframeScript()}}};return b});_DM.define("DM_Stats",function(){var b={formattedEvent:false,events:{share:{share:"Share",twitter:"Twitter (Official)",blogger:"Blogger (AddThis)",wordpress:"Wordpress (AddThis)",tumblr:"Tumblr (AddThis)",reddit:"Reddit (AddThis)",pinterest:"Pinterest (AddThis)",use_embed_code:"Use embed code video panel"},follow:{follow:"Follow",from_channel_tooltip:"Follow from a channel tooltip",with_push_tooltip:"Follow with push tooltip displayed",unlogged:"Follow when user is unlogged",display_push_tooltip:"Display push follow tooltip",close_push_tooltip:"Close push follow tooltip"},unfollow:"Unfollow",upload:{request:"Upload request",start:"Upload start",success:"Upload success",fail:"Upload fail",save_edit_form:"Save Edit form"},register:{"dailymotion-form_step1":"DM - Submit register form - Step 1","dailymotion-form_step2":"DM - Submit register form - Step 2 - Create account","dailymotion-take_a_tour":"DM - Take the welcome tour","dailymotion-areas_of_interest":"DM - Tour (areas of interest) next","dailymotion-skip_facebook_connect":"DM - Tour - Skip Facebook Connect","dailymotion-facebook_follow_your_friends":"DM - Tour (Facebook Friends) next","dailymotion-complete_tour":"DM - Complete the tour","dailymotion-close_tour":"DM - Close the tour","facebook-connect":"FB - Facebook Connect submitted","facebook-form_step2":"FB - Submit register form - Step 2 - Create account","facebook-take_a_tour":"FB - Take the welcome tour","facebook-areas_of_interest":"FB - Tour (areas of interest) next","facebook-follow_your_friends":"FB - Tour (Facebook Friends) next","facebook-complete_tour":"FB - Complete the tour","facebook-close_tour":"FB - Close the tour"},login:{dailymotion:"Login via Dailymotion",facebook:"Login via Facebook"},playlist:{create:"Create playlist",add_video:"Add video to playlist",remove_video:"Remove video from playlist",save_reorder:"Save playlist reordering","delete":"Delete playlist"},customer_survey:{display:"Display customer survey",skip:"Skip customer survey"},pixelle:{display:"Display a promoted video",click:"Click on a promoted video"},promote_its_account:"Promote its account",report_video:"Report video",comment_video:"Comment video",share_new_video_comment_on_facebook:"Share new video comment on Facebook",expand_player:"Expand player",add_to_favourite:"Add video to favourite",add_to_watchlater:"Add video to Watch Later",add_to_group:"Add video to group",add_to_contest:"Add video to contest",use_addto_tab:"Click on AddTo tab in player page",navigation_panel:{open:"Open navigation menu",close:"Close navigation menu",generated_traffic:"Click on item from the navigation menu"},oauth:{sign_in:"Click on Login",sign_up:"Click on Signup",recover_password:"Click on password recover",facebook_sign_in:"Click on FB Login",facebook_sign_up:"Click on FB Signup"},player:{video_started:"Video has started",video_ended:"Video has ended"},ligue1:"Video view on Ligue1 page",relevant_content_CTR:{video_displayed:"Bunch of videos displayed in the viewport during last scroll",video_clicked:"Click on a video preview"}},trigger:function(a){b.getLabel(a);if(b.formattedEvent){PubSub.publish("stats:event",b.formattedEvent)}},getLabel:function(d){var a=null;if(b.events[d.action]){if(!b.events[d.context]&&typeof b.events[d.action]!=="object"){a=b.events[d.action]}else{if(!b.events[d.action][d.context]){a=b.events[d.action][d.action]}else{a=b.events[d.action][d.context]}}}b.formattedEvent={event_action:d.action,event_context:d.context||null,event_label:a,event_data:d.data||{}}}};return b},true);