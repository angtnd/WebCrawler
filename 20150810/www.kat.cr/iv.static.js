window.pp.inview=function(t){this.adSlotId=t.adSlotId,this.ad=document.getElementById(this.adSlotId),this.logEndpoint=t.logEndpoint,this.flashBeaconEndpoint=t.flashBeaconEndpoint?t.flashBeaconEndpoint:"DisplayBeacon.swf",this.sampleTime=t.sampleTime?t.sampleTime:100,this.partialSegmentSize=t.partialSegmentSize?t.partialSegmentSize:10,this.context=t.context,this.result={sessionTime:0,pageInView:0,adHover:0,partialInView:[],areaInViewOnUnload:0,stats:{loadTimestamp:(new Date).getTime(),firstDataTimestamp:0,firstViewableTimestamp:0,nSamples:0,beaconAvgs:{}}},this.pageFocus=!0,this.debug=this.isDefined(t.debug)&&t.debug,this.flashLoadTimeout=this.isDefined(t.flashLoadTimeout)?t.flashLoadTimeout:1e4,this.uid=Math.floor(1e5*Math.random()+1)},window.pp.inview.counter=0,window.pp.flashBeaconTemplate='<object id="DisplayBeacon_IE_${id}" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="${size}" height="${size}"><param name="movie" value="${url}" /><param name="quality" value="low" /><param name="flashvars" value="initCallback=${callback}" /><param name="bgcolor" value="#ffffff" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><!--[if !IE]>--><object id="DisplayBeacon_${id}" type="application/x-shockwave-flash" data="${url}" width="${size}" height="${size}"><param name="quality" value="low" /><param name="flashvars" value="initCallback=${callback}" /><param name="bgcolor" value="#ff0000" /><param name="wmode" value="transparent" /><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /></object><!--<![endif]--></object>',window.pp.inview.prototype={initialize:function(){if(this.iframe=this.isIframe(),null!=this.ad){var t=this;this.adPosition=this.getAdPosition(this.ad),this.adSize=this.getAdSize(this.ad),this.attachMouseHover(this.ad),this.attachMouseClick(this.ad),this.attachPageBlur(window),this.attachUnloadEvent(),this.createPartialInViewSegments(this.partialSegmentSize);var e=function(){t.timer=setInterval(function(){t.evaluate()},t.sampleTime)};this.debug&&(window.addEventListener?addEventListener("message",function(e){t.acceptDebugMessage(e)},!1):attachEvent("onmessage",function(e){t.acceptDebugMessage(e)})),this.iframe?this.createBeacons(function(i,a){if(i)t.result.error=i,t.result.stats.errorTimestamp=(new Date).getTime(),t.postDebugMessage();else try{t.beaconsArray=a.slice(0,-1),t.controlBeaconObj=a[a.length-1],t.positionBeacons(),setTimeout(function(){t.controlBeaconObj.beaconElement.isViewable()&&(t.result.error="control beacon visible",t.result.stats.errorTimestamp=(new Date).getTime(),t.postDebugMessage())},3e3)}catch(s){t.result.error=s,t.result.stats.errorTimestamp=(new Date).getTime(),t.postDebugMessage()}e()}):e()}},positionBeacons:function(){try{var t=this.getAdPosition(this.ad),e=this.getAdSize(this.ad);if(this.lastAdPosition&&this.lastAdSize){if(this.lastAdPosition.x==t.x&&this.lastAdPosition.y==t.y&&this.lastAdSize.x==e.x&&this.lastAdSize.y==e.y)return}else this.lastAdPosition=t,this.lastAdSize=e;this.controlBeaconObj.beaconContainer.style.left="-10000px",this.controlBeaconObj.beaconContainer.style.top="-10000px",this.beaconsArray[0].beaconContainer.style.left=t.x+5+"px",this.beaconsArray[0].beaconContainer.style.top=t.y+5+"px",this.beaconsArray[1].beaconContainer.style.left=t.x+e.x-5+"px",this.beaconsArray[1].beaconContainer.style.top=t.y+5+"px",this.beaconsArray[2].beaconContainer.style.left=t.x+5+"px",this.beaconsArray[2].beaconContainer.style.top=t.y+e.y-5+"px",this.beaconsArray[3].beaconContainer.style.left=t.x+e.x-5+"px",this.beaconsArray[3].beaconContainer.style.top=t.y+e.y-5+"px",this.beaconsArray[4].beaconContainer.style.left=(t.x+e.x)/2+"px",this.beaconsArray[4].beaconContainer.style.top=(t.y+e.y)/2+"px"}catch(i){}},createBeacons:function(t){try{for(var e=!1,i=5,a=0,s=[],n=function(n,o){if(!e){if(n)return e=!0,void t(n,null);s.push(o),++a==i+1&&t(null,s)}},o=0;i+1>o;o++)this.createBeacon(n);setTimeout(function(){i>a&&(e=!0,t("flash-timeout",null))},this.flashLoadTimeout)}catch(r){t(r,null)}},createBeacon:function(t,e){try{var i=window.pp.inview.counter++,a="PPVbeacon"+i+"ready",s=document.createElement("DIV");s.style.position="absolute",s.style.zIndex=9999,s.style.width="1px",s.style.height="1px","undefined"!=typeof e&&(s.style.left=e.x,s.style.top=e.y),window[a]=function(){var e=function(){var e=document.getElementById("DisplayBeacon_IE_"+i);if(void 0!==e&&"undefined"!=typeof e.isViewable)return t(null,{beaconElement:e,beaconContainer:s}),!0;var a=document.getElementById("DisplayBeacon_"+i);return void 0!==a&&"undefined"!=typeof a.isViewable?(t(null,{beaconElement:a,beaconContainer:s}),!0):!1};if(!e())var a=0,n=100,o=setInterval(function(){e()?clearInterval(o):(a+=n,a>1e3&&(clearInterval(o),t("Could not locate beacon element",null)))},n)},s.innerHTML=this.renderTemplate(window.pp.flashBeaconTemplate,{size:1,url:this.flashBeaconEndpoint,callback:a,id:i}),document.body.insertBefore(s,document.body.firstChild)}catch(n){t(n,null)}},renderTemplate:function(t,e){var i=t;for(var a in e)i=i.replace(new RegExp("\\${"+a+"}","g"),e[a]);return i},postDebugMessage:function(){try{window.top.postMessage({uid:this.uid,type:"ivdebug",id:this.adSlotId,result:this.result},"*")}catch(t){}},acceptDebugMessage:function(t){if(t.data.uid===this.uid&&"ivdebugaction"===t.data.type)if(this.ad.hdiv||(this.ad.hdiv=document.createElement("div"),this.ad.hdiv.style.position="absolute",this.ad.hdiv.style.zIndex=9999,this.ad.hdiv.style.backgroundColor="red",this.ad.hdiv.style.display="none",this.ad.appendChild(this.ad.hdiv)),1===t.data.highlight){var e=this.getAdSize(this.ad),i=this.getAdPosition(this.ad);this.ad.hdiv.style.top=i.y,this.ad.hdiv.style.left=i.x,this.ad.hdiv.style.width=e.x,this.ad.hdiv.style.height=e.y,this.ad.hdiv.style.display="block"}else this.ad.hdiv.style.display="none"},evaluate:function(){if(this.debug&&this.postDebugMessage(),0==this.result.stats.firstDataTimestamp&&(this.result.stats.firstDataTimestamp=(new Date).getTime()),this.iframe&&this.positionBeacons(),this.result.sessionTime+=this.sampleTime,this.pageFocus||this.iframe){this.result.pageInView+=this.sampleTime;var t=this.iframe?this.getFlashInViewData():this.getAdInViewData();if(t.areaInView>0){var e=this.findPartialSegment(t.areaInView,this.partialSegmentSize);e>=0&&(this.result.partialInView[e]+=this.sampleTime)}this.mouseOver&&(this.result.adHover+=this.sampleTime)}},getFlashInViewData:function(){try{this.result.stats.nSamples++;var t=this,e=function(e,i){var a=i.getThrottleState();a="resume"==a?1:0;var s=i.getFrameRate();("undefined"==typeof s||null===s||isNaN(s))&&(s=0),"undefined"==typeof t.result.stats.beaconAvgs[e]&&(t.result.stats.beaconAvgs[e]={fps:0,throttle:0}),t.result.stats.beaconAvgs[e].fps+=s,t.result.stats.beaconAvgs[e].throttle+=a};for(var i in this.beaconsArray){var a=this.beaconsArray[i].beaconElement;e(i,a)}e("c",this.controlBeaconObj.beaconElement);var s=0;if(!this.controlBeaconObj.beaconElement.isViewable()){0==this.result.stats.firstViewableTimestamp&&(this.result.stats.firstViewableTimestamp=(new Date).getTime());for(var i in this.beaconsArray){var a=this.beaconsArray[i].beaconElement;a.isViewable()&&s++}}return{areaInView:Math.floor(s/this.beaconsArray.length*100)}}catch(n){return{areaInView:0}}},getAdInViewData:function(){var t=this.adPosition,e=this.adSize,i=this.getPagePosition(),a=this.getPageSize(),s=[t.x,t.x+e.x],n=[i.x,i.x+a.x],o=[t.y,t.y+e.y],r=[i.y,i.y+a.y],l=0,h=0;s[0]>=n[0]&&s[1]<=n[1]?l=e.x:s[0]>=n[0]&&s[0]<=n[1]?l=n[1]-s[0]:s[1]>=n[0]&&s[1]<=n[1]&&(l=s[1]-n[0]),o[0]>=r[0]&&o[1]<=r[1]?h=e.y:o[0]>=r[0]&&o[0]<=r[1]?h=r[1]-o[0]:o[1]>=r[0]&&o[1]<=r[1]&&(h=o[1]-r[0]);var c=Math.floor(l*h/(e.x*e.y)*100);return{areaInView:c}},attachUnloadEvent:function(){var t=this;this.attachEvent(window,"beforeunload",function(){t.logData()})},logData:function(){var t=this.getAdInViewData().areaInView;t=isNaN(t)?0:t,this.result.areaInViewOnUnload=t,window.XDomainRequest?xmlhttp=new XDomainRequest:window.XMLHttpRequest&&(xmlhttp=new XMLHttpRequest),xmlhttp&&(xmlhttp.open("GET",this.logEndpoint+this.generateQueryString(),!1),xmlhttp.send())},generateQueryString:function(){var t="?";if(this.context)for(attr in this.context)if("pg"==attr){var e='{"loadTimestamp":'+this.result.stats.loadTimestamp+',"firstDataTimestamp":'+this.result.stats.firstDataTimestamp+',"firstViewableTimestamp":'+this.result.stats.firstViewableTimestamp+',"nSamples":'+this.result.stats.nSamples;"undefined"!=typeof this.result.stats.errorTimestamp&&(e+=',"errorTimestamp":'+this.result.stats.errorTimestamp),e+=',"beaconAvgs":{';var i=!0;for(var a in this.result.stats.beaconAvgs){i?i=!1:e+=",";var s=this.result.stats.beaconAvgs[a].fps/this.result.stats.nSamples;isNaN(s)&&(s=0);var n=this.result.stats.beaconAvgs[a].throttle/this.result.stats.nSamples;isNaN(n)&&(n=0),e+='"'+a+'":{"fps":'+s+',"throttle":'+n+"}"}e+="}}",t+=this.qs(attr,e)}else t+=this.qs(attr,this.context[attr]);this.isDefined(this.result.error)&&(t+=this.qs("error",this.result.error)),t+=this.qs("if",this.iframe),t+=this.qs("hv",this.result.adHover),t+=this.qs("piv",this.result.pageInView);for(var o=100/this.partialSegmentSize,a=1;o>=a;a++)t+=this.qs("p"+10*a,this.result.partialInView[a-1]);return t+=this.qs("iv_unl",this.result.areaInViewOnUnload),t+=this.qs("v","2"),t+=this.qs("stime",this.result.sessionTime,!0)},qs:function(t,e,i){return t+"="+encodeURIComponent(e)+(i?"":"&")},attachMouseHover:function(t){var e=this;this.attachEvent(t,"mouseover",function(){e.mouseOver=!0}),this.attachEvent(t,"mouseout",function(){e.mouseOver=!1})},attachMouseClick:function(t){var e=this;this.attachEvent(t,"click",function(t){e.result.interaction={x:t.pageX-e.adPosition.x,y:t.pageY-e.adPosition.y}})},attachPageBlur:function(t){var e=this;this.attachEvent(t,"focus",function(){e.pageFocus=!0}),this.attachEvent(t,"blur",function(){e.pageFocus=!1})},getAdPosition:function(t){for(var e=0,i=0;null!=t;e+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent);return{x:e,y:i}},getPagePosition:function(){var t=document.documentElement,e=document.body,i=t&&t.scrollLeft||e&&e.scrollLeft||0,a=t&&t.scrollTop||e&&e.scrollTop||0;return{x:i,y:a}},getPageSize:function(){return window.innerWidth?{x:window.innerWidth,y:window.innerHeight}:document.all?{x:document.body.clientWidth,y:document.body.clientHeight}:{x:0,y:0}},getAdSize:function(t){var e=t.getBoundingClientRect();return{x:e.right-e.left,y:e.bottom-e.top}},attachEvent:function(t,e,i){this.isDefined(t.addEventListener)?t.addEventListener(e,i,!1):this.isDefined(t.attachEvent)&&t.attachEvent("on"+e,i)},createPartialInViewSegments:function(t){for(var e=100/t,i=0;e>i;i++)this.result.partialInView.push(0)},findPartialSegment:function(t,e){for(var i=100/e,a=i;a>=1;a--)if(t>=a*e)return a-1;return-1},isDefined:function(t){return"undefined"!=typeof t},isIframe:function(){try{return window.top!=window}catch(t){return!0}}},"undefined"!=typeof pp_iv_ctx&&new pp.inview(pp_iv_ctx).initialize();