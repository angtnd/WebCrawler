//Build 1.3.11 at Tue Jan 26 2016 11:26:44 GMT+0000 (UTC) for live
!function(t,e,i){function n(t,e){return typeof t===e}function o(){var t,e,i,o,a,s,r;for(var c in b)if(b.hasOwnProperty(c)){if(t=[],e=b[c],e.name&&(t.push(e.name.toLowerCase()),e.options&&e.options.aliases&&e.options.aliases.length))for(i=0;i<e.options.aliases.length;i++)t.push(e.options.aliases[i].toLowerCase());for(o=n(e.fn,"function")?e.fn():e.fn,a=0;a<t.length;a++)s=t[a],r=s.split("."),1===r.length?w[r[0]]=o:(!w[r[0]]||w[r[0]]instanceof Boolean||(w[r[0]]=new Boolean(w[r[0]])),w[r[0]][r[1]]=o),_.push((o?"":"no-")+r.join("-"))}}function a(t){var e=E.className,i=w._config.classPrefix||"";if(k&&(e=e.baseVal),w._config.enableJSClass){var n=new RegExp("(^|\\s)"+i+"no-js(\\s|$)");e=e.replace(n,"$1"+i+"js$2")}w._config.enableClasses&&(e+=" "+i+t.join(" "+i),k?E.className.baseVal=e:E.className=e)}function s(){return"function"!=typeof e.createElement?e.createElement(arguments[0]):k?e.createElementNS.call(e,"http://www.w3.org/2000/svg",arguments[0]):e.createElement.apply(e,arguments)}function r(){var t=e.body;return t||(t=s(k?"svg":"body"),t.fake=!0),t}function c(t,i,n,o){var a,c,l,d,f="modernizr",u=s("div"),h=r();if(parseInt(n,10))for(;n--;)l=s("div"),l.id=o?o[n]:f+(n+1),u.appendChild(l);return a=s("style"),a.type="text/css",a.id="s"+f,(h.fake?h:u).appendChild(a),h.appendChild(u),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),u.id=f,h.fake&&(h.style.background="",h.style.overflow="hidden",d=E.style.overflow,E.style.overflow="hidden",E.appendChild(h)),c=i(u,t),h.fake?(h.parentNode.removeChild(h),E.style.overflow=d,E.offsetHeight):u.parentNode.removeChild(u),!!c}function l(t,e){return!!~(""+t).indexOf(e)}function d(t){return t.replace(/([A-Z])/g,function(t,e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-")}function f(e,n){var o=e.length;if("CSS"in t&&"supports"in t.CSS){for(;o--;)if(t.CSS.supports(d(e[o]),n))return!0;return!1}if("CSSSupportsRule"in t){for(var a=[];o--;)a.push("("+d(e[o])+":"+n+")");return a=a.join(" or "),c("@supports ("+a+") { #modernizr { position: absolute; } }",function(t){return"absolute"==getComputedStyle(t,null).position})}return i}function u(t){return t.replace(/([a-z])-([a-z])/g,function(t,e,i){return e+i.toUpperCase()}).replace(/^-/,"")}function h(t,e,o,a){function r(){d&&(delete A.style,delete A.modElem)}if(a=n(a,"undefined")?!1:a,!n(o,"undefined")){var c=f(t,o);if(!n(c,"undefined"))return c}for(var d,h,p,g,m,v=["modernizr","tspan"];!A.style;)d=!0,A.modElem=s(v.shift()),A.style=A.modElem.style;for(p=t.length,h=0;p>h;h++)if(g=t[h],m=A.style[g],l(g,"-")&&(g=u(g)),A.style[g]!==i){if(a||n(o,"undefined"))return r(),"pfx"==e?g:!0;try{A.style[g]=o}catch(b){}if(A.style[g]!=m)return r(),"pfx"==e?g:!0}return r(),!1}function p(t,e){return function(){return t.apply(e,arguments)}}function g(t,e,i){var o;for(var a in t)if(t[a]in e)return i===!1?t[a]:(o=e[t[a]],n(o,"function")?p(o,i||e):o);return!1}function m(t,e,i,o,a){var s=t.charAt(0).toUpperCase()+t.slice(1),r=(t+" "+I.join(s+" ")+s).split(" ");return n(e,"string")||n(e,"undefined")?h(r,e,o,a):(r=(t+" "+P.join(s+" ")+s).split(" "),g(r,e,i))}function v(t,e,n){return m(t,i,i,e,n)}var b=[],y={_version:"3.3.1",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(t,e){var i=this;setTimeout(function(){e(i[t])},0)},addTest:function(t,e,i){b.push({name:t,fn:e,options:i})},addAsyncTest:function(t){b.push({name:null,fn:t})}},w=function(){};w.prototype=y,w=new w;var _=[],E=e.documentElement,k="svg"===E.nodeName.toLowerCase();w.addTest("localstorage",function(){var t="modernizr";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(e){return!1}});var C=y._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):[];y._prefixes=C;var x=y.testStyles=c;w.addTest("touchevents",function(){var i;if("ontouchstart"in t||t.DocumentTouch&&e instanceof DocumentTouch)i=!0;else{var n=["@media (",C.join("touch-enabled),("),"heartz",")","{#modernizr{top:9px;position:absolute}}"].join("");x(n,function(t){i=9===t.offsetTop})}return i}),w.addTest("svg",!!e.createElementNS&&!!e.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect);var S="Moz O ms Webkit",I=y._config.usePrefixes?S.split(" "):[];y._cssomPrefixes=I;var T={elem:s("modernizr")};w._q.push(function(){delete T.elem});var A={style:T.elem.style};w._q.unshift(function(){delete A.style});var P=y._config.usePrefixes?S.toLowerCase().split(" "):[];y._domPrefixes=P,y.testAllProps=m,y.testAllProps=v,w.addTest("cssanimations",v("animationName","a",!0)),w.addTest("texttrackapi","function"==typeof s("video").addTextTrack),w.addTest("track","kind"in s("track")),o(),a(_),delete y.addTest,delete y.addAsyncTest;for(var L=0;L<w._q.length;L++)w._q[L]();t.NotificationsModernizr=w}(window,document),define("mybbc/notifications/vendor/modernizr-custom",function(){}),define("mybbc/templates/signed-in",[],function(){return'<section class="notification-error__container"></section><section class="notification-settings__container notification-settings__container--js"></section><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title">Notifications<sup class="notification-title__beta">beta</sup></h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="#"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul><a href="#" class="notifications-pop-up"></a></header><div id="notifications-wrapper"><div class="notification-panel" style="display: block;"><notifications><div class="spinner"><img class="loader-icon notifications-image" src="{{baseAssetUrl}}img/loader/32px/34px_Icon32px_Lively_Dark.gif" alt="Settings"></div></notifications></div></div></div>'}),define("mybbc/templates/signed-out",[],function(){return'<div id="notifications-main" class="notifications-main--css notifications-main--js notification-signed-out"><div class="notifications-no-scroll"><div class="notifications-fake"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar">Never miss your favourites</p><p class="notifications-description notifications-pica">Get notifications about your favourite&nbsp;<span>programmes, music and more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="notifications-top-header"><p class="notifications-main-header notifications-trafalgar" tabindex="1">Never miss your favourites</p><p class="notifications-description notifications-pica" tabindex="2">Get notifications about your favourite&nbsp;<span>programmes, music and more.</span></p></div><div class="notifications-cta notifications-cta--upsell"><div class="notification-sign-in"><a href="{{idConfig.urls.signin}}?ptrt={{ptrt}}" tabindex="3" class="notifications-sign-in__link--js notifications-pica"><span>Sign in</span></a></div><p class="notifications-pica">or&nbsp; <a href="{{idConfig.urls.register}}?ptrt={{ptrt}}" tabindex="4" class="notifications-register__link--js notifications-upsell-register notifications-pica-bold">Register</a></p></div></div></div></div></div>'}),define("mybbc/templates/on-boarding",[],function(){return'<section class="notification-error__container"></section><div id="notifications-main" class="notifications-main--css notifications-main--js notifications-on-boarding--js notifications-on-boarding notifications-no-scroll"><div class="notifications-carousel notifications-onboarding-parent-carousel--js hidden" id="notifications-onboarding-parent-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide"><div class="on-boarding"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12 notifications-canon" role="heading">Never miss<br>your favourites</p><p class="notifications-description notifications-10/12 notifications-pica">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div><div class="notifications-cta notifications-10/12"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>OK, get me started</span></a></div></div></div></div><div class="notifications-wide-spread"><div class="notifications--desktop"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__first--js notifications-10/12 notifications-canon enter-animation" role="heading" tabindex="0">Never miss<br>your favourites</p><div class="notifications-description__first--js" tabindex="0"><p class="notifications-description notifications-10/12 notifications-pica enter-animation">This is the place to get notifications about your programmes, music, radio and much more.</p><p class="notifications-description notifications-10/12 notifications-pica enter-animation">If you have favourites, we&#39;ll keep you updated on those, and anything new you add. Manage your notifications at any time in settings.</p></div></div><div class="notifications-cta notifications-10/12 enter-animation"><div class="notification-sign-in notifications-start-onboarding__link--js" id="start-onboarding"><a href="javascript:void(0)" role="link" aria-label="OK, get me started" alt="OK, get me started" title="OK, get me started" class="notifications-pica"><span>OK, get me started</span></a></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="notifications-carousel notifications-onboarding-carousel notifications-onboarding-carousel--js hidden" id="notifications-onboarding-carousel"><div class="notifications-carousel__wrap"><div class="notifications-carousel__slide notifications-carousel__slide--slide-0"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" role="heading" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-1" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img role="img" class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings" aria-label="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation first-time" tabindex="0"><a role="link" aria-label="Notification title" tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-unread"></span></div><div class="notification-text notifications-11/12"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev inactive" data-slide="prev" tabindex="-1"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" role="link" class="notifications-carousel__controls--skip__link--js" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-1"><div class="notifications-favourites__container"><div class="notifications-favourites--preview"></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-2"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title notifications__title--js-3" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a role="link" class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div><div class="notifications-carousel__slide notifications-carousel__slide--slide-3"><div id="notifications-main" class="notifications-main--js notifications-main--css notification-signed-in"><header id="notifications__header" class="notifications__header notifications__header--js"><h2 class="notification-title enter-animation notifications__title--js-4" tabindex="0">Notifications</h2><ul class="notification-header-icons"><li><a class="notifications__settings--js" href="javascript:void(0)"><img class="setting-icon notifications-image" src="{{baseAssetUrl}}svg/setting.svg" alt="Settings"><p class="notifications-brevier">Settings</p></a></li></ul></header><div class="notifications-arrow-pointer enter-animation"></div><div id="notifications-wrapper" class="notifications-no-scroll"><div class="notification-panel" style="display: block;"><notifications><ul class="notification-items"><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-music-icon"></div><span class="notification-dot notification-new"></span></div><div class="notification-text notifications-11/12 notification-new"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">Here&#39;s a new notification about an available music clip from one of your followed artists.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">Music</span> <span class="notification-time notifications-brevier">Just Now</span></div></div></div></a></li><li class="notification-item notification__item--js enter-animation" tabindex="0"><a tabindex="-1" href="javascript:void(0)" title="First title"><div class="notification-icon-and-dot notifications-1/12"><div class="notifications-image notification-iplayer-icon"></div><span class="notification-dot notification-read"></span></div><div class="notification-text notifications-11/12 notification-read"><div class="notification-title-items"><div class="notifications-7/12"><p class="notification-text-body notifications-long-primer">This is a notification about a new episode available to watch in iPlayer.</p></div><div class="notifications-4/12"><span class="notification-episode-name notifications-brevier">iPlayer</span> <span class="notification-time notifications-brevier">10 minutes ago</span></div></div></div></a></li></ul></notifications></div></div></div><div class="notifications-carousel__info-wrapper"><div class="notifications-carousel__info"><div class="notifications-limitation-container"><div class="notifications-carousel__triangle"><div></div><div></div></div><div class="notifications-carousel-pages notifications-carousel-pages--js first-time"><a href="javascript:void(0)" data-slide-to="0" role="link" alt="Go to slide 1" title="Go to slide 1" aria-label="Go to slide 1" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="1" role="link" alt="Go to slide 2" title="Go to slide 2" aria-label="Go to slide 2" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="2" role="link" alt="Go to slide 3" title="Go to slide 3" aria-label="Go to slide 3" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js"></a> <a href="javascript:void(0)" data-slide-to="3" role="link" alt="Go to slide 4" title="Go to slide 4" aria-label="Go to slide 4" data-target-carousel="#notifications-onboarding-carousel" tabindex="-1" class="notifications-carousel-pages__link--js active"></a></div><div class="notifications-carousel__content notifications-carousel__content--js first-time"><div class="notifications-carousel__header notifications-carousel__header--js"><p class="notifications-great-primer notifications-7/12" tabindex="0">Notifications appear here</p></div><div class="notifications-carousel__description notifications-carousel__description--js"><p class="notifications-pica notifications-10/12" tabindex="0">Simply click on an episode to start watching.</p></div></div><div class="notifications-carousel__controls first-time"><div class="notifications-carousel-navigation"><a href="javascript:void(0)" role="link" aria-label="Go to Next slide" title="Go to Next slide" alt="Go to Next slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--next" data-slide="next"></a> <a href="javascript:void(0)" role="link" aria-label="Go to Previous slide" title="Go to Previous slide" alt="Go to Previous slide" class="notifications-carousel__controls--button notifications-carousel__controls--js control--prev" data-slide="prev"></a></div><div class="notifications-carousel__controls--skip"><p class="notifications-pica notifications-6/12"><a href="javascript:void(0)" class="notifications-carousel__controls--skip__link--js" role="link" alt="Skip" title="Skip" aria-label="Skip" data-slide-to="2" data-target-carousel="#notifications-onboarding-parent-carousel">Skip</a></p></div></div></div></div></div></div></div></div></div><div class="notifications-carousel__slide"><div class="on-boarding on-boarding--js on-boarding-last-slide hidden"><div aria-label="Close" class="on-boarding-close">&nbsp;</div><div class="notifications-fake"><div class="onboarding-image"></div><div class="notifications-top-header"><p class="notifications-main-header notifications-10/12" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta"><div class="notification-sign-in"><a href="javascript:void(0)" role="link" class="notifications-sign-in__link--js notifications-pica"><span>Yes, I&#39;m in</span></a></div></div></div><div class="notifications-wide-spread"><div class="notifications-limitation-container"><div class="onboarding-image enter-animation"></div><div class="notifications-wide-spread--absolute"><div class="notifications-top-header"><p class="notifications-main-header notifications-main-header__are-you-ready--js notifications-10/12 enter-animation" tabindex="0">Are you ready for notifications?</p></div><div class="notifications-cta enter-animation first-time"><div class="notification-sign-in notifications-opt-in__link--js"><a href="javascript:void(0)" role="link" class="notifications-pica"><span>Yes, I&#39;m in</span></a></div><p class="notifications-pica"></p></div></div></div></div></div></div></div></div></div>'}),define("mybbc/templates/error",[],function(){return'<div class="notifications-error" id="hub-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and your notifications<br>canât be displayed at the moment. Please try again later.</p></div><div class="notifications-error--inner" id="hub-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry, something has gone wrong.<br>&nbsp;Your notifications could not be updated. Please try again later.</p><div class="notifications-error--inner__container"><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div></div><div class="notifications-error" id="settings-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and your notifications settings<br>cannot be retrieved. Please try again later.</p><div class="notifications-error__back" aria-action="close"><div class="notifications-error__back__arrow"></div><div class="notifications-error__back__text">Back</div></div></div><div class="notifications-error--inner" id="settings-error-inner"><p class="notifications-error--inner__body notifications-10/12">Sorry, something has gone wrong.<br>&nbsp;Your settings could not be updated. Please try again later.</p><div class="notifications-error--inner__container"><div aria-label="Close notification error message" class="notifications-error--inner__close" aria-action="close">&nbsp;</div></div></div><div class="notifications-error" id="onboarding-error-main"><div class="notifications-error__header"><p class="notifications-error__header--text">Sorry, something has gone wrong.</p></div><p class="notifications-pica notifications-error__body">Thereâs been an error and we are unable to get you<br>started with notifications. Please try again later.</p></div>';
}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/classie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.classie=e()}(this,function(){function t(t){return new RegExp("(^|\\s+)"+t+"(\\s+|$)")}function e(t,e){var a=i(t,e)?o:n;a(t,e)}var i,n,o;"classList"in document.documentElement?(i=function(t,e){return t.classList.contains(e)},n=function(t,e){var i=e.split(" ");t.classList.add(i[0]),i.length>1&&n(t,i.slice(1).join(" "))},o=function(t,e){var i=e.split(" ");t.classList.remove(i[0]),i.length>1&&o(t,i.slice(1).join(" "))}):(i=function(e,i){return t(i).test(e.className)},n=function(t,e){var o=e.split(" ");i(t,o[0])||(t.className=t.className+" "+o[0]),o.length>1&&n(t,o.slice(1).join(" "))},o=function(e,i){var n=i.split(" ");e.className=e.className.replace(t(n[0])," "),n.length>1&&o(e,n.slice(1).join(" "))});var a={hasClass:i,addClass:n,removeClass:o,toggleClass:e,has:i,add:n,remove:o,toggle:e};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/eventie",[],function(){return e()}):"undefined"!=typeof exports?module.exports=e():t.eventie=e()}(this,function(){return{addEvent:function(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):(t["e"+e+i]=i,t[e+i]=function(){t["e"+e+i](window.event)},t.attachEvent("on"+e,t[e+i]))},removeEvent:function(t,e,i){t.removeEventListener?t.removeEventListener(e,i,!1):(t.detachEvent("on"+e,t[e+i]),t[e+i]=null)},triggerEvent:function(t,e,i,n){var o=document.createEvent("Event");n=n||!1,""===o.type&&o.initEvent(e,!0,n),o.data=i||{},t.dispatchEvent(o)}}}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/logger",[],e):"undefined"!=typeof exports?module.exports=e():t.logger=e()}(this,function(){function t(t){var e;this.root.console&&this.isLoggingEnabled()&&(e=arguments.length>0?Array.prototype.slice.call(arguments,1):[],t=t.toLowerCase(),this.level="function"==typeof this.root.console[t]?t:"log",e[0]=this.getLogTitle()+" "+e[0],this.root.console[this.level].apply?this.root.console[this.level].apply(this.root.console,e):this.root.console.log&&this.root.console.log(e))}function e(t,e){var i;return e=e||[],i=Array.prototype.slice.call(e),i.unshift(t),i}var i=this,n=function(t,e){e=e||{},this.context=t||"No Context",this.root=window?window:i,this.mode=e.mode||n.defaults.mode,this.cookieName=e.cookieName||n.defaults.cookieName,this.level="log"};return n.defaults={mode:"cookie",cookieName:"ckps_notifications_log"},n.getLogger=function(t,e){return new this(t,e)},n.prototype={log:function(){t.apply(this,e("log",arguments))},info:function(){t.apply(this,e("info",arguments))},error:function(){t.apply(this,e("error",arguments))},warn:function(){t.apply(this,e("warn",arguments))},debug:function(){t.apply(this,e("debug",arguments))},getLogTitle:function(){return["[",this.context,":",this.level.toUpperCase(),"]"].join("")},isLoggingEnabled:function(){return"cookie"===this.mode?-1!==document.cookie.indexOf(this.cookieName):!0}},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/utils",[],function(){return e(t)}):"undefined"!=typeof exports?module.exports=e(t):t.utils=e(t)}(this,function(t){var e=function(t){t&&(this.logger=t)};return e.prototype={handledParse:function(t,e,i){try{return JSON.parse(t)}catch(n){return this.logger&&this.logger.error(n,t),"function"==typeof i&&i(),e||null}},extend:function(){function t(t,i){e[o][i]=r.isObject(t)?r.extend(e[o][i],t,a):t}var e,i,n,o,a,s=Array.prototype.slice.call(arguments),r=this;if(0===s.length)return{};n=s[s.length-1],a=n===!0,"boolean"==typeof n&&s.pop();for(var c=0;c<s.length;c++)if(i=r.keys(s[c]),0!==i.length)for(var l in s[c])(!a||s[c].hasOwnProperty(l))&&(e=e||{},r.isArray(s[c][l])&&a?"undefined"!=typeof e[l]&&r.isArray(e[l])?(o=l,r.forEach(s[c][l],t)):e[l]=s[c][l].slice():r.isObject(s[c][l])&&a?e[l]=r.isObject(e[l])?r.extend(e[l],s[c][l],a):r.extend(s[c][l],a):null!==s[c][l]&&void 0!==s[c][l]&&(e[l]=s[c][l]));return e},forEach:function(t,e,i){i=i||null;for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},truncate:function(t,e){return e=e||30,shortened=t.substring(0,e+1),t.length>e?-1==shortened.indexOf(" ")?shortened.substring(0,shortened.length-1)+"...":shortened.substr(0,Math.min(shortened.length,shortened.lastIndexOf(" ")))+" ...":t},each:function(t,e,i){i=i||null;if(this.isObject(t))for(var n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n)},bind:function(t,e){return"function"==typeof t?t.bind?t.bind(e):function(){t.apply(e,arguments)}:void 0},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},keys:function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},isObject:function(t){return"object"==typeof t&&null!==t}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/NotificationsTemplate",e):"undefined"!=typeof exports?module.exports=e():t.NotificationsTemplate=e()}(this,function(){var t=function(){function t(e,i){var n;return n=i.split("."),1===n.length?e:t(e[n[1]],n.slice(1).join("."))}function e(t){this.setHtmlContent(t)}return e.prototype={setHtmlContent:function(t){this.htmlContent=t},getHtmlContent:function(){return this.htmlContent},compile:function(e){this.data=e||this.data;for(var i,n,o=this.data,a=/{{([A-Za-z0-9_@./#&+-]+)}}/gi,s=this.getHtmlContent();null!==(match=a.exec(s));){i=match[1];try{n=t(o,"templateData."+i)}catch(r){continue}s=s.replace(new RegExp(match[0],"g"),n)}return this.compiledHtml=s,this.compiledHtml}},e}(),e=function(t,e,i){i=i||{},this.name=t,this.templateParser=e,this.templateRequireBasePath=i.templateRequireBasePath||"mybbc/templates/",i.html?(this.templateParser.setHtmlContent(i.html),this.html(i.html),this.loaded(!0)):this.loaded(!1)};return e.create=function(e,i){return new this(e,new t,i)},e.prototype={getTemplateFullRequirePath:function(){return this.templateRequireBasePath+this.name},load:function(t,e){e=e||null;var i=this;require([this.getTemplateFullRequirePath()],function(n){i.templateParser.setHtmlContent(n),i.html(n),i.loaded(!0),"function"==typeof t&&t.call(e,i)})},compile:function(t){return this.templateParser.compile(t)},html:function(t){return t&&(this.data=t),this.data},loaded:function(t){return void 0!==t&&(this.isLoaded=t),t}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/ErrorView",["mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie"),require("logger"),require("utils"),require("NotificationsTemplate")):t.ErrorView=e(classie,eventie,logger,utils,NotificationsTemplate)}(this,function(t,e,i,n,o){var a=function(a){function s(){h.innerHTML=p.compile({baseAssetUrl:u.mainApp.basePath}),g=h.querySelector(u.showErrorWithID),r(g),t.add(g,"show"),u.isInner?e.addEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent):"function"==typeof u.closeEvent&&u.errorCloseEl&&(e.removeEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent),e.addEvent(g.querySelector(u.errorCloseEl),"click",u.closeEvent)),u.stateChanged&&u.stateChanged.call(u,"shown"),u.showErrorCallback&&u.showErrorCallback("shown")}function r(t){for(var i=t.querySelectorAll("p, [aria-action=close]"),n=0;n<i.length;n++)i[n].tabIndex=n+1,i[n].getAttribute("aria-action")&&(e.removeEvent(i[n],"keydown",c),e.addEvent(i[n],"keydown",c))}function c(t){13==t.keyCode&&"function"==typeof u.closeEvent&&u.closeEvent()}function l(t,e){g||u.currentErrorView!=t.view||(t=t||{},u.showErrorCallback=e,u.showErrorWithID=t.errorElID,u.isInner=t.isInner,u.closeEvent=t.closeEvent,u.currentErrorView=t.view,u.errorCloseEl=t.closeEl,u.accesibilityInstance=t.accesibilityInstance,h=t.extContainer||document.querySelector(u.container),p.loaded()?s():p.load(s))}function d(t,e){g&&u.currentErrorView==t&&(g.parentElement.removeChild(g),e&&u.stateChanged&&u.stateChanged("hidden"),g=null)}function f(t){u.currentErrorView=t,d(t,!0)}var u,h,p,g,m=new n,v=(new i("Error view"),{container:".notification-error__container",containerForInner:"#notifications-main",templateName:"error",currentErrorView:"main"});return u=m.extend(v,a),p=o.create(u.templateName),{showError:l,hideError:d,changeView:f}};return a}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/carousel",e):"undefined"!=typeof exports?module.exports=e():(t.carousel=e(),(t.jQuery||t.Zepto)&&!function(e){e.fn.Swipe=function(i){return this.each(function(){e(this).data("Swipe",new t.Swipe(e(this)[0],i))})}}(t.jQuery||t.Zepto))}(this,function(){function t(t,e){function i(){C=T.children,I=C.length,C.length<2&&(e.continuous=!1),E.transitions&&e.continuous&&C.length<3&&(T.appendChild(C[0].cloneNode(!0)),T.appendChild(T.children[1].cloneNode(!0)),C=T.children),x=new Array(C.length),S=t.getBoundingClientRect().width||t.offsetWidth,T.style.width=C.length*S+"px";for(var i=C.length;i--;){var n=C[i];n.style.width=S+"px",n.setAttribute("data-index",i),E.transitions&&(n.style.left=i*-S+"px",f(i,L>i?-S:i>L?S:0,0))}e.continuous&&E.transitions&&(f(l(L-1),-S,0),f(l(L+1),S,0)),E.transitions||(T.style.left=L*-S+"px"),b()}function n(){E.addEventListener?((E.touch||E.isWindowsPhone())&&D&&(T.addEventListener("touchstart",z,!1),T.addEventListener("pointerdown",z,!1)),E.transitions&&(T.addEventListener("webkitTransitionEnd",z,!1),T.addEventListener("msTransitionEnd",z,!1),T.addEventListener("oTransitionEnd",z,!1),T.addEventListener("otransitionend",z,!1),T.addEventListener("transitionend",z,!1)),window.addEventListener("resize",z,!1)):window.onresize=function(){i()},A.length>0&&_(Array.prototype.slice.call(A),function(t){E.addEventListener?t.addEventListener("click",a,!1):t.attachEvent("onclick",a)}),P.length>0&&_(Array.prototype.slice.call(P),function(t,e){E.addEventListener?t.addEventListener("click",s,!1):t.attachEvent("onclick",s)})}function o(){A.length>0&&_(Array.prototype.slice.call(A),function(t){E.addEventListener?t.removeEventListener("click",a,!1):t.detachEvent("onclick",a)}),P.length>0&&_(Array.prototype.slice.call(P),function(t,e){E.addEventListener?t.removeEventListener("click",s,!1):t.detachEvent("onclick",s)})}function a(t){var i=this.dataset&&this.dataset.slide?this.dataset.slide:this.getAttribute("data-slide"),n=L;"next"==i?c():r(),"function"==typeof e.onControlclicked&&e.onControlclicked.call(this,t,L,n,T)}function s(t){var i=this.dataset&&this.dataset.slideTo?parseInt(this.dataset.slideTo,10):null!==this.getAttribute("data-slide-to")?parseInt(this.getAttribute("data-slide-to"),10):[].slice.call(this.parentNode.childNodes).indexOf(this);d(i),"function"==typeof e.onIndicatorclicked&&e.onIndicatorclicked(this,L,T)}function r(){e.continuous?d(L-1):L&&d(L-1)}function c(){e.continuous?d(L+1):L<C.length-1&&d(L+1)}function l(t){return(C.length+t%C.length)%C.length}function d(t,i){if(L!=t){if(E.transitions){var n=Math.abs(L-t)/(L-t);if(e.continuous){var o=n;n=-x[l(t)]/S,n!==o&&(t=-n*C.length+t)}for(var a=Math.abs(L-t)-1;a--;)f(l((t>L?t:L)-a-1),S*n,0);t=l(t),f(L,S*n,i||N),f(t,0,i||N),e.continuous&&f(l(t-n),-(S*n),0)}else t=l(t),h(L*-S,t*-S,i||N,j);L=t,w(e.callback&&e.callback(L,C[L]))}}function f(t,e,i,n){u(t,e,i,n),x[t]=e}function u(t,e,i,n){var o=C[t],a=o&&o.style;n=n||!1,a&&(a.webkitTransitionDuration=a.MozTransitionDuration=a.msTransitionDuration=a.OTransitionDuration=a.transitionDuration=i+"ms",a.webkitTransitionTimingFunction=a.MozTransitionTimingFunction=a.msTransitionTimingFunction=a.OTransitionTimingFunction=a.transitionTimingFunction=F[n?k.easing:j].css,a.webkitTransform="translate("+e+"px,0)translateZ(0)",a.msTransform=a.MozTransform=a.OTransform="translateX("+e+"px)")}function h(t,i,n,o){if(!n)return void(T.style.left=i+"px");var a=+new Date,s=function(){var c=+new Date-a;return c>n?(T.style.left=i+"px",R&&g(),T.style.height=C[L].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(event,L,C[L]),void(r&&clearInterval(r))):(T.style.left=F[o].js(c,t,i-t,n)+"px",void(!r&&E.animationFrame&&window.requestAnimationFrame(s)))};if(E.animationFrame)window.requestAnimationFrame(s);else var r=setInterval(s,parseInt(1e3/60,10))}function p(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function g(){O=setTimeout(c,R)}function m(){R=0,clearTimeout(O)}function v(){t.style.visibility="hidden"}function b(){t.style.visibility="visible"}var y=function(){},w=function(t){setTimeout(t||y,0)},_=function(t,e,i){if(i=i||null,Array.prototype.forEach)return Array.prototype.forEach.call(t,e,i);for(var n=0,o=t.length;o>n;n++)n in t&&e.call(i,t[n],n,t)},E={addEventListener:!!window.addEventListener,animationFrame:!!window.requestAnimationFrame,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,isWindowsPhone:function(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)},transitions:function(t){var e=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var i in e)if(void 0!==t.style[e[i]])return!0;return!1}(document.createElement("swipe"))},k={startSlide:0,speed:300,continuous:!0,easing:"ease",draggable:!0,touchEvents:!0};if(t){e=e||{};var C,x,S,I,T=t.children[0],A=t.querySelectorAll(e.controlsSelector||'[data-slide][data-target-carousel="#'+t.id+'"]'),P=t.querySelectorAll(e.indicatorSelector||'[data-slide-to][data-target-carousel="#'+t.id+'"]'),L=parseInt(e.startSlide,10)||k.startSlide,N="undefined"!=typeof e.speed?e.speed:k.speed,j=e.easing||k.easing,M="undefined"!=typeof e.draggable?e.draggable:k.draggable,D="undefined"!=typeof e.touchEvents?e.touchEvents:k.touchEvents;e.continuous=void 0!==e.continuous?e.continuous:k.continuous;var O,q,F={easeInOutExpo:{css:"cubic-bezier(1, 0, 0, 1)",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:(t/=n/2)<1?i/2*Math.pow(2,10*(t-1))+e:i/2*(-Math.pow(2,-10*--t)+2)+e}},linear:{css:"linear",js:function(t,e,i,n){return 0===t?e:t>=n?e+i:i*(Math.floor(t/n*100)/100)+e}},ease:{css:"ease",js:function(t,e,i,n){var o;return 0===t?e:t>=n?e+i:(o=1.0042954579734844*Math.exp(-6.404173895841566*Math.exp(-7.290824133098134*(t/n))),i*o+e)}}},R=e.auto||0,H={},U={},B={},z={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"pointerdown":this.start(t);break;case"touchmove":this.move(t);break;case"pointermove":this.move(t);break;case"touchend":w(this.end(t));break;case"pointerup":w(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":w(this.transitionEnd(t));break;case"resize":w(i)}e.stopPropagation&&t.stopPropagation()},start:function(t){if(t.touches)var e=t.touches[0];var i=E.isWindowsPhone()?t.clientX:e.pageX,n=E.isWindowsPhone()?t.clientY:e.pageY;i&&n&&(H={x:i,y:n,time:+new Date},U={x:i,y:n},q=void 0,B={},T.addEventListener("touchmove",this,!1),T.addEventListener("touchend",this,!1),T.addEventListener("pointermove",this,!1),T.addEventListener("pointerup",this,!1))},move:function(t){if(window.navigator.pointerEnabled||!(t.touches.length>1||t.scale&&1!==t.scale)){if(e.disableScroll&&p(t),t.touches){var i=t.touches[0];U.x=i.pageX,U.y=i.pageY}else E.isWindowsPhone()&&(U.x=t.clientX?t.clientX:U.x,U.y=t.clientY?t.clientY:U.y);B={x:U.x-H.x,y:U.y-H.y},"undefined"==typeof q&&(q=!!(q||Math.abs(B.x)<Math.abs(B.y))),q||(p(t),m(),M&&(e.continuous?(u(l(L-1),B.x+x[l(L-1)],0),u(L,B.x+x[L],0),u(l(L+1),B.x+x[l(L+1)],0)):(B.x=B.x/(!L&&B.x>0||L==C.length-1&&B.x<0?Math.abs(B.x)/S+1:1),u(L-1,B.x+x[L-1],0),u(L,B.x+x[L],0),u(L+1,B.x+x[L+1],0))))}},end:function(t){var i=500,n=10,o=30,a=+new Date-H.time,s=Number(a)<i&&Math.abs(B.x)>n||Math.abs(B.x)>S*(o/100),r=Math.abs(N-Math.floor(Math.abs(B.x)/S*1.2*N));r=.5>r/N?.5*N:r/N>.75?.75*N:r;var c=!L&&B.x>0||L==C.length-1&&B.x<0,d=L;e.continuous&&(c=!1);var u=B.x<0;q||(s&&!c?(u?(e.continuous?(f(l(L-1),-S,0),f(l(L+2),S,0)):f(L-1,-S,0),f(L,x[L]-S,r),f(l(L+1),x[l(L+1)]-S,r),L=l(L+1)):(e.continuous?(f(l(L+1),S,0),f(l(L-2),-S,0)):f(L+1,S,0),f(L,x[L]+S,r),f(l(L-1),x[l(L-1)]+S,r),L=l(L-1)),e.callback&&e.callback(L,C[L])):e.continuous?(f(l(L-1),-S,N),f(L,0,N),f(l(L+1),S,N)):(f(L-1,-S,N),f(L,0,N),f(L+1,S,N)),e.onSwipe&&e.onSwipe(L,d,u?"right":"left")),T.removeEventListener("touchmove",z,!1),T.removeEventListener("touchend",z,!1),T.removeEventListener("pointermove",z,!1),T.removeEventListener("pointerup",z,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==L&&(R&&g(),T.style.height=C[L].offsetHeight+"px",e.transitionEnd&&e.transitionEnd.call(t,L,C[L]))}};return i(),R&&g(),n(),{setup:function(){i()},slide:function(t,e){m(),d(t,e)},prev:function(){m(),r()},next:function(){m(),c()},stop:function(){m()},getPos:function(){return L},getNumSlides:function(){return I},getActiveSlideEl:function(){return C[L]},hide:function(){v()},show:function(){b()},kill:function(){m(),T.style.width="",T.style.left="";for(var t=C.length;t--;){var e=C[t];e.style.width="",e.style.left="",E.transitions&&u(t,0,0)}E.addEventListener?(T.removeEventListener("touchstart",z,!1),T.removeEventListener("pointerdown",z,!1),T.removeEventListener("webkitTransitionEnd",z,!1),T.removeEventListener("msTransitionEnd",z,!1),T.removeEventListener("oTransitionEnd",z,!1),T.removeEventListener("otransitionend",z,!1),T.removeEventListener("transitionend",z,!1),T.removeEventListener("click",z,!1),window.removeEventListener("resize",z,!1)):window.onresize=null,o()}}}}return t}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/onboarding",["mybbc/notifications/eventie","mybbc/notifications/utils","mybbc/notifications/carousel","mybbc/notifications/classie","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("utils"),require("carousel"),require("Logger")):t.onboarding=e(eventie,utils,carousel,classie,Logger)}(this,function(t,e,i,n,o){function a(t){t=t||{},R=z.extend(at,t),F=R.carousels,u(),t.app&&(q=t.app),R.errorView&&(H=R.errorView,H.changeView("onboarding")),c(R.mainElSelector),k(),!NotificationsModernizr.cssanimations&&r()&&F.onboardingParent.carousel.hide(),l(),V=!0,R.resizeEvent(u),s()}function s(){J=!1}function r(){return J}function c(t){B=document.querySelector(t),B.style.display="block"}function l(){var e=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close"));t.addEvent(e,"click",f),t.addEvent(i,"click",w),z.forEach(n,function(e){t.addEvent(e,"click",y)}),ct.startListeners()}function d(){var e=document.querySelector(".notifications-opt-in__link--js"),i=document.querySelector(".notifications-start-onboarding__link--js"),n=Array.prototype.slice.call(document.querySelectorAll(".on-boarding-close"));t.removeEvent(e,"click",f),t.removeEvent(i,"click",w),z.forEach(n,function(e){t.removeEvent(e,"click",y)}),ct.stopListeners()}function f(){q.getUserPreferencesModel().updateUserOnBoarding(function(t,e){return t?(H.showError({view:"onboarding",isInner:!1,errorElID:"#onboarding-error-main"}),void G.error("Error updating user onboarding",t)):void _()})}function u(){var t,e=document.querySelector(".orb-nav-pri-container"),i=document.querySelector(".notifications-carousel__wrap"),n=Math.max(document.documentElement.clientWidth,window.innerWidth||0),o=Math.max(document.documentElement.clientHeight,window.innerHeight||0),a=g(n,o,e.offsetHeight),s=400,r=h(/Mobile.*Firefox/g),c=h(/SamsungBrowser.*Mobile/g);n>o&&768>n?v(Y,Math.max(n,a-e.offsetHeight)+"px"):(t=r?-48:c?-96:0,v(Y,a-e.offsetHeight+t+"px")),v(i,"100%"),M(Y),NotificationsModernizr.cssanimations?x():setTimeout(m,s)}function h(t){return navigator.userAgent.match(t)&&navigator.userAgent.match(t).length>0}function p(){X.style.top="",X.setAttribute("style",""),X.setAttribute("style","top: 0px"),M(X);var t,e=getComputedStyle(X),i=Y.clientWidth,n=Y.clientHeight,o=1008,a=800,s=750,r=1173,c=o/a,l=s/r,d=parseFloat(e.width,10),f=0,u=.15;768>i?(f=d/l,t=-(f-n)+(f*u-n/2)):(f=d/c,t=-(f-n/2)),X.setAttribute("style","top: "+t+"px; height: "+f+"px")}function g(t,e,i){var n=419,o=1008,a=460+i;return e=e||Math.max(document.documentElement.clientHeight,window.innerHeight||0),n>=t?Math.max(e,a):o>t?Math.max(.7*e,a):a}function m(){F.onboardingParent.carousel.show(),x()}function v(t,e){t&&(t.setAttribute("data-orig-height",t.style.height),t.style.minHeight=e,t.style.height=e,t.style.maxHeight=e)}function b(){v(Y,Y.getAttribute("data-orig-height"))}function y(){"hidden"!==q.getDrawerState()&&q.navNotificationElement.click()}function w(){ot||(q.isUserOnBoarded()?_():(N("onboardingParent").next(),ot=!0))}function _(){NotificationsModernizr.cssanimations?(t.addEvent(B,E(),function(t){"hidden"!==q.getDrawerState()&&q.navNotificationElement.click(),q.prepareAndLaunchNotificationApp()}),n.add(B,"notifications-on-boarding--fadeout")):("hidden"!==q.getDrawerState()&&q.navNotificationElement.click(),q.prepareAndLaunchNotificationApp())}function E(){var t=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function k(){var t=F.onboardingParent.config;t.callback=rt.onboardingParentCasouselSlideChanged,t.transitionEnd=rt.onboardingParentCasouselSlideChangeFinished,L("onboardingParent",t),x(),C(),ct.checkInitialFocus()}function C(){for(var t=document.querySelectorAll(".notifications-wide-spread .enter-animation"),e=0;e<t.length;e++)M(t[e])}function x(){var t=document.querySelector("#notifications-main"),e=t.offsetHeight;document.querySelector("#orb-panels").style.height=e+"px"}function S(t){var e=F.onboarding.config;e.callback=t||rt.onboardingCasouselSlideChanged,e.onControlclicked=rt.onBoardingCarouselControlClicked,e.onSwipe=rt.onBoardingCarouselSwiped,L("onboarding",e);for(var i=0;i<nt.length;i++)n.add(nt[i],"first-time"),M(nt[i])}function I(){return W}function T(t){W=t}function A(t){t.target.querySelector(Z).innerHTML=st[I()].title.replace(/'/g,"&#146;"),t.target.querySelector(Q).innerHTML=st[I()].body.replace(/'/g,"&#146;"),n.remove(X,"enter-animation"),1===W&&(n.add(X,"enter-animation"),p(),P()),2===W?(n.add($,"swing onboarding"),n.add(et,"new-notifications onboarding")):(n.remove($,"swing onboarding"),1===W&&n.remove(et,"new-notifications onboarding")),ct.setCarouselSlideFocus("onboarding",Z)}function P(){var t,e=getComputedStyle(X),i=e.backgroundImage,n=i.split(".gif").shift(),o=X.style.top,a=X.style.height;t="background-image: "+n.replace(/\"|\'/g,"")+".gif?_"+Date.now()+") !important;top: "+o+";height: "+a+";",X.setAttribute("style",t)}function L(t,e){var o=document.querySelector(F[t].selector);return n.remove(o,"hidden"),F[t].carousel=i(o,e),F[t].carousel}function N(t){return F[t].carousel}function j(t){var e=document.querySelectorAll(".notifications-carousel__slide--slide-"+t+" .enter-animation");if(NotificationsModernizr.cssanimations){for(var i=0;i<e.length;i++)n.remove(e[i],"first-time");2===t&&(U=lt(e).animate(["fade-in-animation","move-down-animation"]));for(var o=0;o<it.length;o++)n.remove(it[o],"first-time swipe-left-in swipe-left-out swipe-right-out swipe-right-in");for(U=t<I()?lt(it).animate(["swipe-right-out","swipe-right-in"],A):lt(it).animate(["swipe-left-out","swipe-left-in"],A),o=-1;++o<it.length;)M(it[o])}else it[t].querySelector(Z).innerHTML=st[t].title.replace(/'/g,"&#146;"),it[t].querySelector(Q).innerHTML=st[t].body.replace(/'/g,"&#146;");T(t)}function M(t){var e=t.style.display,i=t.getAttribute("style");t.style.display="none",t.setAttribute("style","");t.offsetHeight;t.style.display=e,null!==i&&t.setAttribute("style",i)}function D(){if(F.onboarding.carousel){var t=document.querySelector(F.onboarding.selector);n.add(t,"hidden"),F.onboarding.carousel.slide(0,0),F.onboarding.config=at.carousels.onboarding.config,F.onboarding.carousel.kill(),F.onboarding.carousel=void 0}F.onboardingParent.config=at.carousels.onboardingParent.config,F.onboardingParent.carousel.kill(),T(0),V=!1,ot=!1,U&&U.unbindAll();for(var e=0;e<it.length;e++)it[e].className="",n.add(it[e],"notifications-carousel__content notifications-carousel__content--js"),it[e].querySelector(Z).innerHTML=st[0].title.replace(/'/g,"&#146;"),it[e].querySelector(Q).innerHTML=st[0].body.replace(/'/g,"&#146;"),M(it[e]);n.add(it[0],"first-time"),n.remove(X,"enter-animation"),d(),P(),M(X)}function O(t,e){var i=F.onboarding.carousel;e===i.getNumSlides()-1&&t===i.getNumSlides()-1&&(C(),F.onboardingParent.carousel.next())}var q,F,R,H,U,B,z=new e,G=new o("Onboarding"),V=!1,W=0,J=!0,K=700,X=document.querySelector(".notifications-favourites--preview"),Y=document.getElementById("notifications-main"),$=document.getElementById("notification-link"),Z=".notifications-carousel__header--js p",Q=".notifications-carousel__description--js p",tt=".notifications-main-header__are-you-ready--js",et=document.getElementById("not-num"),it=(document.querySelector(Z),document.querySelector(Q),document.querySelectorAll(".notifications-carousel__content--js")),nt=document.querySelectorAll(".first-time"),ot=!1,at={carousels:{onboardingParent:{selector:".notifications-onboarding-parent-carousel--js",config:{speed:K,easing:"easeInOutExpo",continuous:!1,draggable:!1,touchEvents:!1}},onboarding:{selector:".notifications-onboarding-carousel--js",config:{indicatorSelector:".notifications-carousel-pages__link--js",controlsSelector:".notifications-carousel__controls--js",speed:0,continuous:!1,draggable:!1}}}},st=[{title:"Notifications appear here",body:"For example when a new episode of your favourite programme is available to watch, or a new music clip has been added by the artist you follow."},{title:"You'll receive a notification...",body:"...when you add your favourite programme, a music artist, playlist, and in future much more."},{title:"Stay up to date",body:"You will get notifications whenever there's something new."},{title:"You're in charge",body:"You can manage the notifications you receive in settings."}],rt={onboardingParentCasouselSlideChangeFinished:function(t,e){var i={1:Z,2:tt};ct.setCarouselSlideFocus("onboardingParent",i[t])},onboardingParentCasouselSlideChanged:function(t,e){var i=t,o=1===i&&"undefined"==typeof F.onboarding.carousel;o&&S(),2==t&&n.remove(e.querySelector(".on-boarding--js"),"hidden"),x()},onboardingCasouselSlideChanged:function(t,e){j(t)},onBoardingCarouselControlClicked:function(t,e,i){var n=this.getAttribute("data-slide");"next"===n&&O(e,i)},onBoardingCarouselSwiped:function(t,e,i){"right"==i&&O(t,e)}},ct=function(){function e(t){var e=t.which||t.keyCode;e==f?l=Date.now():e==u&&(d=Date.now())}function i(t){var e=t.which||t.keyCode;e==u&&t.shiftKey&&(t.preventDefault?t.preventDefault():t.returnValue=!1,q.navNotificationElement.click(),q.navNotificationElement.focus())}function n(t){var e=t.which||t.keyCode;e!=u||t.shiftKey||(t.preventDefault?t.preventDefault():t.returnValue=!1,c.setCarouselSlideFocus("onboarding",Z,!1))}var o,a,s,r,c={},l=Date.now(),d=Date.now(),f=13,u=9,h=2e3;return c.checkInitialFocus=function(){o=document.querySelector(F.onboardingParent.selector+" .notifications-main-header__first--js"),a=document.querySelector(F.onboardingParent.selector+" "+tt),s=document.querySelector(F.onboardingParent.selector+" .notifications-description__first--js"),r=document.querySelectorAll(F.onboardingParent.selector+" .notifications-carousel__controls--skip__link--js");var t=Date.now();"undefined"!=typeof q.navNotificationElement.lastEnterPress&&t-q.navNotificationElement.lastEnterPress<h&&o.focus()},c.setCarouselSlideFocus=function(t,e,i){i=i!==!1;var n=Date.now();if(!(i&&n-l>=h))return"onboarding"==t?F[t].carousel.getActiveSlideEl().querySelector(e).focus():void document.querySelector(F[t].selector+" "+e).focus()},c.startListeners=function(){t.addEvent(document.querySelector(F.onboardingParent.selector),"keydown",e),t.addEvent(o,"keydown",i),t.addEvent(a,"keydown",i),z.forEach([].slice.call(document.querySelectorAll(Z)),function(e){t.addEvent(e,"keydown",i)}),z.forEach([].slice.call(r),function(e){t.addEvent(e,"keydown",n)})},c.stopListeners=function(){t.removeEvent(document.querySelector(F.onboardingParent.selector),"keydown",e),t.removeEvent(o,"keydown",i),t.removeEvent(a,"keydown",i),z.forEach([].slice.call(document.querySelectorAll(Z)),function(e){t.removeEvent(e,"keydown",i)}),z.forEach([].slice.call(r),function(e){t.removeEvent(e,"keydown",n)})},c}(),lt=function(e){function i(){var t=document.createElement("fakeelement"),e={animation:"animationend",MozAnimation:"mozAnimationEnd",webkitAnimation:"webkitAnimationEnd",msAnimation:"msAnimationEnd"};for(var i in e)if("undefined"!=typeof t.style[i])return e[i]}function o(t,e,i){this.els=t,this.callback=i,this.classList=e}return e.length?(o.prototype={getElementNextAnimationClassInfo:function(t){for(var e=!1,i=0;i<this.classList.length;i++)if(!n.has(t,this.classList[i])){e=!0;break}return e?{index:i,className:this.classList[i]}:null},animationEndCallback:function(e){t.removeEvent(e.target,i(),this.animationEndCallbackBind);var o=this.getElementNextAnimationClassInfo(e.target);null!==o&&(o.index<this.classList.length-1&&t.addEvent(e.target,i(),this.animationEndCallbackBind),n.add(e.target,o.className)),this.callback&&this.callback.call(null,e)},start:function(){var e=-1;for(this.animationEndCallbackBind=z.bind(this.animationEndCallback,this);++e<this.els.length;)n.remove(this.els[e],this.classList.join(" ")),t.addEvent(this.els[e],i(),this.animationEndCallbackBind),n.add(this.els[e],this.classList[0])},unbindAll:function(){for(var e=-1;++e<this.els.length;)t.removeEvent(this.els[e],i(),this.animationEndCallbackBind)}},{animate:function(t,i){var n=new o(e,t,i);return n.start(),n}}):void G.error("No elements passed to sequencedAnimations")},dt={panelOpenAnimationEnd:m,init:function(t){a(t)},getCarousel:function(t){return F[t]},initialised:V,resetOnboarding:D,removeCustomHeights:b};return dt}),function(t){function e(t){var e={val:t},i=t.split(/\s+in\s+/);return i[1]&&(e.val=S(0)+i[1],i=i[0].slice(S(0).length).trim().split(/,\s*/),e.key=i[0],e.pos=i[1]),e}function i(t,e,i){var n={};return n[t.key]=e,t.pos&&(n[t.pos]=i),n}function n(t,n,o){function a(t,e,i){h.splice(t,0,e),p.splice(t,0,i)}f(t,"each");var r,c=t.outerHTML,l=t.previousSibling,u=t.parentNode,h=[],p=[];o=e(o),n.one("update",function(){u.removeChild(t)}).one("premount",function(){u.stub&&(u=n.root)}).on("update",function(){var t=I(o.val,n);if(t){if(!Array.isArray(t)){var e=JSON.stringify(t);if(e==r)return;r=e,d(p,function(t){t.unmount()}),h=[],p=[],t=Object.keys(t).map(function(e){return i(o,e,t[e])})}d(h,function(e){if(e instanceof Object){if(t.indexOf(e)>-1)return}else{var i=y(t,e),n=y(h,e);if(i.length>=n.length)return}var o=h.indexOf(e),a=p[o];return a?(a.unmount(),h.splice(o,1),p.splice(o,1),!1):void 0});var f=[].indexOf.call(u.childNodes,l)+1;d(t,function(e,l){var d=t.indexOf(e,l),g=h.indexOf(e,l);if(0>d&&(d=t.lastIndexOf(e,l)),0>g&&(g=h.lastIndexOf(e,l)),!(e instanceof Object)){var m=y(t,e),v=y(h,e);m.length>v.length&&(g=-1)}var b=u.childNodes;if(0>g){if(!r&&o.key)var w=i(o,e,d);var _=new s({tmpl:c},{before:b[f+d],parent:n,root:u,item:w||e});return _.mount(),a(d,e,_),!0}return o.pos&&p[g][o.pos]!=d&&(p[g].one("update",function(t){t[o.pos]=d}),p[g].update()),d!=g?(u.insertBefore(b[f+g],b[f+(d>g?d+1:d)]),a(d,h.splice(g,1)[0],p.splice(g,1)[0])):void 0}),h=t.slice()}})}function o(t,e,i){m(t,function(t){if(1==t.nodeType){t.parentNode&&t.parentNode.isLoop&&(t.isLoop=1),t.getAttribute("each")&&(t.isLoop=1);var n=_(t);if(n&&!t.isLoop){for(var o,a=new s(n,{root:t,parent:e},t.innerHTML),r=n.name,c=e;!_(c.root)&&c.parent;)c=c.parent;a.parent=c,o=c.tags[r],o?(Array.isArray(o)||(c.tags[r]=[o]),c.tags[r].push(a)):c.tags[r]=a,t.innerHTML="",
i.push(a)}d(t.attributes,function(i){/^(name|id)$/.test(i.name)&&(e[i.value]=t)})}})}function a(t,e,i){function o(t,e,n){if(e.indexOf(S(0))>=0){var o={dom:t,expr:e};i.push(u(o,n))}}m(t,function(t){var i=t.nodeType;if(3==i&&"STYLE"!=t.parentNode.tagName&&o(t,t.nodeValue),1==i){var a=t.getAttribute("each");return a?(n(t,e,a),!1):(d(t.attributes,function(e){var i=e.name,n=i.split("__")[1];return o(t,e.value,{attr:n||i,bool:n}),n?(f(t,i),!1):void 0}),_(t)?!1:void 0)}})}function s(t,e,i){function n(){d(Object.keys(x),function(t){f[t]=I(x[t],p||c)})}function s(t){if(d(b,function(e){e[t?"mount":"unmount"]()}),p){var e=t?"on":"off";p[e]("update",c.update)[e]("unmount",c.unmount)}}var r,c=C.observable(this),f=w(e.opts)||{},h=g(t.tmpl),p=e.parent,m=[],b=[],y=e.root,_=e.item,E=t.fn,k=y.tagName.toLowerCase(),x={};E&&y._tag&&y._tag.unmount(!0),y._tag=this,this._id=~~((new Date).getTime()*Math.random()),u(this,{parent:p,root:y,opts:f,tags:{}},_),d(y.attributes,function(t){x[t.name]=t.value}),h.innerHTML&&!/select/.test(k)&&(h.innerHTML=v(h.innerHTML,i)),this.update=function(t,e){u(c,t,_),n(),c.trigger("update",_),l(m,c,_),c.trigger("updated")},this.mount=function(){if(n(),E&&E.call(c,f),s(!0),a(h,c,m),c.parent||c.update(),c.trigger("premount"),E)for(;h.firstChild;)y.appendChild(h.firstChild);else r=h.firstChild,y.insertBefore(r,e.before||null);y.stub&&(c.root=y=p.root),c.trigger("mount")},this.unmount=function(t){var e=E?y:r,i=e.parentNode;if(i){if(p)Array.isArray(p.tags[k])?d(p.tags[k],function(t,e){t._id==c._id&&p.tags[k].splice(e,1)}):delete p.tags[k];else for(;e.firstChild;)e.removeChild(e.firstChild);t||i.removeChild(e)}c.trigger("unmount"),s(),c.off("*"),y._tag=null},o(h,this,b)}function r(e,i,n,o,a){n[e]=function(e){e=e||t.event,e.which=e.which||e.charCode||e.keyCode,e.target=e.target||e.srcElement,e.currentTarget=n,e.item=a,i.call(o,e)===!0||/radio|check/.test(n.type)||(e.preventDefault&&e.preventDefault(),e.returnValue=!1);var s=a?o.parent:o;s.update()}}function c(t,e,i){t&&(t.insertBefore(i,e),t.removeChild(e))}function l(t,e,i){d(t,function(t,n){var o=t.dom,a=t.attr,s=I(t.expr,e),l=t.dom.parentNode;if(null==s&&(s=""),l&&"TEXTAREA"==l.tagName&&(s=s.replace(/riot-/g,"")),t.value!==s){if(t.value=s,!a)return o.nodeValue=s;if(f(o,a),"function"==typeof s)r(a,s,o,e,i);else if("if"==a){var d=t.stub;s?d&&c(d.parentNode,d,o):(d=t.stub=d||document.createTextNode(""),c(o.parentNode,o,d))}else if(/^(show|hide)$/.test(a))"hide"==a&&(s=!s),o.style.display=s?"":"none";else if("value"==a)o.value=s;else if("riot-"==a.slice(0,5))a=a.slice(5),s?o.setAttribute(a,s):f(o,a);else{if(t.bool){if(o[a]=s,!s)return;s=a}"object"!=typeof s&&o.setAttribute(a,s)}}})}function d(t,e){for(var i,n=0,o=(t||[]).length;o>n;n++)i=t[n],null!=i&&e(i,n)===!1&&n--;return t}function f(t,e){t.removeAttribute(e)}function u(t,e,i){return e&&d(Object.keys(e),function(i){t[i]=e[i]}),i?u(t,i):t}function h(){if(t){var e=navigator.userAgent,i=e.indexOf("MSIE ");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):0}}function p(t,e){var i=document.createElement("option"),n=/value=[\"'](.+?)[\"']/,o=/selected=[\"'](.+?)[\"']/,a=e.match(n),s=e.match(o);i.innerHTML=e,a&&(i.value=a[1]),s&&i.setAttribute("riot-selected",s[1]),t.appendChild(i)}function g(t){var e=t.trim().slice(1,3).toLowerCase(),i=/td|th/.test(e)?"tr":"tr"==e?"tbody":"div",n=document.createElement(i);return n.stub=!0,"op"===e&&x&&10>x?p(n,t):n.innerHTML=t,n}function m(t,e){if(t)if(e(t)===!1)m(t.nextSibling,e);else for(t=t.firstChild;t;)m(t,e),t=t.nextSibling}function v(t,e){return t.replace(/<(yield)\/?>(<\/\1>)?/gim,e||"")}function b(t,e){return e=e||document,e.querySelectorAll(t)}function y(t,e){return t.filter(function(t){return t===e})}function w(t){function e(){}return e.prototype=t,new e}function _(t){return A[t.getAttribute("riot-tag")||t.tagName.toLowerCase()]}function E(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e)}function k(t,e,i){var n=A[e],o=t.innerHTML;return t.innerHTML="",n&&t&&(n=new s(n,{root:t,opts:i},o)),n&&n.mount?(n.mount(),T.push(n),n.on("unmount",function(){T.splice(T.indexOf(n),1)})):void 0}var C={version:"v2.0.15",settings:{}},x=h();C.observable=function(t){t=t||{};var e={},i=0;return t.on=function(n,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?i++:o._id,n.replace(/\S+/g,function(t,i){(e[t]=e[t]||[]).push(o),o.typed=i>0})),t},t.off=function(i,n){return"*"==i?e={}:i.replace(/\S+/g,function(t){if(n)for(var i,o=e[t],a=0;i=o&&o[a];++a)i._id==n._id&&(o.splice(a,1),a--);else e[t]=[]}),t},t.one=function(e,i){function n(){t.off(e,n),i.apply(t,arguments)}return t.on(e,n)},t.trigger=function(i){for(var n,o=[].slice.call(arguments,1),a=e[i]||[],s=0;n=a[s];++s)n.busy||(n.busy=1,n.apply(t,n.typed?[i].concat(o):o),a[s]!==n&&s--,n.busy=0);return e.all&&"all"!=i&&t.trigger.apply(t,["all",i].concat(o)),t},t},function(t,e,i){function n(){return r.href.split("#")[1]||""}function o(t){return t.split("/")}function a(t){t.type&&(t=n()),t!=s&&(c.trigger.apply(null,["H"].concat(o(t))),s=t)}if(i){var s,r=i.location,c=t.observable(),l=i,d=!1,f=t.route=function(t){t[0]?(r.hash=t,a(t)):c.on("H",t)};f.exec=function(t){t.apply(null,o(n()))},f.parser=function(t){o=t},f.stop=function(){d&&(l.removeEventListener?l.removeEventListener(e,a,!1):l.detachEvent("on"+e,a),c.off("*"),d=!1)},f.start=function(){d||(l.addEventListener?l.addEventListener(e,a,!1):l.attachEvent("on"+e,a),d=!0)},f.start()}}(C,"hashchange",t);var S=function(t,e,i){return function(n){return e=C.settings.brackets||t,i!=e&&(i=e.split(" ")),n&&n.test?e==t?n:RegExp(n.source.replace(/\{/g,i[0].replace(/(?=.)/g,"\\")).replace(/\}/g,i[1].replace(/(?=.)/g,"\\")),n.global?"g":""):i[n]}}("{ }"),I=function(){function e(t,e){return t=(t||S(0)+S(1)).replace(S(/\\{/g),"ï¿°").replace(S(/\\}/g),"ï¿±"),e=o(t,a(t,S(/{/),S(/}/))),new Function("d","return "+(e[0]||e[2]||e[3]?"["+e.map(function(t,e){return e%2?i(t,!0):'"'+t.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':i(e[1])).replace(/\uFFF0/g,S(0)).replace(/\uFFF1/g,S(1))+";")}function i(t,e){return t=t.replace(/\n/g," ").replace(S(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(t)?"["+a(t,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(t){return t.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(t,e,i){return i.replace(/[^&|=!><]+/g,n)+'?"'+e+'":"",'})}).join("")+'].join(" ").trim()':n(t,e)}function n(e,i){return e=e.trim(),e?"(function(v){try{v="+(e.replace(r,function(e,i,n){return n?"(d."+n+"===undefined?"+("undefined"==typeof t?"global.":"window.")+n+":d."+n+")":e})||"x")+"}finally{return "+(i===!0?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}function o(t,e){var i=[];return e.map(function(e,n){n=t.indexOf(e),i.push(t.slice(0,n),e),t=t.slice(n+e.length)}),i.concat(t)}function a(t,e,i){var n,o=0,a=[],s=new RegExp("("+e.source+")|("+i.source+")","g");return t.replace(s,function(e,i,s,r){!o&&i&&(n=r),o+=i?1:-1,o||null==s||a.push(t.slice(n,r+s.length))}),a}var s={},r=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(t,i){return t&&(s[t]=s[t]||e(t))(i)}}(),T=[],A={};C.tag=function(t,e,i,n){return"function"==typeof i?n=i:i&&E(i),A[t]={name:t,tmpl:e,fn:n},t},C.mount=function(t,e,i){function n(t){var n=e||t.getAttribute("riot-tag")||t.tagName.toLowerCase(),o=k(t,n,i);o&&s.push(o)}var o,a=function(t){return t=Object.keys(A).join(", "),t.split(",").map(function(e){t+=', *[riot-tag="'+e.trim()+'"]'}),t},s=[];if("object"==typeof e&&(i=e,e=0),"string"==typeof t?("*"==t&&(t=a(t)),o=b(t)):o=t,"*"==e){if(e=a(t),o.tagName)o=b(e,o);else{var r=[];d(o,function(t){r=b(e,t)}),o=r}e=0}return o.tagName?n(t):d(o,n),s},C.update=function(){return d(T,function(t){t.update()})},C.mountTo=C.mount,C.util={brackets:S,tmpl:I},"object"==typeof exports?module.exports=C:"function"==typeof define&&define.amd?define("mybbc/notifications/vendor/riot.min",[],function(){return C}):t.riot=C}("undefined"!=typeof window?window:void 0),define("mybbc/notifications/config",[],function(){var t={feedBaseUrl:"//notifications.files.bbci.co.uk/",feedAggregatedInitialFeed:"latest.json",feedTopicInitialFeed:"latest.json",feedTopicMaxSubscriptions:-1,preferencesUrls:{get:"https://preferences.notifications.api.bbc.co.uk/subscriptions",postPreference:"https://preferences.notifications.api.bbc.co.uk/preference",postPreferenceRelay:"https://preferences.notifications.api.bbc.co.uk/preference/relay"},idcta:{urls:{signin:"https://ssl.bbc.co.uk/id/signin",register:"https://ssl.bbc.co.uk/id/register"}},notificationsPollingInterval:6e4,preferencesPollingInterval:6e4,lockExpiry:3e4,cacheTimeout:6e5,visibleChunkAmount:10,maxNotificationAge:5},e={env:t};return e}),function(t){function e(t,e){var i;"number"!=typeof t&&(i=t,t=32*i.length);var n=Math.ceil(t/32),o=-1;if(this.m=t=32*n,this.k=e,a){var s=1<<Math.ceil(Math.log(Math.ceil(Math.log(t)/Math.LN2/8))/Math.LN2),r=1===s?Uint8Array:2===s?Uint16Array:Uint32Array,c=new ArrayBuffer(s*e),l=this.buckets=new Int32Array(n);if(i)for(;++o<n;)l[o]=i[o];this._locations=new r(c)}else{var l=this.buckets=[];if(i)for(;++o<n;)l[o]=i[o];else for(;++o<n;)l[o]=0;this._locations=[]}}function i(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function n(t){for(var e,i,n=t.length,o=2166136261,a=-1;++a<n;)e=t.charCodeAt(a),(i=4278190080&e)&&(o^=i>>24,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=16711680&e)&&(o^=i>>16,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),(i=65280&e)&&(o^=i>>8,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24)),o^=255&e,o+=(o<<1)+(o<<4)+(o<<7)+(o<<8)+(o<<24);return o+=o<<13,o^=o>>7,o+=o<<3,o^=o>>17,o+=o<<5,4294967295&o}function o(t){return t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24),t+=t<<13,t^=t>>7,t+=t<<3,t^=t>>17,t+=t<<5,4294967295&t}t.BloomFilter=e,t.fnv_1a=n,t.fnv_1a_b=o;var a="undefined"!=typeof ArrayBuffer;e.prototype.locations=function(t){for(var e=this.k,i=this.m,a=this._locations,s=n(t),r=o(s),c=-1,l=s%i;++c<e;)a[c]=0>l?l+i:l,l=(l+r)%i;return a},e.prototype.add=function(t){for(var e=this.locations(t+""),i=-1,n=this.k,o=this.buckets;++i<n;)o[Math.floor(e[i]/32)]|=1<<e[i]%32},e.prototype.test=function(t){for(var e,i=this.locations(t+""),n=-1,o=this.k,a=this.buckets;++n<o;)if(e=i[n],0===(a[Math.floor(e/32)]&1<<e%32))return!1;return!0},e.prototype.size=function(){for(var t=this.buckets,e=0,n=0,o=t.length;o>n;++n)e+=i(t[n]);return-this.m*Math.log(1-e/this.m)/this.k},define("mybbc/notifications/vendor/bloomfilter",[],function(){return e})}("undefined"!=typeof exports?exports:this),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/BloomFilterManager",["mybbc/notifications/vendor/bloomfilter","mybbc/notifications/logger","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("vendor/bloomfilter"),require("logger"),require("utils")):t.BloomFilterManager=e(bloomfilter,logger,utils)}(this,function(t,e,i){var n=(new e("Bloom Filter Manager"),new i),o=8192,a=function(e){this.filterName=e,this.filter=new t(o,16)};return a.prototype.override=function(e){"string"==typeof e&&""!==e&&(e=n.handledParse(e,[])),n.isArray(e)&&0===e.length&&(e=o),this.filter=new t(e,16)},a.prototype.add=function(t){t&&""!==t&&this.filter.add(t)},a.prototype.getCleanArray=function(){return[].slice.call(this.filter.buckets)},a.prototype.contains=function(t){return t&&""!==t?this.filter.test(t):!1},a.prototype.checkOrAdd=function(t){t&&""!==t&&(this.contains(t)||this.add(t))},a}),define("mybbc/notifications/AccessibilityManager",["require","mybbc/notifications/eventie","mybbc/notifications/classie"],function(t){function e(t,e,i,n){var o=t.cloneNode(!0);return o.firstChild.innerHTML=e,o.firstChild.tabIndex=-1,o.firstChild.setAttribute("href","#"+i),o.firstChild.setAttribute("data-type",i),o.id=i,V.addEvent(o.firstChild,"click","function"==typeof n?function(){n.apply(w,arguments)}:function(){a(),k.focus(),E.tabIndex="0",setTimeout(function(){M.children[0].onblur=function(t){G||E.click()},k.focus()},1)}),o}function i(t){var i=document.querySelector(".orb-skip-links ul"),n=i.children[0];i.appendChild(e(n,"Load next","notifications-loadNext",t.nextActionCallback)),i.appendChild(e(n,"Go to top","notifications-gotoTop",t.gotoTopActionCallback)),i.appendChild(e(n,"Close","notifications-close")),D=document.querySelector(".notification-title"),q=document.querySelector(".notification-header-icons a"),F=document.getElementById("notifications-loadNext"),R=document.getElementById("notifications-gotoTop"),M=document.getElementById("notifications-close"),E=document.getElementById("notification-link")||{},k=document.querySelector("#orb-nav-links .orb-nav-news a")||{},x=document.querySelector(".notification-header-icons li a")||{},S=".notification-item",j=t._getdrawerStateChecker,T=t._getNotificationCollection,A=t.nextActionCallback,P=t.gotoTopActionCallback,L=t.closeActionCallback,t.iconHiddenTextEl&&(U=t.iconHiddenTextEl),t.iconAriaLiveEl&&(B=t.iconAriaLiveEl),z=j(),p(),o()}function n(t){O=document.querySelector(t),O&&(O.onfocus=function(t){var e=document.querySelector(".show .notifications-error__body");l(e),x.tabIndex=document.activeElement.tabIndex+1,E.tabIndex=document.activeElement.tabIndex})}function o(){E.onclick=function(t){_=!0,"hidden"!=z()&&("disabled"==J&&p(),l(O?O:D),document.activeElement==E?(x.tabIndex=1,x.focus(),a(),N=I=0,E.tabIndex=0):(document.activeElement.blur(),N=document.activeElement.tabIndex,I=N+1,x.tabIndex=I>0?I:1))},E.onfocus=function(t){"shown"!=z()||_||(E.click(),y(),E.tabIndex=null,_=!1)},D.onfocus=function(t){var e=q;l(e),x.tabIndex=document.activeElement.tabIndex+1,E.tabIndex=document.activeElement.tabIndex},q.onfocus=function(t){H=document.querySelector(S);var e=H;l(e)},s()}function a(){document.getElementById(F.id).children[0].tabIndex=-1,document.getElementById(R.id).children[0].tabIndex=-1,document.getElementById(M.id).children[0].tabIndex=-1}function s(){M.children[0].onblur=function(t){G||E.click()},M.children[0].onfocus=function(t){k.tabIndex=1},R.onfocus=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1,x.focus()}}function r(t,e){switch(e){case"notifications-loadNext":"function"==typeof A&&A();break;case"notifications-gotoTop":"function"==typeof P&&P();break;case"notifications-close":M.children[0].onblur=null,k.focus(),E.tabIndex=null,setTimeout(function(){M.children[0].onblur=function(t){G||E.click()}},1e3),"function"==typeof L&&L()}}function c(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName}function l(t){c(t)&&(x=t)}function d(t){"undefined"!=typeof U&&(U.textContent=t)}function f(t){"undefined"!=typeof B&&(B.textContent=t)}function u(){return w={init:i,updateNextFocus:l,handleNotificationAccessClickEnterEvent:r,initAccessLinkEvents:s,checkIfLastInList:v,accessLinkEntered:!1,clearAccessLinkFocus:a,setErrorTitle:n,updateIconHiddenText:d,updateIconAriaLiveText:f}}function h(){return w||u()}function p(){V.addEvent(window,"keyup",g),V.addEvent(window,"keydown",m),null===k.onfocus&&(k.onfocus=function(t){N=0,this.tabIndex=0,y()}),J="enabled"}function g(t){if(t.preventDefault&&t.preventDefault(),9===t.keyCode){if(document.activeElement===k)return void y();N=document.activeElement.tabIndex,I=N+1,setTimeout(function(){v()},1)}}function m(t){return G=!1,t.shiftKey&&9===t.keyCode&&(G=!0,(document.activeElement==D||document.activeElement==O)&&(G=!1,E.click(),E.tabIndex="0",k.tabIndex="1",k.focus(),y())),t.shiftKey||9!==t.keyCode||"#notifications-close"!==document.activeElement.getAttribute("href")?void(13==t.keyCode&&W.has(document.activeElement,"notification-item")&&document.activeElement.click()):(t.preventDefault(),!1)}function v(){var t=function(){var t=document.activeElement.nextSibling;return null!==t&&"div"==t.nodeName.toLowerCase()&&"no-notifications"==t.id};if(t()){switch(b()){case"02":l(document.getElementById(F.id)),F.firstElementChild.text="Load next",document.getElementById(R.id).firstElementChild.tabIndex=I+1,R.firstElementChild.text="Go to top",document.getElementById(M.id).firstElementChild.tabIndex=I+2;break;case"2":l(document.getElementById(R.id)),document.getElementById(M.id).firstElementChild.tabIndex=I+1,document.getElementById(F.id).firstElementChild.tabIndex=-1}x.firstElementChild&&(x.firstElementChild.tabIndex=I)}}function b(){var t="";return T().allPagesLoaded()||(t+="0"),t+="2"}function y(){k.onfocus=null,V.removeEvent(window,"keyup",g),V.removeEvent(window,"keydown",m),clearInterval(C),J="disabled"}var w,_,E,k,C,x,S,I,T,A,P,L,N,j,M,D,O,q,F,R,H,U,B,z,G=!1,V=t("mybbc/notifications/eventie"),W=t("mybbc/notifications/classie"),J="disabled";return{getInstance:h}}),function(t){function e(t){return function(t){return t.getHours()+":"+(t.getMinutes().toString().length<2?"0":"")+t.getMinutes()}(new Date(t))}function i(t){return l[new Date(t).getDay()]}function n(t){return d.toDateString()===new Date(t).toDateString()}function o(t){return 1==a(t)}function a(t){return new Date(t).getDay()-d.getDay()}function s(t){var e=new Date;return e.setDate(e.getDate()-t),e}function r(t){t instanceof Date==!1&&(t=new Date(t));var e=Math.abs(t.getTime()-d.getTime());return Math.ceil(e/864e5)}function c(t){d=new Date(t)}var l=new Array("Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"),d=new Date,f={getClockTime:e,getWeekday:i,isToday:n,isTomorrow:o,getDayDifference:a,howOld:r,goBackDays:s,setTime:c,serverTime:d};"undefined"!=typeof define&&define.amd?define("mybbc/notifications/DateManager",[],function(){return f}):"undefined"!=typeof f?module.exports=f:t.DateManager=f}(this),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/PreferencesClient",["require","mybbc/notifications/logger","mybbc/notifications/utils"],function(t){var i=new(t("mybbc/notifications/logger"))("Preferences Client"),n=new(t("mybbc/notifications/utils"))(i);return e(n,i)}):"undefined"!=typeof exports?module.exports=e():t.PreferencesClient=e()}(this,function(t,e){var i=function(e,n){this.requestClient=e,this.settings=t.extend(i.defaults,n),this._setRequestMap(this._getConfig()),this.setLastRequestInfo({error:!1})};return i.defaults={},i.prototype={fetch:function(t){this.callback=t,this._call(this._isCORSBrowser()?"get":"getJSONP",{},this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())},updatePreferences:function(t,e){return this._preferencesDataValid(t)?(this.callback=e,void this._call(this._isCORSBrowser()?"postPreference":"postPreferenceRelay",t,this._preferencesRequestSuccessCallback(),this._preferencesRequestErrorCallback())):null},_isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},_call:function(t,e,i,n){var o=this._getRequestParams(t);"undefined"!=typeof e&&(o.data=e),"postRelay"===o.dataType&&(o.callback=this.callback),req=this.requestClient.create(o),req.done(i).fail(n).send()},_getRequestParams:function(t){return t in this.requestMap?this.requestMap[t]:{}},_setRequestMap:function(t){this.requestMap={get:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"json"},getJSONP:{url:t.env.preferencesUrls.get,useCookies:!0,ignoreHeaders:!0,dataType:"jsonp",jsonpCallback:"preferencesCallback"+Date.now()},postPreference:{type:"POST",url:t.env.preferencesUrls.postPreference,useCookies:!0,ignoreHeaders:!0,dataType:"json",contentType:"application/json"},postPreferenceRelay:{type:"POST",url:t.env.preferencesUrls.postPreferenceRelay,useCookies:!0,ignoreHeaders:!0,dataType:"postRelay",contentType:"application/json"}}},_preferencesRequestSuccessCallback:function(){var i=this;return function(n){var o,a,s,r=arguments.length>0?Array.prototype.slice.call(arguments):[];r.unshift(null);try{o="object"==typeof n?n:t.handledParse(""===n?"{}":n),s="status"in o&&200!=o.status,s&&(a="preferences.jsonp.call.error."+o.status,e.error(a),i.setLastRequestInfo({error:!0,info:a})),"function"==typeof i.callback&&(i.callback.call(i,null,o.response||o),i.setLastRequestInfo({error:!1,info:o.response||o}))}catch(c){e.error("Error caught after fetching preferences",c),"function"==typeof i.callback&&i.callback.call(i,!0,c),i.setLastRequestInfo({error:!0,info:c})}}},_preferencesRequestErrorCallback:function(){var t=this;return function(e,i,n){var o=arguments.length>0?Array.prototype.slice.call(arguments):[];o.unshift(!0),t.setLastRequestInfo({error:!0,info:o}),"function"==typeof t.callback&&t.callback.apply(t,o)}},getLastRequestInfo:function(){return this.lastRequestInfo},setLastRequestInfo:function(t){this.lastRequestInfo=t},_isCORSBrowser:function(){return this._isXHRCorsSupported()&&-1===window.navigator.userAgent.indexOf("Automated Test UserAgent")},_preferencesDataValid:function(t){var i="undefined"!=typeof t&&"undefined"!=typeof t.readFilter&&"undefined"!=typeof t.lastReadFlag;return i||e.error("Preferences data validation failed",t),i},_getConfig:function(){return this.settings.config||{}}},i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/LocalStorageCache",e):"undefined"!=typeof exports?module.exports=e():t.LocalStorageCache=e()}(this,function(){function t(){return!!NotificationsModernizr.localstorage}var e=function(e){var i="mybbc_notifications_";return{get:function(){return t()?localStorage.getItem(i.concat(e)):null},put:function(n){t()&&localStorage.setItem(i.concat(e),n)},clear:function(){t()&&localStorage.removeItem(i.concat(e))}}};return e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/StorageManager",["mybbc/notifications/config","mybbc/notifications/utils","mybbc/notifications/LocalStorageCache"],e):"undefined"!=typeof exports?module.exports=e():t.StorageManager=e()}(this,function(t,e,i){var n=new e,o=function(t){this.storeKey=t,this.storeKeyCache=i(this.storeKey),this.lockCache=i("lockPolling"),this.initialised=!1};return o.prototype={model:{cacheTimeout:null,preferences:null,subscriptions:null},isEnabledLocalStorage:function(){return!!NotificationsModernizr.localstorage},init:function(){this.params={cacheTimeout:t.env.cacheTimeout,cachedData:this.getCached(),preferencesPollingInterval:this.isEnabledLocalStorage()?t.env.preferencesPollingInterval:2*t.env.preferencesPollingInterval},this.initialised=!0},getCached:function(){var t=this.get();return"object"!=typeof t&&""!==t&&null!==t?n.handledParse(t,this.model):t},hasCache:function(){return this.getCached()!==this.model},checkExpired:function(){return this.hasExpired(this.params.cachedData)},lock:function(e){this.lockCache.put(JSON.stringify({locked:e,timestamp:Date.now()+t.env.lockExpiry}))},unlock:function(){this.lock(!1)},get:function(t){var e=this.storeKeyCache.get();return e=e?n.handledParse(e,this.model):this.model,t&&delete e.cacheTimeout,e},clear:function(){this.storeKeyCache.clear(),this.lockCache.clear(),this.init()},set:function(t){var e=this.clone(t);(!e||"string"==typeof e&&""===e)&&(e=this.model),e.cacheTimeout||(e.cacheTimeout=Date.now()+this.params.cacheTimeout),this.storeKeyCache.put(JSON.stringify(e)),this.unlock(),this.params.cachedData=this.getCached()},hasExpired:function(t){return this.isEnabledLocalStorage()?!t.cacheTimeout||new Date-new Date(t.cacheTimeout)>=0:!0},isLocked:function(){if(!this.isEnabledLocalStorage())return!1;var t=this.lockCache.get();return t=t?n.handledParse(t,{locked:!1,timestamp:Date.now()}):{locked:!1,timestamp:Date.now()},new Date-new Date(t.timestamp)>=0?(this.unlock(),!1):t.locked},clone:function(t){if(null===t||"object"!=typeof t)return t;var e=t.constructor();for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/UserPreferences",["require","mybbc/notifications/StorageManager","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/DateManager"],function(t){var i=t("mybbc/notifications/StorageManager"),n=new(t("mybbc/notifications/logger"))("UserPreferences"),o=new(t("mybbc/notifications/utils"))(n),a=t("mybbc/notifications/DateManager");return e(i,o,n,a)}):"undefined"!=typeof exports?module.exports=e(require("StorageManager"),require("utils"),require("logger"),require("dateManager")):t.UserPreferences=e(StorageManager,utils,logger,dateManager)}(this,function(t,e,i,n){var o=function(i){this.settings=i,this.client=i.client,this.idcta=i.idcta,this.cacheManager=i.cacheManager||new t("cachedPreferences"),this.cacheManager.initialised||this.cacheManager.init(),this.defaultAttributes={subscriptions:[],preferences:{lastRead:n.goBackDays(this.client._getConfig().env.maxNotificationAge).toISOString(),readFilter:this.settings.filter.getCleanArray(),productsEnabled:o.defaultProductsEnabled}},this.attributes=e.extend(this.defaultAttributes),this.setFetchLastCallInfo({error:!1})};return o.defaultProductsEnabled=[{product:"IPLAYER",enabled:!0},{product:"MUSIC",enabled:!0}],o.HAS_ON_BOARDED_PARAM_NAME="hasOnboarded",o.prototype={get:function(t){return NotificationsModernizr.localstorage?(this.attributes=e.extend(this.attributes,this.cacheManager.get(t),!0),this.attributes):this.attributes},set:function(t){null!==t.preferences&&"undefined"!=typeof t.preferences.productsEnabled&&this.fixProductsEnabledData(t),this.attributes=e.extend(this.attributes,t,!0),NotificationsModernizr.localstorage&&this.cacheManager.set(this.attributes),i.info("Updated localStorage/object cache with new preferences data",this.attributes)},fixProductsEnabledData:function(t){var i,n=o.defaultProductsEnabled.slice();i=null!==t.preferences.productsEnabled?t.preferences.productsEnabled:[],e.forEach(n,function(t){e.forEach(i,function(e){t.product===e.product&&(t.enabled=e.enabled)},this)}),t.preferences.productsEnabled=n},fetch:function(t){var e=this;!this.cacheManager.checkExpired()||this.cacheManager.isLocked()?(i.info("Serving user preferences from localStorage"),t(null,e.get(!0))):this.callService(t)},callService:function(t){var e=this;this.client.fetch(function(n,o){return e.setFetchLastCallInfo(e.client.getLastRequestInfo()),n?(i.log("Error reading user preferences",arguments),t(!0,e.get(!0))):(i.info("Successfully fetched user preferences from service",o),e.cacheManager.lock(!0),e._saveData(o),void t(null,o))})},isPollingEnabled:function(){return this.idcta.hasCookie()},poll:function(t){this.isPolling=!0;var e=this,n=this.cacheManager.params.preferencesPollingInterval;this.cacheManager.params.pollingFn=function(){e.isPollingEnabled()&&e.fetch(t)},e.isPollingEnabled()?(this.pollingIntervalFn=setInterval(this.cacheManager.params.pollingFn,n),i.info("Polling on user preferences started, it will happen every %s seconds, next polling is at [%s]",n/1e3,new Date(Date.now()+n))):clearInterval(this.pollingIntervalFn)},sync:function(t,n){var o=this,a=this.get(!0);return a.preferences=e.extend(a.preferences,{readFilter:this.settings.filter.getCleanArray()},{lastReadFlag:!1},t.preferences,!0),this.isPollingEnabled()?void this.client.updatePreferences(this._prepareData(a.preferences),function(t,s){"string"==typeof t&&(t=e.handledParse(t,!0)),t&&void 0===t.status?(i.error("Error syncing user preferences",arguments),"function"==typeof n&&n(!0,s)):(t=null===t?{status:200}:t,t.status>304?(i.error("Error syncing user preferences",arguments),"function"==typeof n&&n(!0,s)):(a.preferences.lastRead=(new Date).toISOString(),a.preferences.currentDateTime=(new Date).toISOString(),delete a.lastReadFlag,o.set(a),i.info("Success syncing preferences",s),"function"==typeof n&&n(null,s)))}):void i.info("Attempted to sync preferences while logged out")},updateProductEnabled:function(t,e,i){for(var n=this.get().preferences,o=!1,a={product:t.toUpperCase(),enabled:e},s=0;s<n.productsEnabled.length;s++)t.toUpperCase()==n.productsEnabled[s].product&&(o=!0,n.productsEnabled[s].enabled=e);o||n.productsEnabled.push(a),this.sync({preferences:{productsEnabled:n.productsEnabled.slice()}},i)},getProducts:function(){var t=this.get().preferences;return t.productsEnabled},getEnabledProducts:function(){for(var t=this.getProducts(),e=[],i=0;i<t.length;i++)t[i].enabled&&e.push(t[i].product);return e},updateUserOnBoarding:function(t){this.sync({preferences:{hasOnboarded:!0,lastReadFlag:!0}},t)},_prepareData:function(t){var i=e.extend({},t);return"object"==typeof t.readFilter&&t.readFilter instanceof Array&&(i.readFilter=JSON.stringify(t.readFilter)),delete i.lastRead,delete i.currentDateTime,i},_saveData:function(t){this.set(t),null!==t.preferences&&"undefined"!=typeof t.preferences.readFilter&&this.settings.filter.override(t.preferences.readFilter)},_getActiveSubscriptions:function(t){var i={};return t=t||this.get(!0).subscriptions,t&&e.forEach(t,function(t){t.enabled&&(i[t.topic]=t)},this),i},_countActiveSubscriptions:function(){var t=0,i=this.get(!0).subscriptions;return i&&e.forEach(i,function(e){e.enabled&&t++},this),t},setFetchLastCallInfo:function(t){this.fetchLastCallInfo=t},getFetchLastCallInfo:function(){return this.fetchLastCallInfo}},o}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/popup",["mybbc/notifications/classie","mybbc/notifications/eventie"],e):"undefined"!=typeof exports?module.exports=e(require("classie"),require("eventie")):t.popup=e(classie,eventie)}(this,function(t,e){var i={unseenLatestDataCount:0,state:"hidden",lastWrapperScrollPos:0,defaults:{showDuration:2},eventie:e,classie:t,init:function(t){t=t||{},this.el=t.el||null,this.containerEl=t.containerEl||null,this.notificationItemsSelector=t.notificationItemsSelector||null,this.wrapperEl=t.wrapperEl||null,this.mainApp=t.mainApp||null,this.showDuration=t.showDuration||this.defaults.showDuration||null,this.setEventListeners()},setEventListeners:function(){this.eventie.addEvent(this.el,"click",this._onNotificationPopupClicked())},html:function(t){this.el.innerHTML=t},check:function(){var t=this;if(0!==this.unseenLatestDataCount)return this.wrapperEl.scrollTop>=this._getLatestAddedItemHeights()-15&&"hidden"!=this.mainApp.getDrawerState()?(this.html(this.unseenLatestDataCount+" NEW notification(s)"),"shown"!=this.state?this.show():void(this.wrapperEl.scrollTop<this.lastWrapperScrollPos&&!this.hideTimeout&&(this.hideTimeout=setTimeout(function(){"hidden"!=t.state&&t.hide()},2e3)))):void("hidden"!=this.state&&this.hide())},_getLatestAddedItemHeights:function(){for(var t,e=0,i=document.querySelectorAll(this.notificationItemsSelector),n=-1;++n<this.unseenLatestDataCount&&(t=i[n]);)e+=t.offsetHeight;return e},_onNotificationPopupClicked:function(){var t=this;return function(e){t.wrapperEl.scrollTop=0,t.hide()}},hide:function(){this.classie.remove(this.containerEl,"has-new"),this.state="hidden",this.hideTimeout&&clearTimeout(this.hideTimeout),this.unseenLatestDataCount=0},show:function(){this.classie.add(this.containerEl,"has-new"),this.state="shown",this.lastWrapperScrollPos=this.wrapperEl.scrollTop}};return i}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/AbstractCollection",["mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("eventie"),require("mybbc/notifications/eventie")):t.AbstractCollection=e(eventie,utils)}(this,function(t,e){var i=new e,n=function(t,e){t=t||[],this.models=t,this.eventCallbacks={},this.modelIds=Array.prototype.concat.call([],Array.prototype.map.call(t,function(t){return t.id}))||[],this.initialise(e)};return n.extend=function(t){var e=function(){n.apply(this,arguments)};return t=t||{},e.prototype=i.extend(new n(t.models),t),e.prototype.constructor=e,e},n.prototype={type:"AbstractCollection",url:"",model:null,getType:function(){return this.type},initialise:function(t){return this},setUrl:function(t){this.url=t},toJSON:function(){var t=[];return this.isEmpty()?t:(this.each(function(e){t.push(e.toJSON())}),t)},toArray:function(){return this.models},fetch:function(t){return this},bind:function(t){
var e=this;return"undefined"!=typeof Function.prototype.bind?t.bind(this):function(){t.apply(e,arguments)}},parse:function(t){return t},filter:function(){return this},success:function(){return this},fail:function(){return this},first:function(){return this.isEmpty()?{}:this.models.slice(0,1)[0]},last:function(){return this.isEmpty()?{}:this.models.slice(-1)[0]},at:function(t){return this.isEmpty()?{}:this.models.slice(t,t+1)[0]},indexOf:function(t){var e=-1;return this.each(function(i,n){i.id==t&&(e=n)}),e},isEmpty:function(){return 0===this.models.length},add:function(t){return this},each:function(t){if(!this.isEmpty()){var e=Array.prototype.forEach||function(t){for(var e=-1;++e<this.length;)t(this[e],e)};e.call(this.models,t)}},has:function(t){return this.modelIds.indexOf(t)>=0},on:function(e,i,n){var o;n=n||null,i=i||function(){},o=this.getEventCallbackHash(e,i),this.eventCallbacks[o]=function(t){i.call(n,t,t.data)},t.addEvent(document,e,this.eventCallbacks[o])},off:function(e,i,n){var o;o=this.getEventCallbackHash(e,i),o in this.eventCallbacks&&t.removeEvent(document,e,this.eventCallbacks[o])},trigger:function(e,i,n){t.triggerEvent(document,e,i,n)},getEventCallbackHash:function(t,e){return escape(t+e.toString().slice(0,150))}},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/AbstractModel",e):"undefined"!=typeof exports?module.exports=e():t.AbstractModel=e()}(this,function(){function t(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}var e=function(t,e){this.attributes=t||{},this.id=this.attributes[this.idAttribute]||void 0,this.initialise(e)};return e.extend=function(i){var n=function(){e.apply(this,arguments)};return i=i||{},n.prototype=t(new e(i.models),i),n.prototype.constructor=n,n},e.prototype={idAttribute:"id",initialise:function(t){return this},toJSON:function(){return this.attributes},get:function(t){return"undefined"!=typeof this.attributes[t]?this.attributes[t]:void 0},set:function(t,e){this.attributes[t]=e},fill:function(t){if(this.attributes=t,!(this.idAttribute in this.attributes))throw new Error("Can not fill model with no id");this.id=this.attributes[this.idAttribute]},isEmpty:function(){return 0===Object.keys(this.attributes).length}},e}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/models/NotificationModel",["mybbc/notifications/models/AbstractModel"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractModel")):t.NotificationModel=e(AbstractModel)}(this,function(t){var e=t.extend({});return e}),define("mybbc/notifications/vendor/relay",[],function(){function t(t,e){var i,n="__iframe_"+ ++s.frameCount,o=document.createElement("iframe");o.setAttribute("name",n),o.style.cssText="visibility: hidden; position: absolute; height: 0; width: 0;",o.id=n,document.body.appendChild(o),o.attachEvent?o.attachEvent("onload",function(){t(o)}):o.onload=function(){t(o)},o.src=e,i=frames[n],i.name=n,"about:blank"===e&&(i.document.open(),i.document.write("<html></html>"),i.document.close())}function e(t){t.parentNode.removeChild(t)}function i(t,e,i,o){function a(){t.loadcount++,"function"==typeof t.handleLoad&&t.handleLoad()}var s,r,c,l;t.callback=o||function(){},r=t.document.createElement("script"),c="var eventMethod = window.addEventListener? 'addEventListener' : 'attachEvent',    eventListener = window[eventMethod],    eventName = (eventMethod === 'attachEvent')? 'onmessage' : 'message';var messageCount = 0, messageHandler = function(e) { if (messageCount++) {return}; self.callback(e.data); return false;  }; eventListener(eventName, messageHandler, false);loadcount = 0; function handleLoad(){};",r.type="text/javascript";try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r);try{s=t.document.createElement('<iframe name="myIframe"/>')}catch(d){s=t.document.createElement("iframe")}s.src="about:blank",s.attachEvent?s.attachEvent("onload",a):s.onload=a,s.id=s.name="myIframe",t.document.body.appendChild(s),l=t.document.createElement("form"),l.method="POST",l.id="myForm",l.setAttribute("target","myIframe"),l.target="myIframe",l.action=i,l.innerHTML=n(e),t.document.body.appendChild(l),r=t.document.createElement("script"),r.type="text/javascript",c='n = loadcount;myIframe = frames["myIframe"];handleLoad = function() {if (loadcount === n+1) {setTimeout(function(){ myIframe.location.replace("about:blank"); }, 0)} else if (loadcount === n+2) {handleLoad = function(){};setTimeout(function(){ if (!window.postMessage) { self.callback(myIframe.name=="myIframe"? null:myIframe.name); }}, 0);}};document.getElementById("myForm").submit();';try{r.appendChild(t.document.createTextNode(c))}catch(d){r.text=c}t.document.body.appendChild(r)}function n(t){var e="";if("object"==typeof t){for(var i in t)t.hasOwnProperty(i)&&(e+=o(i,t[i]));return e}return o("data",t)}function o(t,e){return'<input type="text" name="'+a(t)+'" value="'+a(e)+'" />'}function a(t){return t=""+t,t.replace(/([&<>"])/g,function(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return e[t]})}var s={frameCount:0};return s.post=function(n,o,a){var s,r,c,l,d,f="about:blank",u=1e4;"object"==typeof a?(d=a.callback,"undefined"!=typeof a.referer&&(f=a.referer),"undefined"!=typeof a.timeout&&(u=a.timeout)):"function"==typeof a&&(d=a),r=function(t){s=frames[t.id],c=setTimeout(function(){t&&e(t),t=null,d&&(d(null),d=null)},u),l=function(i){clearTimeout(c),t&&e(t),d&&d(i)},i(s,n,o,l)},t(r,f)},s}),function(t){function e(t){return this._attempts=0,this._setSettings(t),this}e.defaults={type:"GET",dataType:"json",jsonpCallback:"colbertCallback",appendJsonpCallback:!0,async:!0,timeout:15e3,data:"",cache:!1,responseType:"text",retryThreshold:1,url:t.location.toString(),contentType:"application/x-www-form-urlencoded",accepts:{script:"text/javascript, application/javascript, application/x-javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"}},e.create=function(t){return new e(t)},e._setupRelay=function(t){this.prototype.relayEnabled=!0,this.prototype.relay=t},e.prototype={_prepareData:function(t){return"string"!=typeof t.data&&"application/json"==t.contentType&&(t.data=JSON.stringify(t.data)),t},isXHRCorsSupported:function(){return"undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest},isIE6to10:function(){return t.navigator.appVersion.toLowerCase().indexOf("msie")>=0},_serialize:function(t,e){if(!_isArray(t)&&"object"!=typeof t)return t;var i=[];for(var n in t)if(t.hasOwnProperty(n)){var o=e?e+"["+n+"]":n,a=t[n];i.push("object"==typeof a?serialize(a,o):encodeURIComponent(o)+"="+encodeURIComponent(a))}return i.join("&")},send:function(){var e,i,n={},o=this._settings,a=t.location.protocol,s=this,r=function(){return!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)},c=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],l=function(t,e){n[t.toLowerCase()]=e},d=function(){if(o.data&&"GET"!=o.type.toUpperCase()&&l("Content-Type",o.contentType),!o.ignoreHeaders&&(o.crossDomain||l("X-Requested-With","XMLHttpRequest"),l("Accept",o.accepts[o.dataType]||"*/*"),"undefined"!=typeof o.headers))for(var t in o.headers)o.headers.hasOwnProperty(t)&&l(t,o.headers[t])},f=function(){return new XDomainRequest},u=function(){for(var t=null,e=-1;++e<c.length;){try{t=c[e]()}catch(i){continue}break}return t},h=function(){if(4==this.readyState){var i,n="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};this.onreadystatechange=null,this.status>=200&&this.status<300||304==this.status||0===this.status&&"file:"==a?(i=e.responseText,r(i,this,o)):(n(this.statusText||null,this.status?"error":"abort",this,o),++s._attempts<s._settings.retryThreshold&&s.send())}},p=function(){var e,i="function"==typeof s._successCallback?s._successCallback:function(){t.console&&console.log("Request successful: ",arguments)};e=this.responseText,i(e,this,o)},g=function(){var e="function"==typeof s._failCallback?s._failCallback:function(){t.console&&console.log("Request failed: ",arguments)};e(this.statusText||null,"error",this,o)};if(d(),"jsonp"==o.dataType)return this.sendJSONP();if("postRelay"===o.dataType)return this.sendRelay();if(o.crossDomain||(urlAnchor=document.createElement("a"),urlAnchor.href=o.url,urlAnchor.href=urlAnchor.href,o.crossDomain=window.location.protocol+"//"+window.location.host!=urlAnchor.protocol+"//"+urlAnchor.host),this.isIE6to10()&&o.crossDomain&&!this.isXHRCorsSupported())i=f(),i.onload=p,i.onerror=g,i.onprogress=function(){},i.ontimeout=function(){},i.open(o.type,o.url),o=this._prepareData(o),i.send(o.data);else{e=u(),!r()&&e.responseType&&(e.responseType=o.responseType),e.onreadystatechange=h,e.open(o.type,o.url,o.async),o.useCookies&&(e.withCredentials=!0),e.timeout=o.timeout,d();for(var m in n)n.hasOwnProperty(m)&&e.setRequestHeader(m,n[m]);o=this._prepareData(o),e.send(o.data)}return this},sendJSONP:function(){var i,n=this._settings,o=!1,a=this,s="function"==typeof a._failCallback?a._failCallback:function(){t.console&&console.log("Request failed: ",arguments)},r="function"==typeof a._successCallback?a._successCallback:function(){t.console&&console.log("Request successful: ",arguments)},c=function(t,e){return(t+"&"+e).replace(/[&?]{1,2}/,"?")},l=function(){document.head&&u.parentNode&&document.head.removeChild(u),e&&e.jsonpCallbackData&&n.jsonpCallback in e.jsonpCallbackData?1==e.jsonpCallbackData[n.jsonpCallback]?(delete e.jsonpCallbackData[n.jsonpCallback],t[n.jsonpCallback]=void 0):e.jsonpCallbackData[n.jsonpCallback]--:t[n.jsonpCallback]=void 0},d=function(e){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState?t.console&&t.console.log("OTHER STATES jsonp: ",this.readyState):(o=!0,u.onload=u.onerror=u.onreadystatechange=null,l(),"type"in e&&"error"==e.type&&(i&&clearTimeout(i),s(null,e.type,u,n)))},f=function(){s(null,"error",u,n),l()};!n.cache&&n.appendJsonpCallback&&(n.url=c(n.url,"_="+(new Date).getTime())),n.appendJsonpCallback&&(n.url=c(n.url,"callback="+n.jsonpCallback));var u=document.createElement("script");return u.type="text/javascript",u.onload=u.onerror=u.onreadystatechange=d,t[n.jsonpCallback]=function(){if(arguments&&1==arguments.length){var t=arguments[0];r(t,u,n)}else s(null,"error",u,n);i&&clearTimeout(i)},e&&(e.jsonpCallbackData=e.jsonpCallbackData||{},e.jsonpCallbackData[n.jsonpCallback]=n.jsonpCallback in e.jsonpCallbackData?++e.jsonpCallbackData[n.jsonpCallback]:1),u.src=n.url,i=setTimeout(f,n.timeout),document.head.appendChild(u),this},sendRelay:function(t){var e=this._settings;e.callback="function"==typeof t?t:"function"==typeof this._successCallback?this._successCallback:function(){},this._prepareData(e),this.relay.post(e.data,e.url,e.callback)},done:function(t){return"function"==typeof t?(this._successCallback=t,this):void 0},fail:function(t){return"function"==typeof t?(this._failCallback=t,this):void 0},_setSettings:function(t){this._settings=this._extend(e.defaults,t||{})},_extend:function(){var t=-1,e={};if(!arguments)return{};for(;++t<arguments.length;){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}},"undefined"!=typeof define&&"undefined"!=typeof define.amd?define("mybbc/notifications/request",["mybbc/notifications/vendor/relay"],function(t){return t&&e._setupRelay(t),e}):"undefined"!=typeof module&&"undefined"!=typeof module.exports?exports=e:t.request=e}(this),define("mybbc/notifications/NotificationLoader",["require","mybbc/notifications/config","mybbc/notifications/request"],function(t){var e=t("mybbc/notifications/config"),i=t("mybbc/notifications/request"),n=function(t){this.loaderOptions=t||{},this.pollingIntervalId=void 0,this.url=void 0,this.request=i};return n.prototype.startPolling=function(t,i,n,o){var a=this;this.pollingStarted()||(this.pollingIntervalId=setInterval(function(){(!o||o.hasCookie())&&a.loadNotifications(t,i,n)},e.env.notificationsPollingInterval))},n.prototype.loadNotifications=function(t,e,i){this.url=t;var n=new this.request(this._getRequestParams(i)),o={notifications:[]},a=null,s=this;n._successCallback=function(t,i){a=t,"function"==typeof e&&s._onSuccess(e,a,o,i)},n._failCallback=function(t,i){e(!0,"notificationloader.load.error",i,s.loaderOptions)},n.send()},n.prototype._onSuccess=function(t,e,i,n){try{null!==e&&(e="object"==typeof e?e:JSON.parse(e.trim()),"undefined"==typeof e.notifications?i.notifications=e:i=e)}catch(o){return void t(!0,"notificationloader.parse.error",n.status,this.loaderOptions)}t(null,i,n.status,this.loaderOptions)},n.prototype.pollingStarted=function(){return void 0!==this.pollingIntervalId},n.prototype.setOption=function(t,e){this.loaderOptions[t]=e},n.prototype._getRequestParams=function(t){var e=this,i={contentType:"application/json",type:"GET",dataType:"jsonp",url:e.url,jsonpCallback:"colbertCallback",timeout:1e4};if("undefined"!=typeof t)for(var n in t)i[n]=t[n];return i},n}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/AggregatedNotificationCollection",["mybbc/notifications/collections/AbstractCollection","mybbc/notifications/models/NotificationModel","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/DateManager","mybbc/notifications/logger"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractCollection"),require("NotificationModel"),require("NotificationLoader"),require("config"),require("DateManager"),require("logger")):t.AggregatedNotificationCollection=e(AbstractCollection,NotificationModel,NotificationLoader,config,DateManager,Logger)}(this,function(t,e,i,n,o,a){var s=t.extend({type:"AggregatedNotificationCollection",model:e,baseUrl:n.env.feedBaseUrl,url:n.env.feedAggregatedInitialFeed,collectionDataSource:"aggregated",maxNotificationAgeDays:n.env.maxNotificationAge,latestLoader:new i,loader:new i,logger:a.getLogger("AggregatedNotificationCollection"),dateManager:o,state:{pageSize:n.env.visibleChunkAmount,lastItemShownModelId:null,errorThrown:!1,itemsToload:n.env.visibleChunkAmount,sortKey:"creationTimestamp",newItemsAddedCount:0,newLatestItemsAddedCount:0,endOfPagesReached:!1,endOfItemsReached:!1,reachedOldNotifications:!1},initialise:function(t){return t=t||{},this.latestUrl=this.url,this.userPreferencesModel=t.userPreferencesModel||{},this.initialFetch=!1,this.fetchInprogress=!1,this.modelIds=[],this.nextPageReadyCallback=null,this.idcta=t.idcta,this},getNextPage:function(t){this.nextPageReadyCallback=t,this.hasCachedModels()?this.checkCachedModels():this.reachedLastPage()||this.prepareFetch()},checkCachedModels:function(){this.getAvailableCachedItemsCount()<this.state.pageSize?this.reachedLastPage()?this.getPageFromCache(!0):this.prepareFetch():this.getPageFromCache()},getPageFromCache:function(t){t=t||!1,this.notify(),this.state.lastItemShownModelId=t?this.last().id:this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id,t?(this.state.endOfItemsReached=!0,this.logger.info("Last page prepared from the collection cache (from previously loaded data)")):this.logger.info("Next page prepared from the collection cache (from previous calls)",this.state.lastItemShownModelId)},prepareFetch:function(){return this.fetchInprogress?void this.logger.warn("Attempt to get nextPage but previous fetch in progress"):(this.state.itemsToload=this.state.pageSize-this.getAvailableCachedItemsCount(),void this.fetch())},fetch:function(t){return this.logger.info("Fetching started, %s items to load:",this.state.itemsToload,"Fetch URL: "+this.getFullUrl()),t=t||{},this.success=t.success||this.success,this.fail=t.fail||this.fail,this.loader.loadNotifications(this.getFullUrl(),this.bind(this.onNotificationsLoaded),this.getLoadParams()),this.fetchInprogress=!0,this},getFullUrl:function(t){return this.baseUrl.replace(/\/?$/,"/")+this.collectionDataSource+"/"+(t?this.latestUrl:this.url)},hasCachedModels:function(){return this.getAvailableCachedItemsCount()>0},getAvailableCachedItemsCount:function(){var t=this.state.lastItemShownModelId,e=this.indexOf(t);return this.models.length-(e+1)},setCollectionDataSource:function(t){this.collectionDataSource=t},getLoadParams:function(){return{cache:!0,jsonpCallback:"_"+this.collectionDataSource.replace(/(:|\s)/g,"_")+"_"+this.url.replace(/(:|-|\.)/g,"_")}},onNotificationsLoaded:function(t,e){return t?this.fail(e,"pages"):void this.success(e,"pages")},success:function(t,e){var i;this.checkStartPolling(),i=this.parse(t),this.filterStartTime=Date.now(),this.logger.info("Applying filters to the loaded data [%s items]: ",i.length),i=this.applyFilters(i),this.filterEndTime=Date.now(),this.logger.info("Finished Applying filters to the loaded data [%s ms], [%s items accepted after filtering]",this.filterEndTime-this.filterStartTime,i.length),this.add(i,e).sort(),"pages"==e?this.handlePagesLoadSuccess(t):"latest"==e&&this.state.newLatestItemsAddedCount>0&&(this.logger.info("%s New notifications received (from latest.json)",this.state.newLatestItemsAddedCount),this.trigger("notification.latest.update",{content:this.toJSON().slice(0,Math.max(this.indexOf(this.state.lastItemShownModelId)+1,this.state.pageSize)),newLatestItemsCount:this.state.newLatestItemsAddedCount}))},handlePagesLoadSuccess:function(t){var e;return this.checkState(),e="undefined"!=typeof t.next&&"false"!=t.next&&!this.state.reachedOldNotifications&&this.userPreferencesModel.getEnabledProducts().length>0,this.setUrl(e?t.next:null),null===this.url?(this.fetchInprogress=!1,this.notify(),this._setEndOfPagesReached()):this.state.itemsToload>0?this.fetch():(this.logger.info("Fetching finished, %s items to load:",this.state.itemsToload,"Next URL to load: %s",this.getFullUrl()),this.fetchInprogress=!1,this.notify(),void(this.state.lastItemShownModelId=this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id))},checkStartPolling:function(){this.initialFetch||(this.setLatestNotificationPolling(),this.initialFetch=!0)},setLatestNotificationPolling:function(){this.isUserSignedIn()&&(this.logger.info("Polling started to pull latest.json"),this.latestLoader.startPolling(this.getFullUrl(!0),this.bind(this.onLatestNotificationsLoaded),this.getLoadParams(),this.idcta))},onLatestNotificationsLoaded:function(t,e){return t?this.fail(e,"latest"):void this.success(e,"latest")},parse:function(t){return t.notifications},_getActiveSubscriptions:function(){var t="undefined"!=typeof this.userPreferencesModel.get()&&"subscriptions"in this.userPreferencesModel.get()?this.userPreferencesModel.get().subscriptions:[];return this.userPreferencesModel._getActiveSubscriptions(t)},applyFilters:function(t){return t=this.filterDataByProductsEnabled(t),t=this.filterDataByCreationDate(t),t=this.filterDataBySubscriptions(t)},isUserSubscribedToTopic:function(t,e){return t.topic[e]in this._getActiveSubscriptions()},isItemTopicCreatedAfterSubscribe:function(t,e){return new Date(t.creationTimestamp).getTime()>new Date(e).getTime()},isUserSignedIn:function(){return this.idcta.hasCookie()},filterDataByProductsEnabled:function(t){var e,i=this.userPreferencesModel.getEnabledProducts(),n=[];if(0===i.length)return[];for(var o in t)t.hasOwnProperty(o)&&(e=t[o],-1!=i.indexOf(e.product.toUpperCase())&&n.push(e));return n},filterDataBySubscriptions:function(t){var e,i,n,o=[],a=this,s=this._getActiveSubscriptions();for(var r in t)if(t.hasOwnProperty(r)){e=t[r],i=!1;for(var c=0;c<e.topic.length;c++)a.isUserSubscribedToTopic(e,c)&&(n=s[e.topic[c]].lastSubscribed||void 0,("undefined"==typeof n||a.isItemTopicCreatedAfterSubscribe(e,n))&&(i=!0));i&&o.push(e)}return o},filterDataByCreationDate:function(t){var e,i=this;return t.filter(function(t){return e=i.dateManager.howOld(t.creationTimestamp)<=parseInt(i.maxNotificationAgeDays,10),e||(i.state.reachedOldNotifications=!0),e})},sort:function(){var t=this;return this.models=this.models.sort(function(e,i){var n=e.get(t.state.sortKey),o=i.get(t.state.sortKey);return"creationTimestamp"==t.state.sortKey?new Date(o)-new Date(n):o-n}),this},add:function(t,e){for(var i,n=this,o=-1,a=0;++o<t.length;)i=t[o],n.has(i.id)||(n.modelIds.push(i.id),a++,n.models.push(new n.model(i)));return"latest"===e?this.state.newLatestItemsAddedCount=a:"pages"===e&&(this.state.newItemsAddedCount=a),this},checkState:function(){var t=this.state.itemsToload,e=this.state.newItemsAddedCount;this.state.itemsToload=e>=t?0:t-e},notify:function(){var t=this.state.lastItemShownModelId;this.logger.info('Next page prepared after fetching finished, triggering the "%s" event',"notification.new.page.ready"),this.trigger("notification.new.page.ready",{content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0}),"function"==typeof this.nextPageReadyCallback&&this.nextPageReadyCallback({content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0})},fail:function(t,e){this.checkStartPolling(),this.logger.error(t),this.fetchInprogress=!1,"pages"===e&&(0!==this.toArray().length||this.state.errorThrown?this.toArray().length>0&&(this.checkState(),this.notify(),this._setEndOfPagesReached()):(this.trigger("notification.load.error"),this.state.errorThrown=!0)),this.logger.error("Error loading notifications",t)},reachedLastPage:function(){return this.state.endOfPagesReached},hasItemsToLoad:function(){return!this.state.endOfItemsReached},_setEndOfPagesReached:function(){var t=this.indexOf(this.state.lastItemShownModelId),e=this.state.pageSize-this.state.itemsToload;this.logger.info("Reached the end of the pages, no more notification files to load"),this.state.lastItemShownModelId=this.at(t+Math.min(e,this.state.pageSize)).id,0===this.getAvailableCachedItemsCount()&&(this.state.endOfItemsReached=!0),this.state.endOfPagesReached=!0}});return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/collections/TopicNotificationCollection",["mybbc/notifications/collections/AbstractCollection","mybbc/notifications/models/NotificationModel","mybbc/notifications/NotificationLoader","mybbc/notifications/config","mybbc/notifications/DateManager","mybbc/notifications/logger","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("AbstractCollection"),require("NotificationModel"),require("NotificationLoader"),require("config"),require("DateManager"),require("logger"),require("utils")):t.TopicNotificationCollection=e(AbstractCollection,NotificationModel,NotificationLoader,config,DateManager,Logger,Utils)}(this,function(t,e,i,n,o,a,s){var r=new s,c=t.extend({type:"TopicNotificationCollection",model:e,baseUrl:n.env.feedBaseUrl,url:n.env.feedTopicInitialFeed,notificationsPollingInterval:n.env.notificationsPollingInterval,maxNotificationAgeDays:n.env.maxNotificationAge,logger:a.getLogger("TopicNotificationCollection"),dateManager:o,state:{pageSize:n.env.visibleChunkAmount,lastItemShownModelId:null,sortKey:"creationTimestamp",newLatestItemsAddedCount:0,endOfPagesReached:!1,endOfItemsReached:!1,reachedOldNotifications:!1},initialise:function(t){return t=t||{},this.latestUrl=this.url,this.userPreferencesModel=t.userPreferencesModel||{},this.pollingStarted=!1,this.fetchInprogress=!1,this.modelIds=[],this.topics={},this.nextPageReadyCallback=null,this.idcta=t.idcta,this},getNextPage:function(t){this.nextPageReadyCallback=t,this.isEmptyCachedModels()?this.prepareFetch():this.getPageFromCache()},getPageFromCache:function(){var t=this.getAvailableCachedItemsCount()<this.state.pageSize;this.notify(),this.state.lastItemShownModelId=t?this.last().id:this.at(this.indexOf(this.state.lastItemShownModelId)+this.state.pageSize).id,t?(this.state.endOfItemsReached=!0,this.logger.info("Last page prepared from the collection cache (from previously loaded data)")):this.logger.info("Next page prepared from the collection cache (from previous calls)",this.state.lastItemShownModelId)},prepareFetch:function(){return this.fetchInprogress?void this.logger.warn("Attempt to get nextPage but previous fetch in progress"):void this.fetch()},fetch:function(){var t,e,n=r.keys(this._getActiveSubscriptions()),o=this;return this.topics={},0===n.length?void this.completeTopicsInitialLoad():(r.forEach(n,function(e){t=o.addTopic(e,{name:e,loader:new i({topic:e,loadType:"pages"}),state:{currentFile:o.latestUrl,reachedOldNotifications:!1}})}),void r.each(this.topics,function(t,i){e=o.getFullUrl(i,t.state.currentFile),t.loader.loadNotifications(e,o.bind(o.onNotificationsLoaded),o.getLoadParams(i,t.state.currentFile)),o.fetchInprogress=!0,o.logger.info("Fetching started for topic %s:",i,"Fetch URL: "+e)}))},addTopic:function(t,e){return this.topics[t]=e,this.topics[t]},getTopic:function(t){return this.topics[t]},getFullUrl:function(t,e){return this.baseUrl.replace(/\/?$/,"/")+encodeURIComponent(t)+"/"+e},isEmptyCachedModels:function(){return 0===this.getAvailableCachedItemsCount()},getAvailableCachedItemsCount:function(){var t=this.state.lastItemShownModelId,e=this.indexOf(t);return this.models.length-(e+1)},getLoadParams:function(t,e){return{cache:!0,jsonpCallback:"_"+t.replace(/(:|\s)/g,"_")+"_"+e.replace(/(:|-|\.)/g,"_")}},onNotificationsLoaded:function(t,e,i,n){var o=n.topic,a=n.loadType;return t?this.fail(o,e,a):void this.success(o,e,a)},success:function(t,e,i){var n,o,a;n=this.parse(e),o=Date.now(),this.logger.info("Applying filters to the loaded data for topic %s [%s items]: ",t,n.length),n=this.applyFilters(t,n),a=Date.now(),this.logger.info("Finished Applying filters to the loaded data [%s ms], [%s items accepted after filtering]",a-o,n.length),this.add(t,n,i).sort(),"pages"===i?this.handleTopicPagesLoadSuccess(t,e):"latest"===i&&this.handleTopicLatestLoadSuccess(t,e)},handleTopicPagesLoadSuccess:function(t,e){var i,n,o=this.getTopic(t),a=o.state.reachedOldNotifications||0===this.userPreferencesModel.getEnabledProducts().length;n=a?null:this.getNextTopicFile(e),o.state.currentFile=n,null===n?(o.state.endOfPagesReached=!0,this.isLoadingFinishedForAllTopics()&&this.completeTopicsInitialLoad()):(i=this.getFullUrl(t,n),o.loader.loadNotifications(i,this.bind(this.onNotificationsLoaded),this.getLoadParams(t,n)))},isLoadingFinishedForAllTopics:function(){var t=!0;return r.each(this.topics,function(e){e.state.endOfPagesReached||(t=!1)},this),t},completeTopicsInitialLoad:function(){this.fetchInprogress=!1,this.notify(),this._setEndOfPagesReached(),this.startUniquePolling()},getNextTopicFile:function(t){var e=t.next;return"undefined"==typeof e||"false"===e?null:e},startUniquePolling:function(){!this.pollingStarted&&this.isUserSignedIn()&&(this.pollingStarted=!0,this.startPolling())},resetPolling:function(){this.resetTopicsPollingState(),setTimeout(this.bind(this.startPolling),this.notificationsPollingInterval)},startPolling:function(){var t;this.logger.info("Polling started to pull latest data for each of the topics",this.topics),r.each(this.topics,function(e,i){t=this.getFullUrl(i,this.latestUrl),e.loader.setOption("loadType","latest"),e.loader.loadNotifications(t,this.bind(this.onNotificationsLoaded),this.getLoadParams(i,this.latestUrl))},this)},handleTopicLatestLoadSuccess:function(t){this.getTopic(t).state.latestPollingFinished=!0,this.isPollingFinishedForAllTopics()&&this.completeTopicsPolling()},isPollingFinishedForAllTopics:function(){var t=0;return r.each(this.topics,function(e){e.state.latestPollingFinished&&t++}),r.keys(this.topics).length<=t},completeTopicsPolling:function(){var t=this.getLatestAddedItemsCount();t>0&&(this.logger.info("%s New notifications received (from latest.json)",t),this.trigger("notification.latest.update",{content:this.toJSON().slice(0,Math.max(this.indexOf(this.state.lastItemShownModelId)+1,this.state.pageSize)),newLatestItemsCount:t})),this.resetPolling()},isUserSignedIn:function(){return this.idcta.hasCookie()},getLatestAddedItemsCount:function(){var t=0;return r.each(this.topics,function(e){t+=e.state.newLatestItemsAddedCount}),t},resetTopicsPollingState:function(){r.each(this.topics,function(t){t.state.newLatestItemsAddedCount=0,t.state.latestPollingFinished=!1})},parse:function(t){return t.notifications},_getActiveSubscriptions:function(){var t=this.userPreferencesModel.get(),e="undefined"!=typeof t&&"subscriptions"in t?t.subscriptions:[];return this.userPreferencesModel._getActiveSubscriptions(e)},applyFilters:function(t,e){return e=this.filterDataByProductsEnabled(e),e=this.filterDataByCreationDate(t,e),e=this.filterDataBySubscriptions(e)},isItemTopicCreatedAfterSubscribe:function(t,e){return new Date(t.creationTimestamp).getTime()>new Date(e).getTime()},filterDataByProductsEnabled:function(t){var e,i=this.userPreferencesModel.getEnabledProducts(),n=[];if(0===i.length)return[];for(var o in t)t.hasOwnProperty(o)&&(e=t[o],-1!=i.indexOf(e.product.toUpperCase())&&n.push(e));return n},filterDataBySubscriptions:function(t){var e,i,n,o=[],a=this,s=this._getActiveSubscriptions();for(var r in t)if(t.hasOwnProperty(r)){e=t[r],i=!1;for(var c=0;c<e.topic.length;c++)n=s[e.topic[c]].lastSubscribed||void 0,("undefined"==typeof n||a.isItemTopicCreatedAfterSubscribe(e,n))&&(i=!0);i&&o.push(e)}return o},filterDataByCreationDate:function(t,e){var i,n=this;return e.filter(function(e){return i=n.dateManager.howOld(e.creationTimestamp)<=parseInt(n.maxNotificationAgeDays,10),i||(n.getTopic(t).state.reachedOldNotifications=!0),i})},sort:function(){var t=this;return this.models=this.models.sort(function(e,i){var n=e.get(t.state.sortKey),o=i.get(t.state.sortKey);return"creationTimestamp"==t.state.sortKey?new Date(o)-new Date(n):o-n}),this},add:function(t,e,i){for(var n,o=-1,a=0;++o<e.length;)n=e[o],this.has(n.id)||(this.modelIds.push(n.id),a++,this.models.push(new this.model(n)));return"latest"===i&&(this.getTopic(t).state.newLatestItemsAddedCount=a),this},notify:function(){var t=this.state.lastItemShownModelId;this.logger.info('Next page prepared after fetching finished, triggering the "%s" event',"notification.new.page.ready"),this.trigger("notification.new.page.ready",{content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0}),"function"==typeof this.nextPageReadyCallback&&this.nextPageReadyCallback({content:this.toJSON().slice(0,this.indexOf(t)+1+this.state.pageSize),newLatestItemsCount:0})},fail:function(t,e,i){var n=this.getTopic(t);"pages"===i?(n.state.currentFile===this.latestUrl&&(n.state.hasLatestError=!0),n.state.endOfPagesReached=!0,this.isLoadingFinishedForAllTopics()&&this.completeTopicsInitialLoad()):"latest"===i&&(n.state.latestPollingFinished=!0,this.isPollingFinishedForAllTopics()&&this.completeTopicsPolling()),this.logger.error("Error loading notifications",e)},reachedLastPage:function(){return this.state.endOfPagesReached},hasItemsToLoad:function(){return!this.state.endOfItemsReached},_setEndOfPagesReached:function(){var t=this.indexOf(this.state.lastItemShownModelId);this.models.length>0&&(this.state.lastItemShownModelId=this.at(t+Math.min(this.models.length,this.state.pageSize)).id),this.logger.info("Reached the end of the pages, no more topic related notification files to load"),this.isEmptyCachedModels()&&(this.state.endOfItemsReached=!0),this.state.endOfPagesReached=!0}});return c}),define("mybbc/notifications/collections/NotificationCollectionFactory",["require","mybbc/notifications/collections/AggregatedNotificationCollection","mybbc/notifications/collections/TopicNotificationCollection","mybbc/notifications/config"],function(t){function e(t,e){var a,s=t._countActiveSubscriptions(),r=o.env.feedTopicMaxSubscriptions;return new(a=s>r?i:n)([],e)}var i=t("mybbc/notifications/collections/AggregatedNotificationCollection"),n=t("mybbc/notifications/collections/TopicNotificationCollection"),o=t("mybbc/notifications/config");
return{getCollectionInstance:e}}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/analytics",["istats-1","mybbc/notifications/logger","mybbc/notifications/eventie","mybbc/notifications/utils"],e):"undefined"!=typeof exports?module.exports=e(require("istats-1"),require("logger"),require("eventie")):t.Analytics=e(istats,logger,eventie)}(this,function(t,e,i,n){var o=e.getLogger("Notifications Analytics"),a=new n,s={track:function(e){return a.each(e,function(e,i){t.track(i,e),o.info("Analytics track",i,e)}),this},log:function(e,i,n){t.log(e,i,n),o.info("Analytics log event",e,i,n)},serialiseTopic:function(t){var e;return e=t.slice(0,5).join("!").replace(/urn:bbc:/g,"").replace(/:/g,"-"),e=t.length>5?e.concat("!more than 5"):e},listenTo:function(t,e,n){i.addEvent(t,e,a.bind(n,this))}};return s}),function(t,e){"undefined"!=typeof define&&define.amd?define("mybbc/notifications/SettingsView",["mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/NotificationsTemplate"],e):"undefined"!=typeof exports?module.exports=e():t.SettingsView=e()}(this,function(t,e,i,n,o){var a=function(a){function s(t){t&&(t.preventDefault?t.preventDefault():t.returnValue=!1)}function r(t){x=t}function c(){return x}function l(){e.addEvent(C.settingIconEl,"click",d),e.addEvent(C.settingIconEl,"keydown",f)}function d(t){s(t),p()}function f(t){var e=t.which||t.charCode;e==A&&(this.enterPressed=!0)}function u(t){s(t),h()}function h(e){e="undefined"==typeof e?!0:e,c()!==j&&(C.errorView.changeView("hub"),t.remove(S,"show"),r(j),"function"==typeof C.stateChanged&&C.stateChanged(j,e))}function p(){k.loaded()?b():k.load(b)}function g(t){var e,i=this,n=!1,o=this.dataset&&this.dataset.product||this.getAttribute("data-product"),a=this.dataset&&!!this.dataset.enabled&&JSON.parse(this.dataset.enabled)||JSON.parse(this.getAttribute("data-enabled")),r=!a,c=C.mainApp.getUserPreferencesModel();if("keypress"===t.type){if(e=t.which||t.charCode,-1==[A,P].indexOf(e))return;s(t),n=!0}c.updateProductEnabled(o,r,function(t,e){t?v(t,r):m(i,r)})}function m(e,i){t[i?"add":"remove"](e,"show"),e.dataset?e.dataset.enabled=i:(e.setAttribute("data-enabled",i),e.setAttribute("aria-checked",i))}function v(t,e){var i="#settings-error-inner";C.errorView.showError({view:"settings",isInner:!0,closeEvent:function(){C.errorView.hideError("settings",!1),document.querySelector(".notification-title--js").tabIndex=document.activeElement.tabIndex+1},errorElID:i,closeEl:".notifications-error--inner__close"},function(t){"shown"===t&&e&&document.querySelector(i+" .notifications-error--inner__body").focus()}),T.error("Error syncing the user product settings",t)}function b(){var e,i=C.mainApp.getUserPreferencesModel().getProducts(),n=[];if(C.errorView.changeView("settings"),S.innerHTML=k.compile({baseAssetUrl:C.mainApp.basePath}),t.add(S,"show"),i.length){for(var o=0;o<i.length;o++)e=i[o],e=I.extend(e,{checked:e.enabled,show:e.enabled?"show":"",name:D[e.product]||e.product.toLowerCase()}),n.push(e);_(n)}else C.errorView.showError({extContainer:S,view:"settings",isInner:!1,closeEvent:u,errorElID:"#settings-error-main",closeEl:".notifications-error__back"}),T.error("Error getting the product info",null);"function"==typeof C.stateChanged&&C.stateChanged(N,!0),E()}function y(){var t='<div class="notifications-settings-item" each="{ item in items }"><div class="notifications-long-primer notifications-settings-text" tabindex="0">{{item.name}} Notifications</div><div class="notifications-settings-tickbox notifications-settings-tickbox--js {{item.show}}" tabindex="0" data-product="{{item.product}}" data-enabled ="{{item.checked}}" role="checkbox" aria-checked="{{item.checked}}"></div></div>';return t}function w(){C.riot.tag("notifications-settings-items",y(),function(t){this.items=t.items||[]})}function _(t){C.riot.mount("notifications-settings-items",{items:t||[]}),r(N)}function E(){var t=S.querySelector(".notifications__settings__back-btn--js"),i=S.querySelectorAll(".notifications-settings-tickbox--js");I.forEach(Array.prototype.slice.call(i),function(t){e.addEvent(t,"click",g),e.addEvent(t,"keypress",g)}),e.addEvent(t,"click",u),O.checkInitialFocus(),O.startListeners()}var k,C,x,S,I=new n,T=new i("Settings view"),A=13,P=32,L=9,N="shown",j="hidden",M={el:".notification-settings__container--js",settingIconEl:document.querySelector(".notifications__settings--js"),templateName:"settings"},D={IPLAYER:"iPlayer",MUSIC:"Music"};C=I.extend(M,a),S=document.querySelector(C.el),k=o.create(C.templateName),r(j),w();var O=function(){function t(t){var e=t.which||t.keyCode;e==A?a=Date.now():e==L&&(r=Date.now())}function i(t){var e=t.which||t.keyCode;e==L&&t.shiftKey&&(s(t),h())}var n,o={},a=Date.now(),r=Date.now(),c=2e3;return o.hasKeyPressedRecently=function(){var t=Date.now();return"undefined"!=typeof r&&c>t-r||"undefined"!=typeof a&&c>t-a},o.checkInitialFocus=function(){n=S.querySelector(".notification-title--js"),C.settingIconEl.enterPressed&&(n.focus(),C.settingIconEl.enterPressed=!1)},o.startListeners=function(){e.addEvent(S,"keydown",t),e.addEvent(n,"keydown",i)},o.stopListeners=function(){e.removeEvent(S,"keydown",t),e.removeEvent(n,"keydown",i)},o}();return{init:function(){l()},load:function(){p()},render:b,hide:h,setSettingsIconFocus:function(){O.hasKeyPressedRecently()&&C.settingIconEl.focus()}}};return a}),define("mybbc/notifications/app",["require","mybbc/notifications/vendor/riot.min","mybbc/notifications/config","mybbc/notifications/BloomFilterManager","mybbc/notifications/classie","mybbc/notifications/AccessibilityManager","mybbc/notifications/DateManager","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/eventie","mybbc/notifications/logger","mybbc/notifications/utils","mybbc/notifications/popup","mybbc/notifications/collections/NotificationCollectionFactory","mybbc/notifications/analytics","mybbc/notifications/SettingsView"],function(t){function e(){var t=function(){var t='<img class="loader-icon notifications-image <%=svg-animation-class%>" src="<%=spinnerUrl%>" alt="Spinner">';return NotificationsModernizr.svg&&NotificationsModernizr.cssanimations&&!v()?t.replace(/<%=spinnerUrl%>/g,vt.baseAssetUrl+"svg/loader.svg").replace(/<%=svg-animation-class%>/g,"spinner__img--svg"):t.replace(/<%=spinnerUrl%>/g,vt.baseAssetUrl+"img/loader/32px/34px_Icon32px_Lively_Dark.gif").replace(/<%=svg-animation-class%>/g,"")},e='<ul class="notification-items" aria-live="polite" aria-relevant="additions" aria-atomic="true"> <li class="notification-item notification__item--js { item.newItem }" each="{ item in items }" tabIndex="{ parent.getIndex() }"> <a href="{ item.notification.url }" title="{ item.notification.title }" tabindex="-1"><div class="notification-icon-and-dot notifications-1/12 notification-{item.product.toLowerCase()}"><div class="notifications-image notification-{ item.product.toLowerCase() }-icon"> </div> <span class="notification-dot { item.newItem }"> </span></div><div class="notification-text notifications-11/12 { item.newItem }"> <div class="notification-title-items"> <div class="notifications-7/12"><p class="notification-text-body notifications-long-primer"> { parent.generateDescription(item) } </p></div><div class="notifications-4/12"> <img class="notifications-image notification-clock-icon notification-type-{ item.type }" src="<%=baseAssetUrl%>svg/clock.svg" alt="{ item.notification.description  } { parent.decodeDate(item.creationTimestamp) }" onerror="this.src=\'<%=baseAssetUrl%>img/clock.png\'; this.onerror=null;"></img><span class="notification-episode-name notifications-brevier">{ parent.manageText(item) }</span><span class="notification-time notifications-brevier">{ parent.decodeDate(item.creationTimestamp) }</span> </div></div></div></a></li><div id="no-notifications" class="no-notifications visible-{ items.length > 0 }"><p tabindex="988" class="notifications-long-primer"> No notifications right now. Weâll let you know when something from your favourite programmes, artists and playlists is available for you. </p><p tabindex="989" class="notifications-long-primer">If your notifications are turned off, you can always turn them back on. Just go to settings.</p></div><div class="clearfix"></div></ul><div class="spinner">'+t()+"</div>";return e.replace(/<%=baseAssetUrl%>/g,vt.baseAssetUrl)}function i(){nt.tag("notificationamount","{ notificationamount }",function(t){this.notificationamount=t.amount||"no"}),nt.tag("notifications",e(),function(t){this.items=t.items,this.decodeDate=function(t){var e=new Date(t),i=new Date(R),n=Math.floor(Math.abs(i-e)/36e5),o=Math.floor(Math.abs(i-e)/6e4);return n>23&&48>n?"Yesterday":n>=48&&168>n?(n/24).toFixed(0)+" days ago":n>0?n+" hour{{plural}} ago ".replace("{{plural}}",1===n?"":"s"):o>0?o+" minute{{plural}} ago ".replace("{{plural}}",1===o?"":"s"):"Just now"};var e=0;this.getIndex=function(){return++e},this.generateDescription=function(t){var e="";return e="EPISODE_EXPIRY"===t.type||"episode-expiry-today"===t.type?t.notification.title+" episode "+function(e){return lt.isToday(e)?(t.type="episode-expiry-today",["expires today at ",lt.getClockTime(e),". Don't miss out!"].join(" ")):lt.isTomorrow(e)?["expires tomorrow at ",lt.getClockTime(e),". Don't miss out!"].join(" "):lt.isToday(e)||lt.isTomorrow(e)?void 0:lt.getDayDifference(e)>0?["expires on ",lt.getWeekday(e)," at ",lt.getClockTime(e),". Don't miss out!"].join(" "):0===lt.getDayDifference(e)?["expired today "," at ",lt.getClockTime(e),"."].join(" "):["expired on ",lt.getWeekday(e)," at ",lt.getClockTime(e),"."].join(" ")}(t.expires):t.notification.title},this.manageText=function(t){return t.notification.episode?ut.truncate(t.notification.episode):t.product[0].toUpperCase()+t.product.substring(1,t.product.length).toLowerCase()}})}function n(t){r(t),0===t.length?(wt=!0,o(t)):(wt=!1,nt.mount("notifications",{items:t})),a(t)}function o(t){bt=t,nt.mount("notifications",{items:[]})}function a(t){var e=document.querySelector(".notification-items");Z=c(t),Z>yt&&(rt.remove(document.getElementById("not-num"),"new-notifications"),rt.remove(document.getElementById("notification-link"),"swing"),G.offsetWidth,rt.add(V,"new-notifications"),rt.add(document.getElementById("notification-link"),"swing"),yt=Z),K.hide(),bt=t,Y.check(z),ht.check(),pt.track({internal:{region:document.querySelectorAll(".notification__item--js"),linkLocation:"notifications"}}),N(e,function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;for(var e=t.target||t.srcElement;e&&e.tagName&&"li"!==e.tagName.toLowerCase();)e=e.parentNode;if(e&&e.parentNode){var i=[].indexOf.call(e.parentNode.children,e),n=B.at(i);rt.hasClass(e,"notification-new")&&yt--,W.checkOrAdd(n.id),pt.log("click","notifications-item",{notifications_id:n.id,notifications_state:""===n.get("newItem")?"read":"new",notifications_priority:(n.get("priority")||"normal").toLowerCase(),notifications_product:n.get("product").toLowerCase(),notifications_type:n.get("type").toLowerCase(),notifications_title:n.get("notification").title,topic_name:pt.serialiseTopic(n.get("topic"))}),bt[i].newItem="",nt.update(),"undefined"!=typeof W&&P({readFilter:"undefined"!=typeof W.filter?W.getCleanArray():null,lastReadFlag:!1},function(){"a"===e.firstElementChild.tagName.toLowerCase()&&window.location.assign(e.firstElementChild.href)})}}),nt.update(),L("updateDrawerHeight"),s()}function s(){var t,e=ct.getInstance(),i=document.querySelectorAll(".notification__item--js");return e.accessLinkEntered?(t=bt.length-bt.length%gt,e.accessLinkEntered=!1,e.clearAccessLinkFocus(),void(i[t]&&i[t].focus())):(e.updateNextFocus(document.querySelector(".notification-item")),e.updateIconHiddenText(Z>0?"New notifications":"No new notifications"),void(_t>0&&("hidden"!==H.getDrawerState()?e.updateIconAriaLiveText("New Notification available."):e.updateIconAriaLiveText('New Notification. To view open the "Notification Panel" link.'))))}function r(t){for(var e=0,i=t.length;i>e;e++)W.contains(t[e].id)?t[e].newItem="":new Date(it)-new Date(t[e].creationTimestamp)<0?t[e].newItem="notification-new":t[e].newItem="notification-unread";return t}function c(t){return t.filter(function(t){return"notification-new"===t.newItem}).length}function l(t,e){e.setHubSettings(t||{}),z=document.getElementById("notifications-wrapper"),V=document.getElementById("not-num"),G=document.getElementById("notification-link"),q(),x(),i(),m(".spinner"),p(G),g({el:document.querySelector(".notifications-pop-up"),containerEl:document.querySelector(".notifications__header--js"),notificationItemsSelector:".notification__item--js",wrapperEl:z,mainApp:H}),t.resizeEvent(h),b(z),u(),d(vt.errorView),f()}function d(t){et=t,et.changeView("hub")}function f(){tt=st({riot:nt,mainApp:H,errorView:et,stateChanged:function(t,e){var i=document.querySelector(".notifications-main--js");i.style.display="shown"==t?"none":"block","hidden"===t&&tt.setSettingsIconFocus(),"hidden"!==H.getDrawerState()&&e&&(h(),H.updateDrawerHeight())}}),tt.init()}function u(){ct.getInstance().init({iconHiddenTextEl:G.querySelector(".hidden-span"),iconAriaLiveEl:G.querySelector(".notification-link__live--js"),_getdrawerStateChecker:function(){return function(){return H.getDrawerState.call(H)}},_getNotificationCollection:function(){return B},nextActionCallback:function(){M(D),K.show(),z.scrollTop=z.scrollHeight,B.getNextPage(),O(!0),this.accessLinkEntered=!0},gotoTopActionCallback:function(t){t.preventDefault&&t.preventDefault(),this.updateNextFocus(document.querySelector(".notification-item")),z.scrollTop=0}})}function h(){var t,e,i,n=420;Q=window.innerWidth,$=NotificationsModernizr.touchevents||v()?.75:.65,e=document.querySelector(".orb-nav-pri-container"),i=null!==e?e.offsetHeight:0,t=window.innerHeight*$-i-document.querySelector(".notifications__header--js").offsetHeight,NotificationsModernizr.touchevents||v()||(t=Math.min(t,n)),z.style.maxHeight=t+"px",L("updateDrawerHeight"),Y&&Y.check(z)}function p(t){rt.add(t,"animated"),rt.add(t,"three")}function g(t){ht.init(t)}function m(t){K={selector:t,state:"hidden",getEl:function(){return document.querySelector(this.selector)||{style:{}}},hide:function(){this.getEl().style.display="none",this.setState("hidden")},show:function(){this.getEl().style.display="block",this.setState("shown"),L("updateDrawerHeight")},setState:function(t){this.state=t},getState:function(){return this.state}}}function v(){return-1!==navigator.appVersion.indexOf("Win")&&"undefined"!=typeof window.navigator.pointerEnabled&&null!==navigator.userAgent.match(/.+windows.+(touch|phone).+/i)}function b(t){Y={enabled:!1,endOfScrollTimestamp:Date.now(),endOfScrollDelayMilliseconds:300,enable:function(t){dt.removeEvent(t,"scroll",C),dt.addEvent(t,"scroll",C),NotificationsModernizr.touchevents||v()?(dt.removeEvent(t,"touchstart",y),dt.removeEvent(t,"touchmove",w),dt.removeEvent(t,"pointerdown",y),dt.removeEvent(t,"pointermove",w),dt.addEvent(t,"touchstart",y),dt.addEvent(t,"touchmove",w),dt.addEvent(t,"pointerdown",y),dt.addEvent(t,"pointermove",w),rt.add(t,"notifications--touch")):(dt.removeEvent(t,"mousewheel",_),dt.addEvent(t,"mousewheel",_),dt.removeEvent(t,"mousewheel",C),dt.addEvent(t,"mousewheel",C),dt.removeEvent(t,"DOMMouseScroll",_),dt.addEvent(t,"DOMMouseScroll",_),dt.removeEvent(t,"DOMMouseScroll",C),dt.addEvent(t,"DOMMouseScroll",C)),rt.remove(t,"notifications-no-scroll"),this.enabled=!0},disable:function(t){dt.removeEvent(t,"scroll",C),NotificationsModernizr.touchevents||v()?(dt.removeEvent(t,"touchstart",C),dt.removeEvent(t,"touchmove",C),dt.removeEvent(t,"touchstart",y),dt.removeEvent(t,"touchmove",w),dt.removeEvent(t,"pointerdown",y),dt.removeEvent(t,"pointermove",w),rt.remove(t,"notifications--touch")):(dt.removeEvent(t,"mousewheel",_),dt.removeEvent(t,"DOMMouseScroll",_),dt.removeEvent(t,"mousewheel",C),dt.removeEvent(t,"DOMMouseScroll",C)),rt.add(t,"notifications-no-scroll"),rt.remove(document.querySelector("#notifications__header"),"shadowAdded"),this.enabled=!1},check:function(t){var e=function(){return t.offsetHeight>=parseInt(t.style.maxHeight,10)},i="notification__windows-scroll";e()||B.models.length>=at.env.visibleChunkAmount?(this.enabled||this.enable(t),(NotificationsModernizr.touchevents||v())&&(t.tabIndex="0",t.style.outline="none",t.focus()),(-1!==navigator.appVersion.indexOf("Win")&&!v()||-1!==navigator.appVersion.indexOf("Linux"))&&rt.add(t,i)):(this.enabled&&this.disable(t),(-1!==navigator.appVersion.indexOf("Win")&&!v()||-1!==navigator.appVersion.indexOf("Linux"))&&rt.remove(t,i))},_isSafari:function(){var t=navigator.userAgent.toLowerCase();return t.indexOf("safari")>-1&&-1===t.indexOf("chrome")},_checkFixSafari7Scroll:function(){var t;this._isSafari()&&(t=document.createElement("style"),t.type="text/css",t.innerHTML="#notifications-wrapper::-webkit-scrollbar {     -webkit-appearance: none;     width: 8px; }  #notifications-wrapper::-webkit-scrollbar-track {     background-color: transparent;     border-radius: 8px; }  #notifications-wrapper::-webkit-scrollbar-thumb {     border-radius: 8px;     background-color: rgba(0, 0, 0, .6); }",document.head.appendChild(t))},setEndOfScrollTimestamp:function(t){this.endOfScrollTimestamp=t},init:function(t){this._checkFixSafari7Scroll(),this.enable(t)}},Y.init(t)}function y(t){X=window.navigator.pointerEnabled?t.clientY:t.targetTouches[0].pageY}function w(t){var e=(window.navigator.pointerEnabled?t.clientY:t.changedTouches[0].pageY)-X;v()&&(this.scrollTop-=(Math.abs(e)<10?20*(0>e?-1:1):e)/20),E.call(this,t,e)}function _(t){var e=t.wheelDelta||-t.detail;rt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),E.call(this,t,e)}function E(t,e){var i=this.scrollTop+30>=this.scrollHeight-this.offsetHeight;(i||"shown"===K.getState())&&0>=e&&(this.scrollTop=this.scrollHeight,k.call(this,t))}function k(t){var e;if(this.scrollTop+30>=this.scrollHeight-this.offsetHeight&&B.hasItemsToLoad()&&!B.fetchInprogress){if(Date.now()-Y.endOfScrollTimestamp<Y.endOfScrollDelayMilliseconds)return;if(Y.setEndOfScrollTimestamp(Date.now()),K.show(),B.getNextPage(),e=document.querySelectorAll(".notification__item--js"),e.length>0){var i=Array.prototype.slice.call(e,-1)[0];rt.add(i,"notification-border")}"function"==typeof t.preventDefault&&t.preventDefault()}}function C(t){ht.check(),rt[this.scrollTop>0?"add":"remove"](document.getElementById("notifications__header"),"shadowAdded"),v()||k.call(this,t)}function x(){S(function(t,e){return t?ft.error("Error:",e):void 0})}function S(t){if("undefined"==typeof B){var e={userPreferencesModel:U,idcta:J};B=ot.getCollectionInstance(U,e),B.on("notification.latest.update",I),B.on("notification.new.page.ready",I),B.on("notification.load.error",T),B.getNextPage(),"function"==typeof t&&t(null,"success")}}function I(t,e){var i=300;e.newLatestItemsCount>0?(_t=e.newLatestItemsCount,ht.unseenLatestDataCount+=_t):_t=0,setTimeout(function(){n(e.content||[])},i)}function T(t){et.showError({view:"hub",isInner:!1,errorElID:"#hub-error-main"}),ct.getInstance().setErrorTitle(".show .notifications-error__header--text")}function A(t){var e=null!==t.preferences?t.preferences.readFilter:[],i=lt.goBackDays(mt);"string"==typeof e&&(e=ut.handledParse(e,[])),W.override(e),it=null!==t.preferences&&"undefined"!==t.preferences.lastRead?t.preferences.lastRead:i.toISOString(),R=null!==t.preferences&&"undefined"!=typeof t.preferences.currentDateTime?t.preferences.currentDateTime:(new Date).toISOString(),lt.setTime(R),nt.update(r(bt))}function P(t,e){U.sync({preferences:t},function(t,i){t&&ft.log("Error syncing user preferences",arguments),"function"==typeof e&&e(t,i)})}function L(t){return"undefined"==typeof H&&"function"==typeof H[t]?null:H[t]()}function N(t,e){dt.removeEvent(t,"click",e),dt.addEvent(t,"click",e)}function j(t){var e=function(){return 0===bt.length?"none":c(bt)>0?"new":"read"};"hidden"===t?(rt.remove(document.getElementById("not-num"),"new-notifications"),M(D),nt.update(bt),pt.log("close-pane","notifications-icon"),O(!0),tt&&tt.hide(!1)):(h(),Y&&Y.check(z),pt.log("open-pane","notifications-icon",{notification_state:e()}),rt.remove(document.getElementById("notification-link"),"swing"),rt.remove(document.querySelector(".notification-panel"),"has-new"),yt=0,O(!0,function(t,e){t&&et.showError({view:"hub",isInner:!0,closeEvent:function(){et.hideError("hub",!1)},errorElID:"#hub-error-inner",closeEl:".notifications-error--inner__close"})}))}function M(t){if(!wt)for(var e=document.querySelectorAll(".notification-items li"),i=e.length;i--;)t(i,e)}function D(t,e){rt.hasClass(e[t],"notification-new")&&(rt.remove(e[t],"notification-new"),rt.add(e[t],"notification-unread"),bt[t].newItem="notification-unread",rt.remove(document.getElementById("notification-link"),"swing"))}function O(t,e){"undefined"!=typeof W&&P({readFilter:"undefined"!=typeof W.filter?W.getCleanArray():null,lastReadFlag:t},e)}function q(){var t=document.querySelector(".notifications__settings--js");pt.listenTo(t,"click",F)}function F(t){t.preventDefault?t.preventDefault():t.returnValue=!1,this.log("click","notifications-settings")}Array.prototype.forEach=Array.prototype.forEach||function(t){for(var e=-1;++e<this.length;)t(this[e],e)};var R,H,U,B,z,G,V,W,J,K,X,Y,$,Z,Q,tt,et,it,nt=t("mybbc/notifications/vendor/riot.min"),ot=t("mybbc/notifications/collections/NotificationCollectionFactory"),at=t("mybbc/notifications/config"),st=(t("mybbc/notifications/BloomFilterManager"),t("mybbc/notifications/SettingsView")),rt=t("mybbc/notifications/classie"),ct=t("mybbc/notifications/AccessibilityManager"),lt=t("mybbc/notifications/DateManager"),dt=(t("mybbc/notifications/PreferencesClient"),t("mybbc/notifications/eventie")),ft=(t("mybbc/notifications/UserPreferences"),new(t("mybbc/notifications/logger"))("Main App")),ut=new(t("mybbc/notifications/utils"))(ft),ht=t("mybbc/notifications/popup"),pt=t("mybbc/notifications/analytics"),gt=at.env.visibleChunkAmount,mt=at.env.maxNotificationAge,vt={},bt=[],yt=0,wt=!0,_t=0,Et={init:function(t){"undefined"!=typeof this.name&&"mainApp"==this.name&&(H=this),l.call(null,t,Et)},drawerStateChanged:function(t){j(t)},setHubSettings:function(t){vt=t,vt.baseAssetUrl=t.baseAssetUrl||"",J=t.idcta,U=t.userPreferencesModel,W=t.readFilter},updateVariables:A,userPreferencesModel:U};return Et}),define("mybbc/notifications/NotificationsMain",["require","mybbc/notifications/config","orb/nav","mybbc/notifications/analytics","mybbc/notifications/classie","mybbc/notifications/eventie","mybbc/notifications/utils","mybbc/notifications/PreferencesClient","mybbc/notifications/UserPreferences","mybbc/notifications/request","mybbc/notifications/BloomFilterManager","mybbc/notifications/logger","mybbc/notifications/StorageManager","mybbc/notifications/LocalStorageCache","mybbc/notifications/ErrorView","mybbc/notifications/NotificationsTemplate","mybbc/notifications/vendor/modernizr-custom"],function(t,e,i,n,o,a,s,r,c,l,d,f,u,h,p,g){var m,v,b,y,w=new f("App container"),_=new d("readFilter"),E=".notification-error__container",k=!1,C=new u("cachedPreferences"),x=new s,S={},I="preferencesUserId",T={name:"mainApp",drawerName:"notifications",errorState:!1,notificationPanelCreated:!1,orb:i,idConfig:e.env.idcta,userIdCache:h(I),run:function(t,i){this.basePath=i||"",this.setIdcta(t),this.setUserLoggedState(),this.manageLocalCache(),this.setNotificationIcon(),this.setErrorView(),"signed-in"===this.state?(this.setUserPreferencesModel(new c({client:new r(l,{config:e}),filter:_,cacheManager:C,idcta:this.idcta})),this.getUserPreferencesModel().fetch(x.bind(this.onUserPreferencesFetchFinished,this))):this.loadInitialTemplate()},manageLocalCache:function(){C.init(),"signed-out"==this.state?(C.clear(),this.userIdCache.clear()):"signed-in"==this.state&&(this.userHasChanged()&&C.clear(),this.userIdCache.put(this.idcta.getIdFromCookie()))},userHasChanged:function(){var t=this.userIdCache.get();return null!==t&&t!==this.idcta.getIdFromCookie()},onUserPreferencesFetchFinished:function(t,e){return t&&!C.hasCache()?(null===document.querySelector(E)&&this.prepareAndShowErrorView(),this.errorState=!0,w.log("Error reading user preferences and we have no cached value, so show the error message",arguments)):(this.getUserPreferencesModel().isPolling||this.getUserPreferencesModel().poll(x.bind(this.onUserPreferencesPollFinished,this)),void this.loadInitialTemplate())},_setHubResizeEvent:function(t){var e;["resize","orientationchange"].forEach(function(i){(NotificationsModernizr.touchevents||"orientationchange"!==i)&&a.addEvent(window,i,function(){e&&clearTimeout(e),e=setTimeout(t,100)})}),"function"==typeof t&&t()},prepareAndShowErrorView:function(){this.createPanel('<section class="%s"></section>'.replace("%s",E.slice(1))),y.showError({view:"main",isInner:!1,errorElID:"#hub-error-main"})},loadInitialTemplate:function(){this.loadTemplate(this.getTemplateNameByUserState(this.state),this.manageState)},onUserPreferencesPollFinished:function(t,e){return t?w.log("Error reading user preferences",arguments):void this.handleUserPreferencesResponse(e)},handleUserPreferencesResponse:function(t){"undefined"!=typeof m&&m.updateVariables(t)},setIdcta:function(t){"function"==typeof t.getInstance&&(t=t.getInstance()),this.idcta=t},setUserLoggedState:function(){this.state=this.idcta.hasCookie()?"signed-in":"signed-out"},setNotificationIcon:function(){var t=function(){var t=document.createElement("span");return t.setAttribute("aria-live","polite"),t.className="notification-link__live notification-link__live--js",t};this.navNotificationElement=document.querySelector(".js-notification-link"),this.navNotificationElement.onkeydown=function(t){var e=t.which||t.charCode;13==e&&(this.lastEnterPress=Date.now())},this.navNotificationElement.appendChild(t()),o.add(this.navNotificationElement,"notifications-shown"),this.orb.refresh(),"signed-in"===this.state||"on-boarding"===this.state?o.add(this.navNotificationElement,"notifications-black-bell"):o.add(this.navNotificationElement,"notifications-grey-bell")},getNavNotificationEl:function(){return this.navNotificationElement},prepareAndLaunchNotificationApp:function(){this.loadTemplate("signed-in",function(t){this.updateDrawerContent(t.compile(this.getTemplateData(t.name))),this.launch(function(){"hidden"===this.getDrawerState()&&this.navNotificationElement.click()})})},loadTemplate:function(t,e){"undefined"==typeof S[t]?(S[t]=g.create(t),S[t].load(e,this)):e.call(this,S[t].compile(this.getTemplateData(S[t].name)))},getTemplateData:function(t){var e,i=this;return e={"signed-in":{baseAssetUrl:i.basePath},"signed-out":{idConfig:i.idConfig,ptrt:encodeURIComponent(window.location.href.replace(window.location.hash,""))},"on-boarding":{baseAssetUrl:i.basePath}},"undefined"!=typeof t&&t in e?e[t]:e},getTemplateNameByUserState:function(){return"signed-in"!==this.state||this.isUserOnBoarded()?this.state:"on-boarding"},isUserOnBoarded:function(){var t=this.getUserPreferencesModel(),e=t.get().preferences;return null!==e&&"undefined"!=typeof e[c.HAS_ON_BOARDED_PARAM_NAME]?e[c.HAS_ON_BOARDED_PARAM_NAME]:!1},manageState:function(t){this.createPanel(t.compile(this.getTemplateData(t.name))),"signed-in"===this.state?this.isUserOnBoarded()?this.launch():this.manageBlueDotDisplay(!0):this.setUpsellAnalyticsEvents()},launchOnBoarding:function(){var e=this;t(["mybbc/notifications/onboarding"],function(t){v=t,v.init(e.getOnboardingParams()),"function"==typeof cb&&cb(v)})},getOnboardingParams:function(){return{mainElSelector:".notifications-on-boarding--js",app:this,isIE:this.isIE(),errorView:y,resizeEvent:this._setHubResizeEvent}},createPanel:function(t){this.orb.addDrawer(this.drawerName,this.getNavNotificationEl(),this.getPanelContentEl(t),this.getDrawerStateChangedCallback()),this.notificationPanelCreated=!0},getPanelContentEl:function(t){if("undefined"!=typeof this.drawerContentEl)return this.drawerContentEl;var e=document.createElement("div");return e.className="orb-panel",e.innerHTML=t,this.drawerContentEl=e,e},launch:function(e){var i=this;t(["mybbc/notifications/app"],function(t){m=t,m.init.call(i,{baseAssetUrl:i.basePath,readFilter:_,userPreferencesModel:b,errorView:y,resizeEvent:i._setHubResizeEvent,idcta:i.idcta}),m.updateVariables(i.getUserPreferencesModel().get()),"function"==typeof e&&e.call(i,m)})},getMainContainerEl:function(){return document.querySelector(".notifications-main--js")},setUpsellAnalyticsEvents:function(){n.listenTo(this.getMainContainerEl(),"click",this.onWatchedAnalyticsElementClicked)},onWatchedAnalyticsElementClicked:function(t){var e=t.target,i=this,n={"sign-in":"notifications-sign-in__link--js",register:"notifications-register__link--js"};x.each(n,function(n,a){(o.hasClass(e,n)||e.parentNode&&o.hasClass(e.parentNode,n))&&(t.preventDefault?t.preventDefault():t.returnValue=!1,i.log(a,"notifications-upsell"),window.location.href="A"==e.tagName?e.href:e.parentNode.href)})},setUserPreferencesModel:function(t){b=t},setErrorView:function(t){var e=this;y=t||p({showErrorWithID:"#hub-error-main",mainApp:e,container:E,stateChanged:function(t){var e,i;if(!this.isInner){switch(this.currentErrorView){case"hub":e=document.querySelector(".notifications-main--js"),null!==e&&(e.style.display="shown"==t?"none":"block");break;case"onboarding":i=document.querySelector(".notifications-on-boarding--js"),null!==i&&(i.style.display="shown"==t?"none":"block")}this.mainApp.updateDrawerHeight()}}})},getErrorView:function(){return y},getUserPreferencesModel:function(){return b},getReadFilter:function(){return _},getCacheManager:function(){return C},updateDrawerContent:function(t){this.getPanelContentEl().innerHTML=t},updateDrawerHeight:function(){this.orb.updateDrawerHeight(this.drawerName)},getDrawerState:function(){return this.orb.getDrawerState(this.drawerName)},manageBlueDotDisplay:function(t){o[t?"add":"remove"](document.getElementById("not-num"),"new-notifications")},resetOnboarding:function(){v.resetOnboarding(),v.init(this.getOnboardingParams())},isIE:function(){if(document.documentMode)return document.documentMode;for(var t=7;t>0;t--){var e=document.createElement("div");if(e.innerHTML="<!--[if IE "+t+"]><span></span><![endif]-->",e.getElementsByTagName("span").length)return t}},removeCustomHeights:function(){v.removeCustomHeights()},getDrawerStateChangedCallback:function(){var t=this;return function(e){if("signed-in"===t.state){if("undefined"!=typeof m)return m.drawerStateChanged(e);t.isUserOnBoarded()||v||t.errorState||(t.manageBlueDotDisplay(!1),t.launchOnBoarding()),v&&("hidden"===e?k=!0:k&&(t.resetOnboarding(),k=!1))}else"hidden"===e?n.log("close-pane","notifications-icon"):n.log("upsell","notifications-icon")}}};return T}),define("NotificationsMain",["mybbc/notifications/vendor/modernizr-custom","mybbc/templates/signed-in","mybbc/templates/signed-out","mybbc/templates/on-boarding","mybbc/templates/error","mybbc/notifications/ErrorView"],function(){});