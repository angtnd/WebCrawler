KISSY.add("tbc/search-suggest/1.4.8/plugin/tab",function(t,a,o,e,r,s){function i(t){i.superclass.constructor.call(this,t||{})}return KISSY.extend(i,o,{pluginInitializer:function(t){this.tabConfig={},this._initPluginEvent.call(this,t)},tabClick:function(t){var o,r,s=this,i=s.get("caller"),c=t.currentTarget,n=e.attr(c,"data-searchtype"),l=e.attr(c,"data-defaultpage"),g=e.attr(c,"data-action"),u=i.comboBox.get("input"),f=e.parent(u,"form"),b=s.get("activeCls"),d=e.get("label",f),C=s.tabConfig;if(i.fire("beforeTabChange",{el:c,labelType:n})===!1)return!1;if(e.removeClass(e.siblings(c),b),e.addClass(c,b),i.tabNode=a.one(c),l&&f.setAttribute("data-defaultpage",l),g&&f.setAttribute("action",g),n){if(r=C[n]||s.getDefCfg(n),!r)return!1;g&&(r.action=g),i.update(r),s.tabConfig&&!s.tabConfig[n]&&s.saveTabConfig(r)}else{var m=i.query||u.val(),h=e.get("a",c);if(h){var p=e.attr(h,"href");p=p.replace("/?","/search?"),p=p+"&q="+m,e.attr(h,"href",p)}}d&&(o=d.getAttribute("data-searchtype-"+n)||"",d.innerHTML=o),t.preventDefault()},_initPluginEvent:function(t){var o=this,e=o.get("activeCls"),s=o.get("node")||t.get("sugConfig").tablist;o.set("caller",t),s&&(r.on(s,"click",o.tabClick,o),a.all(s).each(function(a,o){a.hasClass(e)&&(t.tabNode=a)}),o.saveTabConfig())},saveTabConfig:function(t){var a,o,e=this,r=e.get("caller"),s=r.get("form");a=r.tabNode.attr("data-searchtype"),o=r.userConfig||{},o.mods=r.get("mods"),o.tab=a,o.action=s.attr("action"),o.defaultpage=s.attr("data-defaultpage"),e.tabConfig||(e.tabConfig={}),e.tabConfig[a]=KISSY.clone(o),t&&t.sugConfig&&t.sugConfig.sourceUrl&&e.tabConfig[a].sugConfig&&(e.tabConfig[a].sugConfig.sourceUrl=t.sugConfig.sourceUrl,e.tabConfig[a].tab=a)},update:function(t){var a,o,r,i=this,c=i.get("caller"),n=c.comboBox,l=t.tab,g=c.configArr[l],u=t.sugConfig,f=n.get("input"),b=e.parent(f,"form");c.configArr=c.configArr||[],o=c.get("dataSourceCfg"),r=o.xhrCfg,r.url=u.sourceUrl,c.__attrVals.mods.sort=t.mods.sort,g||(g=c.configArr[l]=""===r.url?{data:new s.LocalDataSource({data:{},parse:o.parse})}:{data:new s.RemoteDataSource(o)}),a=g.data,n.set("maxItemCount",r.url?10:0),n.set("dataSource",g.data),b&&e.attr(b,"action",t.action),f[0].focus();var d=f.val();d&&n.sendRequest(d)},getDefCfg:function(t){var a;switch(t){case"shop":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=ssrch&k=1",resultFormat:"",tab:"shop",excludeParam:["q"]},mods:{sort:["history","list"],showExtra:!1},action:location.protocol+"//shopsearch.taobao.com/search",tab:"shop"};break;case"item":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:"item",excludeParam:["q"]},mods:{sort:["history","cat","global","list","shop"]},tab:"item",action:location.protocol+"//s.taobao.com/search"};break;case"mall":a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=b2c&k=1",resultFormat:"",tab:"mall",excludeParam:["q"]},mods:{sort:["history","cat","global","list"]},tab:"mall",action:location.protocol+"//list.tmall.com/search_product.htm"};break;default:KISSY.isObject(t)?(a=t,a.sugConfig||(a.sugConfig={})):KISSY.isString(t)&&(a={sugConfig:{sourceUrl:location.protocol+"//suggest.taobao.com/sug?area=c2c&k=1",resultFormat:"",tab:t,excludeParam:["q"]},mods:{sort:["history","list"]},action:null})}return a.sugConfig&&!a.sugConfig.tab&&(a.sugConfig.tab=a.sugConfig.sourceUrl),a}},{ATTRS:{pluginId:{value:"tab"},caller:{value:null}}}),i},{requires:["node","base","dom","event","combobox"]});