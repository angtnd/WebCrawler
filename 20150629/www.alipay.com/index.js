!function(){var e;e=function(){"use strict";function e(e){return e?r?r.call(e):(""+e).replace(/^\s+|\s+$/g,""):e}var t=window.PAGE_TIMING||{},n=function(){this.config={rate:6,resourceRate:2,filterRegular:"googlebot|bingbot|yahoo|baidu"},this.context={isSend:!1,timing:null}},r=String.prototype.trim;n.prototype={init:function(e){this.config=e||this.config;var n=this;if(!t.receiverUrl)return!1;try{document.addEventListener?window.addEventListener("load",function(){n._onloadAction.apply(n)},!1):document.attachEvent&&window.attachEvent("onload",function(){n._onloadAction.apply(n)})}catch(r){}},_onloadAction:function(){if(this._validate()){var e=this;setTimeout(function(){e.context.isSend||(e._send(),e.context.isSend=!0)},100)}},_validate:function(){if(!this._filter())return!1;var e=this.config.rate;return this._lottery(e)?!0:!1},_lottery:function(e){var t=Math.floor(100*Math.random())%10,n=!1;return 0===e?n=!1:e>=t&&(n=!0),n},_lotteryResource:function(e){var t=Math.floor(1e3*Math.random())%100,n=!1;return 0===e?n=!1:e-1>=t&&t>=0&&(n=!0),n},_serial:function(e){var t=[];for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&")},_send:function(){var e={userInfo:this._getUserInfo(),pageInfo:this._getPageInfo(),pageTimeingInfo:this._getPageTiming()},n=this._serial(e.userInfo)+"&"+this._serial(e.pageInfo)+"&"+this._serial(e.pageTimeingInfo),r=new Image;r.onload=function(){r=null},r.src=t.receiverUrl+"?"+n;try{this._sendResource()}catch(i){}},_serialResource:function(e){var t=[],n="|-|";for(var r in e)t.push(r+"="+encodeURIComponent(e[r]));return t.join(n)},_sendResource:function(){if("performance"in window&&"getEntriesByType"in window.performance&&window.performance.getEntriesByType("resource")instanceof Array){var e=this.config.resourceRate,t=this._lotteryResource(e);if(t){var n=this._getResourceTiming(),r=50;if(n.length>r){for(var i=[],o=[],a=0;a<n.length;a++)r>a?i.push(n[a]):o.push(n[a]);this._sendResourceData(i,1,2),this._sendResourceData(o,2,2)}else this._sendResourceData(n,1,1)}}},_sendResourceData:function(e,n,r){for(var i={pageInfo:this._getPageId(),resourceTimeingInfo:e,index:{index:n},total:{total:r}},o="|--|",a=this._serial(i.pageInfo)+o+this._serial(i.index)+o+this._serial(i.total)+o+"resoucecount="+i.resourceTimeingInfo.length,s=0;s<i.resourceTimeingInfo.length;s++)a+=o+this._serialResource(i.resourceTimeingInfo[s]);var c="new-page-timing-iframe"+n;if(!document.getElementById(c)){var d=document.createElement("div");d.innerHTML='<iframe width="0" height="0" id="'+c+'" name="'+c+'" frameBorder="0" style="top: -100%; position: absolute;"></iframe>',document.body.appendChild(d);var u=document.createElement("form");u.style.display="none",u.target=c,u.method="POST",u.action=t.receiverUrl;var g=document.createElement("input");g.type="hidden",g.name="resourcetiming",g.value=a,u.appendChild(g),document.body.appendChild(u),u.submit()}},_filter:function(){var e=navigator.userAgent.toLowerCase();return new RegExp(this.config.filterRegular).test(e)?!1:window.performance&&window.performance.timing?(this.context.timing=window.performance.timing,!0):!1},_getCookie:function(t){var n="(?:; )?"+t+"=([^;]*);?",r=new RegExp(n);if(r.test(document.cookie)){var i=decodeURIComponent(RegExp.$1);return e(i).length>0?i:"-"}return"-"},_getUserInfo:function(){var e={},t="",n=!0,r=this._getCookie("xman_us_f");"-"===r&&(r="");var i=/x_user=([^&"]+)/;return r&&i.test(r)&&(r.match(i),r=RegExp.$1,r=r.split("|"),r.length>=5&&(t=r[4])),n=""!==t?!1:!0,e.memberSeq=t,e.isNewUser=n,e},_getPageId:function(){return{pageId:t.pageId,parentPageId:t.parentPageId}},_getPageInfo:function(){return{pageId:t.pageId,parentPageId:t.parentPageId,pageType:t.pageType,site:t.site}},_getPageTiming:function(){var e=this.context.timing,t={ns:e.navigationStart,ules:e.unloadEventStart,ulee:e.unloadEventEnd,rs:e.redirectStart,re:e.redirectEnd,fs:e.fetchStart,dls:e.domainLookupStart,dle:e.domainLookupEnd,cs:e.connectStart,ce:e.connectEnd,scs:e.secureConnectionStart||0,resqs:e.requestStart,resps:e.responseStart,respe:e.responseEnd,dl:e.domLoading,di:e.domInteractive,dcles:e.domContentLoadedEventStart,dclee:e.domContentLoadedEventEnd,domc:e.domComplete,les:e.loadEventStart,lee:e.loadEventEnd,srt:this._getStartRenderTiming(),fst:this._getFirstPageTiming()};return t},_getResourceTiming:function(){var e=[],t=window.performance.getEntriesByType("resource"),n=function(e){return void 0===e||0===e?0:Math.floor(e)};for(var r in t){var i=t[r];void 0!==i.initiatorType&&e.push({rs:n(i.redirectStart),re:n(i.redirectEnd),fs:n(i.fetchStart),st:n(i.startTime),dls:n(i.domainLookupStart),dle:n(i.domainLookupEnd),cs:n(i.connectStart),ce:n(i.connectEnd),scs:n(i.secureConnectionStart),resqs:n(i.requestStart),resps:n(i.responseStart),respe:n(i.responseEnd),restype:i.initiatorType,n:i.name})}return e},_getStartRenderTiming:function(){var e=this.context.timing,n=t.startRender;return e.msFirstPaint&&e.msFirstPaint>0?e.msFirstPaint:window.chrome&&"function"==typeof window.chrome.loadTimes&&window.chrome.loadTimes().firstPaintTime>0?Math.ceil(1e3*window.chrome.loadTimes().firstPaintTime):n>0?n:0},_getFirstPageTiming:function(){var e=t.firstScreen;return e>0?e:0}},(new n).init()}()}();