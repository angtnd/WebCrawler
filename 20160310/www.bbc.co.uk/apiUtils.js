define(["idcta/es6-promise"],function(c){var b={};b.verifyEndpointUrl=function(d,f){if(f!==false){f=true}var g=new RegExp(/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/);if(g.test(d)){if(new RegExp(/(\.com|\.co\.uk)\/.+/).test(d)){d=d.split(/(\.com|\.co\.uk)\/.+/)[0]+d.split(/(\.com|\.co\.uk)\/.+/)[1]}return d}var h="";if(d.slice(0,5)=="https"){h+=((f?"https://":"")+"ssl.");if(d.indexOf(".sandbox.")>-1){h+="sandbox.dev."}}else{h+=((f?"http://":""));if(d.indexOf(".sandbox.")>-1){h+="pal.sandbox.dev."}else{h+="www."}}var e=["int","test","stage"];for(i=0;i<e.length;i++){if(d.indexOf("."+e[i]+".")>-1){h+=e[i]+"."}}if(new RegExp(/\.co\.uk/).test(d)){h+="bbc.co.uk"}else{h+="bbc.com"}return h};b.modifyTLD=function(f,d){var h=d||window.location.hostname;var g=h.split(/(\.com|\.co\.uk)$/)[1];var e=f.split(/(\.com|\.co\.uk)\/.+/)[1];if(e!==g&&g!==undefined){f=f.replace(e,g)}return f};b.buildIdappResourceUrl=function(e,d){var g;var f;if(RegExp(/^https/).test(e)){g="https"}else{g="http"}if(new RegExp(/\.sandbox\./).test(e)){f="sandbox.dev."}else{if(new RegExp(/\.int\./).test(e)){f="int."}else{if(new RegExp(/\.test\./).test(e)){f="test."}else{if(new RegExp(/\.stage\./).test(e)){f="stage."}else{f=""}}}}return g+"://static."+f+(g==="https"?"bbc":"bbci")+".co.uk/idapp/"+d+"/modules/idapp/idapp-1"};function a(){if(typeof Promise!=="undefined"){return Promise}return c.Promise}b.Promise=a();b.loadUrlInHiddenIframe=function(f,e,d){return new b.Promise(function(j,h){var g=document.createElement("iframe");g.scrolling="no";g.frameborder="0";g.width="0px";g.height="0px";g.border="0px";g.style.display="none";g.style.frameBorder="0px";g.style.borderStyle="none";var m=null;var k=function(o){var n=o.message?"message":"data";if(!o.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)||d.indexOf(o[n])==-1){return}l();return j(o[n])};var l=function(){if(m){clearTimeout(m)}if(d){b.removeEventListener("message",k)}document.body.removeChild(g)};if(d){b.addEventListener("message",k)}else{g.onload=function(){l();return j()}}if(e){m=setTimeout(function(){l();return h()},e)}g.src=f;document.body.appendChild(g)})};b.addEventListener=function(e,f,d){if(window.addEventListener){return window.addEventListener(e,f,d)}e=(e=="message")?"onmessage":e;return window.attachEvent(e,f)};b.removeEventListener=function(d,e){if(window.removeEventListener){return window.removeEventListener(d,e)}d=(d=="message")?"onmessage":d;return window.detachEvent(d,e)};b.getHardcodedUrl=function(){var d=window.location.href;if(d.indexOf(".sandbox.")>-1){return"https://ssl.sandbox.dev.bbc.co.uk"}else{if(d.indexOf(".int.")>-1){return"https://ssl.int.bbc.co.uk"}else{if(d.indexOf(".test.")>-1){return"https://ssl.test.bbc.co.uk"}else{if(d.indexOf(".stage.")>-1){return"https://ssl.stage.bbc.co.uk"}else{return"https://ssl.bbc.co.uk"}}}}};b.parseUrl=function(e){var d=document.createElement("a");d.href=e;d.query=(d.search)?b.parseQueryString(d.search):{};return d};b.parseQueryString=function(h){if(h.charAt(0)==="?"){h=h.substring(1)}var e={};var f=h.split("&");for(var d=0;d<f.length;d++){var g=f[d].split("=");e[decodeURIComponent(g[0])]=decodeURIComponent(g[1]||"")}return e};b.timestampInFuture=function(e){var d=Math.floor((new Date()).getTime()/1000);return e>d};b.timestampExpired=function(e){var d=Math.floor((new Date()).getTime()/1000);return e<d};b.generateFutureTimestamp=function(g){var e=(g)?g*1000:(60*60*1000);var f=new Date();f.setTime(f.getTime()+e);return Math.floor(f.getTime()/1000)};b.generateNowTimestamp=function(){var e=new Date();return Math.floor(e.getTime()/1000)};return b});