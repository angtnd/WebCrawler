define(["jquery","OK/logger","OK/cookie"],function(f,x,v){var t="garbagelog",o,u,s,d,i=false,p=false;function w(y){var z=x.repository.getRequestData();if(!z){return;}f.ajax({type:"POST",async:y===undefined||y,url:"/gwtlog",data:z}).always(function(){i=false;if(p){h();}});i=true;}function h(){if(!i){p=false;w();}else{p=true;}}function q(y){var z=y.indexOf(".");return z===-1?y:y.substring(0,z);}function j(y){if(!y){return false;}var z=q(y);if(s.indexOf(z)>=0){return true;}if(s.indexOf(t)>=0){x.success(t,z);}return false;}function b(y){if(!y){return false;}var A=q(y),z=s.indexOf(A);return z>=0&&z<d;}function m(z,C,B,E,A,y,D){if(!j(z)){return;}if(E&&!b(z)){E=null;}if(C){x.repository.addLog(z,parseInt(C,10),B,E,D[0],D[1]);}else{x.repository.addLog(z,null,B,E,D[0],D[1]);}if(A){w();}else{if(y){h();}}}function g(y,z){m(y,null,null,null,false,false,z);}function a(y,z){m(y,null,null,null,false,true,z);}function n(y,z,A){m(y,z,null,null,false,false,A);}function k(y,A,C,z,B){m(y,null,A,C,z,false,B);}function r(){var y=v.readCookie("dme");return(y&&("true"===y.toLowerCase()))||document.getElementById("__gwtd__m");}function l(y,B,A,z){if(r()){window.alert("Fatal Error '"+y+"'\nplace='"+A+"'\nerror name='"+z+"'\nCLOB='"+B+"'");}k(y,null,B,true,[A,z]);}function e(y){var A=parseInt(y.getAttribute("data-interval"),10)||1000,z=y.getAttribute("data-onbeforeunload")==="true";d=parseInt(y.getAttribute("data-clobslen"),10)||0;s=JSON.parse(y.firstChild.textContent);x.error=function(B,C){k("error","",null,false,[C,B]);};x.success=function(B,D,C){g(B,[D,C]);};x.force=function(B,D,C){a(B,[D,C]);};x.duration=function(B,D,E,C){n(B,D,[E,C]);};x.clob=l;x.replayQueue();u=setInterval(h,A);if(z){window.addEventListener("beforeunload",function(){w(false);},false);}}function c(){if(u){clearInterval(u);u=null;}}return{activate:function(y){if(o){return;}e(y);o=true;},deactivate:c};});