_DM.define("DM_Widget_PageItem_Search",function(){var a={version:5,autocomplete_enabled:"0",language:"en",historyCounter:0,checkUserHistory:function(d){try{var c=d.typedValue;if(localStorage&&localStorage.hasOwnProperty("search_history")&&c.length>1){var g=JSON.parse(localStorage.getItem("search_history"));var b=0;$(g).each(function(e,h){if(h.substring(0,c.length)==c){a.checkDuplicateValue(h);d.suggestions.splice(b,0,[h,0,0,[[c.length,h.length-c.length]],0,false]);b++}if(b==2){a.historyCounter=b;return false}});a.historyCounter=b}}catch(f){}},checkDuplicateValue:function(b){$(a.autocomplete.suggestions).each(function(d,c){if(c[0]==b){a.autocomplete.suggestions.splice(d,1);return false}})},updateInput:function(){this.options.appendMode=this.suggestions[this.selectedIndex]&&(this.suggestions[this.selectedIndex][4]>0);return Autocomplete.prototype.updateInput.apply(this,arguments)},suggest:function(){var e=a.autocomplete;if(e.suggestions.length===0){e.updateShadow();log("Search","no suggestions to display, hide container");e.hide();return}var d=($(".suggestions").length)?$(".suggestions").empty():$('<div class="suggestions">');var b="";a.checkUserHistory(e);$(e.suggestions).each(function(k,n){b="";boldString="";var o=0,m=n[3];for(var h=0;h<m.length;h++){var l=m[h];if(o<l[0]){b+=n[0].slice(o,l[0])}o=l[0]+l[1];boldString=n[0].slice(l[0],o);b+="<b>"+boldString+"</b>"}if(o<n[0].length){b+=n[0].slice(o)}var p=e.selectedIndex===k?"selected":"";p=a.historyCounter>0?"history":p;if(a.historyCounter>0){a.historyCounter--}var g=$('<div class="search_suggestion '+p+'" onclick="Autocomplete.instances['+e.instanceId+"].onSelect("+k+')" onmouseover="Autocomplete.instances['+e.instanceId+"].activate("+k+')" >').html(b);d.append(g);$(e.inputRuler).html(n[4]>0?e.inputValue.slice(0,n[4]).replace(/ /g,"&nbsp;"):"");if(k===0){if(n[5]||!boldString){e.updateShadow()}else{e.updateShadow(e.inputValue+boldString)}}else{if(k==9){return false}}});$(e.container).append(d).show();var c=$(e.el),f=c.position();if(e.inputRuler&&$(e.inputRuler).width()!==0){$(e.container).css({left:(f.left+$(e.inputRuler).width())+"px"})}c.addClass("no_border_bottom_left_radius")},postConfigureSearchField:function(d){var b=$("<div>").attr("id","input_ruler"),c=$(d.el);d.inputRuler=b[0];c.after(b.css({position:"absolute",visibility:"hidden",padding:0,margin:0,font:c.css("font")}))},__initialize:function(){$(function(){if(window.DM_Widget_PageItem_Search_autocomplete_enabled==1){var c="/json/complete/"+DM_Widget_PageItem_Autocomplete_locale,b=$(".sd_header__search input[name=search]");if(b[0]){a.autocomplete=new Autocomplete("input_search",{allowRefineLocally:false,serviceUrl:c,deferRequestBy:10,maxChars:30,postConfigureSearchField:a.postConfigureSearchField,cleanStringOnValueChange:false,cleanStringOnProcessResponse:false,withShadow:true,withIframeLayer:true,suggest:a.suggest,updateInput:a.updateInput})}}})}};return a},true);