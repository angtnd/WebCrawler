/*
 app_promo-1.0.0.js
 Copyright (c) 2016 Rakuten.Inc
 Date: 2016-01-15 15:21:49
*/
!function(window,$,undefined){"use strict";function _disableFunctions(a){a.open=$.noop,a.close=$.noop,a.destroy=$.noop,a.hasBeenHidden=$.noop,a.isOpen=$.noop}function sendToCatalyst(a,b,c){var d,e={};return d=b?_options[a+(b.hasBeenHidden()?"_checked":"_unchecked")]:_options[a],_options.sc_enabled&&_options.sc_key&&d?(e[_options.sc_key]=d,R.sendToCatalyst(e)):!0}function lightboxReady(a){function b(a){var b=f,c=g;a?(_options.url_lid_main_link_checked&&(b=R.addUrlParams(f,{"l-id":_options.url_lid_main_link_checked})),_options.url_lid_details_link_checked&&(c=R.addUrlParams(g,{"l-id":_options.url_lid_details_link_checked}))):(_options.url_lid_main_link_unchecked&&(b=R.addUrlParams(f,{"l-id":_options.url_lid_main_link_unchecked})),_options.url_lid_details_link_unchecked&&(c=R.addUrlParams(g,{"l-id":_options.url_lid_details_link_unchecked}))),d.attr("href",b),e.attr("href",c)}var c=a.getContent(),d=c.find(_options.selector_main_link),e=c.find(_options.selector_details_link),f=d.attr("href"),g=e.attr("href");b(a.hasBeenHidden()),c.find(_options.selector_main_link).click(function(){return sendToCatalyst("sc_main_click",a,$(this).attr("href"))}),c.find(_options.selector_details_link).click(function(){return sendToCatalyst("sc_details_click",a,$(this).attr("href"))}),c.find(_options.selector_no_more_cb).bind("change",function(){b(a.hasBeenHidden())})}function lightboxOpened(a){sendToCatalyst("sc_displayed")}function lightboxClosed(a,b){function c(a,b){for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1}var d=a.getContent();c(b.target,d.find(_options.selector_close_link))?sendToCatalyst("sc_close_link",a):c(b.target,d.find(_options.selector_close_btn))?sendToCatalyst("sc_close_bt",a):"keydown"===b.type?sendToCatalyst("sc_esc_key",a):sendToCatalyst("sc_bg_click",a)}function getLightboxOptions(a){var b={closeBg:_options.close_bg,closeEscKey:_options.close_esc_key,autoOpen:!0,autoOpenDelay:a.open_delay,closeButtons:a.selector_close_btn,noMoreCheckbox:a.selector_no_more_cb,parent:a.selector_parent,remoteContent:a.content_url,"class":a.lightbox_class,checkedTtl:a.status_checked_ttl,uncheckedTtl:a.status_unchecked_ttl,onCreate:lightboxReady,onFirstDisplay:lightboxOpened,onClose:lightboxClosed,mockCode:a.mock_code,mockData:a.mock_data,mockDelay:a.mock_delay,mockTimeout:a.mock_timeout};return b}function requiredDataIsSet(a){return 1===$(a.selector_parent).length&&a&&!!a.app_id&&!!a.content_url&&"number"==typeof a.open_delay&&"number"==typeof a.status_checked_ttl&&"number"==typeof a.status_unchecked_ttl}if($&&$.RJS_Helpers){var _settings={selector_config:"#app-promo-config",options:{enabled:[1,"Int"],open_delay:[0,"Int"],content_url:[undefined,"Str"],app_id:[undefined,"Str"],status_checked_ttl:[31536e3,"Int"],status_unchecked_ttl:[86400,"Int"],close_bg:[1,"Int"],close_esc_key:[0,"Int"],lightbox_class:["app-promo-lightbox"],selector_parent:["#app-promo-container","Str"],selector_close_btn:[".appLBClose","Str"],selector_no_more_cb:[".appLBCheckbox","Str"],selector_main_link:[".appLBMainLink","Str"],selector_details_link:[".appLBDtlBt","Str"],selector_close_link:[".appLBCloseBelt","Str"],sc_enabled:[0,"Int"],sc_timeout:[3e3,"Int"],sc_key:["prop18","Str"],sc_displayed:[undefined,"Str"],sc_close_bt_unchecked:[undefined,"Str"],sc_close_bt_checked:[undefined,"Str"],sc_close_link_unchecked:[undefined,"Str"],sc_close_link_checked:[undefined,"Str"],sc_esc_key_unchecked:[undefined,"Str"],sc_esc_key_checked:[undefined,"Str"],sc_bg_click_unchecked:[undefined,"Str"],sc_bg_click_checked:[undefined,"Str"],sc_main_click_unchecked:[undefined,"Str"],sc_main_click_checked:[undefined,"Str"],sc_details_click_unchecked:[undefined,"Str"],sc_details_click_checked:[undefined,"Str"],url_lid_key:["l-id","Str"],url_lid_main_link_unchecked:[undefined,"Str"],url_lid_main_link_checked:[undefined,"Str"],url_lid_details_link_unchecked:[undefined,"Str"],url_lid_details_link_checked:[undefined,"Str"],forget_status:[0,"Int"],mock_url:[undefined,"Str"],mock_code:[undefined,"Int"],mock_data:[undefined,"Str"],mock_delay:[0,"Int"],mock_timeout:[0,"Int"]}},_options=function(){var a={},b=$(_settings.selector_config);return 0===b.length?null:a=$.RJS_Helpers.readAttr(b,_settings.options)}();window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(){var a=Object.prototype.toString,b=Array.isArray||function(b){return"[object Array]"===a.call(b)},c={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t"},d=function(a){return c[a]||"\\u"+(a.charCodeAt(0)+65536).toString(16).substr(1)},e=/[\\"\u0000-\u001F\u2028\u2029]/g;return function f(c){if(null==c)return"null";if("number"==typeof c)return isFinite(c)?c.toString():"null";if("boolean"==typeof c)return c.toString();if("object"==typeof c){if("function"==typeof c.toJSON)return f(c.toJSON());if(b(c)){for(var g="[",h=0;h<c.length;h++)g+=(h?", ":"")+f(c[h]);return g+"]"}if("[object Object]"===a.call(c)){var i=[];for(var j in c)c.hasOwnProperty(j)&&i.push(f(j)+": "+f(c[j]));return"{"+i.join(", ")+"}"}}return'"'+c.toString().replace(e,d)+'"'}}()});var _mockApiUrl,_sendToCatalystTimeout=3e3,R={ui:{},keys:{ESC:27}};R.setMockupUrl=function(a){_mockApiUrl=a},R.noopF=function(){return!1},R.getSeconds=function(){return(new Date).getTime()/1e3|0},R.sendToCatalyst=function(a,b,c){return b?(c===undefined&&(c=_sendToCatalystTimeout),$(document).ready(function(){window.SC&&"function"==typeof window.SC.sendScDataOnLoad&&(window.SC.sendScDataOnLoad(a),window.location.href=b)}),c>0&&window.setTimeout(function(){window.location.href=b},c),!1):($(document).ready(function(){window.SC&&"function"==typeof window.SC.sendScDataOnLoad&&window.SC.sendScDataOnLoad(a)}),!0)},R.addUrlParams=function(a,b){if(a||(a=""),!b||$.isEmptyObject(b))return a;var c=a.indexOf("?");return-1!==c&&(b=$.extend(R.getUrlParams(a),b),a=a.substring(0,c)),a+"?"+$.param(b)},R.requestData=function(a){function b(a,b){0>=b?a():setTimeout(a,b)}function c(){0===d&&(d=-1,a.success.apply(this,arguments))}var d=0,e=$.extend({dataType:"jsonp",timeout:3e3,data:{},success:$.noop,error:$.noop,mockDelay:0,mockData:undefined,mockTimeout:!1,mockCode:undefined},a),f=0;e.mockData!==undefined||e.mockCode||e.mockTimeout?(e.url=e.mockId?_mockApiUrl+"?"+e.mockId:_mockApiUrl,e.dataType="jsonp",e.mockData!==undefined&&(e.data.mockData=e.mockData),e.mockCode&&(e.data.mockCode=e.mockCode),e.mockTimeout?e.data.mockDelay=e.timeout+1e4:e.mockDelay>0&&(e.data.mockDelay=e.mockDelay)):f=e.mockDelay,delete e.mockId,delete e.mockData,delete e.mockCode,delete e.mockTimeout,delete e.mockDelay,b(function(){e.timeout>0&&(window.setTimeout(function(){0===d&&(d=1,e.error(null,"timeout"))},e.timeout),$.ajax($.extend({},e,{success:c})))},f)},R.Storage=function(a){var b=function(){return this.isAvailable()?void 0:(this.set=R.noopF,this.get=$.noop,this.remove=R.noopF,void(this.clear=R.noopF))};this.isAvailable=function(){try{return window.localStorage.setItem("__testKey__","1"),window.localStorage.removeItem("__testKey__"),!0}catch(a){return!1}},this.set=function(b,c,d){var e={d:c};d>=0&&(e.t=R.getSeconds()+d);try{window.localStorage.setItem(a+":"+b,window.JSON.stringify(e))}catch(f){return!1}return!0},this.get=function(b){var c=window.localStorage.getItem(a+":"+b);return c?(c=window.JSON.parse(c),c.t&&c.t<R.getSeconds()?(this.remove(b),undefined):c.d):undefined},this.remove=function(b){b=a+":"+b,window.localStorage.removeItem(b)},b.apply(this,arguments)};var _css={overlayClass:"r-overlay",classNameClass:"r-lightbox",contentClass:"r-lightbox-body"},_store=new R.Storage("rLightbox"),_eventSuffix=".rLightbox";R.ui.Lightbox=function(a,b){function c(){var c;if(!a||!b||!b.content&&!b.remoteContent)throw"Wrong data";return h=$.extend({closeBg:!0,closeEscKey:!0,parent:"body",autoOpen:!1,autoOpenDelay:0,mockId:"LIGHTBOX",checkedTtl:31536e3,uncheckedTtl:86400},b),i={$elem:null,$overlay:null,$closeButtons:null,$noMoreCheckbox:null,$content:null,displayed:!1,storeKey:"noMore."+a},c=_store.get(i.storeKey),c||h.noMoreCheckbox&&!_store.isAvailable()?void _disableFunctions(j):void d(e)}function d(a,b){h.content?a(h.content):R.requestData({url:h.remoteContent,dataType:"html",success:function(b){a(b)},error:b,mockId:h.mockId,mockCode:h.mockCode,mockData:h.mockData,mockDelay:h.mockDelay,mockTimeout:h.mockTimeout})}function e(a){i.$elem=$("<div></div>",{"class":_css.classNameClass}),i.$elem.addClass(_css.overlayClass),h["class"]&&i.$elem.addClass(h["class"]),i.$content=$("<div></div>",{"class":_css.contentClass}),i.$elem.append(i.$content.append(a)),h.closeButtons&&(i.$closeButtons=i.$elem.find(h.closeButtons)),h.noMoreCheckbox&&(i.$noMoreCheckbox=i.$elem.find(h.noMoreCheckbox)),i.$elem.appendTo($(h.parent)),f(),"function"==typeof h.onCreate&&h.onCreate(j),h.autoOpen&&(h.autoOpenDelay<=0?j.open():setTimeout(j.open,h.autoOpenDelay))}function f(){var a,b="click"+_eventSuffix;i.$closeButtons&&i.$closeButtons.bind(b,j.close),h.closeBg&&(i.$elem.bind(b,j.close),i.$content.children().bind(b,function(a){a.stopPropagation()})),h.closeEscKey&&$(document).keydown(function(a){a.which===R.keys.ESC&&(a.preventDefault(),j.close(a))}),h.noMoreCheckbox&&(a=i.$noMoreCheckbox.parent(),(1!==a.length||"LABEL"!==a[0].tagName.toUpperCase())&&(a=i.$noMoreCheckbox),a.bind(b,g))}function g(){var a=j.hasBeenHidden()?h.checkedTtl:h.uncheckedTtl;0>a?_store.set(i.storeKey,1):a>0?_store.set(i.storeKey,1,a):j.forgetStatus()}var h,i,j=this;this.open=function(a){var b=_store.get(i.storeKey);return j.isOpen()||b&&!a?j:(i.$elem.show(),i.displayed||"function"!=typeof h.onFirstDisplay||h.onFirstDisplay(j),"function"==typeof h.onDisplay&&h.onDisplay(j),g(),j)},this.close=function(a){return j.isOpen()?(i.$elem.hide(),h.closeBg&&$(document).unbind("click"+_eventSuffix),"function"==typeof h.onClose&&h.onClose(j,a),a.stopPropagation&&a.stopPropagation(),j):j},this.forgetStatus=function(){return _store.remove(i.storeKey),j},this.destroy=function(){"function"==typeof h.onDestroy&&h.onDestroy(this),i.$elem.remove(),i.$elem=null,_disableFunctions(j)},this.hasBeenHidden=function(){return i.$noMoreCheckbox&&i.$noMoreCheckbox.is(":checked")},this.isOpen=function(){return!i.$elem.is(":hidden")},this.getContent=function(){return i.$content},c.apply(this,arguments)},R.ui.Lightbox.forgetStatus=function(a){_store.remove("noMore."+a)};var lightboxOptions;_options&&_options.app_id&&_options.forget_status&&R.ui.Lightbox.forgetStatus(_options.app_id),(!_options||_options.enabled)&&requiredDataIsSet(_options)&&(_options.mock_url&&R.setMockupUrl(_options.mock_url),lightboxOptions=getLightboxOptions(_options),new R.ui.Lightbox(_options.app_id,lightboxOptions))}}(window,window.jQuery);
