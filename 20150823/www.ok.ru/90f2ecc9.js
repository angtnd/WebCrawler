define(["jquery","OK/logger","OK/cookie"],function(e,u,s){var q="garbagelog",l,r,p,c;function n(v){var w=u.repository.getRequestData();if(!w){return;}e.ajax({type:"POST",async:v===undefined||v,url:"/gwtlog",data:w});}function t(){n();}function m(v){var w=v.indexOf(".");return w===-1?v:v.substring(0,w);}function g(v){if(!v){return false;}var w=m(v);if(p.indexOf(w)>=0){return true;}if(p.indexOf(q)>=0){u.success(q,w);}return false;}function a(v){if(!v){return false;}var x=m(v),w=p.indexOf(x);return w>=0&&w<c;}function j(v,y,x,A,w,z){if(!g(v)){return;}if(A&&!a(v)){A=null;}if(y){u.repository.addLog(v,parseInt(y,10),x,A,z[0],z[1]);}else{u.repository.addLog(v,null,x,A,z[0],z[1]);}if(w){t();}}function f(v,w){j(v,null,null,null,false,w);}function k(v,w,x){j(v,w,null,null,false,x);}function h(v,w,y,x){j(v,null,w,y,false,x);}function o(){var v=s.readCookie("dme");return(v&&("true"===v.toLowerCase()))||document.getElementById("__gwtd__m");}function i(v,y,x,w){if(o()){window.alert("Fatal Error '"+v+"'\nplace='"+x+"'\nerror name='"+w+"'\nCLOB='"+y+"'");}h(v,null,y,true,[x,w]);}function d(v){var x=parseInt(v.getAttribute("data-interval"),10)||1000,w=v.getAttribute("data-onbeforeunload")==="true";c=parseInt(v.getAttribute("data-clobslen"),10)||0;p=JSON.parse(v.firstChild.textContent);u.error=function(y,z){h("error","",null,[z,y]);};u.success=function(y,A,z){f(y,[A,z]);};u.duration=function(y,A,B,z){k(y,A,[B,z]);};u.clob=i;u.replayQueue();r=setInterval(n,x);if(w){window.addEventListener("beforeunload",function(){n(false);},false);}}function b(){if(r){clearInterval(r);r=null;}}return{activate:function(v){if(l){return;}d(v);l=true;},deactivate:b};});