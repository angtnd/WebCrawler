define("OK/utils/utils",["jquery"],function(b){var a=b("#hook_Cfg_GwtExperimentsCfg");var c=a?OK.util.parseJSON(a.html()):{};return{ajax:function(e){var g=e.data||{};g["gwt.requested"]=window.pageCtx.gwtHash;e.type=e.type||"POST";e.data=g;e.beforeSend=function(j,h){j.setRequestHeader("TKN",OK.tkn.get());};var d=b.Deferred();var f=b.ajax(e);f.done(function(h,m,l){var k=l.getResponseHeader("TKN");if(k){OK.tkn.set(k);}var j=l.getResponseHeader("Redirect-Location");if(j){if(OK.navigation.redirect){OK.navigation.redirect(j);}else{document.location.href=decodeURIComponent(j);}d.reject(l,m,"Redirect");return;}d.resolve(h,m,l);});f.fail(function(h,k,j){d.reject(h,k,j);});return d;},updateBlockModelCallback:function(f,d,g){var e=g.getResponseHeader(OK.navigation.HEADER).split(",");this.updateBlocks(f,d,e);},updateBlocks:function(h,e,g){var d=h.split(OK.navigation.SPLITER);for(var f=0;f<d.length;f++){if(g[f]){OK.hookModel.setHookContent(g[f],d[f]);}}},gwtExperimentsCfg:c,encodeHtml:function(d){return b("<div/>").text(d).html();},isElementInViewport:function(d){var e=d.getBoundingClientRect();if(e.top<0||e.left<0||e.bottom>(window.innerHeight||document.documentElement.clientHeight)||e.right>(window.innerWidth||document.documentElement.clientWidth)){return false;}return(d.contains(document.elementFromPoint(e.left,e.top))||d.contains(document.elementFromPoint(e.right,e.top))||d.contains(document.elementFromPoint(e.right,e.bottom))||d.contains(document.elementFromPoint(e.left,e.bottom)));},isElementPartiallyInViewport:function(h,e){if(!e){return this.isElementInViewport(h);}var j=h.getBoundingClientRect(),d=Math.min(j.bottom,window.innerHeight||document.documentElement.clientHeight)-Math.max(0,j.top),f=Math.min(j.right,window.innerWidth||document.documentElement.clientWidth)-Math.max(0,j.left),g=h.offsetHeight,k=h.offsetWidth;return g*e<=d&&k*e<=f;}};});define("OK/utils/throttle",[],function(){
/*!
     * jQuery throttle / debounce - v1.1 - 3/7/2010
     * http://benalman.com/projects/jquery-throttle-debounce-plugin/
     *
     * Copyright (c) 2010 "Cowboy" Ben Alman
     * Dual licensed under the MIT and GPL licenses.
     * http://benalman.com/about/license/
     */
return function a(c,d,h,g){var f,b=0;if(typeof d!=="boolean"){g=h;h=d;d=undefined;}return function e(){var n=this,l=Date.now()-b,m=arguments;function k(){b=Date.now();h.apply(n,m);}function j(){f=undefined;}if(g&&!f){k();}if(f){clearTimeout(f);}if(g===undefined&&l>c){k();}else{if(d!==true){f=setTimeout(g?j:k,g===undefined?c-l:c);}}};};});define("OK/utils/debounce",["OK/utils/throttle"],function(b){return function a(c,d,e){return e===undefined?b(c,d,false):b(c,e,d!==false);};});define("OK/LogClicks",["jquery","OK/logger"],function(g,k){var f="data-log-click",b="click",e="log.click";function c(l,m,n){if(m&&Object.keys(m).length){l.push(m);if(m.target&&!n.okTarget){n.okTarget=m.target;}}}function h(l){OK.logging.info(b+" "+l);k.success(b,l);}function j(l){OK.logging.alert(e+" "+l);k.error(e,l);}function a(p){var m=g(p.target),n,l=[];try{n=m.attr(f);if(n){c(l,JSON.parse(n),p);}m.parents("["+f+"]").each(function(){n=g(this).attr(f);if(n){c(l,JSON.parse(n),p);}});if(l.length){h(JSON.stringify(l));}}catch(o){j(o);}}function d(l){l.addEventListener("click",a,true);OK.clickLog.incCounter();}return{activate:d};});define("OK/NewsFetchCoordinator",[],function(){var W="/push?cmd=PeriodicManager&gwt.requested="+window.pageCtx.gwtHash,g="p_NLP",V="p_DFF",ax="p_sId",x="fetchTime",a="serverTime",ac="p_PSE",M="p_PSB",b="p_SMF",m="cBlocks",o="p_CES",R="p_LPR",Y="p_SRT",ah="p_SFRRT",E="<!--SP-->",l="<!--SSP-->",aw=0,F=1,I=2,al="TZD",k=30,Z={responseText:"",open:function(){},setRequestHeader:function(){},send:function(){},abort:function(){},getResponseHeader:function(){}},ai={pos:0,size:0,adaptive:0,tmzOffset:0,values:[],updateDiff:function(aC){var aA=new Date(),aD=0,aB,az;this.tmzOffset=-aA.getTimezoneOffset();this.values[this.pos++]=aA.getTime()-aC;this.size<20&&this.size++;this.pos%=20;for(aB=0;aB<this.size;aB++){aD+=this.values[aB];}az=~~(aD/this.size);if(this.adaptive!==az){this.adaptive=az;return true;}return false;},getDiff:function(){return ~~(this.tmzOffset/k)+"."+this.adaptive;}},G=5000,t=5000,X=0,d=0,A=false,H=2097152,f=150000,e=180000,c=180000,ay=2,j=[],z=0,u=180000,ao={},af=[],T=null,aj=null,av=null,O=false,ag=Z,am=0,an=aw,n=0,s=0,w="LP",r,U,C,J,D,au=false,p=function(){try{return new window.XMLHttpRequest();}catch(aA){OK.logger.success("push","xhr");try{return new window.ActiveXObject("Microsoft.XMLHTTP");}catch(az){OK.logger.error("NFCI_AXO");return Z;}}},ak=function(az){try{if(ai.updateDiff(az)){OK.cookie.setCookie(al,ai.getDiff(),0,"/");}}catch(aA){OK.logger.error("NFCI_AST");}},S=function(){var az="",aA;for(aA in ao){if(ao.hasOwnProperty(aA)){az+=aA+"="+ao[aA]+"&";}}az+="blocks="+af.join(",")+"&";return az+g+"="+d;},aa=function(){return ax+"="+X;},ar=function(){if(O||!ap()){v(t);}},K=function(){if(w==="SSE"){var az=Date.now()-u<am;if(an===aw||az){av=setTimeout(K,u);return;}if(au||!P(ag.responseText||"")){q("heartbeat-sse-"+s);if(++s>=ay){w="LP";}ae(t);}else{au=true;T=setTimeout(y,0);av=setTimeout(K,c);OK.logger.success("push","check");}}else{O=false;X=0;q("heartbeat-lp");h(t);}},v=function(az){clearTimeout(aj);aj=setTimeout(ar,az);},y=function(){if(an!==aw){if(ag.readyState===3){ab();}T=setTimeout(y,1000);}},h=function(az){G=az;v(G);},aq=function(){clearTimeout(aj);aj=null;clearTimeout(av);av=null;O=false;if(an!==aw){q("stop-sse");}},ae=function(az){O=false;if(aj){v(az);}},at=function(){return w==="SSE"?(X==0?e:c):f;},ap=function(){var az=w==="SSE";try{if(r){if(r()){return false;}}else{OK.logger.error("NFCI_ER","foe-udf");}clearTimeout(av);u=at();av=setTimeout(K,u);O=true;if(U){N(az);}else{window.OK.logger.error("NFCI_ER","prc-udf");ae(t);}}catch(aA){O=false;OK.logger.error("NFCI_ER","trc");return false;}return true;},N=function(az){ag=p();ag.open("POST",W+(az?"&sse=true":"")+"&"+aa(),true);ag.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ag.setRequestHeader("Cache-Control","no-cache");ag.setRequestHeader("TKN",OK.tkn.get());if(az){ag.onreadystatechange=ag.onprogress=ab;n=0;an=F;}else{ag.onreadystatechange=ad;}ag.send(S());if(az&&au){clearTimeout(T);T=setTimeout(y,0);}},ad=function(){if(ag.readyState!==4){return;}if(ag.status===200){if(L(ag.getResponseHeader("Redirect-Location"))){OK.logger.success("push","redirect");ae(t);return;}B(ag);ae(G);}else{OK.logger.success("push","status",""+ag.status);ae(t);}},B=function(aB){var az=OK.lss&&OK.lss.isMaster(),aA=""+[az?OK.lss.getId():"",aB.responseText,aB.getResponseHeader("Rendered-Blocks"),aB.getResponseHeader("TKN")].join(E);if(az){Q(aA);}U(aA,false);},ab=function(){if(ag.readyState<3){return;}if(an===F){if(ag.status===200){if(L(ag.getResponseHeader("Redirect-Location"))){q("redirect-sse");ae(t);return;}an=I;}else{q("status-sse-"+ag.status);ae(t);}}else{if(an===I){switch(ag.readyState){case 3:P(ag.responseText||"");break;case 4:if(!P(ag.responseText||"")&&ag.getResponseHeader("Rendered-Blocks")){B(ag);}an=aw;ae(G);break;}}}},P=function(aC){var aD,aB,az,aA=false;while(~(aD=aC.indexOf(l,n))){aB=aC.substring(n,aD);if(aB){az=OK.lss&&OK.lss.isMaster();aB=""+[az?OK.lss.getId():"",aB].join(E);if(az){Q(aB);}U(aB,false);}n=aD+l.length;am=Date.now();aA=true;s=0;}if(n>H){OK.logger.success("push","overflow");}return aA;},Q=function(aC){try{localStorage.setItem("firePushContent",aC);}catch(aD){if(C){C();}else{OK.logger.error("NFCI_ER","dop-udf");}try{var aF=aD.message||"";var az=aC.length,aH="pushData";for(var aG in localStorage){if(localStorage.hasOwnProperty(aG)){var aB=localStorage.getItem(aG).length;aF+="\n"+aG+"="+aB;if(aB>az){az=aB;aH=aG;}}}var aA=az;if(aA>3000000){aA=3000000;}else{if(aA>2000000){aA=2000000;}else{if(aA>1000000){aA=1000000;}else{if(aA>500000){aA=500000;}else{if(aA>100000){aA=100000;}else{if(aA>10000){aA=10000;}else{aA=1000;}}}}}}OK.logger.clob("push",aF,"NFCI_LSIS_"+aH,""+aA);}catch(aE){OK.logger.clob("push",aE.stack,"NFCI_LSISE");}}},q=function(az){if(w==="SSE"){an=aw;X=0;}ag.abort();OK.logger.success("push","abort",az);},L=function(az){if(az){if(OK.navigation.redirect){OK.navigation.redirect(az);}else{document.location.href=decodeURIComponent(az);}return true;}return false;};return{getClientServerTimeDiff:function(){return ai.adaptive;},updateParam:function(az,aA){ao[az]=aA;},addBlock:function(az){af.push(az);for(var aA=0;aA<j.length;aA++){if(az===j[aA]){return;}}if(w==="SSE"){q("upd-block-"+az);}},setConfiguration:function(az){var aB,aA;f=az[R]||150000;G=az[x]||5000;t=az[V]||5000;X=az[ax]||X;d=az[g]||d;H=az[M]||2097152;c=az[Y]||180000;e=az[ah]||180000;ay=az[b]||2;j=(az[m]||"").split(",");u=at();aB=az[ac]===true;if(A!==aB){s=0;am=0;if(A&&an!==aw){aq();w="LP";h(G);}A=aB;w=A?"SSE":"LP";}if(az[a]){ak(az[a]);}aA=az[o]||0;if(aA!==z){z=aA;D(z);}},init:function(aB,aE,aC,aA,aD,az){r=aB;U=aE;C=aC;J=aA;D=aD;au=az;},getStateParamString:aa,scheduleFetch:function(){X=0;h(G);},stopScheduling:aq};});define("OK/utils/scrollHelper",["jquery"],function(a){return{scrollToVisible:function(g,d){var k=a(d);var j=a(g);var e=j.offset().top;var h=j.scrollTop();var c=j.height();var b=e+c;var f=k.height();var l=k.offset().top;if(l+f>b){j.scrollTop(h+l+f-e-c+5);}else{if(l<e){j.scrollTop(h+l-e-5);}}},scrollInLoadMoreDataPosition:function(d){var b=a(d);var c=d.scrollHeight-b.scrollTop()-b.height();return c<=200;},isScrollingVisible:function(d){var b=d.offsetHeight||0;var c=d.scrollHeight||0;return c>b;}};});define("OK/suggest/suggestImpl",["jquery","OK/utils/scrollHelper"],function(b,a){return function(an,J,ab){var ap={selectOnReload:false,correctSelection:true,minSearchQueryLength:0,getMaxItemsInSuggest:function(){return 5;},getMaxSelectedFriends:function(){return 5;},getMarkFriendDisabledMsg:function(){return"";},getSearchQuery:function(){return"";},onItemsChanged:function(){},onItemClicked:function(az){},onSelectedItemChanged:function(az){},onLoadingChanged:function(az){},onSearchProgressChanged:function(az){},onSearchInputChanged:function(){}};J=b.extend(J,b.extend(ap,J));var n=J.elementId;var aq="mm_"+n,r="mo_"+n,G="mc_"+n;var N=J.selectOnReload;var au=J.correctSelection;var af=J.suggestElId||n;var aj=J.messageElId||n+"_msg";var ac=J.itemsElId||n+"_itms";var W=J.loadingElId||n+"_loading";function k(az){return n+"_"+az;}var X=true;var c=J.getMaxItemsInSuggest()<=0;var D;var ay;var T=false;var ae;var x;var L;var ai;var E=[];var t=[];var ah=-1;var S=false;var aa;var al;function ad(){if(0<=ah&&ah<E.length){return an.getItemById(E[ah]);}return null;}function Y(){if(al){return al;}al=b("#"+af);if(al.length>0){if(c){var aA;var az=function(){if(X&&!ay&&ai&&a.scrollInLoadMoreDataPosition(al[0])){m(L);}};al.scroll(function(){if(aA){clearTimeout(aA);}aA=setTimeout(az,300);});}}else{al=null;}return al;}function A(){if(c){if(X&&!ay&&ai){var az=Y();if(az&&!a.isScrollingVisible(az[0])){m(L);}}}}function V(aI,aC,aB){var aG=ah>=0&&ah<E.length?E[ah]:-1;Y();L=aI;ai=aB;if(E.length==aC.length||!c&&E.length>=J.getMaxItemsInSuggest()&&aC.length>=J.getMaxItemsInSuggest()){if(aC.length===0&&E.length===0){return false;}var az={};var aH;var aE=0;for(aH=0;aH<aC.length;aH++){az[aC[aH]]=true;if(!c){if(!t[aC[aH]]){aE++;}if(aE>=J.getMaxItemsInSuggest()){break;}}}var aA;var aF=0;for(aH=0;aH<E.length;aH++){if(!az[E[aH]]){aA=true;break;}if(!c){if(!t[E[aH]]){aF++;}if(aF>=J.getMaxItemsInSuggest()){break;}}}if(!c&&(aF!=aE||aF>=J.getMaxItemsInSuggest())){aA=true;}aH=null;if(!aA){return false;}}ah=-1;S=true;var aD=E.length>0&&aC.length===0;q(aC);aD=aD||E.length>0;ak(aG,false);U();if(aD){J.onItemsChanged();}return aD;}function q(aA){var aC="";var aE=0;E=[];var aD=0;for(var aB=0;aB<aA.length;aB++){var aG=aA[aB];var aJ=an.getItemById(aG);if(!aJ){continue;}if(!c){if(!t[aG]){aD++;}if(aD>J.getMaxItemsInSuggest()){break;}}var aH=w(aG,aE++,aJ);var aF=document.createElement("div");aF.appendChild(aH);aC+=aF.innerHTML;E.push(aG);}if(c){var az=document.createElement("div");az.appendChild(u());aC+=az.innerHTML;}var aI=b("#"+ac);if(!J.mention||aI.html()!==aC){aI.html(aC);}}function H(){var aA=0;for(var az=0;az<E.length;az++){if(!t[E[az]]){aA++;}}return aA;}function at(aF,aA){Y();ai=aA;var aC;var az=E.length;var aB=b("#"+ac);var aE=H();var aI;if(c){aI=b("#"+W);}for(var aD=0;aD<aF.length;aD++){var aG=aF[aD];var aJ=an.getItemById(aG);if(!aJ){continue;}if(!c){if(!t[aG]){aE++;}if(aE>J.getMaxItemsInSuggest()){break;}}var aH=w(aG,az++,aJ);if(c&&aI){aI.parent().remove();aI=null;}aB.append(aH);E.push(aG);aC=true;}if(c&&aC){aB.append(u());}ak(null,true);U();if(aC){J.onItemsChanged();}}function u(){var az=document.createElement("li");az.className="suggest_li gift_font"+(ay?"":" invisible");if(!J.disableLoadingProgress){az.innerHTML='<div id="'+W+'" class="loader-controls in-progress"><div class="link-show-more_loading"><span class="fetching-hor">***</span></div></div>';}return az;}function w(aC,aA,aB){aB.visible=!t[aC];var az=document.createElement("li");az.className="suggest_li"+(aB.visible?"":" invisible");az.innerHTML=ab.createItemElement(aB);az.setAttribute("id",k(aC));az.setAttribute("onmousemove","OK.il.f(event,'"+aq+"', "+aA+");");az.setAttribute("onmouseover","OK.il.f(event,'"+r+"', "+aA+");");az.setAttribute("onclick","OK.il.f(event,'"+G+"', "+aA+");");return az;}function R(aB,aA){var az=b("#"+k(aB));if(az.length===0){return false;}az.toggleClass("invisible",!aA);}function av(aB){var az=b("#"+k(aB));if(az.length===0){return false;}var aA=!t[aB];R(aB,aA);return true;}function l(aC,az){var aA=an.getItemById(aC);var aB=b("#"+k(aC));ab.setItemSelected(aA,aB,az);}function Z(az){var aB=E[az];var aA=an.getItemById(aB);return aA.disabled;}function M(az){return t[E[az]];}function K(az){return !M(az)&&!Z(az);}var ax={id:aq,handlerId:"h"+this.id,handle:function(aA,az){if(D){return;}S=false;}};var P={id:r,handlerId:"h"+this.id,handle:function(aA,az){if(D){return;}if(0<=az&&az<E.length){if(ah!==az&&K(az)){S=false;Q(az);}}}};var aw={id:G,handlerId:"h"+this.id,handle:function(aA,az){if(D){return;}if(0<=az&&az<E.length&&K(az)){S=false;Q(az);var aC=aA.target;var aB;while(aC!=null&&!aC.getAttribute("id")){aB=aC.getAttribute("data-action");if(aB){break;}aC=aC.parentNode;}J.onItemClicked(an.getItemById(E[az]),aB);}}};OK.il.ah(ax);OK.il.ah(P);OK.il.ah(aw);function F(){OK.il.rh(ax);OK.il.rh(P);OK.il.rh(aw);}function ak(aD,aC){if(E.length===0){if(ah!==-1){Q(-1);}return;}if(!au){if(!aC){Q(-1);}return;}if(N&&aD&&aD!=-1){for(var aA=0;aA<E.length;aA++){if(aD==E[aA]){if(K(aA)){Q(aA);}return;}}return;}if(ah===-1){for(var aA=0;aA<E.length;aA++){if(K(aA)){Q(aA);break;}}return;}if(M(ah)){for(var az=ah+1;az<E.length;az++){if(K(az)){Q(az);return;}}for(var aB=ah-1;aB>=0;aB--){if(K(aB)){Q(aB);return;}}Q(-1);}}function j(){if(E.length===0){return;}if(ah===-1){return;}for(var az=ah-1;az>=0;az--){if(K(az)){S=true;Q(az);break;}}}function ar(){if(E.length===0){return;}for(var az=ah+1;az<E.length;az++){if(K(az)){S=true;Q(az);break;}}}function d(aA){for(var az=0;az<E.length;az++){if(E[az]==aA){if(K(az)){S=true;Q(az);}break;}}}function Q(aB){if((typeof aB)==="string"){aB=+aB;}var aC=ah!==aB;if(ah>=0&&ah<E.length){var az=E[ah];if(az){if(!aC){l(az,!D);return;}l(az,false);}}ah=-1;if(aB>=0&&aB<E.length){var aD=E[aB];var aA=!aD;if(aA||!K(aB)){return;}l(aD,!D);ah=aB;J.onSelectedItemChanged(an.getItemById(aD));if(aC){U();}}}function U(){if(c&&S){var aA;if(ah>=0&&ah<E.length){aA=ah;}else{if(ah==-1){aA=0;}else{return;}}var az=E[aA];if(az){var aC=b("#"+k(az));if(aC.length>0){var aB=Y();a.scrollToVisible(aB[0],aC[0]);}}}}var C=-1;var e=1;var O=2;var am=3;var v=4;var h=5;var o=function(aB,aF){var aA;var az;aa=aB;var aD=aB.query;var aC=aB.itemIds;var aG=aB.hasMore;if(aD===L){at(aF,aG);az=O;}else{if(aD==J.getSearchQuery()||aD.toString()==J.getSearchQuery().toString()){var aE=V(aD,aC,aG);az=aE?am:v;}else{aA=true;az=h;}}ag(false,true,aD,az,aB);if(!aA){A();}};var p=function(az,aA){x=az;ag(false,false,aA,C);};function m(aA){ag(true,true,aA,e);aA=aA||J.getSearchQuery();var az;if(J.getMaxItemsInSuggest()>0){az=J.getMaxItemsInSuggest()+J.getMaxSelectedFriends();}else{az=0;}an.search(aA,az,o,p);}function y(){var az=L;L=null;m(az);}function B(az){if(X!=az){X=az;z();}}function ag(aD,aC,aB,az,aA){if(ay!=aD){ay=aD;z();g();J.onLoadingChanged(ay,aC,aB,az,aA);}}function f(az){if(D!=az){D=az;z();}}function s(az){if(T!=az){T=az;z();}}function I(az){if(ae!=az){ae=az;ao();}}function z(){var az=b("#"+af);az.toggleClass("__active",X);az.toggleClass("__disabled",D||ay);az.toggleClass("__message",T);}function g(){if(!c||J.disableLoadingProgress){return;}var aA=b("#"+W);if(aA.length==0){return;}aA.toggleClass("invisible",!ay);if(ay){var az=Y();if(az){}}}function ao(){b("#"+aj).html(ae);}return{createHtml:function(){return'<div id="'+af+'" class="suggest'+(X?" __active":"")+(c?" __scroll":"")+(D||ay?" __disabled":"")+(T?" __message":"")+'"><div id="'+aj+'" class="suggest_tx">'+(ae?ae:"")+'</div><ul id="'+ac+'" class="suggest_ul"></ul></div>';},resetSelection:function(){var aA=Y();if(aA){aA.scrollTop(0);for(var az=0;az<E.length;az++){if(K(az)){Q(az);break;}}}},setVisible:function(az){B(az);},setDisabled:function(az){f(az);},isMessageVisible:function(){return !!T;},setMessageVisible:function(az){s(az);},setMessage:function(az){I(az);},search:function(az){m(az||J.getSearchQuery());},isSearchDisabled:function(){return !!x;},getDisplayQuery:function(){return L;},hasVisibleItems:function(){for(var az=0;az<E.length;az++){if(!t[E[az]]){return true;}}return false;},hasHiddenItems:function(){for(var az=0;az<E.length;az++){if(t[E[az]]){return true;}}return false;},setHiddenItemId:function(aB,aA){var az=(aA!=t[aB]);if(az){t[aB]=aA;if(av(aB)){if(!c){y();}else{ak();J.onItemsChanged();if(aA){A();}}}}},resetHiddenItemIds:function(aB){aB=aB||[];var aA=t;t=aB;var aD;for(var az=0;az<E.length;az++){var aC=E[az];if(t[aC]&&!aA[aC]||!t[aC]&&aA[aC]){if(av(aC)){aD=true;}}}if(aD){if(!c){y();}else{ak();J.onItemsChanged();A();}}},resetItems:function(az,aA){q(az||E);_selectedItemId=-1;if(typeof aA!="undefined"){L=aA;}},selectPrevious:j,selectNext:ar,selectItemById:d,getSelectedItem:ad,getSearchEntry:function(az){return az?an.getSearchEntry(az):aa;},SEARCH_RESULT_ERROR:C,SEARCH_RESULT_LOADING:e,SEARCH_RESULT_APPEND_ITEMS:O,SEARCH_RESULT_SET_ITEMS:am,SEARCH_RESULT_SET_ITEMS_CACHED:v,SEARCH_RESULT_UNKNOWN:h,destroy:function(){F();an.clearCaches();J=null;}};};});define("OK/suggest/searchEngines",["jquery","OK/utils/utils"],function(c,a){function b(e,d,j,k){var l={};var g={};function h(p,n,r,s){if(!l[p]){l[p]={query:p,index:0,itemIds:[],hasMore:true,requestId:""};}var o=l[p];if(!o.hasMore||(n&&o.itemIds.length>=n)){r(o,[]);return o;}var q="search-d-"+new Date().getTime();o.requestId=q;var m={"gwt.requested":window.pageCtx.gwtHash,refId:o.requestId};f.prepareRequest(p,o,m);a.ajax({type:"POST",url:"/dk?cmd="+e,data:m,dataType:d,timeout:3000}).done(function(v,t,A){var u=A.getResponseHeader("TKN");if(u){OK.tkn.set(u);}if(o.requestId!==q||l.length==0){s(false,p);return;}var w;if(d=="html"){w=OK.util.parseJSON(v);}else{if(d=="json"){w=v;}}var y=f.processResponse(w,o);if(y){var x=[];for(i=0;i<y.length;i++){var B=y[i];var z=B.id;o.itemIds.push(z);x.push(z);g[z]=B;}r(o,x);}else{s(true,p);}}).fail(function(t,v,u){s(false,p);});return o;}var f={search:h,prepareRequest:j,processResponse:k,clearCaches:function(){l={};g={};},getItemById:function(m){return g[m];},getSearchEntry:function(m){return l[m];}};return f;}return{createSearchEngine:b,friendsSearchEngine:b("FriendsSearch","html",function(g,f,e){var d="d.in";c.extend(e,{"d.sq":f.query,"d.o":f.index,"d.d":d});},function(e,d){var n=e.searchEnabled;if(n==="false"){return null;}var h=e["jsp.cc"];var m=e["jsp.stc"]||0;d.index=d.index+h;d.hasMore=d.index<m;d.totalCount=m;var k=[];var g=e["jsp.sr"]||[];OK.userCache.updateUserCache(g);for(var j in g){if(Object.prototype.hasOwnProperty.call(g,j)){var f=g[j];f.id=j;f.imageSrc=OK.userCache.getLinkOnUserAvatar(f);f.text=f.uf;var l=f.mkto;if(!l){f.disabled=true;}k.push(f);}}return k;}),placesSearchEngine:b("PostingFormPlacesSearch","json",function(f,e,d){d["d.sq"]=f.query;d["d.o"]=e.index;d["ps.pin"]=f.pin;if(f.coords){d["ps.lt"]=f.coords[0];d["ps.lng"]=f.coords[1];}},function(g,k){var l=g["jsp.scc"]||0;var h=g["jsp.sr"]||[];var f=Math.min(g["jsp.stc"]||0,200);k.index=k.index+l;k.hasMore=k.index<f;k.totalCount=f;k.realTotalCount=g["jsp.str"]||0;for(var j=0;j<h.length;j++){var e=h[j];var d=e.address;if(e.distance){if(d.length>0){d+=" ("+e.distance+")";}else{d=e.distance;}}e.latitude=parseFloat(e.latitude);e.longitude=parseFloat(e.longitude);e.text=a.encodeHtml(e.name);e.smallText=e.categoryName;e.smallText2=a.encodeHtml(d);}return h;}),groupsSearchEngine:b("SearchMyGroups","json",function(f,e,d){d["d.sq"]=e.query;d["d.o"]=e.index;},function(f,h){if(f.searchEnabled==="false"){return null;}var k=f["jsp.cc"]||0;var e=f["jsp.stc"]||0;h.index=h.index+k;h.hasMore=h.index<e;h.totalCount=e;var d=f["jsp.sr"]||[];for(var g=0;g<d.length;g++){var j=d[g];j.imageSrc=j.photo;j.text=j.name;}return d;})};});define("OK/suggest/renderers",[],function(){function a(b){this.options=b;return this;}a.prototype.createItemElement=function(b){return'<div class="ucard-mini'+(b.selected?" __selected":"")+(b.disabled?" __na":"")+'">'+(b.imageSrc?'<img class="ucard-mini_img" src="'+b.imageSrc+'" alt="Image" width="32" height="32">':"")+'<div class="ucard-mini_cnt"><div class="ucard-mini_cnt_i ellip">'+(b.text?b.text:"")+"</div>"+(b.smallText?'<div class="ucard-mini_info">'+b.smallText+"</div>":"")+"</div></div>";};a.prototype.setItemSelected=function(c,d,b){d.find(".ucard-mini").toggleClass("__selected",b);};return{MiniCard:a};});define("OK/postingForm/mentions",["jquery","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers","OK/logger"],function(e,c,f,a,h){var g=function(){h.error("mt.e","util");},d=function(){h.error("mt.e","selector");};var j=0;var b={getDebugStep:function(){return j;},MT_OP:"mediatopic.m",FORMAT_ELEMENT_CSS_CLASS:"pform_name",BL_ACTIVE_CSS_CLASS:"__active",NAME_ATTR:"data-name",ctx:{onLoadingChanged:e.noop,getMaxSelectedFriends:function(){return 1;},onItemsChanged:e.noop,onSelectedItemChanged:e.noop,getMaxItemsInSuggest:function(){return 5;},elementId:"_mPF",mention:true},suggest:null,hide:function(){},destroy:function(){b.suggest&&b.suggest.destroy();e("#"+b.ctx.elementId).remove();},bind:function(w,s,y,C){g=y;d=C;b.hide=E;var v,o,t,k=e("<span data-user-id='3840445038989' class='"+b.FORMAT_ELEMENT_CSS_CLASS+"'></span>").get(0),p,A,n=false,u=e(w);j=1;if(!document.getElementById(b.ctx.elementId)){j=2;b.ctx.getMarkFriendDisabledMsg=function(){return s;};j=3;var B=a.MiniCard;var z=new B();z.createItemElement=function(F){F.smallText=F.disabled?s:"";return B.prototype.createItemElement(F);};j=4;b.suggest=c(f.friendsSearchEngine,b.ctx,z);j=5;e(document.body).append('<div id="'+b.ctx.elementId+'"class="sc-menu __redesign">'+b.suggest.createHtml()+'<div class="sc-menu_arw_w" style="left:149px;"><div class="sc-menu_arw"></div></div></div>');j=6;}j=7;p=e("#"+b.ctx.elementId).css({width:300});j=8;A=u.parent().find(".pform_name-bg");j=9;if(A.length===0){A=e('<span class="pform_name-bg"></span>');A.insertBefore(u);}j=10;E();j=11;if(!d.supportsRange()){h.success(b.MT_OP,"not_supported");return;}j=12;u.keydown(function(F){if((F.which===13||F.which==38||F.which==40)&&n){F.preventDefault();}}).keyup(function(K){var J,I,G,L=b.suggest,F=b.ctx,H;F.onItemClicked=e.noop;F.getSearchQuery=function(){return J;};F.onLoadingChanged=function(M){if(!M&&L.hasVisibleItems()){q(I,K);}if(!L.hasVisibleItems()){E();}};v=d.getRange();o=g.getSelectedNode(v,v.startContainer,v.startOffset,true);if(g.isSpace(K.which)&&g.isSpan(o.parentNode)&&e(o.parentNode).hasClass(b.FORMAT_ELEMENT_CSS_CLASS)&&o.parentNode.lastChild===o&&(g.isText(o)&&o.nodeValue.length===v.startOffset)){D(o.parentNode);K.preventDefault();}J=r(K);if(J&&((J.length>=(b.mentionsCharStart>0?b.mentionsCharStart:3)&&(!b.mentionsFirstCharUpperCase||(b.mentionsFirstCharUpperCase&&J[0].toUpperCase()===J[0])))||J[0]==="@"||J[0]==="+")){G=l();if(G){if(K.which===13){x(G);}else{I=G.getBoundingClientRect();h.success(b.MT_OP,"search");if(J[0]==="@"||J[0]==="+"){h.success(b.MT_OP,"trigger");J=J.substr(1);}L.search(J);F.onItemClicked=function(){if(g.isInEditor(G.startContainer)){x(G);E();}};}}}if(!I||K.which===27||!L.hasVisibleItems()){E();}g.normalizeFont();m(K,v);}).on("paste",function(){setTimeout(function(){g.cleanWordComments(u);b.filterElements(u);},50);}).click(function(){u.focus();});function r(I){var G,F,H=v.startOffset;if(H>0&&g.isText(o)&&o.nodeValue.length>0&&!g.isSpace(I.which)&&e(o).parents("."+b.FORMAT_ELEMENT_CSS_CLASS).length==0){F=o.nodeValue;G=F[H-1];if(!g.isSpace(G)){for(t=H-1;t>=0;t-=1){if(g.isSpace(F.charCodeAt(t))){t+=1;break;}}if(t<0){t+=1;}return F.substring(t,H);}}return null;}function l(){var F;if(g.isText(o)&&t>=0){F=document.createRange();F.setStart(o,t);F.setEnd(o,v.startOffset);return F;}return null;}function x(F){var H,G=b.suggest&&b.suggest.getSelectedItem();if(F&&G&&!G.disabled){document.getSelection().removeAllRanges();document.getSelection().addRange(F);H=k.cloneNode(false);F.surroundContents(H);e(H).text(G.un).attr("data-user-id",G.ul).attr(b.NAME_ATTR,G.un);D(H);}}function D(F){var G=document.createTextNode(String.fromCharCode(160));u.focus();g.after(F,G);v.setStart(G,1);d.addRange(v);}function q(F,H){var G;if(F){p.css({left:F.left-140,top:F.bottom+e(window).scrollTop()});G=A.parent().get(0).getBoundingClientRect();A.css({top:F.top-G.top-2,left:F.left-G.left-2,width:F.width,height:F.height});if(H.which==38){b.suggest&&b.suggest.selectPrevious();}else{if(H.which==40){b.suggest&&b.suggest.selectNext();}}n=true;h.success(b.MT_OP,"show_menu");}else{E();}A.toggleClass(b.BL_ACTIVE_CSS_CLASS,!!F);}function E(){p.css({left:0,top:-1000});A.css({top:0,left:0,width:0,height:0});n=false;A.removeClass(b.BL_ACTIVE_CSS_CLASS);}function m(I,G){var F,H=true;if(I.which===8&&g.isFireFox){F=d.getFocusElement(G);if(e(F).hasClass(b.FORMAT_ELEMENT_CSS_CLASS)){e(F.childNodes).each(function(J,K){if(g.isText(K)&&K.nodeValue.length>0){H=false;}});if(H&&w.innerHTML.indexOf(F.outerHTML)===0){e(F).replaceWith(document.createTextNode(String.fromCharCode(160)));u.focus();}}}}j=14;},removeTags:function(l){var k=e("<div/>").html(l);k.contents().filter(function(){return this.nodeType==1;}).replaceWith(function(){return e(this).contents();});return k.text();},log:function(k){e(k).find("span."+b.FORMAT_ELEMENT_CSS_CLASS).each(function(l,m){if(this.innerHTML!==e(this).attr(b.NAME_ATTR)){h.success(b.MT_OP,"mention_changed");}});},filterElements:function(k){var o={ELEMENT_NODE:1,TEXT_NODE:3};function m(u){return u.nodeType==o.TEXT_NODE;}function r(v,u){return v.nodeType==o.ELEMENT_NODE&&v.tagName.toUpperCase()==u;}function l(u){return r(u,"BR");}function s(x){var w=r(x,"SPAN");if(w){var v=e(x);var u=!v.contents().is(function(){return !m(this);});if(u){if(x.className==b.FORMAT_ELEMENT_CSS_CLASS){v.removeAttr("style");return true;}else{v.replaceWith(v.contents());}return true;}}return false;}function n(v){var w=r(v,"DIV");if(w){var u=e(v);u.removeAttr("style");u.removeAttr("class");}return w;}function p(u){return m(u)||l(u)||s(u);}function q(u){return n(u)&&!e(u).contents().is(function(){return !p(this);});}while(true){var t=k.contents().not(function(){return p(this)||q(this);});if(t.length==0){break;}t.filter(function(){return this.nodeType!=o.ELEMENT_NODE;}).remove().end().filter(function(){return this.nodeType==o.ELEMENT_NODE;}).replaceWith(function(){var u=e(this).contents();if(this.tagName.toUpperCase()=="DIV"||this.tagName.toUpperCase()=="P"){return u.filter(function(){return p(this);}).wrap("<div></div>").end();}else{return u;}});}},mentionsCharStart:3,mentionsFirstCharUpperCase:true};return b;});define("OK/suggest/inputChecker",[],function(){return function(j,d,b,e){b=b||0;e=e||500;var a=null;var f=j.val();var k=1;var h=2;var g=3;j.on("input propertychange",function(){var m=j.val();if(f!=m){f=m;l();if(m.length>0&&m.length<b){d(m,k);}else{d(m,h);a=window.setTimeout(c,e);}}});function c(){var m=j.val();if(m.length>0&&m.length<b){return;}f=m;d(m,g);}function l(){if(a){window.clearInterval(a);a=null;}}return{INPUT_CHANGE_MIN:k,INPUT_CHANGE:h,INPUT_TIMER:g,startSearchQueryCheck:function(){f=j.val();},endSearchQueryCheck:l,setInputValue:function(m){f=m;j.val(m);},destroy:function(){j.off();l();}};};});define("OK/utils/yandexMaps",["jquery","OK/utils/utils"],function(f,b){var d=[];function e(n,m){if(window.ymaps20stable&&ymaps20stable.ready){if(m){return ymaps20stable.ready(m);}return null;}if(m){d.push(m);}if(a.loaded){return null;}a.loaded=true;var h={ru:"ru-RU",en:"en-US",tr:"tr-TR",uk:"uk-UA"};var g=h[n]||"ru-RU";var j="http://api-maps.yandex.ru/2.0/?load=package.standard,package.geoObjects&lang=<locale>&ns=ymaps20stable&onload=OK_yandexMapsLoader_onLoad";var l=b.gwtExperimentsCfg.yandexMapsUrl?b.gwtExperimentsCfg.yandexMapsUrl:j;var k=l.replace(/<locale>/,g);f.getScript(k).fail(function(q,p,o){a.error=true;OK.logger.error("yandexMaps","loadError");});return null;}function c(){for(var g=0;g<d.length;g++){var j=d[g];try{j();}catch(h){OK.logger.success("yandexMaps","loadCallbackError",j,h);}}a.initialized=true;d=[];}var a={loaded:false,initialized:false,error:false,load:e,onLoad:c};return a;});function OK_yandexMapsLoader_onLoad(){require(["OK/utils/yandexMaps"],function(a){a.onLoad();});}define("OK/postingForm/places",["require","jquery","OK/utils/utils","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/inputChecker","OK/utils/yandexMaps","OK/logger"],function(c){var e=c("jquery"),a=c("OK/utils/utils"),h=c("OK/suggest/suggestImpl"),d=c("OK/suggest/searchEngines"),f=c("OK/suggest/inputChecker"),g=c("OK/utils/yandexMaps"),b=c("OK/logger");return function(I,aq){var D,aP,P,aV,aR,a3,ap,j,aD,aY,v,ay,aa,aW,aS,r,aZ,y;var aj=80;var aQ;var a0={location:null,localeLanguage:"ru",mapEnabled:true,placeAddEnabled:true,minSearchQueryLength:0,searchDelay:500,spamType:"ALL",postingFormType:"Status"};var K=[55.751574,37.573856];var aX=12;var aA=false;var J;var Y;var w;var A;var X;var m;var a4;var z=false;var av=false;var ac;var C;var s,Z="addPlaceStepSelectPoint",p="addPlaceStepConfirm";var Q=false;var az={id:"firstPlaceItem"},a2={id:"lastPlaceItem"};aw();function aw(){P=e("#"+I+"_PlaceMain");if(P.length==0){P=null;return;}D=e("#hook_Block_PopLayer");aP=e("#"+I);aV=e("#"+I+"_PlaceMarker");aR=e("#"+I+"_PlaceSelection");a3=e("#"+I+"_PlaceSelectionText");ap=e("#"+I+"_PlaceCount");j=e("#"+I+"_PlaceSearchContainer");aD=e("#"+I+"_PlaceSearchInput");aY=e("#"+I+"_PlaceSearchItemsContainer");ay=e("#"+I+"_PlaceMapBack");v=e("#"+I+"_PlaceMap");aS=e("#"+I+"_PlaceMapAddInfo");r=e("#"+I+"_PlaceMapAddControls");aZ=e("#"+I+"_PlaceMapAddControlOk");aZ.on("click",an);e("#"+I+"_PlaceMapAddControlCancel").on("click",ai);aQ=aY.find(".js-spamTitle").text();aa=e("#"+I+"_PlaceMapMessageTop");aW=e("#"+I+"_PlaceMapMessageBottom");var bb=e("#"+I+"_PlaceAddItem");bb.remove();var a9=e("#"+I+"_PlaceSpamForm");y=a9.html();if(y&&y.length>7&&y.substring(0,4)=="<!--"&&y.substring(y.length-3)=="-->"){y=y.substring(4,y.length-3);}aV.on("click",at);ay.on("click",au);a3.on("click",at);e("#"+I+"_PlaceSelctionRemove").on("click",t);aD.on("keydown",ak);aD.on("blur",aM);P.on("mouseenter",function(){z=true;});P.on("mouseleave",function(){z=false;});var a7=e("#"+I+"_PlaceData");a0=OK.util.parseJSON(a7.html());var a5=d.placesSearchEngine;var ba=d.createSearchEngine("PostingFormPlacesSearch","json",a5.prepareRequest,function(bd,bf){var bc=bf.index==0;var be=a5.processResponse(bd,bf);if(!be){return be;}var bg=!bf.hasMore;if(bc){be.splice(0,0,az);}if(bg){be.push(a2);}return be;});var a6={elementId:I+"_PlaceSearch",suggestElId:I+"_PlaceSearchItemsContainer",itemsElId:I+"_PlaceSearchItems",correctSelection:false,getMaxItemsInSuggest:function(){return 0;},getSearchQuery:function(){var bc=!!w;var be=aD.val();var bd={pin:bc,coords:Y,query:be,toString:function(){return Y+"/"+be+"/"+bc;}};return bd;},onItemClicked:af,onSelectedItemChanged:function(bd){if(A&&bd.latitude&&bd.longitude){var bc=[bd.latitude,bd.longitude];n(bc);A.panTo(bc,{delay:1000,flying:true});}},onLoadingChanged:function(bf,bg,be,bc,bd){av=bf;W(av);k();if(!av&&s==Z){aZ.removeClass("__disabled");}if(bc==ac.SEARCH_RESULT_SET_ITEMS&&m&&!P.hasClass("__map")){ac.selectItemById(az.id);}if(!av&&bg&&bd){ap.text(bd.realTotalCount==0?"":bd.realTotalCount);}}};var a8={createItemElement:function(bd){var bc;if(a0.spamType=="ALL"){bc=true;}else{if(a0.spamType=="USER"){bc=!!bd.userId;}}if(bd.id==az.id&&m){bd=m;}else{if(bd.id==a2.id&&a0.placeAddEnabled){return bb.html();}}return'<div class="ucard'+(bd.selected?" __selected":"")+(bd.disabled?" __na":"")+'"><div class="ucard_img"><div class="ucard_img_a"><div class="stub-img__50 stub-place stub-place-'+(bd.category||"general")+'"></div></div></div><div class="ucard_info"><div class="ucard_info_name ellip">'+(bd.text?bd.text:"")+"</div>"+(bd.smallText?'<div class="ucard_add-info_i ellip">'+bd.smallText+"</div>":"")+(bd.smallText2?'<div class="ucard_add-info_i ellip">'+bd.smallText2+"</div>":"")+"</div>"+(bc?'<span class="ucard_ac ic12 ic12_i_warn" data-action="spam" title="'+aQ+'"></span>':"")+"</div>";},setItemSelected:function(bd,be,bc){be.find(bd.id!=a2.id?".ucard":".js-AddPlaceItem").toggleClass("__selected",bc);}};ac=h(ba,a6,a8);C=f(aD,function(bd,bc){if(bc==C.INPUT_CHANGE_MIN){W(false);w=null;}else{if(bc==C.INPUT_CHANGE){W(true);w=null;}else{if(bc==C.INPUT_TIMER){ac.search();}}}L();},a0.minSearchQueryLength,a0.searchDelay);}function k(a6){if(!a6&&!av){var a5=ac.getSearchEntry();if(!a5){if(!J){a6="NoBrowserCoords";}else{a6="LoadingError";}}else{if(a5.totalCount==0){var a7=a5.query;if(a7.pin){a6="NoPlacesPoint";}else{if(a7.length>0){a6="NoPlacesSearch";}else{a6="NoPlacesSearch";}}}else{if(a0.placeAddEnabled){if(!a5.hasMore){a6=s==p?"AddPlaceConfirm":"AddPlace";}else{if(s==p){a6="AddPlaceConfirmMessage";}}}}}}aY.find(".js-message").addClass("invisible");if(a6){aY.find(".js-"+a6).removeClass("invisible");b.success("mt.place","placeListMessage-"+a6,a0.postingFormType);}aa.toggleClass("__active",aa.find(".js-message:not(.invisible)").length>0);aW.toggleClass("__active",aW.find(".js-message:not(.invisible)").length>0);}function W(a5){j.toggleClass("search-input_searching",a5);aY.toggleClass("__process",a5);}function at(a6){G();aV.addClass("__active");P.addClass("__active __search");aD.focus();aH();z=true;Y=J;w=null;aD.val("");var a5=[];a5[m?m.id:az.id]=true;if(!a0.placeAddEnabled){a5[a2.id]=true;}ac.resetHiddenItemIds(a5);B();C.startSearchQueryCheck();ah(P,aY,aj);v.width("195");if(A){A.container.fitToViewport();}b.success("mt.place",(a6.target==aV[0]?"marker":"place")+(m?"Edit":"")+"Click",a0.postingFormType);}function t(a5){P.removeClass("__active __search __map");aR.removeClass("__active");P.removeAttr("placeId");aD.val("");aJ();m=null;if(a5){b.success("mt.place","placeRemove",a0.postingFormType);}}function l(){if(!P){return;}if(A){try{A.destroy();}catch(a5){b.errorEx(a5,"mt.place","mapDestroy");}}A=X=m=null;aL();ac.destroy();C.destroy();ac=aP=P=aV=aR=a3=j=aD=aY=null;}function aL(){if(!P){return;}q();t();aq();}function q(a5){aV.removeClass("__active");P.removeClass("__active __search __map");C.endSearchQueryCheck();aD.val("");Y=J;w=null;ac.resetItems([],"");if(A){try{A.setCenter(J||K);A.setZoom(aX);}catch(a5){b.errorEx(a5,"mt.place","resetMap");}}L();ah(aP,aP,aj);if(a5){b.success("mt.place","mapClose",a0.postingFormType);}}var O="PostingFormSpamLayer";function af(a6,a5){if(a5=="spam"){Q=true;a4=a6;D.html(y);D.show();aD.blur();e("#PostingFormPlaceSpamFormOk").on("click",F);e("#PostingFormPlaceSpamFormCancel,#PostingFormPlaceSpamFormClose,#popLayer_mo").on("click",u);OK.Layers.register(O,function(){u("cr_esc");},undefined,false);if(OK.Layers.onLayerShown){OK.Layers.onLayerShown();}ae();b.success("mt.place","showSpam",a0.postingFormType);}else{ax(a6);}}function F(){ac.setHiddenItemId(a4.id,true);a.ajax({type:"POST",url:"/dk?cmd=PopLayer",data:{"st.layer.cmd":"PopLayerRegisterSpam","st.layer.posted":"true",button_register:"true","st.layer.ids":a4.id,"st.layer.type":60}});u();}function u(a5){if(OK.Layers.onLayerHidden){OK.Layers.onLayerHidden();}D.html("");D.hide();if(a5!="cr_esc"){OK.Layers.remove(O);}aD.focus();a4=null;Q=false;}function ax(a5){if(a5.id==az.id){q();}else{if(a5.id==a2.id){if(s==p){H();}else{ag();}}else{q();aR.addClass("__active");a3.text(a5.name);m=a5;Y=[a5.latitude,a5.longitude];w=null;aq();b.success("mt.place","placeSelect",a0.postingFormType);}}}function x(){v.width("500");P.addClass("__map");A.controls.add("zoomControl");if(A){A.container.fitToViewport();}}var aK;function ar(a5){if(P.hasClass("__map")){n(a5);w=Y=a5;if(++aK==2){C.setInputValue("");}if(s==Z){aS.removeClass("__active");b.success("mt.place","mapClickAddPlace",aK,a0.postingFormType);}else{b.success("mt.place","mapClick",aK,a0.postingFormType);}ac.search();}else{L();x();ay.addClass("__active");aK=0;b.success("mt.place","bigMap",a0.postingFormType);}}var aO;function V(){if(s==Z){if(Date.now()>aO+1500){aS.removeClass("__active");}}}function au(a5){v.width("195");P.removeClass("__map");ay.removeClass("__active");A.controls.remove("zoomControl");aS.removeClass("__active");r.removeClass("__active");if(A){A.container.fitToViewport();}if(s==Z){aJ();}else{if(w){A.panTo(w,{delay:0,flying:false});}}if(a5){b.success("mt.place","smallMap",a0.postingFormType);}}function aM(a5){if(Q){return;}if(!z){q(a5);}else{aD.focus();}}function L(a6){if(!s&&!a6){return;}if(s==a6){return;}var a5=s;s=a6;aS.toggleClass("__active",a6==Z);r.toggleClass("__active",a6==Z);if(a5==Z){au();}k();}function ag(){ac.resetSelection();var a5=ac.getSearchEntry();if(w&&a5&&a5.totalCount==0){aB();b.success("mt.place","placeAddNoConfirmPoint",a0.postingFormType);return;}x();if(w){n(w);A.panTo(w,{delay:0,flying:false});}else{aJ();if(Y){A.panTo(Y,{delay:0,flying:false});}}aZ.toggleClass("__disabled",!w);L(Z);aO=Date.now();aK=0;b.success("mt.place","placeAdd",a0.postingFormType);}function H(){aB();b.success("mt.place","placeAddConfirm",a0.postingFormType);}function ai(){L();b.success("mt.place","placeAddCancel",a0.postingFormType);}function an(){if(!w){return;}var a5=ac.getSearchEntry();if(a5){if(aK>0&&a5.totalCount>0){aY.scrollTop(0);L(p);b.success("mt.place","placeAddToConfirm",a0.postingFormType);}else{aB();b.success("mt.place","placeAddNoConfirm",a0.postingFormType);}}else{b.success("mt.place","addOkNoQueryError",a0.postingFormType);aB();}}var al,T,ao,aU,aC,o,E,ad,R,aT,N,aI,S,M,a1,aE,aN;function ae(){e("#modal_box").css("max-height",(e("#modal_cnt").height()+75)+"px");}function aB(){var a6="PostingFormPlaceAddPopLayer";var a5="placeAddDialog";a.ajax({type:"POST",url:"/dk?cmd=PopLayer",data:{"st.layer.cmd":a6,"st.layer.placeName":aD.val(),"st.layer.lat":w[0],"st.layer.lng":w[1],"st._aid":a5}}).done(function(ba,bc,bb){Q=true;var a7=ba.split(OK.navigation.SPLITER),a9=bb.getResponseHeader(OK.navigation.HEADER).split(",");for(var a8=0;a8<a7.length;a8++){OK.hookModel.setHookContent(a9[a8],a7[a8]);}al=e("#hook_Block_PopLayer");T=e("#PostingFormPlaceAddFormOk");ao=e("#PostingFormPlaceAddFormCancel");aU=e("#PostingFormPlaceAddCategory");aU.prop("selectedIndex",-1);aC=e("#PostingFormPlaceAddSubCategory");aU.on("change",ab);T.on("click",U);ao.on("click",aF);e("#nohook_modal_close,#popLayer_mo").on("click",aF);o=e("#PostingFormPlaceAddName");o.focus();E=e("#PostingFormPlaceAddCity");ad=e("#PostingFormPlaceAddStreet");R=e("#PostingFormPlaceAddHouse");aT=e("#PostingFormPlaceAddWebSite");N=e("#PostingFormPlaceAddOpeningHours");aI=e("#PostingFormPlaceAddPhone");S=e("#PostingFormPlaceAddDescription");a1=al.find('[class*="js-FieldContainer-"]');aE=al.find('[class*="js-FieldError-"]');M=e("#PostingFormPlaceAddFormShowMore").on("click",function(){M.remove();a1.show();ae();var bf=e("#modal_cnt");var bd=e("#modal_main");var be=bf.height()-bd.innerHeight();if(be>0){bd.scrollTop(be);}});aN=OK.util.parseJSON(e("#hook_placeAddData_Data").html());});}function am(){L();OK.hookModel.setHookContent("PopLayer","");al=T=ao=aU=aC=o=E=ad=R=aT=N=aI=S=aN=null;Q=false;aD.focus();}function U(){if(!w){return;}var a7={lat:w[0],lng:w[1],name:e.trim(o.val()),category:e.trim(aC.val()),countryCode:aN.country,city:e.trim(E.val()),street:e.trim(ad.val()),houseNumber:e.trim(R.val()),website:e.trim(aT.val()),openingHours:e.trim(N.val()),phone:e.trim(aI.val()),description:e.trim(S.val())};var a6=e("#PostingFormPlaceAddSubCategory option:selected").text();if(aN.cityName==E.val()){a7.cityTownId=aN.cityId;}var a5={"gwt.requested":window.pageCtx.gwtHash};e.extend(a5,a7);a.ajax({type:"POST",url:"/dk?cmd=PostingFormPlaceAddValidate",data:a5,dataType:"json",timeout:3000}).done(function(bc,a9,bi){if(!bc){al.find(".js-FieldContainer-name").addClass("form_i__error");al.find(".js-FieldError-name").html(a9).show();return;}var a8=bc.valid;if(a8){function bj(){var bl="";for(var bm=0;bm<arguments.length;bm++){var bk=arguments[bm];if(bk){if(bl){bl+=", ";}bl+=a.encodeHtml(bk);}}return bl;}var bg=bj(a7.street,a7.houseNumber,a7.city,a7.countryCode);am();q();e.extend(a7,{id:"manual",text:a7.name,smallText:a6,smallText2:bg,latitude:a7.lat,longitude:a7.lng});ax(a7);b.success("mt.place","placeAddSuccess",a0.postingFormType);}else{var bf=bc.errors;aE.hide();a1.removeClass("form_i__error");var ba="";for(var bb=0;bb<bf.length;bb++){var be=bf[bb];var bh=be.fieldName||"name";ba+=bh;var bd=be.error;al.find(".js-FieldContainer-"+bh).addClass("form_i__error");al.find(".js-FieldError-"+bh).html(bd).show();}ae();b.success("mt.place","placeAddError",ba,a0.postingFormType);}}).fail(function(a8,ba,a9){al.find(".js-FieldContainer-name").addClass("form_i__error");al.find(".js-FieldError-name").text(ba+" "+a9).show();});b.success("mt.place","placeAddOk",a0.postingFormType);}function aF(){am();b.success("mt.place","placeAddCancel",a0.postingFormType);}function ab(){var a9=aN.categories[aU.val()];var a6="";if(a9&&a9.length){if(aC.attr("disabled")){aC.removeAttr("disabled");var a5=e("#PostingFormPlaceAddCategoryContainer");var a8=e("#PostingFormPlaceAddSubCategoryContainer");a5.removeClass("js-FieldContainer-category");a8.addClass("js-FieldContainer-category");var ba=a5.find(".js-FieldError-category").remove();a8.append(ba);}for(var a7=0;a7<a9.length;a7++){var bb=a9[a7];a6+='<option value="'+bb.category+'" >'+bb.name+"</optoin>";}}aC.html(a6);aC.prop("selectedIndex",-1);}function ak(a5){if(!ac){return;}switch(a5.which){case 27:q(a5);break;case 13:var a6=ac.getSelectedItem();if(a6){ax(a6);}break;case 38:ac.selectPrevious();break;case 40:ac.selectNext();break;default:return;}a5.stopPropagation();a5.preventDefault();}function G(){if(!a0.mapEnabled){return null;}if(A){return A;}return g.load(a0.localeLanguage,function(){return aG();});}function aG(){if(A){return A;}var a5=Y;if(m){a5=[m.latitude,m.longitude];}if(!a5){a5=K;}A=new ymaps20stable.Map(I+"_PlaceMap",{center:a5,zoom:aX,behaviors:["default","scroll"]},{});if(P.hasClass("__map")){A.controls.add("zoomControl");}A.copyrights.add('&copy; <a href="http://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors');if(m){aH(A);}A.events.add("click",function(a7){var a6=a7.get("coordPosition");ar(a6);});A.events.add("boundschange",V);return A;}function n(a5){if(X){X.geometry.setCoordinates(a5);}else{X=new ymaps20stable.GeoObject({geometry:{type:"Point",coordinates:a5},properties:{}},{iconImageHref:"/res/i/ic/place-new.png",iconImageSize:[45,45],iconImageOffset:[-18,-45],draggable:false,cursor:"default"});X.events.add("click",function(a7){var a6=a7.get("coordPosition");ar(a6);});A.geoObjects.add(X);}}function aJ(){if(X){try{A.geoObjects.remove(X);}catch(a5){b.errorEx(a5,"mt.place","removeMapMark");}}X=false;}function aH(a5){if(!m){return;}if(!a5){a5=G();if(!a5){return;}}var a6=[m.latitude,m.longitude];n(a6,m.name);a5.panTo(a6,{delay:0,flying:false});}function B(){if(Y){ac.search();return;}var a5=function(){if(J||a0.location){ac.search();}else{if(!av){k();W(av);}}};if(aA){a5();return;}aA=true;if(!navigator.geolocation){b.success("mt.place","noBrowserGeolocation",a0.postingFormType);a5();return;}k("GetBrowserCoords");navigator.geolocation.getCurrentPosition(function(a6){J=Y=[a6.coords.latitude,a6.coords.longitude];if(!X&&A){A.panTo(J,{delay:0});}ac.search();b.success("mt.place","browserGeolocation",a0.postingFormType);},function(a6){a5();b.success("mt.place","browserGeolocationError",a6.code,a0.postingFormType);});}function ah(a6,bb,a7){a7|=0;var bd=e(window);var a9=a6.offset().top-bd.scrollTop()-a7;var ba=bb.offset().top+bb.outerHeight(true)+5;var bc=bd.scrollTop()+bd.height()-ba;var a8=a6.offset().top-a7;if(a9<0){bd.scrollTop(a8);}else{if(bc<0){var a5=ba-bd.height();bd.scrollTop(Math.min(a8,a5));}}}return{getPlace:function(){return m;},destroy:l,deactivate:aL};};});define("OK/postingForm/xpost",["require","jquery","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers","OK/suggest/inputChecker","OK/logger"],function(c){var e=c("jquery"),g=c("OK/suggest/suggestImpl"),d=c("OK/suggest/searchEngines"),a=c("OK/suggest/renderers"),f=c("OK/suggest/inputChecker"),b=c("OK/logger");return function(I,G){var n,j,y,C,A,R,w,H,D,m,q;var E="Status";var N;var o={GROUP_BY_INTEREST:"/res/i/stub/group-interest32.png",GROUP_FOR_BUSINESS:"/res/i/stub/group-business32.png",HAPPENING:"/res/i/stub/event32.png",COMMUNITY:""};var x;var z;var B=false;var s=a.MiniCard;var F=new s();var r;var h;M();function M(){n=e("#"+I+"_XpostMain");if(n.length==0){n=null;return;}j=e("#"+I+"_XpostMenu");y=e("#"+I+"_XpostName");C=e("#"+I+"_XpostMenuItems");A=e("#"+I+"_XpostMenuItemStatus");R=e("#"+I+"_XpostGroup");w=e("#"+I+"_XpostGroupSuggest");H=e("#"+I+"_XpostGroupNameText");D=e("#"+I+"_XpostGroupNameInputContainer");m=e("#"+I+"_XpostGroupNameInput");q=e("#"+I+"_XpostGroupMessage");y.on("click",u);C.find("li").on("click",function(){O(this);}).on("mouseenter",function(){p(this);});H.on("click",v);m.on("keydown",P);m.on("focus",function(){w.addClass("__active");});m.on("blur",function(){if(z){m.focus();}else{l(false);}});w.on("mouseenter",function(){z=true;});w.on("mouseleave",function(){z=false;});C.on("mouseenter",function(){B=true;});C.on("mouseleave",function(){B=false;});e("html").on("click",L);var S={elementId:I+"_XpostGroupSuggest",suggestElId:I+"_XpostGroupSuggest",itemsElId:I+"_XpostGroupSuggestItems",disableLoadingProgress:true,getMaxItemsInSuggest:function(){return 0;},getMaxSelectedFriends:function(){return 0;},getSearchQuery:function(){return m.val();},onItemClicked:K,onLoadingChanged:t,onSearchProgressChanged:Q};F.createItemElement=function(T){if(!T.imageSrc){T.imageSrc=o[T.type];}return s.prototype.createItemElement(T);};r=g(d.groupsSearchEngine,S,F);h=f(m,function(U,T){if(T==h.INPUT_CHANGE_MIN){Q(false);}else{if(T==h.INPUT_CHANGE){Q(true);}else{if(T==h.INPUT_TIMER){r.search();}}}});}function L(){var S=j.hasClass("__active");if(S&&!B){j.removeClass("__active");event.stopPropagation();event.preventDefault();}}function u(U){var S=j.hasClass("__active");if(S){j.removeClass("__active");b.success("mt.xpost","hide");}else{j.addClass("__active");var V=E;if(V){var T=C.find('[data-item="'+V+'"]');if(T.length>0){p(T.get(0));}}b.success("mt.xpost","show");}U.stopPropagation();U.preventDefault();}function p(S){if(A){A.find(".suggest_a").removeClass("__selected");}A=e(S);A.find(".suggest_a").addClass("__selected");}function O(T){if(!j.hasClass("__active")){return;}p(T);var U=A.attr("data-item");var S=A.find("a div").text();E=U;y.text(S);b.success("mt.xpost","select."+U);if(U=="Group"){R.show();l(!N);}else{R.hide();h.endSearchQueryCheck();m.val("");}j.removeClass("__active");G();}function K(S){x=S;N=S.id;var T=S.name;H.text(T);l(false);z=false;b.success("mt.xpost","groupSelect");}function t(X,W,V,S,U){Q(X);if(X){var T=(V&&V.length)||0;b.success("mt.xpost","searhGroup",T);}if(!X&&W&&U){if(U.totalCount==0){w.addClass("__message");q.children().addClass("invisible");q.find(V.length==0?".NoGroups":".NoGroupsFound").removeClass("invisible");}else{w.removeClass("__message");}}}function Q(S){D.toggleClass("search-input_searching",S);}function v(){if(x){m.val(x.name);r.search();}l(true);b.success("mt.xpost","groupChange");}function l(T){if(T){R.addClass("__active");w.addClass("__active");h.startSearchQueryCheck();r.search();m.focus();}else{w.removeClass("__active");var S=E=="Group";if(!S||N){R.removeClass("__active");h.endSearchQueryCheck();}}}function P(S){if(!r){return;}if(S.which==27){l(false);b.success("mt.xpost","escape");}else{if(S.which==13){var T=r.getSelectedItem();if(T){K(T);}}else{if(S.which==38){r.selectPrevious();}else{if(S.which==40){r.selectNext();}else{return;}}}}S.preventDefault();OK.stop(S);}function k(){if(!n){return;}p(C.find('[data-item="Status"]').get(0));E="Status";var S=A.find("a div").text();y.text(S);R.removeClass("__active");w.removeClass("__active");N=null;H.text("");h.setInputValue("");h.endSearchQueryCheck();G();}function J(){if(!n){return;}e("html").off("click",L);mouseIn=false;L();r.destroy();n=j=y=C=A=R=w=H=D=m=q=r=null;}return{getXpostType:function(){return E;},getGroupId:function(){return N;},deactivate:k,destroy:J};};});define("OK/postingForm",["jquery","OK/postingForm/mentions","OK/postingForm/places","OK/postingForm/xpost","OK/suggest/suggestImpl","OK/suggest/searchEngines","OK/suggest/renderers"],function(e,b,a,g,f,d,c){return function(q,p,s){if(!e||!b||!a||!g||!f||!d||!c){OK&&OK.logger&&OK.logger.error("mt.pf","init_r");return null;}var o=e;var l=o("#"+q);if(l.length==0){return null;}var h=a(q,s),n=g(q,p);function j(u){var t="";if(OK&&OK.pf&&OK.pf.getBeforeUnloadMessage){t=OK.pf.getBeforeUnloadMessage(false);if(t==""){OK.pf.log("exit.system.empty");}else{OK.pf.log("exit.system.prompt");}}if(t!=""){u.returnValue=t;return t;}}function m(){o(window).unbind("beforeunload.pf").bind("beforeunload.pf",j);}function r(){o(window).unbind("beforeunload.pf");n&&n.destroy();h&&h.destroy();n=h=null;}function k(){o(window).unbind("beforeunload.pf");n&&n.deactivate();h&&h.deactivate();}return{destroy:r,activate:m,deactivate:k,getPlace:function(){return h&&h.getPlace();},getXpostType:function(){return n&&n.getXpostType();},getXpostGroupId:function(){return n&&n.getGroupId();},jQuery:e,mentions:b,withFriends:function(t,w){var v=c.MiniCard;var u=new v();u.createItemElement=function(x){x.smallText=x.disabled?w:"";return v.prototype.createItemElement(x);};return f(d.friendsSearchEngine,t,u);}};};});define("OK/CommentWidgets",["jquery"],function(d){var c={};var b=function(g,f){return f+"_"+g;},a=function(g,f){f=parseInt(f,10);if(isNaN(f)){return;}if(c[g]&&c[g]["count"]!==f){d.each(c[g]["elements"]||[],function(){var j=d(this),h=d(".js-count",j);if(h.length>0){if(f<1){j.parent(".widget").addClass("__null");}else{j.parent(".widget").removeClass("__null");}if(f>c[g]["maxCount"]){h.text(c[g]["maxCount"]+"+");}else{h.text(f);}}});c[g]["count"]=f;}},e;return{discussionsModule:d.Deferred().done(function(f){e=f;}),updateCount:function(k,h,j){j=parseInt(j,10);var g=b(k,h);if(c[g]){var f=c[g]["count"];if(f!=undefined&&!isNaN(f)){a(g,f+j);}}},setCount:function(f,j,h){h=parseInt(h,10);var g=b(f,j);a(g,h);},add:function(g,l,k){var j=b(g,l),f=d(".js-count",k);if(k&&f.length>0){if(!c[j]){c[j]={maxCount:f.attr("data-maxCount")||Infinity,elements:[]};}var m=f.text().replace(/\s/g,"");if(!isNaN(+m)){var h=parseInt(m,10);if(!isNaN(h)){c[j].elements&&c[j].elements.push(k);c[j].count=h;}}}},remove:function(f,m,j){var h=b(f,m),l=c[h];if(l&&j){var k=l.elements,g=k?k.indexOf(j):-1;if(g>-1){k.splice(g,1);k.length===0&&delete c[h];}}},activate:function(h){if(h){var k=parseInt(h.getAttribute("data-id"),10),j=parseInt(h.getAttribute("data-type"),10),g=h.getAttribute("data-bind")!="false",f=h.getAttribute("data-location");this.add(k,j,h);if(g){d(h).on("click.cw",function(l){l.preventDefault();if(e){e(k,j,f);}});}}},deactivate:function(f){if(f){d(f).off(".cw");this.remove(parseInt(f.getAttribute("data-id"),10),parseInt(f.getAttribute("data-type"),10),f);}}};});define("OK/LikeComponent",["jquery","OK/utils/utils"],function(e,j){var g={};var c=false;var k=function(){};k.prototype={activate:function(p){var r=e(p);this.blockHookId=OK.hookModel.getNearestBlockHookId(p);this.blockHook=e("#hook_Block_"+this.blockHookId);this.id1=r.data("id1");this.id2=r.data("id2");this.type=r.data("type");this.url=r.data("url");this.owner=r.data("owner");this.like=r.data("like");this.count=r.data("count");this.isReshare="RESHARE"==this.type;var n=r.attr("data-canlike");if(this.url&&n){if(n){r.click(l.bind(this));}if(!this.isReshare){r.mouseenter(h.bind(this));}}if("true"==this.blockHook.attr("data-compact")){var q=e(".widget",this.blockHook);q.addClass("__compact");}if(this.count==0){r.mouseleave();}m(this);var o=this.blockHook.data("player-id");if(o){var s="off"==this.like;runLinkedVideoCallbackFromJS({callbackId:o,liked:s,likeCount:this.count});}},deactivate:function(n){var o=e(n);o.off();o.removeData();f(this);}};function m(o){var p=d(o),n=g[p];if(!n){g[p]=n=[];}if(o.count>-1&&n.length>0&&!c){b(p,o.blockHook.html());}n.push(o);}function f(o){var q=d(o),n=g[q];if(!n||n.length==0){return;}var p=n.indexOf(o);if(p>-1){n.splice(p,1);}}function b(r,q){c=true;try{var n=g[r];if(!n||n.length==0){return;}var p;var o=[];for(p=0;p<n.length;p++){o.push(n[p].blockHookId);}for(p=0;p<o.length;p++){OK.hookModel.setHookContent(o[p],q);}}finally{c=false;}}function d(n){return n.type+"_"+n.id1+"_"+n.id2;}function h(){a.call(this,false);}function l(){a.call(this,true);}function a(o){var p=d(this);var n=this.isReshare;var q={"st.v.refId1":this.id1,"st.v.refId2":this.id2,"st.v.type":this.type,"st.v.owner":this.owner,"st.v.count":this.count};if(this.blockHook.hasClass("__vis")){q["st.v.hookId"]=this.blockHookId;}if(o){q["st.v.like"]=this.like;}else{if(n){return;}}j.ajax({type:"POST",url:this.url,data:q}).done(function(t,r,v){if(t==null||t.length==0){return;}if(n){j.updateBlockModelCallback(t,r,v);return;}var s=t.indexOf(OK.navigation.SPLITER),u;if(s<0){u=t;}else{u=t.substring(0,s);j.updateBlockModelCallback(t.substring(s),r,v);}b(p,u);});}return k;});define("OK/scrollToTop",["jquery","OK/utils/throttle"],function(e,k){var m="__bottom",d="__hidden",a="__active",g="__animated",l="data-height",j="data-container",h=".stt";function f(){this.button=null;this.container=null;}f.prototype.activate=function c(s){var o=e(s),p=s.hasAttribute(j),w=p?e("#"+s.getAttribute(j)):e(window),t=parseInt(s.getAttribute(l)||0,10),q=t,v=o.hasClass(m);function n(){if(v&&w.scrollTop()>=t){o.removeClass(d);}}function r(){if(v){o.addClass(d);}}function u(){var y=w.scrollTop();if(y>550){o.removeClass(m+" "+d).addClass(a+" "+g);v=false;}else{if(y<500&&!v){o.removeClass(a);}}}function x(y){if(v){w.scrollTop(q);o.removeClass(m);v=false;}else{q=w.scrollTop();w.scrollTop(t);if(p){o.addClass(m);v=true;}}u();OK.stop(y);}this.button=o.on("click"+h,x).on("mouseenter"+h,n).on("mouseleave"+h,r);this.container=w.on("scroll"+h,k(10,u));};f.prototype.deactivate=function b(){if(this.button){this.button.off(h);this.button.removeClass(a+" "+g);this.button=null;}if(this.container){this.container.off(h);this.container=null;}};return f;});define("b/primary",["require","OK/utils/utils","OK/utils/throttle","OK/utils/debounce","OK/LogClicks","OK/NewsFetchCoordinator","OK/postingForm","OK/CommentWidgets","OK/LikeComponent","OK/scrollToTop"],function(a){var g=a("OK/utils/utils"),h=a("OK/utils/throttle"),j=a("OK/utils/debounce"),k=a("OK/LogClicks"),e=a("OK/NewsFetchCoordinator"),d=a("OK/postingForm"),c=a("OK/CommentWidgets"),b=a("OK/LikeComponent"),f=a("OK/scrollToTop");return function(){};});