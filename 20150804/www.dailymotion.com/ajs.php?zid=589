/* Ayads Skin Engine by Aymeric Le Corre 020020 */

/*R*/(function(){var w=window,d=w.document,ie=document.documentMode||false,url='http://ayads.co/',ads_url='http://ads.ayads.co/',secure_url='https://secure.ayads.co/',is_secure=w.location.protocol==='https:',ayads={url:url,ads_url:ads_url,setWindow:function(w){w=w;d=w.document;},getWindow:function(){return w;},setItem:function(k,v,d){var ov=localStorage.getItem('ayads-'+k);var x=parseInt(ov?ov.split('|')[1]:Date.now());if(d) x+=parseInt(d)*1000;localStorage.setItem('ayads-'+k,v+'|'+x);for(k in localStorage) if(k.substr(0,5)==='ayads'&&localStorage.getItem(k).split('|')[1]<Date.now()) localStorage.removeItem(k);},getItem:function(k){var v;if((v=localStorage.getItem('ayads-'+k))&&(v=v.split('|'))&&v[1]>Date.now()) return v[0];else {ayads.removeItem(k);return null;}},removeItem:function(k){localStorage.removeItem('ayads-'+k);},addcss:function(css){var style,id='ayads-style',c;if(c=!(style=d.getElementById(id))) {style=d.createElement('style');style.type='text/css';style.id=id;} if(style.styleSheet) style.styleSheet.cssText+=css;else style.appendChild(d.createTextNode(css));if(c) d.getElementsByTagName('head')[0].appendChild(style);},get:function(u,p){var isAbs=u.indexOf('http')===0;if(p&&p.jsonp) {var s=d.createElement('script');s.type='text/javascript';s.src=url+u;s.async=false;d.body.insertBefore(s,d.body.firstChild);} else {var x=new XMLHttpRequest(),r;if(isAbs&&navigator.userAgent.indexOf('Gecko')===-1) xhr.withCredentials=true;if(p&&p.callback) x.onload=function(){p.callback(x.responseText,x);};x.open('GET',isAbs?u:(url+u),false);x.send(null);return x.responseText;}},clickurlize:function(u){return secure_url+'click.php?zid='+ayads.zone.zid+'&aid='+ayads.ad.aid+(u?'&url='+encodeURIComponent(u):'')+(ayads.ad.data.conversion?'&conversion=1':'');},relativize:function(u){return u.replace(/^(.*?):\/\//,'//');},is_secure:function(){return w.location.protocol==='https:';},call_antenna:function(e,p) {if(window.location.hash.indexOf('ayads-')>-1)return;if(!p)p={};[2581,4364,5186,5386,5387,2581,2955,6107,5776,626,5,90,1967,601,5823,5616,1920,1919,1089,6127,3000,5682,2140,5598,246,1038,497,488,729,478,4067,2420,3559,2578].indexOf(ayads.zone.zid)!==-1&&setTimeout(function(){new Image().src='//antenna.ayads.co/?e='+e+'&z='+ayads.zone.zid+'&a='+((ayads.ad&&ayads.ad.aid)||0)+(p.sspname?'&sspname='+p.sspname:'')+'&t='+Date.now();},1000);}},ayads_display_ad=function(){var data=ayads.ad.data,image=data.image||ads_url+'delivery/image-'+ayads.ad.aid+'.jpg',color=data.color?data.color:'#FFF',top=data.top?data.top:0,click_url=ayads.clickurlize(data.url),html='',scale=1,height=1000,click_callback=function(e){console.log('ayads click',ayads.ad.data.url);if(d.body.scrollTop>(height+parseInt(w.getComputedStyle(d.body.parentNode).marginTop))&&!data.fixed&&!data.video&&!data.improve_id&&ayads.ad.format==1||(!data.url)) return false;if(window.ayads_clickcount) new Image().src=ayads_clickcount;if(ayads.ad.data.capping_clicks) {var capping_click=ayads.getItem('capping-clicks-a'+ayads.ad.aid);if(capping_click) ayads.setItem('capping-clicks-a'+ayads.ad.aid,++capping_click);else ayads.setItem('capping-clicks-a'+ayads.ad.aid,1,ayads.ad.data.capping_duration);} ayads.ad.click_callback&&ayads.ad.click_callback(e);ayads.call_antenna('c');w.open(ayads.clickurlize(ayads.ad.data.url));};if(is_secure) image=image.replace(url,secure_url).replace(ads_url,secure_url);if(ayads.ad.data.image) ayads.ad.data.image=image;var accuracy=1;if(ayads.ad&&d.location.hash.indexOf('ayads-')===-1) {setTimeout(function(){var pix=url+'impression.php?zid='+ayads.zone.zid+'&aid='+(ayads.ad.aid||0)+'&sid='+(ayads.zone.sid||0)+'&accuracy='+accuracy+'&t='+Date.now();(new Image()).src=pix;console.log('ayads impression');if(window.ayads_impressioncount) new Image().src=ayads_impressioncount;},ayads.ad.aid?5000:0);ayads.call_antenna('i');} if(ayads.ad.data.html) html+=ayads.ad.data.html;if(ayads.zone.format===ayads.ad.format&&ayads.zone.data.html) html+=ayads.zone.data.html;if(html) {html=html.replace(/\[timestamp\]/g,Date.now().toString());document.write('<div id="ayads-html">'+html+'</div>');var htmlElement=document.getElementById('ayads-html');if(htmlElement) d.body.insertBefore(htmlElement,d.body.firstChild);} if(ayads.ad.format) {if(ayads.zone.data.scale) {scale=ayads.zone.data.scale*(ayads.zone.data.scale>5?.01:1);top=Math.round(top*scale);} if(ayads.ad.data.video) ayads_display_video({scale:scale,image:image});else {var img=new Image();img.src=image;img.onload=function(){ayads.addcss('body{background-image:url("'+image+'") !important;background-size:'+Math.round(this.width*scale)+'px auto !important}');height=this.height;if(!ayads.ad.data.color&&!ie) {var canvas=document.createElement('canvas');canvas.width=1;canvas.height=img.height;var ctx=canvas.getContext('2d');var data='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="'+img.width+'" height="'+img.height+'"><image width="'+img.width+'" height="'+img.height+'" y="0" x="0" xlink:href="'+img.src.replace(/&/g,'&amp;')+'"/></svg>';var img2=new Image();var svg=new Blob([data],{type:'image/svg+xml;charset=utf-8'});var url=URL.createObjectURL(svg);img2.onload=function(){ctx.drawImage(img2,0,0);var data=ctx.getImageData(0,img2.height-1,1,1).data;if(data[3]) ayads.addcss('body{background-color:rgb('+data[0]+','+data[1]+','+data[2]+') !important}');};img2.src=url;}};} ayads.addcss('body{cursor:default;background-position:'+(ayads.ad.data.fixed?'50% '+(w.getComputedStyle(d.body.parentNode).marginTop):'center top')+' !important;background-repeat:no-repeat !important;background-image:none;background-color:'+color+' !important;background-attachment:'+(ayads.ad.data.fixed?'fixed':'scroll')+' !important;margin-left:auto !important;margin-right:auto !important;margin-top:'+top+'px !important;max-width:'+(1000*scale)+'px}html{background-image:none !important;background-color:transparent !important;cursor:pointer}');d.documentElement.onclick=function(e){if(!e||e.target===d.body.parentNode&&e.clientX<d.documentElement.clientWidth-25) {click_callback(e);}};} if(ayads.ad.data.capping_impressions) {var capping_impressions=ayads.getItem('capping-impressions-a'+ayads.ad.aid);if(capping_impressions) ayads.setItem('capping-impressions-a'+ayads.ad.aid,++capping_impressions);else ayads.setItem('capping-impressions-a'+ayads.ad.aid,1,ayads.ad.data.capping_duration);} if(ayads.zone.data.capping_impressions) {var capping_impressions=ayads.getItem('capping-impressions-z'+ayads.zone.zid);if(capping_impressions) ayads.setItem('capping-impressions-z'+ayads.zone.zid,++capping_impressions);else ayads.setItem('capping-impressions-z'+ayads.zone.zid,1,86400);} (function(){var t,u,l,h=d.getElementsByTagName('head')[0];for(i in t=[url,ayads.ad.data.url])if((u=t[i])&&u.length>9) {l=d.createElement('link');l.rel='dns-prefetch';l.href=u;h.appendChild(l);}})();},ayads_display_video=function(p){var videobg=d.createElement('video'),video=d.createElement('video'),layer=d.createElement('div'),controls=d.createElement('div'),container=d.createElement('div'),share=d.createElement('div'),html=d.body.parentNode,canplay=true,canplay_scroll=true,canplay_hover=true,play=function(p){if(p&&canplay&&(canplay_scroll||canplay_hover)) {if(video.paused) {console.log('ayads play');controls.className='ayads-video-buttons';video.play();videobg.play();}} else {console.log('ayads pause');controls.className='ayads-video-buttons paused';video.pause();videobg.pause();}};ayads.addcss('body{position:static !important}'+'#ayads-video{height:100%;min-height:80px}'+'#ayads-video-bg{min-width:100%;min-height:100%;position:fixed;top:0;left:0;right:0;z-index:-2147483648;cursor:pointer}'+'#ayads-video-layer{position:'+(ayads.ad.data.fixed?'fixed':'absolute')+';z-index:-2147483647;margin:auto;width:100%;height:1000px;left:0;right:0;-webkit-transform:translate3d(0,0,0);cursor:pointer}'+'#ayads-video-container{position:absolute;margin:auto;left:50%;transform:translate3d(-50%,0,0);-webkit-transform:translate3d(-50%,0,0);-webkit-transform:translate3d(-50%,0,0);box-shadow:0 0 18px #000;cursor:pointer}'+'.ayads-video-buttons{background:no-repeat center;background-size:contain;width:28px;height:28px;position:absolute;z-index:1;bottom:0;margin:10px 12px;opacity:.5;-webkit-transition:opacity .2s;transition:opacity .3s} .ayads-video-buttons:hover{opacity:.9 !important}\n'+'#ayads-video-controls{background-image:url(data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAzMiAzMiIgaGVpZ2h0PSIzMnB4IiBpZD0ic3ZnMiIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMzIgMzIiIHdpZHRoPSIzMnB4IiB4PSIwcHgiIHhtbDpzcGFjZT0icHJlc2VydmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeT0iMHB4Ij48ZyBpZD0iYmFja2dyb3VuZCI+PHJlY3QgZmlsbD0ibm9uZSIgaGVpZ2h0PSIzMiIgd2lkdGg9IjMyIiAvPjwvZz48ZyBpZD0icGF1c2UiPjxnPjxyZWN0IGhlaWdodD0iMjQiIHdpZHRoPSI4IiB4PSIyMCIgeT0iNCIgZmlsbD0iI0ZGRiIvPjxyZWN0IGhlaWdodD0iMjQiIHdpZHRoPSI4IiB4PSI0IiB5PSI0IiBmaWxsPSIjRkZGIiAvPjwvZz48L2c+PC9zdmc+)}'+'#ayads-video-controls.paused{background-image:url(\'data:image/svg+xml;base64,PHN2ZyBoZWlnaHQ9IjE2cHgiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDE2IDE2IiB3aWR0aD0iMTZweCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48dGl0bGUvPjxkZWZzLz48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGlkPSJJY29ucyB3aXRoIG51bWJlcnMiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIj48ZyBmaWxsPSIjRkZGIiBpZD0iR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01MjguMDAwMDAwLCAtMTQ0LjAwMDAwMCkiPjxwYXRoIGQ9Ik01NDMsMTUyIEw1MzEsMTU4IEw1MzEsMTQ2IEw1NDMsMTUyIEw1NDMsMTUyIFogTTU0MywxNTIiIGlkPSJTaGFwZSIvPjwvZz48L2c+PC9zdmc+\');}');var img=new Image();img.onload=function(){ayads.addcss('#ayads-video-layer{background:url('+p.image+') no-repeat top center;background-size:'+(p.scale*img.width)+'px auto}');};img.src=p.image;var srctype=!!ayads.ad.data.video.toString().match(':');video.id='ayads-video';video.src=ads_url+(srctype?'gateway.php?video='+encodeURIComponent(ayads.ad.data.video):'delivery/video-'+(ayads.ad.data.video==1?ayads.ad.aid:ayads.ad.data.video)+'.mp4');video.autoplay=true;video.preload=true;video.loop=true;video.muted=true;container.style.height=Math.round(ayads.ad.data.top*p.scale)+'px';container.style.marginTop='-'+container.style.height;container.addEventListener('mouseover',function(){video.volume=.75;video.muted=false;ayads.metrics=ayads.metrics||{};if(!ayads.metrics.hover) {clearTimeout(ayads.metrics.hover_timeout);ayads.metrics.hover_timeout=setTimeout(function(){ayads.metrics.hover=1;new Image().src=url+'impression.php?zid='+ayads.zone.zid+'&aid='+ayads.ad.aid+'&metric=hover';ayads.call_antenna('h');},2000);}});container.addEventListener('mouseout',function(){video.muted=true;clearTimeout(ayads.metrics.hover_timeout);});var hovertimeout=false,mouseover=function(){video.volume=.2;video.muted=false;clearTimeout(hovertimeout);hovertimeout=setTimeout(function(){canplay_hover=true;play(true);},2000);},mouseout=function(){clearTimeout(hovertimeout);video.muted=true;canplay_hover=false;play(true);};layer.addEventListener('mouseover',mouseover);layer.addEventListener('mouseout',mouseout);videobg.addEventListener('mouseover',mouseover);videobg.addEventListener('mouseout',mouseout);html.addEventListener('mouseover',function(e){});html.addEventListener('mouseout',function(e){});w.videobg=videobg;w.layer=layer;layer.onclick=function(){d.body.parentNode.onclick();};videobg.onclick=function(){d.body.parentNode.onclick();};video.addEventListener('click',function(){d.body.parentNode.onclick();},false);video.addEventListener('canplaythrough',function(){var sync=function(){if(video.readyState!==4||videobg.readyState!==4) return false;var diff=Math.abs(videobg.currentTime-video.currentTime);if(diff>.06) {videobg.currentTime=video.currentTime;if(!video.paused)videobg.play();} ayads.metrics=ayads.metrics||{};if(typeof(ayads.metrics.quartile)==='undefined')ayads.metrics.quartile=-1;var quartile=Math.floor(Math.min(1,video.currentTime/video.duration)*4);if(quartile<ayads.metrics.quartile&&ayads.metrics.quartile===3) quartile=4;if(quartile>ayads.metrics.quartile) {ayads.metrics.quartile=quartile;console.log('event quartile '+quartile);if(quartile) {new Image().src=url+'impression.php?zid='+ayads.zone.zid+'&aid='+ayads.ad.aid+'&metric=quartile'+quartile+'&currenttime='+video.currentTime+'&duration='+video.duration;ayads.call_antenna('q'+quartile);} var quatileNames=['start','firstQuartile','midpoint','thirdQuartile','complete'];if(ayads.ad.data.events&&ayads.ad.data.events[quatileNames[quartile]]) {var urls=ayads.ad.data.events[quatileNames[quartile]];console.log('event',urls);for(var j=0;j<urls.length;++j) {new Image().src=urls[j];}}}};play(true);if(!ayads.played) {ayads.played=1;setInterval(sync,750);} sync();});videobg.id='ayads-video-bg';videobg.src=ads_url+(srctype?'gateway.php?video='+encodeURIComponent(ayads.ad.data.video)+'&bg':'delivery/video-bg-'+(ayads.ad.data.video==1?ayads.ad.aid:ayads.ad.data.video)+'.mp4');videobg.preload=true;videobg.loop=true;videobg.muted=true;layer.id='ayads-video-layer';layer.style.marginTop=container.style.marginTop;container.id='ayads-video-container';controls.id='ayads-video-controls';controls.className='ayads-video-buttons';controls.addEventListener('click',function(){canplay=video.paused;play(video.paused);});w.addEventListener('blur',function(e){play(false)});w.addEventListener('focus',function(e){play(true)});var scrolltimeout=false;w.addEventListener('scroll',function(e){if(w.onscroll) w.onscroll(e);if(!arguments.callee.threshold) arguments.callee.threshold=(d.getElementsByTagName('html')[0].offsetTop+video.offsetHeight);var p=w.pageYOffset<arguments.callee.threshold;if(video.paused==p||p&&scrolltimeout) {if(p) {play(canplay_scroll=p);if(scrolltimeout) {clearTimeout(scrolltimeout);scrolltimeout=false;}} else if(!scrolltimeout) {scrolltimeout=setTimeout(function(){canplay_scroll=false;play(true);},15000);}}});d.body.addEventListener('keypress',function(e){if(e.srcElement===d.body&&e.keyCode===32) {e.preventDefault();canplay=video.paused;play(video.paused);}});container.appendChild(controls);container.appendChild(video);d.body.insertBefore(container,d.body.firstChild);d.body.insertBefore(layer,d.body.firstChild);d.body.insertBefore(videobg,d.body.firstChild);},improve_display_ad=function() {var data=ayads.ad.data,id='ayads-improve-'+ayads.ad.aid;window.improve_callback=function() {var div=document.getElementById(id),a=null,img=null,data=null,iframes;if(!ayads.ad.data.improve_id.toString().match(':')) {var pixels=document.getElementById(id+'-pixels');[['//ad.turn.com/r/cs?pid=15',0],['//cm.g.doubleclick.net/pixel?google_nid=improvedigital&google_cm&google_sc',0],['//ib.adnxs.com/getuid?http://ad.turn.com/r/cs?pid=15',0],['//pixel.mathtag.com/sync/js?sync=auto',1]].forEach(function(u){if(u[1]) {var e=document.createElement('script');e.type='text/javascript';e.async=true;} else {var e=document.createElement('img');e.style.display='none';} e.src=u[0];pixels.appendChild(e);});} if(div.childNodes.length===0) div.insertBefore(div.nextSibling,div.firstChild);a=div.getElementsByTagName('a')[0];if(a) {img=a.getElementsByTagName('img')[0];a.style.display='none';var data=a.getAttribute('data-data');if(data) window.ayads_data=JSON.parse(data);} var redirectElement=d.getElementById('ayads-redirect');if(redirectElement&&redirectElement.dataset.data) data=JSON.parse(redirectElement.dataset.data);if(iframes=div.getElementsByTagName('iframe')) {for(var i=0,ii=iframes.length;i<ii;++i) {if(iframes[i].width==970) {console.log('ayads billboard');var height=parseInt(iframes[i].height);ayads.zone.scale=1;ayads.addcss('.ayads-billboard{margin-top:-'+height+'px;height:'+height+'px;width:100%;text-align:center}');window.ayads_data={top:height,color:'#FFF',html:'<div id="ayads-billboard"></div>'};div.style.display='block';div.className='ayads-billboard';d.body.insertBefore(div,d.body.firstChild);} else if(iframes[i].width>1400) {var u=encodeURIComponent(iframes[i].src),t='';if(u.indexOf('doubleclick')!==-1) t=encodeURIComponent(div.innerHTML.match(/pixel\?d\=(.*?)&/)[1]);a={href:url+'gateway.php?a&iframeparser='+u+'&t='+t};img={src:url+'gateway.php?img&iframeparser='+u+'&t='+t};break;}}} if(window.console&&console.log) {console.log('ayads improve response',a);} if(window.ayads_data) {console.log('ayads data',ayads_data);for(var i in ayads_data) if(typeof ayads_data[i]==='string') ayads_data[i]=ayads_data[i].replace(/ay:\/\//g,'http://');ayads_data.improve_id=ayads.ad.data.improve_id;ayads.ad.data=ayads_data;ayads.ad.aid=ayads_data.aid||0;delete ayads_data;if(ayads.ad.data.shop) shop_display_ad();else ayads_display_ad();} else if(a&&img&&a.href&&img.src&&a.href.length>30&&img.src.indexOf('1x1')===-1&&a.href.toString().indexOf('info.criteo')===-1) {if(a.href.indexOf('j')===0) {ayads.ad.click_callback=function(){eval(a.href.replace('javascript:',''))};ayads.ad.data.url=a.href.match(/\(.*\)/)[0].replace(/\(|\)|'/gi,'');} else ayads.ad.data.url=a.href;ayads.ad.data.image=img.src;ayads.ad.data.top=220;ayads.ad.data.color=false;if(a.onclick) ayads.ad.click_callback=a.onclick;if(window.ayads_shop) ayads.ad.data.shop=ayads_shop;typeof(improve_id)!=='undefined'&&ayads.call_antenna('sspok',{sspname:'improve'});ayads_display_ad();} else {ayads.zone.noads.push(ayads.ad.aid);ayads.setItem('noads-'+ayads.ad.aid,1,typeof(rubicon_id)==='undefined'?43200:0);delete ayads.ad;typeof(improve_id)!=='undefined'&&ayads.call_antenna('sspko',{sspname:'improve'});ayads_select_ad();}};if(data.improve_id.toString().match('rubicon')) {var rubicon_id=data.improve_id.toString().split(':');rp_account=rubicon_id[1];rp_site=rubicon_id[2];rp_zonesize=rubicon_id[3];rp_adtype='js';rp_smartfile='[SMART FILE URL]';rp_kw=(typeof rpx_params!=='undefined'&&typeof rpx_params.kw!=='undefined')?rpx_params.kw:'';rp_visitor=(typeof rpx_params!=='undefined'&&typeof rpx_params.visitor!=='undefined')?rpx_params.visitor:{};rp_inventory=(typeof rpx_params!=='undefined'&&typeof rpx_params.inventory!=='undefined')?rpx_params.inventory:{};var script_url='http://ads.rubiconproject.com/ad/'+rp_account+'.js';} else if(data.improve_id.toString().match('appnexus2')) {var appnexus_id=data.improve_id.toString().split(':');var gmtp="http",gmturl=gmtp+"://fr.gmads.mookie1.com/r",gmth="[REFERRER_DOMAIN]",gmthp="[REFERRER_PATH]";if(gmth.indexOf('.')<0)var gmth='[REFERRER_URL]';var script_url=gmturl+"?width=1&height=1&gmtr=[CACHEBUSTER]&gmtsubsite="+appnexus_id[1]+"&gmtctrl=8&gmttu=25832&gmtt=js&gmti=xs_fr_display&gmtsrc=xs_fr&gmth="+gmth+"&gmthp="+gmthp;} else if(data.improve_id.toString().match('appnexus')) {var appnexus_id=data.improve_id.toString().split(':');if(appnexus_id.length<2)appnexus_id[1]=3747804;var script_url='http://ib.adnxs.com/ttj?id='+appnexus_id[1]+'&size=1800x1000&promo_sizes=&promo_alignment=center&referrer='+w.location.hostname;} else {var improve_id=data.improve_id;var script_url='//ad.360yield.com/adj?p='+improve_id+'&w=1800&h=1000&tz='+(new Date().getTimezoneOffset())+'&click3rd=';if(data.local) script_url='test-improve.php';ayads.call_antenna('sspc',{sspname:'improve'});} document.write('<div id="'+id+'" style="display:none"><script type="text/javascript" src="'+script_url+'"><\/script></div>'+'<div id="'+id+'-pixels" style="display:none"></div>'+'<script type="text/javascript">improve_callback();</script>');},sticky_display_ad=function() {var vast_url=ayads.ad.data.sticky.toString().indexOf('://')!==-1?ayads.ad.data.sticky:'http://ads.stickyadstv.com/www/delivery/swfIndex.php?reqType=AdsSetup&protocolVersion=2.0&zoneId='+ayads.ad.data.sticky;var data=ayads.get(vast_url,{callback:function(res,xhr){console.log('vast response',xhr.responseXML);top.ayads_xhr=xhr;var clickElement=xhr.responseXML.querySelector('ClickThrough');var wrappedClickElement=null;var videoSelector='MediaFile[type*=mp4],MediaFile:not([type*=flash]):last-child,MediaFile:last-child';var videoElement=xhr.responseXML.querySelector(videoSelector);var wrapperElement=xhr.responseXML.querySelector('Wrapper');var impressionElements=xhr.responseXML.querySelectorAll('Impression');var wrappedImpressionElements=null;var trackingElements=xhr.responseXML.querySelectorAll('Tracking');var wrappedTrackingElements=null;var adParametersElement=xhr.responseXML.querySelectorAll('AdParameters');console.log(adParametersElement);if(wrapperElement) {var url=wrapperElement.querySelector('VASTAdTagURI').firstChild.nodeValue;console.log('ayads wrapped ad url',url);ayads.get(url,{callback:function(res,wrapperXhr){console.log('ayads wrapper',wrapperXhr.responseXML);videoElement=wrapperXhr.responseXML.querySelector(videoSelector);clickElement=wrapperXhr.responseXML.querySelector('ClickThrough');if(!videoElement) {var wrapper2Element=wrapperXhr.responseXML.querySelector('VASTAdTagURI');console.log('wrapper2 url',wrapper2Element.firstChild.nodeValue);ayads.get(wrapper2Element.firstChild.nodeValue,{callback:function(res,wrapper2Xhr){videoElement=wrapper2Xhr.responseXML.querySelector(videoSelector);clickElement=wrapper2Xhr.responseXML.querySelector('ClickThrough');console.log('videoElement2',videoElement);}});console.log('wrapper2Element',wrapper2Element);} d.documentElement.addEventListener('click',function(e){if(e.target&&(e.target.nodeName==='HTML'||e.target.id==='ayads-video-layer'||e.target.id==='ayads-video'||e.target.id==='ayads-video-bg')){var clickTrackingElements=xhr.responseXML.querySelectorAll('ClickTracking');if(clickTrackingElements&&clickTrackingElements.length) {for(var i in clickTrackingElements) {var url=clickTrackingElements[i].firstChild.nodeValue;if(url) {new Image().src=url;console.log('ayads click vast',url);}}}}},true);wrappedImpressionElements=wrapperXhr.responseXML.querySelectorAll('Impression');if(wrappedImpressionElements) impressionElements=Array.prototype.slice.call(impressionElements).concat(Array.prototype.slice.call(wrappedImpressionElements));wrappedTrackingElements=wrapperXhr.responseXML.querySelectorAll('Tracking');if(wrappedTrackingElements) trackingElements=Array.prototype.slice.call(trackingElements).concat(Array.prototype.slice.call(wrappedTrackingElements));}});} console.log('ayads videoElement',videoElement,videoSelector);console.log('ayads clickElement',clickElement);if(videoElement&&clickElement) {if(wrappedClickElement) {ayads.ad.data.url=wrappedClickElement.firstChild.nodeValue;ayads.ad.click_callback=function(){new Image().src=clickElement.firstChild.nodeValue;};} else {ayads.ad.data.url=clickElement.firstChild.nodeValue;} ayads.ad.data.video=videoElement.firstChild.nodeValue;if(!ayads.ad.data.image) ayads.ad.data.image='about:blank';if(!ayads.ad.data.html)ayads.ad.data.html='';console.log('impressionElements',impressionElements);for(i=0;i<impressionElements.length;++i) ayads.ad.data.html+='<img src="'+impressionElements[i].firstChild.nodeValue+'" style="display:none">';if(trackingElements) {ayads.ad.data.events=[];for(i=0;i<trackingElements.length;++i) {var e=trackingElements[i];var event=e.getAttribute('event');if(event) {if(!ayads.ad.data.events[event]) {ayads.ad.data.events[event]=[];} ayads.ad.data.events[event].push(e.firstChild.nodeValue.toString());}}} ayads_display_ad();} else {ayads.zone.noads.push(ayads.ad.aid);ayads.setItem('noads-'+ayads.ad.aid,1,3);delete ayads.ad;ayads_select_ad();}}});},shop_display_ad=function() {window.ayads_callback=function(r) {if(r&&r.length&&r[0].url) {ayads_display_ad();window.ayads_shop_loaded&&window.ayads_shop_loaded(r);var i,shops;ayads.addcss('.ayads-shops{position:relative}'+'.ayads-shop{background:#FFF;width:180px;height:180px;position:absolute;text-align:center;color:#000;box-shadow:0 0 7px rgba(0,0,0,.8);font-size:12px;border-radius:6px;box-sizing:border-box;transition:.4s all;left:50%;overflow:hidden;line-height:14px}'+'.ayads-shop:hover{-webkit-transform:scale(1.1);transform:scale(1.1)}'+'.ayads-shop a{color:#555;display:block;position:absolute;padding:23px 18px;text-decoration:none;width:100%;box-sizing:border-box;-moz-box-sizing:border-box}.ayads-shop a:hover{color:#555 !important}'+'@-webkit-keyframes ayads-shop1{0%{opacity:0} 40%{opacity:0} 50%{opacity:1} 90%{opacity:1}}@-moz-keyframes ayads-shop1 {0%{opacity:0} 40%{opacity:0} 50%{opacity:1} 90%{opacity:1}}'+'@-webkit-keyframes ayads-shop2{0%{opacity:1} 40%{opacity:1} 50%{opacity:0} 90%{opacity:0}}@-moz-keyframes ayads-shop2 {0%{opacity:1} 40%{opacity:1} 50%{opacity:0} 90%{opacity:0}}'+'.ayads-shop-price{color:red;font-weight:bold;font-family:Arial,sans-serif !important}.ayads-shop-name{height:28px;overflow:hidden;font-family:Arial,sans-serif !important;margin-top:2px}'+'.ayads-shop-discount-price{text-decoration:line-through;color:#999}'+'.ayads-shop-discount{color: #FFF;position: absolute;top: 10px;left: 10px;background: #fe0d54;border-radius: 20px;font-size: 15px;line-height: 40px;width: 40px;}'+'.ayads-shop-image{height:85px;background:center no-repeat;background-size:contain;border-radius:21px 21px 0 0}'+'.ayads-shop-logo{height:20px !important;vertical-align:middle;border:none}');shops=d.createElement('div');shops.className='ayads-shops';d.body.insertBefore(shops,d.body.firstChild);r=r.sort(function(){return(Math.round(Math.random())-0.5);});if(ayads.zone.data.scale&&ayads.zone.data.scale>50) ayads.zone.data.scale*=.01;for(var i=0;i<10;++i) {var shop,p=r[(i+(Math.floor(i/r.length)%2))%r.length];{shop=d.createElement('div');shop.id='ayads-shop'+Math.floor(i);shop.className='ayads-shop';shop.style.marginTop=(Math.floor(i/2)*210)+'px';shop.style.marginLeft=(((i)%2?1:-1)*605*(ayads.zone.data.scale?ayads.zone.data.scale:1)-90)+'px';shops.appendChild(shop);} shop.innerHTML+='<a href="'+ayads.clickurlize(p.url)+'" target="_blank">'+'<div class="ayads-shop-image" style="background-image:url(\''+(p.image?p.image:'about:blank')+'\')"></div>'+'<div class="ayads-shop-name">'+p.name+'</div>'+'<div class="ayads-shop-price">'+ (p.logo?'<img src="'+p.logo+'" class="ayads-shop-logo"> ':'')+ (p.price?p.price+(p.price.toString().indexOf('')<0?'':''):'')+ (p.discount_price?' <div class="ayads-shop-discount-price">'+p.discount_price+(p.price.toString().indexOf('')<0?'':'')+'</div>':'')+ (p.discount?'<div class="ayads-shop-discount">'+p.discount+'</div>':'')+'</div>'+'</a>';shop.onclick=d.body.parentNode.onclick;};if(typeof cat!=='undefined') {if(cat[0]==='zanox') ayads.ad.data.url=r[0].url.replace(/\[\[(.*)\.(.*)\.com(.*)\]\]/,'[[www.$2.com]]');else if(cat[0]==='soar'&&Math.random()>.2) {var kw;if(window.ayads_shop_keywords) {kw=ayads_shop_keywords.split(',');kw=kw[Math.floor(Math.random()*kw.length)];} else kw=r[Math.floor(Math.random()*6)].name.replace(/\s*\b\w*\d\w*\b/g,'');ayads.ad.data.url='http://adserver.soar-media.com/hotspots/land.php?Keywords='+encodeURIComponent(kw)+'&mkt=fr&adultFilter=clean&PartnerId=271&Partner=soar_xml_fr_synd_sublime&termFilters=soar_fr&urlFilters=soar_fr&maxCount=15&cat=19#ayads-aid='+ayads.ad.aid;}}} else {ayads.zone.noads.push(ayads.ad.aid);ayads.setItem('noads-'+ayads.ad.aid,1,86400);ayads_select_ad();}};window.twenga_callback=function(r){if(r.products.length) {if(r.image)ayads.ad.data.image=r.image;w.ayads_callback(r.products);}};if(!ayads.ad.data.shop.products&&ayads.ad.data.shop.toString().charAt(0)==='{') ayads.ad.data.shop=eval('('+ayads.ad.data.shop+')');if(ayads.ad.data.shop.products) ayads_callback(ayads.ad.data.shop.products);else {var cats=ayads.ad.data.shop.toString().split(',');var cat=cats[Math.floor(Math.random()*cats.length)].split(':');var src;if(cat[0]==='twenga') src='http://api.wtpn.twenga.fr/SearchItem?confkey=528f12b6d1e2d&callback=twenga_callback&e=eyJrIjoiNTI4ZTQ2ZTE5MWIwZSIsImMiOiI1IiwibCI6IjE1IiwibyI6InN1YmxpbWVfc2tpbnoifQ==&cack=ce3a873f85f2c660f77f1673ac424a1404cb507a';else if(cat[0]=='coray') src='http://data.ayads.co/api.php?from=ayads&zid='+ayads.zone.zid+'&aid='+(ayads.ad.aid||0)+'&url='+encodeURIComponent(url?d.location.href:'http://chokomag.com/');else src=url+'gateway.php?'+cat[0]+(cat.length>1?'='+cat[1]:'');document.write('<script type="text/javascript" src="'+src+'"></script>');}},ayads_display_targeted_ad=function() {var segments,ttl=86400*7;window.ayads_callback=function(r){ayads.setItem('segments',JSON.stringify(r),ttl);if(r.indexOf(ayads.ad.data.sgid)!==-1) ayads_display_ad();else {ayads.zone.noads.push(ayads.ad.aid);ayads.setItem('noads-'+ayads.ad.aid,1,ttl);ayads_select_ad();} delete ayads_callback;};if((segments=ayads.getItem('segments'))!==null) ayads_callback(eval('('+segments+')'));else document.write('<script type="text/javascript" src="'+url+'gateway.php?segments"></script>');},ayads_select_ad=function() {var ads=[{"aid":807,"zid":589,"weight":10,"priority":3,"format":1,"chid":0,"data":{"improve_id":633641,"top":220,"color":"#FFF"}},{"aid":6046,"zid":589,"weight":10,"priority":2,"format":1,"chid":0,"data":{"capping_duration":86400,"color":"#FFF","top":220,"improve_id":"rubicon:12338:47352:213486-68"}}];var ads_count=ads.length;var i;var ii;var r;var weight_total=0;var weight_sum=0;var max_priority=0;if(!ayads.zone) {ayads.zone={"zid":589,"sid":433,"format":1,"data":{"premium":0,"pageviews":54760000,"unique_visitors":14800000,"main_channel":80,"sub_channel":65,"url":"http://www.dailymotion.com/fr","description":"Plateforme d'information et de diffusion de vid\u00e9os - Toutes les homes pages","description_en":"Platform of news and videos - Section \u0022Home Page\u0022","sublime:state":"ready","html":"\u003Cstyle\u003E\r\nhtml{position: static;\r\nmargin-top: 60px;}\r\n\r\n.sd_header{position: absolute !important;\r\ntop: 0 !important;\r\nleft: 0 !important;\r\nwidth: 100% !important;}\r\n#wrapper{width:100% !important; background-color:white !important;}\r\n#content.fluid{width: 99% !important; margin-top:0px !important; left:0px !important;}\r\n#content.fluid .navigation-wrapper{position: static !important;}\r\n.navigation-wrapper{width:initial !important; margin:0px !important;}\r\n.container-fluid{width:100% !important;}\r\n.sd_footer{bottom: inherit !important;}\r\n#content{left:0px !important;}\r\n\u003C/style\u003E\r\n\r\n\u003C!-- ##### ##### ##### ##### ##### --\u003E\r\n\u003C!-- ayads zone conf begin - DO NOT EDIT --\u003E\r\n\u003C!-- zone conf [Nielsen OCR FR] begin --\u003E\r\n\r\n\u003C!--\r\n\r\ncreative    13617\r\n\r\nzone conf script from sublime-test/data-nielsen-ocr\r\n\r\n--\u003E\r\n\r\n\u003Cscript\u003E\r\n\r\n/*\r\nif (typeof ayads == 'undefined') {\r\n\tvar ayads = {\r\n\t\tzone:{\r\n\t\t\tzid: Math.floor(Math.random() * 1000)\r\n\t\t}\r\n\t};\r\n}\r\n*/\r\n\r\n(function(ayads) {\r\n    ayads = ayads || {};\r\n    // var host = window.location.host.toString();\r\n\r\n    var createCookie = function (name, value, days) {\r\n        var expires = \u0022\u0022;\r\n        if (days) {\r\n            var date = new Date();\r\n            date.setTime(date.getTime()+(days*24*3600*1000));\r\n            expires = \u0022; expires=\u0022+date.toGMTString();\r\n        }\r\n\r\n        document.cookie = name + \u0022=\u0022 + value + expires + \u0022;path=/\u0022;\r\n    };\r\n\r\n    var getCookie = function (name) {\r\n        var dc = document.cookie;\r\n        var prefix = name + \u0022=\u0022;\r\n        var begin = dc.indexOf(\u0022; \u0022 + prefix);\r\n        if (begin == -1) {\r\n            begin = dc.indexOf(prefix);\r\n            if (begin != 0) {\r\n                return null;\r\n            }\r\n        } else {\r\n            begin += 2;\r\n            var end = document.cookie.indexOf(\u0022;\u0022, begin);\r\n            if (end == -1) {\r\n                end = dc.length;\r\n            }\r\n        }\r\n\r\n        return unescape(dc.substring(begin + prefix.length, end));\r\n    };\r\n\r\n    var XMLHttpFactories = [\r\n        function () {return new XMLHttpRequest()},\r\n        function () {return new ActiveXObject(\u0022Msxml2.XMLHTTP\u0022)},\r\n        function () {return new ActiveXObject(\u0022Msxml3.XMLHTTP\u0022)},\r\n        function () {return new ActiveXObject(\u0022Microsoft.XMLHTTP\u0022)}\r\n    ];\r\n\r\n    var createXMLHTTPObject = function () {\r\n        var xmlhttp = false;\r\n        for (var i in XMLHttpFactories) {\r\n            try {\r\n                xmlhttp = XMLHttpFactories[i]();\r\n            } catch (e) {\r\n                continue;\r\n            }\r\n            break;\r\n        }\r\n        return xmlhttp;\r\n    };\r\n\r\n    var sendRequest = function  (url, callback, postData) {\r\n        var xhr = createXMLHTTPObject();\r\n        if (!xhr) return;\r\n        var method = (postData) ? \u0022POST\u0022 : \u0022GET\u0022;\r\n        xhr.open(method,url,true);\r\n        xhr.setRequestHeader('User-Agent','XMLHTTP/1.0');\r\n        if (postData) {\r\n            xhr.setRequestHeader('Content-type','application/x-www-form-urlencoded');\r\n        }\r\n\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState != 4) return;\r\n            if (xhr.status != 200 \u0026\u0026 xhr.status != 304) {\r\n                return;\r\n            }\r\n            callback(xhr);\r\n        }\r\n\r\n        if (xhr.readyState == 4) return;\r\n\r\n        xhr.send(postData);\r\n    };\r\n\r\n    var url = \u0022http://ayads.co/tmpnlsn/?zid=\u0022 + ayads.zone.zid + \u0022\u0026_=\u0022 +  (new Date()).getTime();\r\n\r\n    var checkUser = function() {\r\n        if (!getCookie(\u0022ayadsocrvu\u0022)) {\r\n            // console.log('ayadsocrvu : no cookie');\r\n            createCookie(\u0022ayadsocrvu\u0022, \u00221\u0022, 30);\r\n            sendRequest(url, function(xhr) {\r\n                if (xhr.responseText === '42') {\r\n\r\n                    // console.log('ayadsocrvu : request ok');\r\n\r\n                    // call nielsen OCR script\r\n                    var thirdParyUrl = 'http://cdn.imrworldwide.com/cgi-bin/zp/7/z?ci=ent433421\u0026am=4\u0026ep=1\u0026at=view\u0026rt=banner\u0026st=image\u0026ca=cmp187692\u0026cr=creative\u0026pc=' + (ayads ? (ayads.zone ? ayads.zone.zid : '') : '') + '\u0026r=[timestamp]';\r\n                    new Image().src = thirdParyUrl;\r\n\r\n                    // console.log('thirdParyUrl: ' + thirdParyUrl);\r\n                } else {\r\n                    // console.log('ayadsocrvu : request error');\r\n                }\r\n            });\r\n        } else {\r\n            // console.log('ayadsocrvu : cookie already present');\r\n        }\r\n    };\r\n\tcheckUser();\r\n})(ayads);\r\n\r\n\u003C/script\u003E\r\n\r\n\r\n\u003C!-- zone conf [Nielsen OCR FR] end --\u003E\r\n\u003C!-- ayads zone conf end --\u003E\r\n\u003C!-- ##### ##### ##### ##### ##### --\u003E\r\n","passback":"","capping_impressions":0,"scale":105,"exclude":0}};if(!ayads.zone.zid)ayads.zone.zid=0;if(!ayads.zone.noads)ayads.zone.noads=[];} if(window.ayads_ads) {for(i=0;i<ayads_ads.length;++i) {ayads_ads[i].priority=10;if(ayads_ads[i].data&&ayads_ads[i].data.aid) ayads_ads[i].aid=ayads_ads[i].data.aid;} ads=ads.concat(ayads_ads);ads_count=ads.length;} ayads.call_antenna('l');if(d.location.hash.indexOf('ayads-')===1||sessionStorage.getItem('ayads')) {var h=d.location.hash.substr(7)||sessionStorage.getItem('ayads');if(h.indexOf('aid=')===0) {var aid=parseInt(h.match(/aid=([0-9]+)/)[1]);ad=eval('('+ayads.get('ajs.php?aid='+aid+'&from_zone='+ayads.zone.zid)+')');if(ad&&aid!==0) {ad.data=ad.data||{};ad.data.capping_impressions=0;ad.data.capping_clicks=0;ad.data.capping_duration=0;ad.data.geo=null;ad.data.hours=null;ad.data.sgid=null;ayads.zone.data.capping_impressions=0;ads=[ad];ads_count=1;ayads.zone.data=ad.zone;} else {ads_count=0;} if(ad.js) eval(ad.js);} else {var js=ayads.get('ajs.php?aid=0&from_zone='+ayads.zone.zid);if(js)ayads.zone.data=eval('('+js+')').zone;ayads.zone.data.capping_impressions=0;ads=[{aid:14,format:1,weight:50,priority:1,data:{url:'http://sublimeskinz.com/',color:'#FFF',image:ads_url+'img/ayads-test.jpg',top:220}}];ads_count=1;if(h==='skinzlab') ads[0].data.image='http://sublimeskinz.com/v1/?skinzlab&image='+Date.now();}} var hour=new Date().getHours();for(i=0;i<ads_count;++i) {var ad=ads[i];ads[i].enabled=true;if(!ad.aid)ads[i].aid=0;if(!ad.weight)ads[i].weight=1;if(!ad.priority)ads[i].priority=1;if(!ad.format&&ad.format!==0)ad.format=1;if(!ad.data)ad.data={};if(!ad.data.image)ad.data.image=ads_url+'delivery/image-'+ad.aid+'.jpg';if(ayads.getItem('noads-'+ad.aid)&&!w.location.hash||(ayads.zone.noads.indexOf&&ayads.zone.noads.indexOf(ads[i].aid)!==-1)) ads[i].enabled=false;if(ad.data.video) {var v=document.createElement('video');if(!v.canPlayType||!v.canPlayType('audio/mp4')) ads[i].enabled=false;} if(ad.data.capping_duration&&(parseInt(ayads.getItem('capping-clicks-a'+ad.aid))>=ad.data.capping_clicks||parseInt(ayads.getItem('capping-impressions-a'+ad.aid))>=ad.data.capping_impressions)) {ads[i].enabled=false;ads[i].disabled=true;} if(ad.data.hours&&ad.data.hours.length&&ad.data.hours.indexOf(hour)===-1) ads[i].enabled=false;if(ad.data.geo) {var geo,matched=false;if(!(geo=ayads.getItem('geo3'))) ayads.setItem('geo3',geo=ayads.get('gateway.php?geo'),7776000);geo=geo?eval('('+geo+')'):[0];ad.data.geo=ad.data.geo.split(',');for(var j=0;j<ad.data.geo.length;++j) {var ad_geo=ad.data.geo[j].split(':');if(geo[0]===ad_geo[0].toLowerCase()) {if(ad_geo.length===1) matched=true;else {for(var k=1;k<geo.length;++k) {ad_geo[1]=ad_geo[1].toLowerCase().replace(/ /,'-');if(geo[k]) geo[k]=geo[k].toLowerCase().replace(/ /,'-');if(geo[k]&&geo[k].match(ad_geo[1])) {console.log('region matched');matched=true;}}}}} if(!matched) ads[i].enabled=false;}} for(i=0;i<ads_count;++i) if(ads[i].enabled&&ads[i].priority>max_priority) max_priority=ads[i].priority;for(i=0;i<ads_count;++i) if(ads[i].enabled) ads[i].enabled=ads[i].priority==max_priority;for(i=0;i<ads_count;++i) if(ads[i].enabled) weight_total+=ads[i].weight;if(ayads.zone.data.capping_impressions&&typeof(aid)==='undefined') {var capping=ayads.getItem('capping-impressions-z'+ayads.zone.zid);if(capping>=ayads.zone.data.capping_impressions) {ads=[];ads_count=0;}} r=Math.random()*weight_total;if((!ie||ie>9)&&screen.width>1200&&!navigator.userAgent.match(/android/i)&&!navigator.userAgent.match(/iphone/i)&&!navigator.userAgent.match(/ipad/i)) {ayads.call_antenna('p');for(i=0;i<ads_count;++i) {var ad=ads[i];if(ads[i].enabled&&!ads[i].disabled) {weight_sum+=ad.weight;if(r<weight_sum) {ayads.ads=ads;ayads.ad=ad;if(ad.data.improve_id) improve_display_ad();else if(ad.data.shop) shop_display_ad();else if(ad.data.sticky) sticky_display_ad();else if(ad.data.sgid) ayads_display_targeted_ad();else ayads_display_ad();return false;}}} ayads.call_antenna('ipb');} else ayads.call_antenna('ppb');if(ayads.zone.data.passback) {console.log('ayads passback');document.write('<div class="ayads-passback">'+ayads.zone.data.passback+'</div>');}};try{w=top;d=w.document;} catch(e){console.log('ayads tag in cross domain iframe',e);w=window;d=w.document;} if(is_secure) {url=secure_url;ads_url=secure_url;} window.ayads=ayads;window!==w&&(w.ayads=ayads);(function(){var accuracy=5,new_visitor;if(ayads.getItem('user')) {new_visitor=0;} else {new_visitor=1;var date=new Date();var ttl=Math.floor((new Date(date.getFullYear(),date.getMonth()+1,1,0,0).getTime()-date.getTime())/1000);ayads.setItem('user',1,ttl);}!is_secure&&Math.random()<1/accuracy&&setTimeout(function(){new Image().src='//data.ayads.co/analytics.php?zid='+ayads.zone.zid+'&sid='+ayads.zone.sid+'&accuracy='+accuracy+'&new_visitor='+new_visitor;},3000);})();ayads_select_ad();})();