define("OK/Growl",["OK/logger"],function(n){var e=document.getElementById("ntf_toolbar_button"),k="CallApplication",h="appMain",c="toolbar_nav_a__notif__active",l="ntf_spacer__animated",i="ntf_spacer__on",m="ntf-growl",d=(function(){var o,p,r=document.createElement("bootstrap"),q={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(p in q){if(q.hasOwnProperty(p)&&r.style[p]!==undefined){o=q[p];break;}}return o;}());function b(p,o){this.type=p;this.hidden=true;this.stash=null;this.crossTime=0;this.layerKey=o;this.blockId="growl-"+this.type;this.block=document.getElementById("hook_Block_"+this.blockId);if(this.block){this.elem=this.block.children[0];this.id=this.elem?this.elem.getAttribute("data-id"):null;this.time=a(this.elem);}}b.current=null;b.prototype={show:function(){if(this.id&&g.call(this)){this.elem.classList.add(i);this.hidden=false;b.current=this;if(this.type==="notifications"){e.classList.add(c);}}},hide:function(o){var p=this.elem;o=o&&d;if(p){if(!o){p.classList.remove(l);}else{this.elem.addEventListener(d,this,false);}p.classList.remove(i);e.classList.remove(c);if(!o){p.classList.add(l);this.hidden=true;}}b.current=null;},destroy:function(o){o=o&&d;if(this.elem){this.id=null;this.time=null;this.hide(o);this.elem=null;}if(!o){OK.hookModel.setHookContent(this.blockId,"");this.hidden=true;}},setNewContent:function(q){var o=this,p=j(q);if(OK.Layers&&OK.Layers.isLayerOpened(o.layerKey)){n.success(m,o.type,"ignore");}else{if(q){var s=q.getAttribute("data-id"),r=a(q);if(o.id===s&&o.time===r){n.success(m,o.type,"equal-1");return;}if(this.crossTime>=r){n.success(m,o.type,"time");return;}if(o.hidden){this.setNewGrowl(p,s,r);}else{this.stash={html:p,id:s,time:r};o.destroy(true);}}}},updateCrossTime:function(){if(this.time>=this.crossTime){this.crossTime=this.time;}},setNewGrowl:function(o,q,p){if(this.id===q&&this.time===p){n.success(m,this.type,"equal-2");return;}OK.hookModel.setHookContent(this.blockId,o);this.elem=this.block.firstChild;this.id=q;this.time=p;setTimeout(this.show.bind(this),50);},handleEvent:function(o){if(o.propertyName!=="top"){return;}o.target.removeEventListener(d,this);this.hidden=true;if(this.stash===null){OK.hookModel.setHookContent(this.blockId,"");}else{this.setNewGrowl(this.stash.html,this.stash.id,this.stash.time);n.success(m,this.type,"replace");this.stash=null;}}};return b;function g(){return b.current===null&&!(f()||document.getElementById(k)||OK.getCurrentDesktopModelId()===h);}function f(){return OK.Layers&&OK.Layers.isAnyLayerOpened();}function j(p){var o=document.createElement("div");o.appendChild(p);return o.innerHTML;}function a(o){if(o){return parseInt(o.getAttribute("data-time"),10)||0;}return 0;}});define("OK/GrowlController",["OK/logger","OK/NewsFetchCoordinator","OK/Growl"],function(b,c,a){var f=300,e="ntf-growl",d={discussions:new a("discussions","discussions"),notifications:new a("notifications","layer_notifications")};return{activate:function(){var h=this,i;h.showAny();OK.hideGrowl=function(k){var j=k.getAttribute("data-type");if(j){if(j==="notifications"){OK.submit(k);i=d.notifications;if(i){i.updateCrossTime();c.updateParam("st.growlTime",i.time);}}d[j].destroy(true);setTimeout(h.showAny,f);b.success(e,j,"close."+k.getAttribute("data-subtype"));}};},setNewContent:function(l){if(l&&l.length){var k=g(l),j,h,m;if(!k){b.clob(e,l,"ctrl","update");}else{for(j=0;j<k.length;j++){h=k[j];m=h.getAttribute("data-type");if(m&&d[m]){d[m].setNewContent(h);}}}}},showAny:function(){if(a.current){return;}for(var i in d){if(d.hasOwnProperty(i)){var h=d[i];if(h.hidden){h.show();if(!h.hidden){break;}}}}},hideAll:function(){var i,h;for(i in d){if(d.hasOwnProperty(i)){h=d[i];if(!h.hidden){h.hide();}}}},notifications:function(){return d.notifications;},discussions:function(){return d.discussions;}};function g(l){var k=document.createElement("div"),j,m,h,i;k.innerHTML=l;j=k.children;if(j){m=j.length;for(h=0;h<m;h++){i=j[h];if(i.id&&i.id==="GrowlController"){return i.children;}}}return null;}});