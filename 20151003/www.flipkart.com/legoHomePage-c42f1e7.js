if(typeof(FKART)=="undefined"){FKART={}}FKART.AppOffer=new function(){var a=[],b=[];this.clearList=function(){a=[];b=[];fk_appoffer.updateTopBanner()};this.addAppOnly=function(c){if(a.indexOf(c)==-1){a.push(c);fk_appoffer.updateTopBanner()}};this.addOpenFsn=function(c){if(b.indexOf(c)==-1){b.push(c);fk_appoffer.updateTopBanner()}};this.updateTopBanner=function(){var e=$("#fk-header"),f=$(".fk-header-banner"),d=$(".apponly-text-some",f),g=$(".apponly-text-all",f),c=$(".apponly-text-default",f);if(a.length===0&&c.length===0){e.removeClass("banner-open");f.slideUp("slow")}else{if(!e.hasClass("banner-open")){e.addClass("banner-open");f.slideDown("slow")}if(a.length===0){d.hide();g.hide();c.show()}else{if(b.length===0){d.hide();g.show();c.hide()}else{d.show();g.hide();c.hide()}}}};this.updateUrl=function(){$(".fk-header-banner .app-link, .product-openx-ad .app-link, .facetList .app-link").data("url",window.location.pathname+window.location.search);$(".fk-header-banner .app-link, .product-openx-ad .app-link, .facetList .app-link").data("title",document.title);var c=$(".fk-header-banner .app-link");if((c.length===0||!c.data("query")||c.data("query").length===0)&&FKART.urlParser().get("sid")=="undefined"){c.hide()}else{c.show()}}};fk_appoffer=FKART.AppOffer;FKART.appOfferPopup=function(aJ){var W=$(aJ),w=$(".app-link",W),O=$(".app-offers-button",W),ao=$(".app-offers-container",W),av=$(".appOnlyDialog-popup-content",W),Y=$(".fk-question-mark",W),y,aH,aF,a3,ac,a5,aG,G,d,p,r,B,an,L,aT,au,aS,K,X,n,a,af,u,a1,c,D=false,aj,m,ap,aV=false,aR,aL,aA,a0,g,ax,Z,j,ah,S,k,e,U,aX=false,aZ,f,aP,ag,z,E,F,H,ak,aU,Q,ai,ab,aO,T,o,aI,a2,J="",am="",N=false,ar=false,I,az;if(av.length==0){av=$(".fk-mainfooter .appOnlyDialog-popup-content")}if(av.length==0){av=$(".appOnlyDialog-popup-content.forcedView")}function b(){O.on("click",function(){if(!N){aY("Opened");$(this).addClass("open");Y.text("X");setTimeout(function(){ao.slideDown(200);N=true},150)}else{aY("Closed");ao.slideUp(200,function(){O.removeClass("open");Y.text("?");N=false})}});w.on("click",function(a6){if(!w.hasClass("disabled")){t($(this));aY("Clicked");a4();a6.preventDefault()}})}function a4(){u=null;l();M();aQ();q();V();if(!FKART.login.isUserLoggedIn()){L.hide();aK()}else{if(aV==true){L.show();y.hide();T=setTimeout(function(){D=true;$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:aZ,lid:f,sid:aP,query:ag,offerid:U,title:z,subtitle:E,vertical:F,url:H,useDataUrl:aX},type:"POST",dataType:"json",success:function(a6){if(a6.deviceFound&&a6.notificationSent){aM()}else{aD()}},error:function(){aD()}})},7000)}else{aK();aq()}}}function aq(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:aZ,lid:f,sid:aP,query:ag,offerid:U,title:z,subtitle:E,vertical:F,url:H,useDataUrl:aX},type:"POST",dataType:"json"})}function aY(a7){var a6={};if(a7=="Clicked"){a6.products=s.products}var a8=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar11","eVar50","eVar55","eVar68","prop1","prop2","prop3","prop4","prop20","prop35");for(i in a8){if(typeof s[a8[i]]!="undefined"){a6[a8[i]]=s[a8[i]]}if((a8[i]=="eVar55"||a8[i]=="eVar11")&&ak){a6[a8[i]]=ak}if((a8[i]=="eVar68"||a8[i]=="prop20")&&aU){a6[a8[i]]=aU}}a6.prop21="OpenInApp_"+a7;FKART.omni.customEvent("App only offers",a6)}function aM(){q();L.hide();if(Q&&Q.length>0){var a6=$("<img>");a6.attr("src",Q);a5.append(a6)}else{a5.remove()}aH.show();aB();aY("PNSent")}function aD(){q();L.hide();aG.show();aY("PNFailed")}function V(){u=new FKART.ui.Dialog({showFooter:false,cssClass:"appOnlyDialog",body:av.html(),destroyOnHide:true,width:"620px"});c=u.getContainer();L=c.find(".loadingDiv");y=c.find(".smsDiv");aH=c.find(".successDiv");aF=y.find(".stitle");ac=y.find(".footerLoggedIn");a3=y.find(".footerNotLoggedIn");a5=aH.find(".phone-image span");aR=c.find(".smsForm");a1=c.find(".successPrefixDiv");aG=c.find(".errorDiv");aT=c.find(".send-sms-fake-link");au=c.find(".send-otp-fake-link");aS=c.find(".send-sms-link");K=c.find(".send-otp-link");X=c.find(".resend-sms-fake-link");n=c.find(".resend-otp-fake-link");a=c.find(".resend-sms-link");af=c.find(".resend-otp-link");o=c.find(".timer");aI=c.find(".timerResendSMS");a2=c.find(".timerResendOTPSMS");aj=c.find(".retry-notification");I=c.find(".otpForm");u.show();if(!FKART.login.isUserLoggedIn()){a3.show();ac.hide()}else{a3.hide();ac.show()}aE()}function aE(){c.on("beforeHide",function(a6){l();M();aQ();q()});aS.on("click",function(){aH.hide();a1.show();aG.hide();aF.remove();aK();aY("PNExpired")});K.on("click",function(){ae();aH.hide();a1.show();aG.hide();aF.remove();aK();aY("PNExpired")});aj.on("click",function(){u.hide();aV=true;a4();$status="PNTried";if(D){$status="PNReTried"}aY($status)})}function aw(){ah=j.val();$.ajax({url:"/lc/sendSMSForNumber",type:"POST",data:{pid:aZ,lid:f,sid:aP,query:ag,offerid:U,title:z,subtitle:E,vertical:F,url:H,phoneNumber:ah,useDataUrl:aX},dataType:"json",success:function(a6){if(a6.smsStatus){aN()}else{aC()}},error:function(){aC()}})}function x(a6){return a6}function al(){k=e.val();$.ajax({url:"/lc/verifyOtp",type:"POST",data:{user_id:ah,otp_key:J,otp:k},dataType:"html",success:function(a6){a6=JSON.parse(a6);if(a6.isOtpVerified=="1"){ar=true;FKART.utils.localStorage.setObject("verifiedPhoneNumbers",{phoneNumbers:az.phoneNumbers+S+"|"});aw()}else{aa()}},error:function(){aa()}})}function ae(){ah=j.val();$.ajax({url:"/lc/generateOtp",type:"POST",data:{userId:ah},dataType:"html",success:function(a6){a6=JSON.parse(a6);if(a6.error_code=="1004"){A()}else{J=a6.otp_key;at()}},error:function(){aa()}})}function R(){ah=j.val();$.ajax({url:"/lc/getVerifiedPhoneNumber",type:"POST",data:{phoneNumber:ah},dataType:"html",success:function(a6){a6=JSON.parse(a6);if(a6.verifiedPhoneNumber){aw();aY("SMSTried");event.preventDefault()}else{S=x(ah);if(az.phoneNumbers.indexOf(S)<=-1){if(a0.val()=="false"){ae()}else{aw();aY("SMSTried")}}else{aw();aY("SMSTried")}event.preventDefault()}},error:function(){C()}})}function aN(){M();aQ();aF.hide();g.hide();ax.hide();aR.hide();I.hide();Z.html(ah);G.show();d.hide();X.show();a.hide();h();aY("SMSSent")}function aC(){M();aQ();d.hide();aF.hide();g.hide();ax.hide();aR.hide();aG.hide();Z.html(ah);an.show();aY("SMSFailed")}function aa(){aQ();M();aF.hide();g.hide();ax.hide();aR.hide();aG.hide();Z.html(ah);d.hide();p.show();aY("OTPFailed")}function C(){M();aQ();aF.hide();g.hide();ax.hide();aR.hide();aG.hide();d.hide();p.hide();B.show();aY("SMSFailed")}function at(){aQ();M();aF.hide();g.hide();ax.show();I.show();aR.hide();Z.html(ah);d.show();n.show();af.hide();ad();aY("OTPSent")}function A(){r.show();aF.hide();g.hide();ax.hide();I.hide();aR.hide();Z.html(ah);d.hide();n.hide();af.hide();aY("OTPFailed")}function aK(){j=aR.find(".phoneNumber");e=I.find(".otp-field");ah=FKART.login.userPhoneNumber;j.val(ah);aA=aR.find("input[type=button]");aL=I.find("input[type=button]");a0=y.find("#marketingSMS");g=y.find(".infoDiv");ax=y.find(".otpTitle");aF=y.find(".stitle");G=y.find(".smsSuccessDiv");d=y.find(".otpSuccessDiv");p=y.find(".otpErrorDiv");r=y.find(".otpErrorMsgDiv");B=y.find(".otpSendErrorDiv");an=y.find(".smsErrorDiv");m=y.find(".retry-sms");ap=y.find(".retry-otp");Z=y.find(".phone_number");y.show();I.hide();ax.hide();u.reposition();P()}function P(){aA.on("click",function(a6){ah=j.val();if(!(/^[789]\d{9}$/.test(ah))){j.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}if(FKART.login.isUserLoggedIn()){R();a6.preventDefault()}else{S=x(ah);if(az.phoneNumbers.indexOf(S)<=-1){if(a0.val()=="false"){ae();aY("OTPTried")}else{aw();aY("SMSTried")}}else{aw();aY("SMSTried")}a6.preventDefault()}});aL.on("click",function(a6){k=e.val();if(!(/^[0-9]{4,6}$/.test(k))){e.addClass("error").val("").attr("placeholder","Invalid OTP").focus();return}else{al();aF.hide();G.hide();g.hide();an.hide();d.hide();ax.hide();I.hide();aY("SMSTried");a6.preventDefault()}});m.on("click",function(){M();aQ();aI.html("45");a2.html("60");aF.hide();G.hide();g.hide();aR.hide();an.hide();aw();aY("SMSReTried")});ap.on("click",function(){aQ();M();ae();aI.html("45");a2.html("60");ax.show();G.hide();I.show();an.hide();aY("SMSReTried")})}function l(){clearInterval(ai);ai=null}function M(){clearInterval(ab);ab=null}function aQ(){clearInterval(aO);aO=null}function q(){clearInterval(T);T=null}function aB(){ai=setInterval(function(){var a6=parseInt(o.html());if(a6==0){l();aT.hide();aS.show()}o.html(a6-1)},1000)}function h(){ab=setInterval(function(){var a6=parseInt(aI.html());if(a6==0){M();aQ();X.hide();a.show()}aI.html(a6-1)},1000)}function ad(){aO=setInterval(function(){var a6=parseInt(a2.html());if(a6==0){aQ();M();n.hide();af.show()}a2.html(a6-1)},1000)}function v(a7,a6){if(a7.indexOf("?")!==-1){var ba=a7.split("?")[1];var a9=ba.split("&");for(var a8=0;a8<a9.length;a8++){var bb=a9[a8].split("=");if(bb[0]==a6){return bb[1]}}}}function aW(){var a6=FKART.urlParser().get("sid");if(a6!="undefined"){return a6}}function t(a6){Q=a6.data("image");if(a6.data("pid")){aZ=a6.data("pid").toString();F=a6.data("vertical");if(a6.data("lid")){f=a6.data("lid").toString()}U=a6.data("offerid")}else{ag=a6.data("query");aP=aW();if(aP){F=("BROWSE_"+aP).toUpperCase()}else{if(a6.data("vertical")){F=a6.data("vertical")}else{F="BROWSE_SEARCH"}}if(a6.data("url")){aZ=v(a6.data("url"),"pid");aP=v(a6.data("url"),"sid");U=v(a6.data("url"),"offer");if(v(a6.data("url"),"p[]")||a6.data("url").indexOf("/~")){aX=true}}z=a6.data("title");E=a6.data("subtitle");H=a6.data("url");if(a6.attr("href")){ak=v(a6.attr("href"),"icmpid");aU=v(a6.attr("href"),"otracker")}}aV=false;D=false;az=FKART.utils.localStorage.getObject("verifiedPhoneNumbers")||{phoneNumbers:"|"}}function ay(){b()}ay()};register_controller("AppOffersCtrl",function(a){FKART.appOfferPopup(a)});FKART.showShutDownPopup=function(c){var b=(new Date()).getTime(),e=FKART.utils.localStorage.getObject("sdPopDetails")||{};function d(g){var f=new FKART.ui.Dialog({header:"Flipkart System Message",showFooter:false,body:c,cssClass:"desk-shut"});FKART.utils.localStorage.setObject("sdPopDetails",{timeStamp:g});f.show()}if(!jQuery.isEmptyObject(e)){var a=e.timeStamp+(24*60*60*1000);if(a<b){d(b)}}else{d(b)}};register_controller("ShutDownPopCtrl",function(a){FKART.showShutDownPopup(a)});FKART.appDownloadPopup=function(P){var u=$(P),r=$(".app-download",u),G,V,A,W,w,L,ac,ae,b,B,j,F,I,k,U,z,K,y,J,l,M,E=false,n="title",Y="subtitle",ad,X,v,a,N,D,m,d=false;function q(){r.click(function(af){if(!r.hasClass("disabled")){g("Clicked");R($(this));t();af.preventDefault()}})}function t(){ae=null;Z();f()}function g(ag){var af={};if(ag=="Clicked"){af.products=s.products}af.prop21="OpenInApp_"+ag;FKART.omni.customEvent("App only offers",af)}function H(){h();if(ad&&ad.length>0){var af=$("<img>");af.attr("src",ad);V.append(af)}else{V.remove()}C();g("PNSent")}function Q(){h();f();g("PNFailed")}function Z(){ae=new FKART.ui.Dialog({showFooter:false,cssClass:"appDownloadDialog",body:$(".appDownloadDialog-popup-content").html(),destroyOnHide:true,width:"620px"});b=ae.getContainer();w=b.find(".headerDiv");G=b.find(".smsDiv");F=b.find(".smsForm");L=b.find(".send-sms-fake-link");ac=b.find(".send-sms-link");m=b.find(".timer");B=b.find(".retry-notification");ae.show();e()}function e(){b.on("beforeHide",function(af){ab();h();E=false});ac.click(function(){f();g("PNExpired")});B.click(function(){ae.hide();t();g("PNReTried")})}function T(){l=J.val();if(!(/^[789]\d{9}$/.test(l))){J.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendAppDownloadSMS",type:"POST",data:{title:n,subtitle:Y,phoneNumber:l,captchaText:z.val(),captchaId:K.attr("id")},dataType:"json",success:function(af){if(af.captchaStatus){if(af.smsStatus){S()}else{x()}}else{p()}},error:function(){x()}})}}function p(){o();z.addClass("error").val("").attr("placeholder","Invalid Captcha").focus()}function S(){k.hide();F.hide();y.html(l);A.show();g("SMSSent")}function x(){k.hide();F.hide();y.html(l);W.show();g("SMSFailed")}function f(){J=F.find(".phoneNumber");l=FKART.login.userPhoneNumber;J.val(l);I=F.find("input[type=submit]");k=G.find(".infoDiv");A=G.find(".smsSuccessDiv");W=G.find(".smsErrorDiv");j=G.find(".retry-sms");U=F.find(".captchaDiv");z=F.find(".captchaText");M=F.find(".refreshCaptcha");y=G.find(".phone_number");if(/^\d{10}$/.test(l)){E=true;o()}G.show();ae.reposition();O()}function O(){M.click(function(){o();z.val("").focus()});F.submit(function(af){T();g("SMSTried");af.preventDefault()});j.click(function(){k.show();F.show();A.hide();W.hide();z.removeClass("error").val("").attr("placeholder","Captcha text").focus();o();g("SMSReTried")});J.focus(function(){g("PhoneNumberFocused");if(!E){E=true;o()}})}function o(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(af){if(af.success){K=U.find("img");K.attr("src","data:image/png;base64,"+af.captchaBytes);K.attr("id",af.id);U.show();z.show();K.load(function(){if(this.complete){ae.reposition()}})}else{U.find("img").attr("alt","Captcha failed to load")}},error:function(){U.find("img").attr("alt","Captcha failed to load")}})}function ab(){clearInterval(N);N=null}function h(){clearInterval(D);D=null}function C(){N=setInterval(function(){var af=parseInt(m.html());if(af==0){ab();L.hide();ac.show()}m.html(af-1)},1000)}function c(ag,af){var aj=ag.split("?")[1];var ai=aj.split("&");for(var ah=0;ah<ai.length;ah++){var ak=ai[ah].split("=");if(ak[0]==af){return ak[1]}}}function R(){$ele=window.location.href}function aa(){q()}aa()};register_controller("AppDownloadCtrl",function(a){FKART.appDownloadPopup(a)});register_controller("AppDownloadInterstitialCtrl",function(aG){var U=$(aG),x=$(".app-link-interstitial",U),N=$(".app-offers-button",U),al=$(".app-offers-container",U),ar=$(".appDownloadInterstitial-popup-content",U),W=$(".fk-question-mark",U),z,aE,aC,a0,aa,a2,aD,F,d,p,r,B,ak,K,aS,aq,aR,J,V,n,a,ad,u,aY,c,D=false,ah,m,am,aT=false,aQ,aI,ax,aM,g,au,X,j,af,Q,k,e,S,aV=false,aX,f,aN,ae,aO="title",w="subtitle",E,G,ag,Z,aL,R,o,aF,aZ,M=false,H="",aj="",M=false,ao=false,I,aw;if(ar.length==0){ar=$(".fk-mainfooter .appOnlyDialog-popup-content")}if(ar.length==0){ar=$(".appOnlyDialog-popup-content.forcedView")}function b(){N.on("click",function(){if(!M){aW("Opened");$(this).addClass("open");W.text("X");setTimeout(function(){al.slideDown(200);M=true},150)}else{aW("Closed");al.slideUp(200,function(){N.removeClass("open");W.text("?");M=false})}});x.on("click",function(a3){if(!x.hasClass("disabled")){aW("Clicked");t($(this));a1();a3.preventDefault()}});EventBus.subscribe("appDownloadInterstitialpopup",function(){t($(this));a1();FKART.utils.localStorage.setObject("sAppDownloadInterstitial",{sPopup:false})})}function a1(){u=null;T();aH()}function an(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:aX,lid:f,sid:aN,query:ae,offerid:S,title:title,subtitle:subtitle,vertical:E,url:G,useDataUrl:aV},type:"POST",dataType:"json"})}function aW(a4){var a3={};if(a4=="Clicked"){a3.products=s.products}var a5=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar50","prop1","prop2","prop3","prop4","prop35");for(i in a5){if(typeof s[a5[i]]!="undefined"){a3[a5[i]]=s[a5[i]]}}a3.prop21="OpenInApp_"+a4;FKART.omni.customEvent("App only offers",a3)}function aJ(){q();K.hide();if(imageSrc&&imageSrc.length>0){var a3=$("<img>");a3.attr("src",imageSrc);a2.append(a3)}else{a2.remove()}aE.show();ay();aW("PNSent")}function aA(){q();K.hide();aD.show();aW("PNFailed")}function T(){u=new FKART.ui.Dialog({showFooter:false,cssClass:"appDownloadInterstitialDialog",body:ar.html(),destroyOnHide:true,width:"730px"});c=u.getContainer();K=c.find(".loadingDiv");z=c.find(".smsDiv");aE=c.find(".successDiv");aC=z.find(".stitle");aa=z.find(".footerLoggedIn");a0=z.find(".footerNotLoggedIn");a2=aE.find(".phone-image span");aQ=c.find(".smsForm");aY=c.find(".successPrefixDiv");aD=c.find(".errorDiv");aS=c.find(".send-sms-fake-link");aR=c.find(".send-sms-link");J=c.find(".send-otp-link");V=c.find(".resend-sms-fake-link");n=c.find(".resend-otp-fake-link");a=c.find(".resend-sms-link");ad=c.find(".resend-otp-link");o=c.find(".timer");aF=c.find(".timerResendSMS");aZ=c.find(".timerResendOTPSMS");ah=c.find(".retry-notification");I=c.find(".otpForm");u.show();if(!FKART.login.isUserLoggedIn()){a0.show();aa.hide()}else{a0.hide();aa.show()}aB()}function aB(){c.on("beforeHide",function(a3){l();L();q()});aR.on("click",function(){aE.hide();aY.show();aD.hide();aC.remove();aH();aW("PNExpired")});J.on("click",function(){ac();aE.hide();aY.show();aD.hide();aC.remove();aH();aW("PNExpired")});ah.on("click",function(){u.hide();a1();$status="PNTried";if(D){$status="PNReTried"}aW($status)})}function at(){af=j.val();$.ajax({url:"/lc/sendAppDownloadSMS",type:"POST",data:{title:aO,subtitle:w,phoneNumber:af},dataType:"json",success:function(a3){if(a3.smsStatus){aK()}else{az()}},error:function(){az()}})}function y(a3){return a3}function ai(){k=e.val();$.ajax({url:"/lc/verifyOtp",type:"POST",data:{user_id:af,otp_key:H,otp:k},dataType:"html",success:function(a3){a3=JSON.parse(a3);if(a3.isOtpVerified=="1"){ao=true;FKART.utils.localStorage.setObject("verifiedPhoneNumbers",{phoneNumbers:aw.phoneNumbers+Q+"|"});at()}else{Y()}},error:function(){Y()}})}function ac(){af=j.val();$.ajax({url:"/lc/generateOtp",type:"POST",data:{userId:af},dataType:"html",success:function(a3){a3=JSON.parse(a3);if(a3.error_code=="1004"){A()}else{H=a3.otp_key;ap()}},error:function(){Y()}})}function P(){af=j.val();$.ajax({url:"/lc/getVerifiedPhoneNumber",type:"POST",data:{phoneNumber:af},dataType:"html",success:function(a3){a3=JSON.parse(a3);if(a3.verifiedPhoneNumber){at();aW("SMSTried");event.preventDefault()}else{Q=y(af);if(aw.phoneNumbers.indexOf(Q)<=-1){if(aM.val()=="false"){ac();aW("OTPTried")}else{at();aW("SMSTried")}}else{at();aW("SMSTried")}event.preventDefault()}},error:function(){C()}})}function aK(){L();aP();aC.hide();g.hide();au.hide();aQ.hide();I.hide();X.html(af);F.show();d.hide();V.show();a.hide();h();aW("SMSSent")}function az(){L();aP();d.hide();aC.hide();g.hide();au.hide();aQ.hide();aD.hide();X.html(af);ak.show();aW("SMSFailed")}function Y(){aP();L();aC.hide();g.hide();au.hide();aQ.hide();aD.hide();X.html(af);d.hide();p.show();aW("OTPFailed")}function C(){L();aP();aC.hide();g.hide();au.hide();aQ.hide();aD.hide();d.hide();p.hide();B.show();aW("SMSFailed")}function ap(){aP();L();aC.hide();g.hide();au.show();I.show();aQ.hide();X.html(af);d.show();n.show();ad.hide();ab();aW("OTPSent")}function A(){r.show();aC.hide();g.hide();au.hide();I.hide();aQ.hide();X.html(af);d.hide();n.hide();ad.hide();aW("OTPFailed")}function aH(){j=aQ.find(".phoneNumber");e=I.find(".otp-field");af=FKART.login.userPhoneNumber;j.val(af);ax=aQ.find("input[type=button]");aI=I.find("input[type=button]");aM=z.find("#marketingSMSAppDownload");g=z.find(".infoDiv");au=z.find(".otpTitle");aC=z.find(".stitle");F=z.find(".smsSuccessDiv");d=z.find(".otpSuccessDiv");p=z.find(".otpErrorDiv");r=z.find(".otpErrorMsgDiv");B=z.find(".otpSendErrorDiv");ak=z.find(".smsErrorDiv");m=z.find(".retry-sms");am=z.find(".retry-otp");X=z.find(".phone_number");z.show();I.hide();au.hide();u.reposition();O()}function O(){ax.on("click",function(a3){af=j.val();if(!(/^[789]\d{9}$/.test(af))){j.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}if(FKART.login.isUserLoggedIn()){P();a3.preventDefault()}else{Q=y(af);if(aw.phoneNumbers.indexOf(Q)<=-1){if(aM.val()=="false"){ac();aW("OTPTried")}else{at();aW("SMSTried")}}else{at();aW("SMSTried")}a3.preventDefault()}});aI.on("click",function(a3){k=e.val();if(!(/^[0-9]{4,6}$/.test(k))){e.addClass("error").val("").attr("placeholder","Invalid OTP").focus();return}else{ai();aC.hide();F.hide();g.hide();ak.hide();d.hide();au.hide();I.hide();aW("SMSTried");a3.preventDefault()}});m.on("click",function(){L();aP();aF.html("45");aZ.html("60");aC.hide();F.hide();g.hide();aQ.hide();ak.hide();at();aW("SMSReTried")});am.on("click",function(){aP();L();ac();aF.html("45");aZ.html("60");au.show();F.hide();I.show();ak.hide();aW("SMSReTried")})}function l(){clearInterval(ag);ag=null}function L(){clearInterval(Z);Z=null}function aP(){clearInterval(aL);aL=null}function q(){clearInterval(R);R=null}function ay(){ag=setInterval(function(){var a3=parseInt(o.html());if(a3==0){l();aS.hide();aR.show()}o.html(a3-1)},1000)}function h(){Z=setInterval(function(){var a3=parseInt(aF.html());if(a3==0){L();V.hide();a.show()}aF.html(a3-1)},1000)}function ab(){aL=setInterval(function(){var a3=parseInt(aZ.html());if(a3==0){aP();L();n.hide();ad.show()}aZ.html(a3-1)},1000)}function v(a4,a3){var a7=a4.split("?")[1];var a6=a7.split("&");for(var a5=0;a5<a6.length;a5++){var a8=a6[a5].split("=");if(a8[0]==a3){return a8[1]}}}function aU(){var a3=FKART.urlParser().get("sid");if(a3!="undefined"){return a3}}function t(){$ele=window.location.href;aT=false;D=false;aw=FKART.utils.localStorage.getObject("verifiedPhoneNumbers")||{phoneNumbers:"|"}}function av(){b()}av()});register_controller("SocialCollabCtrl",function(S){var u=$(S),p=$(".app-ping",u),I=$(".app-offers-button",u),J=$(".app-offers-container",u),Q=$(".socialCollabDialog-popup-content",u),ac=$(".fk-question-mark",u),G,Y,A,Z,w,N,ag,ai,b,B,j,F,K,k,X,z,M,y,L,l,P,E=false,n="title",ab="subtitle",ah,aa,v,a,O,D,m,d=false;function r(){I.click(function(){if(!d){g("Opened");$(this).addClass("open");ac.text("X");setTimeout(function(){J.slideDown(200);d=true},150)}else{g("Closed");J.slideUp(200,function(){I.removeClass("open");ac.text("?");d=false})}});EventBus.subscribe("showSocialCollabPopup",function(){$ele=window.location.href;U($ele);t()});p.on("click",function(aj){if(!p.hasClass("disabled")){g("Clicked");$ele=$(this).data("url");U($ele);t();aj.preventDefault()}})}function t(){ai=null;ad();f()}function g(ak){var aj={};if(ak=="Clicked"){aj.products=s.products}aj.prop21="OpenInApp_"+ak;FKART.omni.customEvent("App only offers",aj)}function H(){h();if(ah&&ah.length>0){var aj=$("<img>");aj.attr("src",ah);Y.append(aj)}else{Y.remove()}C();g("PNSent")}function T(){h();f();g("PNFailed")}function ad(){ai=new FKART.ui.Dialog({showFooter:false,cssClass:"socialCollabDialog",body:Q.html(),destroyOnHide:true,width:"650px"});b=ai.getContainer();w=b.find(".headerDiv");G=b.find(".smsDiv");F=b.find(".smsForm");N=b.find(".send-sms-fake-link");ag=b.find(".send-sms-link");m=b.find(".timer");B=b.find(".retry-notification");ai.show();e()}function e(){b.on("beforeHide",function(aj){af();h();E=false});ag.click(function(){f();g("PNExpired")});B.click(function(){ai.hide();t();g("PNReTried")})}function W(){l=L.val();if(!(/^[789]\d{9}$/.test(l))){L.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendSocialCollabSMS",type:"POST",data:{title:n,subtitle:ab,phoneNumber:l,cmpId:aa,token:v,vid:a,captchaText:z.val(),captchaId:M.attr("id")},dataType:"json",success:function(aj){if(aj.captchaStatus){if(aj.smsStatus){V()}else{x()}}else{q()}},error:function(){x()}})}}function q(){o();z.addClass("error").val("").attr("placeholder","Invalid Captcha").focus()}function V(){k.hide();F.hide();y.html(l);A.show();g("SMSSent")}function x(){k.hide();F.hide();y.html(l);Z.show();g("SMSFailed")}function f(){L=F.find(".phoneNumber");l=FKART.login.userPhoneNumber;L.val(l);K=F.find("input[type=submit]");k=G.find(".infoDiv");A=G.find(".smsSuccessDiv");Z=G.find(".smsErrorDiv");j=G.find(".retry-sms");X=F.find(".captchaDiv");z=F.find(".captchaText");P=F.find(".refreshCaptcha");y=G.find(".phone_number");if(/^\d{10}$/.test(l)){E=true;o()}G.show();ai.reposition();R()}function R(){P.click(function(){o();z.val("").focus()});F.submit(function(aj){W();g("SMSTried");aj.preventDefault()});j.click(function(){k.show();F.show();Z.hide();z.removeClass("error").val("").attr("placeholder","Captcha text").focus();o();g("SMSReTried")});L.focus(function(){g("PhoneNumberFocused");if(!E){E=true;o()}})}function o(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(aj){if(aj.success){M=X.find("img");M.attr("src","data:image/png;base64,"+aj.captchaBytes);M.attr("id",aj.id);X.show();z.show();M.load(function(){if(this.complete){ai.reposition()}})}else{X.find("img").attr("alt","Captcha failed to load")}},error:function(){X.find("img").attr("alt","Captcha failed to load")}})}function af(){clearInterval(O);O=null}function h(){clearInterval(D);D=null}function C(){O=setInterval(function(){var aj=parseInt(m.html());if(aj==0){af();N.hide();ag.show()}m.html(aj-1)},1000)}function c(ak,aj){var an=ak.split("?")[1];var am=an.split("&");for(var al=0;al<am.length;al++){var ao=am[al].split("=");if(ao[0]==aj){return ao[1]}}}function U(aj){aa=c(aj,"cmpId");v=c(aj,"token");a=c(aj,"vid")}function ae(){r()}ae()});