"function" != typeof String.prototype.trim && (String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") }); var iPerceptions = iPerceptions || {}; iPerceptions.ipEngine = { url: "//ips-invite.iperceptions.com/wUniversal.aspx?sdfc=095904e8-{0}-fb330c52-9ae4-4a44-a31d-b80f2c680ca0&lID={1}&source=91787&visitorID=[ipe_v]&sessionID=[ipe_s]&device=[device]", device: "", culture: "", langId: 0, pageViewed: 0, launch: function (ipDef, dv, ct, visit, sId, key) { "use strict"; var wrapper = iPerceptions.Wrapper, i, j, invites, invite, trigger, rate, expires, visitorId = visit.visitors[visit.visitors.length - 1].id; try { this.device = dv.toLowerCase(), this.culture = ct; var validDomains = !1, domains = JSON.parse(ipDef.Domains), theDomain = location.host, noWildCards; for (i = 0; i < domains.length; i += 1) noWildCards = domains[i].substring(1), theDomain === domains[i] ? validDomains = !0 : "*." === domains[i].substring(0, 2) && -1 !== theDomain.indexOf(noWildCards, theDomain.length - noWildCards.length) && (validDomains = !0); if (!validDomains) return; for (this.pageViewed = wrapper.getPageViewed(), invites = ipDef.Invites, i = 0; i < invites.length; i += 1) invite = invites[i], invite.CustomScript && invite.CustomScript.length > 0 && eval(invite.CustomScript), invite.ProjectInviteTriggers = this.shuffleObject(invite.ProjectInviteTriggers), -10 === invite.TemplateId && this.evaluateInvite(invite) && wrapper.injectJs("Iperceptions_" + invite.ProjectId.toString(), invite.CommentCardUrl, null, function () { var e = { langID: langId }; ipeCC[0].ipeIcon(e) }); invites = this.reinvite(invites, visit.history), invites = wrapper.getIframeSessionStorage("ipe." + wrapper.companyId + ".winning", invites) } catch (e) { } }, displayInvite: function (e, t, i, r, n, o) { var a, s, c, p, g, u = iPerceptions.Wrapper, l = n.visitors[n.visitors.length - 1].id, v = ""; for (e = this.shuffleObject(e), a = 0; a < e.length; a += 1) for (c = e[a], s = 0; s < c.ProjectInviteTriggers.length; s += 1) p = c.ProjectInviteTriggers[s], "tablet" === i || "mobile" === i ? v = this.getIpeStorage("IPE_WM_" + c.ProjectId, c, p, l, o, i, n, g) : this.injectInvite(v, c, p, l, o, i, n, g); g = new Date, g.setFullYear(g.getFullYear() + 1), u.updateVisit(n, g) }, injectInvite: function (e, t, i, r, n, o, a, s) { var c = iPerceptions.Wrapper, p = c.getCookie("IPE_DISP_" + t.ProjectId), g = c.getCookie("IPE_M_" + t.ProjectId); return "1" === p && "1" === g && parseInt(e) === i.Id || this.evaluateTrigger(i) === !0 ? ("" === p && "" === g && c.setIframeSessionStorage("IPE_WM_" + t.ProjectId, i.Id), void c.injectJs("Iperceptions_invite", this.url.replace("{0}", t.ProjectId).replace("{1}", i.LanguageId).replace("[ipe_v]", r).replace("[ipe_s]", n).replace("[device]", o), null, function () { ("1" !== p || "1" !== g) && (s = iPerceptions.ipEngine.setreinvite(t, a.history), iPerceptions.Wrapper.updateVisit(a, s)) })) : void 0 }, injectMobileInvite: function (e, t, i, r, n, o, a, s) { var c = iPerceptions.Wrapper, p = c.getCookie("IPE_DISP_" + t.ProjectId), g = c.getCookie("IPE_M_" + t.ProjectId); return "1" === p && "1" === g && parseInt(e) === i.Id ? void c.injectJs("Iperceptions_invite", this.url.replace("{0}", t.ProjectId).replace("{1}", i.LanguageId).replace("[ipe_v]", r).replace("[ipe_s]", n).replace("[device]", o), null, function () { ("1" !== p || "1" !== g) && (s = iPerceptions.ipEngine.setreinvite(t, a.history), iPerceptions.Wrapper.updateVisit(a, s)) }) : void 0 }, reinvite: function (e, t) { var i, r, n, o = [], a = [], s = new Date; for (i = 0; i < e.length; i += 1) { var c = iPerceptions.Wrapper.getCookie("IPE_DISP_" + e[i].ProjectId), p = iPerceptions.Wrapper.getCookie("IPE_M_" + e[i].ProjectId); if ("1" === c && "1" === p) return a.push(e[i]), a; -10 != e[i].TemplateId && o.push(e[i]) } for (s.setYear(s.getYear() - 1), i = 0; i < t.length; i += 1) { var g = null; for (n = new Date(t[i].date), s = n > s ? n : s, r = 0; r < o.length && null === g; r += 1) o[r].ProjectId === t[i].id && (g = r); null !== g && void 0 !== g && (n.setDate(n.getDate() + e[g].ReInviteProject), n > new Date && o.splice(g, 1)) } for (i = 0; i < o.length; i += 1) n = new Date(this.getString(s)), n.setDate(n.getDate() + o[i].ReInviteOtherProject), (n <= new Date || "1" === c && "1" === p) && a.push(o[i]); return a }, setreinvite: function (e, t) { var i, r, n, o = new Date, a = null; for (n = o, i = this.getString(o), r = 0; r < t.length; r += 1) t[r].id === e.ProjectId && (a = r), o = new Date(t[r].date), o.setDate(o.getDate() + t[r].ReInviteProject), n = o > n ? o : n; return null !== a ? t[a].date = i : t.push({ id: e.ProjectId, date: i, host: location.host }), n }, evaluateRate: function (e, t, i, r, n, o, a, s) { var c = iPerceptions.Wrapper, p = []; t = (void 0 != t || null != t) && t.length > 0 ? JSON.parse(t) : [], t instanceof Array || (t = []); for (var g = [], u = 0; u < e.length; u++) { var l = e[u], v = []; for (j = 0; j < l.ProjectInviteTriggers.length; j += 1) if (trigger = l.ProjectInviteTriggers[j], 2 !== trigger.InviteTypeId) if (-1 === t.indexOf(trigger.Id)) { if (0 === t.length) { rate = "tablet" === this.device ? trigger.TabletRate : "mobile" === this.device ? trigger.MobileRate : trigger.DesktopRate; var d = 100 * Math.random(); d < rate && (g.push(trigger.Id), v.push(trigger)) } } else v.push(trigger); v.length > 0 && (l.ProjectInviteTriggers = v, p.push(l)) } 0 == g.length && (g = t), c.setInvites(JSON.stringify(g)), this.displayInvite(p, i, r, n, o, a, s) }, getString: function (e) { return e.getFullYear() + "/" + (e.getMonth() + 1) + "/" + e.getDate() }, shuffleObject: function (e) { var t, i, r; for (r = e.length - 1; r >= 0; r -= 1) Math.random() < .5 && (t = Math.floor(Math.random() * r), i = e[r], e[r] = e[t], e[t] = i); return e }, evaluateInvite: function (e) { var t; for (t = 0; t < e.ProjectInviteTriggers.length; t += 1) if (this.evaluateTrigger(e.ProjectInviteTriggers[t]) === !0) return langId = e.ProjectInviteTriggers[t].LanguageId, !0; return !1 }, evaluateTrigger: function (e) { var t, i = e.ProjectInviteTriggerConditions[0], r = this.evaluateCondition(i); for (t = 1; t < e.ProjectInviteTriggerConditions.length; t += 1) i = e.ProjectInviteTriggerConditions[t], r = i.IsAnd === !0 ? r && this.evaluateCondition(i) : r || this.evaluateCondition(i); return r }, evaluateCondition: function (e) { try { switch (e.ConditionTypeId) { case 1: return this.evaluateOperation(e.ConditionOperationId, this.culture.toString(), e.Value); case 2: var t = location.href.toLowerCase(); return (3 === e.ConditionOperationId || 6 === e.ConditionOperationId) && 0 === e.Value.toLowerCase().indexOf("www") && (t = location.href.replace(/^https?:\/\//, "")), this.evaluateOperation(e.ConditionOperationId, t, e.Value.toLowerCase()); case 3: return this.evaluateOperation(e.ConditionOperationId, this.getQueryParam(e.Parameter), e.Value); case 4: return this.evaluateOperation(e.ConditionOperationId, iPerceptions.Wrapper.getCookie(e.Parameter), e.Value); case 5: return this.evaluateTrigger(e.CompanyInviteRule); case 6: return this.evaluateOperation(e.ConditionOperationId, this.pageViewed.toString(), e.Value); case 7: return this.evaluateOperation(e.ConditionOperationId, this.device.toLowerCase(), e.Value.toLowerCase()); case 8: return this.evaluateCustomCondition(e.Value) } } catch (i) { } }, evaluateOperation: function (e, t, i) { if (e > 0 && 11 > e && void 0 === t) return !1; t = t.trim(), i = i.trim(); try { switch (e) { case 1: return t === i; case 2: return t !== i; case 3: return 0 === t.indexOf(i.toString()); case 4: return -1 !== t.indexOf(i.toString()); case 5: return -1 === t.indexOf(i.toString()); case 6: return t.toString() === i.toString(); case 7: return i.length > 0 && t.substring(t.length - i.length, t.length) === i; case 8: return parseInt(t) < parseInt(i); case 9: return parseInt(t) > parseInt(i); case 10: return "" !== t; case 11: return "" === t; case 12: return this.getDevice(parseInt(i)); case 13: return !this.getDevice(parseInt(i)); case 14: return "" === t; case 15: return "" !== t } } catch (r) { } }, evaluateCustomCondition: function (e) { if (void 0 === e && 0 == e.length) return !1; try { return new Function(e)() } catch (t) { } return !1 }, getQueryParam: function (e) { var t, i, r, n = location.search.substring(1).split("&"); for (r = 0; r < n.length; r += 1) i = n[r].split("="), i[0] === e && (void 0 === t ? t = i[1] : "string" == typeof t ? t = [t, i[1]] : t.push(i[1])); return t instanceof Array ? t.join() : t }, getDevice: function (e) { return 1 === e && "desktop" === this.device || 3 === e && "tablet" === this.device || 2 === e && "mobile" === this.device }, toJson: function () { var e, t = {}; for (e in this) this.hasOwnProperty(e) && (t[e] = "function" == typeof this[e] ? this[e].toString() : this[e]); return JSON.stringify(t) }, getIpeStorage: function (e, t, i, r, n, o, a, s) { var c = iPerceptions.Wrapper, p = document.getElementById(c.frameId).contentWindow; p.postMessage(JSON.stringify({ key: e, method: "getsessionMob" }), "*"), c.addEvent("message", function (e) { if (e.origin.indexOf(iPerceptions.Wrapper.iFrameUrl) >= 0) { var p = JSON.parse(e.data); "universalgetsessionMob" == p.source && (sw = p.value, null === sw && null === document.getElementById("Iperceptions_invite") && (c.setIframeSessionStorage("IPE_WM_" + t.ProjectId, i.Id), iPerceptions.ipEngine.injectInvite(sw, t, i, r, n, o, a, s)), null != sw && parseInt(sw) === i.Id && null === document.getElementById("Iperceptions_invite") && iPerceptions.ipEngine.injectMobileInvite(sw, t, i, r, n, o, a, s)) } }, !1) } };