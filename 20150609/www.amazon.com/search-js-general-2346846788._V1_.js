(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery","search-general-globals-factory",function($){var jsDepMgr=amzn.sx.utils.jsDepMgr;
var jsDebugre=/([?&])(jsDebug=)([^&]*)/;
function getParamValue(re,str){if(!re||!str){return undefined;
}var m=str.match(re);
return(m&&m.length>=4)?m[3]:undefined;
}var jsDebugValue=getParamValue(jsDebugre,location.search);
var jsDebugFlagEnabled=("1"===jsDebugValue||"true"===jsDebugValue);
var globalsFactory={registerToWindow:function(obj){$.each(obj,function(key,value){if(typeof value=="function"){if(jsDebugFlagEnabled&&window.console&&window.console.error){window[key]=function(){console.error("you used a global function named ",key);
value.apply(this,arguments);
};
}else{window[key]=value;
}}});
}};
jsDepMgr.register("search-general-globals-factory",function(){return globalsFactory;
});
});
}());
amzn.sx.utils.jsDepMgr.when("jQuery","search-page-utilities-setup",function($){var SearchPageUtilsDef=function(){var self=this;
this.jqEscape=function(myid){return"#"+myid.replace(/:/g,"\\:").replace(/\./g,"\\.");
};
var events={};
this.resetEventsLog=function(){events={};
};
this.triggerATFEvent=function(rhsWeblab){var center;
if(rhsWeblab){center=$("#centerMinus");
}else{center=$("#center");
}if(center.is(":visible")){if(!events["spATFEvent"]){self.triggerEvent("spATFEvent");
}}};
this.afterEvent=function(eventType,handler){var origHandler=handler;
handler=function(){try{origHandler.apply(this,arguments);
}catch(e){if(window.ueLogError){window.ueLogError(e);
}}};
if(eventType&&handler&&events[eventType]){handler.call($(document));
}$(document).bind(eventType,handler);
};
this.triggerEvent=function(eventType){if(eventType){events[eventType]=1;
}try{$(document).trigger(eventType);
}catch(e){if(window.ueLogError){window.ueLogError(e);
}}};
this.clearEvent=function(eventType,handler){if(!handler&&eventType){events[eventType]=0;
}$(document).unbind(eventType,handler);
};
};
var searchPageUtilities=new SearchPageUtilsDef();
window.SPUtils=searchPageUtilities;
amzn.sx.utils.jsDepMgr.register("search-page-utilities",function(){return searchPageUtilities;
});
});
"use strict";
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery search-page-access","search-components",function(jQuery,searchPageAccess){var $=jQuery,searchComponents={};
var processFlyout=function(renderOptions){jQuery(renderOptions.hotspotTabDiv).css("visibility","inherit");
var hotspot=jQuery(renderOptions.hotspotDiv);
if(!hotspot.removeAmazonPopoverTrigger){return;
}hotspot.removeAmazonPopoverTrigger();
var width=renderOptions.width;
var options="";
var forceAlignmentValue=true;
if(renderOptions.forceAlignment!==undefined&&renderOptions.forceAlignment!==null){forceAlignmentValue=renderOptions.forceAlignment;
}var defaults={showOnHover:true,showCloseButton:false,forceAlignment:forceAlignmentValue,hoverShowDelay:200,hoverHideDelay:200,localContent:renderOptions.contentDiv,location:"bottom",align:"default",width:width,zIndex:200,skin:"default",locationMargin:4,locationOffset:[hotspot.width()-width+renderOptions.locationOffset,-1],onShow:function(popover){hotspot.bind("closepopover",function(){popover.close();
});
jQuery(renderOptions.hotspotTabDiv).addClass(renderOptions.openStyle);
},onHide:function(){hotspot.unbind("closepopover");
jQuery(renderOptions.hotspotTabDiv).removeClass(renderOptions.openStyle);
}};
hotspot.amazonPopoverTrigger(jQuery.extend({},defaults,options));
};
var processSortFlyout=function(options){var $=jQuery,amazonPopoverOptions=options;
var sortFlyoutDefaults={hotspotId:"kindOfSortHotspot",hotspotTabId:"kindOfSortHotspot_tab",hotspotContentId:"kindOfSort_content",hotspotStyleClass:"kindOfSortOpen",makeFlyoutTable:true};
if(options!==undefined){sortFlyoutDefaults=$.extend(sortFlyoutDefaults,options.sortFlyoutDefaults);
amazonPopoverOptions=$.extend(amazonPopoverOptions,options.amazonPopoverOptions);
}var hotspot=$("#"+sortFlyoutDefaults.hotspotId);
if(!hotspot.removeAmazonPopoverTrigger){return;
}hotspot.removeAmazonPopoverTrigger();
var defaults={showOnHover:true,showCloseButton:false,forceAlignment:true,hoverShowDelay:200,hoverHideDelay:200,localContent:"#"+sortFlyoutDefaults.hotspotContentId,location:"bottom",align:"default",width:300,zIndex:200,skin:"default",locationMargin:4,locationOffset:[-180,0],onShow:function(popover){hotspot.bind("closepopover",function(){popover.close();
});
$("#"+sortFlyoutDefaults.hotspotTabId).addClass(sortFlyoutDefaults.hotspotStyleClass);
return 1;
},onHide:function(){hotspot.unbind("closepopover");
$("#"+sortFlyoutDefaults.hotspotTabId).removeClass(sortFlyoutDefaults.hotspotStyleClass);
return 1;
}};
hotspot.amazonPopoverTrigger($.extend({},defaults,amazonPopoverOptions));
};
var processDeliveryAddressMessage=function(){amzn.sx.utils.jsDepMgr.when("ready popover","processDeliveryAddressMessage",function(){var renderOptions={hotspotTabDiv:"#deliveryAddressMessageHotspot_tab",hotspotDiv:"#deliveryAddressMessageHotspot",contentDiv:"#deliveryAddressMessage_content",openStyle:"deliveryAddressMessageOpen",locationOffset:300,width:350,forceAlignment:false};
processFlyout(renderOptions);
});
};
var processBestRefinementSeeAllFlyout=function(options){var hotspot=jQuery("#brscSeeAllHotspot");
if(!hotspot.removeAmazonPopoverTrigger){return;
}hotspot.removeAmazonPopoverTrigger();
var width=300;
var defaults={showOnHover:true,showCloseButton:false,forceAlignment:true,hoverShowDelay:200,hoverHideDelay:200,localContent:"#brscSeeAll_content",location:"bottom",align:"default",width:width,zIndex:200,group:"brscSeeAllPopover",skin:"default",locationMargin:4,locationOffset:[hotspot.width()-width+35,-1],onShow:function(popover){hotspot.bind("closepopover",function(){popover.close();
});
jQuery("#brscSeeAll_hotspot_tab").addClass("brscSeeAllOpen");
return 1;
},onHide:function(){hotspot.unbind("closepopover");
jQuery("#brscSeeAll_hotspot_tab").removeClass("brscSeeAllOpen");
return 1;
},onFilled:function(){jQuery("#brscSeeAll_seeAllDepartmentClosed a").click(function(){jQuery("#brscSeeAll_seeAllDepartmentClosed").css("display","none");
jQuery("#brscSeeAll_seeAllDepartmentOpen").show();
jQuery.AmazonPopover.updateBacking("brscSeeAllPopover");
return false;
});
jQuery("#brscSeeAll_seeAllDepartmentOpen a").click(function(){jQuery("#brscSeeAll_seeAllDepartmentClosed").show();
jQuery("#brscSeeAll_seeAllDepartmentOpen").css("display","none");
jQuery.AmazonPopover.updateBacking("brscSeeAllPopover");
return false;
});
}};
hotspot.amazonPopoverTrigger(jQuery.extend({},defaults,options));
};
var processExpandedSort=function(options){var $=jQuery;
var defaults={locationOffset:[3,0],makeFlyoutTable:true};
$.extend(defaults,options);
amzn.sx.utils.jsDepMgr.when("ready popover","processExpandedSort",function(){var content=$("#sortByBtf_content");
if(content.length){var width=content.width()+80;
var options={sortFlyoutDefaults:{makeFlyoutTable:defaults.makeFlyoutTable},amazonPopoverOptions:{localContent:"#sortByBtf_content",align:"right",width:width,locationOffset:defaults.locationOffset,onFilled:function(){}}};
processSortFlyout(options);
}});
};
searchComponents.processExpandedSort=processExpandedSort;
searchComponents.hoverOverImageTriggersTitleHover=function(){$("div.results > div.result > div.image").each(function(){$(this).hover(function(){$(this).parent().find("div.data > div.title a.title").addClass("titleHover");
},function(){$(this).parent().find("div.data > div.title a.title").removeClass("titleHover");
});
});
};
searchComponents.processBundlesFlyouts=function(resultsContainerSelector){var attachBundlesFlyoutHandler=function(product){var asin=searchPageAccess.asin(product);
if(!asin){return;
}var flyoutDivSelector="div.bundleFlyout[data-asin='"+asin+"']";
var flyoutDiv=$(flyoutDivSelector);
if(flyoutDiv.length===0){return;
}var dpLink=null;
var bundleLink=$(product).find(".bundleLink");
if(!bundleLink.amazonPopoverTrigger){return;
}bundleLink.amazonPopoverTrigger({width:500,location:"auto",attached:true,localContent:flyoutDiv,showOnHover:true,followLink:dpLink,showCloseButton:false});
};
searchPageAccess.asinResults(resultsContainerSelector).each(function(index,product){attachBundlesFlyoutHandler(product);
});
};
searchComponents.processAddToWishListBtns=function(){var forms=jQuery(".addtocart form");
forms.each(function(){var form=jQuery(this),wbtn=form.find("input[name*='wishlist']"),h=wbtn.attr("height"),w=wbtn.attr("width"),b=wbtn.attr("border"),s=wbtn.attr("src"),wimg='<div class="addToWL"><img '+"height="+h+" width="+w+" border="+b+" src="+s+"/></div>";
wbtn.remove();
form.append(wimg);
wimg=form.find("img");
var wdiv=form.find(".addToWL");
wimg.click(function(){var url=form.attr("action"),sid=form.find("input[name*='session']").attr("value"),oid=form.find("input[name*='offer']").attr("value"),asin=form.find("input[name*='asin']").attr("value"),op=wbtn.attr("name"),pdata=op+"="+"&offeringID.1="+oid+"&asin.1="+asin+"&session-id="+sid,srPg=window.srPg;
if(srPg){wdiv.addClass("addedToWL");
wdiv.html(srPg.addingTxt);
jQuery.ajax({type:"POST",url:url,data:pdata,success:function(){var fbk=srPg.addedToTxt+"<a style='text-decoration: underline;' href='"+srPg.wishListUrl+"'>"+srPg.wishListTxt+"</a>";
wdiv.html(fbk);
},error:function(){wdiv.html(srPg.cantAddTxt);
}});
}return false;
});
});
};
searchComponents.processDigitalMusicAddToCart=function(){var addToCart=function(form,button,asin){if(this[asin]||!form){return false;
}var messageDiv=jQuery(".atcb",form);
var processing=jQuery(".atcp",form);
var inCart=jQuery(".atci",form);
var postUrl=form.attr("action");
var postParams=form.serialize();
if(!messageDiv||!button||!processing||!inCart||!postUrl||!postParams){return false;
}this[asin]=true;
button.fadeOut("slow").remove();
messageDiv.append(processing);
processing.fadeIn("slow");
jQuery.ajax({type:"POST",url:postUrl,data:postParams,success:function(){processing.fadeOut("slow").remove();
messageDiv.append(inCart);
inCart.fadeIn("slow");
},error:function(){processing.fadeOut("slow").remove();
messageDiv.append(button);
button.fadeIn("slow");
this[asin]=false;
}});
};
var forms=jQuery(".srlBuyButton form");
forms.each(function(){var form=jQuery(this);
var asin=form.attr("id");
asin=asin.replace(/.*_/,"");
var button=jQuery(".atcb input",form);
button.click(function(){addToCart(form,button,asin);
});
});
};
searchComponents.processBestRefinementsFlyout=function(options){var hotspot=jQuery("#bestRefinementsMoreHotspot");
if(!hotspot.removeAmazonPopoverTrigger){return;
}hotspot.removeAmazonPopoverTrigger();
var width=300;
var defaults={showOnHover:true,showCloseButton:false,forceAlignment:true,hoverShowDelay:200,hoverHideDelay:200,localContent:"#bestRefinementsMore_content",location:"bottom",align:"default",width:width,zIndex:200,skin:"default",locationMargin:4,locationOffset:[hotspot.width()-width+35,-1],onShow:function(popover){hotspot.bind("closepopover",function(){popover.close();
});
jQuery("#bestRefinementsMoreHotspot_tab").addClass("bestRefinementsMoreOpen");
return 1;
},onHide:function(){hotspot.unbind("closepopover");
jQuery("#bestRefinementsMoreHotspot_tab").removeClass("bestRefinementsMoreOpen");
return 1;
}};
hotspot.amazonPopoverTrigger(jQuery.extend({},defaults,options));
};
searchComponents.processBestRefinementsMore=function(){amzn.sx.utils.jsDepMgr.when("ready popover","processBestRefinementsMore",function(){var renderOptions={hotspotTabDiv:"#bestRefinementsMoreHotspot_tab",hotspotDiv:"#bestRefinementsMoreHotspot",contentDiv:"#bestRefinementsMore_content",openStyle:"bestRefinementsMoreOpen",locationOffset:35,width:300,topOffset:14,leftOffset:0};
processFlyout(renderOptions);
});
};
searchComponents.renderDeliveryAddressPopover=function(){var $=jQuery;
$("#deliveryAddressMessage_table").show();
processDeliveryAddressMessage();
$(document).bind("searchajax",function(){processDeliveryAddressMessage();
});
};
searchComponents.processEntityRefinements=function(){amzn.sx.utils.jsDepMgr.when("ready popover","processEntityRefinements",function(){var renderOptions={hotspotTabDiv:"#bestRefinementsMoreHotspot_tab",hotspotDiv:"#entityRefinementsHotspot",contentDiv:"#entityRefinementsMoreContent",openStyle:"bestRefinementsMoreOpen",width:280,locationOffset:30,topOffset:14,leftOffset:-3};
processFlyout(renderOptions);
});
};
searchComponents.processAPSSort=function(options){amzn.sx.utils.jsDepMgr.when("ready popover","processAPSSort",function(){processSortFlyout(options);
});
};
searchComponents.processSmartAPSSort=function(){var $=jQuery,width=250,hotspotStyleClass="smartAPSOpen",hotspotTabId="smartAPSHotspot_tab",hotspotId="smartAPSHotspot",hotspotContentId="smartAPS_content";
var smartAPSOptions={sortFlyoutDefaults:{hotspotId:hotspotId,hotspotTabId:hotspotTabId,hotspotContentId:hotspotContentId,hotspotStyleClass:hotspotStyleClass,makeFlyoutTable:false},amazonPopoverOptions:{width:width,locationOffset:[0,0],align:"center",closeEventExclude:"MOUSE_LEAVE",closeEventInclude:"CLICK_OUTSIDE",openEventInclude:"CLICK_TRIGGER",showCloseButton:true,onHide:function(){var hotspot=$("#"+hotspotId);
hotspot.unbind("closepopover");
$("#apsSort_seeAllDepartmentClosed, #apsSort_fewDep").show();
$("#apsSort_seeAllDepartmentOpen").css("display","none");
$("#"+hotspotTabId).removeClass(hotspotStyleClass);
return 1;
}}};
amzn.sx.utils.jsDepMgr.when("ready popover","processSmartAPSSort",function(){processSortFlyout(smartAPSOptions);
processExpandedSort({locationOffset:[0,0],makeFlyoutTable:false});
});
};
searchComponents.processBestRefinementSeeAll=function(){amzn.sx.utils.jsDepMgr.when("ready popover","processBestRefinementSeeAll",function(){processBestRefinementSeeAllFlyout();
});
};
searchComponents.smartAPSSortUpdate=function(element){var $=jQuery;
var atag=$("#"+element);
var url=atag.attr("data-url");
var node="";
var queryString=url.substring(url.indexOf("?"));
if(url.indexOf("ref=")!=-1){var reftag=url.substring(url.indexOf("ref="),url.indexOf("?"));
node=reftag.match(/\d+/);
}$("#smartAPS").find("#sortByBtf_content, .sortOption").find("a").each(function(){var sort=$(this).attr("data-sort");
if(sort!==undefined){var targetUrl=this.hash||this.href;
var targetUrlPath=targetUrl.substring(0,targetUrl.indexOf("?"));
targetUrlPath=targetUrlPath.replace(/(sr_st_scat_\w+_)\d+/,"$1"+node);
this.href=targetUrlPath+queryString+"&sort="+encodeURIComponent(sort);
}});
var pop=$("#smartAPSHotspot");
pop.find(".emptyRefinement").text(atag.find(":nth-child(1)").text());
pop.trigger("closepopover");
};
searchComponents.amz_js_PopWin=function(url,name,options){var ContextWindow=window.open(url,name,options);
ContextWindow.focus();
return false;
};
searchComponents.enforceMinWidthForIE=function(divId){var $=jQuery;
var checkWidth=function(){var div=$("#"+divId);
if(div.length&&div.css("min-width")){var minWidth=parseInt(div.css("min-width").replace("px",""));
div.css("width",(div.width()<(minWidth+1))?(minWidth+"px"):"auto");
}};
$(document).ready(checkWidth);
$(window).resize(checkWidth);
};
searchComponents.onClickSubgroupRefinement=function(){var thisExpanderSpan=jQuery(this).find("span.expanderImageSprite");
var thisLabelSpan=jQuery(this).find("span.refinementLink");
var thisLabelText=thisLabelSpan.html();
var thisOtherLabelSpan=jQuery(this).find("span.subgroupOtherLabel");
if(thisExpanderSpan.hasClass("collapse")){thisExpanderSpan.removeClass("collapse").addClass("expand");
thisLabelSpan.html(thisOtherLabelSpan.html());
thisOtherLabelSpan.html(thisLabelText);
thisExpanderSpan.parent().parent().children("ul").slideUp("fast");
}else{var actSgrp=jQuery(this).parent().siblings("li").find("a:first span.collapse").parent().parent();
var actExpanderSpan=actSgrp.find("a:first span.expanderImageSprite");
var actLabelSpan=actExpanderSpan.siblings("span.refinementLink");
var actLabelText=actLabelSpan.html();
var actOtherLabelSpan=actExpanderSpan.siblings("span.subgroupOtherLabel");
actExpanderSpan.removeClass("collapse").addClass("expand");
actLabelSpan.html(actOtherLabelSpan.html());
actOtherLabelSpan.html(actLabelText);
thisExpanderSpan.removeClass("expand").addClass("collapse");
thisLabelSpan.html(thisOtherLabelSpan.html());
thisOtherLabelSpan.html(thisLabelText);
actSgrp.children("ul").hide();
jQuery(this).siblings("ul").slideDown("fast");
}};
searchComponents.processPromotionsPopover=function(){var elementsWidth=function(container,elementsString,displayStyle){var outer=$("<span>").appendTo(container);
outer.html(elementsString).css("font",container.css("font")).css("display",displayStyle);
var width=outer.width();
outer.remove();
return width;
};
jQuery(".morePromotions, .promotionContainer").each(function(){var link=jQuery(this);
var isPromotionRedesign=link.hasClass("promotionContainer");
if(!link.removeAmazonPopoverTrigger){return;
}link.removeAmazonPopoverTrigger();
var popup=link.parent().siblings(".promotions_popup");
if(popup.length==0&&isPromotionRedesign){popup=link.siblings(".promotions_popup");
}if(popup.length){if(!popup.get(0).tagName.match(/div/i)){popup=popup.children().get(0);
}else{popup=popup.get(0);
}if(popup){var moreConfigs={localContent:popup},promotionsPopoverConfig={showOnHover:true,showCloseButton:false,width:320,location:"bottom",locationAlign:"left",clone:false,hoverShowDelay:150,hoverHideDelay:150,followLink:isPromotionRedesign};
if(isPromotionRedesign){var promotionContent=link.find(".promotionContent");
link.bind("mouseover.amzPopover",function(event){if(jQuery(popup).find("li").length<2&&elementsWidth(link,promotionContent.html(),"inline-block")<=promotionContent.width()){event.stopImmediatePropagation();
}});
}link.amazonPopoverTrigger(jQuery.extend(true,moreConfigs,promotionsPopoverConfig));
}}});
};
searchComponents.toggleVisualPickers=function(containerId,linkElement){jQuery("#"+containerId).find(".vpHidden").toggle();
jQuery(linkElement).find(".vpSeeOptionText").toggle();
};
searchComponents.registerAivHandler=function(resultsContainerSelector,elem,refId){var $=jQuery;
var attachAivHandlersToProductItem=function(product){var pobj=$(product),watchlistSection=pobj.find(".wl-section")[0],rentalListSeciton=pobj.find(".rl-section")[0];
if(!watchlistSection&&!rentalListSeciton){return;
}var sect=$(watchlistSection||rentalListSeciton);
var eventData={sect:sect,asin:sect.attr("asin"),prodType:sect.attr("prodtype"),idx:(refId?parseInt(refId.substr(7)):searchPageAccess.asinDisplayIndex(product))+1};
pobj.find(".a-button").click(eventData,function(e){var div=e.data.sect,transition,url,config,data;
if(div.is(".a-button-disabled")){return;
}if(watchlistSection){data={token:$.pageContext.csrfToken,dataType:"json",prodType:e.data.prodType,ASIN:e.data.asin,pageType:$.pageContext.pageType,subPageType:$.pageContext.subPageType||"generic",request:$.pageContext.rid,store:$.pageContext.store};
config={addClassSel:".wl-text-add",delClassSel:".wl-text-remove",method:"GET",refTag:"_watchlist",addUrl:"/gp/video/watchlist/ajax/addRemove.html",delUrl:"/gp/video/watchlist/ajax/addRemove.html"};
}else{if(rentalListSeciton){data={csrfToken:$.pageContext.csrfToken,asin:e.data.asin};
data.queueId=$("#"+refId).add(div).attr("queueId");
config={addClassSel:".rl-add",delClassSel:".rl-remove",rsvClassSel:".rl-reserve",stateClass:"rl-dark",method:"POST",refTag:"_rl",addUrl:"/gp/rentallist/addAsin.html",delUrl:"/gp/rentallist/deleteAsin.html"};
}}if(div.find(config.delClassSel).css("display")=="none"){data.ref="sr_1_"+e.data.idx+config.refTag+"_add";
data.addItem=1;
url=config.addUrl;
transition=function(resp){var tgt=$("#"+refId).add(div);
if(resp.queueId){tgt.attr("queueId",resp.queueId);
}tgt.find(config.addClassSel).addClass("hidden");
tgt.find(config.rsvClassSel).addClass("hidden");
tgt.find(config.delClassSel).removeClass("hidden");
if(config.stateClass){tgt.find(".a-button").addClass(config.stateClass);
}};
}else{data.ref="sr_1_"+e.data.idx+config.refTag+"_remove";
data.addItem=0;
url=config.delUrl;
transition=function(resp){var tgt=$("#"+refId).add(div);
tgt.removeAttr("queueId");
tgt.find(config.delClassSel).addClass("hidden");
if(config.rsvClassSel&&resp&&resp.status==="CAN_BE_RESERVED"){tgt.find(config.rsvClassSel).removeClass("hidden");
}else{tgt.find(config.addClassSel).removeClass("hidden");
}if(config.stateClass){tgt.find(".a-button").removeClass(config.stateClass);
}};
}var ref=data.ref;
delete data.ref;
div.find(".a-button").addClass("a-button-disabled");
var recover=function(){div.find(".a-button").removeClass("a-button-disabled");
};
$.ajax({type:config.method,url:url+"/ref="+ref,data:data,success:function(response){if(response&&response.success){transition(response);
}recover();
},error:recover});
});
};
if(elem){attachAivHandlersToProductItem(elem,refId);
}else{searchPageAccess.asinResults(resultsContainerSelector).each(function(index,product){attachAivHandlersToProductItem(product);
});
}};
searchComponents.validatePostalCode=function(zipForm){var $=jQuery;
var zip=zipForm.p_postal_code;
var valid=zip.value.match(/\d{5}/)!==null;
var errEl=$("#error_msg");
if(!valid){errEl[0].style.display="inline";
}else{errEl[0].style.display="none";
}return valid;
};
searchComponents.setFinancialValidation=function(){function setInputPrompt(elem,prompt){if(elem.value===""){elem.value=prompt;
}if(elem.value==prompt){elem.style.color="#CCC";
}else{elem.style.color="#000";
}elem.onblur=function(){if(elem.value===""){elem.value=prompt;
elem.style.color="#CCC";
}};
elem.onfocus=function(){jQuery("#error_msg")[0].style.display="none";
if(elem.value==prompt){elem.value="";
elem.style.color="#000";
}};
}var $=jQuery;
$(document).ready(function(){var pc=$("#p_postal_code");
var zcp=$("#zip_code_prompt");
if(pc.length>0&&zcp.length>0){setInputPrompt(pc[0],zcp[0].innerHTML);
}});
};
searchComponents.shipToStateRedirect=function(id){var discriminator="#"+id+" :selected";
if(jQuery(discriminator).length!==0&&jQuery(discriminator).val()!==""){location.href=jQuery(discriminator).val();
}};
searchComponents.processPredictedRatingPopover=function(){var predictedRatingPopoverConfig={showOnHover:true,showCloseButton:false,width:288,location:"bottom",locationAlign:"left",locationOffset:[-20,0],group:"reviewsPopover",clone:false,hoverHideDelay:300,title:"&nbsp;",cacheable:false};
jQuery(".predictedRatingSummary, .predictedRatingText").each(function(){var $this=jQuery(this),asin,ref,remoteContentAddr,myConfig;
if(!$this.removeAmazonPopoverTrigger){return;
}$this.removeAmazonPopoverTrigger();
asin=$this.attr("name");
ref=$this.attr("ref");
remoteContentAddr="/gp/product/features/predicted-product-rating-ajax.html?"+"ASIN="+asin+"&ref_="+ref;
myConfig=jQuery.extend(true,{},predictedRatingPopoverConfig);
myConfig.destination=remoteContentAddr;
$this.amazonPopoverTrigger(myConfig);
});
};
var buyButtons=$("a.available .twoStateButton");
if(buyButtons.length!=0){var buyButtonLogging={};
buyButtonLogging.buttonStateCount=0;
buyButtonLogging.boughtAsin=0;
searchComponents.mdarsSuccess=function(rsp,a,asin){if(rsp.success&&rsp[asin].allDevicesCompatible){var base=a.attr("data-baseValue");
var buttonFixedWidth=a.width();
a=a.add("#ilh2 a.available .twoStateButton");
if(base){a=a.add("#result_"+base+" .ilc2 a.available .twoStateButton");
a=a.add("#result_"+base+" .ild2 a.available .twoStateButton");
}a.removeClass("available");
a.unbind("click");
a.addClass("marBuyButton");
a.children("span").removeClass("a-button-primary a-button-focus");
a.children("span").addClass("sx-ts-button-buy").css("min-width",buttonFixedWidth+"px");
a.find("span.a-button-text").text(a.attr("data-buyText"));
a.removeAttr("href");
a.bind("click",function(event){event.preventDefault();
searchComponents.executePurchase($(event.target).closest("a"));
});
return;
}window.location.href=a.attr("href");
};
searchComponents.executePurchase=function(a){buyButtonLogging.boughtAsin=true;
ue.log(buyButtonLogging.boughtAsin,"boughtAsin");
var form=document.createElement("form");
form.setAttribute("method","post");
form.setAttribute("action",a.attr("data-purchaseUrl"));
if(a.attr("target")=="_blank"){form.target="_blank";
}var params={};
params.csrfToken=a.attr("data-csrftoken");
params.ASIN=a.attr("data-asin");
params.appVersionNo=a.attr("data-appversion");
params.productType="MOBILE_APPLICATION";
params.priceValue=a.attr("data-priceamount");
params.priceCode=a.attr("data-currencycode");
for(var key in params){if(params.hasOwnProperty(key)){var hiddenField=document.createElement("input");
hiddenField.setAttribute("type","hidden");
hiddenField.setAttribute("name",key);
hiddenField.setAttribute("value",params[key]);
form.appendChild(hiddenField);
}}document.body.appendChild(form);
form.submit();
};
searchComponents.mdarsError=function(a){window.location.href=a.attr("href");
};
searchComponents.checkCompatibility=function(event){event.preventDefault();
var a=$(event.target).closest("a");
$.ajax({"url":a.attr("data-mdars"),"success":function(data,textStatus,xhr){searchComponents.mdarsSuccess(data,a,a.attr("data-asin"));
},"error":function(xhr,textStatus,errorThrown){searchComponents.mdarsError(a);
}});
buyButtonLogging.buttonStateCount+=1;
ue.log(buyButtonLogging.buttonStateCount,"buttonStateCount");
};
$("#searchTemplate").delegate("a.available .twoStateButton","click",searchComponents.checkCompatibility);
}searchComponents.insertNormalImagesToShow=function(){var $=jQuery;
$("div.imageBox img.productImage").each(function(){if($(this).hasClass("smallProductImage")&&$(this).is(":visible")){var image=$(this).clone(false);
image.attr("src",$(this).attr("data-url"));
image.removeAttr("data-url");
image.removeAttr("onload");
image.removeClass("smallProductImage");
image.hide();
var that=$(this);
image.attr("onload",function(){that.hide();
$(this).show();
});
image.appendTo($(this).parent());
}});
};
searchComponents.processPantryCouponPopover=function(){jQuery(".pantry-vpc").each(function(){var $this=jQuery(this);
var trigger=$this.find(".pantry-vpc-popover-trigger");
if(!trigger.removeAmazonPopoverTrigger){return;
}trigger.removeAmazonPopoverTrigger();
var promotionId=$this.attr("name");
var remoteContentAddr="/gp/pantry/search-coupon-popup.html?promo="+promotionId;
var popoverConfig={locationElement:trigger,align:"center",showOnHover:false,showCloseButton:true,destination:remoteContentAddr,attached:true,closeEventInclude:"MOUSE_LEAVE",hoverHideDelay:500,width:400,location:"bottom"};
trigger.amazonPopoverTrigger(popoverConfig);
});
};
jsDepMgr.register("search-components",function(){return searchComponents;
});
});
}());
amzn.sx.utils.jsDepMgr.when("jQuery ready","ensureJqueryDelegateExists",function($){if(!!!$.fn.delegate){return;
}(function mp3ViewCartHover(){function switchText(e,eventType){var $el=$(e.currentTarget).find("a"),$mp3El=$el.find(".music-cart-in-cart-text"),text=$el.data(eventType==="in"?"view-cart-text":"in-cart-text");
$mp3El.text(text);
}function hoverIn(e){switchText(e,"in");
}function hoverOut(e){switchText(e,"out");
}$("#searchTemplate").delegate(".MusicCartInCartButton","mouseenter mouseleave",function(e){if(e.type==="mouseenter"){hoverIn(e);
}else{hoverOut(e);
}});
})();
amzn.sx.utils.jsDepMgr.when("ready hoverIntent","mp3AddToCartToolTip",function(){var $body=$("body"),$toolTip;
function showAddTooltip(e){showTooltip(e,true);
}function showRemoveTooltip(e){showTooltip(e);
}function showTooltip(e,isAddTooltip){var $el=$(e.currentTarget),textSelector=isAddTooltip?"add-to-cart-text":"remove-from-cart-text",text=$el.data(textSelector);
if($toolTip===undefined){var html='<div class="music-cart music-cart-tooltip">'+'<span class="music-cart-tooltip-text">'+text+"</span>"+'<div class="tooltip-triangle"></div></div>';
$toolTip=$(html);
$body.append($toolTip);
}else{$toolTip.find(".music-cart-tooltip-text").text(text);
}$toolTip.stop(true,true).css({left:0});
var position=$el.offset();
$toolTip.css({left:position.left-$toolTip.width()-10,top:position.top-$toolTip.height()-20});
$toolTip.fadeIn();
}function hideToolTip(){$body.find(".music-cart-tooltip").fadeOut();
}function showPrimeFlyout(e){var $el=$(e.currentTarget),$flyout=$el.next(".music-cart-tooltip.music-prime");
$flyout.closest(".prod").css({"overflow":"visible"});
$flyout.show();
$flyout.css({left:$el.position().left-$flyout.outerWidth()+$el.outerWidth()+parseInt($el.css("margin-left"),10)+1,top:getPrimeFlyoutTopValue()});
$flyout.hide().fadeIn(200);
}function getPrimeFlyoutTopValue(){var topOffset=-30;
if($("#ilh2").length>0){topOffset=-70;
}return topOffset;
}function hidePrimeFlyout(e){$(e.currentTarget).fadeOut();
}var $musicCartAddButton=$(".MusicCartAddButton:not(.music-prime-link)"),$musicCartRemoveButton=$(".MusicCartRemoveButton"),$musicCartPrimeButton=$(".MusicCartPrimeButton");
if($.isFunction($.fn.hoverIntent)){$musicCartAddButton.hoverIntent(showAddTooltip,hideToolTip);
$musicCartRemoveButton.hoverIntent(showRemoveTooltip,hideToolTip);
}else{$musicCartAddButton.hover(showAddTooltip,hideToolTip);
$musicCartRemoveButton.hover(showRemoveTooltip,hideToolTip);
}$(".MusicCartPrimeButton").live("click",showPrimeFlyout);
$(".music-cart-tooltip.music-prime").live("mouseleave",hidePrimeFlyout);
});
});
amzn.sx.utils.jsDepMgr.when("jQuery ready","mp3AddToCartCallback",function($){window.mp3AddToCartCallback=function(response){if(response.success){var $el=$('.music-cart-buttons[data-asin="'+response.asin+'"]'),$inCartButtons=$el.find(".music-in-cart-buttons"),$buyButtons=$el.find(".music-buy-buttons"),showClass="music-show";
if(response.action=="add"){$inCartButtons.addClass(showClass);
$buyButtons.removeClass(showClass);
}else{if(response.action=="remove"){$inCartButtons.removeClass(showClass);
$buyButtons.addClass(showClass);
}}}};
});
amzn.sx.utils.jsDepMgr.when("jQuery popover ready","buildPantryAddressPopover",function(jQuery){amzn.sx.utils.jsDepMgr.register("pantry-address-popover",function(){return function(){var hotspot=jQuery("#pantryAddressMessageHotspot");
var content="#pantryAddressMessageContent";
var locationOffset=130;
var width=260;
var options={showOnHover:false,showCloseButton:true,forceAlignment:true,hoverShowDelay:0,hoverHideDelay:0,localContent:content,location:"bottom",align:"default",paddingLeft:0,paddingRight:0,width:width,zIndex:200,skin:"<div class='pantry-address-popover'><div class='srSprite sprClosePopupButton ap_close'></div><div class='ap_content'></div></div>",locationMargin:4,locationOffset:[Math.max(hotspot.width()-width+locationOffset,0),4],onShow:function(popover){jQuery(".pantry-address-popover .sprClosePopupButton").css("cursor","pointer");
}};
hotspot.amazonPopoverTrigger(options);
jQuery(".pantry-address .address").css({"color":"rgb(0,75,145)","font-weight":"normal"});
jQuery(".pantry-address .sprPopoverArrow").toggle(true);
jQuery("#pantryAddressMessageHotspot").css("cursor","pointer");
};
});
});
amzn.sx.utils.jsDepMgr.when("jQuery popover ready","pantry-popover",function($){var pantryPopup=function(target,popupContent){target.amazonPopoverTrigger({locationElement:target,width:300,location:"bottom",align:"center",showOnHover:false,showCloseButton:true,localContent:popupContent,attached:true,closeEventInclude:"MOUSE_LEAVE",hoverHideDelay:500});
};
amzn.sx.utils.jsDepMgr.register("pantryPopup",function(){return pantryPopup;
});
});
amzn.sx.utils.jsDepMgr.when("jQuery search-page-access popover ready","campusLocationsPopup",function(jQuery,searchPageAccess){jQuery(".campusLocationsPopup").each(function(index,element){var target=jQuery(element);
if(!target.removeAmazonPopoverTrigger){return;
}target.removeAmazonPopoverTrigger();
var url=target.attr("data-url");
var header=target.attr("data-header");
target.amazonPopoverTrigger({width:400,location:"bottom",align:"center",showOnHover:false,showCloseButton:true,destination:url,title:header,attached:true,hoverHideDelay:500});
});
});
amzn.sx.utils.jsDepMgr.when("jQuery ready","addToCloudPlayerCallback",function($){window.addToCloudPlayerCallback=function(result,robinButton){var status=result.hasOwnProperty("status")?result.status:result;
if(status===0){window.location=robinButton.button.attr("href");
return;
}var url="/gp/dmusic/cloudplayer/web",validTypes=["playlist","album","track"];
if($.inArray(robinButton.type,validTypes)>-1){url=url+"?playNow=1&"+robinButton.type+"Asin="+robinButton.asin;
}var $primeButton=robinButton.button.closest(".MusicCartBuyButton");
$primeButton.css("visibility","hidden");
$primeButton.parent().find(".music-play-button").addClass("music-show").css("display","inline-block");
if($primeButton.parents(".ilo2").length>0){var $imageViewAsinEl=$('.music-cart-buttons[data-asin="'+robinButton.asin+'"]');
$imageViewAsinEl.find(".MusicCartBuyButton").remove();
$imageViewAsinEl.find(".music-play-button").css({"display":"inline-block"});
}$primeButton.remove();
};
});
amzn.sx.utils.jsDepMgr.when("jQuery search-general-globals-factory search-page-utilities search-components","search-js-general",function($,globalsFactory,searchGeneralUtils,searchComponents){globalsFactory.registerToWindow(searchComponents);
amzn.sx.utils.jsDepMgr.register("search-js-general",function(){return searchComponents;
});
});
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
var isPopoverRegistered=false;
jsDepMgr.when("ready popover","sx-register-popover-bridge-amznJQ",function(){if(!isPopoverRegistered){jsDepMgr.register("sx-popover-bridge",function(){});
isPopoverRegistered=true;
}});
if(typeof P==="undefined"){return;
}P.when("A","jQuery","a-popover").execute("sx-register-popover-bridge-AUI",function(A,$,popover){var fakePopover={close:function(){}};
function _convertAmznJQPopoverInput(hash){var preloadID=null;
var $localContent=null;
if(hash.localContent){$localContent=$(hash.localContent);
if(!$localContent.length){return null;
}}if($localContent){preloadID=typeof hash.localContent==="object"?"popover-sx-bridge":hash.localContent.replace(/\W+/g,"");
preloadID+=Date.now();
var $preload=$('<div class="a-popover-preload" id="a-popover-'+preloadID+'">');
$preload.append($localContent.children());
$localContent.remove();
$("body").append($preload);
}return{activate:hash.showOnHover===false?"onclick":"onmouseover",cache:!!hash.cacheable,closeButton:!!hash.showCloseButton,content:hash.literalContent,name:preloadID,position:hash.location==="bottom"?"triggerBottom":"triggerVertical",width:hash.width,url:hash.destination};
}function _mapAmznJQPopoverListeners(instance,hash){if(hash.onShow||hash.onFill){A.on("a:popover:afterShow",function(event){var eventPopover=event.popover;
if(eventPopover.id===instance.id){if(hash.onShow){hash.onShow.call(this,fakePopover);
}if(hash.onFill){hash.onFill.call(this,fakePopover);
}}});
}if(hash.onHide){A.on("a:popover:afterHide",function(event){var eventPopover=event.popover;
if(eventPopover.id===instance.id){hash.onHide.call(this,fakePopover);
}});
}}if(!isPopoverRegistered){isPopoverRegistered=true;
jsDepMgr.register("sx-popover-bridge",function(){$.fn.extend({removeAmazonPopoverTrigger:function(){},amazonPopoverTrigger:function(hash){var auiHash=_convertAmznJQPopoverInput(hash);
if(auiHash){var instance=popover.create(this,auiHash);
_mapAmznJQPopoverListeners(instance,hash);
}}});
});
jsDepMgr.register("popover",function(){});
}});
}());
amzn.sx.utils.jsDepMgr.when("jQuery search-js-general","imageView",function($,searchComponents){var eventId;
var zmctx={s:160,l:220,ls:190,ll:246,zs:260,zl:358,enlarge:function(url){if(url){return url.replace(/160/g,"260").replace(/220/g,"358").replace(/190/g,"260").replace(/261/g,"358");
}}};
var hover=function(div){if(!div.is(":visible")){return;
}var ref=div.parent().find("a:first.ilc img.ilc, a:first.ilc div.phld");
var w=ref.width(),h=ref.height(),wdif,hdif;
if(w==zmctx.ls){wdif=(zmctx.zs-zmctx.ls)/2;
hdif=h==zmctx.ll?(zmctx.zl-zmctx.ll)/2:wdif;
}else{wdif=(zmctx.zs-zmctx.s)/2;
hdif=h==zmctx.l?(zmctx.zl-zmctx.l)/2:wdif;
}if(ref.is("div.phld")){hdif=0;
}var cont=div.find("a.ilc, a.ilc img.ilc, a.ilc div.phld");
div.animate({top:-hdif,left:-wdif},{duration:30,easing:"linear",step:function(cur,fx){if(fx.prop=="top"){cont.css("height",h+Math.round(-cur*2));
}else{cont.css("width",w+Math.round(-cur*2));
}},complete:function(){div.addClass("ilshdw").find("div.ild").show();
}});
};
var divsetup=function(li){var ref=li.find("img:first.ilc, div.phld:first"),div=li.find("div.ilh");
div.parent().css("z-index","9");
div.css({top:"",left:"",width:"",height:""});
div.find("a.ilc, a.ilc img.ilc, a.ilc div.phld").css({"width":ref.width(),"height":ref.height()});
var url=zmctx.enlarge(ref.attr("src"));
if(!ref.is("img.phld")&&url!=ref.attr("src")){$("<img/>").bind("load",function(e){div.find("a.ilc img.ilc").attr("src",$(e.target).attr("src")||url);
}).attr("src",url);
}return div.show();
};
var enter=function(e){if(eventId){clearTimeout(eventId);
}var div=divsetup($(e.target).parents("li.ilo"));
eventId=window.setTimeout(function(){hover(div);
},500);
};
var leave=function(e){$(e.target).parents("li.ilo").find("div.ilf").css("z-index","").find("div.ilh, div.ild").stop().hide().removeClass("ilshdw");
};
if(!window.ilctx){window.ilctx={};
}ilctx.hover=function(){$("#atfResults div.ilf, #mainResults div.ilf").unbind("mouseenter",enter).unbind("mouseleave",leave).bind("mouseenter",enter).bind("mouseleave",leave);
};
var hover2=function(div){var hover=$("#ilh2").empty(),offset=div.offset(),max;
div.siblings(".ild2").clone().appendTo(hover).show();
registerAivHandler(undefined,hover,div.parent().attr("id"));
var isphld=hover.find("div.phld2").length;
hover.css({left:-1000,display:"block",width:"300px",height:""});
var hovers={width:300,height:hover.height()+(isphld?0:80)};
var ul=div.closest("ul.ilo2"),poffset=ul.offset();
hovers.left=offset.left-(hovers.width-div.outerWidth())/2;
hovers.top=offset.top-(hovers.height-div.outerHeight())/2;
max=Math.min(poffset.top+ul.height(),window.pageYOffset+window.innerHeight-10);
if(hovers.top+hovers.height>max){hovers.top-=(hovers.top+hovers.height-max);
}max=Math.min(poffset.left+ul.width(),window.pageXOffset+window.innerWidth);
if(hovers.left+hovers.width>max){hovers.left-=(hovers.left+hovers.width-max+4);
}max=Math.max(poffset.left,window.pageXOffset);
if(hovers.left<max){hovers.left=max+2;
}max=Math.max(poffset.top,window.pageYOffset);
if(hovers.top<max){hovers.top=max+2;
}hover.css({"left":offset.left+"px","top":offset.top+"px","width":div.outerWidth()+"px","height":div.outerHeight()+"px","display":"block"});
var img=hover.find("img.ilc2"),dat=img.attr("data-resize");
if(dat&&dat!="1"){img.attr("src",dat);
}hover.animate({top:"-="+(offset.top-hovers.top),left:"-="+(offset.left-hovers.left),width:"+="+(hovers.width-div.outerWidth()),height:"+="+(hovers.height-div.outerHeight())},{duration:100,easing:"linear",queue:false});
if(isphld){hover.find("div.phld2").animate({width:"+=80"},{duration:100,easing:"linear",queue:false});
}else{hover.find("img.ilc2").animate({width:"+=80",height:"+=80"},{duration:100,easing:"linear",queue:false});
}};
var mobileAppsHover=function(){var marLogging={};
marLogging.flyoutCount=0;
marLogging.thumbnailCount=0;
var mobileAppsHover=function(div){copy=div.find(".marCopyThis");
paste=div.parent().find(".ild2 .marPasteHere");
copy.find(".twoStateButton a").attr("data-baseValue",div.parent().attr("id").split("_")[1]);
copy.clone().appendTo(paste);
copy.removeClass("marCopyThis");
var hover=$("#ilh2").empty(),offset=div.offset(),max;
var flyoutContent=div.siblings(".ild2").clone();
flyoutContent.appendTo(hover).show();
hover.css({"visibility":"hidden","display":"block"});
flyoutWidth=$("#ilh2").width();
flyoutHeight=$("#ilh2").height();
parentElement=div.closest("ul.ilo2");
flyoutTop=offset.top;
var pageYOffset=$(window).scrollTop();
var windowHeight=$(window).height();
if(flyoutTop<pageYOffset){flyoutTop=pageYOffset;
}flyoutBottom=flyoutTop+flyoutHeight;
max=Math.min(parentElement.offset().top+parentElement.height(),pageYOffset+windowHeight-10);
if(flyoutBottom>max){flyoutTop-=(flyoutBottom-max);
}flyoutLeft=offset.left;
if(offset.left>parentElement.offset().left+parentElement.width()-flyoutWidth){flyoutLeft=parentElement.offset().left+parentElement.width()-flyoutWidth;
}thumbnails=flyoutContent.find(".marFlyoutRightColumn img.centeredImage");
thumbnails.each(function(index,tnail){$(tnail).attr("src",$(tnail).attr("data-src"));
});
if(thumbnails!=[]&&thumbnails.find(".selectGrey").length==0){assignThumbnail(thumbnails.parent(),0,marLogging);
}flyoutContent.find(".marFlyoutRightColumn div").bind("mouseenter",function(e){div=$(e.target).closest("div");
assignThumbnail(div.parent().children(),div.index(),marLogging);
});
flyoutContent.find(".twoStateButton a.available").bind("click",searchComponents.checkCompatibility);
buyButton=flyoutContent.find(".twoStateButton a.marBuyButton");
if(buyButton){buyButton.bind("click",function(event){event.preventDefault();
searchComponents.executePurchase(buyButton);
});
}flyoutContent.css({"width":flyoutWidth+"px","height":flyoutHeight,"visibility":"visible"});
hover.css({"left":offset.left+"px","top":offset.top+"px","width":div.outerWidth()+"px","height":div.outerHeight(),"visibility":"visible"});
hover.animate({"left":flyoutLeft+"px","top":flyoutTop,"width":flyoutWidth+"px","height":flyoutHeight},100);
marLogging.flyoutCount+=1;
ue.log(marLogging.flyoutCount,"marFlyoutCount");
};
return mobileAppsHover;
}();
function assignThumbnail(filmstrip,pos,marLogging){filmstrip.filter(".selectGrey").removeClass("selectGrey");
thumb=filmstrip.eq(pos);
thumb.addClass("selectGrey");
mainDiv=$("#ilh2").find(".marFlyoutMainImage");
mainDiv.empty();
var thumbImg=thumb.find("img");
thumbImg.clone().appendTo(mainDiv);
img=mainDiv.find("img");
img.css("margin-top",parseInt(thumbImg.css("margin-top"))*4+"px");
marLogging.thumbnailCount+=1;
ue.log(marLogging.thumbnailCount,"marThumbnailCount");
}var reset=function(e){if(eventId){clearTimeout(eventId);
}eventId=null;
if(e.target.nodeType==1&&!$.contains(document.getElementById("ilh2"),e.target)&&!$(e.target).is("#ilh2")){$("#ilh2").hide().css({top:"",left:"",width:"",height:""});
}};
var mousemove=function(e){reset(e);
var div=$(e.target).closest("div.ilc2:not(.suppressFlyout)");
if(div.length){var img=div.siblings(".ild2").find("img.ilc2");
if(img.length&&!img.attr("data-resize")){img.attr("data-resize","1");
var org=img.attr("src"),url=org.replace(/200/g,"280");
$("<img/>").bind("load",function(e){img.attr("data-resize",url);
var hi=$("#ilh2 img.ilc2");
if(hi.attr("src")==org){hi.attr("src",url);
}}).attr("src",url);
}if(div.hasClass("marFlyout")){eventId=window.setTimeout(function(){mobileAppsHover(div);
},350);
}else{eventId=window.setTimeout(function(){hover2(div);
},350);
}}};
ilctx.hover2=function(){var hover=$("#ilh2");
if(!hover.length){hover=$("<div id='ilh2'></div>").appendTo("ul.ilo2");
}$("ul.ilo2").unbind("mousemove",mousemove).unbind("mouseleave",reset).bind("mousemove",mousemove).bind("mouseleave",reset);
$(window).unbind("resize",reset).unbind("scroll",reset).bind("resize",reset).bind("scroll",reset);
};
var last;
var t=[200,400,350,100];
var resetLast=function(){if(last){last.find(".ilv3").stop().animate({"opacity":1},t[2]);
last.find(".ild3").stop().animate({"top":(last.outerHeight()+6)},t[2]);
last.unbind("mousemove",mousemove3);
last=null;
}};
var hover3=function(div){last=div;
var h=div.find(".ilb3").height(),grid=div.find(".rsltGridList"),hover=div.find(".ild3"),aTopFrom=div.outerHeight()+6;
hover.css("top",aTopFrom+"px").show();
if(grid.height()<h){grid.height(h+5);
}hover.animate({"top":(div.outerHeight()-hover.outerHeight()-2)},t[1]);
div.find(".ilv3").animate({"opacity":0},t[1]);
div.unbind("mousemove",mousemove3);
};
var mousemove3=function(e){if(eventId){clearTimeout(eventId);
}var div=$(e.target).closest("li.ilo3"),delay=$(e.target).is("span,a")?t[1]:t[0];
eventId=window.setTimeout(function(){hover3(div);
},delay);
};
var mouseleave3=function(e){if(eventId){clearTimeout(eventId);
}eventId=window.setTimeout(function(){resetLast();
},10);
var div=$(e.target).closest("li.ilo3");
div.unbind("mousemove",mousemove3);
};
var mouseenter3=function(e){if(eventId){clearTimeout(eventId);
}eventId=null;
var div=$(e.target).closest("li.ilo3");
if(div.length&&(!last||!last.is(div))){resetLast();
div.bind("mousemove",mousemove3);
}};
ilctx.timing=function(a,b,c,d){t=[a,b,c,d];
};
ilctx.hover3=function(){$("div.ilc3, .ild3").unbind("mouseenter",mouseenter3).unbind("mouseleave",mouseleave3).bind("mouseenter",mouseenter3).bind("mouseleave",mouseleave3);
var h=$(".ilt3:first").height()+5;
$("li.ilo3").each(function(i,li){var span=$(li).find(".ilt3 a span.lrg");
var txt=span.text(),spl=txt.split(" "),cnt=spl.length;
while(span.height()>h){if(cnt>5){spl=spl.slice(0,-1);
span.text(spl.join(" ")+"...");
}else{if(txt.length>4){txt=txt.substring(0,txt.length-4);
span.text(spl+"...");
}else{break;
}}}$(li).find(".ild3 .newaps span.lrg").text(span.text());
});
};
amzn.sx.utils.jsDepMgr.when("search-js-general","imageView.spATFEvent",function(){SPUtils.afterEvent("spATFEvent",function(){if(window.ilctx&&window.ilctx.page){ilctx.page.onresize();
}var params=($.requestContext?$.requestContext.currHash:window.location.href).split("&");
for(var i=0;
i<params.length;
i++){if(params[i].indexOf("lo=")==0){var elem=$("#loparam");
if(!elem.length){elem=$("<input type='hidden' id='loparam' name='lo'></input>").appendTo(document.forms["site-search"]);
}elem.val(params[i].substring(3));
return;
}}});
});
amzn.sx.utils.jsDepMgr.register("search-js-imageview");
});
/*!
 * hoverIntent r7 // 2013.03.11 // jQuery 1.9.1+
 * http://cherne.net/brian/resources/jquery.hoverIntent.html
 *
 * You may use hoverIntent under the terms of the MIT license. Basically that
 * means you are free to use hoverIntent as long as this header is left intact.
 * Copyright 2007, 2013 Brian Cherne
 */
amzn.sx.utils.jsDepMgr.when("jQuery","",function(jQuery){(function($){$.fn.hoverIntent=function(handlerIn,handlerOut,selector){var cfg={interval:100,sensitivity:7,timeout:200};
if(typeof handlerIn==="object"){cfg=$.extend(cfg,handlerIn);
}else{if($.isFunction(handlerOut)){cfg=$.extend(cfg,{over:handlerIn,out:handlerOut,selector:selector});
}else{cfg=$.extend(cfg,{over:handlerIn,out:handlerIn,selector:handlerOut});
}}var cX,cY,pX,pY;
var track=function(ev){cX=ev.pageX;
cY=ev.pageY;
};
var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);
if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove.hoverIntent",track);
ob.hoverIntent_s=1;
return cfg.over.apply(ob,[ev]);
}else{pX=cX;
pY=cY;
ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);
},cfg.interval);
}};
var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);
ob.hoverIntent_s=0;
return cfg.out.apply(ob,[ev]);
};
var handleHover=function(e){var ev=jQuery.extend({},e);
var ob=this;
if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);
}if(e.type=="mouseenter"){pX=ev.pageX;
pY=ev.pageY;
$(ob).bind("mousemove.hoverIntent",track);
if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);
},cfg.interval);
}}else{$(ob).unbind("mousemove.hoverIntent",track);
if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);
},cfg.timeout);
}}};
return this.delegate(cfg.selector,{"mouseenter.hoverIntent":handleHover,"mouseleave.hoverIntent":handleHover});
};
})(jQuery);
amzn.sx.utils.jsDepMgr.register("hoverIntent");
});
(function(){amzn.sx.utils.jsDepMgr.when("jQuery popover page-ajax page-utils","SeeAllPopup",function($){var CONSTANTS={SX_SEE_ALL_POPUP_ID:"#sxSeeAllPopup",LOADING_SPINNER_CLASS:".loadingSpinner",SEE_ALL_HEAD_ID:"#seeAllHead",SEE_ALL_INDEXBAR_ID:"#seeAllIndexBar",SEE_ALL_BODY_ID:"#seeAllBody",SEE_ALL_TITLE_ID:"#seeAllTitle",SEE_ALL_FOOTER_ID:"#seeAllFooter",DATA_SEE_ALL_BASELINK:"data-seeAllBaseLink",CLEAR_ALL_CLASS:".clearAll",SELECTED_REFINEMENT_CLASS:".selectedRefinement",DATA_RFID:"data-rfid",CONTAINER_BORDER_CLASS:"containerBorder",SEE_ALL_INDEX_ENABLED_CLASS:".seeAllIndexEnabled",SEE_ALL_INDEX_CUR_CLASS:".seeAllIndexCur",SEE_ALL_INDEX_CUR:"seeAllIndexCur",REFINEMENT_CONTAINER_CLASS:".refinementContainer",WHOLE_RFMNCONTAINER_ID:"#wholeRfmnContainer",SELECTED:"selected",SEE_ALL_SEARCH_BOX_ID:"#seeAllSearchBox",REFINEMENT_CLASS:".refinement",DATA_PINYIN:"data-pinyin",DATA_ID:"data-id",REFINEMENT_LINK_SELECTED_CLASS:".refinementLinkSelected",SEE_ALL_NODE_LABEL_CLASS:".seeAllNodeLabel",AP_CUSTOM_CLOSE_CLASS:".ap_custom_close",SEE_ALL_CONFIRM_BTN_ID:"#seeAllConfirmBtn",PLACEHOLDER:"placeHolder",DATA_NODE_ID:"data-nodeid",DATA_ERROR_TEXT:"data-errorText",MATCHED:"matched"};
var SeeAllPopup=function(rhId,nodeId,errorHintText,seeAllBaseLink){var popupContainer,popoverInstance,seeAllHead,seeAllBody,seeAllIndexBar,seeAllStatic,interactionManager,dataManager,pUtils=$.pageUtils;
var fillEmptyPopup=function(toUrl,popover){popupContainer=$(CONSTANTS.SX_SEE_ALL_POPUP_ID);
popoverInstance=popover;
PopupUtils.showLoadingIcon(popupContainer);
fetchData(toUrl,false);
},fetchData=function(toUrl,isIndexRequest){SeeAllAjaxHandler.fetchData(toUrl,isIndexRequest,showErrorText,updatePopupContent);
if(isIndexRequest){seeAllBody&&seeAllBody.preProcess();
}},showErrorText=function(toUrl){seeAllBody&&seeAllBody.showErrorText(toUrl,errorHintText);
},updatePopupContent=function(payload,loadingStatus,isIndexRequest){if(payload&&payload.data&&payload.data.value){if(isIndexRequest){seeAllBody.updateContent(payload.data.value);
seeAllBody.adjustHeight();
}else{popupContainer.find(CONSTANTS.LOADING_SPINNER_CLASS).remove();
popupContainer.append(payload.data.value);
}}if(loadingStatus==pUtils.ajaxReadyState.DONE){initPopup(isIndexRequest);
}},initPopup=function(isIndexRequest){if(!isIndexRequest){var data=getSelectedRefinementData();
dataManager=new DataManager();
dataManager.init(data);
seeAllHead=new SeeAllHeadSection($(CONSTANTS.SEE_ALL_HEAD_ID));
seeAllHead.addRefinements(data);
seeAllIndexBar=new SeeAllIndexBarSection($(CONSTANTS.SEE_ALL_INDEXBAR_ID),fetchData);
seeAllBody=new SeeAllBodySection($(CONSTANTS.SEE_ALL_BODY_ID),fetchData);
seeAllBody.setRefinementStatus(data.ids);
seeAllStatic=new SeeAllStaticSection($(CONSTANTS.SEE_ALL_TITLE_ID),$(CONSTANTS.SEE_ALL_FOOTER_ID),popoverInstance.close,dataManager.isSelectedIdsChanged);
interactionManager=new InteractionManager(seeAllHead,seeAllBody,dataManager);
popupContainer.attr(CONSTANTS.DATA_SEE_ALL_BASELINK,seeAllBaseLink);
}else{seeAllBody.init();
seeAllBody.setRefinementStatus(dataManager.getCurSelectedIds());
}},getSelectedRefinementData=function(){var ids=[],labels=[];
$("#ref_"+nodeId).find(CONSTANTS.REFINEMENT_LINK_SELECTED_CLASS).each(function(){labels.push($(this).html());
var id=$(this).attr(CONSTANTS.DATA_ID);
ids.push(id);
});
return{ids:ids,labels:labels};
},buildSeeAllRefinementURL=function(){var seeAllBaseLink=popupContainer.attr(CONSTANTS.DATA_SEE_ALL_BASELINK),decodedBaseRH=decodeURIComponent($.searchUtils.getRH(seeAllBaseLink)),refinementValues=dataManager.getCurSelectedIds().join("|"),newRH=encodeURIComponent(replaceRHParam(refinementValues,decodedBaseRH)),newURL=PopupUtils.addRhToURL(seeAllBaseLink,newRH);
updateSeeAllBaseLink(newURL);
return newURL;
},replaceRHParam=function(newRfParam,decodedRH){var result;
if(decodedRH.indexOf(rhId.concat(":"))==-1){result=decodedRH.concat(","+rhId+":").concat(newRfParam);
}else{var reg=new RegExp("(,".concat(rhId).concat(":)([^&,]*)"));
if(newRfParam){result=decodedRH.replace(reg,("$1").concat(newRfParam));
}else{result=decodedRH.replace(reg,"");
}}return result;
},updateSeeAllBaseLink=function(newSeeAllBaseLink){popupContainer.attr(CONSTANTS.DATA_SEE_ALL_BASELINK,newSeeAllBaseLink);
},focusOnPopupShown=function(){popupContainer.focus();
},tearDown=function(){seeAllBody.removeSearchBox();
};
this.fillEmptyPopup=fillEmptyPopup;
this.buildSeeAllRefinementURL=buildSeeAllRefinementURL;
this.focusOnPopupShown=focusOnPopupShown;
this.tearDown=tearDown;
},SeeAllHeadSection=function(headContainer){var clearAll=headContainer.find(CONSTANTS.CLEAR_ALL_CLASS),clickHandler;
var init=function(){headContainer.empty();
},bindHover=function(element){element.hover(function(){$(this).addClass("hover");
},function(){$(this).removeClass("hover");
});
},setHandler=function(handler){clickHandler=handler;
headContainer.find(CONSTANTS.SELECTED_REFINEMENT_CLASS).click(propagateSingleClick);
headContainer.find(CONSTANTS.CLEAR_ALL_CLASS).click(propagateClearAllHandler);
},propagateClearAllHandler=function(){clickHandler.clearAll();
},propagateSingleClick=function(){clickHandler.click({id:$(this).attr(CONSTANTS.DATA_RFID)},false);
};
statusChanged=function(data){var refinement=PopupUtils.filter(headContainer,"span","data-rfid",data.id);
if(refinement.length>0){removeRefinement(refinement);
}else{addRefinements({ids:[data.id],labels:[data.label]});
}},addRefinements=function(data){var ids=data.ids,labels=data.labels;
if(ids.length==0){return;
}if(withoutSelectedRefinements()&&ids.length>0){clickHandler&&clearAll.click(propagateClearAllHandler);
bindHover(clearAll);
headContainer.append(clearAll).addClass(CONSTANTS.CONTAINER_BORDER_CLASS);
}var fragment=document.createDocumentFragment();
for(var i=0;
i<ids.length;
i++){fragment.appendChild(createNewRefinement(ids[i],labels[i])[0]);
}headContainer.append(fragment);
},createNewRefinement=function(id,label){var newRefinement=refinementTemplate(id,label);
clickHandler&&newRefinement.click(propagateSingleClick);
return newRefinement;
},refinementTemplate=function(id,label){var iconElement=$('<span class="icon"><span class="srSprite srDelete" /></span>'),rfElement=$('<span class="selectedRefinement">'+label+"</span>");
rfElement.attr("data-rfid",id);
rfElement.append(iconElement);
return rfElement;
},removeRefinement=function(refinement){refinement.remove();
if(withoutSelectedRefinements()){clearAll.removeClass("hover");
headContainer.empty().removeClass(CONSTANTS.CONTAINER_BORDER_CLASS);
}},withoutSelectedRefinements=function(){return headContainer.find(CONSTANTS.SELECTED_REFINEMENT_CLASS).length==0;
},clearAllHandler=function(){clearAll.removeClass("hover");
headContainer.empty().removeClass(CONSTANTS.CONTAINER_BORDER_CLASS);
};
this.addRefinements=addRefinements;
this.setHandler=setHandler;
this.clearAllHandler=clearAllHandler;
this.statusChanged=statusChanged;
init();
},SeeAllIndexBarSection=function(indexBar,clickHandler){var bindClickOnIndex=function(){indexBar.find(CONSTANTS.SEE_ALL_INDEX_ENABLED_CLASS).each(function(){var hyperLink=$(this).children(":first"),url=hyperLink.attr("href");
hyperLink.click(function(){var parent=$(this).parent();
if(!parent.hasClass(CONSTANTS.SEE_ALL_INDEX_CUR)){modifyIndexBar(parent);
clickHandler(url,true);
}return false;
});
});
},modifyIndexBar=function(curIndex){indexBar.find(CONSTANTS.SEE_ALL_INDEX_CUR_CLASS).removeClass(CONSTANTS.SEE_ALL_INDEX_CUR);
curIndex.addClass(CONSTANTS.SEE_ALL_INDEX_CUR);
};
bindClickOnIndex();
};
SeeAllBodySection=function(bodyContainer,fetchData){var rfmnContainer,wholeRfmnContainer,searchBox,previousKeyword,dataCallback,clickHandler;
var init=function(){initSearchBox();
rfmnContainer=bodyContainer.find(CONSTANTS.REFINEMENT_CONTAINER_CLASS);
wholeRfmnContainer=$(CONSTANTS.WHOLE_RFMNCONTAINER_ID);
wholeRfmnContainer.empty();
PopupUtils.preventOuterElementScroll(rfmnContainer[0]);
adjustHeight();
},preProcess=function(){removeSearchBox();
PopupUtils.showLoadingIcon(bodyContainer.empty());
},updateContent=function(newContent){bodyContainer.find(CONSTANTS.LOADING_SPINNER_CLASS).remove();
bodyContainer.append(newContent);
};
setRefinementStatus=function(ids){bodyContainer.find(CONSTANTS.REFINEMENT_CLASS).each(function(){var refinement=$(this),id=refinement.attr(CONSTANTS.DATA_RFID);
if($.inArray(id,ids)!=-1){if(!refinement.hasClass(CONSTANTS.SELECTED)){refinement.addClass(CONSTANTS.SELECTED);
}}else{if(refinement.hasClass(CONSTANTS.SELECTED)){refinement.removeClass(CONSTANTS.SELECTED);
}}clickHandler&&$(this).unbind("click").click(propagateSingleClick);
});
},statusChanged=function(data){PopupUtils.filter(bodyContainer,"a","data-rfid",data.id).toggleClass(CONSTANTS.SELECTED);
},initSearchBox=function(){if($(CONSTANTS.SEE_ALL_SEARCH_BOX_ID).length>0){searchBox=new SearchBox($(CONSTANTS.SEE_ALL_SEARCH_BOX_ID),updateContainerContent);
}},updateContainerContent=function(keyword){if(previousKeyword==keyword||previousKeyword==undefined){previousKeyword=keyword;
return;
}if(!previousKeyword&&keyword){wholeRfmnContainer.empty().append(rfmnContainer.children());
}if(previousKeyword&&!keyword){rfmnContainer.empty().append(wholeRfmnContainer.children());
}else{var size=filterOutMatchedRefinements(keyword);
showMatchedRefinements(size);
}previousKeyword=keyword;
setRefinementStatus(dataCallback());
},filterOutMatchedRefinements=function(keyword){var labelElement,label,pinYinName,keyword=keyword.toLowerCase(),matchedRefinementSize=0;
wholeRfmnContainer.find(CONSTANTS.REFINEMENT_CLASS).each(function(){var refinement=$(this),rexp=new RegExp("(^|(?:\\s))"+PopupUtils.regExpEscape(keyword),"i");
label=refinement.find(CONSTANTS.SEE_ALL_NODE_LABEL_CLASS).html().toLowerCase();
pinYinName=refinement.attr(CONSTANTS.DATA_PINYIN);
pinYinName=pinYinName&&pinYinName.toLowerCase();
if((pinYinName&&pinYinName.match(rexp))||label.match(rexp)){refinement.addClass(CONSTANTS.MATCHED);
++matchedRefinementSize;
}});
return matchedRefinementSize;
},showMatchedRefinements=function(size){var NUM_COLUMNS=3,sizePerColumn=Math.ceil(size/NUM_COLUMNS),fragment=document.createDocumentFragment(),ulElement;
$.each(wholeRfmnContainer.find(".matched"),function(i,val){val=$(val);
val.removeClass(CONSTANTS.MATCHED);
if(i%sizePerColumn==0){if(i>0){fragment.appendChild(ulElement[0]);
}ulElement=$('<ul class="column" />');
}ulElement.append(val.parent().clone(true));
if(i==size-1){fragment.appendChild(ulElement[0]);
}});
rfmnContainer.empty().append(fragment);
},removeSearchBox=function(){if(searchBox){searchBox.tearDown();
searchBox=undefined;
previousKeyword=undefined;
}$(CONSTANTS.SEE_ALL_SEARCH_BOX_ID).remove();
},clearAllHandler=function(){rfmnContainer.find(CONSTANTS.REFINEMENT_CLASS).each(function(){$(this).removeClass(CONSTANTS.SELECTED);
});
},propagateSingleClick=function(){var refinement=$(this),id=refinement.attr(CONSTANTS.DATA_RFID),label=refinement.find(CONSTANTS.SEE_ALL_NODE_LABEL_CLASS).html();
clickHandler.click({id:id,label:label},!refinement.hasClass(CONSTANTS.SELECTED));
return false;
},showErrorText=function(toUrl,errorHintText){var errorText=errorTextTemplate(errorHintText);
errorText.click(function(){PopupUtils.showLoadingIcon(bodyContainer.empty());
fetchData(toUrl,true);
return false;
});
bodyContainer.empty().html(errorText);
},errorTextTemplate=function(errorHintText){return $('<span class="error">'+errorHintText+"</span>");
},setHandler=function(handler){clickHandler=handler;
bodyContainer.find(CONSTANTS.REFINEMENT_CLASS).unbind("click").click(propagateSingleClick);
},setDataCallback=function(callback){dataCallback=callback;
};
adjustHeight=function(){bodyContainer.height("auto").height(bodyContainer.height());
};
this.init=init;
this.setRefinementStatus=setRefinementStatus;
this.removeSearchBox=removeSearchBox;
this.clearAllHandler=clearAllHandler;
this.showErrorText=showErrorText;
this.setHandler=setHandler;
this.preProcess=preProcess;
this.statusChanged=statusChanged;
this.updateContent=updateContent;
this.setDataCallback=setDataCallback;
this.adjustHeight=adjustHeight;
init();
};
SeeAllStaticSection=function(title,footer,clickHandler,validFun){var init=function(){title.find(CONSTANTS.AP_CUSTOM_CLOSE_CLASS).click(clickHandler);
footer.find(CONSTANTS.SEE_ALL_CONFIRM_BTN_ID).click(confirmBtnHandler);
footer.find(CONSTANTS.AP_CUSTOM_CLOSE_CLASS).click(clickHandler);
},confirmBtnHandler=function(){if(validFun()&&changeSeeMoreRefinements){changeSeeMoreRefinements();
}};
init();
},DataManager=function(){var slRfmnIds=[],orgSlRfmnIds=[];
var init=function(data){slRfmnIds=data.ids.slice();
orgSlRfmnIds=data.ids.slice();
},changeSelectedId=function(data,selected){if(selected){slRfmnIds.push(data.id);
}else{var index=$.inArray(data.id,slRfmnIds);
slRfmnIds.splice(index,1);
}},clearAllSelectedIds=function(){slRfmnIds=[];
},getCurSelectedIds=function(){return slRfmnIds;
},isSelectedIdsChanged=function(){if(orgSlRfmnIds.length!=slRfmnIds.length){return true;
}return(orgSlRfmnIds.sort().toString()!=slRfmnIds.sort().toString());
};
this.changeSelectedId=changeSelectedId;
this.clearAllSelectedIds=clearAllSelectedIds;
this.isSelectedIdsChanged=isSelectedIdsChanged;
this.getCurSelectedIds=getCurSelectedIds;
this.init=init;
},InteractionManager=function(seeAllHead,seeAllBody,dataManager){var init=function(){seeAllHead.setHandler({click:clickHandler,clearAll:clearAllHandler});
seeAllBody.setHandler({click:clickHandler});
seeAllBody.setDataCallback(dataManager.getCurSelectedIds);
},clickHandler=function(data,selected){dataManager.changeSelectedId(data,selected);
seeAllHead.statusChanged(data);
seeAllBody.statusChanged(data);
},clearAllHandler=function(){dataManager.clearAllSelectedIds();
seeAllHead.clearAllHandler();
seeAllBody.clearAllHandler();
};
init();
},SeeAllAjaxHandler=new function(){var ajaxRequestNum=0,pUtils=$.pageUtils;
var fetchData=function(toUrl,isIndexRequest,errorCallback,successCallback){var ajaxUrl=toUrl.replace("search/other","search/ajax/seeall");
if(isIndexRequest&&ajaxUrl.indexOf("&section=SEE_ALL_BODY")==-1){ajaxUrl+="&section=SEE_ALL_BODY";
}$.pageAjax.loadStreaming(ajaxUrl,toUrl,false,createSuccessCallback(successCallback,isIndexRequest),createErrorCallback(toUrl,isIndexRequest,errorCallback),ajaxRequestNum++);
},createErrorCallback=function(toUrl,isIndexRequest,errorCallback){return function(callContext,data,appStatus){if(isIndexRequest){errorCallback(toUrl);
}else{location.href=toUrl;
}return{"handlerCode":pUtils.handlerCode.OK};
};
},createSuccessCallback=function(successCallback,isIndexRequest){return function(callContext,pagelet,loadingStatus){var payload;
if(!pagelet){return{"handlerCode":pUtils.handlerCode.IGNORE};
}payload=pagelet[pUtils.getKeys(pagelet)[0]];
successCallback(payload,loadingStatus,isIndexRequest);
return{"handlerCode":pUtils.handlerCode.OK};
};
};
this.fetchData=fetchData;
},SearchBox=function(sb,update){var ltrimre=/^\s+/,spaceNormRe=/\s+/g,timer;
var init=function(){sb.data(CONSTANTS.PLACEHOLDER,$.trim(sb.val()));
sb.focus(focusHandler).blur(blurHanlder);
},focusHandler=function(){if($.trim($(this).val())===sb.data(CONSTANTS.PLACEHOLDER)){$(this).removeClass("grey").val("");
}if(timer==undefined){timer=window.setInterval(function(){updateKeywrod();
},20);
}},blurHanlder=function(){if($.trim($(this).val())===""){$(this).addClass("grey").val(" "+$(this).data(CONSTANTS.PLACEHOLDER));
}clearInterval(timer);
timer=undefined;
},updateKeywrod=function(){var keyword=sb.val().replace(ltrimre,"").replace(spaceNormRe," ");
update(keyword);
},tearDown=function(){sb.parent().remove();
if(timer){clearInterval(timer);
}};
this.tearDown=tearDown;
init();
},PopupUtils=new function(){this.preventOuterElementScroll=function(target){if(!target){return;
}if($.browser.mozilla){target.addEventListener("DOMMouseScroll",function(e){target.scrollTop+=e.detail>0?60:-60;
e.preventDefault();
},false);
}else{target.onmousewheel=function(e){e=e||window.event;
target.scrollTop+=e.wheelDelta>0?-60:60;
e.returnValue=false;
};
}};
this.truncateUrlAfterRefTag=function(url){var from=url.lastIndexOf("/ref=");
if(from!=-1){return url.substr(from);
}else{var mask=url.indexOf("?");
return url.substr(mask);
}};
this.showLoadingIcon=function(parentElement){parentElement.html('<span class="loadingSpinner">');
};
this.addRhToURL=function(url,rh){rh=rh.replace(/%2B/g,"+");
if(url.indexOf("rh=")==-1){return url.replace("?","?rh=".concat(rh).concat("&"));
}return url.replace(/([?&=])(rh=)([^&]*)/,"$1$2".concat(rh));
};
this.regExpEscape=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");
};
this.filter=function(outsideContainer,selector,tagertProperty,targetValue){return outsideContainer.find(selector).filter(function(index){return $(this).attr(tagertProperty)===targetValue;
});
};
},SeeAllPopupHandler=new function(){var curPopup=undefined;
var popupSeeAllRefinements=function(){var link=$(this),seeMoreLink=link.attr("href"),id=link.attr(CONSTANTS.DATA_ID),nodeId=link.attr(CONSTANTS.DATA_NODE_ID),ajaxErrorTxt=link.attr(CONSTANTS.DATA_ERROR_TEXT),seeAllBaseLink=PopupUtils.truncateUrlAfterRefTag(document.location.href);
if(curPopup===undefined){curPopup=new SeeAllPopup(id,nodeId,ajaxErrorTxt,seeAllBaseLink);
}else{curPopup.focusOnPopupShown();
return;
}var isIE6=$.browser.msie&&$.browser.version=="6.0";
var popover=$.AmazonPopover.displayPopover({centered:true,width:870,locationOffset:[0,-40],cacheable:false,showCloseButton:false,modal:(isIE6?false:true),closeEventExclude:(isIE6?"":"CLICK_OUTSIDE"),literalContent:"<div id='sxSeeAllPopup' />",onHide:function(){curPopup.tearDown();
curPopup=undefined;
}});
curPopup.fillEmptyPopup(seeMoreLink,popover);
return false;
},getCurPopup=function(){return curPopup;
},setupSeeAllPopup=function(){$("#refinements .seeMorePopover").each(function(){$(this).unbind("click");
$(this).bind("click",popupSeeAllRefinements);
});
};
this.getCurPopup=getCurPopup;
this.setupSeeAllPopup=setupSeeAllPopup;
};
window.SeeAllPopupHandler=SeeAllPopupHandler;
amzn.sx.utils.jsDepMgr.register("SeeAllPopup");
});
}());
(function(){amzn.sx.utils.jsDepMgr.when("jQuery search-js-general","color-swatch-v2",function($){function ColorBlock(asin,dpUrl,imgUrl){this.asin=asin;
this.dpUrl=dpUrl;
this.imgUrl=imgUrl;
}function ColorSwatchesModel(asin){this.asin=asin;
this.colorBlocks=null;
this.mainProductImageUrl="";
this.mainProductDPUrl="";
}ColorSwatchesModel.prototype={setAsin:function(asin){this.asin=asin;
},setColorBlocks:function(colorBlocks){this.colorBlocks=colorBlocks;
},setMainProductImageUrl:function(mainProductImageUrl){this.mainProductImageUrl=mainProductImageUrl;
},setMainProductDPUrl:function(mainProductDPUrl){this.mainProductDPUrl=mainProductDPUrl;
}};
window.ColorSwatchesV2RotationUtil=(function(){var _utils={changeMainImage:function(asin,src){var colorSwatchContainer=$("#colorSwatchesContainer-"+asin),product=colorSwatchContainer.parent().parent(),productImageDiv=product.find("div.image"),productImage=productImageDiv.find(".productImage");
if(src&&productImage&&productImage.length>0){productImage.attr("src",src);
}},changeMainDPUrl:function(asin,src){var colorSwatchContainer=$("#colorSwatchesContainer-"+asin),product=colorSwatchContainer.parent().parent(),productImageDiv=product.find("div.image"),detailHyperlink=productImageDiv.find("a");
mainProduct=product.find(".newaps a");
moreLink=colorSwatchContainer.find(".moreLink");
if(src&&mainProduct&&mainProduct.length>0){mainProduct.attr("href",src);
detailHyperlink.attr("href",src);
moreLink.attr("href",src);
}},getMainProductImageUrl:function(colorSwatchContainer){var product=colorSwatchContainer.parent().parent(),productImageDiv=product.find("div.image"),productImageUrl=productImageDiv.find(".productImage").attr("src");
return productImageUrl;
},getMainProductDPUrl:function(colorSwatchContainer){var product=colorSwatchContainer.parent().parent(),mainProductDPUrl=product.find(".newaps a").attr("href");
return mainProductDPUrl;
}};
return _utils;
})();
function processColorSwatchV2(){initColorSwatchesV2RotationDisplay();
}window.processColorSwatchV2=processColorSwatchV2;
function initColorSwatchesV2RotationDisplay(){var $=jQuery,colorSwatchContainers=$("div.colorSwatchesContainer");
if(colorSwatchContainers&&colorSwatchContainers.length>0){if(window.colorSwatchesModel==null){window.colorSwatchesModels={};
}colorSwatchContainers.each(function(){var colorSwatchContainer=$(this);
if(colorSwatchContainer&&colorSwatchContainer.length>0){var colorBlockList=colorSwatchContainer.find(".colorBlocksList .colorBlock");
if(colorBlockList&&colorBlockList.length>0){var colorBlocks=[],asin=colorSwatchContainer.attr("data-asin");
var colorSwatchesModel=createColorSwatchesModel(asin);
colorSwatchesModel.setMainProductImageUrl(ColorSwatchesV2RotationUtil.getMainProductImageUrl(colorSwatchContainer));
colorSwatchesModel.setMainProductDPUrl(ColorSwatchesV2RotationUtil.getMainProductDPUrl(colorSwatchContainer));
colorBlockList.each(function(){var colorBlockDom=$(this);
var colorBlock=createColorBlock(colorBlockDom,asin);
if(colorBlock!=null){colorBlocks.push(colorBlock);
}});
colorSwatchesModel.setColorBlocks(colorBlocks);
}}});
}}function createColorBlock(colorBlockDom,mainAsin){var colorBlockAsin=colorBlockDom.attr("data-asin"),colorBlockImgUrl=colorBlockDom.attr("data-imgUrl"),colorBlockDPUrl=colorBlockDom.attr("data-dpUrl");
var colorBlockObj=null;
if(colorBlockAsin&&colorBlockAsin.length>0&&colorBlockDPUrl&&colorBlockDPUrl.length>0&&colorBlockImgUrl&&colorBlockImgUrl.length>0){colorBlockObj=new ColorBlock(colorBlockAsin,colorBlockDPUrl,colorBlockImgUrl);
initColorBlock(colorBlockObj,mainAsin);
}return colorBlockObj;
}function initColorBlock(colorBlock,mainAsin){var variationAsin=colorBlock.asin,colorBlockDom=$("#colorBlock-"+variationAsin);
colorBlockDom.bind("click",function(){ColorSwatchesV2RotationUtil.changeMainDPUrl(mainAsin,colorBlock.dpUrl);
ColorSwatchesV2RotationUtil.changeMainImage(mainAsin,colorBlock.imgUrl);
});
}function createColorSwatchesModel(asin){if(!window.colorSwatchesModels[asin]){var colorSwatchesModel=new ColorSwatchesModel(asin);
window.colorSwatchesModels[asin]=colorSwatchesModel;
return colorSwatchesModel;
}return window.colorSwatchesModels[asin];
}amzn.sx.utils.jsDepMgr.register("color-swatch-v2");
});
}());
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery search-general-globals-factory","breadcrumb",function($,globalsFactory){function encodeKeywordsForRH(kw){kw=encodeURIComponent(kw).replace(/%2C/g,"\\c");
return kw;
}function buildNormalizedURL(kw,divsl,reftag){var url=$(divsl).attr("data-normalizedURL");
if(kw){url=url.replace("rh=","rh=k%3A"+encodeKeywordsForRH(kw)+"%2C")+"&keyword="+encodeURIComponent(kw);
}url=url.replace(/ref=.*\?/g,"ref="+reftag+"?");
return url.replace(/%20/g,"+");
}function normalizedURL(kw){return buildNormalizedURL(kw,"#bcEdit","sr_hi_eb");
}function editableBreadcrumb(){var bcNewKw=$("#bcNewKw:text");
if(bcNewKw.length<=0){return;
}var bcKw=$(".bcKw"),bcRemoveKwButton=$("#bcRemoveKwButton"),bcKwText=$("#bcKwText"),bcNonEdit=$("#bcNonEdit"),bcCancel=$("#bcCancelEdit"),bcGo=$("#bcGoButton");
function editKeyword(kw){document.location=normalizedURL(kw);
}function removeKeyword(){document.location=normalizedURL();
}function getKeywordsDisplay(str){return str.replace(/\+/g," ").replace(/\\c/g,",");
}function checkEditability(){var newKw=$.trim(bcNewKw.val());
if(newKw&&newKw!=""&&getKeywordFromRH()!=newKw){editKeyword(newKw);
}else{if(!newKw||newKw==""){removeKeyword();
}else{bcKw.toggle();
}}}function getKeywordFromRH(){var rh;
if($("#refinements").length>0){rh=$("#refinements").attr("data-baserh");
}var entries=decodeURIComponent(rh).split(",");
if(entries.length){for(var i=0;
i<entries.length;
i++){var entry=entries[i].split(":");
if(entry.length>=2&&entry.shift()=="k"){return getKeywordsDisplay(entry.join(":"));
}}}}bcKwText.unbind("click").click(function(){bcKw.toggle();
if(bcKwText.text()){bcNewKw.val(bcKwText.text().substring(1,bcKwText.text().length-1));
}bcNewKw.focus();
return false;
});
bcRemoveKwButton.hide();
bcNonEdit.unbind("hover").hover(function(){bcNonEdit.removeClass("bcLotPadding").addClass("bcLittlePadding");
bcRemoveKwButton.show();
},function(){bcRemoveKwButton.hide();
if(bcNonEdit.is(":visible")){bcNonEdit.removeClass("bcLittlePadding").addClass("bcLotPadding");
}});
bcRemoveKwButton.unbind("click").click(function(){removeKeyword();
return false;
});
bcCancel.unbind("click").click(function(){bcKw.toggle();
bcNonEdit.removeClass("bcLittlePadding").addClass("bcLotPadding");
return false;
});
bcGo.unbind("click").click(function(){checkEditability();
return false;
});
bcNewKw.unbind("keypress").keypress(function(event){if(event.which=="13"){checkEditability();
return false;
}});
}function normalizedURLSearch(kw){return buildNormalizedURL(kw,"#bcsEdit","sr_hi_ebs");
}function breadcrumbSearch(){var bcsSearchKw=$("#bcsNewKw:text");
if(bcsSearchKw.length<=0){return;
}var bcsCancelEdit=$("#bcsCancelEdit"),bcsGoButton=$("#bcsGoButton"),msg=$("#bcNewKwReminder").val();
if("bcsNewKw"==$(document.activeElement).attr("id")){bcsSearchKw.css("color","#000000");
bcsCancelEdit.show();
}else{bcsSearchKw.val(msg);
}function addKeyword(kw){document.location=normalizedURLSearch(kw);
}function submitSearch(){var kw=$.trim(bcsSearchKw.val());
if(kw&&kw!=""&&kw!=msg){addKeyword(kw);
}}bcsSearchKw.addClass("bcNewKwNoInput").focus(function(){if(msg==bcsSearchKw.val()){bcsSearchKw.val("").removeClass("bcNewKwNoInput");
}bcsCancelEdit.show();
}).unbind("keypress").keypress(function(event){if(event.which=="13"){submitSearch();
return false;
}});
bcsCancelEdit.unbind("click").click(function(){bcsSearchKw.val(msg).addClass("bcNewKwNoInput");
bcsCancelEdit.hide();
});
bcsGoButton.unbind("click").click(function(){submitSearch();
return false;
});
}var publicApis={"normalizedURL":normalizedURL,"editableBreadcrumb":editableBreadcrumb,"normalizedURLSearch":normalizedURLSearch,"breadcrumbSearch":breadcrumbSearch};
globalsFactory.registerToWindow(publicApis);
jsDepMgr.register("breadcrumb",function(){return publicApis;
});
});
}());
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery search-general-globals-factory searchUE","clickToViewLogger",function($,globalsFactory){function isInViewPort(el){if(typeof el.getBoundingClientRect=="function"){var rect=el.getBoundingClientRect();
return(rect.top>=0&&rect.left>=0&&rect.bottom<=window.innerHeight&&rect.right<=window.innerWidth);
}else{var top=el.offsetTop;
var left=el.offsetLeft;
var width=el.offsetWidth;
var height=el.offsetHeight;
while(el.offsetParent){el=el.offsetParent;
top+=el.offsetTop;
left+=el.offsetLeft;
}return(top<(window.pageYOffset+window.innerHeight)&&left<(window.pageXOffset+window.innerWidth)&&(top+height)>window.pageYOffset&&(left+width)>window.pageXOffset);
}}function ClickToViewCompleteLogger(shouldSendImageCount){this.loggerLoadScopeName="clickToVCLoggerLoad";
this.loggerScopeName="clickToVCLogger";
this.imageScopeBaseName="clickToImage";
this.imageLoadTimes=[];
this.shouldInstrumentImages=false;
this.shouldSendImageCount=(shouldSendImageCount==="true");
this.imageInstrumentThreshold=0.001;
}ClickToViewCompleteLogger.prototype.imageLoaded=function(element,loadTime,resultsCount,shouldUseCSMScopes){var img=$(element),lastImageLoadTime,length,i;
if(this.imageLoadTimes.length==0){uet("bb",this.loggerLoadScopeName,{wb:1});
uex("ld",this.loggerLoadScopeName,{wb:1});
uet("bb",this.loggerScopeName,{wb:1});
this.shouldInstrumentImages=(Math.random()<=this.imageInstrumentThreshold);
}if(img.length===1&&img.hasClass("cfMarker")){this.imageLoadTimes.push({image:element,time:loadTime});
if(this.shouldInstrumentImages){var imageScope=this.imageScopeBaseName+this.imageLoadTimes.length;
uex("ld",imageScope,{wb:1});
}}if(this.imageLoadTimes.length==resultsCount){uet("cf",this.loggerScopeName,{wb:1});
lastImageLoadTime=-1;
length=this.imageLoadTimes.length;
var viewImageCount=0;
for(i=0;
i<length;
i++){var loadTime=this.imageLoadTimes[i];
if(isInViewPort(loadTime.image)){viewImageCount++;
if(typeof loadTime=="object"&&(loadTime.time>lastImageLoadTime)){lastImageLoadTime=loadTime.time;
}}}if(lastImageLoadTime>0){this.logViewCompleteCFMarker(lastImageLoadTime,shouldUseCSMScopes);
}else{this.logViewCompleteCFMarker(new Date(),shouldUseCSMScopes);
}this.logViewImagecount(viewImageCount,shouldUseCSMScopes);
this.clearViewCompleteImageLoadTimes();
uet("be",this.loggerScopeName,{wb:1});
uex("ld",this.loggerScopeName,{wb:1});
}};
ClickToViewCompleteLogger.prototype.iL=ClickToViewCompleteLogger.prototype.imageLoaded;
ClickToViewCompleteLogger.prototype.logViewCompleteCFMarker=function(lastImageLoadTime,shouldUseCSMScopes){if(typeof uet=="function"){var u=$.searchUE;
if(shouldUseCSMScopes&&u){ues("ctb",u.getScope(),"1");
uet("cf",u.getScope(),undefined,lastImageLoadTime);
}else{uet("cf",undefined,undefined,lastImageLoadTime);
}if(u){u.manageLoad();
}}};
ClickToViewCompleteLogger.prototype.logViewImagecount=function(viewImageCount,shouldUseCSMScopes){if(ue&&ue.count){var u=$.searchUE;
if(shouldUseCSMScopes&&u){ue.count("cfImageCount",viewImageCount,{scope:u.getScope()});
}else{ue.count("cfImageCount",viewImageCount);
}}if(this.shouldSendImageCount===true){this.sendUserData(viewImageCount);
}};
ClickToViewCompleteLogger.prototype.sendUserData=function(viewImageCount){var sessionidvalue,atf=$("#atfResults");
var sessionidname="session-id=";
if(document.cookie!=null){var ca=document.cookie.split(";");
for(var i=0;
i<ca.length;
i++){var c=$.trim(ca[i]);
if(c.indexOf(sessionidname)==0){sessionidvalue=c.substring(sessionidname.length);
}if(sessionidvalue!=null){break;
}}if(sessionidvalue!=null&&viewImageCount!=null){if(atf.is(".list, .grid")){var atfCount=atf.children("[id*='result_']").length;
var layout="list",columns=1;
if(atf.hasClass("grid")){layout="grid";
columns=atf.hasClass("cols4")?4:3;
}var url="/mn/search/latency?"+"sid="+sessionidvalue+"&ic="+viewImageCount+"&atf="+atfCount+"&lk="+layout+"&nc="+columns;
new Image().src=url;
}}}};
ClickToViewCompleteLogger.prototype.clearViewCompleteImageLoadTimes=function(){this.imageLoadTimes=[];
};
var publicFunctions={"ClickToViewCompleteLogger":ClickToViewCompleteLogger};
globalsFactory.registerToWindow(publicFunctions);
jsDepMgr.register("clickToViewLogger",function(){return publicFunctions;
});
});
}());
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery search-page-utilities","searchPageAccess",function($,searchPageUtils){var SearchPageAccessDef=function(jQuery){var $=jQuery,atf="atf",btf="btf",nameAttrs=["name","data-asin"],idAttr="id",resultSelector='[id^="result_"]',atfResultsSelector="#center "+resultSelector,btfResultsSelector="#centerBelow "+resultSelector,hybResultsSelector="#mainResults "+resultSelector,imageSelector=["div.image",".s-access-image"],titleSelector=["h3.newaps","h3.title",".s-access-title"],dpLinkSelector=["h3.newaps > a","h3.title > a",".s-access-detail-page"],selectorsDetermined=false,resultCountSelector="#resultCount > span";
function makeResultsSelector(section,suffix){var i,selector="",sep=", ";
if(suffix&&(typeof suffix!=typeof"")){for(i=0;
i<suffix.length;
i++){var term=makeResultsSelector(section,suffix[i]);
if(term!==""){if(selector.length){selector+=sep;
}selector+=term;
}}return selector;
}if(!selectorsDetermined){if(document.getElementById("centerPlus")){atfResultsSelector="#centerPlus "+resultSelector+", "+"#centerMinus "+resultSelector;
btfResultsSelector="#centerBelowPlus "+resultSelector;
}selectorsDetermined=true;
}selector=suffix?(hybResultsSelector+" "+suffix):hybResultsSelector;
if(section==atf||!section){selector+=sep+atfResultsSelector;
if(suffix){selector+=" "+suffix;
}}if(section==btf||!section){selector+=sep+btfResultsSelector;
if(suffix){selector+=" "+suffix;
}}return selector;
}function makeDecendantSelector(selector){if(typeof selector==typeof""){return selector;
}var i,cmb="";
for(i=0;
i<selector.length;
i++){cmb+=selector[i]+", ";
}return cmb;
}function ancestor(elem,selector){var elem=$(elem);
while(elem.size()&&!elem.is(selector)){elem=elem.parent();
}return elem.size()?elem:undefined;
}function asinResults(section){return $(makeResultsSelector(section));
}function getAsin(asinResult){var i=nameAttrs.length-1,name=null,$elem=$(asinResult);
while(i>=0&&!name){name=$elem.attr(nameAttrs[i]);
i--;
}return name?name:undefined;
}function asinList(section){var list=[];
asinResults(section).each(function(){list.push(getAsin($(this)));
});
return list;
}function asinImages(section){var $images=$(makeResultsSelector(section,imageSelector));
if($images.is("img")){$images=$images.closest("div");
}return $images;
}function asinImagesATF(){return asinImages(atf);
}function asinImagesBTF(){return asinImages(btf);
}function asinTitles(section){return $(makeResultsSelector(section,titleSelector));
}function asinResult(elem){return ancestor(elem,resultSelector);
}function asinImage(elem){var asinResult=ancestor(elem,resultSelector),$image=asinResult?asinResult.find(makeDecendantSelector(imageSelector)):undefined;
if($image&&$image.is("img")){$image=$image.closest("div");
}return $image;
}function asinTitle(elem){var asinResult=ancestor(elem,resultSelector);
return asinResult?asinResult.find(makeDecendantSelector(titleSelector)):undefined;
}function asin(elem){var asinResult=ancestor(elem,resultSelector);
return getAsin(asinResult);
}function asinDpLinks(section){return $(makeResultsSelector(section,dpLinkSelector));
}function asinIndex(elem){var asinResult=ancestor(elem,resultSelector);
return asinResult?parseInt(asinResult.attr(idAttr).substr(7)):-1;
}function searchAlias(){return $.pageContext?$.pageContext.searchAlias:"";
}function searchAliasDisplayName(){return $.pageContext?$.pageContext.searchAliasDisplayName:"";
}function totalResultCount(){var html=jQuery(resultCountSelector).html(),numbers=html?html.match(/([\d,\.]+)/g):[],maxNum=-1,value,i;
for(i=0;
i<numbers.length;
i++){value=parseInt(numbers[i].replace(/[,\.]/g,""));
if(value>maxNum){maxNum=value;
}}return maxNum;
}return{asinImagesBTF:asinImagesBTF,asinImagesATF:asinImagesATF,asinResults:asinResults,asinImages:asinImages,asinTitles:asinTitles,asinResult:asinResult,asinImage:asinImage,asinTitle:asinTitle,asin:asin,asinList:asinList,asinDpLinks:asinDpLinks,asinIndex:asinIndex,searchAlias:searchAlias,searchAliasDisplayName:searchAliasDisplayName,asinDisplayIndex:asinIndex,totalResultCount:totalResultCount};
};
var spaInstance=new SearchPageAccessDef($);
jsDepMgr.register("search-page-access",function(){return spaInstance;
});
window.SearchPageAccess=spaInstance;
});
}());
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery search-general-globals-factory search-page-access","imageRotation",function($,globalsFactory,searchPageAccess){var maxRotations=10,eligileImageRotations={};
function updateImageRotation(asin,enableStatus){eligileImageRotations[asin]=enableStatus;
}function searchImageRotation(imageBlock,mainUrl,altImages,section,asin){var ALT_DELAY_TIME=1350,ALT_INITIAL_DELAY_TIME=400,ALT_FADE_TIME=300,alt1=null,alt2=null,timeout=null,animating_element=null,sawNumRotations=0;
var rotate=function(img_element,new_img_element,image,delay){if(delay===undefined){delay=ALT_INITIAL_DELAY_TIME;
}var newMainUrl=imageBlock.find(".productImage").attr("src");
if(sawNumRotations>=maxRotations||!eligileImageRotations[asin]||mainUrl!=newMainUrl){stopRotation();
return;
}img_element.removeClass("over");
new_img_element.addClass("over").attr("src",image.src).css("opacity",0);
timeout=window.setTimeout(function(){timeout=null;
animating_element=new_img_element.show();
sawNumRotations++;
new_img_element.animate({opacity:1},{duration:ALT_FADE_TIME,complete:function(){animating_element=null;
rotate(new_img_element,img_element.hide(),image.nextImg,ALT_DELAY_TIME);
}});
},delay);
};
var buildImageCycle=function(mainImage,altImages){if(!altImages||altImages.length===0){return null;
}var firstImage={src:mainImage};
var images=firstImage;
var current;
for(var i=altImages.length-1;
i>=0;
--i){images={src:altImages[i],nextImg:images};
}firstImage.nextImg=images;
return images;
};
var stopRotation=function(){if(sawNumRotations>0){sawNumRotations=0;
ClogImageRotation.LogCount("sawRotationCount");
ClogImageRotation.LogCount(""+section+"RotationCount");
}if(timeout){window.clearTimeout(timeout);
timeout=null;
}else{if(animating_element){animating_element.stop(true);
}}alt1.add(alt2).fadeOut(ALT_FADE_TIME);
};
var setupImageRotation=function(imageBlock,mainUrl,altImages){var images=buildImageCycle(mainUrl,altImages);
if(images){alt1=$('<img class="altImage"/>');
alt2=$('<img class="altImage"/>');
imageBlock.children("img.altImage").remove();
imageBlock.append(alt1,alt2);
var eventIn="mouseenter";
var eventOut="mouseleave";
imageBlock.bind(eventIn,function(){rotate(alt1,alt2,images);
}).bind(eventOut,function(){stopRotation();
});
}};
setupImageRotation(imageBlock,mainUrl,altImages);
eligileImageRotations[asin]=true;
}function setupImageRotation(section){var sectionUrls=window.srImageUrls&&window.srImageUrls[section];
if(!sectionUrls||$("#searchTemplate div#results-atf-image-rotation").size()===0){return;
}var elements=searchPageAccess["asinImages"+section.toUpperCase(section)]();
if(elements.length===0){return;
}elements.each(function(index){var $this=$(this);
var asin=searchPageAccess.asin($this);
var hoverElement=$this.children("a");
var currentUrls=(sectionUrls&&sectionUrls[asin]);
if(currentUrls&&!hoverElement.children("img").hasClass("placeholder")){searchImageRotation(hoverElement,currentUrls["mainUrl"],currentUrls["altUrl"],section,asin);
}});
}function SetupClogImageRotation(){this.usageData={};
this.initialize=function(){this.usageData["sawRotationCount"]=0;
this.usageData["atfRotationCount"]=0;
this.usageData["btfRotationCount"]=0;
};
this.LogCount=function(key){this.usageData[key]++;
};
this.initialize();
}window.ClogImageRotation=new SetupClogImageRotation();
$(document).bind("ph",function(){if(typeof window.srImageUrls!="undefined"&&typeof window.ClogImageRotation!="undefined"&&window.foresterVip){var protocol=location.protocol=="https:"?"https://":"http://",url=protocol+foresterVip+"/1/softlines/1/OP/imagerotation?"+$.param(ClogImageRotation.usageData);
(new Image()).src=url;
ClogImageRotation.initialize();
}});
var publicFunctions={"updateImageRotation":updateImageRotation,"SearchImageRotation":searchImageRotation,"setupImageRotation":setupImageRotation};
globalsFactory.registerToWindow(publicFunctions);
jsDepMgr.register("ImageRotation",function(){return publicFunctions;
});
});
}());
(function(){amzn.sx.utils.jsDepMgr.when("A jQuery search-ajax","address-selector",function(A,$){var addressPlaceHolder="address_place_holder";
function processRefreshAfterChangeAddress(url){A.off("DeliveryAddressDropdown_OnSembuUpdateSuccess");
A.on("DeliveryAddressDropdown_OnSembuUpdateSuccess",function(address){var newurl=url,addr=address.state+address.city+address.district;
newUrl=url.replace(addressPlaceHolder,addr).replace(/&amp;/g,"&");
changeAddressSelector(newUrl);
});
A.off("DeliveryAddressDropdown_OnSembuUpdateFail");
A.on("DeliveryAddressDropdown_OnSembuUpdateFail",function(address){window.location.reload(false);
});
}window.processRefreshAfterChangeAddress=processRefreshAfterChangeAddress;
amzn.sx.utils.jsDepMgr.register("address-selector");
});
}());
(function(){var jsDepMgr=amzn.sx.utils.jsDepMgr;
jsDepMgr.when("jQuery ph search-ajax","ag-country-selector",function($,ph){var globalCountryPlaceHolder="ag_country_ph";
function processRefreshAfterChangeCountry(url,countryCode){var newurl=url;
newUrl=url.replace(globalCountryPlaceHolder,countryCode).replace(/&amp;/g,"&");
ph.advance(newUrl.replace(/^\/gp\/search|\/s/,""));
}window.processRefreshAfterChangeCountry=processRefreshAfterChangeCountry;
amzn.sx.utils.jsDepMgr.register("ag-country-selector");
});
jsDepMgr.when("jQuery ph ag-country-selector-init","ag-country-popover",function($,ph){$Nav.when("jQuery","nav.createTooltip").run(function($,createTooltip){var agHiddenPopoverDiv=$("#globalShippingHiddenPopover").html(),popupIdx=0,name="sx-countryselector-popup-"+ue.rid+"-"+popupIdx,popup=createTooltip({name:name,content:agHiddenPopoverDiv.trim().replace(/(\r\n|\n|\r)/gm,""),arrow:"top",align:{base:"#agRefinementsDiv",from:"bottom left",to:"top left"},className:"sx-countryselector-popup"});
popup.fadeIn(400);
$("#sx-countryselector-popup-close-icon").click(function(){popup.fadeOut(400);
});
setTimeout(function(){popup.fadeOut(400);
},20*1000);
$("#ag-popover-clear-link").click(function(event){var url=$("#ag-popover-clear-link").attr("href");
popup.hide();
ph.advance(url.replace(/^\/gp\/search|\/s/,""));
event.preventDefault();
event.stopPropagation();
});
popupIdx++;
});
});
}());
