if(!window.$SearchJS&&window.$Nav){window.$SearchJS=$Nav.make("sx");
}if(window.$SearchJS){$SearchJS.importEvent("jQuery",{as:"$",global:"jQuery"});
$SearchJS.importEvent("jQuery",{global:"jQuery"});
$SearchJS.when("jQuery").run("searchCSL-lib",function($){$.searchCSL=$.searchCSL||new function(){var self=this,ctw=[],amb=[],pageType,rid,ridCtwDedup,txTimer,txTimerInterval=200,beforeUnloadSunk;
self.init=function(_pageType,_rid,_txTimerInterval){if(!_pageType||!_rid){return;
}if(pageType){return;
}pageType=_pageType;
self.updateRid(_rid);
if(_txTimerInterval){txTimerInterval=_txTimerInterval;
}};
self.updateRid=function(_rid){if(!_rid){return;
}if(rid==_rid){return;
}self.tx();
rid=_rid;
ridCtwDedup={};
};
self.addWlt=function(wl){if(!wl){return;
}if(wl.call){wl=wl();
if(!wl){return;
}}if(ridCtwDedup[wl]){return;
}ctw.push(wl);
ridCtwDedup[wl]=1;
self.scheduleTx();
};
self.addAmabotPrerendered=function(a){if(!a||!a.rid||!a.selections||!a.selections.length){return;
}amb.push(a);
self.scheduleTx();
};
self.scheduleTx=function(){if(txTimerInterval==0){self.tx();
return;
}if(!beforeUnloadSunk){var prevHandler=window.onbeforeunload;
window.onbeforeunload=function(e){if(txTimer){window.clearInterval(txTimer);
txTimer=undefined;
}self.tx();
beforeUnloadSunk=false;
return(prevHandler&&prevHandler.call)?prevHandler(e):undefined;
};
beforeUnloadSunk=true;
}if(!txTimer&&txTimerInterval>0){txTimer=window.setTimeout(function(){txTimer=undefined;
self.tx();
},txTimerInterval);
}};
self.tx=function(){if(!ctw.length&&!amb.length){return;
}var url="/mn/search/csl?";
if(ctw.length){url+="rrid="+rid+"&cpt="+pageType+"&ctw="+ctw.join("|");
ctw=[];
}if(amb.length){var arg="";
$.each(amb,function(i,e){arg+=e.rid+":";
$.each(e.selections,function(ii,selId){if(!selId){return;
}arg+=selId+((ii!=(e.selections.length-1))?",":"");
});
arg+=((i!=amb.length-1)?".":"");
});
amb=[];
if(arg){url+=(url.charAt(url.length-1)=="?")?"":"&";
url+="amabotSelections="+arg;
}}new Image().src=url;
};
};
$SearchJS.publish("search-csl",$.searchCSL);
});
}