!function(){var e={Cookie:{set:function(e,t,a,i,s){var n="";if(a&&"number"==typeof a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3),n="; expires="+r.toGMTString()}var i=i||"/",s=s||".youku.com";document.cookie=[e,"=",t,n,";domain=",s,";path=",i].join("")},get:function(e){for(var t=e+"=",a=document.cookie?document.cookie.split("; "):[],i=0;i<a.length;i++){for(var s=a[i];" "==s.charAt(0);)s=s.substring(1,s.length);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return null},remove:function(e){this.set(e,"",-1)}},Common:{shichang:function(e){return 30*e*e-20*e},decodeBase64:function(e){if(!e)return"";var t,a,i,s,n,r,o,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do s=c.indexOf(e.charAt(d++)),n=c.indexOf(e.charAt(d++)),r=c.indexOf(e.charAt(d++)),o=c.indexOf(e.charAt(d++)),t=s<<2|n>>4,a=(15&n)<<4|r>>2,i=(3&r)<<6|o,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(a)),64!=o&&(l+=String.fromCharCode(i));while(d<e.length);return this.utf8To16(l)},utf8To16:function(e){var t,a,i,s,n,r=[];for(a=e.length,t=0;a>t;)switch(i=e.charCodeAt(t++),i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(e.charAt(t-1));break;case 12:case 13:s=e.charCodeAt(t++),r.push(String.fromCharCode((31&i)<<6|63&s));break;case 14:s=e.charCodeAt(t++),n=e.charCodeAt(t++),r.push(String.fromCharCode((15&i)<<12|(63&s)<<6|(63&n)<<0))}return r.join("")},cutStr:function(e,t,i){var e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),s=this._strLen(e);if(t>=s)return e;var n=0,r=0;str_cut=new String,r=e.length;for(var o=0;r>o;o++){if(n++,a=e.charAt(o),escape(a).length>4&&n++,n>t)return i&&(str_cut=str_cut.concat(i)),str_cut;str_cut=str_cut.concat(a)}},_strLen:function(e){if(!e)return 0;var t=0,i=0;i=e.length;for(var s=0;i>s;s++)t++,a=e.charAt(s),escape(a).length>4&&t++;return t},serialize:function(e){return JSON.stringify(e)},deserialize:function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},getBrowser:function(){var e,t={},a=navigator.userAgent.toLowerCase();return(e=a.match(/rv:([\d.]+)\) like gecko/))?t.ie=e[1]:(e=a.match(/msie ([\d.]+)/))?t.ie=e[1]:(e=a.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=a.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=a.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=a.match(/version\/([\d.]+).*safari/))?t.safari=e[1]:0,t},bind:function(e,t,a){e.attachEvent?e.attachEvent("on"+t,function(){return function(t){window.event.cancelBubble=!0,e.attachEvent=[a.apply(e)]}}(e),!1):e.addEventListener&&e.addEventListener(t,function(e){e.stopPropagation(),a.apply(this)},!1)},Md5:function(e){var t,a,i,s,n,r,o,c,l,d=function(e,t){return e<<t|e>>>32-t},u=function(e,t){var a,i,s,n,r;return s=2147483648&e,n=2147483648&t,a=1073741824&e,i=1073741824&t,r=(1073741823&e)+(1073741823&t),a&i?2147483648^r^s^n:a|i?1073741824&r?3221225472^r^s^n:1073741824^r^s^n:r^s^n},p=function(e,t,a){return e&t|~e&a},h=function(e,t,a){return e&a|t&~a},v=function(e,t,a){return e^t^a},g=function(e,t,a){return t^(e|~a)},m=function(e,t,a,i,s,n,r){return e=u(e,u(u(p(t,a,i),s),r)),u(d(e,n),t)},_=function(e,t,a,i,s,n,r){return e=u(e,u(u(h(t,a,i),s),r)),u(d(e,n),t)},f=function(e,t,a,i,s,n,r){return e=u(e,u(u(v(t,a,i),s),r)),u(d(e,n),t)},y=function(e,t,a,i,s,n,r){return e=u(e,u(u(g(t,a,i),s),r)),u(d(e,n),t)},k=function(e){for(var t,a=e.length,i=a+8,s=(i-i%64)/64,n=16*(s+1),r=Array(n-1),o=0,c=0;a>c;)t=(c-c%4)/4,o=c%4*8,r[t]=r[t]|e.charCodeAt(c)<<o,c++;return t=(c-c%4)/4,o=c%4*8,r[t]=r[t]|128<<o,r[n-2]=a<<3,r[n-1]=a>>>29,r},b=function(e){var t,a,i="",s="";for(a=0;3>=a;a++)t=e>>>8*a&255,s="0"+t.toString(16),i+=s.substr(s.length-2,2);return i},C=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",a=0;a<e.length;a++){var i=e.charCodeAt(a);128>i?t+=String.fromCharCode(i):i>127&&2048>i?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},w=Array(),A=7,U=12,I=17,N=22,M=5,T=9,x=14,S=20,D=4,E=11,j=16,H=23,q=6,L=10,z=15,O=21;for(e=C(e),w=k(e),r=1732584193,o=4023233417,c=2562383102,l=271733878,t=0;t<w.length;t+=16)a=r,i=o,s=c,n=l,r=m(r,o,c,l,w[t+0],A,3614090360),l=m(l,r,o,c,w[t+1],U,3905402710),c=m(c,l,r,o,w[t+2],I,606105819),o=m(o,c,l,r,w[t+3],N,3250441966),r=m(r,o,c,l,w[t+4],A,4118548399),l=m(l,r,o,c,w[t+5],U,1200080426),c=m(c,l,r,o,w[t+6],I,2821735955),o=m(o,c,l,r,w[t+7],N,4249261313),r=m(r,o,c,l,w[t+8],A,1770035416),l=m(l,r,o,c,w[t+9],U,2336552879),c=m(c,l,r,o,w[t+10],I,4294925233),o=m(o,c,l,r,w[t+11],N,2304563134),r=m(r,o,c,l,w[t+12],A,1804603682),l=m(l,r,o,c,w[t+13],U,4254626195),c=m(c,l,r,o,w[t+14],I,2792965006),o=m(o,c,l,r,w[t+15],N,1236535329),r=_(r,o,c,l,w[t+1],M,4129170786),l=_(l,r,o,c,w[t+6],T,3225465664),c=_(c,l,r,o,w[t+11],x,643717713),o=_(o,c,l,r,w[t+0],S,3921069994),r=_(r,o,c,l,w[t+5],M,3593408605),l=_(l,r,o,c,w[t+10],T,38016083),c=_(c,l,r,o,w[t+15],x,3634488961),o=_(o,c,l,r,w[t+4],S,3889429448),r=_(r,o,c,l,w[t+9],M,568446438),l=_(l,r,o,c,w[t+14],T,3275163606),c=_(c,l,r,o,w[t+3],x,4107603335),o=_(o,c,l,r,w[t+8],S,1163531501),r=_(r,o,c,l,w[t+13],M,2850285829),l=_(l,r,o,c,w[t+2],T,4243563512),c=_(c,l,r,o,w[t+7],x,1735328473),o=_(o,c,l,r,w[t+12],S,2368359562),r=f(r,o,c,l,w[t+5],D,4294588738),l=f(l,r,o,c,w[t+8],E,2272392833),c=f(c,l,r,o,w[t+11],j,1839030562),o=f(o,c,l,r,w[t+14],H,4259657740),r=f(r,o,c,l,w[t+1],D,2763975236),l=f(l,r,o,c,w[t+4],E,1272893353),c=f(c,l,r,o,w[t+7],j,4139469664),o=f(o,c,l,r,w[t+10],H,3200236656),r=f(r,o,c,l,w[t+13],D,681279174),l=f(l,r,o,c,w[t+0],E,3936430074),c=f(c,l,r,o,w[t+3],j,3572445317),o=f(o,c,l,r,w[t+6],H,76029189),r=f(r,o,c,l,w[t+9],D,3654602809),l=f(l,r,o,c,w[t+12],E,3873151461),c=f(c,l,r,o,w[t+15],j,530742520),o=f(o,c,l,r,w[t+2],H,3299628645),r=y(r,o,c,l,w[t+0],q,4096336452),l=y(l,r,o,c,w[t+7],L,1126891415),c=y(c,l,r,o,w[t+14],z,2878612391),o=y(o,c,l,r,w[t+5],O,4237533241),r=y(r,o,c,l,w[t+12],q,1700485571),l=y(l,r,o,c,w[t+3],L,2399980690),c=y(c,l,r,o,w[t+10],z,4293915773),o=y(o,c,l,r,w[t+1],O,2240044497),r=y(r,o,c,l,w[t+8],q,1873313359),l=y(l,r,o,c,w[t+15],L,4264355552),c=y(c,l,r,o,w[t+6],z,2734768916),o=y(o,c,l,r,w[t+13],O,1309151649),r=y(r,o,c,l,w[t+4],q,4149444226),l=y(l,r,o,c,w[t+11],L,3174756917),c=y(c,l,r,o,w[t+2],z,718787259),o=y(o,c,l,r,w[t+9],O,3951481745),r=u(r,a),o=u(o,i),c=u(c,s),l=u(l,n);var R=b(r)+b(o)+b(c)+b(l);return R.toLowerCase()}},User:{getYKToken:function(){return e.Cookie.get("yktk")},getUserName:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1)return a.split(",")[1].split(":")[1]}return 0},getUID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1)return parseInt(a.split(",")[0].split(":")[1])}return 0},getYTID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("ytid:")>-1)return parseInt(a.split(",")[3].split(":")[1])}return 0},getisVIP:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("vip:")>-1)return!!a.split(",")[2].split(":")[1]}return!1},getLoginStatus:function(){return 0!==this.getUID()}},Ajax:{getScript:function(e,t,a){if("string"==typeof arguments[0]){var t="function"==typeof arguments[1]?t:function(){},a="boolean"==typeof arguments[2]?a:!1,i=document.getElementsByTagName("HEAD")[0],s=document.createElement("SCRIPT");s.type="text/javascript",s.src=e,s.onload=s.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(t(),s.onload=s.onreadystatechange=null,a&&this.parentNode.removeChild(this))},i.appendChild(s)}}}};window.CHUDA=e}(),function(){if(void 0==window.jQuery){var e=[location.protocol,"//","static.youku.com","/js/jquery.js"].join("");CHUDA.Ajax.getScript(e,function(){window.jQuery=jQuery.noConflict()},!0)}Number.prototype.toFixed=function(e){var t=this+"";if(e||(e=0),-1==t.indexOf(".")&&(t+="."),t+=new Array(e+1).join("0"),new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(e+1)+"})?)\\d*$").test(t)){var t="0"+RegExp.$2,a=RegExp.$1,i=RegExp.$3.length,s=!0;if(i==e+2){if(i=t.match(/\d/g),parseInt(i[i.length-1])>4)for(var n=i.length-2;n>=0&&(i[n]=parseInt(i[n])+1,10==i[n]);n--)i[n]=0,s=1!=n;t=i.join("").replace(new RegExp("(\\d+)(\\d{"+e+"})\\d$"),"$1.$2")}return s&&(t=t.substr(1)),(a+t).replace(/\.$/,"")}return this+""},UC_DOMAIN=window.UC_DOMAIN||"i.youku.com",API_DOMAIN_DEF="www.youku.com",API_DOMAIN_Link="http://lv.youku.com/page/grade/task",LINK_GRAGE_ICON="http://cps.youku.com/redirect.html?id=000145df";var t=function(e){return document.getElementById(e)},a={targetURL:{vip:"http://cps.youku.com/redirect.html?id=000145de",lvip:"http://cps.youku.com/redirect.html?id=000145dd"},curpanel:"",userDefauleIcon:"http://static.youku.com/v1.0.1040/user/img/head/64/999.jpg",panel:{user:"qheader_username_panel",noticelist:"qheader_notice_info"},loading:'<div class="cd-hpanel-loading" id="hpanelloading"><span class="ico-loading-64"></span></div>',initHeaderUser:function(){var e=CHUDA.User.getUID();if(e){window.USERINFO=void 0;var t="http://lv.youku.com/api/grade/get_uinfo?callback=QheaderModule.upUserImg";CHUDA.Ajax.getScript(t,null,!0)}},upUserImg:function(e){if(t("qheader_username")){var i=null;if(void 0!=e.errno&&-300003504===e.errno)return CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500);if(void 0!=e.errno&&0===e.errno)i=e.data,window.localStorage&&window.localStorage.setItem("USERDATA",CHUDA.Common.serialize(i));else{if(!window.localStorage||null==window.localStorage.getItem("USERDATA"))return;i=CHUDA.Common.deserialize(window.localStorage.getItem("USERDATA"))}t("qheader_userlog").className+=" patch-user-info";var s=i.user_image?i.user_image:a.userDefauleIcon,n="";(i.is_vip||i.is_lvip)&&0==i.vip_grade&&(i.vip_grade=1),i.is_vip?n='<span class="vip-level-icon level-vip'+i.vip_grade+(1===i.vip_year?" level-annual":"")+'" title="ä¼é·åè±'+(1===i.vip_year?"å¹´è´¹":"")+"é»éä¼åï¼VIP"+i.vip_grade+'" id="qheader_crown_icon" data-type="vip"></span>':i.is_lvip?n='<span class="vip-level-icon level-lvip'+i.vip_grade+(1===i.vip_year?" level-annual":"")+'" title="ä¼é·åè±'+(1===i.vip_year?"å¹´è´¹":"")+"ç½é¶ä¼åï¼VIP"+i.vip_grade+'" id="qheader_crown_icon" data-type="lvip"></span>':i.vip_grade>0&&(n='<span class="vip-level-icon level-expired'+i.vip_grade+'" title="æ¨çä¼é·åè±ä¼åå·²è¿æ" id="qheader_crown_icon" data-type="vip"></span>');var r='<div class="yk-userlog-after-meta"><img class="yk-userlog-after-avatar" src="'+s+'"><span class="yk-userlog-after-name'+(i.is_vip||i.is_lvip?" patch-red-name":"")+'" title="'+i.user_name+'" id="qheaer_user_name">'+CHUDA.Common.cutStr(i.user_name,10,null)+"</span>"+n+'<span class="user-grade-icon user-grade-lv'+i.grade+'" title="ä¼é·ç­çº§ï¼'+i.grade+'" id="qheader_grade_icon"></span><b class="caret yk-userlog-after-caret"></b></div>';t("qheader_username_show").innerHTML=r,window.USERDATA=i,CHUDA.Common.bind(t("qheaer_user_name"),"click",function(){return window.location.href="http://"+UC_DOMAIN+"/u/home?type=watch_timeline",!1});var o=this,c=t("qheader_crown_icon");void 0!=c&&CHUDA.Common.bind(c,"click",function(){return window.location.href=o.targetURL[c.getAttribute("data-type")],!1}),CHUDA.Common.bind(t("qheader_grade_icon"),"click",function(){return window.location.href=LINK_GRAGE_ICON,!1}),this.showUserMsgInit({init:!0,userIdEncode:"profile",isverified:!1,is_verify_email:1,is_verify_mobile:!1})}},showUserMsg:function(){a.curpanel="user";var e=t(a.panel.user);if(!e)return!1;if(a.showsign(),window.USERZPD||a.showUserZpd(),void 0==window.USERINFO){var i="http://lvip.youku.com/api/user/get_user_info?uid="+CHUDA.User.getUID()+"&access_token="+encodeURIComponent(CHUDA.User.getYKToken())+"&callback=QheaderModule.showUserMsgCallback";CHUDA.Ajax.getScript(i,null,!0)}else a.showUserMsgInit(window.USERINFO)},showsign:function(){var e="http://actives.youku.com/task/signv2/issigned?&callback=QheaderModule.showsignCallback";CHUDA.Ajax.getScript(e,null,!0)},showsignCallback:function(e){window.SIGNTAG="undefined"!=typeof e.errno&&-300003604===e.errno?1:0;var t=document.getElementById("qheaderSignTag");t&&(t.innerHTML=("number"==typeof window.SIGNTAG&&1===window.SIGNTAG,"èµå°"))},showUserMsgInit:function(e){t(a.panel.user).innerHTML='<div class="cd-hpanel-ico ico-arrow-top-grey"></div>';var i=window.USERDATA,s=document.createElement("div");if(s.className="cd-hpanel-user-info",CHUDA.User.getLoginStatus()){var n=i.user_image||a.userDefauleIcon,r='<div class="cd-hpanel-user-avatar"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank"><img src="'+n+'"></a></div>',o='<div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank" title="'+i.user_name+'"'+(i.is_vip||i.is_lvip?' class="patch-red-name"':"")+">"+CHUDA.Common.cutStr(i.user_name,12,"...")+"</a></div>";o+='<div class="cd-hpanel-user-credit">',i.is_vip?o+='<a href="'+this.targetURL.vip+'" target="_blank"><span class="vip-level-icon level-vip'+i.vip_grade+(1===i.vip_year?" level-annual":"")+'" title="ä¼é·åè±'+(1===i.vip_year?"å¹´è´¹":"")+"é»éä¼åï¼VIP"+i.vip_grade+'"></span></a>':i.is_lvip?o+='<a href="'+this.targetURL.lvip+'" target="_blank"><span class="vip-level-icon level-lvip'+i.vip_grade+(1===i.vip_year?" level-annual":"")+'" title="ä¼é·åè±'+(1===i.vip_year?"å¹´è´¹":"")+"ç½é¶ä¼åï¼VIP"+i.vip_grade+'"></span></a>':i.vip_grade>0&&(o+='<a href="'+this.targetURL.vip+'" target="_blank"><span class="vip-level-icon level-expired'+i.vip_grade+'" title="æ¨çä¼é·åè±ä¼åå·²è¿æ"></span></a>'),o+='<a href="'+LINK_GRAGE_ICON+'" target="_blank"><span class="user-grade-icon user-grade-lv'+i.grade+'" title="ä¼é·ç­çº§ï¼'+i.grade+'"></span></a>',e.isverified&&(o+='<a href="http://'+UC_DOMAIN+'/u/rz" target="_blank"><i class="ico-cert" title="è®¤è¯ç¨æ·"></i></a>'),o+=0!=e.is_verify_email?'<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mail.html" target="_blank"></a></div>':'<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security.html" target="_blank"></a></div>',1!=e.is_verify_mobile?(o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone"><a class="cd-hpanel-ico ico-valid-phone" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a>',e.init||(o+=0==e.is_verify_email?'<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">ç»å®ææº</a></div></div>':'<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">å»ç»å®</a></div></div>'),o+="</div>"):o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone-done"><a class="cd-hpanel-ico ico-valid-phone-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a></div>',o+="</div>",o+='<div class="cd-hpanel-user-vip">',i.is_vip?(o+='<div class="user-vip-item">é»éä¼åå©ä½<span>'+i.vip_last_day+'</span>å¤©</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=00014639" target="_blank" title="ç»­è´¹é»éä¼å"><span>ç»­è´¹</span><i></i></a>',this.cpsStatistics("00014639")):i.is_lvip?(o+='<div class="user-vip-item">ç½é¶ä¼åå©ä½<span>'+i.lvip_last_day+'</span>å¤©</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463b" target="_blank" title="ç»­è´¹ç½é¶ä¼å"><span>ç»­è´¹</span><i></i></a>',this.cpsStatistics("0001463b")):(o+='<div class="user-vip-item">å å¥ä¼ååå¹¿å</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463a" target="_blank" title="å¼éä¼é·åè±ä¼å"><span>å¼é</span><i></i></a>',this.cpsStatistics("0001463a")),o+="</div>",o+='<div class="cd-hpanel-user-extend"><a href="http://'+UC_DOMAIN+'/u/setting/base_profile.html" target="_blank">è®¾ç½®</a><span class="cd-hpanel-split">|</span><a href="javascript:;" onclick="setTimeout(function(){logout();},200);return false;">ç»åº</a></div></div>';var c='<div class="cd-hpanel-user-zpd" id="cdhpaneluserzpd"></div>',l='<div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div><div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';s.innerHTML=r+o+c+l}else{var d='<div class="cd-hpanel-user-avatar"><a><img src="http://static.youku.com/index/img/toolbar/toolbar_avatar.jpg" alt=""></a></div><div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name">Hi, æ¨å¥½ï½ï½</div><p>ç»å½å¯ä»¥ææ¶é¿ç©åçº§å¦~</p></div><div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div><div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';s.innerHTML=d}if(t(a.panel.user).appendChild(s),c&&a.showUserZpdInit(),CHUDA.User.getLoginStatus()){var u=document.createElement("div");u.className="panel-user-grade";var p=[];Math.round(i.score/6)/10,Math.round(i.upgrade_score/6)/10;if(p.push('<div class="panel-user-grade-title"><span>æçç­çº§</span><a class="panel-user-grade-reward-a" href="'+LINK_GRAGE_ICON+'" target="_blank">ç«å³é¢å></a><div class="panel-user-grade-reward">ä¸å±ç¤¼åï¼</div></div>'),i.grade>=100)var h=99;else var h=i.grade;p.push('<div class="panel-user-grade-line">'),p.push('<a class="panel-user-grade-left-new">'+h+'</a><a class="panel-user-grade-center-new"></a><a class="panel-user-grade-right-new">'+parseInt(h+1)+"</a>"),p.push('<div class="panel-user-grade-time-new" id="panelusergradetimenew">');var v=i.today_score>i.today_max_score?i.today_max_score:i.today_score,g=223,m=Math.ceil((i.score-CHUDA.Common.shichang(h))/(CHUDA.Common.shichang(h+1)-CHUDA.Common.shichang(h))*g);(i.score/60).toFixed(1)==(CHUDA.Common.shichang(h+1)/60).toFixed(1)&&(m=223);var _=i.score-CHUDA.Common.shichang(h)<=0?"":i.score-CHUDA.Common.shichang(h)<4?"0.1":((i.score/60).toFixed(1)-(CHUDA.Common.shichang(h)/60).toFixed(1)).toFixed(1);p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-left-new">'+h+"</a>"),i.score-CHUDA.Common.shichang(h)>0&&(p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-center-new" id="rank_todayDuraLine">'+_+"å°æ¶</a>"),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-right-new"></a>')),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-next '+(i.grade>=100?"panel-user-grade-next-top":"")+'">'+parseInt(h+1)+"</a>"),p.push('<div class="panel-user-grade-line-hover" id="panelusergradelinehover"><div class="panel-user-grade-line-today"><i></i><em>ä»æ¥å·²æé¿'+(i.today_score/60).toFixed(1)+'å°æ¶</em></div><div class="panel-user-grade-line-todaymore"><i></i><em>æå¤å¯åå¢å '+((i.today_max_score*(i.is_vip?1.2:i.is_lvip?1.1:1)/60).toFixed(1)-(v/60).toFixed(1)).toFixed(1)+"å°æ¶</em></div></div>"),p.push("</div>"),p.push("</div>"),p.push('<div class="panel-user-grade-info-new">'),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nowlv">'+(CHUDA.Common.shichang(h)/60).toFixed(1)+"å°æ¶</a>"),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nextlv '+(i.grade>=100?"panel-grade-icon-nextlv-top":"")+'">'+(CHUDA.Common.shichang(h+1)/60).toFixed(1)+"å°æ¶</a>"),p.push("</div>"),u.innerHTML=p.join(""),t(a.panel.user).appendChild(u),!e.init&&m>0&&jQuery("#rank_todayDuraLine").animate({width:m+"px"},"slow","swing");var f=document.createElement("div");f.className="cd-hpanel-u-task";var y='<div class="u-task-title"><span>æçä»»å¡</span></div>';f.innerHTML=y;var k=document.createElement("div");k.className="u-task-list",k.setAttribute("id","tasklistsidetool");var b='<div class="sign1" style="overflow:hidden;">';b+='<div class="s-img" style="float:left;width:50px;height:50px;margin-right:5px;"><img src="http://static.youku.com/lvip/img/app/sign/task20151126.png" width="100%" height="100%"></div>',b+='<div class="s-com" style="float:left;width:175px;margin-right:5px;line-height:17px;margin-top:5px;">',b+='<p style="color:#7dd3f7;font-size:12px;">ç­¾å°é¢ç§¯å</p>',b+='<p style="color:#909090;font-size:12px;">ç§¯åæ¢è±ªç¤¼ï¼iPhone 6sééå</p>',b+="</div>",b+='<div class="s-link" style="float:right;margin-top:10px;" id="signLink">',b+='<a href="http://actives.youku.com/task/show/index" target="_blank" id="qheaderSignTag" style="display:block;width:50px;height:28px;text-align:center;font-size:12px;line-height:28px;color:#fff;background:#ff6600;">'+("number"==typeof window.SIGNTAG&&1===window.SIGNTAG,"èµå°")+"</a>",b+="</div>",b+="</div>",k.innerHTML=b,f.appendChild(k),t(a.panel.user).appendChild(f);var C=document.createElement("div");C.className="cd-hpanel-userservices",C.innerHTML='<ul class="cd-userservices-list cd-userservices-list-topborder"><li class="u-service-chanel"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank"><i class="cd-hpanel-ico ico-myspace"></i>æçé¢é</a></li><li class="u-service-manage"><a href="http://'+UC_DOMAIN+'/u/videos" target="_blank"><i class="cd-hpanel-ico ico-videomanage"></i>åä½ä¸­å¿</a></li><li class="u-service-favor"><a href="http://faxian.youku.com/" target="_blank"><i class="cd-hpanel-ico ico-yourfavor"></i>ç²¾å½©åç°</a></li><li class="u-service-subscribe"><a href="http://'+UC_DOMAIN+'/u/home?type=favorite" target="_blank"><i class="cd-hpanel-ico ico-subscribe"></i>æçæ¶è</a></li></ul>',t(a.panel.user).appendChild(C)}else{var w=document.createElement("div");w.className="cd-hpanel-oauth-login";var A='<button class="btn btn-large" href="jsvascript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">ç«å³ç»å½</button><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-qq" title="QQ"><span>qq</span></a><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-weibo" title="å¾®å"><span>å¾®å</span></a><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-alipay" title="éè¿æ¯ä»å®æ«æå¯ç´æ¥æ³¨åãç»å½ä¼é·äº"><span>æ¯ä»å®</span></a><span class="extend">æ²¡æè´¦å·? <a href="http://www.youku.com/user/signup" target="_blank">åè´¹æ³¨å</a></span>';w.innerHTML=A,t(a.panel.user).appendChild(w)}setTimeout(function(){a.userMsgShowHover()},500),this.cpsStatistics("0001472a")},showUserMsgCallback:function(e){return void 0!=e.errno&&-300003504===e.errno?(CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500)):void(void 0!==e.errno&&0==e.errno&&(window.USERINFO=e.data,this.showUserMsgInit(window.USERINFO)))},makeTasklistHtml:function(e){var t="";if(!e.tasklist||e.tasklist.length<=0)return t='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">æ´å¤ç²¾å½© æ¬è¯·æå¾...</p></div>';for(var a=!1,i="",s=0;s<e.tasklist.length;s++){var n="u-task-meta";2==e.tasklist[s].status?n="u-task-meta u-task-meta-done":1==e.tasklist[s].status&&(n="u-task-meta"),t+='<div class="'+n+'" id="task_list_'+e.tasklist[s].tid+'" name="tasklistidetool" tid="'+e.tasklist[s].tid+'" ttype="'+e.tasklist[s].type+'"><a class="u-task-m-link"><img src="'+e.tasklist[s].icon+'"><span class="u-task-link-icon-done"></span></a><div class="u-task-m-entry"><a class="u-task-m-e-title" title="'+e.tasklist[s].name+'">'+e.tasklist[s].name+'</a><span title="'+e.tasklist[s].desc+'">'+e.tasklist[s].desc+'</span><div class="u-task-m-e-reward"><span>å¥å±ï¼</span>';for(var r=0;r<e.tasklist[s].awards.length;r++)1==e.tasklist[s].awards[r].type&&0==a&&(a=!0),e.tasklist[s].awards[r].detail&&(t+='<span class="reward-entry">'+e.tasklist[s].awards[r].detail+"</span>");if(t+="</div></div>",2==e.tasklist[s].status)t+='<span class="u-task-m-status u-task-m-status-done" id="task_receive_'+e.tasklist[s].tid+'">é¢å¥å±</span>';else if(1==e.tasklist[s].status)if(10!=e.tasklist[s].type)e.tasklist[s].progress&&e.tasklist[s].progress.length>0?t+="0/1"===e.tasklist[s].progress?'<span class="u-task-m-status u-task-m-status-ing">è¿è¡ä¸­â¦</span>':'<span class="u-task-m-status u-task-m-status-degree">'+e.tasklist[s].progress+"</span>":(i="","string"==typeof e.tasklist[s].toUrl&&e.tasklist[s].toUrl.length>0&&(i=' data-tourl="'+e.tasklist[s].toUrl+'"'),t+='<span class="u-task-m-status u-task-m-status-progress" id="toolbar_initiative_task_'+e.tasklist[s].tid+'"'+i+">é¢ä»»å¡</span>");else if(e.tasklist[s].special_task_type&&2==e.tasklist[s].special_task_type){var o=e.tasklist[s].special_task_source?e.tasklist[s].special_task_source:"http://www.youku.com";t+='<span class="u-task-m-status u-task-m-status-progress"><a href="'+o+'" target="_blank">åä»»å¡</a></span>'}else t+='<span class="u-task-m-status u-task-m-status-progress" id="do_task_'+e.tasklist[s].tid+'">åä»»å¡</span>';t+="</div>"}if(a){var c=window.USERDATA;t+=c.is_vip?'<div class="u-task-meta-hint"><i class="ico__vipsuper"></i><span>é»éä¼åååç§¯å</span></div>':'<div class="u-task-meta-hint u-task-meta-hint-no"><i class="cd-hpanel-ico ico__vipsuper_no"></i><span>é»éä¼åååç§¯å</span></div>'}return t},userMsgShowHover:function(){t("sidetoolqrcodepanelshow")&&(t("sidetoolqrcodepanelshow").onclick=function(){a.qrcodeShow()}),a.bindTastDivListEvent();var e=t("panelusergradetimenew");e&&jQuery("#panelusergradetimenew").hover(function(e){jQuery(e.target).hasClass("panel-user-grade-next")||jQuery(e.target).hasClass("panel-user-grade-left-new")||jQuery("#panelusergradelinehover").show()},function(){jQuery("#panelusergradelinehover").hide()})},bindTastDivListEvent:function(){var e=a._getElementsByName("div","tasklistidetool");if(e)for(var i=e.length,s=0;i>s;s++){var n=e[s].getAttribute("tid");!function(e){t("task_receive_"+e)&&(t("task_receive_"+e).onclick=function(){var t="http://"+API_DOMAIN_DEF+"/index_QSideToolJSONP?function[]=userReceiveAward&callback[]=QheaderModule.userReceiveAwardCallback&tid="+e;CHUDA.Ajax.getScript(t,null,!0)}),t("do_task_"+e)&&(t("do_task_"+e).onclick=function(){taskUpdateUserInfo(e,0)}),t("toolbar_initiative_task_"+e)&&(t("toolbar_initiative_task_"+e).onclick=function(){doInitiativeTask(e,0)})}(n)}},qrcodeShow:function(){var e=t(a.panel.user).select(".cd-hpanel-code")[0];qrcodeLogin.getObj("toolbar")&&qrcodeLogin.getObj("toolbar").delInterval();var i={size:138,loginfrom:"toolbar",stfrom:"toolbar",hParentDom:e,isPageExist:function(){return"user"==a.curpanel?!0:!1},getQrcodeCallback:function(){a.qrcodeShowAnimation()},callback:function(){window.toolbarQrloginObj.isQrloginSucc=!0,window.login_callback(),a.initHeaderUser()}};qrcodeLogin.init("toolbar",i),setTimeout(function(){window.toolbarQrloginObj=qrcodeLogin.getObj("toolbar")},500)},qrcodeShowAnimation:function(){setTimeout(function(){a.qrcodePanelShow.call(t("sidetoolqrcodepanelshow"),a),setTimeout(function(){t("sidetoolqrcodepanelclose")&&(t("sidetoolqrcodepanelclose").onclick=function(){a.qrcodePanelClose.call(t("sidetoolqrcodepanelclose"),a),setTimeout(function(){a.qrcodeHide()},600)})},100)},100)},qrcodeHide:function(){var e=t(a.panel.user).select(".cd-hpanel-code .ykcode-container")[0];e&&e.remove(),qrcodeLogin.getObj("toolbar")&&qrcodeLogin.getObj("toolbar").delInterval()},userReceiveAwardCallback:function(e){e&&e.ret&&"OK"==e.ret&&e.tid&&t("task_list_"+e.tid)&&a.userReceiveAward.call(t("task_list_"+e.tid),a)},getUserTaskList:function(){if(t("tasklistsidetool")){var e="http://lvip.youku.com/api/user/get_user_task?uid="+CHUDA.User.getUID()+"&callback=QheaderModule.getUserTaskListCallback";CHUDA.Ajax.getScript(e,null,!0)}},getUserTaskListCallback:function(e){if(void 0!==e.errno&&0==e.errno){var e=e.data;if(e.tasklist&&e.tasklist.length>0&&t("tasklistsidetool")){var i=a.makeTasklistHtml(e),s=jQuery("#tasklistsidetool");s.html(i),a.bindTastDivListEvent()}else t("tasklistsidetool")&&(t("tasklistsidetool").innerHTML='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">æ´å¤ç²¾å½© æ¬è¯·æå¾...</p></div>')}},qrcodePanelShow:function(e){var t=jQuery,a=CHUDA.Common.getBrowser(),i=t(this).parent(),s=i.find(".ykcode-container"),n=i.find(".ykcode-cover"),r=n.find(".ykcode-cover-img"),o=300;return t(this).hide(),s.css("display","block"),a.ie&&parseInt(a.ie)<10?void i.css({height:"330px",width:"274px",zIndex:"100"}):(n.show(),void i.on("hover",function(){return!1}).css({width:"32px",height:"32px",zIndex:"100",overflow:"hidden"}).animate({width:"330px",height:"274px"},o,function(){r.css({transition:"transform 0.35s","-webkit-transition":"-webkit-transform 0.35s","-moz-transition":"-moz-transform 0.35s","-o-transition":"-o-transform 0.35s","-ms-transition":"-ms-transform 0.35s",transform:"rotate(-55deg)","-webkit-transform":"rotate(-55deg)","-moz-transform":"rotate(-55deg)","-o-transform":"rotate(-55deg)","-ms-transform":"rotate(-55deg)"}),n.delay(o+350).hide(1)}))},qrcodePanelClose:function(e){var t=jQuery,a=CHUDA.Common.getBrowser(),i=t(this).parent().parent(),s=t(this).parent(),n=i.find(".ykcode-flag"),r=i.find(".ykcode-cover"),o=r.find(".ykcode-cover-img"),c=300;return a.ie&&parseInt(a.ie)<10?(s.hide(),n.show(),void i.css({height:"auto",width:"auto",overflow:""})):(r.show(),o.css("display"),o.css({transition:"transform 0.25s","-webkit-transition":"-webkit-transform 0.25s","-moz-transition":"-moz-transform 0.25s","-o-transition":"-o-transform 0.25s","-ms-transition":"-ms-transform 0.25s",transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)"}),void i.delay(230).animate({width:"32px",height:"32px"},c,function(){s.hide(),r.hide(),n.show()}))},userReceiveAward:function(e){var t=jQuery,a=e,i=t(this).find("span.reward-entry"),s=(t(".cd-integral"),t('<div class="u-task-mask"><p>é¢åæå</p></div>'));meta=t("<div class='task-reward-meta'></div>"),t.each(i,function(e){t(i[e]).appendTo(meta)});var n=t(this).find("div.u-task-mask");n.length&&n.remove(),t(this).fadeOut("fast",function(){t(this).addClass("u-task-meta-reward"),s.append(meta),t(this).append(s),t(this).removeClass("u-task-meta-done"),t(this).fadeIn(function(){t(this).delay(1700).slideUp(300,function(){t(this).remove(),a.getUserTaskList()})})})},showUserZpd:function(){var e="http://cvip.youku.com/zpd_api/get_medal_list?&callback=QheaderModule.showUserZpdCallback";CHUDA.Ajax.getScript(e,null,!0)},showUserZpdCallback:function(e){return void 0!=e.errno&&-300003504===e.errno?(CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500)):void(void 0!==e.errno&&0==e.errno&&0!=e.data.length&&(106==parseInt(t("tasklistsidetool").style.height),t("tasklistsidetool").style.height="80px",e.data=e.data.sort(function(e,t){return t.status?1:-1}),window.USERZPD=e.data,this.showUserZpdInit(window.USERZPD)))},showUserZpdInit:function(e){var a;if((window.USERZPD||""==e)&&t("cdhpaneluserzpd")&&(a=window.USERZPD),a&&a.length>0){for(var i=a.length,s='<div class="cd-hpanel-user-zpd-content"><ul class="cd-hpanel-user-zpd-list" id="cdhpaneluserzpdlist" style="width:'+41*i+'px;left:0px;">',n=j=0;j<i;j++)n=j,s+='<li><a target="_blank" href="'+a[n].info_link+'/zpd" class="'+(a[n].status?"cd-hpanel-user-zpd-follow":"cd-hpanel-user-zpd-unfollow")+'" title="'+a[n].name+'é¢éä¼å"><img src="'+a[n].medal_icon_medium+'"></a></li>';s+="</ul>",i>7&&(s+='</div><div class="cd-hpanel-user-zpd-nav"><a class="cd-hpanel-user-zpd-prv-none" id="cdhpaneluserzpdprv" title="ä¸ä¸ä¸ª"></a><a class="cd-hpanel-user-zpd-pre" id="cdhpaneluserzpdpre" title="ä¸ä¸ä¸ª"></a></div>'),
t("cdhpaneluserzpd").style.height="26px",t("cdhpaneluserzpd").innerHTML=s,i>7&&(t("cdhpaneluserzpdprv").onclick=function(){if(t("cdhpaneluserzpdprv").className.indexOf("cd-hpanel-user-zpd-prv-none")>-1);else{var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e+41+"px",t("cdhpaneluserzpdlist").style&&0==parseInt(t("cdhpaneluserzpdlist").style.left)?(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv cd-hpanel-user-zpd-prv-none"):t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)<0&&(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv")}},t("cdhpaneluserzpdpre").onclick=function(){if(t("cdhpaneluserzpdpre").className.indexOf("cd-hpanel-user-zpd-pre-none")>-1);else{var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e-41+"px",t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)==41*(7-a.length)?(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre cd-hpanel-user-zpd-pre-none",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv"):parseInt(t("cdhpaneluserzpdlist").style.left)>41*(7-a.length)&&(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv")}})}},_getElementsByName:function(e,t){for(var a=[],i=document.getElementById("qheader_box"),s=i.getElementsByTagName(e),n=0;n<s.length;n++)s[n].getAttribute("name")==t&&(a[a.length]=s[n]);return a},MSGCENTER_LINK:"http://msg.youku.com/page/msg/index",MSGCENTER_API:"http://msg.youku.com/api/push/",noticePoll:function(){if(this.initNoticePannel(),this.resetNoticeTypeAndCount(),!this.timer){this.updateNoticeNum();var e=this;this.timer=setInterval(function(){e.updateNoticeNum()},6e4)}},initNoticePannel:function(){var e=document.getElementById("qheader_notice"),t=document.getElementById("qheader_notice_panel"),a=document.getElementById("qheader_notice_show"),i=document.getElementById("qheader_notice_num");e&&t&&(this.getChudaMessage(),i&&(i.className="chuda_qheader_spot"),a&&(a.getElementsByTagName("a")[0].href=this.MSGCENTER_LINK),t.innerHTML='<div class="chuda_panel_arrow"></div><div id="qheader_notice_info" class="chuda_notice_box"></div>',this.curNoticeTab="privateMsg")},updateNoticeNum:function(){var e=CHUDA.User.getUID();e&&CHUDA.Ajax.getScript("http://notify.youku.com/notify/get.json?uid="+e+'&types=["umc_notice","mvip.msg.state"]&callback=QheaderModule.updateNoticeNumCallback',null,!0)},subscribeCount:0,resetNoticeTypeAndCount:function(){this.noticeCount={activityMsg:0,privateMsg:0,systemMsg:0},this.noticeType={privateMsg:{notify:"umc_notice",category:3,type:"private_msg",parentCat:"privateMsg",subCats:[6]},comments:{notify:"umc_notice",category:4,type:"comments",parentCat:"privateMsg",subCats:[7,8,9]},act_notice:{notify:"mvip.msg.state",category:2,type:"act_notice",parentCat:"activityMsg",subCats:[2]},renewal:{notify:"mvip.msg.state",category:3,type:"renewal",parentCat:"systemMsg",subCats:[3]},view_coupons:{notify:"mvip.msg.state",category:1e3,type:"view_coupons",parentCat:"systemMsg",subCats:[1e3]},grow_up:{notify:"mvip.msg.state",category:1001,type:"grow_up",parentCat:"systemMsg",subCats:[1001]},video_publish:{notify:"mvip.msg.state",category:1004,type:"video_publish",parentCat:"systemMsg",subCats:[1004]},self_channel:{notify:"mvip.msg.state",category:1002,type:"self_channel",parentCat:"systemMsg",subCats:[1002]}}},updateNoticeNumCallback:function(e){if(e&&e.notify){this.resetNoticeTypeAndCount();var t=0;if(e.notify.umc_notice){var a=e.notify.umc_notice[0];for(var i in this.noticeType)if("umc_notice"==this.noticeType[i].notify){var s=this.noticeType[i].category,n=a[s]||0;this.noticeCount[this.noticeType[i].parentCat]+=n}t=a[1]||0}if(e.notify["mvip.msg.state"]){var a=e.notify["mvip.msg.state"][0];for(var i in this.noticeType)if("mvip.msg.state"==this.noticeType[i].notify){var s=this.noticeType[i].category,n=a[s]||0;this.noticeCount[this.noticeType[i].parentCat]+=n}}this.initNoticeSpot(),this.subscribeCount=t,this.initSubscribeSpot()}},initSubscribeSpot:function(){var e=document.getElementById("subscribe_lsidetooln_flag"),t=document.getElementById("subscribe_lsidetoolw_flag");this.subscribeCount>0?(e&&(e.innerHTML=this.subscribeCount>50?"...":this.subscribeCount,e.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num",e.style.display="block"),t&&(t.innerHTML=this.subscribeCount>50?"...":this.subscribeCount,t.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num",t.style.display="block")):(e&&(e.style.display="none"),t&&(e.style.display="none"))},initNoticeSpot:function(){var e=0;for(var t in this.noticeCount){var a=this.noticeCount[t],i=document.getElementById("chuda_spot_"+t);i&&(i.style.display=a>0?"block":"none"),e+=a}return document.getElementById("qheader_notice_num")&&(document.getElementById("qheader_notice_num").style.display=e>0?"block":"none"),document.getElementById("chuda_notice_clear")&&(document.getElementById("chuda_notice_clear").style.display=e>0?"block":"none"),e},showNoticeList:function(){this.curpanel="notice";var e=document.getElementById("qheader_notice_info");if(e)if(e.innerHTML="",CHUDA.User.getLoginStatus()){var t=!1;t=void 0!=window.USERDATA?window.USERDATA.is_vip||window.USERDATA.is_lvip:CHUDA.User.getisVIP(),e.parentNode.className="chuda_notice_panel"+(t?" chuda_notice_vip":"");var a=[];a.push('<div class="chuda_notice_hd"><ul><li'+("activityMsg"===this.curNoticeTab?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="activityMsg">æ´»å¨æ¶æ¯</a><span class="chuda_notice_spot" id="chuda_spot_activityMsg"></span></li><li'+("privateMsg"===this.curNoticeTab?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="privateMsg">ä¸æç¸å³</a><span class="chuda_notice_spot" id="chuda_spot_privateMsg"></span></li><li'+("systemMsg"===this.curNoticeTab?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="systemMsg">ç³»ç»æ¶æ¯</a><span class="chuda_notice_spot" id="chuda_spot_systemMsg"></span></li></ul></div>'),a.push('<div class="chuda_notice_bd">'),a.push('<div class="chuda_notice_inner'+("activityMsg"===this.curNoticeTab?" notice_current":"")+'">'+(0===this.noticeCount.activityMsg?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>"),a.push('<div class="chuda_notice_inner'+("privateMsg"===this.curNoticeTab?" notice_current":"")+'">'+(0===this.noticeCount.privateMsg?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>"),a.push('<div class="chuda_notice_inner'+("systemMsg"===this.curNoticeTab?" notice_current":"")+'">'+(0===this.noticeCount.systemMsg?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>"),a.push("</div>"),a.push('<div class="chuda_notice_ft"><a href="javascript:void(0)" class="chuda_notice_clear" id="chuda_notice_clear">å¨é¨å·²è¯»</a><a class="chuda_notice_rightlink" href="'+this.MSGCENTER_LINK+'" target="_blank">æ¥çå¨é¨æ¶æ¯></a></div>'),e.innerHTML=a.join(""),this.initNoticeSpot(),CHUDA.Ajax.getScript(this.MSGCENTER_API+"getnewmsglist?"+this.getApiSignature()+"&callback=QheaderModule.showNoticeListCallback",null,!0),this.bindTabSwitch(e),this.cpsStatistics("0001472b")}else{e.parentNode.className="chuda_notice_panel chuda_notice_notlogin";var i='<div class="chuda_notice_notlogin_hd"><h3 class="chuda_notice_notlogin_title">æçéç¥</h3></div>';i+='<div class="chuda_notice_notlogin_bd"><div class="chuda_notice_notlogin_tips"><span class="chuda_notice_notlogin_icon"></span><p>ç»å½åå¯ä»¥çå°æµ·éä¿¡æ¯</p><p>åä¸ç²¾å½©æ´»å¨ï½</p></div>',i+='<a class="chuda_notice_notlogin_btn" href="javscript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">é©¬ä¸ç»å½</a></div>',e.innerHTML=i}},showNoticeListCallback:function(e){var t=this,a=6;if(void 0===e.errno||0!=e.errno)return jQuery(".chuda_notice_loading").html('<div class="chuda_notice_tips">è·åæ°æ®è¶æ¶ï¼<a href="javascript:void(0)" class="chuda_notice_reload">éæ°å è½½</a></div>'),void jQuery(".chuda_notice_reload").one("click",function(){t.showNoticeList()});var i=e.data,s=jQuery("#qheader_notice_info .chuda_notice_inner"),n={activityMsg:[],privateMsg:[],systemMsg:[]};for(var r in i){var o=i[r];if(o.sub_type)for(var c in this.noticeType)if(jQuery.inArray(o.sub_type,this.noticeType[c].subCats)>=0){var l=n[this.noticeType[c].parentCat];if(l.length===a)continue;l.push('<li data-type="'+this.noticeType[c].type+'" data-msgid="'+o.msgid+'" data-catid="'+o.sub_type+'"><div class="notice_node"><span class="'+(o.isfromvip?"chuda_notice_crown":"chuda_notice_spot")+'"></span><span title="'+o.contents+'">'+o.contents+'</span><a href="javascript:void(0)" title="æ¥çè¯¦æ" target="_blank">æ¥ç></a></div></li>')}}s.eq(0).html(n.activityMsg.length?'<ul class="chuda_notice_list">'+n.activityMsg.join("")+"</ul>":'<div class="chuda_notice_empty"></div>'),s.eq(1).html(n.privateMsg.length?'<ul class="chuda_notice_list">'+n.privateMsg.join("")+"</ul>":'<div class="chuda_notice_empty"></div>'),s.eq(2).html(n.systemMsg.length?'<ul class="chuda_notice_list">'+n.systemMsg.join("")+"</ul>":'<div class="chuda_notice_empty"></div>'),jQuery(".chuda_notice_list li").hover(function(){jQuery(this).addClass("notice_hover")},function(){jQuery(this).removeClass("notice_hover")}).one("click",function(){jQuery(this).addClass("notice_visited"),t.resetNoticeNum(jQuery(this).attr("data-msgid"),jQuery(this).attr("data-catid")),t.noticeCount[t.curNoticeTab]-=1,t.initNoticeSpot(),jQuery(this).parent().children("li").length===a&&jQuery(this).parent().children("li.notice_visited").length===a&&setTimeout(function(){t.showNoticeList()},2e3)}),jQuery(".chuda_notice_list a").each(function(){jQuery(this).attr("href",t.MSGCENTER_LINK+"?type="+jQuery(this).parent().parent().attr("data-type")),jQuery(this).click(function(e){e.stopPropagation()})})},resetNoticeNum:function(e,t){if(CHUDA.User.getUID()&&t){var a=new Image;a.src=this.MSGCENTER_API+"readcomfirm_msg?"+this.getApiSignature()+"&msgid="+e+"&type="+t}},getApiSignature:function(){var e=Math.round((new Date).getTime()/1e3),t=CHUDA.User.getYKToken(),a=CHUDA.User.getUID(),i="1001";return"appid="+i+"&ts="+e+"&uid="+a+"&access_token="+t+"&sig="+CHUDA.Common.Md5([i,e,a,decodeURIComponent(t)].join(""))},bindTabSwitch:function(e){var t=jQuery(e).find(".chuda_notice_inner"),a=this;jQuery(e).find(".chuda_notice_tab").each(function(e){var i=this;jQuery(i).unbind("click").bind("click",function(){jQuery(i).parent().hasClass("notice_current")||(a.curNoticeTab=jQuery(i).attr("data-tab"),jQuery(i).parent().addClass("notice_current").siblings().removeClass("notice_current"),t.eq(e).addClass("notice_current").siblings().removeClass("notice_current"))})}),jQuery("#chuda_notice_clear").click(function(){jQuery(".chuda_notice_list li").addClass("notice_visited"),a.resetNoticeNum("","2,3,6,7,8,9,1000,1001"),a.resetNoticeTypeAndCount(),a.initNoticeSpot(),setTimeout(function(){a.showNoticeList()},1500)})},getChudaMessage:function(){var e=CHUDA.User.getLoginStatus()?this.MSGCENTER_API+"getpopupmsg?"+this.getApiSignature()+"&page_no=1&callback=QheaderModule.getChudaMessageCallback":"http://static.youku.com/lvip/msg/chuda_message.js";CHUDA.Ajax.getScript(e,null,!0)},getChudaMessageCallback:function(e){if(void 0!==e.errno&&0==e.errno&&e.data&&e.data.msgs&&e.data.msgs.length>0){Math.round((new Date).getTime()/1e3);for(i=0;i<e.data.msgs.length;i++){var t=e.data.msgs[i];if(this.showChudaMessage(t,!0))break}}},initUnloginMessage:function(e){if(e&&e.length>0){var t=Math.round((new Date).getTime()/1e3);for(i=0;i<e.length;i++)if(("undefined"==typeof e[i].access_time||isNaN(parseInt(e[i].access_time))||!(t<parseInt(e[i].access_time)))&&("undefined"==typeof e[i].expire_time||isNaN(parseInt(e[i].expire_time))||!(t>parseInt(e[i].expire_time)))){var a="msgid_"+e[i].msgid;if(!CHUDA.Cookie.get(a)&&this.showChudaMessage(e[i],!1)){CHUDA.Cookie.set(a,e[i].msgid,1);break}}}},showChudaMessage:function(e,t){if("undefined"!=typeof e.status&&0!==e.status)return!1;var a=document.getElementById("qheader_msg_panel");if(a)return!1;var i=document.getElementById("qheader_notice");if(!i)return!1;a=document.createElement("div"),a.id="qheader_msg_panel",a.className="chuda_msg_panel";var s='<div class="chuda_panel_arrow"></div><div class="chuda_msg_box" id="qheader_msg_box">';try{s+=1007==e.type?'<div class="chuda_msg_hd chuda_msg_hd_new"><div class="chuda_msg_icon"><img src="'+e.fromuid.img+'"><span>'+e.fromuid.name+'</span></div><h3 class="chuda_msg_title_new">'+e.content.title+"</h3></div>":'<div class="chuda_msg_hd"><h3 class="chuda_msg_title">'+e.content.title+"</h3></div>",s+='<div class="chuda_msg_bd"><div class="chuda_msg_info">'+e.content.ifo+"</div>",e.content.btnname&&(s+='<a class="chuda_msg_btn" href="'+(e.content.link&&e.content.link.indexOf("http")>=0?e.content.link+'" target="_blank"':"javascript:void(0)")+'" id="qheader_msg_btn">'+e.content.btnname+"</a>"),s+='<a class="chuda_msg_close" href="#closeMsgBox" onclick="this.up(2).remove(); return false;">å³é­</a></div>'}catch(n){}s+="</div>";var r=this.MSGCENTER_API+"updatemsgstatus?"+this.getApiSignature()+"&msgid="+e.msgid+"&status=";if(t){var o=!1;void 0!=window.USERDATA?o=window.USERDATA.is_vip||window.USERDATA.is_lvip:CHUDA.User.getLoginStatus()&&(o=CHUDA.User.getisVIP()),o&&1007!=e.type&&1006!=e.type&&(a.className="chuda_msg_panel chuda_msg_vip");var c=new Image;c.src=r+"1"}a.innerHTML=s,i.parentNode.appendChild(a),t&&document.getElementById("qheader_msg_btn")&&(document.getElementById("qheader_msg_btn").onclick=function(){var e=document.getElementById("qheader_msg_panel");e&&e.remove();var t=new Image;t.src=r+"2"}),!isNaN(parseInt(e.fade))&&parseInt(e.fade)>0&&setTimeout(function(){var e=document.getElementById("qheader_msg_panel");e&&e.remove()},1e3*parseInt(e.fade));try{var l="cps.youku.com/redirect.html?id=";if(e.content&&e.content.link&&e.content.link.indexOf(l)>0){var d=e.content.link.substr(e.content.link.indexOf(l)+l.length,8);this.cpsStatistics(d)}}catch(n){}return!0},cpsStatistics:function(e){if(e){var t=new Image;t.src="http://p.l.youku.com/vippay?lt=2&uri="+e+"&ext="}}},s="http://static.youku.com/lvip/css/chuda_qheader.css",n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",s),document.getElementsByTagName("head")[0].appendChild(n),window.QheaderModule=a}();