KISSY.add("fp/menu-aim",function(a){var b=a.all,c=function(d){var e=this;e.opts=a.mix(c.defs,d),e.$wrap=b(e.opts.wrap),e.$menu=b(e.opts.menu),e.rNow=null,e.locs=[],e.locLast=null,e.t=null,e.tWait=null,e.tEnter=null,e.tLeave=null,e.isInto=!1,e.init()};return c.defs={wrap:"",menu:"",rows:"",delay:300,enterDelay:200,leaveDelay:200,handler:null,tolerance:0},c.prototype.init=function(){this.getOffset(),this.bindEvent()},c.prototype.getOffset=function(){var a=this,b=a.$menu.offset();a.menuOffset=b,a.upperRight={x:b.left+a.$menu.outerWidth(),y:b.top-a.opts.tolerance},a.lowerRight={x:b.left+a.$menu.outerWidth(),y:b.top+a.$menu.outerHeight()+a.opts.tolerance}},c.prototype.bindEvent=function(){var a=this;a.$wrap.on("mousemove",a.wrapMoveHandler,a).on("mouseenter",a.wrapEnterHandler,a).on("mouseleave",a.wrapLeaveHandler,a),a.$menu.on("mouseleave",a.menuLeaveHandler,a).delegate("mouseenter",a.opts.rows,a.rowEnterHandler,a)},c.prototype.wrapMoveHandler=function(a){var b=this;b.locs.push({x:a.pageX,y:a.pageY}),b.locs.length>3&&b.locs.shift()},c.prototype.wrapEnterHandler=function(){var b=this;b.tLeave&&b.tLeave.cancel(),b.tEnter=a.later(function(){b.getOffset(),b.isInto=!0},b.opts.enterDelay)},c.prototype.wrapLeaveHandler=function(){var b=this;b.tWait&&b.tWait.cancel(),b.tEnter&&b.tEnter.cancel(),b.tLeave=a.later(function(){b.rNow=null,b.locs=[],b.isInto=!1,b.opts.handler.leaveHandler()},b.opts.enterDelay)},c.prototype.menuLeaveHandler=function(){var a=this;a.t&&a.t.cancel(),a.tWait&&a.tWait.cancel()},c.prototype.rowEnterHandler=function(b){var c=this,d=b.currentTarget;c.t&&c.t.cancel(),c.tWait&&c.tWait.cancel(),c.isInto?c.possiblyActivate(d):c.tWait=a.later(function(){c.possiblyActivate(d),c.isInto=!0},c.opts.enterDelay)},c.prototype.possiblyActivate=function(b){var c=this,d=c.activationDelay();d?c.t=a.later(function(){c.possiblyActivate(b)},d):c.activate(b)},c.prototype.activationDelay=function(){function a(a,b){return(b.y-a.y)/(b.x-a.x)}var b=this,c=b.locs[b.locs.length-1],d=b.locs[0];if(!b.rNow||!c)return 0;if(d.x<b.menuOffset.left||d.x>b.lowerRight.x||d.y<b.menuOffset.top||d.y>b.lowerRight.y)return 0;if(b.locLast&&c.x==b.locLast.x&&c.y==b.locLast.y)return 0;var e=a(c,b.upperRight),f=a(c,b.lowerRight),g=a(d,b.upperRight),h=a(d,b.lowerRight);return g>e&&f>h?(b.locLast=c,b.opts.delay):(b.locLast=null,0)},c.prototype.activate=function(a){var b=this;b.rNow!=a&&(b.opts.handler.enterHandler(a),b.rNow=a)},c},{requires:["node"]});