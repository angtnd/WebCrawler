/**
 * DMM i3 tracker 
 *
 * Copyright (c) 2014 DMM.com
 * http://www.dmm.com/
 * @version v0.9 (2015-05-14) 
 */
!function(a,b){function c(a){var c=Object.prototype.hasOwnProperty;if(null===a||a===b)return!0;if("object"!=typeof a)return!1;if(a.length>0)return!1;if(0===a.length)return!0;for(var d in a)if(c.call(a,d))return!1;return!0}var d={},e=a.DMMi3Object||"i3",f=!1,g="//trac.i3.dmm.com/analytics/v0.9",h={open_id:"i3_opnd",view_type:"i3_vwtp",via_info:"i3_ref",via_view_rank:"i3_ord",via_show_position:"i3_pst"};a[e]=a[e]||function(){a[e].q.push(arguments)},a[e].q=a[e].q||[],a[e].v="v0.9",function(){a.console||(a.console={});for(var b=["log","info","warn","error","debug","trace","dir","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","dirxml","assert","count","markTimeline","timeStamp","clear"],c=0;c<b.length;c++)a.console[b[c]]||(a.console[b[c]]=function(){})}(),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),function(a,b){var c=function(){this.common={},this.view_cond={},this.api_cond={},this.detail_cond={},this.user_cond={},this.purchase_cond={},this.stack_function_count=0,this.onUpdated=function(){}},d={common:{date:"string",action:"string",option:"string",i3_service_code:"string",open_id:"string",session:"string",cookie:"string",view_type:"string",user_agent:"string",url:"string",datetime:"string",ip:"string",segment:"string",var1:"string",var2:"string",var3:"string",var4:"string",var5:"string"},view_cond:{referrer:"string",is_via_landing:"boolean",landing_class:"boolean"},api_cond:{hit_count:"number",page_number:"number",begin_number:"number",end_number:"number",limit:"number",show_count:"number",items:{content_id:"string",product_id:"string",price:"number",has_stock:"boolean"},type:"string",show_position:"string",parameters:"string",word:"string",category:"string",sort:"string",show_pattern:"string",is_retried:"boolean",api_response_time:"string",client_response_time:"string"},detail_cond:{content_id:"string",items:{content_id:"string",product_id:"string",price:"number",has_stock:"boolean",monthly_service_id:"number",monthly_service_is_subscribed:"boolean",monthly_service_due_date:"string",monthly_service_price:"number"},via_info:"string",via_option:"string",via_view_rank:"string",via_show_position:"string"},user_cond:{browser_lang:"string",ip:"string"},purchase_cond:{purchase_id:"string",purchase_id_type:"string",items:{content_id:"string",product_id:"string",price:"number",quantity:"number",via_conversion:"string",via_option:"string"},paytype:"string",monthly_service_id:"number",monthly_service_due_date:"string"}};c.prototype.getInputDataSchema=function(){return d},c.prototype.set=function(a,c){function d(b,c){if(0!==b.length){var i=b[0];"object"==typeof h[a][i]?e(h[a][i],c[i]):h[a][i]===typeof c[i]&&(g[a][i]=c[i]),f(function(){d(b.slice(1),c)})}}function e(b,c){if(null!==c&&"object"==typeof c&&0!==c.length){var d={},h=c[0];if(null!==h&&"object"==typeof h){for(var i in b)i in h&&b[i]===typeof h[i]&&(d[i]=h[i]);g[a].items=g[a].items||[],g[a].items.push(d)}var j="function"==typeof c.slice?c.slice(1):[];f(function(){e(b,j)})}}function f(a){g.stack_function_count++,b(function(){a(),g.stack_function_count--,0===g.stack_function_count&&g.onUpdated()})}var g=this,h=this.getInputDataSchema();if(a in h&&"object"==typeof c){var i=Object.keys(c);d(i,c)}return this},c.prototype.clearItems=function(a){var b=this.getInputDataSchema();return a in b&&(this[a].items=[]),this},c.prototype.setByObject=function(a){var b=this.getInputDataSchema();if("object"==typeof a){this.set("common",a);for(var c in b)c in a&&this.set(c,a[c])}return this},c.prototype.getData=function(){var a=this,b=a.common||{};return b.view_cond=a.view_cond,b.api_cond=a.api_cond,b.detail_cond=a.detail_cond,b.user_cond=a.user_cond,b.purchase_cond=a.purchase_cond,b},a.log=c}("undefined"==typeof exports?d:exports,"undefined"==typeof setImmediate?function(a){a()}:setImmediate),function(){function f(){return document.referrer||""}function g(){var a=document.getElementById(h.open_id);return a?a.value:b}function i(){var a=document.getElementById(h.view_type);return a?a.value:b}function j(){return navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage}var k=function(b,c){var f=this;f.constructor.parent.constructor.call(f),f.url=new d.url(location.href),f.set("common",{i3_service_code:b,view_type:i(),open_id:g(),var1:a[e].sp,url:location.href}),f.set("user_cond",{browser_lang:j()}),f.timeout=c||2e3},l=function(){};l.prototype=new d.log,k.prototype=new l,k.prototype.constructor=k,k.parent=d.log.prototype,k.prototype.view=function(a,b){var c=this,d=["page"];c.set("common",{action:"view"}).set("view_cond",{referrer:f()}),-1!==d.indexOf(a)&&c.set("common",{option:a}),c.send(b)},k.prototype.show=function(a,b){var c=this,d=["recommend","purchase","search","detail"];switch(c.set("common",{action:"show"}).set("view_cond",{referrer:f()}),-1!==d.indexOf(a)&&c.set("common",{option:a}),a){case"detail":c.set("detail_cond",{via_info:c.url.getViaInfo(),via_option:c.url.getViaOption(),via_view_rank:c.url.getViaViewRank(),via_show_position:c.url.getViaShowPosition()});break;case"search":}c.send(b)},k.prototype.click=function(a,b){var c=this,d=["add_cart","add_favorite"];c.set("common",{action:"click"}),-1!==d.indexOf(a)&&(c.set("common",{option:a}),c.set("detail_cond",{via_info:c.url.getViaInfo(),via_option:c.url.getViaOption(),via_view_rank:c.url.getViaViewRank(),via_show_position:c.url.getViaShowPosition()})),c.send(b)},k.prototype.get=function(){return this.getData()},k.prototype.send=function(a){var b=this,c=function(){var c=new d.sender;c.send("post",b.getData(),b.timeout,a)};0===b.stack_function_count?c():b.onUpdated=c},k.prototype.set=function(a,d){var e=this;if("detail_cond"===a&&"undefined"!=typeof d.via_info){var f=e.getData().detail_cond,g=f?f.via_info:b;c(g)||(d.via_info=b)}if("detail_cond"===a&&"undefined"!=typeof d.monthly_service_id&&(d.items=[d]),e.constructor.parent.set.call(e,a,d),"purchase_cond"===a){var h=e.getData().purchase_cond.purchase_id_type;c(h)&&e.set("purchase_cond",{purchase_id_type:"purchase"})}return e},k.prototype.getData=function(){var a=this,b=a.common||{};return c(a.view_cond)||(b.view_cond=a.view_cond),c(a.api_cond)||(b.api_cond=a.api_cond),c(a.detail_cond)||(b.detail_cond=a.detail_cond),c(a.user_cond)||(b.user_cond=a.user_cond),c(a.purchase_cond)||(b.purchase_cond=a.purchase_cond),b},d.tracking=k}(),function(){var c=function(){function c(a){if("string"!=typeof a)throw new TypeError;var b=a.split(".");return b.length>1?{namespace:b[0],type:b[1]}:{namespace:"default",type:b[0]}}var g=this,h={},i=a[e].q||[],j=a[e].t;a[e].sp=a[e].s?(~~new Date-a[e].s).toString():b,i.push=function(){for(var a=0;a<arguments.length;a++)Array.prototype.push.call(this,arguments[a]);g.execQueue()},this.execQueue=function(){if(0!==i.length){var a=["send","set","get","add","clear","create","debug","init"],b=i.shift();if(b.length>0){var d=b[0],e=c(d),f=e.type,h=e.namespace;-1!==a.indexOf(f)&&g[f](h,b[1],b[2],b[3])}g.execQueue()}},this.debug=function(a,c){return c===b&&(c=!0),f=c,this},this.init=function(b,c){return a[e].i=a[e].i||c,this},this.create=function(b,c){var f=c||"default",g=a[e].i;return h[f]=new d.tracking(g,j),this},this.set=function(a,b,c){switch(b){case"detail":h[a].set("detail_cond",c);break;case"search":case"recommend":case"api":h[a].set("api_cond",c);break;case"purchase":h[a].set("purchase_cond",c)}return this},this.add=function(a,b,c){switch(b){case"detail":h[a].set("detail_cond",{items:[c]});break;case"search":case"recommend":case"api":h[a].set("api_cond",{items:[c]});break;case"purchase":h[a].set("purchase_cond",{items:[c]})}return this},this.clear=function(a,b){switch(b){case"detail":h[a].clearItems("detail_cond");break;case"search":case"recommend":case"api":h[a].clearItems("api_cond");break;case"purchase":h[a].clearItems("purchase_cond")}return this},this.get=function(a,b){var c=function(){var c=h[a].get();b(c)};return 0===h[a].stack_function_count?c():h[a].onUpdated=c,this},this.send=function(a,b,c,d){switch(b){case"view":h[a].view(c,d);break;case"show":h[a].show(c,d);break;case"click":h[a].click(c,d)}return this},g.execQueue()};d.DMMi3=c}(),function(){function b(b,c,d,f){var h=new XDomainRequest;a[e].xdr_queue=a[e].xdr_queue||[],a[e].xdr_queue.push(h);try{h.open(b,g),h.onprogress=function(){},h.onerror=function(){f()},h.timeout=d,h.ontimeout=function(){f()},h.onload=function(){f()};var i=JSON.stringify(c);h.send(i)}catch(j){f()}}function c(a,b,c,d){var e=new XMLHttpRequest;try{e.open(a,g),e.withCredentials=!0,e.onreadystatechange=function(a){4===e.readyState&&(e.status>=200&&e.status<300,d())},e.timeout=c,e.ontimeout=function(){d()},e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.setRequestHeader("X-Requested-With","XMLHttpRequest");var f=JSON.stringify(b);e.send(f)}catch(h){d()}}function h(a){a="function"==typeof a?a:function(){};var b=function(){0===b.count&&a(),b.count++};return b.count=0,b}function i(){var b=!!a.ProgressEvent,c=!!a.FormData,d=a.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;return b&&c&&d}var j=function(){};j.prototype.send=function(d,e,g,j){var k=h(j);return f?k():(setTimeout(function(){0===k.count&&k()},g),i()?c(d,e,g,k):"undefined"!=typeof a.XDomainRequest?b(d,e,g,k):k())},d.sender=j}(),function(){var a=function(a){var b=document.createElement("a");b.href=a,this.protocol=b.protocol,this.hostname=b.hostname,this.port=b.port,this.pathname=b.pathname,this.query=b.search,this.hash=b.hash,this.host=b.host};a.prototype.getParameterByName=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b="[\\?&]"+a+"=([^&#]*)",c=new RegExp(b),d=c.exec(this.query);return null===d?"":decodeURIComponent(d[1].replace(/\+/g," "))},a.prototype.getViaInfo=function(){return this.getParameterByName(h.via_info)},a.prototype.getViaOption=function(){return this.getParameterByName("dmmref")},a.prototype.getViaViewRank=function(){return this.getParameterByName(h.via_view_rank)},a.prototype.getViaShowPosition=function(){return this.getParameterByName(h.via_show_position)},d.url=a}();new d.DMMi3}(this);