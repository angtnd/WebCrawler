/*
 shopintro.js 1.0.1
 Copyright (c) 2013 Rakuten.Inc
 Date : 2013-10-21 11:43:41
*/
(function(){jQuery.noConflict();var f=jQuery;if(f.RJS_Helpers){var j=-1!=navigator.userAgent.indexOf("Mac")?!0:!1,k=-1!=navigator.userAgent.indexOf("Firefox")?!0:!1;new function(){var a=this;f.extend(a,{settings:{ajaxtimer:[3,"Range","1,99"],ajaxurl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/#]+)"],shoplogourl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/#@]+)"],shopbookmarkurl:["","Str",
"^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/#]+)"],shopprourl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/#]+)"],shopmoreurl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/#]+)"],shoplogosid:["","Str","^[a-zA-Z0-9_]{3,64}$"],shoptitlesid:["","Str","^[a-zA-Z0-9_]{3,64}$"],shopmoresid:["","Str","^[a-zA-Z0-9_]{3,64}$"],itemsid:["","Str","^[a-zA-Z0-9_]{3,64}$"],
innerscroll:[1,"Int","^[0-1]$"],innerscrollsize:[41,"Range","1,99"]},eobj:{config:f("#shopIntroConfig"),dialogPrototype:f("#shopIntroDisplay")},status:{error:!1,isTimeout:!1,isAjax:!1},initialize:function(){if(a.loadSettings()){a.eobj.dialogPrototype.html(a.eobj.dialogPrototype.html().replace(/\#IMGELE\#/g,'<img src="" alt="" />'));if(a.settings.innerscroll&&!j){var b=1,c=delta=null;k?a.eobj.dialogPrototype.find(".innerScroll").bind({DOMMouseScroll:function(d){try{if(d.originalEvent.detail!=delta||
null==c)0>d.originalEvent.detail*delta&&(b=1,c=f(this).scrollTop()),b+=(0>d.originalEvent.detail?-1*d.originalEvent.detail:d.originalEvent.detail)/3,null==c&&(c=f(this).scrollTop()),delta=d.originalEvent.detail;f(this).stop(!0,!1).animate({scrollTop:c+(0>d.originalEvent.detail?-1*b++*a.settings.innerscrollsize:b++*a.settings.innerscrollsize)},200,function(){b=1;c=null});d.stopPropagation()}catch(i){}return!1}}):a.eobj.dialogPrototype.find(".innerScroll").bind({mousewheel:function(d){try{if(d.originalEvent.wheelDelta!=
delta||null==c)0>d.originalEvent.wheelDelta*delta&&(b=1,c=f(this).scrollTop()),b+=(0>d.originalEvent.wheelDelta?-1*d.originalEvent.wheelDelta:d.originalEvent.wheelDelta)/120,null==c&&(c=f(this).scrollTop()),delta=d.originalEvent.wheelDelta;f(this).stop(!0,!1).animate({scrollTop:c+(0<d.originalEvent.wheelDelta?-1*b++*a.settings.innerscrollsize:b++*a.settings.innerscrollsize)},200,function(){b=1;c=null});d.stopPropagation()}catch(i){}return!1}})}a.createDelegate()}},loadSettings:function(){a.settings=
f.RJS_Helpers.readAttr(a.eobj.config,a.settings);if(""==a.settings.ajaxurl||512<a.settings.ajaxurl.length||""==a.settings.shopbookmarkurl||512<a.settings.shopbookmarkurl.length||""==a.settings.shoplogourl||512<a.settings.shoplogourl.length||""==a.settings.shopprourl||512<a.settings.shopprourl.length||""==a.settings.shopmoreurl||512<a.settings.shopmoreurl.length)return!1;a.settings.ajaxtimer*=1E3;return!0},createDelegate:function(){f("body").delegate("a.shopIntroLink","click",function(){try{var b=
this,c;if(!f(this).attr("data-shopid")||!isFinite(f(this).attr("data-shopid")))return;c=setTimeout(function(){a.status.isTimeout=!0},a.settings.ajaxtimer);f.ajax({url:a.settings.ajaxurl.replace(/\#SHOPID\#/,f(b).attr("data-shopid")),cache:!1,dataType:"jsonp",data:null,scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,success:function(e){if("0"==e.code&&0<e.shops[0].items.length)if(a.status.isTimeout)d();else{clearTimeout(c);c=null;var b=a.eobj.dialogPrototype;b.dialog("close");0==b.find(".innerScroll").scrollTop()?
b.find(".innerScroll").animate({scrollTop:0}):b.find(".innerScroll").scrollTop(0);b.find(".gtqvProShopname a").eq(0).attr({href:a.parseLink(a.settings.shopprourl.replace(/\#SHOPURL\#/,e.shops[0].items[0].shopurl),a.settings.shoptitlesid)});b.find(".gtqvProShopname a").eq(0).html(e.shops[0].items[0].shopname);b.find(".gtqvProImage a").eq(0).attr({href:a.parseLink(a.settings.shopprourl.replace(/\#SHOPURL\#/,e.shops[0].items[0].shopurl),a.settings.shoplogosid)});b.find(".gtqvProImage a img").eq(0).attr({src:a.settings.shoplogourl.replace(/\#SHOPURL\#/,
e.shops[0].items[0].shopurl)});b.find(".gtqvProBt a").eq(0).attr({href:a.settings.shopbookmarkurl.replace(/\#SHOPNAME\#/,encodeURIComponent(e.shops[0].items[0].shopname)).replace(/\#SHOPURL\#/,e.shops[0].items[0].shopurl).replace(/\#SHOPID\#/,e.shops[0].items[0].shopid)});b.find(".gtqvShopProductsMore a").eq(0).attr({href:a.parseLink(a.settings.shopmoreurl.replace(/\#SHOPID\#/,e.shops[0].items[0].shopid),a.settings.shopmoresid)});var h=b.find(".gtqvShopProducts li").eq(0).clone();b.find(".gtqvShopProducts li").remove();
for(var g=0;g<e.shops[0].items.length;g++)h.find(".gtqvSpImg a").attr({href:a.parseLink(e.shops[0].items[g].itemurlfull,a.settings.itemsid)}),h.find(".gtqvSpImg img").attr({src:e.shops[0].items[g].imageurl128,alt:e.shops[0].items[g].itemname.substr(0,20),title:e.shops[0].items[g].itemname.substr(0,20)}),h.find(".gtqvSpTxt a").attr({href:a.parseLink(e.shops[0].items[g].itemurlfull,a.settings.itemsid)}),h.find(".gtqvSpTxt a").html(e.shops[0].items[g].itemname.substr(0,20)),h.find(".gtqvSpPrice").html(e.shops[0].items[g].itemprice.toString().replace(/^\d+[^\.]/,
function(a){return a.replace(/([\d]+?)(?=(?:\d{3})+$)/g,function(a){return a+","})})+"±ß"),h.find(".gtqvSpReview").html(e.shops[0].items[g].reviewnum+"·ï"),b.find(".gtqvShopProducts").append(h.clone());b.dialog({position:"center",resizable:!1,width:"565px",buttons:{"":function(){f(this).dialog("close")}}})}else d()},error:function(){d()}});var d=function(){clearTimeout(c);c=null;setTimeout(function(){location.href=f(b).attr("href")},0)}}catch(i){}return!1})},parseLink:function(a,c){return c?a+"?s-id="+
c:a}});a.initialize()}}})();
