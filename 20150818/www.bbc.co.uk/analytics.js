define(function(){if(typeof window.bbcdotcom==="undefined"||typeof bbcdotcom.objects==="undefined"){return{addEventListeners:function(){},callback:function(){}}}var s=bbcdotcom.utils,d=false,t=false,f,l={},e={continuousPlay:"CP",autoPlay:"AP",continuousPlayFirstVideo:"CPF"},h=false,a=false,p={},u=false,c=false,k=false,g=false;var q=function(v){if(typeof p[v]!=="undefined"){p[v]=true}};var m=function(){p.playlistStarted=false;p.advertStarted=false;p.advertEnded=false;p.programmeStarted=false;p.programmeEnded=false;p.playlistEnded=false;if(typeof bbcdotcom!=="undefined"&&typeof s!=="undefined"){s.log("resetVideoState:",p)}c=false;h=false;a=false;k=false;l.videoPlaysAutomatically=true};m();var b=function(){var v=f.settings();l.mediaType=f.kind();l.mediaOffset=f.currentTime();l.mediaLength=f.duration();l.mediaPlayerName=f.name();l.adId=null;l.mediaId=bbcdotcom.objects("settings.container.0.id")};var o=function(w){if(typeof COMSCORE==="undefined"){return}var v=(bbcdotcom.objects("bbcdotcom.sections"))?bbcdotcom.sections.getSection():"other";if(!d&&"advert"===w.mediaType){COMSCORE.beacon({c1:1,c2:"6035051",c3:v,c4:"",c5:"09",c6:"",c15:""});d=true}else{if(!t&&"programme"===w.mediaType){COMSCORE.beacon({c1:1,c2:"6035051",c3:v,c4:"",c5:"02",c6:"",c15:""});t=true}}};var j=function(v,y){var w={},x,z;b();for(x in l){w[x]=l[x]}if(typeof y==="object"){for(z in y){w[z]=y[z]}}bbcdotcom.analytics.trackEvent(v,w)};var n=function(v){if(typeof bbcdotcom.analytics==="undefined"){return false}b();q(v);s.log('av/emp/analytics.js: TRACK "'+v+'" triggered with:',l);switch(v){case"playlistLoaded":break;case"playlistStarted":bbcdotcom.analytics.startPlaylist(l);u=true;break;case"adRequest":bbcdotcom.analytics.adRequest(l);break;case"adManagerLoaded":bbcdotcom.analytics.adManagerLoaded(l);break;case"advertStarted":bbcdotcom.analytics.startAdvert(l);break;case"advertEnded":bbcdotcom.analytics.endAdvert(l);break;case"programmeStarted":o(l);bbcdotcom.analytics.startProgramme(l);break;case"pauseStarted":bbcdotcom.analytics.startPause(l);break;case"pauseEnded":bbcdotcom.analytics.endPause(l);break;case"seekStarted":bbcdotcom.analytics.startSeek(l);break;case"seekEnded":bbcdotcom.analytics.endSeek(l);break;case"programmeEnded":bbcdotcom.analytics.endProgramme(l);break;case"playlistEnded":bbcdotcom.analytics.endPlaylist(l);u=false;break}};var r=function(){s.log("cppHackPlaylistStarted - bbcdotcom.analytics.isPlaylistStarted(): "+bbcdotcom.analytics.isPlaylistStarted());if(!p.playlistStarted&&bbcdotcom.analytics.isPlaylistStarted()&&!u){s.log('cppHackPlaylistStarted: running track("playlistStarted") manually');n("playlistStarted")}};var i=function(v){f=v;l.playType=e.autoPlay;f.bind("playlistLoaded",function(w){s.log("av/emp/analytics: playlistLoaded triggered with: ",w);m();q("playlistLoaded");if(typeof w.playlist!=="undefined"){l.mediaName=w.playlist.title;if(typeof w.playlist.items[0]!=="undefined"&&w.playlist.items[0].kind==="advert"){c=true;s.log("av/emp/analytics: playlist has pre-roll: true")}else{s.log("av/emp/analytics: playlist has pre-roll: false")}}});f.bind("smp.plugin.continuousplay.mediaStarted",function(w){s.log("av/emp/analytics: smp.plugin.continuousplay.mediaStarted triggered with: ",w);l.playType=(l.playType===e.autoPlay)?e.continuousPlayFirstVideo:e.continuousPlay;if(!p.playlistStarted&&!bbcdotcom.config.isContinuousPlayEnabled()){s.log('Old CPP workflow hack: running track("playlistStarted") manually');n("playlistStarted")}});f.bind("userPlay",function(w){s.log("av/emp/analytics: userPlay triggered with: ",w);l.videoPlaysAutomatically=false;if(!p.playlistStarted){n("playlistStarted")}});f.bind("adsPlugin",function(w){s.log("av/emp/analytics: vAdStats triggered with: ",w);switch(w.id){case"adRequest":s.log("av/emp/analytics: requestAds triggered with: ",w);n("adRequest");break;case"adManagerLoaded":s.log("av/emp/analytics: adManagerLoaded triggered with: ",w);n("adManagerLoaded");break;case"adStarted":s.log("av/emp/analytics: adStarted triggered with: ",w);r();if(!p.playlistStarted){n("playlistStarted")}n("advertStarted");break;case"adEnded":s.log("av/emp/analytics: adEnded triggered with: ",w);n("advertEnded");break;case"adError":break}});f.bind("pause",function(w){s.log("av/emp/analytics: pause triggered with: ",w,p,l);if(p.programmeStarted){h=true;b();if(l.mediaLength>5&&l.mediaOffset>=(l.mediaLength-5)){s.log("If player head is within 5 sec of the end or programme, do not fire pause tracking event")}else{n("pauseStarted")}}g=true});f.bind("seeking",function(w){s.log("av/emp/analytics: seeking triggered with: ",w);a=true;n("seekStarted")});f.bind("playing",function(w){s.log("av/emp/analytics: playing triggered with: ",w,p);if(p.playlistStarted&&h){n("pauseEnded");h=false}if(!p.programmeStarted&&!k){s.log("av/emp/analytics: hack - advert not returned");r();if(!p.playlistStarted){n("playlistStarted")}n("programmeStarted")}k=true});f.bind("timeupdate",function(w){if(!p.programmeStarted&&f.kind()==="programme"&&(p.advertEnded||!c||!bbcdotcom.config.isAdsEnabled())){s.log("av/emp/analytics: timeupdate/programmeStarted triggered with: ",w,p,l);r();if(!p.playlistStarted){n("playlistStarted")}n("programmeStarted")}else{if(a){n("seekEnded");a=false}else{b()}}});f.bind("ended",function(w){s.log("av/emp/analytics: ended triggered with: ",w);n("programmeEnded")});f.bind("playlistEnded",function(w){s.log("av/emp/analytics: playlistEnded triggered with: ",w);n("playlistEnded");m()})};bbcdotcom.objects("bbcdotcom.av.emp.analytics","create");bbcdotcom.av.emp.analytics={addEventListeners:i,callback:n,trackEvent:j};return bbcdotcom.av.emp.analytics});