/*
 festival_banner_slider-1.2.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-05-22 16:09:38
*/
(function(){if(void 0!==window.jQuery){var d=jQuery.noConflict(),k=function(b){this.$root=b.show();this.isIE789=/MSIE\s[7-9]/.test(navigator.userAgent);this.currentTime=void 0;this.defaultBannerSelector=this.$root.attr("data-defaultBanner")||this.defaults.selectors.defaultBanner;this.itemFrameSelector=this.$root.attr("data-itemFrame")||this.defaults.selectors.itemFrame;this.itemBoxSelector=this.$root.attr("data-itemBox")||this.defaults.selectors.itemBox;this.rastaBoxSelector=this.$root.attr("data-rastaBox")||
this.defaults.selectors.rastaBox;this.rastaItemSelector=this.$root.attr("data-rastaItem")||this.defaults.selectors.rastaItem;this.timesaleDataSelector=this.$root.attr("data-timesaleData")||this.defaults.selectors.timesaleData;this.slideTime=+this.$root.attr("data-slideTime")||this.defaults.slideTime;this.baseZIndex=+this.$root.attr("data-baseZIndex")||this.defaults.baseZIndex;this.mouseLeaveTime=+this.$root.attr("data-mouseLeaveTime")||this.defaults.mouseLeaveTime;this.direction=this.$root.attr("data-direction")||
this.defaults.direction;this.rastaEventName=this.$root.attr("data-rastaEventName").replace(/\s+/g,"")||this.defaults.rastaEventName;this.rastaEventNameArray=this.rastaEventName.split(",");this.$rastaBox=this.$items=this.$itemBox=this.$itemFrame=this.$defaultBanner=void 0;this.$rastaItems=d();this.$timesaleData=void 0;this.itemHeight=this.itemWidth=this.frameWidth=0;this.isActive=!1;this.resizeID=this.autoSlideID=0;this.timesaleTimeList=[];this.timesaleImageURLs=[];this.timesaleDateString="";this.isTestMode=
!1;this.getElements()};k.prototype={defaults:{selectors:{defaultBanner:".defaultBanner",itemFrame:".itemFrame",itemBox:".itemBox",rastaBox:".rad-table-existItemDisplay",rastaItem:".rad-table-body > li",timesaleData:".timesaleData"},slideTime:4E3,baseZIndex:1E3,mouseLeaveTime:500,direction:"right",rastaEventName:"festivalbannerloaded"},getElements:function(){this.$defaultBanner=this.$root.find(this.defaultBannerSelector).hide();this.$itemFrame=this.$root.find(this.itemFrameSelector).show();this.$itemBox=
this.$itemFrame.find(this.itemBoxSelector);this.$items=this.$itemBox.children();this.$rastaBox=this.$root.find(this.rastaBoxSelector);this.$timesaleData=this.$root.find(this.timesaleDataSelector);this.itemWidth=this.$items.eq(0).outerWidth(!0);this.itemHeight=this.$items.eq(0).outerHeight(!0);this.frameWidth=this.$itemFrame.outerWidth(!0);this.bindRASTAEvent()},bindRASTAEvent:function(){var b=this,a=0,c=this.rastaEventNameArray.length,h=[];d.each(this.rastaEventNameArray,function(e,l){b.$root.bind(l,
function(l,f){0===f&&(h[e]=b.$rastaBox.eq(e).find(b.rastaItemSelector));a++;if(a===c){for(var j=0;j<h.length;j++)h[j]&&d.merge(b.$rastaItems,h[j]);b.addRASTAItems()}})})},addRASTAItems:function(){for(var b=[],a=0;a<this.$items.length;a++)b[a]=[],b[a][0]=this.$items[a];for(var c=a=0;c<this.$rastaItems.length;c++)b[a].push(this.$rastaItems[c]),a++,a>this.$items.length-1&&(a=0);a=d();for(c=0;c<b.length;c++)d.merge(a,b[c]);b=a.clone();d.merge(a,b.clone());d.merge(a,b);this.$itemBox.empty().append(a);
this.$items=a;0<this.$timesaleData.children().length&&this.getTimeFromServer();this.$root.css("visibility","visible");this.bindEvents()},getTimeFromServer:function(){var b=this;(this.isTestMode=/\?festivalbannertest=[0-9]{4}_[0-9]{4}_[0-9]{2}(00|30)/.test(location.search))?b.setTimesaleItems():d.ajax({url:"http://gettime.r10s.jp/",dataType:"jsonp",scriptCharset:"utf-8",cache:!0,error:function(){var a=new Date;b.currentTime=new Date(a.setTime(a.getTime()+324E5));b.setTimesaleItems()},success:function(a){b.currentTime=
new Date((new Date).setTime(1E3*a.epoch+324E5));b.setTimesaleItems()}})},setTimesaleItems:function(){var b=this;if(this.isTestMode)this.timesaleDateString=location.search.split("festivalbannertest=")[1];else{var a=this.addZero(this.currentTime.getUTCMonth()+1),c=this.addZero(this.currentTime.getUTCDate()),h=this.addZero(this.currentTime.getUTCHours()),e=30<this.currentTime.getUTCMinutes()?"30":"00";this.timesaleDateString=this.currentTime.getUTCFullYear()+"_"+a+c+"_"+h+e}this.$timesaleData.children().each(function(a,
c){var f=d(c),e=f.attr("data-target"),e=b.$root.find(e);if(0!==e.length){b.timesaleTimeList[a]=[];b.timesaleImageURLs[a]=[];for(var g=[],g=f.html().split(/\s+/),f=0;f<g.length;f++)""===g[f]&&g.splice(f,1);for(f=0;f<g.length;f++)0===f%2?b.timesaleTimeList[a].push(g[f]):b.timesaleImageURLs[a].push(g[f]);for(g=0;g<b.timesaleTimeList[a].length;g++)if(b.timesaleTimeList[a][g]===b.timesaleDateString){e.attr("src",b.timesaleImageURLs[a][g]);break}}})},bindEvents:function(){function b(){a.frameWidth=a.$itemFrame.outerWidth(!0);
if(a.frameWidth>a.itemWidth*a.$items.length-1)a.stopAutoSlide(),a.isActive=!1;else if(!a.isActive)a.startAutoSlide(),a.isActive=!0}var a=this;"right"===this.direction&&this.$itemBox.css("left",0-this.itemWidth);this.$itemFrame.hover(function(){a.isActive&&a.$itemBox.stop()},function(){a.isActive&&(a.$itemBox.stop(),"left"===a.direction?a.moveLeft(a.slideTime):"right"===a.direction&&a.moveRight(a.slideTime))});this.$items.each(function(b,h){var e=d(h);e.hover(function(){a.isIE789?e.animate({top:0-
a.itemHeight},150,"linear"):e.css("z-index",a.baseZIndex+1)},function(){a.isIE789?e.animate({top:0},500,"linear"):setTimeout(function(){e.css("z-index",a.defaults.baseZIndex)},a.mouseLeaveTime)})});d(window).bind("resize",function(){clearTimeout(a.resizeID);a.resizeID=setTimeout(function(){b()},250)});b()},startAutoSlide:function(){"left"===this.direction?this.moveLeft(this.slideTime):"right"===this.direction&&this.moveRight(this.slideTime)},stopAutoSlide:function(){this.$itemBox.stop().css("left",
0)},moveLeft:function(b){var a=this,c=parseInt(this.$itemBox.css("left"));this.$itemBox.animate({left:-this.itemWidth},b+c/this.itemWidth*b,"linear",function(){a.$itemBox.css("left",0).children().eq(0).appendTo(a.$itemBox);a.moveLeft(b)})},moveRight:function(b){var a=this,c=parseInt(this.$itemBox.css("left"));this.$itemBox.animate({left:0},b-(this.itemWidth+c)/this.itemWidth*b,"linear",function(){a.$itemBox.children().last().prependTo(a.$itemBox);a.$itemBox.css("left",0-a.itemWidth);a.moveRight(b)})},
addZero:function(b){return 10>b?"0"+b:""+b},fireEvent:function(b,a,c){a=d.Event(a);a.customData=c||{};b.trigger(a)}};var i=d("#RJSFestivalBannerSlider");0<i.length?new k(i):d(function(){i=d("#RJSFestivalBannerSlider");0<i.length&&new k(i)})}})();
