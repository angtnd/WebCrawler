/**
 * @modified $Author: mushaofeng $
 * @version $Rev: 0e7c70c09dbc1b8788bac3dc2428b33456dcbddd $
 */
!function(e){require.config({enable_ozma:true});define("page/find/main/model",["tui/event","tui/net","module/login/login"],function(e,t,n){var i=e.extend({initialize:function(){var e=this;i.superClass.initialize.call(e);this.uid=n.getUserInfo()&&n.getUserInfo().uid||0;this.cookie_id=n.guid();e.op={callbackName:"callback",charset:"utf-8"};e.config={currentRecommendStatus:0,tryJsonTime:3,recommendNumber:12,anonymousRecommendNumber:12,loginStatus:n.isLogin(),randomArray:[],req_id:e.randomStr(3),maxRefreshCount:3,lockRecommend:true,lockRecommendData:true}},getRecommendData:function(){var e=this,n;var i=e.config;if(i.loginStatus)n="http://ykrec.youku.com/personal/packed/list.json?apptype=1&pg=8&module=1&pl="+parseInt(i.recommendNumber)*parseInt(i.maxRefreshCount)+"&picSize=1&module=1&pz=30&req_id="+i.req_id+"&uid="+e.uid;else n="http://ykrec.youku.com/personal/packed/list.json?apptype=1&pg=8&module=1&pl="+parseInt(i.anonymousRecommendNumber)*parseInt(i.maxRefreshCount)+"&picSize=1&module=1&pz=30&req_id="+i.req_id;t.getJSON(n,{guid:e.cookie_id,timestamp:e.randomStr(10)},function(t){var n=t.data;if("undefined"==typeof n||n.length<i.recommendNumber)if(e.currentRecommendStatus<i.tryJsonTime){e.getRecommendData();e.currentRecommendStatus++}else return false;else e.trigger("recommend:success",[n])},e.op)},randomStr:function(e){var t="0123456789qwertyuioplkjhgfdsazxcvbnm";var n="";var i=(new Date).getTime();for(var a=0;a<e;a++)n+=t.charAt(Math.ceil(1e8*Math.random())%t.length);return i+n}});return i});define("page/find/main/recommend",["tui/net","module/login/login","tui/view","tui/art","tui/util/num","tui/util/date","page/find/main/model"],function(t,n,i,a,r,s,o){return i.extend({el:e("#ykRecommend"),events:{"click .yk-rec-refresh":"refreshDom"},initialize:function(){var e=this;this.refreshCount=0;this.recData=[];this.data=new o;this.config=this.data.config;this.data.bind("recommend:success",this.renderREC.bind(this));e.data["getRecommendData"].call(e.data)},renderREC:function(e){this.recData=e;e=this.recData.slice(0,this.config.recommendNumber);this.renderData(e)},renderData:function(t){var n='        <div class="yk-row">\n<% data.forEach(function(t, i){ %>\n<% if (config.loginStatus==true) { %>\n<% var module=1 %>\n<% }else { %>\n<% var module=3 %>\n<% } %>\n<% var pos=count+i %>\n<% var log=\'{"apt":"1","pg":"8","md":"\'+module+\'","id":"\'+ t.id +\'","abver":"A","dma":"\' + t.dma + \'","pos":"\' + pos + \'","ord":"0","algInfo":"\' + t.algInfo + \'","dct":"\' + t.dct + \'","req_id":"\'+config.req_id+\'"}\'%>\n<%log=encodeURIComponent(log)%>\n<% if (i%2==0){ %>\n<div class="yk-col4 <%if (i==6){%>  colx  <%}else if(i==4){%> colxx <%}%>">\n<% } %>\n<div class="yk-pack p-list <% if ((i+1)%2!=0){%>  mb20 <%}%>" taglog="<%=log%>">\n<div class="p-thumb">\n<a href="<%=t.playLink%>" title="<%=t.title%>" target="new"></a>\n<i class="bg"></i>\n<img class="quic" src="<%=t.picUrl%>">\n</div>\n<ul class="p-info pos-bottom">\n<li class="status">\n<span class="p-time hover-hide">\n<i class="ibg"></i>\n<span><%=sec(t.totalTime,false)%></span>\n</span>\n</li>\n</ul>\n<ul class="info-list">\n<li class="title" >\n<a href="<%=t.playLink%>" target="_blank"><%=t.title%></a>\n</li>\n<li class="num">\n<span class="num-play"><%=num(t.playAmount)%></span>\n<span class="num-comment"><%=num(t.commentCount)%></span>\n</li>\n</ul>\n</div>\n<%if ((i+1)%2==0){ %>\n</div>\n<% } %>\n<% }); %>\n</div>\n',i=a.compile(n)({data:t,num:r.field,sec:s.beautyTime,encodeURIComponent:encodeURIComponent,config:this.config,count:this.refreshCount*this.config.recommendNumber}),o=e("#ykRecommend");o.find(".c").append(i);o.removeClass("ajax-loading").css("display","block");this.trigger("refresh:success",[])},refreshDom:function(){var t=this;var n=e("#ykRecommend").addClass("ajax-loading").find(">.c").empty();this.refreshCount<this.config.maxRefreshCount-1?this.refreshCount++:this.refreshCount=0;var i=this.refreshCount*this.config.recommendNumber;var a=i+this.config.recommendNumber;var r=this.recData.slice(i,a);var s=setTimeout(function(){t.renderData(r);clearTimeout(s)},300)}})});define("page/find/main/fixmod",["tui/view","tui/art","tui/util/num"],function(t,n,i){var a=e(window);var r=t.extend({el:e("#FixMod"),initialize:function(t){var n=this,i;r.superClass.initialize.call(n);this.mods=e(".mod-fix");this.modPos=[];this.curIndex=-1;this.clickEvent=false;n.check();this.render();this.setCenter();a.scroll(function(){if(!n.clickEvent)n.initStatus()});a.bind("scroll resize",function(){i&&clearTimeout(i);i=setTimeout(function(){n.check.call(n)},100)})},events:{"click li":"goIndex"},render:function(){var t,n,i="";t=this;e.each(this.mods,function(t,n){i+='<li class="gray" data-stat-role="ck"><i class="fix-tip">'+e(n).attr("title")+'</i><img  src="'+e(n).attr("src")+'"/></li>'});this.$el.html(i);this.$el.find(">li").hover(function(){e(this).removeClass("gray")},function(){if(!e(this).hasClass("current"))e(this).addClass("gray")});this.initStatus();e("#sideBar").css("display","block")},check:function(){var t=e("body")[0];var n=t.className.match(/w(\d+)/)[1];var i=a.width();if(i-n<125||a.scrollTop()<350)e(this.el).fadeOut("fast");else e(this.el).fadeIn("fast");this.setCenter()},initStatus:function(){this.getCurIndex();this.setCurrent()},goIndex:function(t){var n,i,a;this.getPos();a=this;n=this.items.index(e(t.currentTarget));i=this.mods.eq(n).offset().top-200;this.clickEvent=true;e("body,html").animate({scrollTop:i},600,function(){a.curIndex=n;a.setCurrent();a.clickEvent=false})},getPos:function(){var t=this,n;this.items=this.$el.find("li");t.modPos=[];e.each(this.mods,function(i,a){n=e(a).parents(".mod").offset().top;t.modPos.push(n)})},getCurIndex:function(){var t=this,n,i,r=true;i=a.scrollTop();this.getPos();t.curIndex=-1;e.each(this.mods,function(e,n){if(t.modPos[e]>=i&&t.modPos[e]<=i+a.height()&&r){t.curIndex=e;r=false}})},setCurrent:function(){this.items.removeClass("current").addClass("gray");if(this.curIndex>=0)this.items.eq(this.curIndex).addClass("current").removeClass("gray")},setCenter:function(){var t=e("#sideBar"),n=e(".yk-header"),i=a.height()-e(n).height(),r=e(this.el).height(),s=parseInt((i-r)/2);if(s>135&&e(this.el).is(":visible"))e(this.el).css({bottom:s+"px"});else e(this.el).css({bottom:"135px"})}});return r});define("tui/slide2",["tui/event","tui/browser","tui/lazyImageLoader"],function(t,n){var i=t.extend({initialize:function(t){var s=this;s.box=t;s.panel=t.find(".panel");i.superClass.initialize.apply(s,arguments);s.current=0;var o=s.box.find(".lazyContent");if(o[0]){s.box.eq(0).html(o.val());n({imgs:s.box.find(".lazyImg")})}setTimeout(function(){s.setPos()},100);t.delegate(".mbtn a","click",function(t){t.preventDefault();s.setPos();var n=e(this).closest(".mbtn").hasClass("next");var i=n?s.current>=s.step?s.step:++s.current:s.current<=0?0:--s.current;r(s.panel,s.pos[i]);s.resetBtn();a(s.panel)});e(window).bind("resize",function(){if(s.panel.is(":visible"))s.setPos()})},resetBtn:function(){var e=this;var t=e.box.find(".prev, .next");switch(e.current){case 0:t.eq(1).show();t.eq(0).hide();break;case e.step-1:t.eq(0).show();t.eq(1).hide();break;default:t.show()}},setPos:function(){var t=this;var n=t.box;var i=t.box.width();var a=0;t.$item=t.panel.children();t.pos=[0];var r=t.box.attr("id");t.panel.css({width:5e4});e.each(t.$item,function(n){var r=e(this),s=r.width();a=r.position().left+s;if(r.position().left+s>i*t.pos.length)t.pos.push(r.position().left);if(n==t.$item.length-1&&a-i>0){var o=t.pos.length;if(1==o)t.pos.push(a-i);else{t.pos[o-1]=a-i;if(t.pos[o-1]==t.pos[o-2])t.pos.pop()}}});if(1==t.pos.length)n.find(".next").hide();if(a<400)a=5e4;else a+=20;t.panel.css({width:a});t.step=t.pos.length},reload:function(){var e=this;e.current=0;e.panel.css({left:0});e.resetBtn()}});function a(t){var n=t.find("img.lazyLoad");var i;n.each(function(t,n){i=e(n);i.attr("src",i.attr("alt"));i.removeAttr("alt").removeClass("lazyLoad")})}function r(e,t){e.animate({left:-t},300)}var s={};return function(t){var t=t||e(document);var n=e(".modPSlide",t);var a;if(n[0])n.each(function(t,n){a=e(n).attr("id");if(s[a])s[a].reload();else s[a]=new i(e("#"+a))})}});define("module/ui/switchtab",["tui/lazyImageLoader","tui/event"],function(t,n){jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{easeInOutQuad:function(e,t,n,i,a){if((t/=a/2)<1)return i/2*t*t*t+n;return i/2*((t-=2)*t*t+2)+n}});function i(t){if(t&&t.tagName){var n="a"==t.tagName.toLowerCase()?e(t):e(t).find("a");n=n.length?n:e(t);return(n.attr("rel")||n.attr("href").replace(/.*#(\d+)$/,"$1")||1)-1}else return 0}function a(e){var t=arguments;for(var n=0,i=t.length;n<i;n++){var e=t[n];if(e)clearTimeout(e)}return null}var r=n.extend({initialize:function(n){var s=this;r.superClass.initialize.apply(s,arguments);s.op=n||{};s.op.slide=n.slide||false;s.op.linktab=n.linktab||false;s.op.clicktab=n.clicktab||false;s.op.lazyContent=n.lazyContent||window.gLazyContent||false;var o=s.box=e(n.box);var l=s.tab=e(n.tab||".tab li",o);var u=s.panel=e(n.panel||".c",o);s.size=l.length||u.length;s.loop=n.loop||0;s.current=i(l.filter(".current")[0]);if(s.op.slide){s.scroll=u.parent().parent();s.scroll.scrollLeft(0);t({imgs:u.eq(s.current).find(".lazyImg")});u.parent().append(u.eq(0).clone());s.panel=e(n.panel||".c",o);s.width=u.width();s.delay=n.delay||700;s.loop=(s.loop||5e3)+s.delay;s.anilock=false}if(s.size<2)return;if(s.op.clicktab)l.click(function(e){e.preventDefault();s.go(i(this))});else{if(!s.op.linktab)l.click(function(e){e.preventDefault()});l.mouseenter(function(){a(s.timer,s.looptimer);var e=this;s.timer=setTimeout(function(){s.go(i(e))},30)}).mouseleave(function(){a(s.timer,s.looptimer);s.start()})}if(s.loop){s.check(s.op.clicktab?l:null);s.start()}l.parent().on("click","a",function(t){var n=e(this).attr("href");if(!n||"#"==n||n.length<5)t.preventDefault()})},on:function(e,t){this.box.eventProxy(e,t);return this},go:function(e,t){var n=this;e=t?e:Math.min(Math.max(e,0),n.size-1);n.trigger("before",[n.current,e,n]);if(n.op.slide){if(n.anilock){n.nextstep=function(){n.animate(e,t)};return}n.animate(e,t)}else{var i=n.current;n.current=e%n.size;n.trigger("change",[n.current,n]);n.tab.removeClass("current").eq(n.current).addClass("current");var a=n.op.fade;var r=n.panel;a?r.eq(i).stop().fadeOut(100):r.hide();r.eq(n.current)[a?"fadeIn":"show"](n.op.duration?n.op.duration:0);n.trigger("after",[n.current,n])}},prev:function(e){this.go(this.current-1,e)},next:function(e){this.go(this.current+1,e)},start:function(e){var t=this;if(t.loop){a(t.looptimer);if(e)t.start();t.looptimer=setTimeout(function(){t.start();t.next(true)},t.loop)}},stop:function(){a(this.looptimer)},check:function(e){var t=this;(e||t.panel).mouseenter(function(){a(t.looptimer)}).mouseleave(function(){a(t.looptimer);t.start()})},animate:function(e,n){var i=this;var r=i.current;if(i.anilock||r==e)return;a(i.looptimer);var s=i.size,o=i.width,l=i.panel,u=i.scroll;var c=r>e?0:o;var d=r>e?o:0;e%=n?s+1:s;t({imgs:l.eq(e).show().find(".lazyImg")});u.scrollLeft(d);i.tab.removeClass("current").eq(e%s).addClass("current");u.animate({scrollLeft:c},i.delay,"easeInOutQuad",function(){l.eq(r).hide();if(n&&e==s){e%=s;t({imgs:l.eq(0).show().find(".lazyImg")});l.eq(s).hide()}u.scrollLeft(0);i.current=e;i.anilock=false;i.trigger("after",[i.current,i]);if(i.nextstep){i.nextstep();i.nextstep=null}if(n)i.start()});i.anilock=true}});return r});define("page/find/main/switchtab",["module/ui/switchtab","tui/lazyImageLoader","tui/slide2"],function(t,n,i){return function(){var a=e(".modSwitch");a.delegate("a","click",function(t){var n=e(this).attr("href");if(!n||"#"==n)t.preventDefault()});if(a[0])a.each(function(a,r){var s=new t({box:r,tab:".t_tab li",panel:".tab-c",linktab:true});s.bind("change",function(t){var a=s.panel.eq(t);var r=a.children().eq(0);if(r.hasClass("lazyContent")){a.html(r.val());n({imgs:a.find(".lazyImg")});setTimeout(function(){i(a);e(document).trigger("domChanged")},200)}})})}});define("module/subscribe/curve-motion",[],function(){var t=.0017;var n=function(n,i,a){if(!e.isArray(n))return;if(e.isFunction(i)){a=i;i={}}this.options=i||(i={});if(i.easing)this._easing=i.easing;if(i.gravity)t=i.gravity;this.originX=n[0];this.originY=n[1];this.targetX=n[2];this.targetY=n[3];this.absX=Math.abs(this.targetX-this.originX);this.absY=Math.abs(this.targetY-this.originY);this.upward=this.targetY-this.originY<0;this.angle=180*Math.atan(this.absY/this.absX)/Math.PI;this.angle+=Math.cos(this.angle*Math.PI/180)*(i.elevationAngle||0);this.rad=this.angle*Math.PI/180;this.speed=Math.sqrt(t*this.absX*this.absX/(2*(this.absX*Math.tan(this.rad)-this.absY)),2)/Math.cos(this.rad);this.duration=this.absX/(this.speed*Math.cos(this.rad));this.draw=this.draw.bind(this);this._completeCallback=e.isFunction(a)&&a||function(){}};n.prototype={draw:function(){var e=+new Date-this.startTime;e=Math.min(e/this.duration,1);e=this._easing(e);if(e<1&&!this._paused)a(this.draw);var t=this._calcX(this.originX,this.targetX,e);var n=this._calcY(Math.abs(this.upward?t-this.originX:this.targetX-t));if(this._frameTimer)clearTimeout(this._frameTimer);var i=this;i._frameTimer=setTimeout(function(){if(i._useTransform)i._updateCallback(t-i.originX,i.upward?-n:i.absY-n);else i._updateCallback(t,i.upward?i.originY-n:i.targetY-n);if(1==e)i._completeCallback(t,n)},0)},start:function(){this._paused=false;this.startTime=+new Date;this.draw()},pause:function(){this._paused=true},updateFrame:function(e,t){this._updateCallback=e;this._useTransform=!!t},_calcX:function(e,t,n){return e+(t-e)*n},_calcY:function(e){return e*Math.tan(this.rad)-t*e*e/(2*Math.pow(this.speed*Math.cos(this.rad),2))},_easing:function(e){return e*e*(3-2*e)}};var i=!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame);var a=window.requestAnimationFrame||function(){var e=0;return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){var n=(new Date).getTime(),i;i=Math.max(0,16-(n-e));e=n+i;return setTimeout(function(){t(n+i)},i)}}();n.supportCSSTransform=i;return n});define("module/subscribe/curvefly",["tui/view","module/subscribe/curve-motion"],function(t,n){var i;var a=t.extend({initialize:function(){this._coords=this.options.coords;this._picurl=this.options.picurl||null;this._motion=new n(this._coords,{elevationAngle:this.options.elevationAngle||33},this._complete.bind(this));this._motion.updateFrame(this._update.bind(this),n.supportCSSTransform);this.render()},remove:function(){a.superClass.remove.call(this)},render:function(){var t=this._picurl;if(!(t&&t.indexOf("&#x")!==-1)){t=this._picurl?'<img src="'+this._picurl+'" />':'<i class="iconfont">&#xe637;</i>';var n=e('<div class="g-subs-ani">'+t+"</div>")}else var n=e('<div class="g-subs-ani g-curvefly-wrap">'+t+"</div>");n.css({left:this._coords[0],top:this._coords[1]});e(document.body).append(n);this.setElement(n)},start:function(){this.$el.show();this._motion.start()},pause:function(){this._motion.pause()},_update:function(e,t){if(n.supportCSSTransform)this.$el.get(0).style[r+"Transform"]="translate3d("+e+"px, "+t+"px, 0)";else this.$el.css({left:e,top:t})},_complete:function(){var e=this.$el;if(n.supportCSSTransform)e.get(0).style[r+"Transform"]="none";e.css({left:this._coords[2],top:this._coords[3]}).fadeOut(300)}});a.create=function(e,t,n,r,s,o){a.destory();i=new a({coords:[e,t,n,r],picurl:s,elevationAngle:o});return i};a.destory=function(){if(i){i.remove();i=null}};var r="";var s=document.createElement("div");e.each({Webkit:"webkit",Moz:"moz",O:"o",ms:"ms"},function(e,t){if(void 0!==s.style[e+"TransitionProperty"]){r=e;return false}});return a});define("module/subscribe/subscribe",["tui/event","module/login/login","tui/net","module/subscribe/curvefly"],function(t,n,i,a){var r=t.extend({initialize:function(t){var i=this;r.superClass.initialize.call(i);i.loading=false;if(!t.box)return;i.CACHE={};setTimeout(function(){i.checkSub(t.box)},0);e(document).bind("login",function(){i.checkSub(t.box)});if(t.update)i.bind("update:sucess",t.update.bind(i));e(".sub-action",t.box).bind("click",function(t){t.preventDefault();if(i.loading)return;i.loading=true;var a=e(this),r=a.attr("data-id"),s=a.attr("data-log"),o=a.attr("data-img"),l={addtion:s},u=i.CACHE[r];n.login(function(){if(a.hasClass("sub-done")){a.addClass("sub-done-loading").text("åæ¶ä¸­");l.unfollow=r}else{if(o)i.animate(o,a);l.follow=r}i.sub.apply(i,[a,l])});if(!n.isLogin())i.loading=false});e(".sub-action",t.box).hover(function(){var t=e(this);if(t.hasClass("sub-done")&&!t.hasClass("sub-done-loading"))t.addClass("sub-done-hover").text("åæ¶è®¢é")},function(){var t=e(this);if(t.hasClass("sub-done")&&!t.hasClass("sub-done-loading"))t.removeClass("sub-done-hover").text("å·²è®¢é");else if(!t.hasClass("sub-done-loading"))t.removeClass("sub-done-hover").removeClass("sub-add-hover").text("è®¢é")})},animate:function(t,n){var i=e("#qheader_sub_num").parent().offset();var r=i.left+8;var s=i.top;var o=n.offset();var l=o.left+8;var u=o.top-4;a.create(l,u,r,s,t,18).start()},checkSub:function(t){var n=this;var a=target_array_uid=[];var r={};if(!uid)return;e(t).find(".sub-action").each(function(t,i){var a=e(i).attr("data-id"),r=CHUDA.Common.encodeUid(a);target_array_uid.push('"'+r+'"');if(n.CACHE[r])n.CACHE[r].el.push(i);else n.CACHE[r]={follow:a,encodeUid:r,el:[i]}});if(!target_array_uid.length)return;url="http://yws.youku.com/friendships/js_show.json?source_uid="+CHUDA.Common.encodeUid(uid)+"&target_array_uid=["+target_array_uid.join(",")+"]";i.getJSON(url,{},function(t){if(1==t.error)e(t.target).each(function(e,t){if(t.followed){var i=n.CACHE[t.id];if(i.el)n.update(i.el)}})},{callbackName:"callback",traditional:true})},update:function(t){var n=this;e(t).each(function(t,i){if(e(i).hasClass("sub-done"))e(i).removeClass("sub-done sub-done-loading").addClass("sub-add-hover").html("è®¢é");else e(i).removeClass("sub-add-hover").addClass("sub-done").html("å·²è®¢é");n.trigger("update:sucess",[e(i)])})},sub:function(t,n){var a=this;i.getJSON("http://i.youku.com/u/subToUpdates",n,function(n){if(1==n){a.update(t);if(e(t).hasClass("sub-done"))e(t).removeClass("sub-done-hover")}a.loading=false},{callbackName:"callback",charset:"utf-8"})}});return r});require(["page/find/g","module/subscribe/subscribe","tui/slide2","page/find/main/switchtab","page/find/main/fixmod","page/find/main/recommend"],function(t,n,i,a,r,s){t.init();var o=new r;var l=new s;l.bind("refresh:success",function(){o.initStatus()});var u=new n({box:e(".yk-content")});i();a()})}(window.jQuery);;