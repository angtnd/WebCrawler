/*
 checkEntry 1.0.0 
 Copyright(c) 2013 Rakuten.Inc
 Date: 2013-02-27 17:30:51
*/
(function(j,e){if(j.jQuery!==e){jQuery.noConflict();var g=jQuery;if(g.RJS_Helpers){var k=function(){var a=this;g.extend(a,{settings:{jsonurl:["","Str","^http(s?)+(:\\/\\/[a-zA-Z0-9_\\-\\.]+)(\\.rakuten\\.co\\.jp\\/)+([a-zA-Z0-9_&=\\?\\-\\.\\/]+)$"],ajaxtimeout:[3,"Range","1,99"],campaignid:["","Str","^([0-9,]+)$"]},eobj:{checkentry:null,config:null,alreadyentry:null,nonentry:null},status:{isTimeout:!1},localStorage:{key:"",alreadyEntryList:null,garbageKey:"checkEntryGarbageTimer",expireIn:604800,
isSupport:!0},initialize:function(d){a.eobj.checkentry=d;a.eobj.config=d.find(".checkEntryConfig");a.eobj.nonentry=d.find(".nonEntryBanner");a.eobj.alreadyentry=d.find(".alreadyEntryBanner");if(0!=a.eobj.alreadyentry.length)if(0==a.eobj.config.length)a.showNonEntry();else{if("undefined"===typeof localStorage||!localStorage||"undefined"===typeof JSON)a.localStorage.isSupport=!1;a.getSettings()&&a.begin()}},indexOf:function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},getSettings:function(){a.settings=
g.RJS_Helpers.readAttr(a.eobj.config,a.settings);if(""==a.settings.jsonurl||""==a.settings.campaignid)return!1;a.settings.ajaxtimeout*=1E3;a.eobj.config.remove();return!0},getLocalStorage:function(){a.localStorage.alreadyEntryList=localStorage[a.localStorage.key]==e?[]:JSON.parse(localStorage[a.localStorage.key]);return a},setGarbageTimer:function(){var d,b=a.localStorage.garbageKey,c=(new Date).getTime();d=localStorage[b]==e?JSON.parse("{}"):JSON.parse(localStorage[b]);for(obj in d)(c-d[obj])/1E3>
a.localStorage.expireIn&&(localStorage.removeItem(obj),delete d[obj]);d[a.localStorage.key]==e&&(d[a.localStorage.key]=c);localStorage[b]=JSON.stringify(d)},getCookie:function(a){var b,c,h,f=document.cookie.split(";");for(b=0;b<f.length;b++)if(c=f[b].substr(0,f[b].indexOf("=")),h=f[b].substr(f[b].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a)return unescape(h)},isAlreadyEntry:function(){for(var d=a.settings.campaignid.split(","),b=a.localStorage.alreadyEntryList,c=0;c<d.length;c++)if(d[c]=parseInt(d[c]),
-1!=a.indexOf(b,d[c]))return!0;return!1},begin:function(){if(a.getCookie("Rz")!=e)a.localStorage.isSupport?(a.localStorage.key="checkentry-"+a.getCookie("Rz").substr(23,8),a.setGarbageTimer(),a.getLocalStorage(),0<a.localStorage.alreadyEntryList.length&&a.isAlreadyEntry()?a.showAlreadyEntry():a.getData()):a.getData()},getData:function(){var d;a.status.isTimeout=!1;try{d=setTimeout(function(){a.status.isTimeout=!0;a.showNonEntry()},a.settings.ajaxtimeout),g.ajax({url:a.settings.jsonurl,dataType:"jsonp",
timeout:a.settings.ajaxtimeout,data:{n:encodeURIComponent(a.settings.campaignid)},success:function(c){if(!a.status.isTimeout){clearTimeout(d);var b,f=!1;if(null==c||"200"!=c.code)a.showNonEntry();else{a.localStorage.isSupport&&a.getLocalStorage();for(var e=0;e<c.results.length;e++)b=c.results[e],b.c_id=parseInt(b.c_id),b.result=parseInt(b.result),1==b.result&&(a.localStorage.isSupport&&-1==a.indexOf(a.localStorage.alreadyEntryList,b.c_id)&&a.localStorage.alreadyEntryList.push(b.c_id),f=!0);f?a.showAlreadyEntry():
a.showNonEntry();a.localStorage.isSupport&&(localStorage[a.localStorage.key]=JSON.stringify(a.localStorage.alreadyEntryList))}}},error:function(){a.showNonEntry();a.status.isTimeout=!0}})}catch(b){return a.showNonEntry(),!1}},showAlreadyEntry:function(){a.eobj.nonentry.hide();a.eobj.alreadyentry.show()},showNonEntry:function(){a.eobj.nonentry.show();a.eobj.alreadyentry.hide()}})},l=1;do{var i=g("#checkEntry"+l++);if(0==i.length)break;(new k).initialize(i)}while(1)}}})(this);