__d("widget.treasure.config",["common.js.jquery"],function(d,i,f,b){var a=b("common.js.jquery"),g={gameState:{unInit:0,init:1,start:2,end:3,dolottary:4},diamond:{width:20,height:20},images:{duozai:"http://s0.hao123img.com/res/treasure/duozai.png",rule:"http://s0.hao123img.com/res/treasure/treasure-rule.png",tipBox:"http://s0.hao123img.com/res/treasure/treasure-vitualHover.png",pop:"http://s0.hao123img.com/res/treasure/treasure-pop.png",state1:"http://s0.hao123img.com/res/treasure/diamond-state1.png",
state2:"http://s0.hao123img.com/res/treasure/diamond-state2.png"},lottery:{pid:"116",token:"296cd89197bcc8373c2bc8f73a88ad85",lotteryUrl:"http://zhuanla.hao123.com/lucky/draw?callback=?",submitUrl:"http://zhuanla.hao123.com/lucky/update?callback=?",goldUrl:"http://zhuanla.hao123.com/task/addvipcoin?callback=?"},duozai:{width:93,height:134,normal:{interval:100,frames:["-45 -5","-299 -5","-299 -140","-45 -5"]},working:{interval:200,frames:["-198 -5","-198 -139","-198 -139"]},jumping:{interval:200,frames:["-45 -5",
"-45 -139","-45 -273","-45 -407","-45 -5"]}},hot:{width:44,height:47,bottom:-50,finalBottom:123},progressbar:{width:60,height:171,marginLeft:13,top:-175,bottom:{small:450,other:550},score:{zero:171,one:152,two:121,three:92,four:63,five:0}},pointer:{minLeft:135,maxLeft:515}};i.exports={init:function(){this.data=g;return this},get:function(b,c){var h=this.data||{},l=(b||"").split(".");a.each(l,function(a,c){c&&"undefined"!==typeof h&&(h=h[c])});return"undefined"!==typeof h?h:c},set:function(b,c){var h,
l,e;if("undefined"===typeof c)this.data=b;else if(b=a.trim(""+(b||"")))h=b.split("."),l=h.pop(),e=this.data||{},a.each(h,function(a,c){var b=e[c];if("object"===typeof b)e=e[c];else if("undefiend"===typeof b)e=e[c]={};else throw Error("forbidden to set property["+c+"] of ["+b+"] data");}),e[l]=c;return this}}.init();return f});
__d("widget.treasure.diamondSprite",["common.js.jquery","common.js.format","common.js.animation","widget.treasure.config"],function(d,i,f,b){function a(a,c,b){this.ctx=a;this.url=c;this.diamondStore=b||{};this.create()}var g=b("common.js.jquery"),k=b("common.js.format");b("common.js.animation");var d=b("widget.treasure.config"),c=d.get("diamond");d.get("images");a.prototype.create=function(){var a=this.diamondStore,b=this.url,e=this.ctx.text();this.$tpl=g(k('<a class="g-ib treasure-item" alog-text="#{title}" href="#{url}" style="padding: 0;width:#{width}px;height:#{height}px;"></a>',
{width:c.width,height:c.height,url:b,title:e}));a&&a[b]?this.render(a[b]):this.render(1);return this.$tpl};a.prototype.render=function(a){a||(a=1);var c=this.ctx.text(),c=c+"-diamond";switch(a){case 1:this.$tpl.attr("data-state",1);break;case 2:this.$tpl.attr({"data-state":2,"alog-text":c}).addClass("treasure-diamond");break;case 3:this.$tpl.attr("data-state",3).addClass("treasure-hidden");break;default:this.$tpl.attr("data-state",3).addClass("treasure-hidden")}};i.exports=a;return f});
__d("widget.treasure.duozaiSprite",["common.js.jquery","common.js.format","common.js.animation","widget.treasure.config"],function(d,i,f,b){function a(a){this.game=a;this.normalAnimationDone=!1;this.create()}var g=b("common.js.jquery"),k=b("common.js.format"),c=b("common.js.animation"),d=b("widget.treasure.config"),h=d.get("duozai"),l=d.get("hot"),e=d.get("images");a.prototype.create=function(){this.$tpl=g(k('<div class="duozai" style="width:#{width}px;height:#{height}px;background-image:url(#{bgurl});"></div>',
{width:h.width,height:h.height,bgurl:e.duozai.src}));this.$hotTpl=g(k('<div class="duozi-hot" style="width:#{width}px;height:#{height}px;bottom:#{bottom}px;background-image:url(#{bgurl});"></div>',{width:l.width,height:l.height,bottom:l.bottom,bgurl:e.duozai.src}))};a.prototype.show=function(a){var c=this;this.$tpl.animate({bottom:"41px"},1E3,function(){c.$hotTpl.animate({bottom:l.finalBottom+"px"},500,function(){a&&a()})})};a.prototype.playNormalAnimation=function(){var a=this,b=this.$tpl[0],e=h.normal;
this.normalAnimation=c().changePosition(b,e.frames).repeat(3).then(function(){a.normalAnimationDone=!0});this.normalAnimation.start(e.interval)};a.prototype.stopNormalAnimation=function(){this.normalAnimation&&this.normalAnimation.dispose();this.normalAnimationDone=!0;this.$tpl.css("background-position","-45px -5px")};a.prototype.playWorkingAnimation=function(){var a=this.$tpl[0],b=h.working;this.normalAnimationDone||this.stopNormalAnimation();this.workingAnimation=c().changePosition(a,b.frames).repeatForever();
this.workingAnimation.start(b.interval)};a.prototype.stopWorkingAnimation=function(){this.workingAnimation&&this.workingAnimation.dispose();this.$tpl.css("background-position","-45px -5px")};a.prototype.playJumpingAnimation=function(){var a=this,b=this.$tpl[0],e=h.jumping;this.jumpingAnimation=c().changePosition(b,e.frames).then(function(){5==a.game.score&&a.$tpl.css("background-position","-45px -407px")});this.jumpingAnimation.start(e.interval)};a.prototype.stopJumpingAnimation=function(){this.jumpingAnimation&&
this.jumpingAnimation.dispose();5==this.game.score?this.$tpl.css("background-position","-45px -407px"):this.$tpl.css("background-position","-45px -5px")};i.exports=a;return f});
__d("widget.treasure.progressbarSprite",["common.js.jquery","common.js.format","common.js.animation","common.js.pageEvents","widget.treasure.config"],function(d,i,f,b){function a(a){this.width=c.width;this.height=c.height;this.marginLeft=c.marginLeft;this.score=a||0;this.create()}var g=b("common.js.jquery"),k=b("common.js.format");b("common.js.animation");b("common.js.pageEvents");d=b("widget.treasure.config");d.get("game");var c=d.get("progressbar"),h=d.get("pointer"),l=d.get("images");a.prototype.create=
function(){var a=this.renderScore(this.score);this.$tpl=g(k('<div class="progressbar-box"><div class="pointer js-pointer" style="background: url(#{bgurl})  -245px -290px  no-repeat;"></div><div class="progressbar js-progressbar" style="width:#{width}px;height:#{height}px;background: url(#{bgurl}) -322px -290px no-repeat"></div><a href="#" alog-text="\u9886\u53d6\u5956\u52b1" class="prize-btn js-prize" style="width: 56px;height: 50px;display: none;position: absolute;top: 0;left: 0;cursor:pointer"></a><a href="#" alog-text="\u5173\u95ed\u6e38\u620f" class="treasure-close js-close"></a></div>',
{bgurl:l.duozai.src,width:this.width,height:a,marginLeft:this.marginLeft,bottom:this.bottom,top:c.top,left:h.minLeft}));this.$progressbar=g(".js-progressbar",this.$tpl);this.$pointer=g(".js-pointer",this.$tpl);this.$prizeBtn=g(".js-prize",this.$tpl);this.$closeBtn=g(".js-close",this.$tpl);5==this.score&&this.$prizeBtn.show()};a.prototype.playflyanimation=function(){this.$tpl.fadeIn(1E3)};a.prototype.renderScore=function(a){var b;switch(a){case 0:b=c.score.zero;break;case 1:b=c.score.one;break;case 2:b=
c.score.two;break;case 3:b=c.score.three;break;case 4:b=c.score.four;break;case 5:b=c.score.five;break;default:b=c.score.five}this.$progressbar&&this.$progressbar.animate({height:b},1E3);5==a&&this.$prizeBtn&&this.$prizeBtn.css("display","block");return b};a.prototype.forward=function(a){this.renderScore(a)};a.prototype.back=function(){var a=this.forwardTime;this.$pointer.stop().animate({left:h.minLeft},a,"linear")};a.prototype.reset=function(){this.renderScore(0)};i.exports=a;return f});
__d("widget.treasure.treasure_ajax",["common.js.jquery"],function(d,i,f,b){function a(a){a=document.cookie.match("(?:^|; )"+window.encodeURIComponent(a)+"=([^;]+)");return null===a?void 0:window.decodeURIComponent(a[1])}function g(){var b=a("FLASHID")||a("BAIDUID");if(b)return b.split(":")[0]}var k=b("common.js.jquery");return f={doPost:function(a,b,d){b=b||{};b.c=g();k.getJSON(a,b,function(a){d&&d(a)})}}});
__d("widget.treasure.treasure_goodSubmit",["common.js.widget","widget.popup.base"],function(d,i,f,b){b("common.js.widget");b("widget.popup.base");$.widget("hao123.treasure_goodSubmit",$.lottery.popup,{options:{className:"good-confirm-box",isModel:!0},_create:function(){var a=this.element;this._baseCreate();this.element.appendTo($("body"));this.$close=$('[data-hook="good-confirm-close"]',a);this._bindEvent();this._baseShow()},_init:function(){},_bindEvent:function(){var a=this;a.$close.click(function(){a._baseHide();
a.remove();return!1})}});i.exports={pop:function(){$('<div id="treasure-good-confirm" class="treasure-good-confirm" monkey="treasure_good_confirm"><a href="#" title="\u5173\u95ed\u5f39\u7a97" class="good-confirm-close" data-hook="good-confirm-close"></a></div>').treasure_goodSubmit()}};return f});
__d("widget.treasure.treasure_good","common.js.widget,widget.popup.base,widget.canlash.imageloader,widget.treasure.treasure_ajax,widget.treasure.config,widget.treasure.treasure_goodSubmit".split(","),function(d,i,f,b){b("common.js.widget");b("widget.popup.base");b("widget.canlash.imageloader");var a=b("widget.treasure.treasure_ajax"),d=b("widget.treasure.config"),g=b("widget.treasure.treasure_goodSubmit"),k=d.get("lottery").submitUrl;$.widget("hao123.treasure_good",$.lottery.popup,{options:{className:"pop-treasure-good",
isModel:!0},_create:function(){var a=this.element;this._baseCreate();this.element.appendTo($("body"));this.valid=!1;this.$close=$('[data-hook="treasure-good-close"]',a);this.$submit=$('[data-hook="treasure-good-submit"]',a);this.$prize=$('[data-hook="treasure-good-prize"]',a);this.$name=$('[data-hook="prizer-name"]',a);this.$phone=$('[data-hook="prizer-phone"]',a);this.$address=$('[data-hook="prizer-address"]',a);this._bindEvent();this._baseShow()},_init:function(){this._paintPrize()},_paintPrize:function(){this.$prize.text(this.options.prize)},
show:function(){this._baseShow()},_commit:function(){function b(){h._baseHide();g.pop()}var h=this,d=h.options;h._valid();h.valid&&a.doPost(k,d.args,b)},_valid:function(){function a(b,c){b=$.trim(b);switch(c){case "phone":return/^0?1[3|4|5|8][0-9]\d{8}$/.test(b);default:return!!b}}var b=this.$name.val(),d=this.$phone.val(),e=this.$address.val();a(b,"notnull")?a(d,"notnull")?a(d,"phone")?a(e,"notnull")?(this.valid=!0,this.options.args.winfo.address=e,this.options.args.winfo.phone=d,this.options.args.winfo.uname=
b):(this.valid=!1,this.$address.focus()):(this.valid=!1,this.$phone.val("").focus()):(this.valid=!1,this.$phone.focus()):(this.valid=!1,this.$name.focus())},_bindEvent:function(){var a=this;this.$close.click(function(){a._baseHide();a.remove();return!1});this.$submit.click(function(){a._commit();return!1})}});i.exports={pop:function(a,b,d){var e={};e.prize=a;e.args=b;e.gameinstance=d;$('<div id="pop-treasure-good" class="pop-treasure-good" monkey="pop_treasure_good"><div class="treasure-good-prize" data-hook="treasure-good-prize"></div><input class="prizer-name" data-hook="prizer-name"><input class="prizer-phone" data-hook="prizer-phone"><textarea rows="2" cols="20" class="prizer-address" data-hook="prizer-address"></textarea><a href="#" class="treasure-good-submit" data-hook="treasure-good-submit" title="\u63d0\u4ea4"></a><a href="#" title="\u5173\u95ed\u4e2d\u5956\u5f39\u5c42" class="treasure-good-close" data-hook="treasure-good-close"></a></div>').treasure_good(e)}};
return f});
__d("widget.treasure.treasure_virtual",["common.js.widget","widget.popup.base"],function(d,i,f,b){b("common.js.widget");b("widget.popup.base");$.widget("hao123.treasure_virtual",$.lottery.popup,{options:{className:"pop-treasure-virtual",isModel:!0},_create:function(){var a=this.element;this._baseCreate();this.element.appendTo($("body"));this.$close=$('[data-hook="treasure-virtual-close"]',a);this.$submit=$('[data-hook="treasure-virtual-submit"]',a);this.$prize=$('[data-hook="treasure-virtual-prize"]',a);
this.$num=$('[data-hook="treasure-virtual-num"]',a);this.$tip=$('[data-hook="treasure-virtual-tip"]',a);this.$tipBox=$('[data-hook="treasure-virtual-tipBox"]',a);this._bindEvent();this._baseShow()},_init:function(){this._paintPrize()},_paintPrize:function(){var a=this.options;this.$prize.text(a.prize);this.$num.text(a.num)},_bindEvent:function(){var a=this;this.$close.click(function(){a._baseHide();a.remove();return!1});this.$tip.hover(function(){a.$tipBox.show()},function(){a.$tipBox.hide()})}});
i.exports={pop:function(a,b){var d={};d.prize=a;d.num=b;$('<div id="pop-treasure-virtual" class="pop-treasure-virtual" monkey="pop_treasure_virtual"><div class="treasure-virtual-prize" data-hook="treasure-virtual-prize"></div><div class="treasure-virtual-num" data-hook="treasure-virtual-num"></div><div class="treasure-virtual-tip" data-hook="treasure-virtual-tip"></div><div class="treasure-virtual-tipBox" data-hook="treasure-virtual-tipBox"></div><a href="http://life.hao123.com/?from=weekend" class="treasure-virtual-submit" data-hook="treasure-virtual-submit" title="go"></a><a href="#" title="\u5173\u95ed\u5f39\u7a97" class="treasure-virtual-close" data-hook="treasure-virtual-close"></a></div>').treasure_virtual(d)}};
return f});
__d("widget.treasure.treasure_getGold",["common.js.widget","widget.popup.base","widget.treasure.config","widget.treasure.treasure_ajax"],function(d,i,f,b){b("common.js.widget");b("widget.popup.base");var d=b("widget.treasure.config"),a=b("widget.treasure.treasure_ajax"),g=d.get("lottery").goldUrl;$.widget("hao123.treasure_getGold",$.lottery.popup,{options:{className:"gold-confirm-box",isModel:!0},_create:function(){var a=this.element;this._baseCreate();this.element.appendTo($("body"));this.$close=
$('[data-hook="gold-confirm-close"]',a);this.$goVip=$('[data-hook="gold-confirm-vip"]',a);this._bindEvent();this._baseShow()},_init:function(){},_getGold:function(){var b=this;a.doPost(g,{},function(a){0===a.errno?b.remove():(b.$goVip.remove(),b.element.addClass("treasure-gold-empty"))})},_bindEvent:function(){var a=this;a.$close.click(function(){a.remove();return!1});a.$goVip.click(function(){a._getGold()})}});i.exports={pop:function(){$('<div id="treasure-gold-confirm" class="treasure-gold-confirm" monkey="treasure_gold_confirm"><a href="http://vip.hao123.com//?from=weekend" title="\u9886\u53d6\u4f7f\u7528" class="gold-confirm-vip" data-hook="gold-confirm-vip"></a><a href="#" title="\u5173\u95ed\u5f39\u7a97" class="gold-confirm-close" data-hook="gold-confirm-close"></a></div>').treasure_getGold()}};
return f});
__d("widget.treasure.game","common.js.jquery,common.js.format,common.js.events,common.js.log,common.js.JSON,widget.canlash.imageloader,widget.treasure.config,common.js.config,common.js.store,widget.treasure.duozaiSprite,widget.treasure.progressbarSprite,widget.treasure.diamondSprite,widget.treasure.treasure_good,widget.treasure.treasure_virtual,widget.treasure.treasure_ajax,widget.treasure.treasure_getGold".split(","),function(d,i,f,b){function a(){this.state=m.unInit;this.resourceLoaded=!1;this.login=
p.get("userinfo").islanding}var g=b("common.js.jquery"),k=b("common.js.format"),c=b("common.js.events");b("common.js.log");var h=b("common.js.JSON"),l=b("widget.canlash.imageloader"),e=b("widget.treasure.config"),p=b("common.js.config"),j=b("common.js.store"),q=b("widget.treasure.duozaiSprite"),r=b("widget.treasure.progressbarSprite"),s=b("widget.treasure.diamondSprite"),t=b("widget.treasure.treasure_good"),u=b("widget.treasure.treasure_virtual"),v=b("widget.treasure.treasure_ajax"),o=b("widget.treasure.treasure_getGold");
e.get("game");var m=e.get("gameState"),n=e.get("images");a.prototype.init=function(a,b){this.diamondData=a;this.updateStore();this.$parent=b||g("body");var c=this;this.loadResource(function(a){a&&c.initGameScene()});return!0};a.prototype.updateStore=function(){j.getAll();var a=j.get("treasure-state"),b=j.get("treasure-score"),c=j.get("treasure-createtime"),d=j.get("treasure-diamonds");this.state=a?a:m.init;this.score=b?b:0;this.diamondStore=d?d:"{}";this.diamondStore=h.parse(this.diamondStore);a=
Date.parse(new Date)/1E3;!c||172800<=a-c?this.resetStore():this.createtime=c};a.prototype.resetStore=function(){var a=j.get("treasure-state"),b=j.get("treasure-score"),c=j.get("treasure-createtime"),d=j.get("treasure-diamonds");a&&j.remove("treasure-state");b&&j.remove("treasure-score");c&&j.remove("treasure-createtime");d&&j.remove("treasure-diamonds")};a.prototype.resetData=function(){this.score=0;this.state=m.unInit;this.createtime=0;this.diamondStore="{}";this.diamondStore=h.parse(this.diamondStore);
this.diamonds=[]};a.prototype.loadResource=function(a){if(this.resourceLoaded)a(!0);else{var b=this;l(n,function(c){b.resouceLoaded=c;a(c)})}};a.prototype.initGameScene=function(){var a=this;a.createStage();a.createDuozai(function(){a.$container.css("overflow","visible");5!=a.score?a.duozai.playNormalAnimation():a.duozai.$tpl.css("background-position","-45px -407px");a.createProgressBar(a.score);a.createTip();a.state!=m.start&&a.state!=m.end?a.createStartBtn():(a.$container.addClass("treasure-gameing"),
a.duozai.$hotTpl.remove(),a.duozai.$tpl.css("bottom",0),a.progressbar.playflyanimation(),a.createDiamonds());a.bindEvent()})};a.prototype.createStage=function(){this.$container=g('<div class="treasure-game" monkey="treasure-game"></div>').appendTo(this.$parent)};a.prototype.createDuozai=function(a){this.duozai=new q(this);this.$container.append(this.duozai.$tpl);5!=this.score&&this.$container.append(this.duozai.$hotTpl);this.duozai.show(a)};a.prototype.createStartBtn=function(){var a=g(k('<div></div><a class="treasure-start" href="#" title="\u5f00\u59cb\u6e38\u620f" style="background-image:url(#{bgurl})"></a>',
{bgurl:n.duozai.src}));this.$container.append(a);var b=this;a.bind("mousedown",function(){a.addClass("clicked")}).bind("click",function(){a.remove();b.start();return!1}).hover(function(){b.$tip.show()},function(){b.$tip.hide()})};a.prototype.createDiamonds=function(){var a=this,b={},d=this.diamondData,e=d.length;this.diamonds=[];if(a.state==m.start){for(var f=0;f<e;f++){var i=d[f].url.replace(/(.*)\/$/,"$1");b[i]=d[f]}g("#box-famoussite .famoussite-mainlink").each(function(){var d=this.href.replace(/(.*)\/$/,
"$1");if(b[d]){var e=new s(g(this),d,a.diamondStore);g(this).parent().append(e.$tpl);a.diamonds.push(e.$tpl);e.$tpl.click(function(){var b=parseInt(g(this).attr("data-state")),f=j.get("treasure-score")||0,b=b+1;a.diamondStore[d]=b;j.set("treasure-diamonds",h.stringify(a.diamondStore));e.render(b);if(3<=b)return 4<++f&&(f=5,c.emit("weekend.diamond-clear"),a.state=m.end,j.set("treasure-state",a.state)),a.score=f,j.set("treasure-score",f),a.progressbar.forward(f),a.duozai.playJumpingAnimation(),!1})}})}};
a.prototype.start=function(){this.resetStore();this.createtime||j.set("treasure-createtime",Date.parse(new Date)/1E3);j.set("treasure-state",m.start);j.set("treasure-score",0);this.score=0;this.state=m.start;this.duozai.stopWorkingAnimation();this.$tip.hide();this.duozai.$hotTpl.remove();this.$container.addClass("treasure-gameing");this.duozai.$tpl.css("bottom",0);this.progressbar.playflyanimation();this.createDiamonds()};a.prototype.createProgressBar=function(a){var b=this;this.progressbar=new r(a);
this.$container.append(this.progressbar.$tpl);this.progressbar.$closeBtn.click(function(){b.destroy();return!1});this.progressbar.$prizeBtn.click(function(){b.state==m.end&&(b.login?(b.restart(),b.doLottery()):g("#loginlink .login").click());return!1})};a.prototype.doLottery=function(){var a={},b=e.get("lottery"),c=a.pid=b.pid,d=a.token=b.token;v.doPost(b.lotteryUrl,a,function(a){var b=a.errno,a=a.data,e="",f={};f.pid=c;f.token=d;f.winfo={};0===b?0!=parseInt(a.prize_id)?(e=a.prize_name,f.oid=a.oid,
0==a.real?u.pop(e,a.data):t.pop(e,f)):o.pop():o.pop()})};a.prototype.bindEvent=function(){var a=this;a.duozai.$tpl.hover(function(){a.$tip.show()},function(){a.$tip.hide()});a.$container.hover(function(){5!=a.score&&(a.duozai.$hotTpl&&a.duozai.$hotTpl.hide(),a.duozai.playWorkingAnimation())},function(){5!=a.score&&(a.duozai.$hotTpl&&a.duozai.$hotTpl.show(),a.duozai.stopWorkingAnimation())});c.on("weekend.progressbar-forward",function(){a.progressbar.forward()});c.on("weekend.progressbar-reset",function(){a.progressbar.reset()});
c.on("weekend.diamond-clear",function(){for(var b=a.diamonds.length,c=0;c<b;c++)a.diamonds[c].remove()});c.on("treasure.createDiamonds",function(){a.createDiamonds()});c.on("menus.changed",function(b){0==b?a.$container.show():(window.menuChange=!0,a.$container.hide())})};a.prototype.unEvents=function(){c.un("weekend.progressbar-forward");c.un("weekend.progressbar-reset");c.un("weekend.diamond-clear");c.un("treasure.createDiamonds");c.un("menus.changed")};a.prototype.createTip=function(){this.$tip=
g(k('<div class="treasure-tip" style="background-image:url(#{bgurl})" ></div>',{bgurl:n.rule.src}));this.$container.append(this.$tip)};a.prototype.restart=function(){this.destroy();this.initGameScene()};a.prototype.destroy=function(){this.$container.remove();c.emit("weekend.diamond-clear");this.resetStore();this.resetData();this.unEvents()};i.exports=new a;return f});window.js_cwkmJkUdOx&&window.js_cwkmJkUdOx(!0);
