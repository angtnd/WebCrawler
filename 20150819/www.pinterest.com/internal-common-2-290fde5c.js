!function(){function e(e){this.name=e,this.attributes={"class":"",id:""},this.id=null,this.children=[],this.data=null,this.extraData={},this.errorStrategy=P.CONST.ErrorStrategy.REMOVE,this.options={},this.uid="",this.async=!1,this.resource=null,this.outerHtml=null,this.error=null}goog.provide("P.ModuleTree"),goog.require("P.interfaces.IResource"),goog.require("P.logging");var t=P.logging.getLogger("ModuleTree");e.prototype={setAttributes:function(e){this.attributes=e},setId:function(e){this.id=e},addChild:function(e){this.children.push(e)},setData:function(e){this.data=e},setExtraData:function(e){this.extraData=e},setErrorStrategy:function(e){this.errorStrategy=e},setError:function(e){this.error=e},setOptions:function(e){this.options=e},setUid:function(e){this.uid=e},setAsync:function(e){this.async=e},setResource:function(e){this.resource=e},setOuterHtml:function(e){this.outerHtml=e},setChildrenAndOuterHtml:function(n,r){this.children=n,this.outerHtml=e.replacePlaceholders(r,function(e){var r=n[e];if(r){var i=r.outerHtml||"";return r.outerHtml=null,i}return t.warn("child index missing",e),""})}},e.fromPlainObject=function(t){var n=new e(t.name);if("attributes"in t&&n.setAttributes(t.attributes),"id"in t&&n.setId(t.id),"data"in t&&n.setData(t.data),"extraData"in t&&n.setExtraData(t.extraData),"errorStrategy"in t&&n.setErrorStrategy(t.errorStrategy),"options"in t&&n.setOptions(t.options),"uid"in t&&n.setUid(t.uid),"async"in t&&n.setAsync(t.async),"resource"in t&&n.setResource(t.resource),"error"in t){var r=P.Error.fromPlainObject(t.error);n.setError(r)}return _.each(t.children,function(t){var r=e.fromPlainObject(t);n.addChild(r)}),n},e.getModulePlaceholder=function(e){return"<!--placeholder "+e+"-->"};var n=/<!--placeholder (\d+)-->/g;e.replacePlaceholders=function(e,r){return(null===e||void 0===e)&&t.warn("HTML is null or undefined; can't replace placeholders.",e),e.replace(n,function(e,t){var n=t;return r(n)})},P.ModuleTree=e}(),function(){goog.provide("P.moduleTemplate"),goog.provide("P.moduleTemplate.IRenderer"),goog.require("P.interfaces.IResource"),P.moduleTemplate={},P.moduleTemplate.Result=function(){this.outerHtml="",this.childrenModuleRenderOptions=[],this.options={},this.data=null,this.extraData={},this.uid=""},P.moduleTemplate.IRenderer=function(){},P.moduleTemplate.IRenderer.prototype={render:function(e,t,n,r){}}}(),function(){goog.provide("P.moduleTemplateNunjucks"),goog.require("P.moduleTemplate"),goog.require("P.experiments"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.ModuleTree"),goog.require("P.user"),goog.require("P.moduleTemplate.IRenderer");var e=P.logging.getLogger("ModuleTemplateNunjucks"),t=function(e){return nunjucks.runtime.markSafe(P.ModuleTree.getModulePlaceholder(e))},n=function(e,t){for(var n in t)"__keywords"!==n&&(e[n]=t[n])},r=function(){this.childrenModuleRenderOptions=[],this.additionalClasses=[],this.additionalAttributes={},this.data=null,this.extraData={},this.tagName=null},i=function(e,t,n,r){this.options=_.extend({},e),this.data=t,this.resource=n,this._result=r,this.module=this.module.bind(this),this.ProxyModule=this.ProxyModule.bind(this),this.tag_name=this.tag_name.bind(this),this.addclass=this.addclass.bind(this),this.attr=this.attr.bind(this),this.extra_data=this.extra_data.bind(this),this._describe=this._describe.bind(this),this._base=this._base.bind(this),this.context=_.extend({},this.context,P.CONTEXT,{is_authenticated:P.currentUser.isAuthenticated()})};i.prototype={context:{experiments:{in_experiment_group:function(e,t,n){var r=n&&n.activate;return P.experiments.instance.inExperimentGroup(e,t,r)},in_experiment_groups:function(e,t,n){var r=n&&n.activate;return P.experiments.instance.inExperimentGroups(e,t,r)},get_group_for_experiment:function(e,t){var n=t&&t.activate;return P.experiments.instance.getGroupForExperiment(e,n)},in_experiment_groups_active_or_triggered:function(e,t){return P.experiments.instance.inExperimentGroupsActiveOrTriggerable(e,t)},in_experiment_group_active_or_triggered:function(e,t){return P.experiments.instance.inExperimentGroupActiveOrTriggerable(e,t)},activate_and_persist_experiment:function(e){P.experiments.instance.activateAndPersistExperiment(e)},add_to_experiment:function(e){P.experiments.instance.addToExperiment(e)}},experiences:{is_placed_experience:function(e,t){return P.ExperienceManager.instance().isPlacedExperience(e,t)},is_placed:function(e){return P.ExperienceManager.instance().isPlaced(e)},get_placed_experience:function(e){return P.ExperienceManager.instance().getPlacedExperience(e)},experience_viewed:function(e,t){P.ExperienceManager.instance().viewPlacedExperience(e,t)},experience_completed:function(e,t){P.ExperienceManager.instance().completePlacedExperience(e,t)},trigger_placed_experiences:function(e,t){P.ExperienceManager.instance().triggerPlacedExperienceIds(e,t)}},user:P.currentUser.attributes},get_seo_experiment_group:function(e,t){},create_localized_interest_url:function(e){var t=e.url_name,n="/explore/"+t+"/";if("en-us"===P.CONTEXT.locale.toLowerCase())return n;var r=e.name.replace(" ","-").toLowerCase();return t===r?n:"/explore/"+r+"-"+e.id+"/"},module:function(e,n){n=n||{};var r=P.ModuleRenderOptions.fromPlainObject(n);r.setName(e);var i=this._result.childrenModuleRenderOptions.length;return this._result.childrenModuleRenderOptions.push(r),t(i)},ProxyModule:function(e){var n=P.ModuleRenderOptions.fromPlainObject(e),r=this._result.childrenModuleRenderOptions.length;return this._result.childrenModuleRenderOptions.push(n),t(r)},create_resource:function(e,t){t=t||{};var n=P.resourceFactory.create(e);return n.options=t.options||{},n},tag_name:function(e){this._result.tagName=e},addclass:function(e){this._result.additionalClasses.push(e)},attr:function(e){n(this._result.additionalAttributes,e)},extra_data:function(e){_.extend(this._result.extraData,e)},_describe:function(e){n(this.options,e)},_base:function(t){var n=t.replace(".","-");t||e.warn("moduleName is null or undefined",{options:this.options,data:this.data,resource:this.resource}),this.addclass(n)},Experience:P.Experiences.Experience,Placement:P.Experiences.Placement},P.moduleTemplateNunjucks.Renderer=function(e){this._templateName=e},P.moduleTemplateNunjucks.Renderer.prototype={_getOuterHtml:function(e,t,n,r){var i=t.replace(".","-"),o=["Module",i].concat(r.additionalClasses);o.sort();var s={"class":o.join(" "),id:e};_.extend(s,r.additionalAttributes);var a=r.tagName||"div",u="<"+a;return Object.keys(s).sort().forEach(function(e){var t=s[e];u+=" "+_.escape(e)+'="'+_.escape(t)+'"'}),u+=">",u+=n,u+="</"+a+">"},render:function(e,t,n,o){var s=new r,a=new i(t,n,o,s),u=P.nunjucks.render(this._templateName,a),c=_.uniqueId("m"),l=this._getOuterHtml(c,e,u,s),d=new P.moduleTemplate.Result;return d.outerHtml=l,d.options=a.options,d.childrenModuleRenderOptions=s.childrenModuleRenderOptions,d.data=n,d.extraData=s.extraData,d.uid=c,d}}}(),function(){goog.provide("P.moduleRenderer"),P.moduleRenderer=P.moduleRenderer||{},goog.provide("P.moduleRenderer.IRenderer"),P.moduleRenderer.IRenderer=function(){},P.moduleRenderer.IRenderer.prototype={render:function(e){}},goog.provide("P.moduleRendererFactory"),P.moduleRendererFactory=P.moduleRendererFactory||{},P.moduleRendererFactory.RendererConfig,P.moduleRendererFactory.moduleNameToConfig={},P.moduleRendererFactory.RendererType={LOCAL:1,REMOTE:2},P.moduleRendererFactory.getRenderer=function(e,t){var n=P.moduleRendererFactory.moduleNameToConfig[e];if(!n)throw new Error("Missing config for module "+e);return t===P.moduleRendererFactory.RendererType.LOCAL?n.localRenderer:t===P.moduleRendererFactory.RendererType.REMOTE?P.moduleRendererRemote.instance:n.defaultToLocal?n.localRenderer:P.moduleRendererRemote.instance}}(),function(){function e(){return P.loadPromise.then(function(){var e=Pc.templateBundles.map(function(e){return Promise.resolve($.ajax({dataType:"script",cache:!0,url:e}))});return Promise.all(e)})}goog.provide("P.ModuleRendererLocal"),goog.provide("P.templateLoadPromise"),goog.require("P.logging"),goog.require("P.moduleRenderer.IRenderer"),goog.require("P.moduleRendererFactory"),goog.require("P.moduleTemplate"),goog.require("P.ModuleTree"),goog.require("P.loadPromise"),goog.require("P.resourceCache");var t=P.logging.getLogger("ModuleRendererLocal"),n=Pc.lazyLoadTemplates?e():Promise.resolve();P.templateLoadPromise=n;var r=function(e){this._templateRenderer=e};r.prototype={_getData:function(e){var t=e.resource,n=e.data;if(n||!t)return Promise.resolve(n);var r;return t.options.allow_stale&&(r={freshness:P.resourceCache.Freshness.POSSIBLY_STALE_AND_INCOMPLETE}),P.resourceCache.instance.callGet(t,e,r).then(function(e){return e})},_getErrorModuleTree:function(e){var t=new P.ModuleTree(e.name);return t.setOuterHtml('<div class="Module '+e.name+'">error</div>'),Promise.resolve(t)},_getAsyncModuleTree:function(e){var t=new P.ModuleTree(e.name);e.id&&t.setId(e.id),e.options&&t.setOptions(e.options),e.resource&&t.setResource(e.resource),t.uid=_.uniqueId("m");var n=[e.name,"Module","loading"];return n.sort(),t.setChildrenAndOuterHtml([],'<div class="'+n.join(" ")+'" id="'+t.uid+'"></div>'),t.setAsync(e.async),Promise.resolve(t)},_renderModuleTree:function(e,t){var n=e.resource,r=this._templateRenderer.render(e.name,e.options,t,n);if(e.forceRenderLocal)for(var i=0;i<r.childrenModuleRenderOptions.length;i++)r.childrenModuleRenderOptions[i].setForceRenderLocal(!0);for(var o=0;o<r.childrenModuleRenderOptions.length;o++)r.childrenModuleRenderOptions[o].setHeaders(e.headers);var s=r.childrenModuleRenderOptions.map(function(e){if(e.async)return this._getAsyncModuleTree(e);var t;e.forceRenderLocal&&(t=P.moduleRendererFactory.RendererType.LOCAL);var n=P.moduleRendererFactory.getRenderer(e.name,t);return n.render(e)}.bind(this));return Promise.all(s).then(function(t){var n=t,i=new P.ModuleTree(e.name);return e.id&&i.setId(e.id),i.setOptions(r.options),e.resource&&i.setResource(e.resource),i.setData(r.data),i.setExtraData(r.extraData),i.setChildrenAndOuterHtml(n,r.outerHtml),i.setUid(r.uid),i})},render:function(e){return n.then(function(){return this._getData(e)}.bind(this)).then(function(t){return this._renderModuleTree(e,t)}.bind(this)).then(void 0,function(n){switch(t.error(n,"moduleRenderOptions",e),e.errorStrategy){case P.CONST.ErrorStrategy.SHOW:return this._getErrorModuleTree(e);case P.CONST.ErrorStrategy.REMOVE:return null;default:return t.warn("unknown moduleRenderOptions.errorStrategy",e.errorStrategy),null;case P.CONST.ErrorStrategy.BUBBLE:throw n}}.bind(this))}},P.ModuleRendererLocal=r}(),function(){goog.provide("P.moduleRendererRemote"),goog.require("P.moduleRenderer.IRenderer");var e=function(){};e.prototype={render:function(e){var t=e.resource;return t||(t=P.resourceFactory.create(P.Resource.NOOP_RESOURCE.name,P.Resource.NOOP_RESOURCE.options)),t.callGet({showError:!1},e).then(function(t){return e.id&&t.moduleTree.setId(e.id),t.moduleTree})}},P.ModuleRendererRemote=e,P.moduleRendererRemote={},P.moduleRendererRemote.instance=new e}(),function(){"use strict";function e(e,t,n,r){var o=e.$el,s=_.map(t,n);return Promise.all(s).then(function(t){var n=[],s=[];_.each(t,function(e){n=n.concat(e.errors),s=s.concat(e.warnings)});var a={$el:o,errors:n,warnings:s};return e.trigger(i,a),r&&r(a),a})}goog.provide("P.Form"),goog.provide("P.Validator"),goog.require("P.placeholder"),goog.require("P.logging"),goog.require("P.Validator");var t=P.logging.getLogger("Form"),n="hasError",r="hasWarning",i="validated",o="disabled",s="[type=submit]",a=["button","file","image","reset","submit"],u=100,c=["pinterest","password","123456","welcome","ninja","abc123","123456789","12345678","sunshine","princess","qwerty","master","michael","jordan","dragon","soccer","killer","pepper","devil","princess","1234567","iloveyou"],l=function(e,t){this.$el=e,this.rules=t};_.extend(l.prototype,Backbone.Events),_.extend(l.prototype,{validate:function(t){return e(this,this.rules,function(e){return e(this.$el)}.bind(this),t)}}),l.Required=function(e){return function(t,n){var r=t.val(),i=[],o="checkbox"===t.attr("type")&&!t.is(":checked"),s="radio"===t.attr("type")&&!t.is(":checked");if(o||s||!r){var a=e&&e.message?e.message:P._("Required");("userFirstName"===t.attr("id")||"userUserName"===t.attr("id"))&&(a=P._("Missed a spot!")),i.push(a)}var u={$el:t,errors:i,warnings:[]};return n&&n(u),Promise.resolve(u)}},l.Email=function(e){return function(t,n){var r=new RegExp(["(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*",'|^"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*"',")@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+[A-Z]{2,20}$)","|\\[(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\]$"].join(""),"i"),i=$.trim(t.val()),o=[];if(i&&!i.match(r)){var s=e&&e.message?e.message:P._("Not a valid email.");o.push(s)}var a={$el:t,errors:o,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.Name=function(e){return function(t,n){var r=$.trim(t.val()),i=[];if(!r.match(/^[^0-9].*$/)){var o=e&&e.message?e.message:P._("Not a valid name.");i.push(o)}var s={$el:t,errors:i,warnings:[]};return n&&n(s),Promise.resolve(s)}},l.Age=function(e){return function(t,n){var r=$.trim(t.val()),i=[],o=e&&e.message?e.message:P._("Not a valid age.");""!==r&&r.length<2&&(o=P._("Please enter at least two digits."),i.push(o));var s=Math.floor(r);""===r||/^\d+$/.test(r)&&s>0&&s<300||i.push(o);var a={$el:t,errors:i,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.PhoneNumber=function(e){return function(t,n){var r=$.trim(t.val()),i=r.replace(/[\(\)\+\-\. ]/g,""),o=/^(\(?\+?[0-9]*\)?)?[0-9_\- \.\(\)]*$/g,s=[];if(r&&(!r.match(o)||i.length<7)){var a=e&&e.message?e.message:P._("Not a phone number.");s.push(a)}var u={$el:t,errors:s,warnings:[]};return n&&n(u),Promise.resolve(u)}},l.Number=function(e){return function(t,n){var r=$.trim(t.val()),i=/^\d+$/,o=[];if(r&&!r.match(i)){var s=e&&e.message?e.message:P._("Not a number.");o.push(s)}var a={$el:t,errors:o,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.URL=function(e){return function(t,n){var r=t.val(),i=[];if(r&&!r.match(/^(https?:\/\/){0,1}[a-z0-9_\-]+\..+/gi)){var o=e&&e.message?e.message:P._("Not a valid url.");i.push(o)}var s={$el:t,errors:i,warnings:[]};return n&&n(s),Promise.resolve(s)}},l.Password=function(e){return function(t,n){var r=t.val(),i=[],o=$('[name="username"]'),s={shortPassStr:e&&e.shortPassStr||P._("Too short"),badPassStyle:e&&e.badPassStyle||P._("Not proper style"),samePasswordStr:e&&e.samePasswordStr||P._("Password and username can't match"),blackPassStr:e&&e.blackPassStr||P._("Please try using a stronger password"),goodPassStr:e&&e.goodPassStr||P._("Great!"),userid:o.length?o.val():""},a=$.fn.teststrength(r,s,c);if(a.length){var u=a[a.length-1];if(u){var l=a[0];i.push(l)}}var d={$el:t,errors:i,warnings:[]};return n&&n(d),Promise.resolve(d)}},l.Length=function(e){return function(t,n){var r,i,o=t.val(),s=e.max||1/0,a=e.min||0,u=e.should_trim||!1,c=[];u&&(o=o.trim());var l=o.length;l<a?(r=P.string.format(P._("Please enter at least {{ character_count }} characters."),{character_count:a}),i=e&&e.messages&&e.messages.min?e.messages.min:r,c.push(i)):l>s&&(r=P.string.format(P._("Please enter no more than {{ character_count }} characters."),{character_count:s}),i=e&&e.messages&&e.messages.max?e.messages.max:r,c.push(i));var d={$el:t,errors:c,warnings:[]};return n&&n(d),Promise.resolve(d)}},l.EqualTo=function(e){return function(t,n){var r=t.val(),i=$('[name="'+e.targetFieldName+'"]').val(),o=[];r!==i&&o.push(e.message);var s={$el:t,errors:o,warnings:[]};return n&&n(s),Promise.resolve(s)}},l.GreaterThan=function(e){return function(t,n){var r=$.trim(t.val()),i=[];r.length&&r<=e.value&&i.push(e.message);var o={$el:t,errors:i,warnings:[]};return n&&n(o),Promise.resolve(o)}},l.GreaterThanOrEqualTo=function(e){return function(t,n){var r=$.trim(t.val()),i=[];r.length&&r<e.value&&i.push(e.message);var o={$el:t,errors:i,warnings:[]};return n&&n(o),Promise.resolve(o)}},l.LaterThanOrEqualToDate=function(e){return function(t,n){var r=new Date(t.val()),i=e.date,o=[];!t.is(":disabled")&&i instanceof Date&&r.getTime()&&i.getTime()&&r<i&&o.push(e.message);var s={$el:t,errors:o,warnings:[]};return n&&n(s),Promise.resolve(s)}},l.ContainsOnlyAscii=function(e){return function(t,n){var r=t.val(),i=[],o=/^[\040-\176]*$/.test(r);o||i.push(e.message);var s={$el:t,errors:i,warnings:[]};return n&&n(s),Promise.resolve(s)}},l.CurrencyValue=function(e){return function(t,n){var r=$.trim(t.val()),i=/^\d*(\.\d\d?)?$/,o=[];if(r&&!r.match(i)){var s=e&&e.message?e.message:P._("Not a valid currency value.");o.push(s)}var a={$el:t,errors:o,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.Date=function(e){return function(t,n){var r=$.trim(t.val()),i=[],o=new Date(r);if(r&&!o.getTime()){var s=e&&e.message?e.message:P._("Not a valid date.");i.push(s)}var a={$el:t,errors:i,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.Time=function(e){return function(t,n){var r=$.trim(t.val()),i=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,o=[];if(r&&!r.match(i)){var s=e&&e.message?e.message:P._("Not a valid time.");o.push(s)}var a={$el:t,errors:o,warnings:[]};return n&&n(a),Promise.resolve(a)}},l.MatchesRegex=function(e){return function(t,n){var r=t.val(),i=[];e.pattern.test(r)||i.push(e.message);var o={$el:t,errors:i,warnings:[]};return n&&n(o),Promise.resolve(o)}},P.Validator=l,P.Form=function(e,n,r){r=r||{},this.$el=e,this.validators={},this.errorFields={},this.warningFields={},this.fastValidateFields={},this.hideErrors=!!r.hideErrors,this.prevalidating=!!r.prevalidate,this.disableAutoValidation=!!r.disableAutoValidation,this.onFieldBlur=this.onFieldBlur.bind(this),this.onFieldChange=this.onFieldChange.bind(this),this.onFieldKeyup=this.onFieldKeyup.bind(this),this.onFieldValidated=this.onFieldValidated.bind(this),this.onSubmit=this.onSubmit.bind(this),_.each(n,function(e,n){var r=this.getField(n);if(r[0]){var o=new P.Validator(r,e);this.validators[n]=o,o.on(i,this.onFieldValidated),r.on("blur",this.onFieldBlur),r.on("change",this.onFieldChange),r.on("keyup",this.onFieldKeyup)}else t.debug(n+" wasn't found in the form")}.bind(this)),this.prevalidating&&this.validate(function(){this.prevalidating=!1}.bind(this)),e.submit(this.onSubmit),e.find("[placeholder]").placeholder()},_.extend(P.Form.prototype,Backbone.Events),_.extend(P.Form.prototype,{validate:function(t){return e(this,this.validators,function(e){return e.validate()},t)},getField:function(e){var t=this.$el.find("[name="+e+"]");return"radio"===t.attr("type")&&(t=this.$el.find("[name="+e+"]:checked")),t},getFieldLabels:function(e){var t=e.attr("id"),n=this.$el.find('label[for="'+t+'"]'),r=e.closest("label",this.$el);return n.add(r)},validateField:function(e,t){var n=e.attr("name");return this.validators[n].validate(t)},getValue:function(e){var t=this.getField(e);return"checkbox"===t.attr("type")?t.is(":checked"):t.val()},getSubmitButtons:function(){return this.$el.find(s)},disableSubmitButtons:function(){this.getSubmitButtons().prop(o,!0).addClass(o)},enableSubmitButtons:function(){this.getSubmitButtons().not(".loading").prop(o,!1).removeClass(o)},hasErrors:function(e){return!(!_.find(this.errorFields,function(e){return e})&&!this.$el.find("."+n)[0])},hasWarnings:function(e){return!(!_.find(this.warningFields,function(e){return e})&&!this.$el.find("."+r)[0])},setFieldErrorsAndWarnings:function(e,t,i){this.clearFieldErrorAndWarningMessages(e);var o=!!t[0],s=!!i[0];if(this.errorFields[e.attr("name")]=o,this.warningFields[e.attr("name")]=s,!this.prevalidating&&!this.hideErrors){var a=this.getFieldLabels(e),u=a.add(e);u.toggleClass(n,o),u.toggleClass(r,s),this.appendFieldErrorMessages(e,t),this.appendFieldWarningMessages(e,i)}},appendFieldErrorMessages:function(e,t){t&&t.length&&e.parent().children().last().after('<p class="formFieldMessage formErrorMessage">'+t.join(" ")+"</p>")},appendFieldWarningMessages:function(e,t){t&&t.length&&e.parent().children().last().after('<p class="formFieldMessage formWarningMessage">'+t.join(" ")+"</p>")},clearFieldErrorAndWarningMessages:function(e){e.nextAll(".formErrorMessage, .formWarningMessage").remove()},clearAllErrorAndWarning:function(){var e,t=_.keys(this.errorFields),n=_.keys(this.warningFields),r=_.uniq(_.union(t,n));_.each(r,function(t){(this.errorFields[t]||this.warningFields[t])&&(e=this.getField(t),this.setFieldErrorsAndWarnings(e,[],[]))}.bind(this))},enableFastValidateOnField:function(e){this.fastValidateFields[e]=1},onSubmit:function(e){return e.preventDefault(),e.stopPropagation(),this.trigger("submitStarted",this.$el),this.validate(function(e,t){this.trigger(P.CONST.EVENT_SUBMIT_VALIDATED,e,t)}.bind(this))},onFieldValidated:function(e){var t=e.$el,n=e.errors,r=e.warnings;(n[0]||r[0])&&this.enableFastValidateOnField(t.attr("name")),this.setFieldErrorsAndWarnings(t,n,r),this.hasErrors()?this.disableSubmitButtons():this.enableSubmitButtons()},onFieldKeyup:function(e){if(e.keyCode!==P.keyCode.TAB){var t=$(e.target);this.fastValidateFields[t.attr("name")]&&!this.disableAutoValidation&&this.validateField(t)}},onFieldBlur:function(e){if(!this.disableAutoValidation){var t=$(e.target);_.delay(function(){this.validateField(t)}.bind(this),u)}},onFieldChange:function(e){if(!this.disableAutoValidation){var t=$(e.target);this.validateField(t)}},getData:function(e){for(var t,n,r,i,o,s=this.$el.find("input,select,textarea"),u=s.length,c={},l=0;l<u;++l)t=$(s[l]),r=t.attr("name"),void 0===r||!e&&t.is(":disabled")||(n=t.attr("type"),_.contains(a,n)||"radio"===n&&!t.is(":checked")||(i="checkbox"===n?t.is(":checked"):t.val(),_.has(c,r)?(o=c[r],_.isArray(o)||(o=[o],c[r]=o),o.push(i)):c[r]=i));return c}}),P.Errors.wrap(P.Form.prototype,["onSubmit"])}(),function(){goog.provide("P.placeholder");var e=P.logging.getLogger("Placeholder"),t="placeholder",n="placeholder",r="placeholder-visible";if(P.isPlaceholderSupported=t in document.createElement("input"),P.isPlaceholderSupported)jQuery.fn.placeholder=function(){return this};else{var i={initPlaceholder:function(){this.blur(i._onPlaceholderBlur),this.focus(i._onPlaceholderFocus),this.each(function(e,t){i._clearPlaceholder(t),i._setPlaceholder(t)})},_onPlaceholderBlur:function(){i._setPlaceholder(this)},_onPlaceholderFocus:function(){i._clearPlaceholder(this)},_setPlaceholder:function(e){var i=$(e),o=i.val();o||(e[r]=!0,i.addClass(n),e.value=i.attr(t))},_clearPlaceholder:function(e){var t=$(e);e&&e[r]&&(e[r]=!1,t.removeClass(n),e.value="")}};jQuery.fn.placeholder=function(){return i.initPlaceholder.apply(this),this};var o={get:function(e){var n=$(e),i=e[r];return i&&n.attr(t)===e.value?"":e.value},set:function(e,t){var n=$(e);return t&&e[r]?i._clearPlaceholder(e):t||i._setPlaceholder(e),e.value=t,i._setPlaceholder(e),n}};e.debug("Adding hooks on input and textarea for placeholders."),$.valHooks.input=o,$.valHooks.textarea=o,$(document).delegate("form","submit",function(){var e=$("input",this).each(i._clearPlaceholder);window.setTimeout(function(){e.each(i._setPlaceholder)},10)})}}(),function(){goog.provide("P.Module"),goog.provide("P.Module.console"),goog.provide("P.Module.objectHash"),goog.provide("P.Module.window"),goog.require("P.CONST"),goog.require("P.errors"),goog.require("P.Event"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.moduleRenderer"),goog.require("P.ModuleRenderOptions"),goog.require("P.ModuleRenderType"),goog.require("P.navigateData.NavigateData"),goog.require("P.Spinner");var e=300,t="fadeIn",n="fadeOut",r="hideModule",i=t+" "+n,o="loading",s=300,a="moduleMask",u="inModal",c="notNavigatable",l="normalNavigationOnClick",d="savedScrollLeft",h="savedScrollTop",p="data-element-type",g="data-component-type",f="data-aux",m=_.invert(P.CONST.ErrorStrategy),v=0,E=function(e,t,n){var r="other";this.object=e,this.event=t,this.fn=n,this.id="",this.object instanceof P.Module?this.id=this.object.cid:(this.id=r+v,v+=1)};P.Module=function(e){},P.Module=Backbone.View.extend({className:"Module",GACategory:null,mixins:[],CssClassName:{},constructor:function(e){Backbone.View.call(this,e),e&&(e.id&&(this.id=e.id),e.options&&this.setOptions(e.options),e.resource&&this.setResource(e.resource),e.data&&(this.data=e.data))},initialize:function(e){this.log=P.logging.getLogger(this.className),this.id=null,this.cid=this.cid||"",this.options={},e&&e.options&&(this.options=e.options),this.resource=null,this.parent=null,this.children=[],this._childrenIdMap={},this._listeners={},this._pubsubHandlers={},this.inDom=!1,this.contentReady=!1,this._html=null,this._pendingRenderRequest=!1,this._optionsDirty=!1,this.extraState={},this._spinner=null,this._$mask=null,this._loadingTimer=null,this.data=null,this.extraData=null,this.model=null,this.modal=null,this.error=null,this.onCreated()},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=this.attributes||{};if(!e["class"]){var t=["Module"],n=this.className.replace(/\./g,"-");t.push(n),e["class"]=t.join(" ")}var r=$(document.createElement(this.tagName));r.attr(e),this.setElement(r,!1)}},setAsMainModule:function(e,t,n){return this.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.hasSameOptions(e,t)&&this.contentReady&&!this._forceRefreshRequested(n)?Promise.resolve(void 0):(this.empty(),this._forceRefreshRequested(n)&&(this.extraState={}),this.setOptions(e),this.setResource(t),this.performTransition(n))},getMainModuleNavCategory:function(){return null},_forceRefreshRequested:function(e){return!!(e&&e.evt&&e.evt.data&&e.evt.data.forceRefresh)},performTransition:function(e){return this.render()},setResource:function(e){(!e||_.isEqual(e,{}))&&(e=P.Resource.NOOP_RESOURCE),this.resource=P.resourceFactory.create(e.name,e.options)},setOptions:function(e){var t=this.options;this.options=e||{},_.isEqual(t,e)||(this._optionsDirty=!0),this.onOptionsChanged(t,this.options)},updateOptions:function(e){var t=P.valueUtil.deepCopy(this.options),n=_.extend(t,e);this.setOptions(n)},updateDom:P.NOOP,updateOptionsAndDom:function(e){this.updateOptions(e),this.updateDom()},setModal:function(e){this.$el.toggleClass(u,!!e),this.modal!==e&&(this.modal=e,e&&this.onAddedToModal(e))},animateEntranceToModal:P.NOOP,animateExitFromModal:P.NOOP,prependChild:function(e){this.$el.prepend(e.$el),this.addChild(e,0)},appendChild:function(e){this.insertChild(e,this.$el)},insertChild:function(e,t,n,r){r?e.$el.insertAfter(r):e.$el.appendTo(t),this.addChild(e,n)},insertChildBefore:function(e,t,n,r){r?e.$el.insertBefore(r):e.$el.appendTo(t),this.addChild(e,n)},removeChild:function(e){if(e.parent===this){e.parent=null,this._removeListenersOnModule(e),this.children=_.filter(this.children,function(t){return e!==t}),e.id&&delete this._childrenIdMap[e.id];var t=e.getParentElement();e.detachElement(),e.onRemoved(),this.onChildRemoved(e,t)}},getChildByElement:function(e){var t=_.find(this.children,function(t){return t.$el.is(e)});return t},_getDescendantByElement:function(e){if(this.$el.is(e))return this;for(var t=0;t<this.children.length;t++){var n=this.children[t],r=n._getDescendantByElement(e);if(r)return r}return null},getChildByModuleName:function(e){var t=_.find(this.children,function(t){return t.className===e});return t},getChildrenByModuleName:function(e){var t=_.filter(this.children,function(t){return t.className===e});return t},getChildById:function(e){return this._childrenIdMap[e]},getHasError:function(){return!!this.error},removeChildById:function(e){var t=this.getChildById(e);t&&t.remove()},remove:function(){this.parent&&this.parent.removeChild(this)},detachElement:function(){this.remove(),this.$el.detach(),this.inDom&&this._setInDom(!1)},destroy:function(){this.triggerEvent(P.CONST.EVENT_DESTROYED),this.empty(),this.detachElement(),this._removeListeners(),this._subscribers&&_.each(this._subscribers,function(e){e.unsubscribe()}),this.undelegateEvents(),this.destroyed=!0,this.onDestroyed()},destroyIfEmpty:function(){return this.isEmpty()?(this.destroy(),!0):!1},empty:function(){for(this.$el.empty();this.children.length;)this.children[0].destroy();this.children=[],this._childrenIdMap={},this.contentReady=!1,this.onEmpty()},onEmpty:P.NOOP,onRendered:P.NOOP,onContentReady:P.NOOP,onAdded:P.NOOP,onRemoved:P.NOOP,onDestroyed:P.NOOP,onCreated:P.NOOP,onChildAdded:function(e){},onChildRemoved:function(e,t){},onChildRendered:P.NOOP,onAddedToDom:P.NOOP,onRemovedFromDom:P.NOOP,onPubSubMessage:function(e,t,n){},onOptionsChanged:function(e,t){},onAddedToModal:function(e){},handleError:function(e){var t=this.getFullName();this.errorStrategy===P.CONST.ErrorStrategy.REMOVE?(this.log.warn("Removing module because of error."),this.destroy()):this.errorStrategy===P.CONST.ErrorStrategy.BUBBLE&&(this.log.warn("Bubbling up the error."),this.parent&&this.parent.handleError(e)),this.log.warn("Error in: "+t+"\nError Strategy: "+m[this.errorStrategy]+"\nStack Trace:"+e.stack_trace+"\nError Object: ",e),this.triggerEvent(P.CONST.EVENT_ERROR,e,this)},getSubscriber:function(e){if(this._subscribers||(this._subscribers={}),!this._subscribers[e]){var t=P.pubsub.createSubscriber(e,{handler:this._handlePubsub,scope:this,name:this.className});this._subscribers[e]=t}return this._subscribers[e]},pubsubSubscribe:function(e,t){var n=this.getSubscriber(e);n.subscribe.apply(n,_.keys(t)),this._pubsubHandlers[e]||(this._pubsubHandlers[e]={}),_.extend(this._pubsubHandlers[e],t)},pubsubUnsubscribe:function(e,t){var n=_.tail(_.toArray(arguments)),r=this.getSubscriber(e);r.unsubscribe.apply(r,n)},_handlePubsub:function(e,t,n){var r=(this._pubsubHandlers[e]||{})[t];r&&r.call(this,e,t,n),this.onPubSubMessage(e,t,n)},ensureAuthentication:function(){if(!P.currentUser.isAuthenticated()){var e={contextualResource:this.getContextualResource(),authRedirectUrl:this.getAuthRedirectUrl()};return this.triggerEvent(P.CONST.EVENT_REQUIRES_AUTHENTICATION,e,!0),!1}return!0},getAuthRedirectUrl:function(){return P.getRegisterUrl()},getContextualResource:function(){return null},getFullName:function(){for(var e=[this.toString(!0,!0)],t=this;t.parent;)t=t.parent,e.unshift(t.toString());return e.join(">")},toString:function(e,t){var n=this.className,r=[];return e&&this.options&&r.push(P.toScrubbedArgumentString(this.options)),t&&this.resource&&"NoopResource"!==this.resource.name&&r.push("resource="+this.resource.toString()),r=r.length>0?"("+r.join(", ")+")":"",n+r},getHeight:function(e){return e=e||!1,this.$el.outerHeight(e)},getWidth:function(e){return e=e||!1,this.$el.outerWidth(e)},getOffset:function(){return this.$el.offset()},getPosition:function(){return this.$el.position()},getParentElement:function(){return this.$el.parent()},getContent:function(){return this.$el},getScrollableElement:function(){return this.getScrollableElementForElement(this.$el)},getScrollableElementForElement:function(e){var t=this.getOwnedScrollables();if(t.length>0){var n=e;n=n.add(e.parentsUntil(this.$el)),n=n.add(this.$el);var r=n.filter(t);if(r.length>0)return r.last()}return this.parent?this.parent.getScrollableElementForElement(this.$el.parent()):$(window)},listen:function(e,t,n){var r=function(){n.apply(this,_.toArray(arguments))}.bind(this);e.on(t,r);var i=new E(e,t,r);return this._listeners[i.id]||(this._listeners[i.id]=[]),this._listeners[i.id].push(i),i},childListen:function(e,t){return this.listen(this,"child:"+e,t)},delegateEvents:function(){if(!this.__wrapEvents){this.events=this.events||{},this.events["click.logging"]="_logContextEvent",this.events["click.logging ["+p+"]"]="_logContextEvent",this.events["click a"]="_handleLinkClick";var e={};_.each(this.events,function(t,n){e[n]=_.isFunction(t)?P.Errors.wrapFn("eventFunction",t):P.Errors.wrapFn(t,function(){return P.state.activeTarget=this,this[t].apply(this,_.toArray(arguments))}.bind(this))}.bind(this)),this._wrappedLogContextEvent=this.events["click.logging"],this.events=e,this.__wrapEvents=!0}return this.$el.attr(p)||0===this.$el.attr(p)?this.events["click.logging"]=this._wrappedLogContextEvent:delete this.events["click.logging"],
Backbone.View.prototype.delegateEvents.call(this)},navigate:function(e,t,n,r){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED);var i=!0,o={url:e,$el:t};n&&(o.forceRefresh=1),_.extend(o,r);var s=new RegExp("/pin/[\\w|-]+/$");if(e){var a=e.match(s);a&&a.index>=0&&P.router.get().getStatus()!==P.Router.NavStatus.READY&&(i=!1)}else i=!1;i&&this.triggerEvent(P.CONST.EVENT_NAVIGATE,o,!0)&&this.log.debug("Navigate event wasn't prevented. Navigating to:",e)},showInModal:function(e,t){var n={module:e,showModalOptions:t};this.triggerEvent(P.CONST.EVENT_MODAL,n,!0)},removeListener:function(e){e.object.off(e.event,e.fn),this._listeners[e.id]=_.filter(this._listeners[e.id],function(t){return e!==t})},triggerEvent:function(e,t,n){var r=new P.Event(e,this,t);if(this.trigger(e,r),r.shouldPropagate()&&n){for(var i=new P.Event("child:"+e,this,t),o=this.parent;o&&i.shouldPropagate();)o.trigger.call(o,i.type,i),i.currentTarget=o,o=o.parent;return i.shouldPropagate()}return r.shouldPropagate()},_removeListenersOnModule:function(e){_.each(this._listeners[e.cid],function(e){e.object.off(e.event,e.fn)}),delete this._listeners[e.cid]},showLoading:function(e,t){if(!this.isLoading()){if(e=!!e,t=t||this.$el,this.$el.addClass(o),null===this._spinner){var n=this.getLoadingSpinnerOptions();null===n||void 0!==n.enable&&!n.enable||(this._spinner=new P.Spinner(n),this._spinner.spin(t,this.getLoadingSpinnerClassName()))}e?this.showMask():this.hideMask()}},hideLoading:function(){this.$el.removeClass(o),null!==this._spinner&&(this._spinner.stop(),this._spinner=null),this.hideMask()},isLoading:function(){return this.$el.hasClass(o)},_clearLoadingTimer:function(){this._loadingTimer?(clearTimeout(this._loadingTimer),this._loadingTimer=null):this.hideLoading()},showMask:function(){null===this._$mask&&(this._$mask=$("<div></div>").addClass(a).css({left:0,top:0,width:this.getWidth(),height:this.getHeight()}).prependTo(this.$el))},hideMask:function(){null!==this._$mask&&(this._$mask.remove(),this._$mask=null)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},hideModule:function(){this.$el.addClass(r)},showModule:function(){this.$el.removeClass(r)},fadeIn:function(r){this.$el.removeClass(n).addClass(t);var i=function(){r&&r()};P.setTimeout(i,e)},fadeOut:function(r){this.$el.removeClass(t).addClass(n);var i=function(){r&&r()};P.setTimeout(i,e)},clearFades:function(){this.$el.removeClass(i)},getLoadingSpinnerOptions:function(){return _.extend({enable:!0},this.options.spinner||{})},getLoadingSpinnerClassName:function(){return null},render:function(){return this._renderInternal(!1)},renderExistingData:function(){return this._renderInternal(!0)},_renderInternal:function(e){var t=this.getParentElement();return 0===t.length&&(t=$(document.body)),this._render(t,e)},renderAdditional:function(e){if(!this.contentReady||this._pendingRenderAdditionalRequest||this.resource.atEnd())return Promise.resolve(void 0);var t=this._fetch(e,!1);return this._pendingRenderAdditionalRequest=!0,t.fin(function(){this._pendingRenderAdditionalRequest=!1,this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this)),t},renderAbort:function(){return this._pendingRenderRequest?(this.resource?this.resource.abort():this._pendingRenderRequest=!1,!0):!1},insertAfterModule:function(e,t){e.insertAfter(t.$el)},appendToElement:function(e){e.append(this.$el)},_render:function(e,t){if(this._pendingRenderRequest){if(!this._optionsDirty)return Promise.reject(new Error("render already in progress"));this.renderAbort()}this._pendingRenderAdditionalRequest&&this.resource.abort(),this._clearLoadingTimer(),this._loadingTimer=P.setTimeout(function(){this.showLoading(),this._loadingTimer=null}.bind(this),s,"_render Loading"),this._pendingRenderRequest=!0;var n=this._fetch(P.ModuleRenderType.NORMAL,t).then(function(){this._optionsDirty=!1,this.onRendered(),this.parent&&this.parent.onChildRendered(this),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this)).fin(function(){this._pendingRenderRequest=!1,this._clearLoadingTimer()}.bind(this));return n},_fetch:function(e,t){e!==P.ModuleRenderType.PREPEND&&e!==P.ModuleRenderType.APPEND&&this.resource&&this.resource.resetBookmark();var n=new P.ModuleRenderOptions(this.className);if(n.setOptions(this.options),t){var r=this.model?this.model.getData():this.data;n.setData(r)}n.setResource(this.resource),n.setRenderType(e),n.setErrorStrategy(this.errorStrategy),n.setModule(this);var i;this.options.force_render_local||P.experiments.instance.inExperimentGroup("web_force_render_local","employees")?(i=P.moduleRendererFactory.RendererType.LOCAL,n.setForceRenderLocal(!0)):this.options.force_render_remote&&(i=P.moduleRendererFactory.RendererType.REMOTE);var o=P.moduleRendererFactory.getRenderer(this.className,i);return o.render(n).then(function(t){return this.loadFromModuleTree(t,e)}.bind(this),function(e){return this.error=e,this.handleError(e),Promise.reject(e)}.bind(this))},loadFromModuleTree:function(e,t){var n=e.outerHtml,r=n?$(n):this.$el;if(t=t||P.ModuleRenderType.NORMAL,r&&t!==P.ModuleRenderType.APPEND&&t!==P.ModuleRenderType.PREPEND&&(this.contentReady=!1),e.id&&(this.id=e.id),e.data&&(this.data=e.data),e.extraData&&(this.extraData=e.extraData),e.options&&this.setOptions(e.options),e.resource&&(!e.error||t===P.ModuleRenderType.APPEND&&t===P.ModuleRenderType.PREPEND)&&this.setResource(e.resource),this.data&&this.resource&&(this.model=P.resourceCache.instance.ensureModel(this.resource,this.data)),t===P.ModuleRenderType.APPEND)r.children().appendTo(this.$el);else if(t===P.ModuleRenderType.PREPEND)r.children().prependTo(this.$el);else{var i=r.attr("id"),o=i&&!!document.getElementById(i),s=!this.inDom&&o;this.inDom=this.inDom||o,this._replaceElement(r),this.$el.removeAttr("id"),s&&this.onAddedToDom()}if(_.isUndefined(e.errorStrategy)||null===e.errorStrategy||(this.errorStrategy=e.errorStrategy),this.error=e.error,e.error)return this.handleError(e.error),Promise.resolve();if(e.async)return P.Module.allowAsyncRender&&this.render(),Promise.resolve();var a=e.children.map(function(e){return e?P.moduleFactory.create(e,this.$el,this):null}.bind(this));return Promise.all(a).then(function(){r&&t!==P.ModuleRenderType.APPEND&&t!==P.ModuleRenderType.PREPEND&&(this.contentReady=!0,this.onContentReady())}.bind(this),function(e){throw this.handleError(e),e}.bind(this))},addChild:function(e,t){var n="undefined"===typeof t&&-1||t;e.parent!==this&&(e.parent&&e.remove(),e.parent=this,-1===n?this.children.push(e):this.children.splice(n,0,e),e.id&&(this._childrenIdMap[e.id]=e),e.onAdded(),this.onChildAdded(e,t),this.inDom&&e._setInDom(!0))},isEmpty:function(){return!this.$el.html().trim()&&!this.children.length},isInModal:function(){return!!this.modal},isElement:function(e){return this.$el.get(0)===$(e).get(0)},loadFromData:function(e,t){this.log.error("override method loadFromData")},hasSameOptions:function(e,t){var n=this.hasSameModuleOptions(e),r=this.hasSameResourceOptions(t);return this.log.debug("has same options? ",n,this.options,e,r,!this.resource||this.resource.options,t),n&&r},hasSameModuleOptions:function(e){return e=e||{},_.isEqual(this.options,e)},hasSameResourceOptions:function(e){(!e||_.isEqual(e,{}))&&(e=P.Resource.NOOP_RESOURCE);var t=!this.resource&&_.isEqual(e,P.Resource.NOOP_RESOURCE);return t||this.resource&&this.resource.isEqual(e)},setChildId:function(e,t){e.parent===this&&(this.removeChildId(e),e.id=t,this._childrenIdMap[e.id]=e)},removeChildId:function(e){e.id&&e.parent===this&&(delete this._childrenIdMap[e.id],delete e.id)},getOwnedScrollables:function(){return $()},saveExtraState:function(e){if(e){var t=this.getScrollableElement().scrollTop();this.extraState={scrollableElementScrollTop:t}}this.getOwnedScrollables().each(function(e,t){var n=$(t),r=n.scrollTop(),i=n.scrollLeft();n.data(h,r),n.data(d,i)}),_.each(this.children,function(e){e.saveExtraState(!1)})},restoreExtraState:function(e){if(e){var t=this.extraState.scrollableElementScrollTop||0;this.getScrollableElement().scrollTop(t)}var n=this.getOwnedScrollables();n.length&&P.deferDomManipulation(function(){n.each(function(e,t){var n=$(t),r=n.data(h),i=n.data(d);void 0!==r&&n.scrollTop(r),void 0!==i&&n.scrollLeft(i)})}),_.each(this.children,function(e){e.restoreExtraState(!1)})},_setInDom:function(e){this.inDom!==e&&(this.inDom=e,e?this.onAddedToDom():this.onRemovedFromDom(),_.each(this.children,function(t){t._setInDom(e)}))},_replaceElement:function(e){e[0]!==this.$el[0]&&(this.empty(),this.undelegateEvents(),e.insertBefore(this.$el),this.$el.remove(),this.$el=e,this.el=e[0],this.delegateEvents())},_removeListeners:function(){_.each(this._listeners,function(e,t){_.each(e,function(e){e.object.off(e.event,e.fn)})}),this._listeners={}},_handleLinkClick:function(e){this._logContextEvent(e);var t=$(e.currentTarget),n=$(e.target),r=t.attr("href"),i=!n.hasClass(c)&&!t.hasClass(c),o=t.hasClass(l),s=t.hasClass("external"),a=n.attr("data-ga");if(a&&P.trackGAEvent(a,P.CONST.GA_ACTION_CLICK),o)return!0;if(!i)return!1;if(s)return P.changeWindowLocation(r,!0),this.triggerEvent(P.CONST.EVENT_EXTERNAL_CLICK,null,!0),!1;if(P.isOffsiteUrl(r)||!(e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)){var u=r&&r.length&&"#"!==r.charAt(0)&&!P.beginsWith(r,"javascript:")&&!P.beginsWith(r,"mailto:");return u?(this.navigate(r,n,!!t.attr("data-force-refresh")),!1):void 0}},_logContextEvent:function(e){this._logContextEventFromElem($(e.target),e)},_logContextEventFromElem:function(e,t){if(!t||!P.ContextLogger.getInstance().eventLogged(t)){var n=P.ContextLogging.EventType.CLICK,r=e.closest("["+p+"]",this.$el),i=r.parent().closest("["+g+"]");if(0!==r.length&&0!==i.length){var o=r.attr(f)||"{}",s=P.ContextEvent.fromEventType(n),a=parseInt(r.attr(p),10),u=parseInt(i.attr(g),10),c=JSON.parse(o);s.setElement(a),s.setComponent(u),s.updateAuxData(c);var l=this.getModuleAdditionalAuxData();l&&s.updateAuxData(l);var d=this.getLoggingObjectIdStr();d&&s.setObjectIdStr(d),P.ContextLogger.getInstance().addEvent(s,t)}}},_logCustomContextEvent:function(e,t,n,r){var i=P.ContextEvent.fromEventType(e);i.setElement(t),i.setComponent(n),i.updateAuxData(r),P.ContextLogger.getInstance().addEvent(i,null)},getDebugInfo:function(){return this.className},getGridIndex:function(){return this.data&&"grid_index"in this.data?this.data.grid_index:null},getModuleAdditionalAuxData:function(){var e=this.getGridIndex();return _.isNumber(e)?{grid_index:e}:null},getLoggingObjectIdStr:function(){return null},focus:function(){this.$el.focusWithoutScrolling()},getChildInfoByModuleName:function(e){function t(e){return e.data}for(var n=[],r=this,i=null;r;){if(i=r.getChildByModuleName(e))return{resource:i.resource,data:i.children.map(t)};n=n.concat(r.children),r=n.shift()}},initScroll:P.NOOP}),P.Errors.wrap(P.Module.prototype,["loadFromModuleTree","render","renderExistingData"]);var S=P.Module.extend;P.Module.extend=function(e,t){return e&&e.mixins&&_.extend.apply(_,[e].concat(e.mixins)),S.call(this,e,t)},P.Module.console=null,P.Module.window=null,P.Module.allowAsyncRender=!0}(),function(){goog.provide("P.integrationTesting"),goog.require("P.Module");var e=function(){};e.prototype.getChildrenByModuleName=function(e,t){var n=[];return _.each(e.children,function(e){e.className===t&&n.push(e),n=n.concat(this.getChildrenByModuleName(e,t))}.bind(this)),n},e.prototype.getParentsForModule=function(e){for(var t=[];e.parent;)e=e.parent,t.push(e);return t},e.prototype.getElementsForModules=function(e){return e?_.isArray(e)?_.map(e,function(e){return e.$el.get()}):[e.$el.get()]:[]},P.integrationTesting.getHelper=function(){return new e}}(),function(){goog.provide("P.tutorialManager"),goog.require("P.CONST"),goog.require("P.Event"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.interfaces.TutorialStep"),goog.require("P.logging"),goog.require("P.navigateData.NavigateData");var e=P.logging.getLogger("TutorialManager"),t=function(e,t){this.url=e,this.forceRefresh=!!t};P.TutorialManager=function(){this.TUTORIAL_CONFIG={testTutorial:{stepNames:[],nextUrlInfo:function(){return new t(null,!1)},canExit:!1,onUserExit:P.NOOP},newUserBastilleSteps:{stepNames:["NewUserInterestPicker","NewUserFindFriends","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new t("/business/getstarted/",!0):new t("/?allow_nux=no",!0)},stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},onUserExit:P.NOOP},newUserExtensionSteps:{stepNames:["NewUserInterestPicker","NewUserFindFriends","NewUserInstallExtension","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.get("is_partner")?new t("/business/getstarted/",!0):new t("/?allow_nux=no",!0)},onUserExit:P.NOOP},jpUserAutofollowSteps:{stepNames:["InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new t("/business/getstarted/",!0):new t("/?allow_nux=no",!0)},onUserExit:P.NOOP},rebuildHomeFeedSteps:{stepNames:["NewUserInterestPicker","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!1}}},nextUrlInfo:function(){return new t("/?allow_nux=no",!0)},onUserExit:P.NOOP},interestsNuxMweb:{stepNames:["NewUserWelcome","NewUserInterestPicker","NewUserSetupSpinner"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return new t("/",!0)},onUserExit:P.NOOP},profileFollow:{stepNames:["ProfileFollowOne","ProfileFollowTwo","ProfileFollowThree","ProfileFollowFour"],stepExtraData:{ProfileFollowOne:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("Like this user's boards? Follow your favorites to see their new Pins in your home feed"),zoomed_in:!0,step_type:P.CONST.StepTypes.BEGINNING,stacked_group:1}},ProfileFollowTwo:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("For example, Liz followed Samâs art and DIY boards"),zoomed_in:!0,step_type:P.CONST.StepTypes.CONTINUE,stacked_group:1},backgroundImage:"styleBoard"},ProfileFollowThree:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("When Sam adds Pins to them, Liz sees them in her home feed"),zoomed_in:!0,step_type:P.CONST.StepTypes.CONTINUE,stacked_group:1},backgroundImage:"keithProfile"},ProfileFollowFour:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("You can always unfollow boards later if you change your mind"),zoomed_in:!0,step_type:P.CONST.StepTypes.END,stacked_group:1}}},expiredSteps:{},canExit:!1,nextUrlInfo:function(){return new t(null,!1)},onUserExit:P.NOOP}},this.init()},P.TutorialManager.prototype={init:function(){this._isActive=!1,this.moduleContainer=null,this.renderModule=!0,this.progressModule=null,$("body").removeClass(this.tutorialClassName),this.tutorialName=null,this.tutorialClassName=null,this.tutorial=null,this.allStepNames=null,this.numTotalSteps=null,this.currentStep=null,this.isZoomedIn=!1},startTutorial:function(e,t){if(t=t||{},this.isTutorialActive())return Promise.reject(new Error("another tutorial is already active"));var n=this.TUTORIAL_CONFIG[e];return n?(this.moduleContainer=t.moduleContainer,this.renderModule=t.renderModule,this.progressModule=t.progressModule||this.progressModule,this._isActive?(this.renderModule===!1||this.currentModule||this._loadModuleForStep(this.currentStep),Promise.resolve()):(this._start(e,!0),Promise.resolve())):Promise.reject(new Error("tutorial config does not exist"))},setProgressModule:function(e){this.progressModule!==e&&(this.progressModule=e,this.progressModule.listen(this.progressModule,P.CONST.EVENT_NEXT,this._next.bind(this)),this.progressModule.listen(this.progressModule,P.CONST.EVENT_PREVIOUS,this._previous.bind(this)),this._updateProgressModuleStep())},stopTutorial:function(){this._isActive&&this.init()},resumeTutorial:function(){if(!this.isTutorialActive()){var e=this._getStoredData();e&&e.name&&this._start(e.name,!1)}},_start:function(e,t){var n=this.TUTORIAL_CONFIG[e];n&&(this._clear(t),this._isActive=!0,this.tutorialName=e,this.tutorialClassName=this.tutorialName+P.CONST.TUTORIAL_POSTFIX,$("body").addClass(this.tutorialClassName),this.tutorial=n,this.expiredSteps=this.tutorial.expiredSteps,this.allStepNames=this.tutorial.stepNames,this.numTotalSteps=this.tutorial.stepNames.length,this._funnelPrefix="tutorial_"+e,this.renderModule=this.renderModule===!1?!1:!0,(this.moduleContainer||!this.renderModule)&&this._setStep(this._getStoredStep()||this.allStepNames[0]))},isRunningTutorial:function(){return this._isActive},isTutorialActive:function(){return P.TutorialManager.instance().isRunningTutorial()||P.ExperienceTutorialManager.instance().isRunningTutorial()},_next:function(){var e=this._getStepIndex(this.currentStep);return this.currentStep===_.last(this.allStepNames)?void this._endTutorial(!0):void this._setStep(this.allStepNames[e+1])},_previous:function(){var e=this._getStepIndex(this.currentStep);return 0===e?(P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.LOG,P.logToServer.HTTP_METHOD.GET,{type:"tutorial",tutorial:this.tutorialName,step:this.currentStep,step_number:e,action:"exit"}),this.tutorial.onUserExit(e),void this._endTutorial(!1)):void this._setStep(this.allStepNames[e-1])},_dismiss:function(){this._endTutorial(!1)},_endTutorial:function(e){var t=function(){var t=this.tutorial.nextUrlInfo().url,n=this.tutorial.nextUrlInfo().forceRefresh;if(this._clear(!0),e&&t){var r=new P.navigateData.NavigateData;n&&(r.evt=new P.Event("",null,{forceRefresh:1})),P.getHistoryNavigator().navigate(t,r)}}.bind(this),n=function(){return this.progressModule?this.progressModule.endMandatoryFlow().then(function(){this.progressModule&&this.progressModule.remove();var e=P.app;e.updateNavigationBar()}.bind(this)):Promise.resolve()}.bind(this),r=function(){var t;if(this.currentModule){var n=e?this.currentModule.completePlacedExperience():this.currentModule.dismissPlacedExperience();t=n.fin(function(){return new Promise(function(e){this.currentModule.onExit(e)}.bind(this))}.bind(this)),this.currentModule.onTutorialComplete()}else t=Promise.resolve();return t}.bind(this);r().then(n).then(t),e&&P.trackRegisterAction(this._funnelPrefix+"_complete")},_setStep:function(t){return P.trackRegisterAction(this._funnelPrefix+"_"+t),e.debug("set step from",this.currentStep,"to",t),t!==this.currentStep?(_.contains(this.allStepNames,t)||this.expiredSteps[t]||this._endTutorial(!0),this.expiredSteps[t]&&(t=this.expiredSteps[t]),this.currentStep=t,this._saveCurrentStep(),this.currentModule?void this.currentModule.onExit(function(){this.currentModule.onRemoved(),this._loadModuleForStep(t)}.bind(this)):void(this.renderModule&&this._loadModuleForStep(this.currentStep))):void 0},_setNextStepClass:function(e){var t=$("body"),n=null,r=this._getStepIndex(e);r>0&&(n=this.allStepNames[r-1],t.removeClass(n+P.CONST.TUTORIAL_STEP_POSTFIX)),t.addClass(e+P.CONST.TUTORIAL_STEP_POSTFIX)},_updateProgressModuleStep:function(){if(this.currentStep){var e=this._getStepIndex(this.currentStep);this._setNextStepClass(this.currentStep),this.progressModule&&this.progressModule.nextStep(e+1)}},_loadModuleForStep:function(e){this.renderStepModule(e)},renderStepModule:function(e){var t=this.getModuleArgs(e);e=e?e:this.tutorial.stepNames[0],P.loadModule(t).then(function(e){var t=this.currentModule;this.currentModule=e;var n=e;n.onEnter(function(){this._renderStepModule(e,t)}.bind(this))}.bind(this))},_renderStepModule:function(e,t){e.render().then(function(){var t=this.moduleContainer.children[0];this.moduleContainer.prependChild(e),t&&t.destroy(),e.onShow(this._updateProgressModuleStep())}.bind(this))},getModuleArgs:function(e){var t=e,n={tutorial_name:this.tutorialName,current_step:this._getStepIndex(e),total_steps:this.numTotalSteps,can_exit:this.tutorial.canExit};return this.tutorial.stepExtraData&&this.tutorial.stepExtraData[e]&&(t=this.tutorial.stepExtraData[e].moduleName,$.extend(n,this.tutorial.stepExtraData[e].options||{})),{name:t,options:n}},_getStepIndex:function(e){var t=_.indexOf(this.allStepNames,e);return-1!==t?t:0},_getStoredStep:function(){var e=this._getStoredData();return e&&e.name!==this.tutorialName&&(this._clearStoredData(),e=null),e&&e.step||null},_getStoredData:function(){var e=P.SessionStorage.getItem(P.CONST.TUTORIAL_SESSION_KEY);return e&&e.experienceTutorial?null:e},_saveCurrentStep:function(){P.SessionStorage.setItem(P.CONST.TUTORIAL_SESSION_KEY,{name:this.tutorialName,step:this.currentStep,experienceTutorial:!1})},_clear:function(e){this.tutorial&&(this.stopTutorial(),e&&this._clearStoredData())},_clearStoredData:function(){P.SessionStorage.removeItem(P.CONST.TUTORIAL_SESSION_KEY)}};var n=null;P.TutorialManager.instance=function(){return n||(n=new P.TutorialManager),n}}(),function(){goog.provide("P.experienceTutorialManager"),goog.require("P.CONST"),goog.require("P.Event"),goog.require("P.logging"),goog.require("P.navigateData.NavigateData");var e=P.logging.getLogger("ExperienceTutorialManager");P.ExperienceTutorialManager=function(e){this.TUTORIAL_MAP={},this.TUTORIAL_MAP[P.Experiences.ExperienceType.NOOP]=P.ExperienceTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.GUIDE]=P.UserEducationGuideTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.NUX]=P.NuxModalTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.TOOLTIP]=P.ModalTutorial,this._tutorialManager=e,this.init()},P.ExperienceTutorialManager.prototype={init:function(){this._isActive=!1,this.experience=null,this.tutorial=null,this.currentStep=0,this.steps=null},startTutorial:function(e){if(this._tutorialManager.isTutorialActive())return Promise.reject(new Error("another tutorial is already active"));var t=this._getStoredData();return!t||e&&t.experience.id!==e.id||(e=t.experience,this.currentStep=t.step),e&&void 0!==e.type&&_.has(this.TUTORIAL_MAP,e.type)?(this._isActive=!0,this.experience=e,this.tutorial=new this.TUTORIAL_MAP[this.experience.type](this.experience,this),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_GO_TO_STEP,function(e,t,n){this._setStep(n)}.bind(this)),this.tutorial.onStart().then(function(){this.steps=this.experience.display_data.steps,this._funnelPrefix="tutorial_"+this.experience.id,this._setStep(this.currentStep)}.bind(this),function(){this._isActive=!1,Promise.reject(new Error("failed to start tutorial"))}.bind(this))):Promise.reject(new Error("invalid placedExperience or no placedExperience to be resumed"))},_next:function(){return this.currentStep>=this.steps.length-1?void this._endTutorial(!0):void this._setStep(this.currentStep+1)},_previous:function(){return this.currentStep<=0?void this._endTutorial(!1):void this._setStep(this.currentStep-1)},_dismiss:function(){this._endTutorial(!1)},_endTutorial:function(e){var t=function(){var t=this.experience.display_data.nextUrlInfo,n=t?t.url:null,r=t?t.forceRefresh:!1,i=t?t.forceFullPageRefresh:!1;if(this.clearStoredData(),this.init(),e&&n){var o=new P.navigateData.NavigateData;i?P.changeWindowLocation(n):r&&(o.evt=new P.Event("",null,{forceRefresh:1})),P.getHistoryNavigator().navigate(n,o)}}.bind(this),n=e?this.tutorial.completePlacedExperience():this.tutorial.dismissPlacedExperience();return e&&P.trackRegisterAction(this._funnelPrefix+"_complete"),n.fin(this.tutorial.onExit.bind(this.tutorial)).then(t)},_setStep:function(t){return e.debug("set step from",this.currentStep,"to",t),P.trackRegisterAction(this._funnelPrefix+"_step"+t),t<0||t>=this.steps.length?(this._endTutorial(!0),Promise.reject(new Error("step is out of range"))):(this.currentStep=t,this._saveCurrentStep(),this.tutorial.nextStep(t))},isRunningTutorial:function(){return this._isActive},setTutorialActive:function(e){this._isActive=e},_getStoredData:function(){var e=P.SessionStorage.getItem(P.CONST.TUTORIAL_SESSION_KEY);return e&&e.experienceTutorial?e:null},_saveCurrentStep:function(){P.SessionStorage.setItem(P.CONST.TUTORIAL_SESSION_KEY,{experience:this.experience,step:this.currentStep,experienceTutorial:!0})},clearStoredData:function(){P.SessionStorage.removeItem(P.CONST.TUTORIAL_SESSION_KEY)}};var t=null;P.ExperienceTutorialManager.instance=function(){return t||(t=new P.ExperienceTutorialManager(P.TutorialManager.instance())),t}}(),function(){goog.provide("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.TutorialStep"),P.ExperienceTutorial=function(e,t){this.placedExperience=e,this.displayData=this.placedExperience.display_data,this.tutorialManager=t},P.ExperienceTutorial.prototype={onStart:function(){return new Promise(function(e,t){e(void 0)})},nextStep:function(e){return new Promise(function(t,n){(e<0||e>=this.displayData.steps.length)&&n(new Error("stepNumber out of range")),this._removeStepModule().then(function(){this.loadStepModule(e),t(void 0)}.bind(this))}.bind(this))},loadStepModule:function(e){var t=this.getModuleArgs(e);P.loadModule(t).then(function(e){var t=this.currentModule;this.currentModule=e;var n=e;n.onEnter(function(){this.renderStepModule(e,t)}.bind(this))}.bind(this))},renderStepModule:function(e,t){},_removeStepModule:function(){var e=this.currentModule;return new Promise(function(t){e&&e.onExit(function(){e.onRemoved()}),t(void 0)})},getModuleArgs:function(e){var t=this.displayData.steps,n=t[e].moduleName,r={tutorial_name:this.displayData.tutorialName,current_step:e,total_steps:t.length,can_exit:this.displayData.can_exit||!1,experienceID:this.placedExperience.experience_id,placementID:this.placedExperience.placement_id};return $.extend(r,t[e].options),{name:n,options:r}},onExit:function(){return this._removeStepModule().then(function(){return this.currentModule&&this.currentModule.destroy(),Promise.resolve()}.bind(this))},dismissTutorial:function(){this.tutorialManager&&this.tutorialManager.isRunningTutorial()&&this.tutorialManager._dismiss()},completePlacedExperience:function(){return this.currentModule?this.currentModule.completePlacedExperience():Promise.resolve()},dismissPlacedExperience:function(){return this.currentModule?this.currentModule.dismissPlacedExperience():Promise.resolve()}}}(),function(){goog.provide("P.ModalTutorial"),goog.require("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.ModalTutorialStep"),P.ModalTutorial=function(e,t){P.ExperienceTutorial.call(this,e,t),this.modal=null},P.ModalTutorial.prototype=Object.create(P.ExperienceTutorial.prototype),P.ModalTutorial.prototype.onStart=function(){return new Promise(function(e,t){return this.displayData.anchor&&!this._isOnScreen($(this.displayData.anchor))?(P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_SCROLL_CHANGE,function(e,t,n){this._isOnScreen($(this.displayData.anchor))&&P.ExperienceTutorialManager.instance().startTutorial(this.placedExperience).then(function(){P.ExperienceManager.instance().viewPlacedExperience(this.placedExperience.placement_id,this.placedExperience.experience_id)}.bind(this))}.bind(this)),void t(new Error("Highlighted element is not on screen."))):void e(void 0)}.bind(this))},P.ModalTutorial.prototype.onExit=function(){this.modal&&(this.modal.destroy(),this.modal=null),P.ExperienceTutorial.prototype.onExit.call(this)},P.ModalTutorial.prototype._ensureModal=function(){if(this.modal)return Promise.resolve();var e=(this.displayData.modalStyle+" "||"")+P.currentUser.attributes.gender,t={name:"Modal",options:{mask_type:"dark",can_dismiss:!1,modal_style:e}};return P.loadModule(t).then(function(e){return e.render().then(function(){this.modal=e,this.modal.childListen(P.CONST.EVENT_NEXT,this.tutorialManager._next.bind(this.tutorialManager)),this.modal.childListen(P.CONST.EVENT_PREVIOUS,this.tutorialManager._previous.bind(this.tutorialManager)),P.getModalManager().showModal(this.modal,null)}.bind(this))}.bind(this))},P.ModalTutorial.prototype.renderStepModule=function(e,t){this._ensureModal().then(function(){this.modal.setSubmodule(e).then(function(){var n=e;t&&t.destroy(),_.isUndefined(n.setModalPosition)||n.setModalPosition(),n.onShow()})}.bind(this))},P.ModalTutorial.prototype._isOnScreen=function(e){if(e.length){var t=$(window),n=t.scrollTop(),r=n+t.height(),i=e.offset().top,o=i+e.height();return o<=r&&i>=n}return!1}}(),function(){goog.provide("P.UserEducationGuideTutorial"),goog.require("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.TutorialStep"),goog.require("P.viewport");var e="userEducationGuideBackgroundImage";P.UserEducationGuideTutorial=function(e,t){P.ExperienceTutorial.call(this,e,t)},P.UserEducationGuideTutorial.prototype=Object.create(P.ExperienceTutorial.prototype),P.UserEducationGuideTutorial.prototype.onStart=function(){return new Promise(function(e,t){return window.self!==window.top?void t(new Error("window is not the topmost window")):(this.trigger=this.displayData.trigger,this.setUpPubSub(),void("automatic"===this.trigger?this.moduleContainer?(this._prefetchAllImages(),e(void 0)):P.loadModule({name:"UserEducationGuide"}).then(function(t){t.render().then(function(){$("body").append(t.$el),this.moduleContainer=t,this._prefetchAllImages(),e(void 0)}.bind(this))}.bind(this)):(this.tutorialManager.setTutorialActive(!1),e(void 0))))}.bind(this))},P.UserEducationGuideTutorial.prototype.nextStep=function(e){return new Promise(function(t,n){if("automatic"!==this.trigger)return t(void 0),void this.tutorialManager.clearStoredData();var r=this._getStepInfo(e)||{};if(r.backgroundImage?this._showBackgroundImage(r.backgroundImage):this._hideBackgroundImages(),r.options&&r.options.zoomed_in&&!this.isZoomedIn)this._enterZoomedInMode();else if(r.options&&!r.options.zoomed_in&&this.isZoomedIn)return this._exitZoomedInMode().then(this.loadStepModule.bind(this,e)),void t(void 0);this.loadStepModule(e),t(void 0)}.bind(this))},P.UserEducationGuideTutorial.prototype.onExit=function(){return new Promise(function(e,t){this._hideBackgroundImages(),this.isZoomedIn&&this._exitZoomedInMode(),this.moduleContainer.$el.empty(),this.viewChangeSubscriber&&(P.pubsub.getChannel(P.CONST.PUBSUB_CHANNEL_TUTORIAL).removeSubscriber(this.viewChangeSubscriber,[P.CONST.PUBSUB_TOPIC_VIEW_CHANGE]),this.viewChangeSubscriber=null),this.navigationSubscriber&&(P.pubsub.getChannel(P.CONST.PUBSUB_CHANNEL_SITE).removeSubscriber(this.navigationSubscriber,[P.CONST.PUBSUB_TOPIC_DEEP_LINK]),this.navigationSubscriber=null),e(void 0)}.bind(this))},P.UserEducationGuideTutorial.prototype.loadStepModule=function(e){this._isCurrentCardStacked()||(this.getModuleArgs(e),P.loadModule(this.moduleArgs).then(function(t){var n=this.currentModule;this.currentModule=t;var r=t;r.onEnter(function(){this._renderUserEducationGuide(t,n,e)}.bind(this))}.bind(this)))},P.UserEducationGuideTutorial.prototype._renderUserEducationGuide=function(e,t,n){var r=this._getStepInfo(n);e.render().then(function(){t&&t.destroy(),this.moduleContainer.$el.appendTo(r&&r.options&&r.options.attach_to?r.options.attach_to:$("body")),this.moduleContainer.prependChild(e),e.onShow()}.bind(this))},P.UserEducationGuideTutorial.prototype.setUpPubSub=function(){_.contains(["automatic","manual"],this.trigger)?P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,this.placedExperience):P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,$.extend({},this.placedExperience,{showFlyout:!0})),"automatic"===this.trigger&&(this.viewChangeSubscriber=P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,this.onViewChange.bind(this)),this.navigationSubscriber=P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,this.dismissTutorial.bind(this)))},P.UserEducationGuideTutorial.prototype.onViewChange=function(e,t,n){
if(this.viewChangeSubscriber){var r=this._getStepInfo(this.tutorialManager.currentStep)||{};n=n||{};var i=n.options||{},o=r.options&&r.options.viewChangeFilter||{};(n.moduleName!==o.moduleName||i.view_type!==o.view_type)&&this.dismissTutorial()}},P.UserEducationGuideTutorial.prototype._isCurrentCardStacked=function(){var e=this._getStepInfo(this.tutorialManager.currentStep);return e&&e.options&&this.moduleArgs&&e.options.step_type!==P.CONST.StepTypes.TOOLTIP?!0:!1},P.UserEducationGuideTutorial.prototype._getStackedCardGroup=function(e,t,n){var r=[];return _.each(e,function(e,i){e.options.stacked_group===n&&i>t&&r.push(e.options)}),r},P.UserEducationGuideTutorial.prototype._enterZoomedInMode=function(){var e=$("body");e.addClass("userEducationGuideZoomedIn");var t=$('<div class="userEducationGuideOverlay" />');e.append(t),t.transition({scale:.8}),$(".App").transition({scale:.8}),this.isZoomedIn=!0},P.UserEducationGuideTutorial.prototype._exitZoomedInMode=function(){return new Promise(function(e,t){var n=function(){$("body").removeClass("userEducationGuideZoomedIn"),$(".App").css("transform",""),this.isZoomedIn=!1,e(void 0)}.bind(this),r=function(){$(".App").transition({scale:1},500,"ease",n)};$(".userEducationGuideOverlay").remove(),window.setTimeout(r,200)}.bind(this))},P.UserEducationGuideTutorial.prototype._prefetchAllImages=function(){var t=$("body");_.each(this.displayData.steps,function(n){if(n.backgroundImage){var r=n.backgroundImage;r+=P.Viewport.width<1400?" small":" big",t.append($('<div class="'+e+" "+r+'" />'))}})},P.UserEducationGuideTutorial.prototype._showBackgroundImage=function(t){if(t){var n=$("."+e+"."+t),r=$("."+e+".active");n&&n.length&&(r.length?(n.addClass("visible"),r.transition({opacity:0},function(){r.removeClass("active"),n.addClass("active").removeClass("visible")})):(n.addClass("visible"),$(".App").transition({opacity:0},function(){n.addClass("active").removeClass("visible")})))}},P.UserEducationGuideTutorial.prototype._hideBackgroundImages=function(){var t=$("."+e+".active");$(".App").css({opacity:1}),t.transition({opacity:0},function(){t.remove()})},P.UserEducationGuideTutorial.prototype.getModuleArgs=function(e){this.moduleArgs=P.ExperienceTutorial.prototype.getModuleArgs.call(this,e),this.moduleArgs.name||(this.moduleArgs.name="UserEducationGuideStepBase");var t=this._getStepInfo(e);t&&(this.moduleArgs.options.stacked_cards=this._getStackedCardGroup(this.displayData.steps,this.moduleArgs.options.current_step,t.options.stacked_group))},P.UserEducationGuideTutorial.prototype._getStepInfo=function(e){return this.displayData.steps&&this.displayData.steps[e]}}(),function(){goog.provide("P.NuxModalTutorial"),goog.require("P.ModalTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.viewport"),P.NuxModalTutorial=function(e,t){this.storage={},P.ModalTutorial.call(this,e,t)},P.NuxModalTutorial.prototype=Object.create(P.ModalTutorial.prototype),P.NuxModalTutorial.prototype.onExit=function(){var e=this.modal;return e?(this.modal=null,P.getModalManager().removeModalWithAnimation(e,".flexibleSetup",500)):new Promise(function(e,t){e(void 0)})},P.NuxModalTutorial.prototype.getStorage=function(e){return this.storage[e]},P.NuxModalTutorial.prototype.setStorage=function(e,t){this.storage[e]=t}}(),function(){goog.provide("P.resourceResponse"),P.resourceResponse={fromPlainObject:function(e){var t=new P.ResourceResponse;t.client_context=e.client_context,t.page_info=e.page_info,t.request_identifier=e.request_identifier;var n=e.resource;n&&n.options&&(t.bookmarks=n.options.bookmarks||[]),t.resource_response.data=e.resource_response.data;var r=e.resource_response.error;t.resource_response.error=r?P.Error.fromPlainObject(r):null;var i=e.module;if(i){var o=P.ModuleTree.fromPlainObject(i.tree);o.setOuterHtml(i.html),t.moduleTree=o}return t}},P.ResourceResponse=function(){this.resource_response={data:null,error:null},this.client_context=null,this.moduleTree=null,this.page_info=null,this.request_identifier="",this.bookmarks=[]}}(),function(){goog.provide("P.resource"),goog.require("P.Error"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.resourceFactory"),goog.require("P.resourceResponse"),goog.require("P.Module");var e=P.logging.getLogger("Resource"),t="-end-",n=P.DEBUG?["is_test_mode","request_debug"]:[],r=1,i=1e3;P.Resource=function(e,t){this.name=e,this.options=t?P.valueUtil.deepCopy(t):{}},_.extend(P.Resource.prototype,{getName:function(){return this.name},setOptions:function(e){this.options=e},set:function(e,t){this.options[e]=t},get:function(e){return this.options[e]||null},copyOptions:function(e){var t=P.valueUtil.deepCopy(this.options);return t&&e&&delete t.bookmarks,t},callGet:function(e,t,n){return this.call("get",e,t,n)},callCreate:function(e){return this.call("create",e)},callUpdate:function(e){return this.call("update",e)},callDelete:function(e){return this.call("delete",e)},_isUrlShortEnoughForHttpGet:function(e,t){var n=e+"?"+$.param(t);return n.length<=2e3},call:function(e,t,n,r){var i=t&&void 0!==t.async?t.async:!0,o=t&&t.timeout||null,s=this._call(e,i,o,n,r);return s.then(function(e){this.onResponseSuccess(e)}.bind(this),function(e){this.onResponseError(e)}.bind(this)),s.then(void 0,function(e){var n=new P.Module;if(e&&19===e.api_error_code&&P.currentUser.isWriteBanned())P.writeban.showWriteBanned(n);else if(e&&3===e.api_error_code&&P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(n);else{if(e&&804===e.api_error_code)return;(void 0===t||t.showError)&&P.showError(e.message)}}),s},_call:function(e,t,o,s,a){this.abort();var u,c=r,l=i,d={options:this.options,context:_.pick(P.CONTEXT,n)};u="/resource/"+this.name+"/"+e+"/",s&&(c=s.retries||c,l=s.retryAfter||l,d.module={name:s.name,options:s.options},d.render_type=s.renderType,d.error_strategy=s.errorStrategy,s.data&&(d.module_data=s.data));var h={source_url:P.getCurrentUrl(),data:JSON.stringify(d)};P.state.activeTarget&&(h.module_path=P.state.activeTarget.getFullName());var p="get"===e&&this._isUrlShortEnoughForHttpGet(u,h),g={"X-Pinterest-AppState":P.windowIsInFocus?"active":"background"};return _.extend(g,a),s&&_.extend(g,s.headers),new Promise(function(e,n){var r=null,i={cache:!1,url:u,async:t,data:h,dataType:"json",headers:g,timeout:o,type:p?"GET":"POST"},s={url:u,requestData:h,resourceDict:d},a=function(){return c--,c<0?n(r):void(this.xhr=this._createXhr(s,i,function(t){return e(t)},function(e,t){return t?n(e):(r=e,a.again())}))}.bind(this);a.again=function(){P.setTimeout(a,l)},a.start=function(){a()},a.start()}.bind(this))},_createXhr:function(t,n,r,i){var o=null,s=t.url,a=t.resourceDict,u=t.requestData;return n.error=function(e,t,n){o=n},n.complete=function(t,n){if("abort"===n)return void i(new Error("aborted"),!0);var c={resource_name:this.name,response_headers:t.getAllResponseHeaders(),http_status:t.status,text_status:n,respose_text:t.responseText,error_thrown:o,xhrUrl:s};if(0===t.status)return c.userAgent=window.navigator.userAgent,c.payload=u,e.error("Connectivity error or cancelled by navigation",c),void i(new Error(P._("Connectivity error or cancelled by navigation")),!0);var l=null,d=null;try{var h=JSON.parse(t.responseText);if(!(h instanceof Object))throw Error("JSON.parse did not return an object");l=P.resourceResponse.fromPlainObject(h),d=l.resource_response.error;var p=!!t.getResponseHeader("X-Pinterest-New-Version");p&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION_AVAILABLE)}catch(g){d=new P.Error,d.message=P.string.common.defaultErrorMessage,d.http_status=t.status,e.error("Failed to parse resource response. HTTP "+t.status,g.message,c)}if(d&&403===d.http_status&&!P.currentUser.isAuthenticated())return void P.changeWindowLocation(P.getLoginUrl(),!1);var f=a&&a.options&&a.options.disable_auth_failure_redirect===!0;if(d&&401===d.http_status&&1001===d.api_error_code&&!f){var _=P.getLoginUrl();return void P.changeWindowLocation(_,!1)}d?l&&l.moduleTree?r(l):i(d):l?r(l):e.error("no error and no resource response",c),this.xhr=null}.bind(this),$.ajax(n)},abort:function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},resetBookmark:function(){this.options&&delete this.options.bookmarks},setBookmarks:function(e){this.set("bookmarks",e)},getLatestBookmark:function(){var e=this.options.bookmarks;return e?e[e.length-1]:void 0},atEnd:function(){return this.getLatestBookmark()===t},onResponseSuccess:function(e){if(e.client_context){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION,e.client_context.app_version);var t=e.client_context.event_log_info;t&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,P.CONST.PUBSUB_TOPIC_CONTEXT_LOG_PLAIN_OBJECT,t);var n=e.client_context.placed_experiences;n&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,n)}var r=P.CONTEXT.is_test_mode?P.CONTEXT.test_context:null;P.CONTEXT=e.client_context,r&&_.extend(P.CONTEXT,r),e.page_info&&(e.page_info.title||_.keys(e.page_info.meta).length)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PAGE_INFO,e.page_info),e.bookmarks&&this.setBookmarks(e.bookmarks),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_REQUEST,P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER,e.request_identifier)},onResponseError:function(t){e.debug("Request error for "+this.name,t,t.stack_trace)},isEqual:function(e,t){if(this.name!==e.name)return!1;var n=_.omit(this.options,"bookmarks"),r=_.omit(e.options,"bookmarks");if(t){n.latest_bookmark=this.getLatestBookmark();var i=e.options.bookmarks;r.latest_bookmark=i&&i[i.length-1]}return _.isEqual(n,r)},toString:function(){var e=_.omit(this.options,"bookmarks","field_set_key");return this.name+"("+P.toScrubbedArgumentString(e)+")"},isCalling:function(){return!!this.xhr}}),P.Resource.NOOP_RESOURCE={name:"NoopResource",options:{}},P.resourceFactory.setDefaultConstructorFn(P.Resource),P.logFrontEndEvent=function(e,t){var n=P.resourceFactory.create("IncrementEventResource",{event:e,sample_rate:t});n.callCreate({showError:!1})}}(),function(){goog.provide("P.safeLink");var e="offsite_",t="-";P.SafeLink={open:function(n,r){var i=Math.round(1e3*Math.random())+"",o=Math.round(1e3*Math.random())+"";Cookie.set(e+i,o);var s={token:i+t+o,url:n};r&&(s.pin=r),P.changeWindowLocation("/offsite/?"+$.param(s),!0)}}}(),function(){goog.provide("P.socialConnect"),goog.require("P.experiments"),goog.require("P.fb"),goog.require("P.script"),P.SocialConnect=function(){};var e;_.extend(P.SocialConnect.prototype,Backbone.Events),_.extend(P.SocialConnect.prototype,{connect:function(e,t){t=_.extend({},{success:P.NOOP,error:P.NOOP,complete:P.NOOP},t);var n=null,r=null;e===P.SocialConnect.RAKUTEN&&(n=800,r=600);var i=P.FacebookDialog.getWindowOptions(n,r);if(t.rerequest_facebook_email)P.fb.ensureInit(function(e){e.login(function(e){var n,r,i=e.authResponse;i&&(n=i.grantedScopes,n&&(n=n.split(",")),r=i.userID);var o=_.find(n,function(e){return"email"===e}),s={id:r};"connected"===e.status&&o?t.success(s):t.error(s),t.complete()},{scope:"email",auth_type:"rerequest",return_scopes:!0})});else{var o=window.open("/connect/"+e+"/","",i);if(!o)return P.showError(P._("You must enable popups!")),void t.error({network:e,alertedUpstream:!0});var s=P.setInterval(function(){o.closed&&(clearInterval(s),this.handleComplete({network:e,error_message:"Window closed."}))}.bind(this),1e3);this.once("connect:"+e,function(e){clearInterval(s),e.error_message?t.error(e):t.success(e),t.complete()})}},complete:function(e){var t=JSON.parse(e);this.handleComplete(t)},handleComplete:function(e){var t="connect:"+e.network,n=e.network;if("facebook"===n){var r=e.id;r&&"string"!==typeof r&&(e.error_message="Facebook id must be of string type")}this.trigger(t,e)}}),_.extend(P.SocialConnect,{instance:function(){return e||(e=new P.SocialConnect),e},FACEBOOK:"facebook",TWITTER:"twitter",GOOGLE:"google",GPLUS:"gplus",YAHOO:"yahoo",RAKUTEN:"rakuten",MICROSOFT:"microsoft"})}(),function(){goog.provide("P.facebookDialog");var e=20,t=580,n=400;P.FacebookDialog={open:function(e){var r=_.pick(e,P.FacebookDialog._validParams),i=P.FacebookDialog._getDialogType(e),o=P.FacebookDialog.generateFbRef(),s=e.object_type&&e.object_id&&"feed"===i;if(r.method=i,r.link=P.absolutify(e.path),s&&(r.link+="?"+$.param({fb_ref:o})),"feed"===i){var a=P.FacebookDialog.getWindowOptions(e.width||t,e.height||n);window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(r.link),"sharer",a)}else P.fb.ensureInit(function(t){t.getLoginStatus(function(){t.ui(r,function(t){if(s&&t&&t.post_id){var n=P.resourceFactory.create("LogFacebookFeedShare",{});n.options={object_type:e.object_type,object_id:e.object_id,fb_ref:o},n.callCreate({showError:!1})}e.callback&&e.callback(t)})})})},_validParams:["description","name","picture","to","href"],_validOptions:["send","feed","share"],generateFbRef:function(){for(var t="";t.length<e;)t+=Math.floor(65535*Math.random()).toString(16);return P.currentUser.id+":"+t},_getDialogType:function(e){var t=_.contains(P.FacebookDialog._validOptions,e.type),n=t?e.type:"feed";return n},getWindowOptions:function(e,r){var i=e?e:t,o=r?r:n,s=screen.width,a=screen.height,u=Math.round((s-i)/2),c=a>o?Math.round((a-o)/2):0;return"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+i+",height="+o+",left="+u+",top="+c}}}(),function(){!function(e){e.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}}}}(jQuery)}(),function(){goog.provide("P.Set"),P.Set=function(e){this.items={},e&&this.addMultiple(e)},P.Set.prototype.add=function(e){this.items[e]=!0},P.Set.prototype.addMultiple=function(e){e.forEach(function(e){this.items[e]=!0}.bind(this))},P.Set.prototype.remove=function(e){delete this.items[e]},P.Set.prototype.contains=function(e){return Object.prototype.hasOwnProperty.call(this.items,e)}}(),function(){goog.provide("P.model.Model"),P.model.Model=function(e){this._modelOrCollection=null,this._modelAvailablePromise=e.then(function(e){this.set(e)}.bind(this))},_.extend(P.model.Model.prototype,Backbone.Events),P.model.Model.prototype.set=function(e){var t=e instanceof Array;this._modelOrCollection||(this._modelOrCollection=t?new Backbone.Collection:new Backbone.Model,this.on("all",function(){this.trigger.apply(this,arguments)}.bind(this)));var n;t?n=e:(n=this._modelOrCollection.toJSON(),$.extend(!0,n,e)),this._modelOrCollection.set(n)},P.model.Model.prototype.updateData=function(e){e.then(function(e){this.set(e)}.bind(this))},P.model.Model.prototype.getNonEmptyData=function(){return this._modelAvailablePromise.then(function(e){return this.getData()}.bind(this))},P.model.Model.prototype.getData=function(){if(this._modelOrCollection){var e=this._modelOrCollection.toJSON();if(e instanceof Object)return e}return null},P.model.Model.prototype.on=function(e,t){this._modelAvailablePromise.then(function(){return this._modelOrCollection.on(e,t)}.bind(this))},P.model.Model.prototype.once=function(e,t){this._modelAvailablePromise.then(function(){return this._modelOrCollection.once(e,t)}.bind(this))},P.model.Model.prototype.off=function(e,t){this._modelAvailablePromise.then(function(){return this._modelOrCollection.off(e,t)}.bind(this))}}(),function(){goog.provide("P.modelManager"),goog.require("P.LruCache"),goog.require("P.model.Model"),P.modelManager=P.modelManager||{},P.modelManager.EntityType={PIN:"pin"},P.modelManager.EntityDict,P.modelManager.EntityId,P.modelManager.CACHE_FOR_TYPE_SIZE=1e3,P.modelManager.CacheForType=function(e){this.cache=new P.LruCache(P.modelManager.CACHE_FOR_TYPE_SIZE),this._entityType=e},P.modelManager.CacheForType.prototype.getModel=function(e){return this.cache.get(e)},P.modelManager.CacheForType.prototype.addEntityDict=function(e){if(e.type!==this._entityType)throw new Error("invalid entityDict type");var t=e.id;this.ensureModel(t,Promise.resolve(e))},P.modelManager.CacheForType.prototype.ensureModel=function(e,t){var n=this.cache.get(e);return n||(n=new P.model.Model(t),this.cache.set(e,n)),n.updateData(t),n},P.modelManager.CacheForType.prototype.remove=function(e){this.cache.remove(e)},P.modelManager.ModelManager=function(){this.entityTypeToCache={},_.each(P.modelManager.EntityType,function(e){this.entityTypeToCache[e]=new P.modelManager.CacheForType(e)}.bind(this))},P.modelManager.ModelManager.prototype.getModel=function(e,t){var n=this.entityTypeToCache[e];return n?n.getModel(t):null},P.modelManager.ModelManager.prototype.add=function(e){if(e instanceof Array)e.forEach(function(e){this._addEntity(e)}.bind(this));else if(e instanceof Object){var t=e;this._addEntity(t)}},P.modelManager.ModelManager.prototype.ensureModel=function(e,t,n){var r=this.entityTypeToCache[e];if(!r)throw new Error("unexpected entityType "+e);return r.ensureModel(t,n)},P.modelManager.ModelManager.prototype.invalidate=function(e,t){var n=this.entityTypeToCache[e];if(!n)throw new Error("unexpected entityType "+e);n.remove(t)},P.modelManager.ModelManager.prototype._addEntity=function(e){var t=e.type;if(t){var n=t,r=this.entityTypeToCache[n];if(r){var i=e.id;"string"===typeof i&&r.ensureModel(i,Promise.resolve(e))}}},P.modelManager.instance=new P.modelManager.ModelManager}(),function(){goog.provide("P.resourceCache"),goog.require("P.model.Model"),goog.require("P.modelManager"),P.resourceCache={};var e=["NetworkStoriesResource","NotificationsResource","BoardInvitesResource"],t=function(e){return _.isObject(e)?_.sortBy(_.map(_.pairs(e),function(e){return[e[0],t(e[1])]}),function(e){return e[0]}):e},n=function(e){return JSON.stringify(t(e))};P.resourceCache.IResourceCacheStrategy=function(){},P.resourceCache.IResourceCacheStrategy.prototype.ensureModel=function(e,t){},P.resourceCache.IResourceCacheStrategy.prototype.invalidate=function(e){},P.resourceCache.ResourceCacheStrategyEntity=function(e,t){this._entityType=e,this._modelManager=t},P.resourceCache.ResourceCacheStrategyEntity.prototype.ensureModel=function(e,t){var n=e.options.id;return this._modelManager.ensureModel(this._entityType,n,t)},P.resourceCache.ResourceCacheStrategyEntity.prototype.invalidate=function(e){},P.resourceCache.ResourceCacheStrategySimple=function(){this._cache={},this._bookmarkResponses={}},P.resourceCache.ResourceCacheStrategySimple.prototype._getKey=function(e){var t=_.omit(e.options,"bookmarks");return t.bookmark=e.getLatestBookmark(),n(t)},P.resourceCache.ResourceCacheStrategySimple.prototype.ensureModel=function(t,n){var r=this._getKey(t),i=this._cache[r];return-1!==_.indexOf(e,t.name)&&t.options.bookmarks&&(i=null),i?i.updateData(n):i=this._cache[r]=new P.model.Model(n),i},P.resourceCache.ResourceCacheStrategySimple.prototype.invalidate=function(e){this._cache={}},P.resourceCache.ResourceCacheStrategySimple.prototype.getBookmarkResponse=function(e){return this._bookmarkResponses[e]},P.resourceCache.ResourceCacheStrategySimple.prototype.setBookmarkResponse=function(e,t){this._bookmarkResponses[e]=t},P.resourceCache.ResourceCache=function(e){this._resourceCacheStrategies=e},P.resourceCache.Freshness={POSSIBLY_STALE_AND_INCOMPLETE:1,FRESH:2},P.resourceCache.ResourceCache.prototype.callGet=function(t,n,r){var i=n&&n.module,o=this._resourceCacheStrategies[t.name],s=t.getLatestBookmark(),a=-1!==_.indexOf(e,t.name),u=t.callGet({showError:!1},void 0,n&&n.headers).then(function(e){return a&&(o.setBookmarkResponse(s,e.bookmarks),i&&i.resource.setBookmarks(e.bookmarks)),e.resource_response.data});if(o){var c=o.ensureModel(t,u);return r&&r.freshness===P.resourceCache.Freshness.POSSIBLY_STALE_AND_INCOMPLETE?(a&&i.resource.setBookmarks(o.getBookmarkResponse(s)),c.getNonEmptyData()):u}return u},P.resourceCache.ResourceCache.prototype.callCreate=function(e){var t=e.callCreate();return t.then(function(){"PinCommentResource"===e.name&&P.modelManager.instance.invalidate(P.modelManager.EntityType.PIN,e.options.pin_id)}),t},P.resourceCache.ResourceCache.prototype.ensureModel=function(e,t){var n=this._resourceCacheStrategies[e.name];return n?n.ensureModel(e,Promise.resolve(t)):null},P.resourceCache.ResourceCache.prototype.invalidate=function(e){var t=this._resourceCacheStrategies[e.name];t&&t.invalidate(e)},P.resourceCache.instance=new P.resourceCache.ResourceCache({PinResource:new P.resourceCache.ResourceCacheStrategyEntity(P.modelManager.EntityType.PIN,P.modelManager.instance),BoardsResource:new P.resourceCache.ResourceCacheStrategySimple,BoardPickerBoardsResource:new P.resourceCache.ResourceCacheStrategySimple,ConversationsResource:new P.resourceCache.ResourceCacheStrategySimple,NotificationsResource:new P.resourceCache.ResourceCacheStrategySimple,NetworkStoriesResource:new P.resourceCache.ResourceCacheStrategySimple,UserExperienceWithContextResource:new P.resourceCache.ResourceCacheStrategySimple,BoardInvitesResource:new P.resourceCache.ResourceCacheStrategySimple})}(),function(){goog.provide("P.TypeaheadProvider"),goog.require("P.LruCache");var e=5;P.TypeaheadProvider=function(t){t=t||{},this.tags=t.tags,this.enable_recent_queries=!!t.enable_recent_queries,this.minimum_term_character_length=t.minimum_term_character_length||0,this.bypass_lru_cache=t.bypass_lru_cache;var n={tags:t.tags,pin:t.pin_id},r=t.num_places;r?n.num_places=r:n.count="count"in t?t.count:e,t.should_geocode&&(n.should_geocode=!0),t.exclude_non_followers&&(n.exclude_non_followers=!0),t.field_set_key&&(n.field_set_key=t.field_set_key);var i="TypeaheadResource";t.resource_name&&(i=t.resource_name),this.searchResource=P.resourceFactory.create(i,n),this.itemsCache=new P.LruCache},_.extend(P.TypeaheadProvider.prototype,Backbone.Events),_.extend(P.TypeaheadProvider.prototype,{search:function(e,t){var n;if(e=e.trim(),!e&&"pinners_and_contacts"===this.tags)return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&P.currentUser.isLimitedLogin())return this.abortSearch(),this.publishData(e,[],{},t);if(!e&&this.enable_recent_queries&&P.currentUser&&P.currentUser.isAuthenticated())n="recent_search";else{var r=this.bypass_lru_cache?{}:this.itemsCache.get(e);if(r){var i=r.items;if(i&&i.length){this.abortSearch();var o=r.hint;return void this.publishData(e,i,o,t)}}}e.length>=this.minimum_term_character_length?this.fetch(e,n,t):this.publishData(e,[],{},t)},getResource:function(){return this.searchResource},abortSearch:function(){this.getResource().abort()},publishData:function(e,t,n,r){var i={term:e,items:t,hint:n};this.trigger(P.CONST.EVENT_DATA,i),r&&r(i)},setAutocompleteScope:function(e){this.getResource().set("autocompleteScope",e)},fetch:function(e,t,n){var r=this.getResource();if(r.isCalling()){var i=r.get("term");if(e===i)return;this.abortSearch()}""!==this.tags&&(this.trigger(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,e),r.set("term",e),r.set("tags",t||this.tags),r.resetBookmark(),r.callGet({showError:!1}).then(function(t){var r=t.resource_response.data,i=r.items,o=r.hint||{},s={hint:o,items:i};this.cacheData(e,s),this.publishData(e,i,o,n)}.bind(this),function(e){this.trigger("fetchError",e)}.bind(this)),this.warm=!0)},removeCacheForTerm:function(e){this.itemsCache.remove(e)},cacheData:function(e,t){this.itemsCache.set(e,t)},prefetch:function(){if(!this.warm){var e=P.resourceFactory.create("TypeaheadPrepareResource");e.callGet({showError:!1}),this.warm=!0}}})}(),function(){goog.provide("P.invite"),P.Invite={_logInvites:function(e){var t={invite_id:null,invite_code:null,invite_metadata:{invite_type:e,to_follow:[P.currentUser.id]}},n={topic:"sent_invites",content:t},r=P.resourceFactory.create("EventLoggingResource",n);r.callCreate({showError:!1})},trackInvite:function(e,t){t?P.trackGACategoryEvent("user_invite",e,P.CONST.GA_ACTION_SUCCESS):P.trackGACategoryEvent("user_invite",e,P.CONST.GA_ACTION_ERROR),"gplus"===e&&P.Invite._logInvites(e)},_createFacebookInvite:function(){var e=P.resourceFactory.create("FacebookInviteCreateResource",{});return e.callCreate()},_showFacebookDialog:function(e,t){return P.Invite._createFacebookInvite().then(function(n){var r=n.resource_response.data,i=r.url,o=r.invite_code;P.FacebookDialog.open({type:"send",name:"name",path:i,to:e,callback:function(e){if(e&&e.success){P.Invite.trackInvite("facebook",!0);var n=P.resourceFactory.create("FacebookInviteSentResource",{invite_code:o});n.callCreate()}t&&t(e&&e.success)}}),P.trackGACategoryEvent("user_invite","facebook",P.CONST.GA_ACTION_OPEN_MODAL)},function(){P.Invite.trackInvite("facebook",!1)})},userInviteFacebook:function(e,t){return P.fb.ensureLoggedIn(function(n){P.Invite._showFacebookDialog(e,t)})},userInviteEmail:function(e,t){var n=P.resourceFactory.create("EmailInviteSentResource",{email:e,type:"email"});n.callCreate().then(function(e){P.Invite.trackInvite("email",!0),t&&t(!0)},function(e){P.Invite.trackInvite("email",!1),t&&t(!1)})},trackInviteFunnelAction:function(e,t){t="undefined"!==typeof t?t:!1;var n={action:e,is_recipient_funnel:t};P.resourceFactory.create("TrackInviteFunnelActionResource",n).callCreate({showError:!1})}}}(),function(){goog.provide("P.userRegistration"),goog.require("P.CONST"),goog.require("P.experiments"),goog.require("P.fb"),goog.require("P.logging"),goog.require("P.NoEmailProvidedError");var e=P.logging.getLogger("UserRegistration"),t=function(){};t.prototype={fastTrackSocialRegistration:function(e,t){if(e===P.SocialConnect.FACEBOOK)return this.fetchNetworkData(e).then(function(e){return e.email?this.sendImmediateFbRegisterRequest(e,t):Promise.reject(new P.NoEmailProvidedError)}.bind(this));if(e===P.SocialConnect.RAKUTEN){var n={rakuten_id:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_ID),rakuten_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_TOKEN),rakuten_refresh_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN),first_name:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME),email:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_EMAIL),gender:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_GENDER),country:null};return"rakuten"===P.getQueryStringParams().cmp&&(n.follow_rakuten=!0),this.register(P.SocialConnect.RAKUTEN,n)}return Promise.resolve(void 0)},sendImmediateFbRegisterRequest:function(e,t){var n={first_name:e.first_name,last_name:e.last_name,email:e.email,gender:e.gender,image_url:e.image_url,facebook_id:e.id,facebook_token:e.access_token,country:null};return t&&_.extend(n,t),this.addExtraSocialParams(P.SocialConnect.FACEBOOK,n),this.register(P.SocialConnect.FACEBOOK,n)},addExtraSocialParams:function(e,t){var n=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_ID),r=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_TOKEN);n&&(t.facebook_id||(t.facebook_id=n),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_ID)),r&&(t.facebook_token||(t.facebook_token=r),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_TOKEN));var i=P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW);i&&(i.invite_follow_board&&(t.board_to_follow=i.invite_follow_board),i.invite_follow_user&&(t.user_to_follow=i.invite_follow_user))},fetchNetworkData:function(e){return e===P.SocialConnect.FACEBOOK?(P.trackRegisterAction("register_facebook"),new Promise(function(e,t){P.fb.ensureInit(function(n){n.getLoginStatus(function(r){if(r.authResponse){var i=["picture.type(large)","id","first_name","last_name","email","gender"],o="/me?fields="+i.join(",");n.api(o,function(n){n&&!n.error?(n.picture&&n.picture.data&&n.picture.data.url&&!n.picture.data.is_silhouette&&(n.image_url=n.picture.data.url),e(n)):t(new Error("FB.api errored: "+n.error))})}else t(new Error("not authed"))},!0)})})):Promise.reject(new Error("Unsupported social network: "+e))},register:function(t,n){var r=P.UserRegistration.getResource(n);return r.callCreate().then(function(t){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_SUCCESS),P.SessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW),e.debug("Login, successful",t),Cookie.set(P.CONST.COOKIE_USER_JUST_REGISTERED,"1");var r;switch(n.container){case"home_page":r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.HOME_PAGE_SIGNUP),P.trackRegisterAction("signup_home_page");break;case"plain_signup_modal":r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PLAIN_MODAL_SIGNUP),P.trackRegisterAction("signup_plain_modal");break;case"closeup_signup_modal":r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.CLOSEUP_MODAL_SIGNUP),P.trackRegisterAction("signup_closeup_modal");break;case"widescreen_signup_modal":r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.WIDESCREEN_MODAL_SIGNUP),P.trackRegisterAction("signup_widescreen_modal");break;case"pinit_button_landing":r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PIN_IT_BUTTON_LANDING_SIGNUP),P.trackRegisterAction("signup_pinit_button_landing");break;case"inspired_banner":P.trackRegisterAction("signup_inspired_banner");break;default:r=P.ContextEvent.fromEventType(P.ContextLogging.EventType.UNKNOWN_PLACEMENT_SIGNUP),P.trackRegisterAction("signup_unknown_placement")}r&&P.ContextLogger.getInstance().addEvent(r)},function(e){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_ERROR),e.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT&&(P.trackRegisterAction("multi_step_set_age_restrict_cookie"),Cookie.set(P.CONST.COOKIE_REGISTER_RESTRICT,"1",87600),Cookie.set(P.CONST.COOKIE_PERSONALIZE_FROM_OFFSITE_BROWSING_COOKIE_NAME,"disabled"));var r=this.signupRequestAttempts||0,i=_.isEmpty(e.api_error_code)||_.contains([P.CONST.API_SERVER_ERROR,P.CONST.API_REQUEST_TIMEOUT],e.api_error_code);if(i&&r<3)return this.signupRequestAttempts=r+1,this.register(t,n);throw e}.bind(this))},getResource:function(e){return P.resourceFactory.create("UserRegisterResource",e)},showSignupModal:function(e,t,n){var r={name:e,options:n||{}};t&&(r.resource=t),P.loadModule(r).then(function(e){P.getModalManager().createAndShowModal(e,{mask_type:"dark",modal_style:n.modal_style,can_dismiss:n.can_dismiss})}).fin(function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HIDE_UNAUTH_BANNER)})}},P.UserRegistration=new t}(),function(){goog.provide("P.preventScroll"),goog.require("P.Mixins");var e=function(){};e.prototype.listen=function(e){},P.Mixins.PreventScroll={startPreventScroll:function(e,t){this.stopPreventScroll(),this._preventScrollListener=this.listen(e,"mousewheel",function(n){var r=n.originalEvent.wheelDeltaY<0?"down":"up",i=e.scrollTop();if("down"===r){var o=e.outerHeight()+i;o>=t.outerHeight()&&n.preventDefault()}else 0===i&&n.preventDefault()})},stopPreventScroll:function(){this._preventScrollListener&&(this.removeListener(this._preventScrollListener),this._preventScrollListener=null)}}}(),function(){goog.provide("P.nuxFindFriends"),goog.require("P.Mixins");var e=function(){};e.prototype.listen=function(e){},P.Mixins.NuxFindFriends={resetFollowState:function(e){this.friendsFollowed=[],this.friendsUnfollowed=[],this.followAllSelected=e},followFriend:function(e){this.friendsUnfollowed=_.without(this.friendsUnfollowed,e),this.friendsFollowed.push(e)},unfollowFriend:function(e){this.friendsFollowed=_.without(this.friendsFollowed,e),this.friendsUnfollowed.push(e)},toggleFollowAll:function(){this.resetFollowState(!this.followAllSelected)},getFriendsFollowed:function(){return this.friendsFollowed},getFriendsUnfollowed:function(){return this.friendsUnfollowed},isFollowAllSelected:function(){return this.followAllSelected},followingFriendsChanged:function(){return this.followAllSelected||this.friendsFollowed||this.friendsUnfollowed},setNetwork:function(e){this.network=e,this.resetFollowState(!1)},getNetwork:function(){return this.network},initializeFollowState:function(){this.resetFollowState(!1)},showSelectAllCheckbox:function(e){this.selectAllCheckbox.setChecked(e,!1),this.$selectAllWrapper.css("visibility","visible")},hideSelectAllCheckbox:function(){this.$selectAllWrapper.css("visibility","hidden")},_onSelectAllTextClicked:function(e){this.selectAllCheckbox.toggle()},_onSelectAllCheckboxToggled:function(e){
this.toggleFollowAll(),this.updateCheckForGridItems(this.isFollowAllSelected())},updateCheckForGridItems:function(e){var t=this.getFriendsContent();if(t&&(t.options.item_options.is_checked=e,t.getGrid()&&(t.getGrid().options.item_options.is_checked=e,t.getGrid().getGridItems()))){t.getGrid().getGridItems().options.item_options.is_checked=e;var n=t.getGrid().getGridItemsChildren();_.each(n,function(t){t.data&&t.setChecked(e)})}},resetFollowAllState:function(){var e="male"!==P.currentUser.get("gender");this.showSelectAllCheckbox(e),this.resetFollowState(e),this.updateCheckForGridItems(e)},signalFollowFriends:function(){if(this.isFollowAllSelected()){var e={network:this.getNetwork(),import_friends:!1,excluded_user_ids:this.getFriendsUnfollowed()},t=P.resourceFactory.create("UserFollowAllResource",e);return t.callCreate()}var n={followee_ids:this.getFriendsFollowed()},r=P.resourceFactory.create("UserBatchFollowResource",n);return r.callCreate()},followedFriendsIdsList:function(){var e=[],t=this.getFriendsContent();if(t&&t.getGrid()&&t.getGrid().getGridItems()){var n=t.getGrid().getGridItemsChildren();_.each(n,function(t){t.isChecked()&&t.data&&e.push(t.data)})}return e},_onFriendClick:function(e){var t=e.data||{},n=t.user_id;if(n)switch(this.tab){case P.SocialConnect.FACEBOOK:case P.SocialConnect.TWITTER:t.is_following?this.followFriend(n):this.unfollowFriend(n)}},getFriendsContent:function(){return this.getChildById("friendsContent")},setup:function(){this.selectAllCheckbox=this.getChildById("selectAllCheckbox"),this.$selectAllWrapper=this.$(".selectAllWrapper"),this.twitterConnected=_.isString(P.currentUser.get("twitter_url")),this.facebookConnected=_.isString(P.currentUser.get("facebook_url")),this.tab=P.SocialConnect.FACEBOOK,this.hideSelectAllCheckbox(),this.initializeFollowState(),this.listen(this.getChildById("fbTab"),P.CONST.EVENT_BUTTON_CLICK,this._onButtonTabClick),this.listen(this.getChildById("twTab"),P.CONST.EVENT_BUTTON_CLICK,this._onButtonTabClick),this.listen(this.selectAllCheckbox,P.CONST.EVENT_CHANGE,this._onSelectAllCheckboxToggled),this.childListen(P.CONST.EVENT_USER_CLICK,this._onFriendClick),this._showSelectedTab()},_onButtonTabClick:function(e){var t=e.target;switch(this.tab=null,t.id){case"fbTab":this.tab=P.SocialConnect.FACEBOOK,this._showSelectedTab();break;case"twTab":this.tab=P.SocialConnect.TWITTER,this._showSelectedTab()}}}}(),function(){goog.provide("P.navigateData.NavigateData"),P.navigateData.NavigateData=function(){this.evt=null,this.handled=!1,this.reuseLast=!1,this.fromHistoryUid=null,this.fromNavigate=!1,this.currentModule=null}}(),function(){goog.provide("P.number"),P.number.quantize=function(e,t){var n=e*Math.pow(10,t),r=Math.round(10*(n-parseInt(n,10)))/10;return r===-.5&&(r=-.6),n=Math.round(parseInt(n,10)+r)/Math.pow(10,t)},P.number.toRadians=function(e){return e*Math.PI/180},P.number.dollarToMicrodollar=function(e){var t=parseInt(100*e,10);return 1e4*t},P.number.microdollarToDollar=function(e){return e/1e6},P.number.formatUSD=function(e){return e.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}}(),function(){goog.provide("P.positioning"),P.Positioning={positionElementAtAnchor:function(e,t,n,r,i){var o=P.CONST.PositionPointFlag,s=t.offset(),a=e.outerWidth(),u=t.outerWidth();if(s){var c=0,l=0;if(n&o.FLAG_VERTICAL_BOTTOM||n&o.FLAG_VERTICAL_TOP?(c=n&o.FLAG_VERTICAL_BOTTOM?s.top+t.outerHeight():s.top-e.outerHeight(),l=n&o.FLAG_VERTICAL_LEFT?s.left:n&o.FLAG_VERTICAL_RIGHT?s.left+u-a:s.left+(u-a)/2):n&o.FLAG_HORIZONTAL_LEFT||n&o.FLAG_HORIZONTAL_RIGHT?(l=n&o.FLAG_HORIZONTAL_LEFT?s.left-a:s.left+u,c=n&o.FLAG_HORIZONTAL_TOP?s.top:n&o.FLAG_HORIZONTAL_BOTTOM?s.top+t.outerHeight()-e.outerHeight():s.top+(t.outerHeight()-e.outerHeight())/2):n&o.FLAG_VERTICAL_CENTER&&n&o.FLAG_HORIZONTAL_CENTER&&(l=s.left+(u-a)/2,c=s.top+(t.outerHeight()-e.outerHeight())/2),r){var d=c-$(window).scrollTop();d>0&&(c=d)}else{var h=e.parents().filter(function(){return"fixed"===$(this).css("position")});h[0]&&(c+=h.scrollTop(),c-=$(window).scrollTop())}var p={left:l,top:c};return i&&(p=P.Positioning.checkIfInViewportAndAdjustAccordingly(e,p,n)),e.css(p),n}},checkIfInViewportAndAdjustAccordingly:function(e,t,n){var r,i,o=e.width(),s=t.left,a=t.top,u=s+o,c=7;u>P.Viewport.width?r=s-(u-P.Viewport.width+c):s<c&&(r=c);var l={};return l.left=r?r:s,l.top=i?i:a,l}}}(),function(){!function(){function e(e,t){var n='font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;font-size: 15px;'+(e?"font-weight: bold;":"")+"color: "+t+";";return n}console.log("%câ¥ web? %c--> %cjoinUs()",e(!0,"#d22"),e(!0,"#777"),e(!0,"#2b2")),window.joinUs=function(){return console.log("%cWe're excited to have you! %câ",e(!1,"#d22"),e(!1,"#333")),window.location.href="/_/_/about/careers/",""}}()}(),function(){goog.provide("P.date"),P.date.today=function(){var e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate())},P.date.UTCToday=function(){var e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())},P.date.addDays=function(e,t){return new Date(e.getTime()+24*t*60*60*1e3)},P.date.UTCDate=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate())},P.date.toOrdinal=function(e){function t(e){return e%4===0&&(e%100!==0||e%400===0)}e=e||new Date;var n=e.getDate(),r=e.getMonth(),i=e.getFullYear()-1,o=365*i+i/4-i/100+i/400,s=[0,31,59,90,120,151,181,212,243,273,304,334],a=s[r];return r>1&&t(i)&&a++,Math.floor(o+a+n)}}(),function(){goog.provide("P.socialNetworkSettingsManager"),goog.require("P.string"),goog.require("P.socialConnect");var e=1e3,t=110;P.SocialNetworkSettingsManager=function(){},_.extend(P.SocialNetworkSettingsManager.prototype,{handleConnect:function(e,t,n){if(t&&!P.currentUser.isLimitedLogin()){var r={success:function(r){var i={network:e,data:r};this._internalConnectNetwork(t,i,n)}.bind(this),error:function(e){n.error&&n.error(e)},complete:function(){n.complete&&n.complete()}};this._externalConnectNetwork(e,t,r)}else{var i={network:e};this._internalConnectNetwork(t,i,n)}},updateConnectStatus:function(){var e=P.resourceFactory.create("UserResource",{user_id:P.currentUser.get("id"),username:P.currentUser.get("username"),field_set_key:"social_connect"});e.callGet().then(function(e){var t=e.resource_response.data;P.currentUser.set(t),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED)})},_externalConnectNetwork:function(e,t,n){return t?void P.SocialConnect.instance().connect(e,n):void(n.success&&n.success({}))},_internalConnectNetwork:function(e,t,n){var r=P.resourceFactory.create("UserSocialNetworkResource",t);(e?r.callCreate():r.callDelete()).then(function(e){this.updateConnectStatus(),n.success&&n.success(e)}.bind(this),function(e){n.error&&e instanceof Object&&n.error(e)}).fin(function(){n.complete&&n.complete()})},_getResourceNameForNetworkFriends:function(e){var t=null;switch(e){case P.SocialConnect.FACEBOOK:t="UserFacebookFriendsResource";break;case P.SocialConnect.TWITTER:t="UserTwitterFriendsResource";break;case P.SocialConnect.GOOGLE:t="UserGmailFriendsResource";break;case P.SocialConnect.YAHOO:t="UserYahooFriendsResource";break;case P.SocialConnect.MICROSOFT:t="UserMicrosoftFriendsResource";break;default:return}return t},pollForFriends:function(n,r){r=r||{};var i=r.resourceOptions||{},o=this._getResourceNameForNetworkFriends(n);if(o){var s=P.resourceFactory.create(o,i);s.callGet({showError:!1}).then(function(){var e=r.success;e&&e(s)},function(i){if(i.api_error_code===t)P.setTimeout(function(){this.pollForFriends(n,r)}.bind(this),e);else{var o=r.error;o&&o()}}.bind(this))}}});var n=null;P.SocialNetworkSettingsManager.instance=function(){return n||(n=new P.SocialNetworkSettingsManager),n}}(),function(){goog.provide("P.conversationsManager"),goog.require("P.resourceResponse"),goog.require("P.modules.Conversation"),goog.require("P.modules.ActiveConversations"),goog.require("P.modules.ConversationHead");var e=5,t="activeConversations",n=72,r=function(){this.activeConversationsContainer=null,this.conversations={},this.conversationIdToLastMessageId={},this.conversationIds=[],this._openConversation=null,this._logger=P.logging.getLogger("ConversationsManager")};_.extend(r.prototype,Backbone.Events),_.extend(r.prototype,{_fetchingConversations:!1,_pendingRequest:null,getContainer:function(){return this.activeConversationsContainer},setContainer:function(e){this.activeConversationsContainer=e},setDraggedObject:function(e){this._draggedObject=e},getDraggedObject:function(){return this._draggedObject},listenForConversations:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&this.listenTo(P.Updater.instance(),"conversations_unseen_count",this.onUnseenConversationsCount)},onUnseenConversationsCount:function(e){(e>0||this._shouldUpdateConversations)&&this._fetchConversations().then(function(e){this._shouldUpdateConversations=!1,this._updateActiveConversations(e)}.bind(this)),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT,e)},_fetchConversations:function(){if(!this._fetchingConversations){var e=P.resourceFactory.create("ConversationsResource",{});this._pendingRequest=P.resourceCache.instance.callGet(e),this._pendingRequest.then(function(){this._conversationsBookmarks=e.get("bookmarks")}.bind(this)).fin(function(){this._fetchingConversations=!1}.bind(this)),this._fetchingConversations=!0}return this._pendingRequest},getConversationsBookmarks:function(){return this._conversationsBookmarks},_updateActiveConversations:function(e){_.each(e,function(e){var t=e.id,n=e.last_message,r=this.conversationIdToLastMessageId[t];n&&n.id!==r&&(_.isUndefined(r)&&e.unread<=0||(_.contains(this.conversationIds,t)?this.conversations[t].updateConversation(e):n.sender.id!==P.currentUser.get("id")&&this.addConversation(e,!1),this.conversationIdToLastMessageId[t]=n.id))}.bind(this))},deleteConversationBadgeCount:function(){var e=P.resourceFactory.create("ConversationBadgeResource",{});e.callDelete({showError:!1})},sendMessageToUsers:function(e,t,n){var r={user_ids:e||[],emails:t||[]},i=this._sendNewMessage("ConversationsResource",r,n);return i.then(function(e){var t=e.resource_response.data;this.addConversation(t)}.bind(this)),i},sendMessageToConversation:function(e,t){var n={conversation_id:e};return this._sendNewMessage("ConversationMessagesResource",n,t)},_sendNewMessage:function(e,t,n){n.text&&(t.text=n.text),n.object_id&&(t[n.object_type]=n.object_id);var r=P.resourceFactory.create(e,t),i=r.callCreate({error:this._handleSendMessageError.bind(this)});return i.then(function(){this._shouldUpdateConversations=!0}.bind(this)),i},_handleSendMessageError:function(e){var t=e.extra_data;if(243===e.api_error_code&&t.objects){var n=t.objects;P.loadModule({name:"ConfirmDialog",options:{template:"message_object_auth_error",attached_object:n.object,users:n.users,emails:n.emails}}).then(function(e){P.getModalManager().createAndShowModal(e)})}},logContextEvent:function(e,t,n,r){var i=P.ContextEvent.fromEventType(e);if(n&&i.setObjectIdStr(n),r){if(r.attr("data-element-type")){var o=parseInt(r.attr("data-element-type"),10);i.setElement(o)}var s=r.closest("[data-component-type]");if(s.length){var a=parseInt(s.attr("data-component-type"),10);i.setComponent(a)}}i.updateAuxData({conversation_id:t}),P.ContextLogger.getInstance().addEvent(i)},_addConversationToDom:function(e,t,n){var r=this.getContainer();if(r){var i=e.id;this.conversationIds.push(i),this.cacheActiveConversations();var o={id:i};(!P.currentUser.isAuthenticated()||P.currentUser.isLimitedLogin())&&(o.unauth=!0),e.users=_.reject(e.users,function(e){return e.id===P.currentUser.get("id")}),t&&(o.peek=!1);var s=new P.modules.Conversation({options:o,data:e});s.renderExistingData().then(function(){this.conversations[i]=s,this.resetConversationHeadTransforms(),r.appendChild(s),n&&s.setInactive(),s.setBadgeCount(e.unread),t?this.openConversation(s):this._openConversation&&this._openConversation.adjustPopup(),s.focus()}.bind(this)),this._ensureWithinMaxNumberOfConversations()}},_animateAddConversation:function(e,t,n){var r=_.reject(e.users,function(e){return e.id===P.currentUser.get("id")}),i=this._addConversationToDom.bind(this,e,t);t&&this._openConversation&&this._openConversation.closePopup();var o;if(n&&n.length)o=this._makeAnimatedElement(n),this._animateShowConversationHead(o,i);else{var s=new P.modules.ConversationHead({options:{users:r,emails:e.emails}});s.render().then(function(){o=this._makeAnimatedElement(s.$el),this._animateShowConversationHead(o,i)}.bind(this))}},_makeAnimatedElement:function(e){var t=e.clone();return t.addClass("cloned").offset({left:-1e3,top:-1e3}).appendTo($("body")),t},_animateShowConversationHead:function(e,t){var r=this.getContainer(),i=r.getContent(),o=i.offset(),s=o.left,a=o.top,u=r.getHeight(!0),c=i.find(".ConversationHead");c.transition({y:-n},280,"ease"),e.addClass("normal opening"),e.removeClass("medium small"),e.width(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).height(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).css("visibility","hidden"),e.offset({left:s,top:a+u-P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION-3}),e.transition({scale:0,duration:1},function(){$(this).css("visibility","")}).transition({scale:1.2,duration:180}).transition({scale:1,duration:100},function(){t(),e.remove()})},cacheActiveConversations:function(){P.LocalStorage.setItem(t,this.conversationIds)},_ensureWithinMaxNumberOfConversations:function(){if(this.conversationIds.length>e){var t=this.conversationIds[0];this.removeOverboundsConversation(t)}},removeOverboundsConversation:function(e){var t=this.conversations[e],n=t.getContent();n.transition({scale:.8},200).transition({scale:2,opacity:0},200,"ease",function(){this.resetConversationHeadTransforms(),this.removeConversationById(e)}.bind(this))},loadInitialConversations:function(e){var n=P.LocalStorage.getItem(t);n&&n.length||(n=[],this._publishNoActiveConversationsIfNeeded());var r=[].concat(n);this._fetchConversations().then(function(t){var n=!!e;_.each(t,function(t){var i=t.id===e;i?(this._addConversationToDom(t,!0),n=!1):_.contains(r,t.id)&&this._addConversationToDom(t,!1)}.bind(this)),this._updateActiveConversations(t),n&&this.addConversationById(e,!0),this.cacheActiveConversations()}.bind(this))},addConversation:function(e,t,n){_.isUndefined(t)&&(t=!0);var r=e.id,i=this.conversations[r];i?(i.updateConversation(e),t&&this.openConversation(i)):this._animateAddConversation(e,t,n),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED)},addConversationById:function(e,t){if(_.contains(this.conversationIds,e))return void(t&&this.openConversation(this.conversations[e]));var n=P.resourceFactory.create("ConversationResource",{conversation_id:e});n.callGet({showError:!1}).then(function(e){var n=e.resource_response.data;this.addConversation(n,t)}.bind(this))},addConversationForUnauthUser:function(e){var t=P.getQueryStringParams(),n=t.user_id,r=t.od;if(n&&r){var i=P.resourceFactory.create("UnauthConversationResource",{conversation_id:e,user_id:n,od:r});i.callGet().then(function(e){var t=e.resource_response.data;this._unauthUserEmail=t.unauth_user_email;var n=t.conversation;this.addConversation(n,!0)}.bind(this))}},getUnauthUserEmail:function(){return this._unauthUserEmail},listenForActiveConversationUpdates:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&(P.Updater.instance().setMinPoll(P.CONST.UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL),P.ConversationsUpdater.instance().activate(),this.activeConversationsListener||(this.activeConversationsListener=this.listenTo(P.ConversationsUpdater.instance(),"active_conversations",this.onActiveConversationsUpdate)))},getOpenConversationId:function(){return this._openConversation?this._openConversation.data.id:!1},onActiveConversationsUpdate:function(e){this._updateActiveConversations(e)},stopListeningForActiveConversationUpdates:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&(P.ConversationsUpdater.instance().deactivate(),P.Updater.instance().setMinPoll(P.CONST.UPDATES_MIN_POLL),this.activeConversationsListener&&(this.stopListening(this.activeConversationsListener),this.activeConversationsListener=null))},getConversationIds:function(){return this.conversationIds},hasActiveConversations:function(){return this.getConversationIds().length>0},resetConversationHeadTransforms:function(){var e=this.getContainer();e&&e.$(".ConversationHead").css("transform","")},scaleConversationDownAndRemove:function(e){var t=this.conversations[e],r=t.getContent(),i=_.indexOf(this.conversationIds,e),o=this.getContainer().getConversationHeads(),s=o.slice(0,i);r.transition({scale:1.1},120,function(){s.length&&s.transition({y:n},140)}).transition({scale:0},140,"ease",function(){this.resetConversationHeadTransforms(),this.removeConversationById(e)}.bind(this))},removeConversationById:function(e){if(this.conversationIds=_.without(this.conversationIds,e),this.conversations[e]){this._openConversation&&(this._openConversation.getConversationId()===e?this.closeConversation(this._openConversation):this._openConversation.adjustPopup());var t=this.conversations[e];t.destroy(),delete this.conversations[e],this.cacheActiveConversations(),this._publishNoActiveConversationsIfNeeded()}},_publishNoActiveConversationsIfNeeded:function(){0===this.conversationIds.length&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS)},closeAllConversations:function(){_.each(this.conversations,function(e){this.closeConversation(e)}.bind(this))},closeConversation:function(e){this.stopListeningForActiveConversationUpdates(),this.setAllActive(),e.closePopup(),this._openConversation===e&&(this._openConversation=null,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED,null))},setAllActive:function(){_.each(this.conversations,function(e){e.setActive()})},setAllInactive:function(e){_.each(this.conversations,function(e){e!==this._openConversation&&e.setInactive()}.bind(this))},closeConversationById:function(e){var t=this.conversations[e];t&&this.closeConversation(t)},openConversation:function(e){this.conversations[e.getConversationId()]&&(this._openConversation?(this._openConversation.setInactive(),this._openConversation.closePopup()):this.setAllInactive(e),this._openConversation=e,this._openConversation.setActive(),e.showPopup(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN,null),this.listenForActiveConversationUpdates())}}),P.setConversationsManager=function(e){P._conversationsManager=e},P.getConversationsManager=function(){return P._conversationsManager},P.setConversationsManager(new r)}(),function(){goog.provide("P.conversationsUtil"),P.getConversationFromUrl=function(){var e,t=P.getQueryStringParams(),n=window.location.pathname,r="/conversation/",i=0===n.indexOf(r);if((t.conversation||i)&&(e=t.conversation,!e)){var o=n.split(r),s=o[1];e=s.split("/")[0]}return e}}(),function(){goog.provide("P.updater");var e="mousemove.updater";P.Updater=function(){this.decay=0,this.lastFetchTime=0,this.timeout=null,this.recentPinId=null,this._minPoll=P.CONST.UPDATES_MIN_POLL,this._numRetries=0,this.updatesResource=P.resourceFactory.create("UpdatesResource",{}),$(document).on(e,_.throttle(function(){this.wake()}.bind(this),1e3)),this.deferredFetch()},_.extend(P.Updater.prototype,Backbone.Events),_.extend(P.Updater.prototype,{getUpdatesResourceOptions:function(){var e={};return this.recentPinId&&(e.last_pin_id=this.recentPinId),e},setRecentPinId:function(e){this.recentPinId=e},setMinPoll:function(e){this._minPoll=e},wake:function(){this.msSinceLastFetch()>this._minPoll&&(this._numRetries=0,this.decay=0,this.fetch())},fetch:function(){clearTimeout(this.timeout),this.lastFetchTime=(new Date).getTime(),this.updatesResource.setOptions(this.getUpdatesResourceOptions()),this.updatesResource.callGet({showError:!1}).then(function(e){var t=e.resource_response.data;this._numRetries=0,_.each(t,function(e,t){this.trigger(t,e)}.bind(this)),this.deferredFetch()}.bind(this),function(){this.attemptDeferredFetch()}.bind(this))},attemptDeferredFetch:function(){this._numRetries++,this._numRetries<5?this.deferredFetch():$(document).off(e)},deferredFetch:function(){this.decay=Math.min(2*(this.decay||1e3),P.CONST.UPDATES_MAX_POLL),this.timeout=P.setTimeout(function(){this.fetch()}.bind(this),this._minPoll+this.decay)},msSinceLastFetch:function(){return(new Date).getTime()-this.lastFetchTime}}),P.Updater.instance=function(){return P.Updater._instance||(P.Updater._instance=new P.Updater),P.Updater._instance}}(),function(){goog.provide("P.conversationsUpdater"),P.ConversationsUpdater=function(){this.conversationsUpdatesResource=P.resourceFactory.create("ConversationsUpdatesResource",{}),this.poller=null,this._numRetries=0,this._requestConversationId=null,this._pollInterval=null},_.extend(P.ConversationsUpdater.prototype,Backbone.Events),_.extend(P.ConversationsUpdater.prototype,{fetch:function(){if(!this.pendingRequest){var e=P.getConversationsManager().getOpenConversationId();e&&(this.pendingRequest=!0,this._requestConversationId!==e&&(this._requestConversationId=e,this.conversationsUpdatesResource.resetBookmark(),this.conversationsUpdatesResource.setOptions({conversation_ids:[this._requestConversationId]})),this.conversationsUpdatesResource.callGet({showError:!1}).then(function(e){this.pendingRequest=!1,this._numRetries=0;var t=e.resource_response.data,n=t.updated_conversations||[];this._activated&&t.wait&&this._setNextPoll(1e3*t.wait),n.length>0&&this.trigger("active_conversations",n)}.bind(this),function(){this.pendingRequest=!1,this.deactivateIfNecessary()}.bind(this)))}},deactivateIfNecessary:function(){this._numRetries++,this._numRetries>5&&this.deactivate()},deactivate:function(){this._resetPoller(),this.pendingRequest=!1,this._activated=!1},activate:function(){this._setNextPoll(P.CONST.OPEN_CONVERSATION_MIN_POLL),this._numRetries=0,this._activated=!0},_setNextPoll:function(e){this.pendingRequest||(e&&this._pollInterval===e||this._resetPoller(),e&&this._pollInterval!==e&&(this.poller=window.setInterval(function(){this.fetch()}.bind(this),e)),this._pollInterval=e)},_resetPoller:function(){this.poller&&clearInterval(this.poller),this.poller=null,this._pollInterval=null},isActive:function(){return this._activated}}),P.ConversationsUpdater.instance=function(){return P.ConversationsUpdater._instance||(P.ConversationsUpdater._instance=new P.ConversationsUpdater),P.ConversationsUpdater._instance}}(),function(){goog.provide("P.title"),P.Title=function(){this.prefixCount=0,this.previousCount=0},_.extend(P.Title.prototype,{setPrefixCount:function(e){this.previousCount=this.prefixCount,this.prefixCount=Math.max(e,0),this._updateTitle()},incrementPrefixCount:function(){this.setPrefixCount(this.prefixCount+1)},resetPrefix:function(){this.setPrefixCount(0)},decrementPrefixCount:function(){this.setPrefixCount(this.prefixCount-1)},_updateTitle:function(){if(this.prefixCount!==this.previousCount){var e,t=document.title,n=t.split("("+this.previousCount+") "),r=n.length>1?_.rest(n).join(""):n[0];e=this.prefixCount?"("+this.prefixCount+") "+r:r,window.document.title=e}}}),P.Title.instance=function(){return P.Title._instance||(P.Title._instance=new P.Title),P.Title._instance}}(),function(){goog.provide("P.writeban"),P.writeban={},P.writeban.showWriteBanned=function(e){var t=P.string.format(P._("Due to strange activity, we put your account in safe mode to protect your Pins. You just need to reset your password.")),n={name:"ConfirmDialog",options:{button_text:P._("Reset Password"),body_message:t,title:P._("Safe mode alert!"),template:"generic"}},r=function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)}.bind(e),i=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_CLICK),this.showLoading();var e=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username}),t=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_SUCCESS);var e={name:"ConfirmDialog",options:{email:P.currentUser.attributes.email,template:"password_reset_email_sent"}};P.loadModule(e).then(function(e){this.showInModal(e,null),this.listen(e,P.CONST.EVENT_DESTROYED,r)}.bind(this))}.bind(this),n=function(){this.hideLoading()}.bind(this),i=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_ERROR)};e.callCreate({showError:!1}).then(t,i).fin(n)}.bind(e);P.loadModule(n).then(function(e){this.showInModal(e,null),this.listen(e,P.CONST.EVENT_CONFIRM,i),this.listen(e,P.CONST.EVENT_DISMISS,r)}.bind(e))}}(),function(){goog.provide("P.limitedLogin"),goog.require("P.router"),P.limitedLogin={},P.limitedLogin.showLogin=function(e){var t={name:"ConfirmDialog",options:{button_text:P._("Log In"),body_message:P._("You just need to log in first."),title:P._("Almost there..."),template:"generic"}},n=function(){var e=encodeURIComponent(P.getCurrentUrl());P.router.get().navigate("/login/?next="+e)},r=function(){e.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)};P.loadModule(t).then(function(e){this.showInModal(e,{can_dismiss:!0}),this.listen(e,P.CONST.EVENT_CONFIRM,n),this.listen(e,P.CONST.EVENT_DISMISS,r)}.bind(e))}}(),function(){goog.provide("P.translate"),P.translate={},P.translate.detect=function(e){var t=P.resourceFactory.create("LanguageDetectionResource",{text:e});return t.callGet()},P.translate.translate=function(e,t){var n=P.resourceFactory.create("LanguageTranslationResource",{text:e,to:t});return n.callGet()}}(),function(){goog.provide("P.browserExtension"),goog.require("P.BrowserDetector"),goog.require("P.BrowserExtensionUrls");var e=_.object([[P.CONST.BrowserType.CHROME,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_CHROME_URL,newWindow:!0}],[P.CONST.BrowserType.FIREFOX,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_FIREFOX_URL,newWindow:!1}],[P.CONST.BrowserType.SAFARI,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_SAFARI_URL,newWindow:!1}],[P.CONST.BrowserType.IE,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_IE_URL,newWindow:!1}],[P.CONST.BrowserType.OPERA,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_OPERA_URL,newWindow:!0}]]),t=function(){};t.prototype={handleExtensionInstall:function(e,t){var n=this._getBrowserExtensionUrl();n&&(this.isChrome()?this._handleChromeExtensionInstall(e,t):P.changeWindowLocation(n,this._openInNewWindow()))},_handleChromeExtensionInstall:function(e,t){if(!this.isExtensionInstalled()){var n=this._getBrowserExtensionUrl();chrome.webstore.install(n,e,t)}},isExtensionInstalled:function(){return void 0!==$("body").attr("data-pinterest-extension-installed")},isChrome:function(){return P.BrowserDetector.getBrowser()===P.CONST.BrowserType.CHROME},_getBrowserExtensionUrl:function(){var t=P.BrowserDetector.getBrowser();return t?e[t].url:void 0},_openInNewWindow:function(){var t=P.BrowserDetector.getBrowser();return t?e[t].newWindow:void 0}},P.browserExtension.instance=new t}(),function(){goog.provide("P.BrowserDetector"),P.BrowserDetector={},P.BrowserDetector.getBrowser=function(){var e=!!window.opera||window.navigator.userAgent.indexOf(" OPR/")>=0,t="InstallTrigger"in window,n=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,r=!!window.chrome&&!e,i=!1||!!document.documentMode;return t?P.CONST.BrowserType.FIREFOX:e?P.CONST.BrowserType.OPERA:r?P.CONST.BrowserType.CHROME:i?P.CONST.BrowserType.IE:n?P.CONST.BrowserType.SAFARI:P.CONST.BrowserType.OTHER}}(),function(){goog.provide("P.interfaces.IToastsManager"),goog.require("P.modules.Toasts"),goog.require("P.modules.ToastBase"),P.interfaces.IToastsManager=function(){},_.extend(P.interfaces.IToastsManager.prototype,Backbone.Events),_.extend(P.interfaces.IToastsManager.prototype,{setContainer:function(e){},getContainer:function(){},addToast:function(e){}})}(),function(){goog.provide("P.toastsManager"),goog.require("P.modules.ToastBase"),goog.require("P.modules.Toasts");var e=function(){this.container=null,this.toasts=[]};_.extend(e.prototype,Backbone.Events),_.extend(e.prototype,{setContainer:function(e){this.container=e},getContainer:function(){return this.container},addToast:function(e,t){t=t||50,e.renderExistingData().then(function(){var n=this.getContainer();n.children.length?P.setTimeout(function(){n.appendChild(e)},t):n.appendChild(e)}.bind(this))},removeAllToasts:function(){this.getContainer().$el.empty()}}),P._toastsManager=new e,P.getToastsManager=function(){return P._toastsManager}}(),function(){goog.provide("P.focusWithoutScrolling"),jQuery.fn.focusWithoutScrolling=function(){var e=$(".Closeup");return this.each(function(t,n){var r=$(window),i=r.scrollLeft(),o=r.scrollTop();return $(n).focus(),e.length?(o=e.scrollTop(),void e.scrollTop(o)):(r.scrollLeft(i),void r.scrollTop(o))}),this}}(),function(){goog.provide("P.signupModalManager"),P.signupModalManager={modalsEnabled:!0},P.signupModalManager.disableModals=function(){P.signupModalManager.modalsEnabled=!1},P.signupModalManager.ENTICING_CATEGORIES=["food_drink"],P.signupModalManager.PINVITATIONAL_BOARDS=["/PinterestPH/discover-philippines/"],P.signupModalManager.showInlineSignupModalOnButtonClick=function(e){var t=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled"]),n={LikeButton:P._("Sign up to get more details about this Pin"),ShowModalButton:P._("Sign up to get more details about this Pin"),ContinueButton:P._("Sign up for free!"),InterestFollowButton:P._("Sign up to see more Pins"),UserFollowButton:P._("Sign up to get more details about this Pinner"),BoardFollowButton:P._("Sign up to get more details about this board"),ContinueSignupButton:P._("Sign up to see more Pins"),SignupButton:P._("Sign up to see more Pins")},r={extra_class:"redesign",can_dismiss:!1,prev:window.location.pathname,next:window.location.pathname};["InterestFollowButton","UserFollowButton","BoardFollowButton"].indexOf(e)>-1&&(r.auto_follow=!0);var i=n[e];i&&(r.tagline=n[e],P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HIDE_UNAUTH_BANNER),t?P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,r):P.UserRegistration.showSignupModal("PlainSignupModal",null,r))},P.signupModalManager.showInlineSignupModal=function(e,t){var n=!!Cookie.get(P.CONST.COOKIE_GIFT_WRAP_HOLDOUT),r=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled"]),i=P._("Sign up to see more Pins"),o={BoardPage:P._("Sign up to get more details about this board"),UserProfilePage:P._("Sign up to get more details about this Pinner"),DomainFeedPage:P._("Sign up to see more Pins from this website"),Closeup:P._("Sign up to get more details about this Pin"),PaddedPin:P._("Sign up to get more details about this Pin"),SearchPage:i,InterestFeedPage:i,CategoriesPage:i,FeedPage:i};P.experiments.instance.inExperimentGroups("unified_auth_v2_email",["enabled","employees"])&&(o.Closeup=P._("Continue to get more details about this Pin"));var s=["Closeup","PaddedPin"],a={extra_class:"redesign",can_dismiss:!1,prev:window.location.pathname,next:window.location.pathname},u=o[e.className],c=n||r&&"BoardPage"===e.className&&_.contains(P.signupModalManager.PINVITATIONAL_BOARDS,e.data.url);if(u&&!c)if(a.tagline=u,_.contains(s,e.className)&&!P.CONTEXT.is_mobile_agent)t.options.bookmarks&&delete t.options.bookmarks,t.callGet({showError:!1}).then(function(e){var n=e.resource_response.data;n.board&&_.contains(P.signupModalManager.PINVITATIONAL_BOARDS,n.board.url)||(r?P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,a):n.board&&_.contains(P.signupModalManager.ENTICING_CATEGORIES,n.board.category)?(a.category=n.board.category,P.UserRegistration.showSignupModal("WidescreenSignupModal",t,a)):P.UserRegistration.showSignupModal("CloseupSignupModal",t,a))});else if(r)P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,a);else if(P.CONTEXT.is_mobile_agent)P.UserRegistration.showSignupModal("PlainSignupModal",null,a);else if(P.experiments.instance.activateAndPersistExperiment("plain_modal_replacement"),
P.experiments.instance.inExperimentGroups("plain_modal_replacement",["enabled_inspired"])){if(!e.options.show_full_page_takeover){var l=P.app.getChildByModuleName("Nags").getChildByModuleName("UnauthBanner");l.showFullPageTakeover(),l.lockFullScreen=!0}}else P.experiments.instance.inExperimentGroups("plain_modal_replacement",["enabled_closeup"])?P.UserRegistration.showSignupModal("CloseupSignupModal",t,a):P.UserRegistration.showSignupModal("PlainSignupModal",null,a)}}(),function(){goog.provide("P.SourceContentManager");var e=10,t=function(e,t,n){this.currentPinId=null,this.handleContentChange=n,this.sourceContent=[],this.currentPosition=null,this.resource=null,this.setupSourceContentManager(t,e)};t.prototype={setupSourceContentManager:function(e,t){this.currentPinId=t,this.currentPosition=null,this.resource=this._duplicateResource(e.resource),this.sourceContent=[],this.appendSourceContent(e.data)},appendSourceContent:function(e){e=e||[];for(var t=0,n=null,r=0;r<e.length;r++)n=e[r],n&&"pin"===n.type?(this.sourceContent.push(n),this.currentPinId===n.id&&(this.currentPosition=r-t)):t+=1},setupResource:function(e,t){this.currentPinId=t,this.sourceContent=[],this.currentPosition=null,this.resource=e,this.getSourcePins()},_duplicateResource:function(e){return P.resourceFactory.create(e.getName(),e.copyOptions(!1))},setItemByKeyPress:function(e){var t=this.keyCodeToIncrement(e);t&&this.setItemByIncrement(t)},keyCodeToIncrement:function(e){switch(e){case P.keyCode.LEFT:return-1;case P.keyCode.RIGHT:return 1;default:return null}},setItemByIncrement:function(t){null!==this.currentPosition&&this.sourceContent.length?this.currentPosition+t<0||this.resource.atEnd()&&this.currentPosition+t>=this.sourceContent.length?this.handleContentChange(null):(this.currentPosition>this.sourceContent.length-e&&!this.resource.atEnd()&&this.getSourcePins(),this.currentPosition+=t,this.currentPinId=this.sourceContent[this.currentPosition].id,this.handleContentChange(this.sourceContent[this.currentPosition].id)):this.getSourcePins()},getSourcePins:function(){this.resource&&(0===this.sourceContent.length&&this.resource.resetBookmark(),this.resource.callGet({showError:!1}).then(function(e){this.setSourceContentFromResponse(e)}.bind(this)))},setSourceContentFromResponse:function(e){var t=e.resource_response;t.error||this.appendSourceContent(t.data)},getCurrentPinData:function(){return this.sourceContent[this.currentPosition]}},P.SourceContentManager=t}(),function(){goog.provide("P.imageDimensions");var e=736,t=370,n=553,r=166;P.ImageDimensions={getDetailedImageDimensions:function(i){var o={width:e,height:t},s={youtube:o,vimeo:o,vevo:o,soundcloud:{width:n,height:r}};if(i.is_playable&&(i.is_video||i.attribution&&i.attribution.embed)){if(i.attribution){var a=s[i.attribution.provider_name];if(a)return a}if(i.embed)return i.embed}return i.images["736x"]}}}(),goog.provide("P.experienceManager"),goog.require("P.Experiences"),goog.require("P.logging"),goog.require("P.resourceFactory"),goog.require("P.Set");var logger=P.logging.getLogger("ExperienceManager"),PlacedExperience,PlacedExperiences;P.ExperienceManager=function(e){this._placedExperiences=e,this._triggered=new P.Set},P.ExperienceManager.prototype={_getResource:function(e,t){return P.resourceFactory.create(e,t)},constructPlacedExperienceId:function(e,t){return e&&t?e+":"+t:null},isPlacedExperience:function(e,t){var n=this.getPlacedExperienceId(e,t);return n&&this.triggerPlacedExperienceId(n),null!==n},isPlaced:function(e){return void 0!==this._placedExperiences[e]},getPlacedExperienceId:function(e,t){if(e&&t){var n=this._placedExperiences[e];if(n&&n.experience_id===t)return n.id}return null},launchPlacedExperience:function(e,t,n){return this.getPlacedExperienceWithContext(e,t).then(function(t){if(t){if(t.experience_id===P.Experiences.Experience.WEB_BLANK_SESSION)return void this.viewPlacedExperience(e,P.Experiences.Experience.WEB_BLANK_SESSION);if(t.placement_id=e,t.type===P.Experiences.ExperienceType.GUIDE||t.type===P.Experiences.ExperienceType.NUX||t.type===P.Experiences.ExperienceType.TOOLTIP)return P.ExperienceTutorialManager.instance().startTutorial(t).then(function(){return this.viewPlacedExperience(e,t.experience_id),Promise.resolve(!0)}.bind(this));if(t.experience_id===P.Experiences.Experience.WEB_PINVITATIONAL_HOMEFEED_MODAL){var r={name:"PinvitationalInviteHomefeedModal",options:{placedExperienceId:t.id}};if(!P.TutorialManager.instance().isTutorialActive())return P.loadModule(r).then(function(e){return P.getModalManager().createAndShowModal(e,{can_dismiss:!1,only_modal:!0}),Promise.resolve(!0)})}else if(t.experience_id===P.Experiences.Experience.WEB_USER_NEWS_APP_UPSELL){var i={name:"AppInstallModal",options:{placedExperienceId:t.id}};if(!P.TutorialManager.instance().isTutorialActive())return P.loadModule(i).then(function(e){return P.getModalManager().createAndShowModal(e,{only_modal:!0}),Promise.resolve(!0)})}else if(t.type===P.Experiences.ExperienceType.SURVEY){if(n){var o={name:"ConfirmDialog",options:t.display_data};return P.loadModule(o).then(function(r){return P.getModalManager().createAndShowModal(r,{mask_type:"dark",can_dismiss:!1}),this.viewPlacedExperience(e,t.experience_id),P.trackRegisterAction("web_survey_viewed"),n.listen(r,P.CONST.EVENT_CONFIRM,function(){window.open(t.display_data.uri),this.completePlacedExperience(e,t.experience_id),P.trackRegisterAction("web_survey_completed")}.bind(this)),n.listen(r,P.CONST.EVENT_CLOSE,function(){this.dismissPlacedExperience(e,t.experience_id),P.trackRegisterAction("web_survey_dismissed")}.bind(this)),Promise.resolve(!0)}.bind(this))}}else{if(t.type===P.Experiences.ExperienceType.TOAST)return t.display_data.module?(this.viewPlacedExperienceId(t.id),P.loadModule({name:t.display_data.module}).then(function(e){return P.getToastsManager().addToast(e),Promise.resolve(!0)})):Promise.resolve(!1);var s=P.ExperienceManager.Tutorials[t.experience_id];if(s)return P.TutorialManager.instance().startTutorial(s,{display_data:t.display_data}).then(function(){return this.viewPlacedExperience(e,t.experience_id),Promise.resolve(!0)}.bind(this))}return Promise.resolve(!0)}return Promise.resolve(!1)}.bind(this))},getPlacedExperienceWithContext:function(e,t){if(!e)return Promise.resolve(null);var n=this.getPlacedExperience(e);if(n&&n.experience_id!==P.Experiences.Experience.NOOP||_.isEmpty(t))return n?(n.triggerable_placed_exps&&n.triggerable_placed_exps.forEach(function(e){this.triggerPlacedExperienceId(e,t)}.bind(this)),Promise.resolve(n)):Promise.resolve(null);var r=this._getResource("UserExperienceResource",{placement_ids:[e],extra_context:t});return r.callGet({showError:!1}).then(function(n){var r=n.resource_response.data||{},i=r[e];return i?(i.triggerable_placed_exps&&i.triggerable_placed_exps.forEach(function(e){this.triggerPlacedExperienceId(e,t)}.bind(this)),i):null}.bind(this))},getPlacedExperience:function(e){return this._placedExperiences[e]||null},refreshPlacedExperiences:function(){logger.debug("Refreshing all placed experiences.");var e=this._getResource("UserExperiencePlatformResource");e.callGet({showError:!1}).then(function(e){var t=e.resource_response.data;this._placedExperiences=t}.bind(this))},dismissPlacedExperience:function(e,t){var n=this.getPlacedExperienceId(e,t);return n?(delete this._placedExperiences[e],this.dismissPlacedExperienceId(n)):Promise.resolve()},dismissPlacedExperienceId:function(e){if(e){logger.debug("Delete placed experience: ",e);var t=this._getResource("UserExperienceResource",{placed_experience_id:e});return t.callDelete({showError:!1}).then(function(){return void this.refreshPlacedExperiences()}.bind(this))}return Promise.resolve()},viewPlacedExperience:function(e,t){var n=this.getPlacedExperienceId(e,t);n&&this.viewPlacedExperienceId(n)},triggerPlacedExperienceId:function(e,t){if(!this._triggered.contains(e)){this._triggered.add(e);var n=this._getResource("UserExperienceTriggerResource",{placed_experience_id:e,extra_context:t});n.callUpdate({showError:!1})}},triggerPlacedExperienceIds:function(e,t){e.forEach(function(e){this.triggerPlacedExperienceId(e,t)}.bind(this))},viewPlacedExperienceId:function(e){if(e){logger.debug("Viewed placed experience: ",e);var t=this._getResource("UserExperienceViewedResource",{placed_experience_id:e});t.callUpdate({showError:!1})}},completePlacedExperience:function(e,t){var n=this.getPlacedExperienceId(e,t);return n?(delete this._placedExperiences[e],this.completePlacedExperienceId(n)):Promise.resolve()},completePlacedExperienceId:function(e){if(e){logger.debug("Complete placed experience: ",e);var t=this._getResource("UserExperienceCompletedResource",{placed_experience_id:e});return t.callUpdate({showError:!1}).then(function(){return void this.refreshPlacedExperiences()}.bind(this))}return Promise.resolve()}};var instance=null;P.ExperienceManager.instance=function(){if(!instance){var e=P.expns;instance=new P.ExperienceManager(e),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,function(e,t,n){instance=new P.ExperienceManager(n)})}return instance},P.ExperienceManager.Tutorials={},P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_PIN_USER_ED]="firstPinIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_YOUR_BOARDS_USER_ED]="yourBoards",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIND_FRIENDS_USER_ED]="findFriends",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED]="emptyPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED]="filledPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_BOARD_USER_ED]="firstBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_MOBILE_NUX_INTERESTS]="interestsNuxMweb",P.ExperienceManager.Tutorials[P.Experiences.Experience.ANALYTICS_HOME_USER_ED]="analyticsHomeUserEd",P.ExperienceManager.Tutorials[P.Experiences.Experience.ANALYTICS_AUDIENCE_SELECTOR_USER_ED]="analyticsAudienceSelectorUserEd",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_BOARD_ED]="emptyBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_BOARD_ED_MANUAL]="emptyBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_V2]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_MANUAL]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_V2_MANUAL]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_REPIN_ED]="repin",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_REPIN_ED_MANUAL]="repin",goog.provide("P.versionedFileLoader"),goog.require("P.logging"),goog.require("P.script"),goog.require("P.staticFileUrls");var versionedFileLoaderLog=P.logging.getLogger("VersionedFileLoader");P.VersionedFileLoader=function(){},P.VersionedFileLoader.prototype={loadScript:function(e,t){var n=P.staticFileUrls.get(e);return n?(P.script.load([],n,e),void P.script.ready(e,function(){t()})):void versionedFileLoaderLog.error('Tried loading file "'+e+'", but it does not exist.')}},P.VersionedFileLoader.instance=new P.VersionedFileLoader,goog.provide("P.adTracking"),P.AdTracking={};var GO_CONVERSION_PIXEL="983308403",GO_CONVERSION_LABEL="BAZXCN218AYQ87Dw1AM";P.AdTracking.trackConversions=function(){P.currentUser.isAuthenticated()&&Cookie.get(P.CONST.COOKIE_USER_JUST_REGISTERED)&&(P.AdTracking.pingGoogleConversion(GO_CONVERSION_PIXEL,GO_CONVERSION_LABEL),P.AdTracking.pingFacebookConversion(),Cookie.unset(P.CONST.COOKIE_USER_JUST_REGISTERED))},P.AdTracking.pingUrl=function(e){var t=new Image;e+="&cache_bust="+Date.now(),t.src=e},P.AdTracking.pingGoogleConversion=function(e,t){P.AdTracking.pingUrl("https://www.googleadservices.com/pagead/conversion/"+e+"/?value=0&label="+t+"&guid=ON&script=0")},P.AdTracking.pingFacebookConversion=function(){P.AdTracking.pingUrl("https://www.facebook.com/offsite_event.php?id=6016714330942&value=0&currency=USD")},function(){goog.provide("P.nuxUtils"),goog.require("P.Event"),P.NuxUtils={},P.NuxUtils.MODULE_NAME_CLOSEUP="Closeup",P.NuxUtils.MODULE_NAME_FEEDPAGE="FeedPage",P.NuxUtils.MODULE_NAME_SEARCHPAGE="SearchPage",P.NuxUtils.preventNavigationIfNecessary=function(e){var t=e&&e.data?e.data.url:"";if(P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)){var n=P.router.get().resolve(t);if(!n)return P.NuxUtils.handleAutobahnExternalClick(e),!0;var r=n.module;if(r!==P.NuxUtils.MODULE_NAME_CLOSEUP&&r!==P.NuxUtils.MODULE_NAME_FEEDPAGE&&r!==P.NuxUtils.MODULE_NAME_SEARCHPAGE)return P.NuxUtils.handleAutobahnExternalClick(e),!0}return!1},P.NuxUtils.handleAutobahnExternalClick=function(e){P.trackRegisterAction("autobahn_disabled_link"),e.stopPropagation();var t={name:"ConfirmDialog",options:{template:"autobahn_click_tip"}};P.loadModule(t).then(function(e){P.app.showInModal(e,{mask_type:"dark",can_dismiss:!1})})}}(),function(){goog.provide("P.reportMetrics"),goog.require("P.logToServer");var e={reportPageLoadMetrics:function(){if(Pc.reportPageLoadTimings){var e={};if(window.performance){if(window.performance.getEntriesByType){var t=window.performance.getEntriesByType("resource").filter(function(e){return e.name.match(/com\/\d+x/)})[0];t&&(e.firstPinTiming={url:t.name,start:Math.floor(t.startTime),duration:Math.floor(t.duration),responseEnd:Math.floor(t.responseEnd)})}if(window.performance.timing){var n=window.performance.timing,r=n.navigationStart;e.performanceTiming={navigationStart:r,requestStart:n.requestStart-r,responseStart:n.responseStart-r,domLoading:n.domLoading-r,responseEnd:n.responseEnd-r,domInteractive:n.domInteractive-r,domContentLoaded:n.domContentLoadedEventEnd-r,domComplete:n.domComplete-r,loadEventStart:n.loadEventStart-r}}if(Object.keys(e.performanceTiming).forEach(function(t){e.performanceTiming[t]<=0&&delete e.performanceTiming[t]}),window.chrome&&window.chrome.loadTimes){var i=window.chrome.loadTimes();e.firstPaint=1e3*(i.firstPaintTime-i.startLoadTime)}else if("number"===typeof window.performance.timing.msFirstPaint&&window.performance.timing.navigationStart){var o=window.performance.timing.msFirstPaint;e.msFirstPaint=o-window.performance.timing.navigationStart}_.isEmpty(e)||(P.PAGE_ROUTE_PATTERN&&(e.routePattern=P.PAGE_ROUTE_PATTERN),P.currentUser.attributes.country&&(e.country=P.currentUser.attributes.country),e.userAgent=window.navigator.userAgent,e.browser=P.CONTEXT.browser_name,e.isMobile=P.CONTEXT.is_mobile_agent,e.pathname=window.location.pathname,e.moduleName=P.app._getCurrentMainModule().className,P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.PAGE_LOAD_METRIC,P.logToServer.HTTP_METHOD.POST,e))}}P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.BROWSER_EXTENSION,P.logToServer.HTTP_METHOD.GET,{browser_extension_installed:P.browserExtension.instance.isExtensionInstalled()})}};$(window).on("load",function(){e.reportPageLoadMetrics()}),P.Errors.wrap(e,["reportPageLoadMetrics"])}(),function(){function e(e){return e===window.setTimeout?function(e,t){return window.setTimeout(e,t)}:e===window.setInterval?function(e,t){return window.setInterval(e,t)}:e===window.clearTimeout?function(e){return window.clearTimeout(e)}:e===window.clearInterval?function(e){return window.clearInterval(e)}:e}goog.provide("P.window");var t=function(t,n){var r=e(n);if(!P.Errors.ENABLE_WRAPPING)return r;var i=function(e,n,i){if("string"===typeof e&&(e=window[e]),!e)return-1;var o=t+":"+i,s=_.isFunction(e)?P.Errors.wrapFn(o,e):e;return r(s,n)};return i};P.setTimeout=t("setTimeout",window.setTimeout),P.setInterval=t("setInterval",window.setInterval),P.clearTimeout=t("clearTimeout",window.clearTimeout),P.clearInterval=t("clearInterval",window.clearInterval)}(),function(){goog.provide("P.Sticky");var e="sticky",t="absolute",n="below",r=t+" "+n,i=r+" "+e,o=e,s=0,a=1,u=2;P.Sticky=function(e,t){this.$el=e,this.elementHeight=null,this.headerHeight=t.headerHeight,this.boundElementHeight=null,this.$boundTo=t.$boundTo,this.$scrollable=t.$scrollable,this.updateFixed=this.updateFixed.bind(this),this._onScroll=this._onScroll.bind(this),this.$scrollable.on("scroll.sticky",this._onScroll),this.pendingScrollRAF=!1,this.lastState=null,P.deferDomManipulation(function(){this.elementHeight=e.height(),this.boundElementHeight=this.$boundTo.height()}.bind(this))},_.extend(P.Sticky.prototype,Backbone.Events),P.Sticky.prototype.destroy=function(){this.$scrollable.off("scroll.sticky",this.updateFixed)},P.Sticky.prototype.unSticky=function(){this.destroy()},P.Sticky.prototype._onScroll=function(e){this.pendingScrollRAF||(P.deferDomManipulation(function(){return this.scrollTop=this.$scrollable.scrollTop(),this.scrollTop===this.lastScrollTop?void(this.pendingScrollRAF=!1):(this.updateFixed(),this.lastScrollTop=this.scrollTop,void(this.pendingScrollRAF=!1))}.bind(this)),this.pendingScrollRAF=!0)},P.Sticky.prototype.updateFixed=function(){var t,n=$(window),o=n.scrollTop(),c=o,l=this.$boundTo.offset().top,d=l-this.headerHeight,h=l+this.boundElementHeight-this.headerHeight;t=c>=d&&c<=h?a:c>=h?u:s,t!==this.lastState&&(t===a?(this.$el.css("top","").addClass(e).removeClass(r),this.trigger(P.CONST.EVENT_STICKY_FIXED,!0)):t===u?(this.$el.removeClass(e),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1),this.handleReachingBottom()):t===s&&(this.$el.removeClass(i),this.trigger(P.CONST.EVENT_STICKY_NORMAL),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1))),this.lastState=t},P.Sticky.prototype.handleReachingBottom=function(){if(!this.$el.hasClass(r)){var e=this.boundElementHeight||0,i=this.$el.css("top");i=i?i.split("px")[0]:0,i=parseInt(i,10)||0,this.$el.addClass(t+" "+n).css("top",e+i+1)}},jQuery.fn.sticky=function(t){return this.each(function(n,r){var i=$(r),s=i.data(o);if(s&&(s.destroy(),i.removeData(e)),"unsticky"===t);else if("object"===typeof t){var a={$scrollable:t.$scrollable,$boundTo:t.$boundTo,headerHeight:t.headerHeight||0};t.$scrollable&&(s=new P.Sticky(i,a),i.data(o,s))}}),this}}(),function(){goog.provide("P.overflowingText"),jQuery.fn.overflowingText=function(){return this.each(function(e,t){if(t.offsetHeight<t.scrollHeight||t.offsetWidth<t.scrollWidth){var n=$(t);n.addClass(P.CONST.OVERFLOWING_TEXT_OVERFLOWING_CLASS)}}),this}}(),function(){goog.provide("P.style"),P.Style=function(e,t){P.Style.addStyle(e,t)},P.Style.addStyle=function(e,t){var n=e+"Styles",r=document.getElementById(n);r||(r=document.createElement("style"),r.setAttribute("type","text/css"),r.setAttribute("id",n),document.getElementsByTagName("head")[0].appendChild(r)),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}(),function(){jQuery.fn.flashScrollbar=function(){return this.each(function(e,t){var n=$(this).scrollTop();$(this).scrollTop(n+1),$(this).scrollTop(n-1)}),this}}(),function(){goog.provide("P.webPushManager");var e=P.logging.getLogger("WebPushManager");P.WebPushManager=function(){},_.extend(P.WebPushManager.prototype,{sendSubscriptionToServer:function(t){e.debug("Calling: sendSubscriptionToServer"),Cookie.set("cm_sub","allowed",8760,"/");var n=t.subscriptionId;if(!n){var r=t.endpoint.split("/");n=r[r.length-1]}var i={registration_id:n},o=P.resourceFactory.create("WebPushDeviceResource",{});return o.callGet({showError:!1}).then(function(t){var r=t.resource_response.data;if(!(n in r)){var o=P.resourceFactory.create("WebPushDeviceResource",i);return o.callCreate()}e.debug("subscription id already exists")})},subscribe:function(){return navigator.serviceWorker.ready.then(function(t){t.pushManager.subscribe({userVisibleOnly:!0}).then(function(e){return this.sendSubscriptionToServer(e)}.bind(this),function(t){"denied"===Notification.permission?(Cookie.set("cm_sub","denied",8760,"/"),e.debug("subscribe: Notification.permission === denied")):e.debug("subscribe: exception")})}.bind(this))},initializeState:function(){if(!P.currentUser.isAuthenticated())return e.debug("User not authenticated"),void Cookie.set("cm_sub","denied",8760,"/");if(!("showNotification"in ServiceWorkerRegistration.prototype))return e.debug("Service doesn't support notification"),void Cookie.set("cm_sub","denied",8760,"/");if("denied"===Notification.permission)return e.debug("User denied notification from Pinterest"),void Cookie.set("cm_sub","denied",8760,"/");if(!("PushManager"in window))return e.debug("Push messaging is not supported"),void Cookie.set("cm_sub","denied",8760,"/");var t=P.resourceFactory.create("UserSettingsResource",{});return t.callGet({showError:!1}).then(function(e){var t=e.resource_response.data;if(t.web_push_notification)return navigator.serviceWorker.ready;throw Cookie.set("cm_sub","denied",8760,"/"),new Error}).then(function(e){return e.pushManager.getSubscription()}).then(function(e){if(!P.experiments.instance.inExperimentGroups("web_push_notification_hold_out",["enabled","employees"]))throw new Error;if(e)return this.sendSubscriptionToServer(e);throw Cookie.set("cm_sub","none",8760,"/"),new Error}.bind(this),function(t){e.debug("initialiseState: exception: ",t)})}}),P.WebPushManager.instance=function(){return P.WebPushManager._instance||(P.WebPushManager._instance=new P.WebPushManager),P.WebPushManager._instance},window.addEventListener("load",function(){"serviceWorker"in navigator&&window.location.hostname===P.CONST.CANONICAL_MAIN_DOMAIN?navigator.serviceWorker.register("/sw.js").then(function(){P.WebPushManager.instance().initializeState()}):e.debug("service worker is not supported")})}(),function(){goog.provide("P.pushNotifications");var e="web.com.pinterest.www";P.requestPushNotifications=function(){if(P.currentUser.isAuthenticated()&&window.safari&&window.safari.pushNotification){var t=window.safari.pushNotification.permission(e);"default"===t.permission&&window.safari.pushNotification.requestPermission("https://"+window.location.hostname+"/_/_/push",e,{},function(){})}}}(),function(){require("common/lib/external/fastclick.js"),goog.provide("P.main"),goog.require("P.adTracking"),goog.require("P.modules"),goog.require("P.start"),goog.require("P.string"),goog.require("P.clickCapturer");var e=function(t,n){_.each(t,function(t,r){t.prototype?t.prototype.className=n+r:"object"===typeof t&&e(t,n+r+".")})};Pc.IS_TEST_MODE&&$(document).ajaxSend(function(e,t,n){t.setRequestHeader("X-Pinterest-Test-Mode","1"),t.setRequestHeader("X-Pinterest-No-Experiments","1")});var t=P.DEBUG?P.logging.LOG_LEVEL.INFO:P.logging.LOG_LEVEL.WARN;P.logging.setDefaultLogLevel(t),P.start.ready(function(t){e(P.modules,""),P.CONST.CANONICAL_MAIN_DOMAIN=t.canonicalMainDomain,P.string.initializeCommonStrings(),t.resourceDataCache.forEach(function(e){var t=P.resourceFactory.createFromPlainObject(e.resource);P.resourceCache.instance.ensureModel(t,e.data)});var n=t.tree,r=P.ModuleTree.fromPlainObject(n);P.clickCapturer.stopCapturing(),P.moduleFactory.create(r).then(function(e){P.app=e}).then(P.clickCapturer.replayEvents),P.AdTracking.trackConversions(),t.canDebug&&$(document).on("keypress",function(e){var t=P.getWindowManager();t&&"|"===String.fromCharCode(e.which)&&t.open("/_/_/debug/","debug",800,800)})}),$(document).ready(function(){FastClick.attach(document.body)})}();