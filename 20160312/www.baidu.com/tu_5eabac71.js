(function(){var i={};if(location.protocol==="http:"){i.uploadServer="http://graph.baidu.com/upload"}else{i.uploadServer="https://sp0.baidu.com/-aYHfD0a2gU2pMbgoY3K/upload"}var m=function(p){p.stopPropagation();p.preventDefault()};var b=location.href.match(/sign=(\w{32})\b/);var e=b&&b[1]||"";var c=function(p){p.sign=e;p.fm="inlo";window.c(p)};var g=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];var j=g[0]&&g[0].v===1&&g[1]&&g[1].v<=3;var d=g[0]&&g[0].v===1;var h=function(p){return(/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/).test(p)
};var n=1024*1024*10;var a=1024*100;var k={"1":"æ±æ­ï¼æ¨ä¸ä¼ çæä»¶ä¸æ¯å¾çæ ¼å¼","2":"å¾çä¸ä¼ å¤±è´¥"};var o=function(s){var u=$.Deferred();function q(w,x){var v=new FileReader();v.onload=function(){var y=this.result.split("base64,")[1];x(y,this.result)};v.onerror=function(y){x()};v.readAsDataURL(w)}function t(F,w,x){w=w||"";x=x||512;var B=atob(F);var D=[];var A=B.length;for(var y=0;y<A;y+=x){var E=B.slice(y,y+x);var C=new Array(E.length);for(var z=0;z<E.length;z++){C[z]=E.charCodeAt(z)}var v=new Uint8Array(C);D.push(v)}return new Blob(D,{type:w})}function p(x){var A=x.width;var v=x.height;if(A>800||v>800){var z=Math.max(A/800,v/800);A/=z;v/=z}var y=document.createElement("canvas");y.width=A;y.height=v;var w=y.getContext("2d");w.fillRect(0,0,y.width,y.height);w.drawImage(x,0,0,A,v);var B=y.toDataURL("image/jpeg",1);return t(B.replace(/^.*?,/,""),"image/jpeg")}var r=s.size;q(s,function(v,x){var w=new Image();w.onload=function(){if(r<a&&w.width<800&&w.height<800){u.resolve(s);return}s=p(w);u.resolve(s)};w.src=x});
return u.promise()};var f=function(p){$.extend(this,{wrap:null},p);this.state="normal"};$.extend(f.prototype,{init:function(){},clean:function(){this.wrap.find(".soutu-mask").remove()},setNormal:function(){this.clean();var p=this.wrap.find(".upload-pic");p.val("");this.state="normal"},setWaiting:function(){this.clean();this.state="waiting";var q='<div class="soutu-waiting"><div class="ball"><div class="b"></div><div class="b"></div><div class="b"></div></div><span>æ­£å¨å è½½å¾ç</span></div>';this.wrap.append(this.getHtml(q));var r=[[0,40],[20,20],[40,0]];var p=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.wrap.find(".b").each(function(t,v){var u=0;$(v).css({"background-color":p[t]});(function s(){$(v).animate({left:r[t][u%2]},{duration:800,easing:"swing",progress:function(x,w){if(w>=0.5){$(v).css({"background-color":p[(u+t)%3]})}},complete:function(){s()}});u++})()})},setError:function(q){this.clean();this.state="error";q=q||k["2"];var p='<div class="soutu-error"><i class="soutu-icon soutu-error-icon"></i><p class="soutu-error-main">'+q+'ï¼è¯·<a href="#" class="soutu-error-upload">éæ°ä¸ä¼ </a></p><p class="soutu-error-tip">ä»æ¯æ10Mä»¥ä¸JPG,JPEG,PNG,BMP,GIFæ ¼å¼å¾ç</p></div>';
this.wrap.append(this.getHtml(p))},setActiving:function(){if(this.state!=="activing"){this._setActive(1);this.state="activing"}},setActive:function(){if(this.state!=="active"){this._setActive();this.state="active"}},_setActive:function(p){this.clean();if(this.activeLayer){$(this.getHtml(this.activeLayer,"background-color:"+(p?"#ededed":"#f6f6f6")+";")).appendTo(this.wrap)}},getHtml:function(q,p){p=p||"";return'<div class="soutu-mask" style="'+p+'">'+q+"</div>"},show:function(){},hide:function(){}});var l=function(p){this.config={};$.extend(this.config,i,p);this.state="normal";this.init();this.canDrop="ondrop" in document.body;this.canAjaxForm="FormData" in window};$.extend(l.prototype,{init:function(){var p=this;$('<link rel="stylesheet" href="http://s1.bdstatic.com/r/www/cache/static/soutu/css/soutu_b8a8c9ad.css" type="text/css" data-for="result"/>').appendTo("head");this.$Btn=$('<span class="ipt_photo"></span>').prependTo($("#kw").parent()).hover(function(){p.$Btn.addClass("ipt_photo_hover")
},function(){p.$Btn.removeClass("ipt_photo_hover")}).on("click",function(r){r.stopPropagation();r.preventDefault();p.addPanel();p.$Btn.hide();p.log({rsv_soutu:"camerabtn"})});var q=navigator.platform.toUpperCase();if(q.indexOf("MAC")!==-1){this.$Btn.addClass("ipt_photo_mac")}if(bds&&bds.comm&&bds.comm.newindex){this.$Btn.parent().addClass("s_ipt_wr_newIndex")}$(window).one("index_off",function(){p.$Btn.parent().removeClass("s_ipt_wr_newIndex")});if(!j){$("#kw").on("drop.soutu",function(r){if(r.originalEvent.dataTransfer&&r.originalEvent.dataTransfer.files&&r.originalEvent.dataTransfer.files.length){m(r);p.$Btn.trigger("click");p.handleDrop(r);p.log({rsv_soutu:"iptdrop"})}}).on("dragover.soutu",function(r){return !d});$(document).on("dragstart.soutu",function(w){var r=w.originalEvent.dataTransfer;var v=w.target||w.srcElement;var x=v.nodeName.toLowerCase();var t;if(x==="img"){p.$Btn.trigger("click");t=v.src;try{r.setData("text/plain",t)}catch(u){r.setData("Text",t)}}else{if(x==="a"){var s=$(v).children("img");
if(s.length){p.$Btn.trigger("click");t=s[0].src;try{r.setData("text/plain",t)}catch(u){r.setData("Text",t)}}}}})}},hidePanel:function(){this.$wrap.hide();this.wrapHidden=true},show:function(){if(window.pageState===1&&!this.$wrap.hasClass("result")){this.$wrap.addClass("result")}if(bds&&bds.comm&&bds.comm.newindex){this.$wrap.addClass("new");if(!window.s_session||!!s_session.userSkinName===false){this.$wrap.addClass("no-skin")}}this.$wrap.show()},close:function(){this.$wrap.hide();this.$Btn.show();this.setState("normal");this.$urlErrorTip.hide();this.$kw.val("")},addPanel:function(){var p=this;this.wrapHidden=false;if(this.$wrap){this.show();return}this.$wrap=$('<div class="soutu-wrap"><div class="soutu-fake"><span class="soutu-fake-wrap"><input id="soutu-fake-kw" class="soutu-s-ipt" maxlength="255" autocomplete="off" placeholder="å¨æ­¤å¤ç²è´´å¾çç½å"/></span><span class="soutu-fake-btn"><i class="soutu-icon soutu-fake-btn-icon"></i></span><span class="soutu-url-error">è¯·è¾å¥æ­£ç¡®çå¾çç½å</span></div><div class="soutu-hr"><div class="soutu-drop" style="display:none;"><span class="soutu-drop-tip">ææ½å¾çå°è¿é</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" class="upload-pic" value="ä¸ä¼ å¾ç"/><i class="soutu-icon upload-icon"></i><span class="upload-text">æ¬å°ä¸ä¼ å¾ç</span></div></div><a class="soutu-icon soutu-close" href="javascript:void(0);"></a></div>').prependTo($("#form"));
this.$kw=this.$wrap.find("#soutu-fake-kw").on("focus",function(){p.$wrap.find(".soutu-fake-wrap").addClass("focus")}).on("blur",function(){p.$wrap.find(".soutu-fake-wrap").removeClass("focus")});this.$dropArea=this.$wrap.find(".soutu-drop");this.$kw.on("keydown",function(r){var q=r.keyCode;if(p.$urlErrorTip.css("display")!=="none"){p.$urlErrorTip.hide()}if(q===13){p.submit(this.value);r.stopPropagation();r.preventDefault();return false}});this.$urlErrorTip=this.$wrap.find(".soutu-url-error");this.$wrap.find(".soutu-fake-btn").on("click",function(){var q=p.$kw.val();p.submit(q);p.log({rsv_soutu:"fakebtn"})});this.$wrap.find(".soutu-fake-btn").on("mouseover",function(){$(this).addClass("btnhover")}).on("mouseout",function(){$(this).removeClass("btnhover")});if(!this.canAjaxForm){this.hackFlash()}this.$wrap.find(".soutu-close").on("click",function(){p.close(true)});$(document).click(function(q){p.document_click(q)});this.$wrap.find(".upload-pic").on("change",function(){var q=this.files[0];
p.upload(q);p.log({rsv_soutu:"uploadbtn"})});if(this.canDrop&&!j){this.setDragAndDrop()}this.masks=[new f({wrap:this.$wrap})];this.show();$(window).one("index_off",function(){p.$wrap.removeClass("new");p.$wrap.removeClass("no-skin")})},setState:function(s){this.state=s;var p=this.masks[0];s=s.charAt(0).toUpperCase()+s.substring(1);var q=[].slice.call(arguments);[].shift.call(q);if(s==="Activing"){this.$dropArea.addClass("drag-over")}else{this.$dropArea.removeClass("drag-over")}p["set"+s].apply(p,q);if(s==="Error"){var r=this;this.$wrap.find(".soutu-error-upload").click(function(t){t.stopPropagation();t.preventDefault();r.setState("normal")})}},document_click:function(s){var r=this;var q=s.target;var p=true;do{if(q===r.$wrap[0]||q===r.$Btn[0]){p=false;break}}while(q=q.parentNode);if(p){r.close()}},doAjax:function(q){var p=this;if(this.state!=="waiting"){this.setState("waiting")}$.ajax({url:p.config.uploadServer,type:"POST",data:q,processData:false,contentType:false,success:function(r){p.uploadComplete(r)
},error:function(){p.setState("error")},always:function(){}})},uploadUrl:function(p){var q=new FormData();q.append("image",p);this.doAjax(q);this.log({rsv_soutu:"uploadurl"})},upload:function(p){var r=this;var q=this.validate(p);if(q){this.setState("error",k[q]);return}this.setState("waiting");o(p).then(function(s){var t=new FormData();t.append("image",s);r.doAjax(t);r.log({rsv_soutu:"uploadfile"})})},uploadComplete:function(p){if(p&&p.command&&p.command.mode===2&&p.data){setTimeout(function(){var q="";window.location.href=q+"/imgsearch?wd="+encodeURIComponent(p.data.wd)+"&sign="+encodeURIComponent(p.data.sign)},p.command.interval||3000)}else{this.setState("error")}},submit:function(p){this.setURL(p)},validate:function(q){var s=["jpg","jpeg","png","bmp","gif"];var p=q.name.split(".");var r=p.pop().toLowerCase();if(!q.type||!r||$.inArray(r,s)===-1){return 1}if(q.size>n){return 2}return 0},setURL:function(p){if(h(p)){this.$kw.val(p);this.setState("normal");this.$urlErrorTip.hide();this.uploadUrl(p)
}else{this.setState("normal");this.$urlErrorTip.show()}},handleDrop:function(u){var t=this;var p;if(u.originalEvent.dataTransfer){p=u.originalEvent.dataTransfer.files}if(!p||p.length===0){var q;try{q=u.originalEvent.dataTransfer.getData("text/plain")||u.originalEvent.dataTransfer.getData("text/uri-list")}catch(s){q=u.originalEvent.dataTransfer.getData("Text")||u.originalEvent.dataTransfer.getData("URL")}if(q){t.setURL(q)}else{t.setState("normal");t.$urlErrorTip.show()}return}var r=p[0];t.upload(r)},setDragAndDrop:function(){var p=this;this.$dropArea.show();p.$dropArea.on("dragover",function(q){p.setState("activing");m(q)}).on("dragleave",function(q){p.setState("normal");m(q)}).on("drop",function(q){m(q);p.handleDrop(q)});this.$kw.on("dragover.soutu dragleave.soutu",function(q){m(q)}).on("drop.soutu",function(q){m(q);p.handleDrop(q)})},hackFlash:function(){var x=this;var p="11.1.0";var u="playerProductInstall.swf";var r={};var s={};var v="http://s1.bdstatic.com/r/www/cache/static/soutu/js/upload_ef39d94f.swf";
s.quality="high";s.bgcolor="#ffffff";s.allowscriptaccess="always";s.allowfullscreen="false";s.wmode="transparent";r.uploadServer=this.config.uploadServer;var t={};t.id="upload_flash";t.name="upload_flash";t.align="middle";var q=null;var w=$.Deferred();this.$wrap.find(".upload-pic").parent().append('<div class="flash-wrap" style="position:absolute;"><div id="upload_flashContent"></div></div>').end().remove();swfobject.embedSWF(v,"upload_flashContent","100","23",p,u,r,s,t,function(y){q=y.ref});l.swfloaded=function(){w.resolve()};l.uploading=function(){x.setState("waiting")};l.complete=function(y){x.uploadComplete(y)};w.done(function(){})},log:c});if(typeof define==="function"){define("soutu.index",[],function(){window.__soutu=l;return new l()})}})();