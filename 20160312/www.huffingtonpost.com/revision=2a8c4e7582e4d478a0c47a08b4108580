!function(t){function a(a){try{i=t.piximedia.SweetLib,i.print("Decoratr v1",a),this.data=a.data,this.meta=a.meta||{},this.main=this.data.standard||this.data.footer||this.data.interstitial||this.data.companion||this.data.takeover||this.data.pushdown||this.data.pushdown_v2||this.data.allpapr||!1,this.extra=this.main.video||this.data.pushdown_expand_v2||this.data.standard_expand||this.data.allpapr_header||!1,(this.data.pushdown_v2||this.data.pushdown)&&(this.extra.top=this.data.pushdown&&this.data.pushdown.stickToTop||this.data.stickToTop||this.main.height),this.enhance(this.main),this.enhance(this.extra),this.data.expand={width:this.getHighestValue("width"),height:this.getHighestValue("height")},this.main.expand&&(this.main.expand.right&&(this.data.expand.right=this.main.expand.right),this.main.expand.top&&(this.data.expand.top=this.main.expand.top)),this.data.width=this.main.width,this.data.height=this.main.height,this.data.expand.width===this.data.width&&this.data.expand.height===this.data.height?this.isExpandingUnit=!1:(this.isExpandingUnit=!0,this.main.clicktag?this.rollExpand=!1:(this.rollExpand=this.extra&&this.extra.openmode?"hover"===this.extra.openmode:this.main.expand&&this.main.expand.openmode?"hover"===this.main.openmode:!0,this.clickExpand=this.rollExpand?!1:this.extra&&this.extra.openmode?"click"===this.extra.openmode:this.main.expand&&this.main.expand.openmode?"click"===this.main.openmode:!1),this.data.transparent=!0),this.extra.file||this.extra.files||(this.extra=!1),this.objects={},this.extra&&(this.extra.center&&(this.extra.left=(this.main.width-this.extra.width)/2+"px"),this.extra.reloadOnExpand&&(this.extra.waitExpandToDecorate=!0))}catch(e){i.warn(e)}}var i,e=800;a.prototype.onerror=function(t){window.console.warn(t)},a.prototype.enhance=function(a){if(a){if(a.handleVideo=!0,a.uniqueTracking=!0,a.framedAd=this.data.framedAd,"object"!=typeof a.file||i.isArray(a.file))"string"==typeof a.options?a.options=t.JSON.parse(a.options):a.options={};else{var e,s,n=this;if(a.file.id?"number"==typeof a.file.id?e=".asset_id="+a.file.id:(s=[],i.each(a.file.id,function(){s.push(".asset_id="+this)})):e=a.file,s){var r;i.each(s,function(t){var a=n.data.framedAd.queryAssets(s[t]);r||(r=a,r[0].value=[]),r[0].value.push(a[0].uri)}),a.file=r}else if(e&&(a.file=this.data.framedAd.queryAssets(e),!a.file.length&&e.mandatory))return void this.track("PANIC",{error:"NO_MATCHING_ASSETS"});"vast"===a.file[0].type?this.parseVastData(a):(a.metadata=a.file[0].metadataObject||("string"==typeof a.file[0].metadata?t.JSON.parse(a.file[0].metadata):a.file[0].metadata),a.options=a.file[0].optionsObject||(a.file[0].options?"string"==typeof a.file[0].options?t.JSON.parse(a.file[0].options):a.file[0].options:{}),a.file=("string"==typeof a.file[0].value&&a.file[0].value?a.file[0].value:!1)||a.file[0].uri)}"image"===i.getFileType(a.file)||"html"===i.getFileType(a.file)?(a.options.piximedia_listen_for_click||a.clicktag?a.clicktag=!0:a.needClickTag=!0,a.options.transparent&&(this.data.transparent=!0)):"video"===i.getFileType(a.file)&&(this.expectVideoSent||(this.track("EXPECT:VIDEO",a.metadata?{duration:parseInt(a.metadata.duration,10)}:{}),this.expectVideoSent=!0)),"undefined"==typeof a.right&&"undefined"==typeof a.left&&(this.meta.rightExpand?a.left=0:a.right=0),"undefined"==typeof a.top&&"undefined"==typeof a.bottom&&(a.top=0)}},a.prototype.getHighestValue=function(t){var a=[],i="width"===t?this.meta.rightExpand?"left":"right":"top";return this.extra&&(this.extra.expand&&this.extra.expand[t]?a.push(this.extra.expand[t]+(this.extra.expand[i]||this.extra[i]||0)):this.extra[t]&&(a.push(this.extra[t]+(this.extra[i]||0)),this.extra.expand||(this.extra.expand={}),this.extra.expand[t]=this.extra[t])),this.main.expand&&"undefined"!=typeof this.main.expand[t]?a.push(this.main.expand[t]):(a.push(this.main[t]),this.main.expand||(this.main.expand={}),this.main.expand[t]=this.main[t]),Math.max.apply(null,a)},a.prototype.onclick=function(t){if(t&&this.isExpandingUnit&&this.clickExpand)return void this.trigger("expand");this.track("AP_CLICK"),this.track("CLICK_OOB"),this.track("EXPECT:VISIT");var a=new i.Browser({uri:(this.data.position.clickUrl&&!this.data.trackingFixed?this.data.position.clickUrl:"")+this.data.clickUrl[1].url,newtab:!0,exposureTime:this.data.minExposureTime,position:this.data.position});a.open(),this.data.clickPixels&&(i.isArray(this.data.clickPixels)?i.each(this.data.clickPixels,function(){i.PixelPrinter(this.toString())}):i.PixelPrinter(this.data.clickPixels))},a.prototype.extendVideoOptions=function(t){var a={id:this.data.position.positionId,loop:this.meta&&this.meta.isTakeover?!1:t.loop,adId:this.data.adIdAlliance,controls:{type:"sound"}};i.extend(t,a);var e=this;t.onclick=function(){e.onclick()},t.track=function(t){e.track(t)}},a.prototype.prepareBillboard=function(){this.data.wrapper.style.opacity=1,this.data.wrapper.style.top=0,this.data.wrapper.style.left="50%",this.data.wrapper.style.marginLeft=this.data.width/-2+"px",i.getDocument(this.data.wrapper).body.style.background=this.main.bgcolor||"#000";var t=i.getDocument(this.data.wrapper).createElement("div"),a=i.getDocument(this.data.wrapper).createElement("div"),e=i.getDocument(this.data.wrapper).createElement("div"),s={expanded:i.gettext("fermer")+'<img src="http://broadcast.pm/assets/html5/xBtFermer_white.png" style="position: relative; width: 10px; top: 1px; margin-left: 9px;">',collapsed:i.gettext("ouvrir")};i.applyStyle(t,{position:"absolute",bottom:"3px",right:"5px","font-family":"Arial, sans-serif","font-weight":"bold","font-size":"12px",color:this.main.color||"#FFF",padding:"5px",cursor:"pointer"}),i.applyStyle(a,{position:"absolute",width:"100%",top:"7px",left:"0px","text-align":"center",opacity:0}),i.applyStyle(e,{"font-family":"Arial, sans-serif","font-weight":"bold","font-size":"12px",color:this.main.color||"#FFF",cursor:"pointer"}),a.appendChild(e),e.innerHTML=this.main.title;var n=this,r="expanded";t.innerHTML=s[r];var d=function(){"collapsed"===r?(r="expanded",n.trigger("expand"),t.innerHTML=s.expanded):(r="collapsed",n.trigger("close"),t.innerHTML=s.collapsed)};i.getDocument(this.data.wrapper).body.appendChild(a),i.getDocument(this.data.wrapper).body.appendChild(t),i.addEvent(t,"click",d),i.addEvent(e,"click",function(){n.onclick()}),this.rollExpand=!1,this.animate=!0,this.data.height=30,this.main.title=a},a.prototype.addClickTag=function(t,a){var e=i.getDocument(t).createElement("div"),s=this;e.className="pm-clicktag",i.addEvent(e,"click",function(){s.onclick(a)}),t.appendChild(e)},a.prototype.addCloseButton=function(t,a){if(!this.hasAlreadyAClickButton){this.hasAlreadyAClickButton=!0,this.objects.closebutton=i.getDocument(t).createElement("div"),this.objects.closebutton.className="pm-closebutton",this.objects.closebutton.innerHTML=i.gettext("fermer")+" X",a.position&&"tr"===a.position?this.objects.closebutton.style.right="0px":this.objects.closebutton.style.left="0px",a.color&&(this.objects.closebutton.style.color=a.color);var e=this;i.addEvent(this.objects.closebutton,"click",function(){e.trigger("close"),e.main.expand&&e.main.expand.closebutton&&e.main.expand.closebutton.triggerEnd&&e.objects.main.triggerEnd()}),t.appendChild(this.objects.closebutton)}},a.prototype.decorate=function(){var t=this;this.data.autoexpand&&!this.data.autoexpand.duration&&(this.extra&&"video"===i.getFileType(this.extra.file)?this.extra.videoend=function(){t.trigger("collapse")}:"video"===i.getFileType(this.main.file)&&(this.main.videoend=function(){t.trigger("collapse")})),this.extendVideoOptions(this.main),this.applyStyle(this.data.wrapper,this.main),this.main.billboard&&this.prepareBillboard();var a=i.copy(this.main);if(this.main.expand&&this.main.expand.useExpandSize&&(a.width=this.main.expand.width,a.height=this.main.expand.height,a.enforceSize=!0,this.applyStyle(this.data.wrapper,this.main.expand)),this.objects.main=i.handleAsset(a,this.data.wrapper,"","",this.data),!this.main.expand||this.main.expand.width===this.main.width&&this.main.expand.height===this.main.height||this.expand.useExpandSize||i.applyStyle(this.objects.main,{width:"100%",height:"100%"}),this.main.options.transparent&&this.objects.main.style&&(this.objects.main.style.background="transparent"),this.main.needClickTag&&this.addClickTag(this.data.wrapper,!0),this.main.expand&&this.main.expand.closebutton&&this.addCloseButton(this.data.wrapper,this.main.expand.closebutton),this.extra&&(this.extendVideoOptions(this.extra),this.data.extra_wrapper=i.getDocument(this.data.wrapper).createElement("div"),this.applyStyle(this.data.extra_wrapper,this.extra),this.data.wrapper.appendChild(this.data.extra_wrapper),this.objects.extra=i.handleAsset(this.extra,this.data.extra_wrapper,"","",this.data),this.extra.needClickTag&&this.addClickTag(this.data.extra_wrapper),this.extra.closebutton&&this.addCloseButton(this.data.extra_wrapper,this.extra.closebutton),this.extra.displayOnExpand&&(this.data.extra_wrapper.style.top="-3000px"),this.extra.options.transparent&&this.objects.extra.style&&(this.objects.extra.style.background="transparent"),"video"===i.getFileType(this.extra.file)&&this.extra.displayOnExpand&&this.objects.extra.pause()),this.track("AP_IMPRESSION"),i.bindRollTracker(this.data,this.data.wrapper),this.data.autoexpand&&(this.data.autoexpand.delay&&"video"===i.getFileType(this.main.file)?this.objects.main.addCuePoint({time:this.data.autoexpand.delay,callback:function(){t.trigger("expand")}}):setTimeout(function(){t.trigger("expand")},this.data.autoexpand.delay?1e3*this.data.autoexpand.delay:1e3),this.data.autoexpand.duration&&(this.data.autoexpand.timeout=setTimeout(function(){t.trigger("collapse")},1e3*(this.data.autoexpand.duration+1)))),this.meta.adaptive&&!i.isCrossDomained()&&this.data.iframe){var e,s=i.getOwnerFif(this.data.wrapper).parentNode.parentNode;i.onResize(s,function(){var a=Math.round(i.gbcr(s).width);a!==e&&(t.resize(a),e=a)})}},a.prototype.resize=function(t){var a=t/this.data.width;1>a?(this.data.wrapper.style.transform="scale("+a+")",this.data.wrapper.style.top=(this.data.height*a-this.data.height)/2+"px",this.data.wrapper.style.left=(this.data.width*a-this.data.width)/2+"px",this.data.iframe.emit("resize",{width:t,height:Math.round(this.data.height*a),resizeFifContainer:!0})):(this.data.wrapper.style.transform="",this.data.wrapper.style.top="0",this.data.wrapper.style.left="0",this.data.iframe.emit("resize",{width:this.data.width,height:this.data.height,resizeFifContainer:!0,css:{textAlign:"center"}}))},a.prototype.on=function(t,a){this.events||(this.events={}),this.events[t]||(this.events[t]=[]),this.events[t].push(a)},a.prototype.trigger=function(t){var a=this;this.events&&this.events[t]&&i.each(this.events[t],function(){this.call(a)})},a.prototype.track=function(t,a){"PANIC"===t&&window.console&&window.console.warn("PANIC",a),this.data.position.loadEvent(t,a)},a.prototype.applyStyle=function(t,a){var e=function(t){return"undefined"==typeof t?"auto":"number"==typeof t?t+"px":parseFloat(t,10).toString()===t?t+"px":t};i.applyStyle(t,{position:"absolute",width:e(a.width),height:e(a.height),top:e(a.top),right:e(a.right),bottom:e(a.bottom),left:e(a.left)})},a.prototype.expand=function(){this.main.billboard&&(this.main.title.style.opacity="0",i.animate(this.data.wrapper,{opacity:1,top:0}).play());var t={width:this.main.expand.width+"px",height:this.main.expand.height+"px",duration:this.main.clicktag||this.main.expand&&this.main.expand.noAnimation?0:500};if(this.main.expand&&this.main.expand.useExpandSize&&(t.top="0px",t.right="0px"),i.animate(this.data.wrapper,t).play(),this.extra){var a={width:this.extra.expand.width+"px",height:this.extra.expand.height+"px"};this.extra.displayOnExpand&&(this.data.extra_wrapper.style.top=this.extra.top+"px",a.opacity=1),i.animate(this.data.extra_wrapper,a).play(),(this.extra.waitExpandToDecorate||this.extra.reloadOnExpand)&&(this.extra.waitExpandToDecorate=!1,this.objects.extra.getAttribute("src")||(this.objects.extra.src=this.objects.extra.getAttribute("data-src"))),"video"===i.getFileType(this.extra.file)&&this.extra.displayOnExpand&&this.objects.extra.play()}this.main.video&&(this.main.restart_on_expand&&this.main.play(.1),this.main.pause_on_expand&&this.main.pause(),this.main.unmute())},a.prototype.collapse=function(t){var a=this;this.main.billboard&&(this.main.title.style.opacity="1",i.animate(this.data.wrapper,{opacity:0,top:30}).play());var e={width:this.main.expand&&this.main.expand.useExpandSize?this.main.expand.width+"px":this.main.width+"px",height:this.main.expand&&this.main.expand.useExpandSize?this.main.expand.height+"px":this.main.height+"px",duration:this.main.clicktag||this.main.expand&&this.main.expand.noAnimation?0:500,onplayed:function(){a.extra||"function"!=typeof t||t()}};if(this.main.expand&&this.main.expand.useExpandSize&&(e.top=this.main.expand.top+"px",e.right=this.main.expand.right+"px"),i.animate(this.data.wrapper,e).play(),this.extra){var s={width:this.extra.width+"px",height:this.extra.height+"px"};this.extra.displayOnExpand&&(s.opacity=0),s.oncompleted=function(){(a.extra.reloadOnExpand||a.data.autoexpand)&&(a.objects.extra.getAttribute("data-src")||a.objects.extra.setAttribute("data-src",a.objects.extra.src),a.objects.extra.src="",a.data.autoexpand&&(a.data.autoexpand=!1,setTimeout(function(){a.objects.extra.src=a.objects.extra.getAttribute("data-src")},0))),a.extra.displayOnExpand&&(a.data.extra_wrapper.style.top="-3000px"),"function"==typeof t&&t(),"video"===i.getFileType(a.extra.file)&&a.extra.displayOnExpand&&(a.extra.restartOnExpand?(a.objects.extra.seek(.1),a.objects.extra.pause()):a.objects.extra.pause())},i.animate(this.data.extra_wrapper,s).play()}},a.prototype.parseVastData=function(a){var s=a.file;if(!s[0].metadata.vast.Ad)return this.onerror("vast not parsed");var n=s[0].metadata.vast.Ad[0].InLine[0].Creatives[0].Creative[0].Linear[0].MediaFiles[0].MediaFile,r=s[0].metadata.vast.Ad[0].InLine[0].Creatives[0].Creative[0].Linear[0].TrackingEvents[0].Tracking,d=s[0].metadata.vast.Ad[0].InLine[0].Creatives[0].Creative[0].Linear[0].VideoClicks[0].ClickThrough[0].value;this.data.clickUrl[1].url=d;var h={},o=[];if(i.each(n,function(){var t=this.type.split("/")[1];if(-1!==i.allowedHTML5VideoFormat.indexOf(t)||-1!==i.allowedFlashVideoFormat.indexOf(t)){var a=!0;h[t]&&(a=Math.abs(parseFloat(this.bitrate,10)-e)<h[t].delta?!0:!1),a&&(h[t]={uri:this.value,delta:Math.abs(parseFloat(this.bitrate,10)-e)})}}),t.piximedia.vastTrackings||(t.piximedia.vastTrackings={}),a.asset_id=s[0].id||s[0].asset_id,!t.piximedia.vastTrackings[a.asset_id]){t.piximedia.vastTrackings[a.asset_id]={};var p=function(t){var a=["LECTUREDEBUT","LECTURE25","LECTURE50","LECTURE75","LECTURE100"],i=["start","firstQuartile","midpoint","thirdQuartile","complete"];return a[i.indexOf(t)]};i.each(r,function(){var i=p(this.event);i&&(t.piximedia.vastTrackings[a.asset_id][i]||(t.piximedia.vastTrackings[a.asset_id][i]=[]),t.piximedia.vastTrackings[a.asset_id][i].push(this.value))})}i.each(h,function(){o.push(this.uri)}),a.file=o},t.piximedia.Decoratr=a,t.piximedia.libraryLoader&&t.piximedia.libraryLoader["decoratr.js"]&&(t.piximedia.libraryLoader["decoratr.js"].complete=!0)}(window),function(){var t=window,a="decoratr.js";t.piximedia.libraryLoader=t.piximedia.libraryLoader||{};var i=t.piximedia.libraryLoader[a];if(i&&(i.complete=!0,i.onloads))for(var e=0;e<i.onloads.length;e++)i.onloads[e]()}();