STK.namespace("v6page",function(a,b){var STK=arguments[0],$=arguments[1];
STK.register("lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("lib.feed.imageLikeWhiteList",function(a){return function(){return!0}});
STK.register("lib.feed.feedTemps",function(a){var b=a.lib.kit.extra.language,c=$CONFIG.imgPath+"/style/images/common/loading.gif",d=a.lib.feed.imageLikeWhiteList();return{loadingIMG:b('<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>#L{æ­£å¨å è½½ï¼è¯·ç¨å}...</p> </div> </div> </div>'),newFeedTipHTML:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{æ} [n] #L{æ¡æ°å¾®å}ï¼#L{ç¹å»æ¥ç}</a>'),activityNewFeedTipHTML:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{æ} [n] #L{æ¡æ°å¨æ}ï¼#L{ç¹å»æ¥ç}</a>'),newCloseFriendFeed:b('<a node-type="feed_list_newBar" action-type="feed_list_newBar" class="notes" href="javascript:void(0);">#L{ææ°å¯åå¾®å}ï¼#L{ç¹å»æ¥ç}</a>'),loadingHTML:b('<div requestType="[n]"><i class="W_loading"></i> <span>#L{æ­£å¨å è½½ï¼è¯·ç¨å}...</span></div>'),loadErrorRetryHTML:b('<div class="zero_tips S_txt2"><span>#L{å è½½å¤±è´¥}ï¼<a action-type="feed_list_retry" requestType="[n]" href="javascript:void(0)">#L{è¯·éè¯}</a></span></div>'),loadErrorEndHTML:b('<div class="zero_tips S_txt2" requestType="[n]"><span>#L{å è½½å¤±è´¥}ã</span></div>'),mediaIMGTEMP:b('<#et temp data><p class="medis_func S_txt3"><a action-type="feed_list_media_toSmall"  href="javascript:void(0);" class="retract" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if>><em class="W_ico12 ico_retract"></em>#L{æ¶èµ·}</a><i class="W_vline">|</i><a href="javascript:void(0);" action-type="widget_photoview" action-data="${data.acdata}" target="_blank" class="show_big" <#if (data.suda && data.suda.showBig)>suda-data="${data.suda.showBig}"</#if>><em class="W_ico12 ico_showbig"></em>#L{æ¥çå¤§å¾}</a><i class="W_vline">|</i><a action-type="feed_list_media_toLeft" href="javascript:void(0);" class="turn_left" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><em class="W_ico12 ico_turnleft"></em>#L{åå·¦æè½¬}</a><i class="W_vline">|</i><a action-type="feed_list_media_toRight" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if> href="javascript:void(0);" class="turn_right"><em class="W_ico12 ico_turnright"></em>#L{åå³æè½¬}</a></p><div class="smallcursor"  action-type="feed_list_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>><img dynamic-id="${data.uniqueId}"   action-type="feed_list_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}"/></div></#et>'),mediaIMGTEMPwithBtn:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{æ¶èµ·}</a></span></li><li><span class="line S_line1"><a action-type="widget_photoview" action-data="${data.acdata}" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_search S_ficon">f</i>#L{æ¥çå¤§å¾}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toLeft" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{åå·¦æè½¬}</a></span></li><li><span class="line S_line1"><a action-type="feed_list_media_toRight" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{åå³æè½¬}</a></span></li></ul></div></div><div action-type="feed_list_media_bigimgDiv" class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor"><div class="artwork_box"><img dynamic-id="${data.uniqueId}"   action-type="feed_list_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}"/><span style="display:none;" action-type="feed_list_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><#if (data.is_liked)><a href="javascript:;" class="W_btn_alpha" title="#L{åæ¶èµ}"><i class="icon_praised"></i><span node-type="count">(${data.count})</span></a></div><#else><a href="javascript:;" class="W_btn_alpha" title="#L{èµ}"><i class="icon_praise"></i><span node-type="count">(${data.count})</span></a></#if></span></li></ul></div></div></div></#et>'),mediaVideoMusicTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>æ¶èµ·</a></span></li><#if (data.title)><li><span class="line S_line1"><a target="_blank" href="${data.full_url}" class="S_txt1"><em class="W_autocut"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</em></a></span></li></#if></ul></div></div><div node-type="feed_list_media_big${data.type}Div" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),mediaVideoMusicFloatTEMP:b('<#et temp data><div node-type="outer" class="W_layer" style=""><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content"><div class="title"><h3>${data.title}</h3></div><a href="javascript:void(0);" onclick="return false;" node-type="close" class="W_close"></a><div node-type="mediaContent" style="text-align:center;width:440px;"><img style="margin:10px;" class="loading_gif" src="'+c+'"/></div>'+"</div>"+"</td>"+"</tr>"+"</table>"+"</div>"+"</div>"+"</#et>"),widgetTEMP:b('<#et temp data><div class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>æ¶èµ·</a></span></li><#if (data.title && data.full_url)><li><span class="line S_line1"><a target="_blank" href="${data.full_url}" class="S_txt1"><em class="W_autocut"><i class="W_ficon ficon_arrow_bigimg S_ficon">l</i>${data.title}</a></em></span></li></#if></ul></div></div><div node-type="feed_list_media_widgetDiv" class="WB_app_view"><img class="loading_gif" src="'+c+'"/>'+"</div>"+"</div>"+"</#et>"),qingTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="feed_list_media_toSmall" class="retract"><em class="W_ico12 ico_retract"></em>#L{æ¶èµ·}</a><i class="W_vline">|</i><a <#if (data.suda)>suda-data="${data.suda}"</#if> href="${data.full_url}" title="${data.full_url}" class="show_big" target="_blank"><em class="W_ico12 ico_showbig"></em>${data.title}</a></p><div node-type="feed_list_media_qingDiv"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),commonMediaTEMP:b('<#et temp data><p class="medis_func S_txt3"><a href="javascript:void(0);" action-type="common_list_media_hide" action-data="type=${data.type}&id=${data.id}" suda-data="key=tblog_activity_click&value=fold_play" class="retract"><em class="W_ico12 ico_retract"></em>#L{æ¶èµ·}</a><i class="W_vline">|</i><a href="${data.url}"  action-type="feed_list_url" title="${data.title}" class="show_big" target="_blank" suda-data="key=tblog_activity_click&value=url_click"><em class="W_ico12 ico_showbig"></em>${data.title}</a><#if (data.tofloat)><i class="W_vline">|</i><a action-type="common_list_media_toFloat" action-data="title=${data.title}&type=${data.type}&id=${data.id}" href="javascript:void(0);" class="turn_right" suda-data="key=tblog_activity_click&value=bomb_play">#L{å¼¹åº}</a></#if></p><div node-type="common_list_media_Div" style="text-align:center;min-height:18px;"><img class="loading_gif" src="'+c+'"/></div>'+"</#et>"),translateTEMP:b('<#et temp data><div class="W_layer W_layer_pop" node-type="feed_translate" style="margin-left:-17px;"><div class="content"><div class="W_layer_close"><a href="javascript:void(0)" suda-data="key=tblog_bowen_translate&value=close_button" action-type="feed_translate_close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_translation"><div class="tit W_f14 S_txt2">#L{ç¿»è¯ç»æ}:</div><div class="con" node-type="translate_rs">${data.text}</div><div class="link clearfix S_txt2"><span class="W_fr"><a href="javascript:void(0);" suda-data="key=tblog_bowen_translate&value=click_i_translate" action-type="feed_translate_by_me" action-data="${data.bymedata}">#L{ææ¥ç¿»è¯}</a></span>#L{ç¿»è¯ç»æç±}<a href="http://weibo.com/youdaocidian" target="_blank" suda-data="key=tblog_bowen_translate&value=click_youdao_link" title="#L{æéè¯å¸}">#L{æéè¯å¸}</a>#L{æä¾}ï¼#L{ä»ä¾åè}ã</div></div></div></div></#et>')}});
STK.register("lib.kit.dom.firstChild",function(a){var b=a.core.dom.next;return function(a){var c=a.firstChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.lastChild",function(a){var b=a.core.dom.prev;return function(a){var c=a.lastChild;c&&c.nodeType!=1&&(c=b(c));return c}});
STK.register("lib.kit.dom.parentAttr",function(a){return function(a,b,c){var d;if(a&&b){c=c||document.body;while(a&&a!=c&&!(d=a.getAttribute(b)))a=a.parentNode}return d}});
STK.register("lib.kit.extra.parseURL",function(a){return function(){return STK.historyM&&STK.historyM.parseURL?STK.historyM.parseURL():a.core.str.parseURL(location.href)}});
STK.register("lib.feed.API",function(a){var b=a.lib.feed.feedTemps,c=a.lib.kit.dom.firstChild,d=a.lib.kit.dom.lastChild,e=a.core.dom.insertElement,f=a.lib.kit.extra.language,g={getMid:function(a,b){var c=g.getFeedNode(a,b);return c?c.getAttribute("mid"):null},getFeedNode:function(b,c){return a.core.dom.dir(b,{expr:"[action-type=feed_list_item]",endpoint:c||document.body})[0]},getFeeds:function(b,c){return a.sizzle("["+c+"]",b)},preventDefault:function(b){a.preventDefault();return!1}},h=function(b){a.custEvent.fire(b,"clearTips","base")},i=function(d,e){var f;switch(d){case"waiting":f=b.loadingHTML;break;case"retry":f=b.loadErrorRetryHTML;break;case"end":f=b.loadErrorEndHTML}return c(a.builder(f.replace("[n]",e)).box)};return function(b,j){a.isNode(b)||a.log("baseFeedList : parameter node is not a document node!");b.getAttribute("node-type")!="feed_list"&&(b=a.sizzle('div[node-type="feed_list"]',b)[0]);j=a.parseParam({end_id:""},j);var k={},l=new Date,m=a.core.evt.delegatedEvent(b),n,o,p=0,q=1,r=!1,s={},t=j.end_id;m.add("feed_list_retry","click",function(c){h(b);var d=c.el.getAttribute("requestType"),e=s[d].location;e=="top"?v("waiting",d):w("waiting",d);a.custEvent.fire(y,"request",[d,s[d].data]);return g.preventDefault(c.evt)});var u=function(){if(q<2){var a=y.getFirstFeed();a&&(t=a.getAttribute("mid"))}},v=function(a,c){r=!0;y.removeTopNode();e(b,n=i(a,c),"afterbegin")},w=function(a,c){y.removeBottomNode();b.appendChild(o=i(a,c))},x=!0,y={extra:{},extraData:{},getNode:function(){return b},getNewBar:function(){return a.sizzle('[node-type="feed_list_newBar"]',b)},removeNewBar:function(){var b=y.getNewBar();b&&b.length>0&&a.core.dom.removeNode(b[0])},clearNewBar:function(){var b=y.getNewBar();if(b&&b.length>0)for(var c in b)a.core.dom.removeNode(b[c]);n=null},getRecommend:function(){return a.sizzle('[node-type="feed_list_recommend"]',b)},removeRecommend:function(){var b=y.getRecommend();if(b&&b.length>0)for(var c in b)a.core.dom.removeNode(b[c])},getNodeList:function(){var c=a.sizzle('div[action-type="feed_list_item"]',b);return c.length?c:!1},getDEvent:function(){return m},removeTopNode:function(){a.removeNode(n);n=null},setTopNode:function(a){n=a},removeBottomNode:function(){a.removeNode(o);o=null},setBottomNode:function(a){o=a},getEndId:function(){return t},isTopWaiting:function(){return r},getCurrentPage:function(){var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query);q=c.page||1;return q},setCurrentPage:function(a){q=a},getFeedCount:function(){return g.getFeeds(b,'action-type="feed_list_item"').length},setRequestAction:function(b,c){k[b]=a.parseParam({top:!1,center:!1,bottom:!1},c)},setRequestData:function(a,b){s[a]={data:b,time:0}},getExtraData:function(a){return y.extraData[a]},setExtraData:function(a,b){y.extraData[a]=b},setExtraFunction:function(a,b){y.extra[a]=b},regCustEvent:function(b,c){a.custEvent.define(y,b);a.custEvent.add(y,b,c)},isFeed:function(a){return a.getAttribute("mid")&&!a.getAttribute("feedtype")?!0:!1},getFirstFeed:function(){var d=c(b);while(d&&!y.isFeed(d))d=a.core.dom.next(d);return d},getLastFeed:function(){var c=d(b);while(!y.isFeed(c))c=a.core.dom.prev(c);return c},getFirstFeedId:function(){var b=y.getFirstFeed();if(b){for(var c=0;c<p&&b;c++)b=a.core.dom.next(b);if(b)return b.getAttribute("mid")}},getLastFeedId:function(){var c=a.sizzle('[node-type="feed_list_shieldKeyword"]',b)[0],e=c?c:d(b),f=o?a.core.dom.prev(o):a.core.dom.prev(e);if(f)return f.getAttribute("mid")},getFirstFeedAttr:function(b){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])"),d=c[0];return d?d.getAttribute(b):""},getLastFeedAttr:function(b){var c=a.sizzle("[action-type=feed_list_item]:not([feedtype])"),d=c[c.length-1];return d?d.getAttribute(b):""},showZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="")},hideZeroTip:function(){var c=a.sizzle('div[node-type="feed_list_zero"]',b)[0];c&&(c.style.display="none")},insertFakeFeed:function(c){setTimeout(function(){if(typeof c!="string")a.log("insertFakeFeed feedHtml is not String!");else{y.hideZeroTip();p++;var d=a.C("div");d.innerHTML=c;var e=a.sizzle('div[action-type="feed_list_item"]',d);e=e[0];n?a.core.dom.insertBefore(e,n):a.core.dom.insertElement(b,e,"afterbegin");var f=a.sizzle('[node-type="empty_module"]',b);f&&f[0]&&(f[0].style.display="none");setTimeout(function(){try{if(a.IE){var b=a.sizzle(".WB_frame_b")[0];b.style.visibility?b.style.visibility="":b.style.visibility="inherit"}}catch(c){}})}},200)},updateFeed:function(d,e,f){if(d&&e){y.hideZeroTip();if(e=="top"){r=!1;y.removeTopNode();for(var g=0;g<p;g++)a.removeNode(c(b));p=0;a.insertHTML(b,d,"afterbegin");u()}else if(e=="bottom"){y.removeBottomNode();a.insertHTML(b,d);u()}a.custEvent.fire(y,"updateFeed",[f,d]);setTimeout(function(){try{if(a.IE){var b=a.sizzle(".WB_frame_b")[0];b&&(b.style.visibility?b.style.visibility="":b.style.visibility="inherit")}}catch(c){}})}},showWait:function(c,d,e){c=="top"?v("waiting",d):c=="bottom"&&w("waiting",d);if(c=="center"){n&&a.core.util.hideContainer.appendChild(n);o&&a.core.util.hideContainer.appendChild(o);b.innerHTML="";n&&b.appendChild(n);o&&b.appendChild(o)}s[d]={data:e,time:0,location:c}},showError:function(b,c){if(b&&k[b]){var d=s[b],e;if(d.time>=3){d.time=0;e="end"}else{d.time++;e="retry"}b=="top"?v(e,c):b=="bottom"&&w(e,c);a.custEvent.fire(y,"showError",c)}},resetStartTime:function(){var a=l;l=new Date;return l-a},clearAllTimeTip:function(){var c=a.sizzle('[node-type="feed_list_timeTip"]',b),d=c.length,e=null,f=null;for(var g=d-1;g>=0;g--){e=c[g];f=a.core.dom.prev(e);f&&a.removeClassName(f,"WB_feed_new");e&&a.removeNode(e)}},updateTimeTip:function(c){var d=Math.ceil(y.resetStartTime()/6e4),e=f("[n]#L{ä½ çå°è¿é}"),g=f("#L{ä¹å}");if(d>=60&&d<1440){var h=parseInt(d/60,10),i=d-h*60;g=h+f("#L{å°æ¶}")+(i>0?i+f("#L{åéåï¼}"):f("#L{åï¼}"))}else d<60&&(g=d+f("#L{åéåï¼}"));e=e.replace("[n]",g);var j=a.sizzle('[node-type="feed_list_timeText"]',b);j.length>0&&(j[0].innerHTML=c||e)},getLoadingData:function(){var b=a.sizzle('[node-type="lazyload"]',b)[0];return b?a.queryToJson(b.getAttribute("action-data")||"")||{}:{}},utils:g},z=function(){var b=y.getFirstFeed();!t&&q<2&&b&&(t=b.getAttribute("mid"));a.custEvent.define(y,["request","updateFeed","clearTips","updateEndId","showError","inView","smartSort","showRecommendTip","stopRecommendTip"]);a.custEvent.add(y,"updateEndId",u)};z();y.destroy=function(){m.destroy();a.custEvent.undefine(y)};return y}});
STK.register("lib.dialog.loginLayer",function(a){var b,c="http://tjs.sjs.sinajs.cn/t5/register/js/page/remote/loginLayer.js";return function(d){d=a.core.obj.parseParam({lang:"zh-cn",loginSuccessUrl:encodeURIComponent(window.location.href)},d||{});if(window.WBtopGlobal_loginLayer)WBtopGlobal_loginLayer(d);else{if(b)return;b=!0;a.core.io.scriptLoader({url:c,onComplete:function(){b=!1;window.WBtopGlobal_loginLayer(d)},timeout:1e4,onTimeout:function(){b=!1}})}}});
STK.register("lib.kit.io.cssLoader",function(a){var b="",c="http://img.t.sinajs.cn/t4/",d="http://timg.sjs.sinajs.cn/t4/";if(typeof $CONFIG!="undefined"){c=$CONFIG.cssPath||c;b=$CONFIG.version||""}var e={};return function(f,g,h,i,j){i=i||b;h=h||function(){};var k=function(a,b){var c=e[a]||(e[a]={loaded:!1,list:[]});if(c.loaded){b(a);return!1}c.list.push(b);return c.list.length>1?!1:!0},l=function(a){var b=e[a].list;for(var c=0;c<b.length;c++)b[c](a);e[a].loaded=!0;delete e[a].list};if(!!k(f,h)){var m;j?m=d+f:m=c+f+"?version="+i;var n=a.C("link");n.setAttribute("rel","Stylesheet");n.setAttribute("type","text/css");n.setAttribute("charset","utf-8");n.setAttribute("href",m);document.getElementsByTagName("head")[0].appendChild(n);var o=a.C("div");o.id=g;a.core.util.hideContainer.appendChild(o);var p=3e3,q=function(){if(parseInt(a.core.dom.getStyle(o,"height"))==42){a.core.util.hideContainer.removeChild(o);l(f)}else if(--p>0)setTimeout(q,10);else{a.log(f+"timeout!");a.core.util.hideContainer.removeChild(o);delete e[f]}};setTimeout(q,50)}}});
STK.register("lib.dialog.authentication",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.core.util.browser;b=a.parseParam({src:"http://weibo.com/a/verify/realname?stage=home_verification",icon:"warn",isHold:!0,width:"380px",height:"240px",title:c("#L{å¸å·éªè¯}")},b||{});var e={},f,g,h=!1,i="tblog_checkfailed_reform",j={init:function(){f=a.ui.dialog(b);var c=[];c.push('<iframe id="account_authentication" name="account_authentication" node-type="frame" width="'+b.width+'" height="'+b.height+'" allowtransparency="true" scrolling="no" frameborder="0" src=""></iframe>');var d=a.builder(c.join(""));f.setTitle(b.title);f.setContent(d.box);var e=f.getDomList()},show:function(){try{window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_box")}catch(c){}h||a.lib.kit.io.cssLoader("style/css/module/layer/layer_check_identity.css","js_style_css_module_layer_check_identity",function(){h=!0});f.show().setMiddle();g=a.E("account_authentication");var d=decodeURIComponent(b.src)+"&rnd=";g.attachEvent?g.attachEvent("onload",function(){g.height=b.height;f.setMiddle()}):g.onload=function(){g.height=b.height;f.setMiddle()};g.src=d+a.core.util.getUniqueKey()},destroy:function(){},hook:function(a,b){try{a=="100000"?j.verifySucc():j.verifyFail()}catch(c){}},verifySucc:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_success");f.hide();var b={title:c("#L{æç¤º}"),icon:"success",OK:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_play");history.go(0)},OKText:c("#L{è¿å¥é¦é¡µ}"),msg:c("#L{æ­åï¼æ¨çèº«ä»½å·²éªè¯æåï¼é©¬ä¸è¿å¥å¾®åã}")},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})},verifyFail:function(){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_twotimes");f.hide();var b={title:c("#L{æç¤º}"),icon:"warn",OK:function(){SUDA.uaTrack&&SUDA.uaTrack(i,"checkfailed_triple");j.show()},OKText:c("#L{åæ¬¡éªè¯}"),msg:c("#L{æ±æ­ï¼æ¨çèº«ä»½ä¿¡æ¯ä¸åç¡®ï¼è¯·åæ¬¡éªè¯ã<br/>}")+'<a class="S_spetxt" suda-data="key=tblog_checkfailed_reform&value=checkfailed_havealook" href="http://weibo.com">'+c("#L{æ¨ä¹å¯ä»¥åä½éªå¾®åï¼éååéªè¯èº«ä»½ä¿¡æ¯>>}")+"</a>"},d=a.ui.alert(b.msg,b);a.custEvent.add(d,"hide",function(){history.go(0)})}};j.init();e.destroy=j.destory;e.show=j.show;window.App=window.App||{};window.App.checkRealName=j.hook;return e}});
STK.register("lib.dialog.memberDialog",function(a){var b='<div node-type="outer" class="layer_point"><dl class="point clearfix"><dt><span class="" node-type="icon"></span></dt><dd node-type="inner"><p class="S_txt1" node-type="textLarge"></p><p class="S_txt1" node-type="textComplex"></p><p class="S_txt2" node-type="textSmall"></p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" class="W_btn_b" node-type="OK"></a><a href="javascript:void(0);" class="W_btn_a" node-type="cancel"></a><a href="http://vip.weibo.com/paycenter?pageid=byebank" class="W_btn_a" node-type="member"><span><em class="W_icon icon_member"></em>#L{ç«å³å¼éä¼å}</span></a></div>',c={success:"icon_succM",error:"icon_errorM",warn:"icon_warnM","delete":"icon_delM",question:"icon_questionM"},d=a.lib.kit.extra.language,e=function(e,f){var g,h,i,j,k,l;g=a.parseParam({title:"&nbsp;",icon:"warn",textLarge:e,textComplex:"",textSmall:"",OK:a.funcEmpty,OKText:d("#L{ç¡®å®}"),cancel:a.funcEmpty,cancelText:d("#L{ç¡®è®¤}")},f);g.icon=c[g.icon];h={};i=a.ui.dialog();i.setContent(d(b));l=i.getDomList(!0);l.icon.className=g.icon;l.textLarge.innerHTML=g.textLarge;l.textComplex.innerHTML=g.textComplex;l.textSmall.innerHTML=g.textSmall;l.OK.innerHTML="<span>"+g.OKText+"</span>";l.cancel.innerHTML="<span>"+g.cancelText+"</span>";i.setTitle(g.title);i.getDomList().title.style.borderBottomStyle="none";var m=function(){j=!0;k=a.htmlToJson(l.textComplex);i.hide()};a.addEvent(l.OK,"click",m);a.addEvent(l.cancel,"click",i.hide);a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);a.removeEvent(l.OK,"click",m);a.removeEvent(l.cancel,"click",i.hide);j?g.OK(k):g.cancel(k)});i.show().setMiddle();h.dia=i;return h};return function(b){b=a.parseParam({type:"follow",errortype:"1"},b);var c,f,g={textLarge:d("#L{æ¨å·²è¾¾å°ææå³æ³¨ä¸éï¼}"),textComplex:d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{ææå³æ³¨ä¸éç«å³æé«}'),textSmall:d('#L{å¯}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{å¼éä¼å}</a>#L{æåå°ææå³æ³¨åå°è³10äººä»¥ä¸ï¼åæ·»å }'),OKText:d("#L{ç®¡çæçææå³æ³¨}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/whisper"}},h={textLarge:d("#L{æ¨å·²è¾¾å°å³æ³¨ä¸éï¼}"),textComplex:d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{å³æ³¨ä¸éç«å³æé«}'),textSmall:d('#L{å¯}<a href="http://vip.weibo.com/paycenter?pageid=byebank" class="S_link2">#L{å¼éä¼å}</a>#L{æåå°å³æ³¨åå°è³2000äººä»¥ä¸ï¼åæ·»å }'),OKText:d("#L{ç®¡çæçå³æ³¨}"),OK:function(){a.preventDefault();window.location.href="/"+$CONFIG.uid+"/follow"}};if(b.type=="quiet"){switch(parseInt(b.errortype,10)){case 2:g.textLarge=d("#L{æ¨å½åå·²è¾¾ä¼åç­çº§ææå³æ³¨ä¸éå¦ï¼}");g.textSmall="";g.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{äºè§£æ´å¤ä¼åç¹æä¿¡æ¯Â»}</a>');break;case 1:g.textLarge=d("#L{æ¨å·²è¾¾å°ææå³æ³¨ä¸éï¼}");g.textSmall="";g.textComplex=d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{ææå³æ³¨ä¸éç«å³æé«}');break;case 3:g.textLarge=d("#L{æ¨å·²è¾¾å°ææå³æ³¨ä¸éï¼}");g.textComplex=d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{ææå³æ³¨ä¸éç«å³æé«}');g.textSmall=d('#L{å¯}<a href="http://vip.weibo.com/paycenter">#L{å¼éä¼å}</a>#L{æå°ææå³æ³¨åå°è³10äººä»¥ä¸ï¼åæ·»å }')}c=g}else{switch(parseInt(b.errortype,10)){case 2:h.textLarge=d("#L{æ¨å½åå·²è¾¾ä¼åç­çº§å³æ³¨ä¸éå¦ï¼}");h.textSmall="";h.textComplex=d('<a href="http://vip.weibo.com/privilege" class="S_link2">#L{äºè§£æ´å¤ä¼åç¹æä¿¡æ¯Â»}</a>');break;case 1:h.textLarge=d("#L{æ¨å·²è¾¾å°å³æ³¨ä¸éï¼}");h.textSmall="";h.textComplex=d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{å³æ³¨ä¸éç«å³æé«}');break;case 3:h.textLarge=d("#L{æ¨å·²è¾¾å°å³æ³¨ä¸éï¼}");h.textComplex=d('#L{å¼é}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>ï¼#L{å³æ³¨ä¸éç«å³æé«}');h.textSmall=d('#L{å¯}<a href="http://vip.weibo.com/paycenter">#L{å¼éä¼å}</a>#L{æå°å³æ³¨åå°è³2000äººä»¥ä¸ï¼åæ·»å }')}c=h}f=e("",c);parseInt(b.errortype,10)==2?f.dia.getDomList().member.style.display="none":f.dia.getDomList().cancel.style.display="none"}});
STK.register("lib.dialog.ioError",function(a){var b=a.lib.kit.extra.language,c,d;return function(d,e,f){var g={},h,i,j=function(){},k={init:function(){k.data()},data:function(){i=a.parseParam({auto:!0,call:j,ok:j,cancel:j,beside:null},f);h=a.parseParam({location:"",oKText:b("#L{ç¡® å®}"),cancelText:b("#L{å æ¶}"),suda:""},e.data);h.msg=e.msg||b("#L{ç³»ç»ç¹å¿}");e.data.OKText&&(h.okText=e.data.OKText);h.OK=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.ok||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.ok();h.location&&(window.location.href=h.location)};h.cancel=function(){a.preventDefault();var b=a.queryToJson(h.suda||"");b=b.cancel||{};window.SUDA&&SUDA.uaTrack&&b.key&&SUDA.uaTrack(b.key,b.value);i.cancel()}},run:function(){var a=l[e.code]||l[100001];return a()||i.call(h,e)},destroy:function(){c&&c.destroy()}},l={100001:function(){if(i.beside)a.ui.tipAlert(h.msg,a.core.json.merge(h,{autoHide:!1,icon:"warnS"})).beside(i.beside);else{var b=a.ui.alert(h.msg.split("\\n"),a.core.json.merge(h,{icon:"warnB"}));a.addClassName(b.getOuter(),"W_translateZ")}},100002:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})},100003:function(){a.ui.confirm(h.msg.split("\n"),h)},100004:function(){c||(c=a.lib.dialog.authentication());c.show()},100005:function(){h.type=e.data&&(e.data.type?e.data.type:"follow");h.errortype=e.data&&(e.data.errortype||"1");return a.lib.dialog.memberDialog(h||{})},100008:function(){a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})}};k.init();g.getdata=function(){return h};g.getAction=function(a){return a?l[a]:l};g.getCode=function(){return e.code||""};g.run=k.run;i.auto&&k.run();return g}});
STK.register("lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b.args;e.__rnd&&delete e.__rnd;(new Image).src="http://weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d;(new Image).src="http://s1.sinaedge.com/whb.gif?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d={},e=[],f=null,g=!1,h=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},c);h.onComplete=function(a){g=!1;c.onComplete(a,h.args);setTimeout(i,0)};h.onFail=function(a){g=!1;if(typeof c.onFail=="function")try{c.onFail(a,h.args)}catch(d){}setTimeout(i,0);try{b(h)}catch(d){}};h.onTimeout=function(a){try{b(h);c.onTimeout(a)}catch(d){}};var i=function(){if(!!e.length){if(g===!0)return;g=!0;h.args=e.shift();if(h.method.toLowerCase()=="post"){var b=a.core.util.URL(h.url);b.setParam("__rnd",+(new Date));h.url=b.toString()}f=a.ajax(h)}},j=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d.request=function(a){a||(a={});c.noQueue&&j();if(!c.uniqueRequest||!f){e.push(a);a._t=0;i()}};d.abort=j;return d}});
STK.register("lib.kit.io.jsonp",function(a){return function(b){var c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b),d=[],e={},f=!1,g=function(){if(!!d.length){if(f===!0)return;f=!0;e.args=d.shift();e.onComplete=function(a){f=!1;c.onComplete(a,e.args);setTimeout(g,0)};e.onFail=function(a){f=!1;c.onFail(a);setTimeout(g,0)};a.jsonp(a.core.json.merge(c,{args:e.args,onComplete:function(a){e.onComplete(a)},onFail:function(a){try{e.onFail(a)}catch(b){}}}))}},h={};h.request=function(a){a||(a={});d.push(a);a._t=1;g()};h.abort=function(a){while(d.length)d.shift();f=!1;e=null};return h}});
STK.register("lib.kit.io.ijax",function(a){return function(b){var c=a.parseParam({url:"",timeout:3e4,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b),d=[],e=null,f=!1;c.onComplete=function(a,d){f=!1;b.onComplete(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};c.onFail=function(a,d){f=!1;b.onFail(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};var g=function(){var b;if(!!d.length){if(f===!0)return;f=!0;b=d.shift();c.args=b.args;c.form=b.form;e=a.ijax(c)}},h=function(a){while(d.length)d.shift();f=!1;if(e)try{e.abort()}catch(b){}e=null},i={};i.request=function(c,e){if(!a.isNode(c))throw"[lib.kit.io.ijax.request] need a form as first parameter";e||(e={});b.noQueue&&h();d.push({form:c,args:e});g()};i.abort=h;return i}});
STK.register("lib.kit.io.inter",function(a){var b=a.core.json.merge;return function(){var c={},d={},e={},f=function(a,b){return function(c,d){try{b.onComplete(c,d)}catch(f){}try{c.code==="100000"?b.onSuccess(c,d):b.onError(c,d)}catch(f){}for(var g in e[a])try{e[a][g](c,d)}catch(f){}}},g=function(a,b,c){return function(d){try{b.onComplete(d,c)}catch(f){}try{d.code==="100000"?b.onSuccess(d,c):b.onError(d,c)}catch(f){}for(var g in e[a])try{e[a][g](d,c)}catch(f){}}};c.register=function(a,b){if(typeof d[a]!="undefined")throw a+" registered";d[a]=b;e[a]={}};c.addHook=function(b,c){var d=a.core.util.getUniqueKey();e[b][d]=c;return d};c.rmHook=function(a,b){e[a]&&e[a][b]&&delete e[a][b]};c.getTrans=function(c,e){var g=b(d[c],e);g.onComplete=f(c,e);g.url+=(g.url.indexOf("?")>=0?"&":"?")+"ajwvr=6";g.withDomain&&(g.url+="&domain="+$CONFIG.domain);var h=d[c].requestMode,i="ajax";if(h==="jsonp"||h==="ijax")i=h;return a.lib.kit.io[i](g)};c.request=function(c,e,f){var h=b(d[c],e);h.onComplete=g(c,e,f);h.url+=(h.url.indexOf("?")>=0?"&":"?")+"ajwvr=6";h.withDomain&&(h.url+="&domain="+$CONFIG.domain);h=a.core.obj.cut(h,["noqueue"]);h.args=f;var i=d[c].requestMode;return i==="jsonp"?a.jsonp(h):i==="ijax"?a.ijax(h):a.ajax(h)};return c}});
STK.register("conf.trans.feed.feed",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("publish",{url:"/aj/mblog/add",method:"post"});c("delete",{url:"/aj/mblog/del",method:"post"});c("forward",{url:"/aj/mblog/forward",method:"post"});c("list",{url:"/aj/fav/mblog/favlist",method:"get"});c("getfeed",{url:"/p/aj/v6/mblog/mbloglist",method:"get",withDomain:!0});c("memberTopFeed",{url:"/p/aj/v6/mblog/settop",method:"post",withDomain:!0});c("mediaShow",{url:"http://api.weibo.com/widget/show.jsonp",varkey:"jsonp",method:"get",requestMode:"jsonp"});c("widget",{url:"/aj/mblog/showinfo",method:"post"});c("third_rend",{url:"/aj/mblog/renderfeed",method:"post"});c("feedViews",{url:"/aj/vtasks/recom",method:"post"});c("popularizeEffect",{url:"/aj/vip/popeffect",method:"get"});c("deleteTimingBlog",{url:"/aj/mblog/deltime",method:"post"});c("changeLevel",{url:"/p/aj/v6/mblog/modifyvisible",method:"post",withDomain:!0});c("feedset",{url:"/p/aj/proxy/feedsetting",method:"post"});c("feedset_new",{url:"/p/aj/proxy/feedsettingv6",method:"post"});c("accountset",{url:"/aj/account/settings",method:"post"});c("delSpread",{url:"/aj/feedtrend/filter",method:"post"});c("proxy",{url:"/aj/proxy",method:"post"});c("setAD",{url:"/aj/proxy/adclickserve",method:"post"});return b});
STK.register("lib.kit.extra.merge",function(a){return function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c}});
STK.register("lib.feed.inter",function(a){var b=window.$CONFIG||{},c=function(b){var c=a.C("div");c.innerHTML=b;window.WBEXP&&window.WBEXP.start(c);c=null};return function(d,e){if(!d)a.log("inter : need object of the baseFeedList Class");else{var f=d.getNode(),g=f.getAttribute("feed-type")||0,h=a.conf.trans.feed.feed,i=a.core.obj.parseParam({trans:h,plNode:null},e),j={request:function(){var e=arguments,f;if(e.length<3)throw new Error("[comp.content.homeFeed]:bindCustEvt()-custom event 'success' should supply enough arguments.");f=e[1];var h=a.lib.kit.extra.parseURL(),j=a.core.json.queryToJson(h.query),k=e[2]||{},l=h.path;l=l.indexOf("/")==0?l:"/"+l;j.key_word&&(j.key_word=encodeURIComponent(j.key_word));j.tag_name&&(j.tag_name=encodeURIComponent(j.tag_name));k=a.lib.kit.extra.merge(k,{pl_name:i.plNode.id,id:b.page_id,script_uri:l,feed_type:g});k=a.lib.kit.extra.merge(j,k);k.pre_page===undefined&&(k.pre_page=1);if(f=="lazyload"){k=a.lib.kit.extra.merge(k,d.getLoadingData());k.domain_op=b.domain||"";i.trans.request("getfeed",{onSuccess:function(a){d.updateFeed(a.data,"bottom","lazyload");c(a.data)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},k)}f=="newFeed"&&i.trans.request("getfeed",{onSuccess:function(a){d.updateFeed(a.data,"top","newFeed");c(a.data)},onFail:function(a){d.showError("top","newFeed")},onError:function(a){d.showError("top","newFeed")}},k)}},k=function(){a.custEvent.add(d,"request",j.request)};k();return{destroy:function(){}}}}});
STK.register("lib.feed.base",function(a){return function(b,c){a.isNode(b)||a.log("feed.base : parameter node is not a document node!");var d={},c=c||{},e=a.lib.feed.API(b,c);for(var f in e)!d[f]&&(d[f]=e[f]);var g=a.lib.feed.inter(d,c),h=function(){e.destroy&&e.destroy();g.destroy&&g.destroy()};d.destroy=h;return d}});
STK.register("conf.trans.feed.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("smallList",{url:"/aj/v6/comment/small",method:"get"});c("add",{url:"/aj/v6/comment/add",method:"post"});c("delete",{url:"/aj/comment/del",method:"post"});c("hotChange",{url:"/aj/comment/hotchange"});c("privateSetting",{url:"/aj/account/setcommentprivacy",method:"post"});c("privateNoMore",{url:"/aj/bubble/closebubble",method:"get"});c("cfilter",{url:"/aj/v6/comment/small",method:"get"});c("isComment",{url:"/aj/comment/privacy",method:"get"});c("getIn",{url:"/aj/commentbox/in",method:"get"});c("getOut",{url:"/aj/commentbox/out",method:"get"});c("getComment",{url:"/aj/at/comment/comment",method:"get"});c("getCommonComent",{url:"/aj/commentbox/common",method:"get"});c("dialogue",{url:"/aj/v6/comment/conversation",method:"get"});return b});
STK.register("lib.kit.extra.getDiss",function(a){return function(){var b={},c=0,d={location:$CONFIG.location};arguments[0]&&!a.core.dom.isNode(arguments[0])&&(b=arguments[c++]);b=a.lib.kit.extra.merge(b,d);if(!arguments[c])return b;b=a.lib.kit.extra.merge(b,a.core.json.queryToJson(a.lib.kit.dom.parentAttr(arguments[c++],"diss-data",arguments[c])||""));return b}});
STK.register("lib.kit.extra.setPlainHash",function(a){return function(b){try{var c=window.$CONFIG;c&&c.bigpipe==="true"&&a.historyM?a.historyM.setPlainHash(b):window.location.hash=b}catch(d){}}});
STK.register("lib.kit.extra.listener",function(a){var b={},c={};c.define=function(c,d){if(b[c]!=null)throw"lib.kit.extra.listener.define: é¢éå·²è¢«å ç¨";b[c]=d;var e={};e.register=function(d,e){if(b[c]==null)throw"lib.kit.extra.listener.define: é¢éæªå®ä¹";a.listener.register(c,d,e)};e.fire=function(d,e){if(b[c]==null)throw"commonlistener.define: é¢éæªå®ä¹";a.listener.fire(c,d,e)};e.remove=function(b,d){a.listener.remove(c,b,d)};e.cache=function(b){return a.listener.cache(c,b)};return e};return c});
STK.register("conf.channel.feed",function(a){var b=["forward","publish","comment","delete","refresh","reply","feedTagUpdate","feedTagMoreUpdate","qfaceAdd","qfaceCount","timeFeedPublish"];return a.lib.kit.extra.listener.define("conf.channel.feed",b)});
STK.register("conf.trans.validateCode",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("checkValidate",{url:"/aj/pincode/verified",method:"post"});return b});
STK.register("lib.dialog.validateCode",function(a){var b=window.$LANG,c=a.lib.kit.extra.language,d="/aj/pincode/pin?_wv=5&type=rule&lang="+$CONFIG.lang+"&ts=",e={dialog_html:'<div class="layer_point layer_verification"><div class="clearfix"><div class="v_img W_fl"><img height="25" width="250" class="yzm_img"/></div><div class="v_change W_fl"><a href="javascript:void(0);" class="yzm_change" action-type="yzm_change"><span class="W_ficon ficon_rotate S_ficon">e</span><span class="font S_txt1">#L{æ¢ä¸ç»}</span></a></div></div><div class="v_text yzm_wng"><span class="v_text">#L{è¯·è¾å¥ä¸é¢é®é¢çç­æ¡}ï¼</span><input type="text" class="yzm_input ontext W_input" action-type="yzm_input"/></div><div class="W_layer W_layer_pop yzm_error" style="display:none;top:70px;left:200px;"><div class="content layer_mini_info"><p class="main_txt"><i class="W_icon icon_rederrorS"></i><span class="txt S_txt1"></span><a class="W_ficon ficon_close S_ficon yzm_hideError">X</a></p><div class="W_layer_arrow"><span class="W_arrow_bor W_arrow_bor_b"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div></div><div class="W_layer_btn S_bg1"><a class="W_btn_a btn_34px yzm_submit" href="javascript:void(0);" action-type="yzm_submit">#L{ç¡®å®}</a><a class="W_btn_b btn_34px yzm_cancel" href="javascript:void(0);" action-type="yzm_cancel" action-data="value=frombtn">#L{åæ¶}</a></div>'},f;return function(){if(f)return f;var b={},g={},h,i,j,k,l=function(){g.yzm_error.innerHTML="";g.yzm_error_layer.style.display="none";a.removeClassName(g.yzm_wng,"v_wrong")},m=function(b){g.yzm_error.innerHTML=b;g.yzm_error_layer.style.display="";a.addClassName(g.yzm_wng,"v_wrong")},n=function(){a.lib.kit.io.cssLoader("style/css/module/layer/layer_verifycode.css","js_style_css_module_layer_layer_verifycode",function(){h||o();l();h.setTop();h.show();t.changesrc();h.setMiddle();g.input_text.value="";a.hotKey.add(document.documentElement,["esc"],t.closeDialog,{type:"keyup",disableInInput:!0})})},o=function(){h=a.ui.dialog({isHold:!0});h.setTitle(c("#L{è¯·è¾å¥éªè¯ç }"));h.setContent(c(e.dialog_html));var b=h.getBox();s(b);u()},p=function(b){a.conf.trans.validateCode.request("checkValidate",{onError:function(){m(c("#L{éªè¯ç éè¯¯}"));t.changesrc();j=!1;g.input_text.value=""},onFail:function(){m(c("#L{éªè¯ç éè¯¯}"));t.changesrc();g.input_text.value="";j=!1},onSuccess:function(b,c){j=!1;var d=b.data.retcode;l();g.input_text.value="";h.hide();var e=i.requestAjax,f=a.lib.kit.extra.merge(i.param,{retcode:d});e.request(f)}},b)},q=function(){},r=function(){},s=function(b){g.vImg=a.core.dom.sizzle("img.yzm_img",b)[0];g.yzm_change=a.core.dom.sizzle("a.yzm_change",b)[0];g.yzm_submit=a.core.dom.sizzle("a.yzm_submit",b)[0];g.yzm_cancel=a.core.dom.sizzle("a.yzm_cancel",b)[0];g.input_text=a.core.dom.sizzle("input.yzm_input",b)[0];g.yzm_wng=a.core.dom.sizzle("div.yzm_wng",b)[0];g.yzm_error=a.core.dom.sizzle("div.yzm_error span.txt",b)[0];g.yzm_error_layer=a.core.dom.sizzle("div.yzm_error",b)[0];g.yzm_hideError=a.core.dom.sizzle(".yzm_hideError",b)[0]},t={enter:function(){a.fireEvent(g.yzm_submit,"click")},changesrc:function(){var b=d+a.getUniqueKey();g.vImg.setAttribute("src",b);try{g.yzm_change.blur()}catch(c){}},checkValidateCode:function(){l();var b=a.core.str.trim(g.input_text.value);b?j||p({secode:b,type:"rule"}):m(c("#L{è¯·è¾å¥éªè¯ç }"));try{g.yzm_submit.blur()}catch(d){}},closeDialog:function(b){typeof b=="object"&&b.el&&h.hide();typeof i=="object"&&i.onRelease&&typeof i.onRelease=="function"&&i.onRelease();a.hotKey.remove(document.documentElement,["esc"],t.closeDialog,{type:"keyup"});try{a.preventDefault()}catch(c){}},onFocus:function(b){b=a.core.evt.getEvent();var c=b.target||b.srcElement,d=c.value;d||l()}},u=function(){var b=h.getBox();k=a.core.evt.delegatedEvent(b);k.add("yzm_change","click",function(){t.changesrc();a.preventDefault()});k.add("yzm_submit","click",function(){t.checkValidateCode();a.preventDefault()});k.add("yzm_cancel","click",t.closeDialog);a.core.evt.addEvent(g.yzm_hideError,"click",l);a.core.evt.addEvent(g.input_text,"focus",t.onFocus);a.core.evt.addEvent(g.input_text,"blur",t.onFocus);a.hotKey.add(g.input_text,["enter"],t.enter,{type:"keyup"})},v=function(){if(h){k.destroy();a.core.evt.removeEvent(g.yzm_hideError,"click",l);a.core.evt.removeEvent(g.input_text,"focus",t.onFocus);a.core.evt.removeEvent(g.input_text,"blur",t.onFocus);h&&h.destroy&&h.destroy()}j=h=f=null},w=function(a,b,c){if(a.code=="100027"){i=c;n()}else if(a.code==="100000")try{var d=c.onSuccess;d&&d(a,b)}catch(e){}else try{var d=c.onError;d&&d(a,b)}catch(e){}};r();r=null;b.destroy=v;b.validateIntercept=w;b.addUnloadEvent=function(){h&&a.core.evt.addEvent(window,"unload",v)};f=b;return b}});
STK.register("lib.kit.dom.parseDOM",function(a){return function(a){for(var b in a)a[b]&&a[b].length==1&&(a[b]=a[b][0]);return a}});
STK.register("conf.trans.comment",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("smallList",{url:"/aj/v6/comment/small",method:"get"});c("add",{url:"/p/aj/v6/comment/add",method:"post",withDomain:!0});c("delete",{url:"/aj/comment/del",method:"post"});c("hotChange",{url:"/aj/comment/hotchange"});c("privateSetting",{url:"/aj/account/setcommentprivacy",method:"post"});c("privateNoMore",{url:"/aj/bubble/closebubble",method:"get"});c("cfilter",{url:"/aj/v6/comment/small",method:"get"});c("isComment",{url:"/aj/comment/privacy",method:"get"});c("getIn",{url:"/aj/commentbox/in",method:"get"});c("getOut",{url:"/aj/commentbox/out",method:"get"});c("getComment",{url:"/aj/at/comment/comment",method:"get"});c("getCommonComent",{url:"/aj/commentbox/common",method:"get"});c("dialogue",{url:"/aj/v6/comment/conversation",method:"get"});c("commentDetail_photoView",{url:"/aj/v6/comment/photolayer",method:"get"});return b});
STK.register("lib.dialog.commentPrivateSetting",function(a){var b=1,c=0,d={},e,f,g=0,h,i={},j=0,k=0,l=a.lib.kit.extra.language,m=function(){var d=a.getUniqueKey,f=a.core.util.easyTemplate,g=a.lib.kit.dom.parseDOM,i={id1:"key"+d(),id2:"key"+d(),id3:"key"+d(),showType:b,set:c},j='<#et privateSetting data><div class="detail layer_setup_privacy" node-type="content"><div class="W_tips tips_warn clearfix"><p class="icon"><span class="icon_warnS"></span></p><p class="txt">#L{ä¸ºäºé¿ååå°ä¸å¿è¦çéªæ°ï¼å»ºè®®è®¾ç½®âå¯ä¿¡ç¨æ·âå¯ä»¥è¯è®ºæçå¾®åã}</p></div><p class="privacy_title">#L{è®¾ç½®è°å¯ä»¥è¯è®ºæçå¾®å}</p><ul class="privacy_repliable">\t<li><label for="${data.id1}"><input type="radio" class="W_radio" value="0" name="comment" id="${data.id1}" action-type="choose" <#if (data.showType == 1)>checked="checked"</#if><#if (data.showType==2 && data.set==0)>checked="checked"</#if>/>&nbsp;#L{ææäºº}<span class="S_txt2">#L{ï¼ä¸åæ¬ä½ çé»ååç¨æ·ï¼}</span></label></li>  <li><label for="${data.id2}"><input type="radio" class="W_radio" value="2" name="comment" id="${data.id2}" action-type="choose" <#if (data.showType==2 && data.set==2)>checked="checked"</#if>/>&nbsp;#L{å¯ä¿¡ç¨æ·}<span class="S_txt2">#L{ï¼åæ¬æå³æ³¨çäººãæ°æµªè®¤è¯ç¨æ·ãå¾®åè¾¾äººä»¥åææºç»å®ç¨æ·ï¼}</span></label></li>  <li><label for="${data.id3}"><input type="radio" class="W_radio" value="1" name="comment" id="${data.id3}" action-type="choose" <#if (data.showType==2 && data.set==1)>checked="checked"</#if>/>&nbsp;#L{æå³æ³¨çäºº}</label></li></ul><div class="btn"><a href="javascript:void(0)" class="W_btn_d" action-type="OK" node-type="OK" style="visibility:hidden;"><span>#L{ä¿å­}</span></a><#if (data.showType==1)><a href="javascript:void(0)" class="W_btn_b" action-type="cancel" node-type="noMore"><span>#L{ä¸åæç¤º}</span></a></#if><#if (data.showType==2)><a href="javascript:void(0)" class="W_btn_b" action-type="hide" node-type="hide"><span>#L{åæ¶}</span></a></#if></div></div></#et>';e=a.ui.dialog();e.setTitle(l("#L{è¯è®ºéç§è®¾ç½®}"));e.setContent(f(l(j),i).toString());h=g(a.builder(e.getOuter()).list)},n={chooseItem:function(d){g=d.el.value;b==1?a.setStyle(h.OK,"visibility",g==0?"hidden":"visible"):a.setStyle(h.OK,"visibility",g==c?"hidden":"visible")},save:function(b){g=parseInt(g,10);if(g>-1){if(j)return;j=1;a.conf.trans.comment.request("privateSetting",{onSuccess:o.saveSuccess,onError:o.saveError},{comment:g})}return a.preventDefault(b.evt)},cancel:function(b){if(!k){k=1;s();e.hide();a.conf.trans.comment.request("privateNoMore",{onSuccess:o.noMoreSuccess,onError:o.noMoreError},{bubbletype:5,time:604800});return a.preventDefault(b.evt)}},hide:function(b){s();e.hide();return a.preventDefault(b.evt)}},o={getSetErr:function(){a.ui.alert(l("#L{å¯¹ä¸èµ·ï¼è¯è®ºéç§è®¾ç½®è·åå¤±è´¥}"))},getAlert:function(b,c,d){var f=a.ui.tip({showCallback:function(){setTimeout(function(){f&&f.anihide()},500)},hideCallback:function(){f&&f.destroy();b?setTimeout(function(){d&&d();s();e.hide()},200):d&&d()},msg:c,type:b?undefined:"del"});return f},saveSuccess:function(b,c){e.hide();a.ui.tip("lite",{msg:l("#L{ä¿å­æå}"),type:"succM",timer:"1000",hideCallback:function(){window.location.reload()}})},saveError:function(){var a=o.getAlert(!1,l("#L{ä¿å­å¤±è´¥ï¼è¯·éè¯}"),function(){j=0});a.setLayerXY(h.OK);a.aniShow()},noMoreSuccess:function(){k=0},noMoreError:function(b){k=0;a.lib.dialog.ioError(b.code,b)}},p=function(){g=0;k=0;f=a.delegatedEvent(h.content);f.add("choose","click",n.chooseItem);f.add("OK","click",n.save);f.add("cancel","click",n.cancel);f.add("hide","click",n.hide)},q=function(){},r=function(a){if(a){a.data&&a.data.set&&(c=a.data.set);b=!c?1:2}q();m();p();e.show();e.setMiddle()},s=function(){f&&f.destroy()};d.show=r;return d});
STK.register("lib.comment.inter",function(a){var b=null,c=function(){},d=a.ui.alert,e,f=a.lib.dialog.commentPrivateSetting,g=a.lib.kit.extra.language,h=function(b,c){if(b&&b.code){b.code!="100000"&&b.code!="100005"&&a.lib.dialog.ioError(b.code,b);c(b)}};return function(f,i){e=a.lib.dialog.validateCode();var j={},k=0,l=a.conf.trans.feed.comment;f=a.parseParam({delete_success:c,delete_fail:c,delete_error:c,add_success:c,add_fail:c,add_error:c,smallList_success:c,smallList_fail:c,smallList_error:c},f||{});j.conf=a.parseParam({act:b,mid:b,cid:b,uid:$CONFIG.uid,page:b,forward:b,isroot:b,content:b,type:b,is_block:b,appkey:b},i);j.merge=function(b){b=a.lib.kit.extra.merge(j.conf,b);return a.core.obj.clear(b)};j.request=function(b,c){if(!k){k=1;var i=j.merge(c),m=l.getTrans(b,{onComplete:function(c,j){if(b=="add"){var l={onSuccess:function(a,c){h(a,function(a){f[b+(a.code=="100000"?"_success":"_fail")](a,i)})},onError:function(c,e){f[b+"_error"](c,i);c.code=="100005"?d(g("#L{ç±äºå¯¹æ¹éç§è®¾ç½®ï¼ä½ æ æ³è¿è¡è¯è®ºã}"),{textSmall:g("#L{ç»å®ææºåå¯ä»¥æ´å¤å°åä¸è¯è®ºã}")+'<a href="http://account.weibo.com/settings/mobile" target="_blank">'+g("#L{ç«å³ç»å®}")+"</a>"}):a.lib.dialog.ioError(c.code,c)},param:i,requestAjax:m};e.validateIntercept(c,j,l)}else h(c,function(c){if(c.code=="100000")f[b+"_success"](c,i);else{var d=f[b+"_fail"];typeof d=="function"?f[b+"_fail"](c,i):f[b+"_success"](c,i);a.ui.ioError(c.code,c)}});k=0},onFail:function(b){k=0;a.lib.dialog.ioError(b.code,b)}});m.request(i)}};j.load=function(a){j.request("smallList",a)};j.del=function(a){j.request("delete",a)};j.post=function(a){a.location=$CONFIG.location;a.pdetail=$CONFIG.page_id;j.request("add",a)};e.addUnloadEvent();return j}});
STK.register("conf.channel.at",function(a){var b=["open","close"];return a.lib.kit.extra.listener.define("conf.channel.at",b)});
STK.register("lib.kit.dom.autoHeightTextArea",function(a){var b=a.core.util.browser.MOZ,c=a.core.util.browser.IE6||a.core.util.browser.IE7||a.core.util.browser.IE8,d=function(d){var e=a.core.dom.getStyle,f;d.defaultHeight||(d.defaultHeight=parseInt(e(d,"height"),10)||parseInt(d.offsetHeight,10)||20);if(c){var g=parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10);f=Math.max(d.scrollHeight-g,d.defaultHeight)}else{var g=b?0:parseInt(e(d,"paddingTop"),10)+parseInt(e(d,"paddingBottom"),10),h=a.E("_____textarea_____");if(!h){h=a.C("textarea");h.id="_____textarea_____";document.body.appendChild(h)}if(h.currentTarget!=d){var i=[];i.push("width:"+e(d,"width"));i.push("font-size:"+e(d,"fontSize"));i.push("font-family:"+e(d,"fontFamily"));i.push("line-height:"+e(d,"lineHeight"));i.push("padding-left:"+e(d,"paddingLeft"));i.push("padding-right:"+e(d,"paddingRight"));i.push("padding-top:"+e(d,"paddingTop"));i.push("padding-bottom:"+e(d,"paddingBottom"));i.push("top:-1000px");i.push("height:0px");i.push("position:absolute");i.push("overflow:hidden");i.push("");i=i.join(";");h.style.cssText=i}h.value=d.value;f=Math.max(h.scrollHeight-g,d.defaultHeight);h.currentTarget=d}return f};return function(b){function j(b){var c=a.core.dom.getStyle,d,e=[];e.push("width:"+c(b,"width"));e.push("font-size:"+c(b,"fontSize"));e.push("font-family:"+c(b,"fontFamily"));e.push("line-height:"+c(b,"lineHeight"));e.push("padding-left:"+c(b,"paddingLeft"));e.push("padding-right:"+c(b,"paddingRight"));e.push("padding-top:"+c(b,"paddingTop"));e.push("padding-bottom:"+c(b,"paddingBottom"));e.push("top:-1000px");e.push("height:0px");e.push("position:absolute");e.push("overflow:hidden");e.push("");e=e.join(";");return e}var c=b.textArea,e=b.maxHeight,f=b.inputListener,g=c.style,h;(h=function(){typeof f=="function"&&f();setTimeout(function(){var a=d(c),b;e=e||a;var f=a>e;b=f?e:a;g.overflowY=f?"auto":"hidden";g.height=Math.min(e,a)+"px"},0)})();if(!a.core.util.browser.IE)try{a.conf.channel.at.register("open",function(){a.E("_____textarea_____").style.cssText=j(c)})}catch(i){a.log(i)}if(!c.binded){a.addEvent(c,"keyup",h);a.addEvent(c,"focus",h);a.addEvent(c,"blur",h);c.binded=!0;c.style.overflow="hidden"}}});
STK.register("lib.editor.plugin.count",function(a){function e(a,b){if(!a.textEl)throw"[editor plugin count]: plz check nodeList"}function d(a,b){var d=c(a),e=Math.abs(b-d),f;d>b||d<1?f={wordsnum:d,vnum:e,overflow:!0}:d==0?f={wordsnum:d,vnum:e,overflow:!0}:f={wordsnum:d,vnum:e,overflow:!1};return f}function c(b){var c=41,d=140,e=20,f=b,g=b.match(/(http|https):\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/\,\:;@&=\?~#%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}var b;return function(c){var f=c.nodeList,g,h=c.opts,i=a.lib.kit.extra.language;b=h.limitNum;e(f);a.core.evt.custEvent.define(c,"textNum");a.custEvent.define(c,"keyUpCount");var j=f.textEl,k=f.num;a.addEvent(j,"focus",function(){g=setInterval(function(){l()},200)});a.addEvent(j,"blur",function(){clearInterval(g)});var l=function(){var b=a.core.str.trim(j.value).length==0?a.core.str.trim(j.value):j.value,e=c&&c.opts&&c.opts.extendText;b=b.replace(/\r\n/g,"\n");var f=d(b,h.limitNum);b.length>=0&&j.focus?f.overflow&&f.wordsnum!=0?k.innerHTML=(e?i(e):"")+i("#L{å·²ç»è¶è¿%så­}",'<span class="S_error">'+f.vnum+"</span>"):k.innerHTML=(e?i(e):"")+i("#L{è¿å¯ä»¥è¾å¥%så­}","<span>"+f.vnum+"</span>"):b.length===0&&(k.innerHTML=(e?i(e):"")+i("#L{è¿å¯ä»¥è¾å¥%så­}","<span>"+f.vnum+"</span>"));a.core.evt.custEvent.fire(c,"textNum",{count:f.wordsnum,isOver:f.overflow})};STK.core.evt.addEvent(j,"keyup",l);a.custEvent.add(c,"keyUpCount",l)}});
STK.register("conf.trans.at",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("followList",{url:"/aj/mblog/attention"});c("topicList",{url:"/aj/mblog/topic"});return b});
STK.register("lib.kit.dom.layoutPos",function(a){return function(b,c,d){if(!a.isNode(c))throw"lib.kit.dom.layerOutElement need element as first parameter";if(c===document.body)return!1;if(!c.parentNode)return!1;if(c.style.display==="none")return!1;var e,f,g,h,i,j,k;e=a.parseParam({pos:"left-bottom",offsetX:0,offsetY:0},d);f=c;if(!f)return!1;while(f!==document.body){f=f.parentNode;if(f.style.display==="none")return!1;j=a.getStyle(f,"position");k=f.getAttribute("layout-shell");if(j==="absolute"||j==="fixed")break;if(k==="true"&&j==="relative")break}f.appendChild(b);g=a.position(c,{parent:f});h={w:c.offsetWidth,h:c.offsetHeight};i=e.pos.split("-");i[0]==="left"?b.style.left=g.l+e.offsetX+"px":i[0]==="right"?b.style.left=g.l+h.w+e.offsetX+"px":i[0]==="center"&&(b.style.left=g.l+h.w/2+e.offsetX+"px");i[1]==="top"?b.style.top=g.t+e.offsetY+"px":i[1]==="bottom"?b.style.top=g.t+h.h+e.offsetY+"px":i[1]==="middle"&&(b.style.top=g.t+h.h/2+e.offsetY+"px");return!0}});
STK.register("lib.kit.extra.textareaUtils",function(a){var b={},c=document.selection;b.selectionStart=function(a){if(!c)try{return a.selectionStart}catch(b){return 0}var d=c.createRange(),e,f,g=0,h=document.body.createTextRange();try{h.moveToElementText(a)}catch(b){}for(g;h.compareEndPoints("StartToStart",d)<0;g++)h.moveStart("character",1);return g};b.selectionBefore=function(a){return a.value.slice(0,b.selectionStart(a))};b.selectText=function(a,b,d){a.focus();if(!c)a.setSelectionRange(b,d);else{var e=a.createTextRange();e.collapse(1);e.moveStart("character",b);e.moveEnd("character",d-b);e.select()}};b.insertText=function(a,d,e,f){a.focus();f=f||0;if(!c){var g=a.value,h=e-f,i=h+d.length;a.value=g.slice(0,h)+d+g.slice(e,g.length);b.selectText(a,i,i)}else{var j=c.createRange();j.moveStart("character",-f);j.text=d}};b.replaceText=function(a,d){a.focus();var e=a.value,f=b.getSelectedText(a),g=f.length;if(f.length==0)b.insertText(a,d,b.getCursorPos(a));else{var h=b.getCursorPos(a);if(!c){var j=h+f.length;a.value=e.slice(0,h)+d+e.slice(h+g,e.length);b.setCursor(a,h+d.length);return}var i=c.createRange();i.text=d;b.setCursor(a,h+d.length)}};b.getCursorPos=function(a){var b=0;if(STK.core.util.browser.IE){a.focus();var d=null;d=c.createRange();var e=d.duplicate();e.moveToElementText(a);e.setEndPoint("EndToEnd",d);a.selectionStartIE=e.text.length-d.text.length;a.selectionEndIE=a.selectionStartIE+d.text.length;b=a.selectionStartIE}else if(a.selectionStart||a.selectionStart=="0")b=a.selectionStart;return b};b.getSelectedText=function(a){var b="",d=function(a){return a.selectionStart!=undefined&&a.selectionEnd!=undefined?a.value.substring(a.selectionStart,a.selectionEnd):""};window.getSelection?b=d(a):b=c.createRange().text;return b};b.setCursor=function(a,b,c){b=b==null?a.value.length:b;c=c==null?0:c;a.focus();if(a.createTextRange){var d=a.createTextRange();d.move("character",b);d.moveEnd("character",c);d.select()}else a.setSelectionRange&&a.setSelectionRange(b,b+c)};b.unCoverInsertText=function(a,b,c){c=c==null?{}:c;c.rcs=c.rcs==null?a.value.length:c.rcs*1;c.rccl=c.rccl==null?0:c.rccl*1;var d=a.value,e=d.slice(0,c.rcs),f=d.slice(c.rcs+c.rccl,d==""?0:d.length);a.value=e+b+f;this.setCursor(a,c.rcs+(b==null?0:b.length))};return b});
STK.register("lib.kit.dom.isTurnoff",function(a){return function(a){return!a.parentNode||a.parentNode.nodeType==11||!!a.disabled}});
STK.register("lib.kit.dom.cssText",function(a){var b=function(a,b){var c=(a+";"+b).replace(/(\s*(;)\s*)|(\s*(:)\s*)/g,"$2$4"),d;while(c&&(d=c.match(/(^|;)([\w\-]+:)([^;]*);(.*;)?\2/i)))c=c.replace(d[1]+d[2]+d[3],"");return c};return function(a){a=a||"";var c=[],d={push:function(a,b){c.push(a+":"+b);return d},remove:function(a){for(var b=0;b<c.length;b++)c[b].indexOf(a+":")==0&&c.splice(b,1);return d},getStyleList:function(){return c.slice()},getCss:function(){return b(a,c.join(";"))}};return d}});
STK.register("lib.editor.at",function(a){var b=a.lib.kit.dom.cssText,c=a.lib.kit.dom.isTurnoff,d=a.lib.kit.extra.textareaUtils,e=window,f=document,g=a.core.util.browser,h="",i=d.selectionStart,j,k,l,m,n,o=function(){var a={"<":"&lt;",">":"&gt;",'"':"&quot;","\\":"&#92;","&":"&amp;","'":"&#039;","\r":"","\n":"<br>"," ":(navigator.userAgent.match(/.+(?:ie) ([\d.]+)/i)||[8])[1]<8?['<pre style="overflow:hidden;display:inline;',h,'word-wrap:break-word;"> </pre>'].join(""):['<span style="white-space:pre-wrap;',h,'"> </span>'].join("")};return function(b){var c=b.replace(/(<|>|\"|\\|&|\'|\n|\r| )/g,function(b){return a[b]});return c}}(),p=function(){var c=[],d=j.textEl.style.cssText,e;a.foreach(["margin","padding","border"],function(b){a.foreach(["Top","Left","Bottom","Right"],function(d){var e;b!="border"?e=c.push(b,"-",d.toLowerCase(),":",a.getStyle(j.textEl,b+d),";"):a.foreach(["Style","Width"],function(e){c.push(b,"-",d.toLowerCase(),"-",e.toLowerCase(),":",a.getStyle(j.textEl,[b,d,e].join("")),";")})})});c.push("font-size:"+a.getStyle(j.textEl,"fontSize")+";");return b([d,c.join(""),h,"\n\t\tword-wrap: break-word;\n\t\tline-height: 18px;\n\t\toverflow-y:auto;\n\t\toverflow-x:hidden;\n\t\toutline:none;\n\t"].join("")).getCss()},q=function(){var b=a.builder(['<div node-type="wrap" style="display:none;">','<span node-type="before"></span>','<span node-type="flag"></span>','<span node-type="after"></span>',"</div>"].join("")).list,c=b.wrap[0],d=b.flag[0],e=b.after[0],h=b.before[0],i=0,k,l,m,q=function(a){return g.MOZ?-2:g.MOBILE&&g.SAFARI&&(g.IPAD||g.ITOUCH||g.IPHONE)?-2:0};return{bind:function(){if(l!==j.textEl){n=a.position(j.textEl);var b=["left:",n.l,"px;top:",n.t+20,"px;"].join("");l=j.textEl;var d=p();l.style.cssText=d;m=[b,d,"\n\t\t\t\tposition:absolute;\n\t\t\t\tfilter:alpha(opacity=0);\n\t\t\t\topacity:0;\n\t\t\t\tz-index:-1000;\n\t\t\t"].join("");c.style.cssText=m;if(!i){i=1;f.body.appendChild(c)}}},content:function(b,f,g,i){c.style.cssText=[m,"\n\t\t\t\twidth:",(parseInt(a.getStyle(l,"width"))||l.offsetWidth)+q(),"px;\n\t\t\t\theight:",parseInt(a.getStyle(l,"height"))||l.offsetHeight,"px;\n\t\t\t\toverflow-x:hidden;\n\t\t\t\toverflow-y:",/webkit/i.test(navigator.userAgent)?"hidden":a.getStyle(l,"overflowY"),";\n\t\t\t"].join("");h.innerHTML=o(b);d.innerHTML=o(f)||"&thinsp;";e.innerHTML=o([g,i].join(""));clearTimeout(k);k=setTimeout(function(){var b=a.position(d);a.custEvent.fire(j.eId,"at",{t:b.t-l.scrollTop-n.t,l:b.l-n.l,fl:b.l,key:g,flag:f,textarea:j.textEl})},30)},hide:function(){c.style.display="none"},show:function(){c.style.display=""}}}(),r=function(){if(c(j.textEl))clearInterval(k);else{var b=j.textEl.value.replace(/\r/g,""),d=i(j.textEl);if(d<0||d==m)return;m=d;var e=b.slice(0,d),f=e.match(new RegExp(["(",j.flag,")([a-z/[A-Z0-9/\\]ä¸-é¾¥_-]{0,20})$"].join("")));if(!f){a.custEvent.fire(j.eId,"hidden");return}var g=b.slice(d);e=e.slice(0,-f[0].length);q.content(e,f[1],f[2],g)}};return function(b){if(!!b&&!!b.textEl){b=a.parseParam({textEl:null,flag:"@",eId:a.custEvent.define({},["at","hidden"])},b);var c=function(){if(!!j){clearInterval(k);a.removeEvent(j.textEl,"blur",c);q.hide()}},d=function(){c();j=b;m=null;q.bind();q.show();k=setInterval(r,200);a.addEvent(b.textEl,"blur",c)};a.addEvent(b.textEl,"focus",d);return b.eId}}});
STK.register("lib.editor.plugin.at",function(a){var b=a.lib.kit.extra.language,c='<div style="" class="layer_menu_list"><ul node-type="suggestWrap"></ul></div>',d={"@":{normalTitle:b("#L{éæ©æµç§°æè½»æ²ç©ºæ ¼å®æè¾å¥}"),moreTitle:b("#L{éæ©æè¿@çäººæç´æ¥è¾å¥}"),noTilte:b("#L{è½»æ²ç©ºæ ¼å®æè¾å¥}")},"#":{normalTitle:b("#L{æ³ç¨ä»ä¹è¯é¢ï¼}")}},e={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.screen_name}" value="${list.screen_name}"><a href="#">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" <#if (list_index == 0)>class="cur" </#if>action-data="value=${list.topic}" value="${list.topic}"><a href="#">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'},f,g,h,i,j,k,l=!1,m,n,o={"@":"followList","#":"topicList"},p=0,q=function(){setTimeout(function(){a.custEvent.fire(f,"close")},200)},r=function(){j.style.display="none"},s=function(){a.custEvent.add(f,"onIndexChange",function(a,b){y(b)});a.custEvent.add(f,"onSelect",function(b,c,d,e){p=0;a.core.evt.stopEvent();var g=n[c].getAttribute("value")+"";g=g.replace(/\(.*\)/,"");try{d.focus()}catch(h){}var i=a.lib.kit.extra.textareaUtils;i.replaceText(d,"");var j=i.selectionStart(d)*1,k=new RegExp(e+"([a-z/[A-Z0-9/\\]ä¸-é¾¥_-]{0,20})$"),l=d.value.replace(/\r+/g,"").slice(0,j).match(k),m=d.value.slice(j,j+1);l=l&&l[1]?l[1].length:0;e=="#"?typeof m!="undefined"&&m!=e&&(g=g+e+" "):g=g+" ";i.insertText(d,g,j,l);var o=i.getCursorPos(d);if(e=="#"&&m==e){i.setCursor(d,o+1);i.insertText(d," ",o+1,0)}o=i.getCursorPos(d);var q=i.getSelectedText(d),r=q==""||q==null?0:q.length;d.setAttribute("range",o+"&"+r);a.custEvent.fire(f,"close")});a.addEvent(h.textEl,"blur",q);a.custEvent.add(f,"onClose",r);a.custEvent.add(f,"onOpen",function(b,c){i.style.display="";j.style.display="";l=!0;setTimeout(function(){a.custEvent.fire(f,"indexChange",0)},100)})},t=function(b){a.custEvent.remove(b);a.removeEvent(h.textEl,"blur",q)},u=function(b,c,f){b=="@"?c.data&&c.data.length>0?c.title=f==""?d[b].moreTitle:d[b].normalTitle:c.title=d[b].noTilte:c.title=d[b].normalTitle;var g=a.core.util.easyTemplate(e[b],c);return g},v=function(){a.core.evt.custEvent.add(g,"hidden",function(b,c){a.custEvent.fire(f,"close")});a.core.evt.custEvent.add(g,"at",function(b,c){k=c.key;var d=c.flag;if(k.length==0&&d!="@"&&d!="#"||c.textarea&&!c.textarea.value)a.custEvent.fire(f,"close");else var e=a.conf.trans.at.request(o[d],{onSuccess:function(b,e){var g=u(d,b,k);a.custEvent.fire(f,"openSetFlag",d);a.custEvent.fire(f,"open",c.textarea);var h=a.core.dom.builder(g),l=h.box;i.innerHTML=l;j.style.cssText=["z-index:11001;background-color:#ffffff;position:absolute;"].join("");var m=c.l;document.body.clientWidth<c.fl+a.core.dom.getSize(j).width&&c.fl>a.core.dom.getSize(j).width&&(m=c.l-a.core.dom.getSize(j).width);var n=0;a.winSize().height-c.textarea.getBoundingClientRect().bottom<200?n=-i.offsetHeight-4:n=c.t;a.lib.kit.dom.layoutPos(j,c.textarea,{pos:"left-top",offsetX:m,offsetY:n})},onError:function(){a.custEvent.fire(f,"close")}},{q:k})})},w=function(){m=h.textEl;g=a.lib.editor.at({textEl:m,flag:"@|#"})},x=function(b){p=0;j&&(j.style.display="none");j&&(j.innerHTML="");a.removeNode(j);j=STK.C("div");document.body.appendChild(j);if(j.innerHTML.length==0){j.innerHTML=c;i=a.core.dom.sizzle('[node-type="suggestWrap"]',j)[0];j.style.display="none"}if(f){a.custEvent.fire(f,"close");t(f)}f=a.ui.mod.suggest({textNode:b,uiNode:i,actionType:"item",actionData:"value",flag:"@"});s()},y=function(b){n=a.sizzle("li[class!=suggest_title]",i);n&&n[0]&&a.core.dom.removeClassName(n[p],"cur");a.core.dom.addClassName(n[b],"cur");p=b};return function(a,b){h=a.nodeList;var c={};c.init=function(){w();x(h.textEl);v()};return c}});
STK.register("lib.editor.plugin.sucTip",function(a){return function(b,c){var d=b.nodeList,e={},f=function(c){var c=c||{},e=a.core.obj.parseParam({className:"send_succpic",innerHTML:"",delay:2},c);d.successTip.className=e.className;d.successTip.innerHTML=e.innerHTML;a.core.evt.custEvent.fire(b,"setSucTipDelay",e.delay)},g=function(a){if(!a||!a.getTime)a=new Date;var b={year:a.getFullYear(),mouth:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()};return b},h={theEnd:function(a,b){var c=g(b.time);if(c.year==2012&&c.mouth==12&&c.date==21&&c.hours>=10){var d=!1;c.seconds%5==0&&(d=!0);b.text.indexOf("æ«æ¥")!=-1&&(d=!0);b.text.indexOf("çé")!=-1&&(d=!0);b.text.indexOf("ç»è¹")!=-1&&(d=!0);d?f({className:"send_success_over2",innerHTML:'<a target="_blank" href="http://huati.weibo.com/z/2013/"></a>',delay:3}):f()}else c.year==2012&&c.mouth==12&&c.date==22&&c.hours<=14?f({className:"send_success_over1",innerHTML:'<a target="_blank" href="http://huati.weibo.com/z/2013/"></a>',delay:3}):f({})}},i=function(){a.core.evt.custEvent.define(b,"theEnd");a.core.evt.custEvent.add(b,"theEnd",h.theEnd)},j=function(){i()};e.init=j;return e}});
STK.register("conf.trans.publisher",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("publish",{url:"/p/aj/v6/mblog/add",method:"post",withDomain:!0});c("publishPro",{url:"/aj/mblog/add",method:"post"});c("interactive",{url:"/aj/mblog/interactive",method:"post"});c("timingPublish",{url:"/aj/v6/mblog/addtime",method:"post"});c("getpublish",{url:"/p/aj/v6/publish",method:"get"});c("reviewadd",{url:"/p/aj/review/add",method:"post"});c("follow",{url:"/aj/f/followed",method:"post"});c("proxy",{url:"/p/aj/proxy",method:"post"});return b});
STK.register("lib.publisher.source.formdata",function(a){return function(b){function g(){var c={},d=a.sizzle("[name]",b);for(var e in d){var f=d[e].getAttribute("name"),g=d[e].getAttribute("value");f&&g&&(c[f]=g)}return c}function f(c){var d=a.sizzle('[name="'+c+'"]',b);d[0]&&a.removeNode(d[0])}function e(c,d){var e=a.sizzle('[name="'+c+'"]',b);e[0]&&e[0].setAttribute("value",d)}function d(c){var d=a.sizzle('[name="'+c+'"]',b);return d[0]?d[0].getAttribute("value"):"ABSENT"}if(!b)return!1;var c={},b=b;c={get:d,set:e,del:f,read:g,node:b};return c}});
STK.register("lib.kit.extra.refreshpl",function(a){return function(b,c){function g(e,g){var h=f(b);if(!!h){var i=FM.getURL().path,j=a.queryToJson(FM.getURL().query);j.pids=h;var k=a.jsonToQuery(j),l="";if(d){j=j?j:"";l=i+"?"+k+"#_0";FM.setState(l,g)}else c.iereload&&window.location.reload()}}function f(b){var c=[];if(a.isNode(b)){c.push(e(b));return c.join("|")}a.foreach(a.sizzle(b),function(a,b){c.push(e(a))});return c[0]?c.join("|"):!1}function e(a){return!a||a==document.body?!1:a.id?a.id:e(a.parentNode)}var d=$CONFIG.bigpipe==="true",c=c||{};g(c||{})}});
STK.register("lib.editor.plugin.score",function(a){return function(b,c){if(!!(b&&b.nodeList&&b.nodeList.score)){var d={},e=b.nodeList.reviewadd,f=a.core.dom.getSize(e),g=b.nodeList.scorecontrol.style.width,h=a.delegatedEvent(b.nodeList.score),i=a.lib.publisher.source.formdata(b.nodeList.extradata),j=a.lib.kit.extra.language,k={1:j("#L{å¾å·®}"),2:j("#L{ä¸è¬}"),3:j("#L{è¿è¡}"),4:j("#L{ä¸é}"),5:j("#L{æèµ}")},l={reviewadd:function(c){var c=a.fixEvent(c),d=a.position(e);f=a.core.dom.getSize(e);if(c.pageY>d.t&&c.pageY<d.t+f.height&&c.pageX>d.l&&c.pageX<d.l+f.width){var h=c.pageX-d.l,i=Math.floor(h/f.width*5+1);b.nodeList.scorecontrol.style.width=i*20+"%";b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=k[i])}else{b.nodeList.scorecontrol.style.width=g;b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=k[g.replace("%","")*5/100]||"")}},mouseout:function(a){b.nodeList.scorecontrol.style.width=g},add:function(c){var d=a.position(e),h=c.data,j=c.evt.pageX-d.l;h.score=Math.floor(j/f.width*5+1);a.conf.trans.publisher.getTrans("reviewadd",{onSuccess:function(c){g=h.score*20+"%";b.nodeList.scorecontrol.style.width=g;c.data.score_title&&b.nodeList.score_title&&(b.nodeList.score_title.innerHTML=c.data.score_title);i.set("score",h.score);c.data.prefixtext&&i.set("prefixtext",c.data.prefixtext);c.data.refreshpl&&a.lib.kit.extra.refreshpl('[node-type="'+c.data.refreshpl+'"]');a.custEvent.fire(b,"keyUpCount")},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(){}}).request(h)}},m=function(){a.addEvent(document.body,"mousemove",l.reviewadd);h.add("reviewadd","click",l.add)},n=function(){m()};n();d.destroy=function(){a.removeEvent(document.body,"mousemove",l.reviewadd);h.remove("reviewadd","click",l.add)};return d}}});
STK.register("conf.trans.face",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("face",{url:"/aj/mblog/face?type=face&_wv=5"});c("magicFace",{url:"/aj/mblog/face?type=ani&_wv=5"});return b});
STK.register("lib.face.face",function(a){function h(b){if(f.length){b(f);return!0}a.conf.trans.face.request("face",{onSuccess:function(a,c){f=[];a.data.usual.norm&&f.push({name:g,hotmap:a.data.usual.hot.slice(0,12),map:a.data.usual.norm});for(var d in a.data.more)a.data.more.hasOwnProperty(d)&&f.push({name:d,map:a.data.more[d]});b(f)},onError:function(b,c){a.lib.dialog.ioError(b.code,b)}},{});return!1}var b=a.lib.kit.extra.language,c=["first","second","third","fouth","fifth","sixth","seventh","eighth","ninth","tenth","eleventh","twelfth"],d={"é»è®¤":"default","æµªå°è±":"langxiaohua","æ´èµ°æ¼«ç»":"baozou","å°æé¾":"konglong","å·å":"lengtu","ææè¡¨æ":"star","é­æ¯ç¹":"ghost","ç«å½":"diandang","é¿ç¸":"ali","BOBOåTOTO":"boto","ææª":"gaoguai","å°çº¯æ´":"chunjie","ç½å°é»":"xiaohei","ç½éª¨ç²¾":"baigujing","helloèè":"hello","é¢ç«èå":"miantan","é¿æå":"alatu","å°å¹ºé¸¡":"yaoji","å¿æ":"mood","æ©ä¸æ©ä¸":"mosi","æ¡å®":"guibao","æç«ç«":"lanmaomao","å½¼å°å¾·":"bierde","å¤©æ°":"weather","ä¼é²":"relax","ç®ç®åµ":"paopao","åå¦ç":"eiyou","åç«":"kuaimao","æå¤«":"baifu","èè":"mengmeng","ç®¡ä¸ç":"guanbuzhe","è­è­":"chouchou",nonopanda:"nonopanda","æé¾å®è´":"konglongbaobei","å½±å­":"shadow","å¤§è³å":"daertu","åç®å":"hapitu","æåº§":"xingzuo","ç±å¿":"aixin","å¼ å°ç":"zhangxiaohe","æ å»ç´":"youxihou","å°æ°å°æµª":"xinlang","å¤§ç":"daxiong","èèç¹ç¹":"mogu","é·åºç":"kuku"},e='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_faces"><div class="WB_minitab"><ul class="minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li><li class="minitb_item S_line1" node-type="tab"><a href="javascript:void(0);" class="minitb_lk S_txt1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a><span class="cur_block"></span></li></ul><ul class="W_fr minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_more S_line1" node-type="prev" action-type="prev"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_left_lite S_ficon">j</i></a></li><li class="minitb_more S_line1" node-type="next" action-type="next"> <a href="javascript:void(0);" class="minitb_lk S_txt1"><i class="W_ficon ficon_arrow_right_lite S_ficon">i</i></a></li></ul></div><div class="faces_list_box"><div class="faces_list" node-type="scrollView"><div node-type="list"></div></div></div></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',f=[],g=b("#L{é»è®¤}");return function(b,f){var g=a.ui.bubble(e,{clickBlankToHide:!0,stopClickPropagation:!0,autoRelease:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});a.custEvent.define(g,"insert");var i=g.getDomList(!0).list,j=[].concat(g.getDomList(!0).tab),k,l=0,m=0;h(function(b){function e(){a.foreach(j,function(c,d){d=d+m;a.removeClassName(c,"current");if(b[d]){if(d===l){a.addClassName(c,"current");c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>'}else c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1" action-type="tab" action-data="index='+d+'">'+b[d].name+'</a><span class="cur_block"></span>';c.title=b[d].name}else{c.innerHTML='<a href="javascript:void(0);" class="minitb_lk S_txt1"></a><span class="cur_block"></span>';c.title=""}c.offsetWidth});m<=0?a.addClassName(g.getDomList().prev,"W_btn_b_disable"):a.removeClassName(g.getDomList().prev,"W_btn_b_disable");m>=b.length-5?a.addClassName(g.getDomList().next,"W_btn_b_disable"):a.removeClassName(g.getDomList().next,"W_btn_b_disable")}g.on("tab","click",function(e){l=e.data.index|0;a.foreach(j,function(b,c){a.removeClassName(b,"current");a.removeClassName(b.firstChild,"S_bg2")});a.addClassName(e.el.parentNode,"current");a.addClassName(e.el,"S_bg2");var f="",h;if(b[l].hotmap){f+='<ul class="faces_list_hot clearfix">';a.foreach([].concat(b[l].hotmap),function(a,b){h='suda="key=mainpub_default_expr&value='+c[b]+'"';f+='<li action-type="select" action-data="insert='+encodeURIComponent(a.phrase)+'" title="'+a.phrase.replace(/\[|\]/g,"")+'" '+h+'><img src="'+a.icon+'"/></li>'});f+="</ul>"}f+="<ul>";a.foreach([].concat(b[l].map),function(a){h='suda="key=pub_expression&value='+d[b[l].name]+'"';f+='<li action-type="select" action-data="insert='+encodeURIComponent(a.phrase)+'" title="'+a.phrase.replace(/\[|\]/g,"")+'" '+h+'><img src="'+a.icon+'"/></li>'});f+="</ul>";i.innerHTML=f;i.offsetWidth;k||(k=a.ui.scrollView(g.getDomList(!0).scrollView));setTimeout(function(){k.reset();k.scrollTop(0)})});g.on("prev","click",function(a){m=Math.max(m-5,0);e()});g.on("next","click",function(a){m=Math.min(m+5,b.length-5);e()});g.on("select","click",function(b){var c=a.sizzle("img",b.el)[0].getAttribute("src");g.trigger("insert",{value:decodeURIComponent(b.data.insert),url:c});var d=b.el.getAttribute("suda");if(d){d=a.queryToJson(d);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(d.key,d.value)}});g.on("beforeHide",function(){k.scrollEl.style.overflowY="hidden"});g.on("hide",function(){if(k){k.destroy();k=null}});e();g.trigger(j[0].firstChild,"click",null)});g.getBub=function(){return g};f.refer?g.show().setArrow("top").setAlignPos(b,f.refer,f):g.show().beside(b,f);return g}});
STK.register("lib.publisher.widget.face",function(a){var b=a.lib.face.face;return function(c,d){var e={},f,g;d=a.parseParam({t:0,l:-15,refer:c.nodeList.textEl,useAlign:!0,arrowOffset:2},d||{});var h=function(a,b){var d=c.API.getCurrentLogType();c.API.addShortUrlLog(d);c.API.insertText(b.value)},i=function(){a.core.evt.preventDefault();var g,i=a.fixEvent(a.getEvent()).target;g=i;f=b(g,d);a.custEvent.add(f,"insert",h);a.custEvent.define(c,"close");a.custEvent.add(c,"close",e.hide);a.custEvent.add(f,"hide",function(){a.custEvent.remove(f,"hide",arguments.callee);a.custEvent.remove(f,"insert",h);a.custEvent.remove(c,"close",e.hide)})};e.init=function(b,d,e){c=b;g=d;a.addEvent(b.nodeList[g],"click",i)};e.show=i;e.hide=function(){f&&f.getBub().hide()};e.destroy=function(){c=null};return e}});
STK.register("conf.trans.imageUploadBubble",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("cartoon",{url:"/aj/mblog/face?type=cartoon&_wv=5"});return b});
STK.register("lib.kit.extra.crc32",function(a){return function(a,b){function c(a){a=a.replace(/\r\n/g,"\n");var b="";for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);if(d<128)b+=String.fromCharCode(d);else if(d>127&&d<2048){b+=String.fromCharCode(d>>6|192);b+=String.fromCharCode(d&63|128)}else{b+=String.fromCharCode(d>>12|224);b+=String.fromCharCode(d>>6&63|128);b+=String.fromCharCode(d&63|128)}}return b}a=c(a);var d="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D",b;typeof b=="undefined"&&(b=0);var e=0,f=0;b=b^-1;for(var g=0,h=a.length;g<h;g++){f=(b^a.charCodeAt(g))&255;e="0x"+d.substr(f*9,8);b=b>>>8^e}var i=b^-1;i<0&&(i=4294967296+i);return i}});
STK.register("lib.kit.extra.imageURL",function(a){return function(b,c){function f(a){a=(a+"").replace(/[^a-f0-9]/gi,"");return parseInt(a,16)}var d={size:"small"};if(typeof b=="string"){d=a.core.obj.parseParam(d,c);var e=d.size,g={ss:{middle:"&690",bmiddle:"&690",small:"&690",thumbnail:"&690",square:"&690",orignal:"&690",thumb180:"&690",mw1024:"&690"},ww:{middle:"bmiddle",large:"large",bmiddle:"bmiddle",small:"small",thumbnail:"thumbnail",square:"square",orignal:"large",thumb180:"thumb180",mw690:"mw690",mw1024:"mw1024"}},h=b.charAt(9)=="w",i=b.charAt(21)=="g"?".gif":".jpg",j=h?a.lib.kit.extra.crc32(b)%4+1:f(b.substr(19,2))%16+1,k="http://"+(h?"ww":"ss")+j+".sinaimg.cn/"+(h?g.ww[e]:e)+"/"+b+(h?i:"")+(h?"":g.ss[e]);return k}}});
STK.register("conf.trans.watermark",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("waterMark",{url:"/aj/account/watermark"});return b});
STK.register("lib.image.watermark",function(a){var b={trans:null,conf:null,success:function(a,c){b.conf=a.data}},c=[];return function(d){if(typeof d=="function"){c.push(d);if(b.conf)for(var e=0;e<c.length;e++){c[e]&&c[e](b.conf);c[e]=null}else{b.trans||(b.trans=a.conf.trans.watermark.getTrans("waterMark",{onSuccess:function(){b.success.apply(null,arguments);for(var a=0;a<c.length;a++){c[a]&&c[a](b.conf);c[a]=null}},onError:function(a){},onFail:function(a){}}));b.trans.abort();b.trans.request()}}}});
STK.register("lib.kit.extra.upload",function(a){var b=a.lib.kit.extra.language;return function(c){var d={},e=window.location.href,f;c=a.parseParam({type:"common",form:null,base64Str:"",imgName:"",uploadArgs:{}},c);a.custEvent.define(d,["uploadError","uploadSucc"]);var g={base64form:null,upload:function(b){var d,e=b,h="weibo.com/",i=window.$CONFIG,j=c.type;if(j==="common")d=c.form;else if(j==="base64"){d=a.C("form");g.base64form=d;d.method="POST";var k=a.C("input");k.name="b64_data";k.type="hidden";k.value=c.base64Str;d.appendChild(k);document.body.appendChild(d)}var l={marks:1,app:"miniblog",s:"rdxt"};c.type==="common"||c.type==="base64"?l=a.lib.kit.extra.merge({url:e.domain=="1"?h+(i&&i.watermark||i.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?"@"+(i&&i.nick):0},l):c.type==="custom"&&(l=a.lib.kit.extra.merge(c.uploadArgs,l));j==="base64"&&(l=a.lib.kit.extra.merge({mime:"image/jpeg",data:"base64"},l));f=a.core.io.ijax({url:"http://picupload.service.weibo.com/interface/pic_upload.php",form:d,abaurl:"http://"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",timeout:18e5,onComplete:g.handle,onTimeout:g.handle,args:l})},sendError:function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),f=window.$CONFIG,g=a.lib.kit.extra.merge(b,{ua:d,rnd:(new Date).getTime(),uid:f?f.uid:0,referer:encodeURIComponent(e)});g=a.core.json.jsonToQuery(g);g="http://ww1.sinaimg.cn/do_not_delete/fc.html?"+g;c.setAttribute("src",g)},handle:function(e){a.removeNode(g.base64form);g.base64form=null;var f=Math.abs(e.ret);if(!e||e.ret<0){var h="";switch(f){case 1:h="#L{æ²¡æç»å½}";break;case 4:case 9:h="#L{è¯·ä¸ä¼ 5Mä»¥åçJPGãGIFãPNGå¾çã}";break;default:h="#L{ä¸ä¼ å¾çè¶æ¶}"}e?g.sendError({ret:e.ret}):g.sendError({ret:"none"});a.custEvent.fire(d,"uploadError",{code:f,msg:b(h)})}else{var i=new Date,j=function(a){return a<10?"0"+a:a},k;if(c.type==="common")k=c.imgName;else if(c.type==="base64"){var l=[i.getFullYear(),j(i.getMonth()+1),j(i.getDate()),j(i.getHours()),j(i.getMinutes()),j(i.getSeconds())].join("");k=b("#L{å¾®åæ¡é¢æªå¾}")+l+".jpg"}a.custEvent.fire(d,"uploadSucc",{pid:e.pid,imgName:k})}},init:function(){c.type==="common"||c.type==="base64"?a.lib.image.watermark(function(a){g.upload(a)}):g.upload()},destroy:function(){a.custEvent.undefine(d);a.removeNode(g.base64form)}};g.init();d.destroy=g.destroy;d.abort=function(){if(f)try{f.abort()}catch(a){}};return d}});
STK.register("lib.kit.extra.getFlashVersion",function(a){return function(){var a="1",b=navigator;if(b.plugins&&b.plugins.length){for(var c=0;c<b.plugins.length;c++)if(b.plugins[c]&&b.plugins[c].name&&b.plugins[c].name.indexOf("Shockwave Flash")!=-1){a=b.plugins[c].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(var c=10;c>=2;c--)try{var d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);if(d){a=c+".0";break}}catch(e){}return parseInt(a.split(".")[0])}});
STK.register("lib.kit.extra.installFlash",function(a){var b=a.lib.kit.extra.language;return function(c){c=a.parseParam({onHide:a.funcEmpty},c);var d='<div class="layer_version_upgrade"><dl class="point clearfix"><dt><span class="icon_versionup"></span></dt><dd><p class="S_txt1">#L{ä½ çFlashçæ¬è¿ä½ï¼è¯·å®è£æ´é«çæ¬çFlashæä»¶åï¼åå·æ°é¡µé¢éè¯}</p></dd></dl><div class="versionup_btn"><a class="btn_l" href="http://get.adobe.com/cn/flashplayer/" target="_blank"><img width="16" height="16" class="icon_install" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{å®è£æ´æ°}</span></a><a class="btn_r" href="javascript:void(0);" onclick="window.location.reload()">'+' <img width="16" height="16" class="icon_refreshpage" title="" src="'+$CONFIG.imgPath+'style/images/common/transparent.gif">'+'<span class="txt">#L{å·æ°é¡µé¢}</span></a></div>'+"</div>";a.lib.kit.io.cssLoader("style/css/module/layer/layer_version_upgrade.css","js_style_css_module_layer_layer_version_upgrade",function(){var e=a.ui.dialog();e.setTitle(b("#L{æç¤º}"));var f=a.C("div");f.innerHTML=b(d);e.setContent(f);f=null;e.show();e.setMiddle();a.custEvent.add(e,"hide",function(){a.custEvent.remove(e,"hide",arguments.callee);setTimeout(function(){c.onHide()},0)})})}});
STK.register("lib.kit.extra.swfobject",function(a){var b=function(){function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}function V(a,b){if(!!y){var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}}function U(b,d,e,f){if(!z.ie||!z.mac){var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";if(f){w=null;x=null}if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css");i.setAttribute("media",h);w=g.appendChild(i);z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]);x=h}z.ie&&z.win?w&&typeof w.addRule==c&&w.addRule(b,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(b+" {"+d+"}"))}}function T(a){var b=z.pv,c=a.split(".");c[0]=parseInt(c[0],10);c[1]=parseInt(c[1],10)||0;c[2]=parseInt(c[2],10)||0;return b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function S(a,b,c){a.attachEvent(b,c);p[p.length]=[a,b,c]}function R(a){return j.createElement(a)}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function O(a){var b=Q(a);if(b&&b.nodeName=="OBJECT")if(z.ie&&z.win){b.style.display="none";(function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)})()}else b.parentNode.removeChild(b)}function N(a,b,c){var d=R("param");d.setAttribute("name",b);d.setAttribute("value",c);a.appendChild(d)}function M(b,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof b.id==a&&(b.id=e);if(z.ie&&z.win){var i="";for(var j in b)b[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=b[j]:j.toLowerCase()=="styleclass"?i+=' class="'+b[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+b[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>";o[o.length]=b.id;g=Q(b.id)}else{var m=R(c);m.setAttribute("type",f);for(var n in b)b[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",b[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,b[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h);g=m}}return g}function L(a){var b=R("div");if(z.win&&z.ie)b.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(c)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&b.appendChild(e[g].cloneNode(!0))}}}return b}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(L(a),b);a.style.display="none";(function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(L(a),a)}function J(b,c,d,e){v=!0;s=e||null;t={success:!1,id:d};var f=Q(d);if(f){if(f.nodeName=="OBJECT"){q=L(f);r=null}else{q=f;r=d}b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew";l.setAttribute("id",d);f.parentNode.insertBefore(l,f);f.style.display="none";(function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)})()}M(b,c,d)}}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function H(b){var d=null,e=Q(b);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(c)[0];f&&(d=f)}return d}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312)){V(d,!0);if(e){f.success=!0;f.ref=H(d);e(f)}}else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall;h.width=g.getAttribute("width")||"0";h.height=g.getAttribute("height")||"0";g.getAttribute("class")&&(h.styleclass=g.getAttribute("class"));g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else{K(g);e&&e(f)}}else{V(d,!0);if(e){var m=H(d);if(m&&typeof m.SetVariable!=a){f.success=!0;f.ref=m}e(f)}}}}function F(){var b=j.getElementsByTagName("body")[0],d=R(c);d.setAttribute("type",f);var e=b.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var c=e.GetVariable("$version");if(c){c=c.split(" ")[1].split(",");z.pv=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]}}else if(g<10){g++;setTimeout(arguments.callee,10);return}b.removeChild(d);e=null;G()})()}else G()}function E(){l?F():G()}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c();b()}}else i.onload=b}function C(a){u?a():m[m.length]=a}function B(){if(!u){try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}}var a="undefined",c="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var b=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==c){r=k.plugins[d].description;if(r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)){l=!0;p=!1;r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1");q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10);q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10);q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);if(s){r=s.GetVariable("$version");if(r){p=!0;r=r.split(" ")[1].split(",");q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]}}}catch(t){}return{w3:b,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!!z.w3){(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B();if(!u){typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1);if(z.ie&&z.win){j.attachEvent(h,function(){if(j.readyState=="complete"){j.detachEvent(h,arguments.callee);B()}});i==top&&function(){if(!u){try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}}()}z.wk&&function(){if(!u){if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}}();D(B)}}}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var c=0;c<a;c++)p[c][0].detachEvent(p[c][1],p[c][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in b)b[g]=null;b=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;n[n.length]=e;V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(b,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};if(z.w3&&!(z.wk&&z.wk<312)&&b&&d&&e&&f&&g){V(d,!1);C(function(){e+="";f+="";var n={};if(k&&typeof k===c)for(var o in k)n[o]=k[o];n.data=b;n.width=e;n.height=f;var p={};if(j&&typeof j===c)for(var q in j)p[q]=j[q];if(i&&typeof i===c)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0);m.success=!0;m.ref=s}else{if(h&&I()){n.data=h;J(n,p,d,l);return}V(d,!0)}l&&l(m)})}else l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);if(a&&q){a.parentNode.replaceChild(q,a);if(r){V(r,!0);z.ie&&z.win&&(q.style.display="block")}s&&s(t)}v=!1}}}}();return b});
STK.register("lib.image.imgUpload",function(a){var b=document.documentElement,c=document.body,d={getScroll:function(){var a,d,e,f;if(b&&b.scrollTop){a=b.scrollTop;d=b.scrollLeft;e=b.scrollWidth;f=b.scrollHeight}else if(c){a=c.scrollTop;d=c.scrollLeft;e=c.scrollWidth;f=c.scrollHeight}return{t:a,l:d,w:e,h:f}},getScreen:function(){var c={};if(a.IE){c.w=b.clientWidth;c.h=b.clientHeight}else{c.w=window.innerWidth;c.h=window.innerHeight}return c}},e=function(a){var b={cn:"zh_CN",tw:"zh_TW"};a=a.toLowerCase();a=a.replace(/zh-/g,"");return b[a]};return function(b,f){var g={version:$CONFIG.version,swf_path:$CONFIG.jsPath+"home/static/swf/img/",service:b.service,ed_swf:b.swf||"PhotoEditor.swf",exp_swf:"expressInstall.swf",h:b.h||385,w:b.w||528,f_version:"10.0.0",channel:b.id+"_channel",id_panel:b.id+"_panel",id_swf:b.id+"_swf"},h={},i,j,k={init:function(){f.init&&f.init(h,b)},setHeight:function(b){a.IE||(m.getFlash(g.id_swf).height=b)},upComplate:function(a){b.sucess&&b.sucess(a);i.style.display="none";h.destory()},closeEditor:function(){i.style.display="none";h.destory();f.close&&f.close(h,b)},suda:function(a){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("meitu","v4||"+a)}},l={version:g.version,language:e($CONFIG.lang),channel:g.channel,JSHandler:"STK.core.util.listener.fire",initFun:"init",changeFlashHeightFun:"setHeight",uploadCompleteFun:"upComplate",closePhotoEditorFun:"closeEditor",suda:"suda"},m={init:function(){if(!!b.id){i=a.E(g.id_panel);j=a.E(g.id_swf);if(!i){i=a.C("div");i.id=g.id_panel;c.appendChild(i)}if(!j){j=a.C("div");j.id=g.id_swf;i.appendChild(j)}i.style.display="none";m.getFlash(g.id_swf)||m.build()}},checkAction:function(a,b){var c=STK.core.util.listener.list;return!!c[a]&&!!c[a][b]},bindEvt:function(a){for(var b in a)k[a[b]]&&!m.checkAction(g.channel,a[b])&&STK.core.util.listener.register(g.channel,a[b],k[a[b]])},build:function(){var c=b.baseDir?b.baseDir+"/":"",d={menu:"true",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:a.IE?"window":"transparent",base:g.swf_path+c},e={id:b.id};m.bindEvt(l);a.lib.kit.extra.swfobject.embedSWF(g.swf_path+c+g.ed_swf+"?version="+g.version,g.id_swf,g.w,g.h,g.f_version,g.swf_path+g.exp_swf,l,d,e)},getFlash:function(){return a.lib.kit.extra.swfobject.getObjectById(b.id)},setPos:function(){var c,e,f,h,j=d.getScroll(),k=d.getScreen();f=Math.round(g.h>k.h?k.h/5+j.t:(k.h-g.h)/2+j.t);h=Math.round(g.w>k.w?k.w/5+j.l:(k.w-g.w)/2+j.l);c=b.pos.t-1||f;e=b.pos.l||h;i.style.zIndex=b.zIndex||2e4;a.setStyle(i,"position","absolute");a.setStyle(i,"left",e+"px");a.setStyle(i,"top",c+"px");m.autoScroll(j.t,j.t+(c-f))},autoScroll:function(a,b,c){var d,e,f,g=8,h;g=c||g;h=a-b;e=[h];e[g]=0;f=1;for(f;f<g;f++)e[f]=h=h/2;clearInterval(d);d=setInterval(function(){e.length?window.scrollTo(0,b+e.shift()):clearInterval(d)},30)}};h.show=function(a){a&&(b.id=a);i&&(i.style.display="");m.setPos();return this};h.hide=function(){i&&(i.style.display="");return this};h.setPars=function(a){var b={imageURL:a||"",uploadURL:g.service};m.getFlash(g.id_swf).editPhoto(b);return this};h.getSwf=m.getFlash;h.destory=function(){for(var b in l)k[l[b]]&&STK.core.util.listener.remove(g.channel,l[b],k[l[b]]);i.innerHTML="";a.removeNode(i)};m.init();return h}});
STK.register("lib.browser.plugin.plugInstallState",function(a){return function(b,c,d,e){var f={},g=a.core.util.browser,h=window.navigator,i=!!window.ActiveXObject||"ActiveXObject"in window,j=g.MOZ,k=g.OPERA,l=g.SAFARI,m=g.CHROME,n=g.Version,o=c.embedId,p=c.embedType,q=b.pluginName,r=b.activeXName;f.instance=e;var s=function(){var a;for(a=0;a<d.length;a++)if(!(d.param[a]in f.instance))break;return a<d.length-1?!1:!0};f.getInstallState=function(){if(i){var b;if(!f.instance)try{f.instance=new ActiveXObject(r);b=!0}catch(c){f.instance=null}if(f.instance){if(s())return"ieinstalled";if(!b)try{f.instance=new ActiveXObject(r)}catch(c){f.instance=null}return f.instance?s()?"ieinstalled":"ieneedUpdate":"ieneedInstall"}return"ieneedInstall"}var d=h.plugins,e;if(d&&d.length)for(var g=0,j=d.length;g<j;g++){var k=d[g];if(k&&k.name&&k.name===q){e=!0;break}}if(e){if(!f.instance){var l=a.C("embed");l.id=o;l.type=p;l.setAttribute("hidden",!0);document.body.appendChild(l);f.instance=l}return"installed"}f.instance=null;return"needInstall"};return f}});
STK.register("lib.browser.plugin.screenCapture",function(a){var b=a.core.util.browser,c=a.lib.kit.extra.language,d=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)},e=!!window.ActiveXObject||"ActiveXObject"in window,f=b.MOZ,g=b.OPERA,h=b.SAFARI,i=b.CHROME,j=b.Version,k="weibo_screen_grab_download",l={pluginName:"npScreenGrab Plugin",activeXName:"ScreenGrab.ScreenGrabCom.1"},m={embedId:"weibo_screen_grab_embed",embedType:"application/x-screengrab-sina"},n={param1:"OnGrapContent",param2:"CloseScreenGrabCtrlWnd",param3:"onmsgfireevent"},o,p={spec:null,setCurrentSpec:function(a){p.spec=a},setup:function(){if(typeof o.OnGrapContent!="function"){o.OnGrapContent=function(a,b,c,d){var e=p.spec;q.focusWindow();if(a===2){if(e.captureType==="base64")e.captureSuccess(c);else if(e.captureType==="pid"){e.beforeUpload();e.upload(c)}}else if(a===3){q.focusWindow();e.captureCancel()}};o.onmsgfireevent=function(a,b){if(b===2){q.focusWindow();spec.captureCancel()}};a.addEvent(window,"unload",function(){a.removeEvent(window,"unload",arguments.callee);if(o)try{o.CloseScreenGrabCtrlWnd();o.onmsgfireevent=null;o.OnGrapContent=null;o=null}catch(b){}})}}},q={};q.isSupport=function(){return b.OS==="windows"?e?!0:f?j>=3.6?!0:!1:g?!1:h?!1:i?j>=4?!0:!1:!1:!1};q.focusWindow=function(){window.focus()};q.hide=function(){o&&o.CloseScreenGrabCtrlWnd()};q.screenCapture=function(b){var g,h={uploadSucc:function(a,c){q.focusWindow();b.captureSuccess(c)},uploadErr:function(a,c){b.captureError(c)}},j=function(b){g&&g.destroy();g=a.lib.kit.extra.upload({type:"base64",base64Str:b});a.custEvent.add(g,"uploadSucc",h.uploadSucc);a.custEvent.add(g,"uploadError",h.uploadErr)},r=function(){b.upload=function(a){j(a)};p.setup();p.setCurrentSpec(b);if(a.isArray(b.showPos)){var c=b.showPos;o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(typeof b.showPos=="function"){var c=b.showPos();a.isArray(c)&&o.ShowControlWnd(c[0],c[1],c[2],c[3])}else if(b.showPos==="center"){var d=a.scrollPos(),e=200,f=200,g=a.winSize(),h=Math.floor(d.top+(g.height-e)/2),i=Math.floor(d.left+(g.width-f)/2);o.ShowControlWnd(window.screenLeft+i,window.screenTop+h,f,e)}else b.showPos==="default"&&o.ShowControlWnd(-1,-1,-1,-1)},s=function(b,e){var f="http://desktop.weibo.com/download.php?source=jietu",g='<#et screentip data><div class="layer_screenshot_tips"><p class="tip"><span class="icon_warnM"></span>${data.titletip}ã</p><div><a href="http://desktop.weibo.com" target="_blank"><img src="${data.imgsrc}" alt=""></a></div></div></div></#et>',h={imgsrc:(window.$CONFIG&&window.$CONFIG.imgPath||"http://img.t.sinajs.cn/t6/")+"style/images/layer/pic_screenshot.png?version="+(window.$CONFIG&&window.$CONFIG.version||""),titletip:b==="IE"?"#L{ä½¿ç¨æ­¤åè½ï¼éè¦åå®è£å¾®åæ¡é¢}":"#L{ä½¿ç¨æ­¤åè½ï¼éè¦åå®è£å¾®åæ¡é¢æä»¶}"+(b==="FF"?"ï¼#L{å¹¶éæ°å¯å¨æµè§å¨æè½ä½¿ç¨}":""),downloadTitle:"#L{ç«å³ä¸è½½}"},i=a.ui.dialog();i.setTitle(c("#L{æªå±æä»¶å®è£æç¤º}"));i.setContent(c(a.core.util.easyTemplate(g,h).toString()));i.show();i.setMiddle();var j=i.getDomList(!0),l=function(){i.hide();d("tblog_image_cut","cancel_download")},m=function(b){var c=a.E(k);if(!c){c=a.C("iframe");c.id=k;c.style.display="none";a.core.util.hideContainer.appendChild(c)}c.src=f;d("tblog_image_cut","download");i.hide()};a.custEvent.add(i,"hide",function(){a.custEvent.remove(i,"hide",arguments.callee);e()})},t=function(){b.beforeSupportTip();a.ui.alert(c("#L{å¾®åæªå¾åè½ææªæ¯æä½ çæµè§å¨ï¼ç®åå¾®åæªå¾æä»¶æ¯æWindowsç³»ç»ä¸çä»¥ä¸æµè§å¨ï¼IEæµè§å¨ï¼æ¯æIE6åæ´æ°çæ¬ãIEåæ ¸æµè§å¨ï¼å¦360å®å¨æµè§å¨ï¼å²æ¸¸ç­æµè§å¨ãFirefoxæµè§å¨ï¼æ¯æ3.6åæ´æ°çæ¬ãChromeæµè§å¨ï¼æ¯æ4.0åæ´æ°çæ¬ãChroniumåæ ¸æµè§å¨ï¼å¦360æ¥éæµè§å¨ï¼æçç­æµè§å¨}ã"),{title:c("#L{æä¸æ¯æå½åæµè§å¨}"),icon:"warnB",OK:function(){setTimeout(function(){b.supportTipOk()},0)}});d("tblog_image_cut","not_support_browser")},u=function(){var c=e?"IE":f?"FF":i?"CHROME":"";b=a.parseParam({captureType:"base64",captureSuccess:a.funcEmpty,captureCancel:a.funcEmpty,captureError:a.funcEmpty,beforeUpload:a.funcEmpty,showPos:"default",beforeSupportTip:a.funcEmpty,supportTip:t,supportTipOk:a.funcEmpty,beforeIeInstallTip:a.funcEmpty,ieInstallTip:function(){b.beforeIeInstallTip();s(c,b.ieInstallTipOk)},ieInstallTipOk:a.funcEmpty,beforeInstallTip:a.funcEmpty,installTip:function(){b.beforeInstallTip();s(c,b.installTipOk)},installTipOk:a.funcEmpty},b||{});var d=q.isSupport();if(!d)b.supportTip();else{var g=a.lib.browser.plugin.plugInstallState(l,m,n,o),h=g.getInstallState();o=g.instance;h==="installed"||h==="ieinstalled"?r():h==="ieneedUpdate"||h==="ieneedInstall"?b.ieInstallTip():h==="needInstall"&&b.installTip()}};return{doit:u,hide:q.hide,focusWindow:q.focusWindow,abort:function(){try{g&&g.abort()}catch(a){}}}};return q});
STK.register("lib.image.uploadBubble",function(a){var b=window.$CONFIG,c=[];(function(){b&&b.bigpipe==="true"&&a.historyM&&a.historyM.onpopstate(function(b,d){if(d){a.foreach(c,function(a){a()});c=[]}})})();var d=a.conf.trans.imageUploadBubble;return function(e,f){var g,h,i=a.lib.browser.plugin.screenCapture,j=a.lib.kit.extra.language,k='<div node-type="outer"><div class="layer_send_pic" node-type="wrap"><div node-type="inner"><div node-type="tabs"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" href="javascript:void(0);" node-type="tab1" action-type="tab">#L{æ¬å°ä¸ä¼ }</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a  class="pftb_lk S_line5 S_txt1 S_bg1" href="javascript:void(0);" node-type="tab2" action-type="tab">#L{æ¨èéå¾}</a></li></ul></div></div><div node-type="content"></div></div><div node-type="uploaded" style="display:none"><div class="laPic_tit"><span node-type="pName"></span><span class="right"></span></div><div node-type="picWrap" class="laPic_Pic"></div><div class="lapic_edit"><a class="beautify" href="javascript:void(0);" node-type="beautify" action-type="beautify" suda-data="key=meitu&value=v4||publish||editor"><span class="W_ico12 icon_edit"></span>#L{ç¼è¾}</a><a class="delete" href="javascript:void(0);" action-type="delete"><span class="W_ico12 ico_del"></span>#L{å é¤}</a></div></div><div node-type="flashPanel"></div>',l='<#et uppic data><div node-type="uppic">    <div class="laPic_btnBox clearfix">        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" node-type="inputCover">                <span><em class="ico_one"></em>#L{åå¼ å¾ç}</span>                <form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action="">                    <input class="input_f" type="file" hidefoucs="true" style="" node-type="fileBtn" name="pic1"/>                </form></a>        </div>        <div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="more" suda-data="key=meitu&value=v4||publish||more">                <span><em class="ico_ones"></em>#L{å¤å¼ å¾ç}</span>            </a>        </div>        <#if (data.supportCapture)><div class="laPic_btnmore">            <a href="javascript:void(0);" class="W_btn_e" action-type="screen_window" suda-data="key=tblog_image_cut&value=open_image_cut">                <span><em class="ico_screenshot"></em>#L{æªå±ä¸ä¼ }</span>            </a>        </div></#if>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="face_sticker">               <span><em class="ico_bigface"></em>#L{å¤§ å¤´ è´´}</span>           </a>       </div>       <div class="laPic_btnmore">           <a href="javascript:void(0);" class="W_btn_e" action-type="upload_album">               <span><em class="ico_toalbum"></em>#L{ä¸ä¼ å°ç¸å}</span>           </a>       </div>    </div></div><div node-type="loading"  style="width:230px;display:none"><div class="laPic_con"><div><i class="W_loading"></i><span>#L{å¾çæ­£å¨ä¸ä¼ ï¼è¯·ç­å¾}...</span></div></div><div class="laPic_btn"><a href="javascript:void(0);" class="W_btn_b" action-type="cancel"><span>#L{åæ¶ä¸ä¼ }</span></a></div></div></#et>',m='<p class="tab_kind S_link2"><span class="right"><a class="pre_d" action-type="prev" node-type="prev" href="javascript:void(0);"></a><a class="next" action-type="next" node-type="next" href="javascript:void(0);"></a></span><em node-type="categorys"></em></p><div node-type="loading"></div><div class="detail"><ul node-type="list" class="faces_magic_list clearfix"></ul><div node-type="page" class="W_pages_minibtn"></div></div>',n='<div><i class="W_loading"></i> <span>æ­£å¨å è½½ï¼è¯·ç¨å...</span></div>',o='<a href="javascript:void(0);" onclick="return false;" action-type="category" action-data="category=#{item}">#{item}</a>',p='<a href="javascript:void(0);"  onclick="return false;" action-type="category" action-data="category=#{item}" class="current S_txt1">#{item}</a>',q='<li><a action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}" class="img" href="javascript:void(0);"><img src="#{thumb}" original="#{original}" title="#{value}" alt="#{phrase}" /></a><span title="#{value}"  action-type="insertSmiley" action-data="url=#{thumb}&pid=#{picid}&value=#{value}">#{phrase}</span></li>',r='<a action-type="page" class="page S_bg1" action-data="num=#{number}" href="javascript:void(0);" >#{label}</a>',s='<a action-type="page" action-data="num=#{number}" href="javascript:void(0);"  class="page S_txt1"  onclick="return false;">#{label}</a>',t="",u=j("#L{é»è®¤}"),v="#L{åäº«å¾ç}",w="##L{å¾®åå¤§å¤´è´´}#",x=5,y="weibo.com/",z,A,B,C,D,E,F,G,H,I,J,K,L={},M={page:0,cache:null,cPoniter:0,categorys:[],currentCategory:u,itemNumber:10},N,O,P=a.core.dom.position,Q=a.core.evt.addEvent,R=a.core.evt.removeEvent,S=function(){B=T;a.custEvent.define(L,["uploaded","hide","insert","deletePIC","picLoad"]);a.custEvent.add(g,"hide",function(b){return function(){T.abortUpload();T.hideCapture();a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(L,"hide",{});H=0}}(g));h=a.ui.mod.tab({templete:z,eventType:"click"});a.custEvent.add(h,"tabOut",function(a,b){b=="tab1"?U.init():b=="tab2"&&T.init()});K=a.core.evt.delegatedEvent(z);T.bind()},T={abortUpload:function(){E&&E.abort();F&&F.abort()},init:function(){B=T;T.initDom();T.bind()},initDom:function(){var b;N.wrap.className="layer_send_pic";var c={supportCapture:!0};N.content.innerHTML=j(a.core.util.easyTemplate(l,c).toString());N.close=a.builder(g.getBox()).list.close[0];b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);T.exchangeInput()},bind:function(){Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture);K.add("delete","click",T.deletePic);K.add("cancel","click",T.cancelUpload);K.add("more","click",T.morePic);K.add("beautify","click",T.beautify);K.add("screen_window","click",T.captureWindow);K.add("face_sticker","click",T.faceSticker);K.add("upload_album","click",T.uploadAblum)},destroy:function(){N.fileBtn&&R(N.fileBtn,"click",T.hideCapture);N.fileBtn&&R(N.fileBtn,"change",V.upload)},handleError:function(b){T.stopUpload();g.stopBoxClose();T.resetInput();a.ui.alert(j(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){g.startBoxClose()},0)}})},handleSucc:function(a){T.rendSucc(a);T.stopUpload()},rendLoad:function(){g.stopBoxClose();N.uppic.style.display="none";N.loading.style.display=""},rendSucc:function(b){var c=a.lib.kit.extra.imageURL(b.pid),d=[],e,f;J=J||b.pid;d=J.split(/\/|\\/);e=d[d.length-1];d=e.split(".");if(d.length>1&&a.bLength(d[0])>20){d[0]=a.leftB(d[0],20);f=[d[0],"...",d[1]].join("")}else f=e;D=b.pid;V.loadPic({url:c,value:f,pid:b.pid});N.beautify&&(N.beautify.style.display="")},deletePic:function(){a.preventDefault();N.close.style.display="";N.inner.style.display="";N.wrap.style.width="";N.uploaded.style.display="none";N.picWrap.innerHTML="";B.destroy();B.init();g.startBoxClose();a.custEvent.fire(L,"deletePIC",{text:j(I)});H=0},stopUpload:function(){N.loading.style.display="none";N.uppic.style.display=""},cancelUpload:function(){T.abortUpload();T.stopUpload();T.resetInput();g.startBoxClose()},exchangeInput:function(){var b=N.fileBtn,c=b.parentNode,d=b.className,e=b.name,f=a.C("input");f.className=d;f.name=e;f.type="file";f.hideFocus="true";N.fileBtn=f;c.removeChild(b);c.appendChild(f)},resetInput:function(){R(N.fileBtn,"click",T.hideCapture);R(N.fileBtn,"change",V.upload);T.exchangeInput();Q(N.fileBtn,"change",V.upload);Q(N.fileBtn,"click",T.hideCapture)},beautifySucess:function(a){J=a;T.handleSucc({pid:a})},faceStickerSucess:function(a){H=1;J=a;T.handleSucc({pid:a})},morePic:function(){T.uploadWaterMarkFlash({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:T.beautifySucess})},faceSticker:function(){T.uploadWaterMarkFlash({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:T.faceStickerSucess})},uploadWaterMarkFlash:function(c){a.preventDefault();T.hideCapture();g.stopBoxClose();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){g.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=b&&b.nick||"",h="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+y+(b&&b.watermark||b.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",i={id:c.id,pos:g.getPosition(),service:h,sucess:c.sucess,h:c.height,w:c.width,swf:c.swf,baseDir:c.baseDir||""};a.lib.image.imgUpload(i,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){g.startBoxClose()},100)}}).show()};a.lib.image.watermark(function(a){d(a)})}},beautify:function(){a.preventDefault();if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var b={id:"photo_editor",pos:g.getPosition(),service:"http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:T.beautifySucess,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(b,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(D,{size:"large"}))},close:function(a,b){}}).show()}},hideCapture:function(){F&&F.hide()},captureWindow:function(){a.preventDefault();if(!F){var b=function(){g.stopBoxClose()},c=function(){g.startBoxClose()};F=i.screenCapture({captureType:"pid",beforeUpload:T.beforeCaptureUpload,captureSuccess:T.captureSuccess,captureError:T.handleError,beforeSupportTip:b,supportTipOk:c,beforeIeInstallTip:b,ieInstallTipOk:c,beforeInstallTip:b,installTipOk:c})}F.doit()},beforeCaptureUpload:function(){T.rendLoad()},captureSuccess:function(a){J=a.imgName;G=1;T.handleSucc(a)},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},U={init:function(){B=U;T.abortUpload();T.hideCapture();var b;N.wrap.className="layer_faces";T.destroy();N.content.innerHTML=j(m);b=a.lib.kit.dom.parseDOM(a.core.dom.builder(z).list);N=a.lib.kit.extra.merge(N,b);N.loading.innerHTML=j(n);U.cartoonStart();U.bind()},bind:function(){K.add("insertSmiley","click",function(a){STK.core.evt.preventDefault();N.beautify&&(N.beautify.style.display="none");var b=a.data.url,c=a.data.pid,d=a.data.value;V.loadPic({url:b,value:d,pid:c})});K.add("category","click",function(a){M.page=0;M.currentCategory=a.data.category;U.rend();setTimeout(function(){U.rendCategory(M);U.rendPage(M)},0)});K.add("prev","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter;if(c<=0)return!1;M.cPoniter-=x;U.rendCategory(M)});K.add("next","click",function(b){a.preventDefault(b.evt);var c=M.cPoniter,d=M.categorys;if(c>=d.length-x)return!1;M.cPoniter+=x;U.rendCategory(M)});K.add("page","click",function(a){M.page=parseInt(a.data.num,10);U.rend();setTimeout(function(){U.rendPage(M)},0);return STK.preventDefault(a.evt)})},cartoonStart:function(){d.request("cartoon",{onSuccess:function(a,b){M.cache=a.data.more||{};M.categorys=[u];for(var c in M.cache)M.categorys.push(c);M.cache[u]=a.data.usual.norm;U.cartoonStart=function(){M.page=0;M.cPoniter=0;M.currentCategory=u;U.rend();U.rendCategory(M);U.rendPage(M)};U.cartoonStart()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},rend:function(b,c){var d=M.currentCategory,e=M.cache[d],f=M.page,g=M.itemNumber;e=e.slice(f*g,f*g+g);e=a.foreach(e,function(b,c){a.bLength(b.phrase)>8&&(b.phrase=[a.leftB(b.phrase,6),"..."].join(""));return a.templet(j(q),b)});N.loading.innerHTML="";N.list.innerHTML=e.join("")},rendCategory:function(b){var c=b.cPoniter,d=b.categorys,e=b.currentCategory,f=d.slice(c,c+x);f=a.foreach(f,function(b,c){return e===b?a.templet(j(p),{item:b}):a.templet(j(o),{item:b})});N.categorys.innerHTML=f.join(t);c+6>=d.length?N.next.className="next_d":N.next.className="next";c<=0?N.prev.className="pre_d":N.prev.className="pre"},rendPage:function(b){var c=b.page,d=b.cache[b.currentCategory],e=d.length/b.itemNumber,f=[];for(var g=0;g<e;g+=1)c==g?f.push(a.templet(j(s),{number:g,label:g+1})):f.push(a.templet(j(r),{number:g,label:g+1}));N.page.innerHTML=f.join("")},destroy:function(){}},V={trans:function(){E&&E.destroy();E=a.lib.kit.extra.upload({type:"common",form:N.form,imgName:J});a.custEvent.add(E,"uploadSucc",function(a,b){T.handleSucc(b)});a.custEvent.add(E,"uploadError",function(a,b){T.handleError(b)})},upload:function(){J=N.fileBtn.value;if(a.core.str.trim(J)!==""){T.rendLoad();V.trans()}},loadPic:function(b){N.picWrap.innerHTML="";var c=b.url,d=N.close,e=a.C("img");b.value&&(N.pName.innerHTML=b.value);G&&(e.onload=function(){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_image_cut","succeed_image_cut")});G=0;e.src=c;g.stopBoxClose();I=H?w:v;a.core.evt.custEvent.fire(L,"uploaded",{text:j(I),pid:b.pid});N.wrap.style.display="";N.wrap.className="layer_send_pic";N.wrap.style.width="240px";N.inner.style.display="none";N.uploaded.style.display="";d.style.display="none";N.picWrap.appendChild(e)}},W={};L={};L.getBub=function(){return g};if(!a.isNode(e))throw"common.bubble.image need el as first parameter!";O=window.location.href;N=a.lib.kit.dom.parseDOM(a.core.dom.builder(j(k)).list);z=N.outer;g=a.ui.bubble();T.initDom();if(f&&f.pid){var X=a.lib.kit.extra.imageURL(f.pid);V.loadPic({url:X,pid:f.pid})}S();g.setContent(z);f.fail=function(){g.setLayout(e,{offsetX:-24,offsetY:5})};g.setAlignPos(e,f.refer,f);L.bubble=g;g.show();c.push(function(){g&&g.hide()});return L}});
STK.register("lib.publisher.widget.image",function(a){return function(b){var c={},d,e,f,g,h=!1,i=function(a,c){var e=b.API.getImageLogType();b.API.addShortUrlLog(e);b.API.insertText(c.value);d.getBub().hide()},j=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);h=!0;var e=b.API.getWords();e.length==0&&b.API.insertText(c.text);b.API.addExtraInfo(c.pid);f=!0},k=function(a,c){h=!1;b.API.delWords(c.text);b.API.addExtraInfo("");clearInterval(g);f=!1},l=function(e){if(!f){a.core.evt.preventDefault();var l,m=a.fixEvent(a.getEvent()).target;l=m;var n=b.nodeList.textEl;if(typeof e=="string"){d=a.lib.image.uploadBubble(l,{pid:e,refer:n});g=setInterval(function(){var a={fail:function(){d.bubble.setLayout(l,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(l,n,a)},200)}else d=a.lib.image.uploadBubble(l,{refer:n});a.custEvent.add(d,"uploaded",j);a.custEvent.add(d,"insert",i);a.custEvent.add(d,"deletePIC",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"uploaded",j);a.custEvent.remove(d,"insert",i);a.custEvent.remove(d,"deletePIC",k);a.custEvent.remove(d,"changeType");a.custEvent.remove(b,"close",c.hide);b.API.addExtraInfo("");h=!1;f=!1})}};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",l);f&&f.pid&&l(f.pid)};c.show=l;c.hide=function(b,c){if(h&&d){var e=d.getBub();if(e){var f=a.builder(e.getBox()).list.close[0];a.isNode(f)&&a.setStyle(f,"display","")}}a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);c&&c.type&&c.type=="publish"?d&&d.getBub().hide():h||d&&d.getBub().hide()};c.resetBubble=function(a){if(d){var c={fail:function(){d.bubble.setLayout(a,{offsetX:-29,offsetY:5})}};d.bubble.setAlignPos(a,b.nodeList.textEl,c)}};c.destroy=function(){b=null};return c}});
STK.register("lib.image.mUpload",function(a){var b=$CONFIG.jsPath+"home/static/swf/",c="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&data=1",d,e="";$CONFIG&&$CONFIG.uid&&(e=$CONFIG.uid||"");var f='<form node-type="form" action-type="form" id="pic_upload" name="pic_upload" target="upload_target" enctype="multipart/form-data" method="POST" action=""><input type="file" hidefoucs="true" node-type="fileBtn" name="pic1"/></form>',g={};return function(h,i){var j={},k={},l,m,n,o=a.lib.kit.extra.getFlashVersion()<10?!0:!1,p=function(){var d=a.core.dom.getSize(h);k=a.core.obj.parseParam({service:c,swf:b+"MultiFilesUpload.swf?version="+$CONFIG.version,exp_swf:b+"img/expressInstall.swf?version="+$CONFIG.version,h:d.height,w:d.width,version:"10.0.0",type:"*.png;*.jpg;*.gif;*.jpeg;",size:20971520,number:9,globalFun:"fcb_"+a.getUniqueKey(),callback:t,init:function(){},uploaded:function(){},uploading:function(){},error:function(){},extra:function(){}},i);k.id="swf_upbtn_"+a.getUniqueKey();k.channel=k.id+"_channel"},q={uploading:function(a){k.uploading({data:[{fid:a.fid,name:a.name}]})},uploaded:function(a){k.uploaded({data:{pid:a.pid},fid:a.fid})},error:function(a){var b="defaultErr",c="";if(a.code==9){b="singleError";c="A20001"}k.error({type:b,fid:a.fid,data:{sourceData:{code:c}}})}},r=function(){var b=a.getUniqueKey(),c=m.value;g[b]=a.lib.kit.extra.upload({type:"common",form:n,imgName:c,app:1001});q.uploading({fid:b,name:c});m.value="";a.custEvent.add(g[b],"uploadSucc",function(a,c){var d=c.pid;q.uploaded({fid:b,pid:c.pid})});a.custEvent.add(g[b],"uploadError",function(a,c){q.error({code:c.code,fid:b})})},s=function(){var b=a.C("div"),c=a.C("div");c.setAttribute("id",k.id);var d="position:absolute;left:0;top:0;display:block;overflow:hidden;background-color:#000;filter:alpha(opacity=0);-moz-opacity:0;opacity:0;";d+="width:"+k.w+"px;"+"height:"+k.h+"px;";b.style.cssText=d;h.appendChild(b);h.style.position="relative";var g={swfid:k.id,uploadAPIs:encodeURIComponent(k.service),maxFileSize:k.size,maxFileNum:k.number,jsHandler:"STK."+k.globalFun,channel:k.channel,areaInfo:"0-0-"+k.w+"-"+k.h,fExt:k.type,fExtDec:"éæ©å¾ç:*.jpg, *.jpeg, *.gif, *.png",uid:e},i={menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"opaque"};if(o){var j=a.builder(f).list;m=j.fileBtn[0];n=j.form[0];m.style.cssText="width:"+k.w+"px;"+"height:"+k.h+"px;";b.appendChild(n)}else{b.appendChild(c);a.lib.kit.extra.swfobject.embedSWF(k.swf,k.id,k.w,k.h,k.version,k.exp_swf,g,i,k.id,u)}},t=function(a,b,c){switch(c.type){case"flashInit":k.init(c);break;case"uploading":k.uploading(c);break;case"singleSuccess":k.uploaded(c);break;case"fileNumErr":return k.error(c);case"singleError":k.error(c);break;case"fileSizeErr":k.error(c);break;default:k.extra(c)}},u=function(a){l=a.ref},v=function(){o?a.core.evt.addEvent(m,"change",r):a.namespace()[k.globalFun]=t},w=function(){a.lib.image.watermark(function(b){var e=b,f="weibo.com/",g=window.$CONFIG,h=e.nickname!="0"||e.logo!="0"||e.domain!="0",i={marks:h?1:0};d=a.lib.kit.extra.merge({url:e.domain=="1"?f+(g&&g.watermark||g.domain):0,markpos:e.position||"",logo:e.logo||"",nick:e.nickname=="1"?encodeURIComponent("@"+(g&&g.nick)):0},i);c+="&"+a.jsonToQuery(d);p();s();v()})};w();var x=function(){return k.id},y=function(){return l},z=function(a){if(o){g[a]&&g[a].abort();m.value=""}else try{mUpload&&mUpload.getswf&&mUpload.getswf()&&mUpload.getswf().removeFileById&&mUpload.getswf().removeFileById(a)}catch(b){}},A=function(){delete a.namespace()[k.globalFun]};j.getId=x;j.destroy=A;j.getswf=y;j.removeFile=z;return j}});
STK.register("lib.kit.touch.cantouch",function(a){return STK.core.util.browser.IPAD});
STK.register("lib.image.multiimage.index",function(a){var b='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_pic" node-type="inner"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2" suda-data="key=tblog_new_image_upload&value=fast_upload"><a href="javascript:void(0);" class="W_btn_l" node-type="mUpload"><span class="btn_45px"><em class="W_ficon ficon_add_pic S_ficon">Ã</em>#L{åå¾/å¤å¾}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" node-type="inputCover" action-type="more" suda-data="key=tblog_new_image_upload&value=pin_upload"><span class="btn_45px"><em class="W_ficon ficon_puzzle S_ficon">Ã</em>#L{æ¼å¾}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="capture" suda-data="key=tblog_new_image_upload&value=screenshot_upload"><span class="btn_45px"><em class="W_ficon ficon_screenshot S_ficon">Ã</em>#L{æªå±}</span></a></li><li class="S_line2"><a href="javascript:void(0);" class="W_btn_l" action-type="uploadAblum" suda-data="key=tblog_new_image_upload&value=upload_albums"><span class="btn_45px"><em class="W_ficon ficon_upload_album S_ficon">Ã</em>#L{ä¼ è³ç¸å}</span></a></li></ul></div></div><div class="W_layer_arrow"><span class="W_arrow_bor" node-type="arrow"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div>',c,d,e;return function(f,g){var h={},i,j="weibo.com/",k=$CONFIG||{},l=a.lib.browser.plugin.screenCapture,m,n,o=a.lib.kit.extra.language,p=function(b){if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash({onHide:function(){c.startBoxClose()}});else{var d=function(d){var e=d.nickname!="0"||d.logo!="0"||d.domain!="0",f=$CONFIG&&$CONFIG.nick||"",g="http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&marks="+(e?"1":"0")+(d.logo=="1"?"&logo=1":"")+(d.nickname=="1"?"&nick="+(f?encodeURIComponent("@"+f):""):"")+(d.domain=="1"?"&url="+j+(k&&k.watermark||k.domain):"")+(d.position?"&markpos="+d.position:"")+"&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",h={id:b.id,pos:c.getPosition(),service:g,sucess:b.sucess,h:b.height,w:b.width,swf:b.swf,baseDir:b.baseDir||""};n=a.lib.image.imgUpload(h,{init:function(a,b){a.setPars()},close:function(a,b){setTimeout(function(){c.startBoxClose()},100)}});n.show()};a.lib.image.watermark(function(a){d(a)})}},q=function(b){c.startBoxClose();var b=b.pid||b,d=a.getUniqueKey();e.uploading({data:[{fid:d}]});e.uploaded({data:{pid:b},fid:d})},r={hideCapture:function(){m&&m.hide()},handleError:function(b){c.stopBoxClose();a.ui.alert(o(b.msg),{OK:function(){b.code==1&&window.location.reload();setTimeout(function(){c.startBoxClose()},0)}})},captureWindow:function(){a.preventDefault();if(!m){var b=function(){c.stopBoxClose()},d=function(){c.startBoxClose()};m=l.screenCapture({captureType:"pid",beforeUpload:r.beforeCaptureUpload,captureSuccess:q,captureError:r.handleError,beforeSupportTip:b,supportTipOk:d,beforeIeInstallTip:b,ieInstallTipOk:d,beforeInstallTip:b,installTipOk:d})}m.doit()},beforeCaptureUpload:function(){c.stopBoxClose()},captureSuccess:function(a){imgName=a.imgName;captureFlag=1;r.handleSucc(a)}},s={splice:function(){p({id:"photo_merge",swf:"SinaCollage.swf",width:528,height:470,sucess:function(a){q(a)}});c.hide()},face_sticker:function(){p({id:"photo_facesticker",swf:"FacePhoto.swf",width:568,height:478,baseDir:"facesticker",sucess:function(){}});c.hide()},uploadAblum:function(){window.open("http://photo.weibo.com/upload/weibo","","width=650, height=470, top=300, left=400")}},t=function(){function h(){c.stopBoxClose();c.getBox().style.marginLeft="-2000px"}c&&c.destroy();c=a.ui.bubble({template:o(b),clickBlankToHide:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",showWithSetWidth:!1});c.show().setArrow("top").setAlignPos(f,g.refer,g);var i=a.sizzle('a[node-type="mUpload"]',c.getBox());e=g.editor.getPreview();a.lib.image.mUpload(i[0],{w:194,h:45,uploading:e.uploading,uploaded:e.uploaded,error:e.error,extra:e.extra});a.custEvent.add(e,"loading",function(){h()});a.custEvent.add(e,"hide",function(){h()});d=a.delegatedEvent(c.getBox());d.add("more","click",s.splice);d.add("capture","click",r.captureWindow);d.add("uploadAblum","click",s.uploadAblum)},u=function(){t()};u();h.getPreview=function(){return e};h.hide=function(){c.hide()};h.getBub=function(){return c};h.destroy=function(){c.destroy();d.destroy();c=null};return h}});
STK.register("lib.publisher.widget.multiimage",function(a){return function(b){var c={},d,e,f,g,h=!1,i,j={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},k=function(a,c){var e=b.API.getImageLogType();b.API.addShortUrlLog(e);b.API.insertText(c.value);d.getBub().hide()},l=function(a,c){h=!0;b.API.addExtraInfo(c.pids);f=!0;if(c.pids=="")b.API.delWords(c.text);else{var d=b.API.getWords();d.length==0&&b.API.insertText(c.text)}},m=function(e){if(!f){a.core.evt.preventDefault();var g,k=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,k)?g=k:g=b.nodeList.more;var l=b.nodeList.textEl,m=j.restore();d=a.lib.image.multiimage.index(g,{refer:l,editor:b});i=b.getPreview();a.custEvent.add(i,"loading",function(){h=!0;f=!0});a.custEvent.add(b,"close",c.hide);a.custEvent.add(i,"hide",function(){h=!1;a.custEvent.remove(i,"hide",arguments.callee);a.custEvent.remove(i,"changeType");a.custEvent.remove(b,"close",c.hide);f=!1});if(!i.getNumInfo()&&m&&m!=""){f=!0;var n=m.split(" "),o=[];for(var p=0;n[p];p++)o.push({fid:a.getUniqueKey(),pid:n[p]});if(!o[0])return;i.uploading({data:o});for(var p=0;o[p];p++)i.uploaded({fid:o[p].fid,data:o[p]})}}};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",m);f&&f.pid&&m(f.pid)};c.show=m;c.hide=function(b,c){i&&i.hide();a.core.util.listener.fire("photo_merge_channel","closeEditor",[]);a.core.util.listener.fire("photo_editor_channel","closeEditor",[]);if(c&&c.type&&c.type=="publish"){d&&d.getBub().hide();f=!1}else d&&d.getBub().hide()};c.destroy=function(){d.destroy();b=null};return c}});
STK.register("conf.trans.media",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("parseVideo",{url:"/aj/mblog/video"});c("suggestMusic",{url:"/aj/mblog/music/suggest",requestMode:"jsonp"});c("searchMusic",{url:"http://music.weibo.com/t/port/ajax_search_music_song.php",method:"get",requestMode:"jsonp"});c("addMusic",{url:"/aj/mblog/music/submit",requestMode:"jsonp"});c("parseMusic",{url:"/aj/mblog/music/parse",requestMode:"jsonp"});c("favSongSearch",{url:"http://music.weibo.com/yueku/port/sina_t_getcollect.php",method:"get",requestMode:"jsonp"});c("getOutlinkInfo",{url:"http://api.weibo.com/widget/info.json",varkey:"callback",method:"get",requestMode:"jsonp"});c("tabLog",{url:"http://music.weibo.com/t/port/ajax_log_action.php",method:"get",requestMode:"jsonp"});c("videoThirdUrl",{url:"/aj/video/gettoken",method:"get"});return b});
STK.register("lib.connect.iframe",function(a){var b={},c={},d=function(c,d,e,f){try{var g=a.jsonToStr({cid:d,call:e,rs:f});b[c]&&b[c].contentWindow&&b[c].contentWindow.postMessage?b[c].contentWindow.postMessage(g,"*"):window.navigator["STK_IFRAME_CONNECT_"+c]&&window.navigator["STK_IFRAME_CONNECT_"+c](g)}catch(h){}},e=function(e){try{var f=a.strToJson(e.data);if(f.iid in c){a.custEvent.define(c[f.iid],[f.cmd]);a.custEvent.fire(c[f.iid],f.cmd,[b[f.iid],f.param,function(a,b){return d(f.iid,f.cid,a,b)}])}}catch(g){}};window.postMessage?a.addEvent(window,"message",e):window.navigator.STK_IFRAME_CONNECT_OUT=function(a){e({data:a})};return function(e){if(!e)return!1;e.contentWindow.name=e.name=e.name||"iframe_"+a.getUniqueKey();if(e.name in b){if(b[e.name]!=e)throw"iframe:"+e.name+" is existed! "}else{b[e.name]=e;c[e.name]={};e.src=e.getAttribute("_src");e.removeAttribute("_src");e.contentWindow.name=e.name}return{trigger:function(a,b){d(e.name,"_EVENT_",a,b)},on:function(b,d){a.custEvent.define(c[e.name],b);a.custEvent.add(c[e.name],b,d)},off:function(b,d){a.custEvent.remove(c[e.name],b,d)},destroy:function(){a.custEvent.undefine(c[e.name]);delete b[e.name];delete c[e.name]}}}});
STK.register("lib.media.publishVideoBubble",function(a){var b=a.lib.kit.extra.language,c=b("#L{è¯·è¾å¥è§é¢æ­æ¾é¡µå°å}"),d=b('<div class="W_layer W_layer_pop"><div class="content" node-type="inner"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_medias" node-type="layer_send_medias"><div node-type="switcher"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2"><a href="javascript:void(0);" action-type="switchTab" action-data="type=local" suda-data="key=tblog_home_edit&value=video_record" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_upload S_ficon">Ã</em>#L{æ¬å°è§é¢}</span></a></li><li class="S_line2"><a href="javascript:void(0);" action-type="switchTab" action-data="type=url"   suda-data="key=tblog_home_edit&value=share_tv" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_online_video S_ficon">Ã</em>#L{å¨çº¿è§é¢}</span></a></li></ul></div></div><div node-type="contenter" style="display:none;"><div node-type="url" style="display:none;"><div class="laMed_inp"><input node-type="videoInput" action-type="videoInput" type="text" class="W_input inp_video" value="'+c+'" style="color:#999" /><a href="javascript:void(0);" class="W_btn_a btn_30px" action-type="videoSubmit"><span class="btn_30px W_f14">#L{ç¡®å®}</span></a><p class="laMed_err S_error" style="display:none;" node-type="errorWord">#L{ä½ è¾å¥çé¾æ¥å°åæ æ³è¯å«}</p><p class="laMed_err" style="display:none;" node-type="optional"><a href="javascript:void(0);" action-type="cancel">#L{åæ¶æä½}</a> #L{æè}<a href="javascript:void(0);" action-type="normalLink">#L{ä½ä¸ºæ®éçé¾æ¥åå¸}</a></p></div><div class="laMed_con S_txt2">#L{ç®åå·²æ¯æ}<a target="_blank" class="S_link2" href="http://video.sina.com.cn">#L{æ°æµªæ­å®¢}</a>ã<a target="_blank" href="http://www.youku.com" class="S_link2">#L{ä¼é·ç½}</a>ã<a target="_blank" class="S_link2" href="http://www.tudou.com">#L{åè±ç½}</a>ã<a class="S_link2" target="_blank" href="http://www.ku6.com/">#L{é·6ç½}</a>ã<a class="S_link2" target="_blank" href="http://tv.sohu.com/">#L{æçè§é¢}</a>ã<a class="S_link2" target="_blank" href="http://www.56.com/">#L{56ç½}</a>ã<a class="S_link2" target="_blank" href="http://www.qiyi.com/">#L{å¥èºç½}</a>ã<a class="S_link2" target="_blank" href="http://www.ifeng.com/">#L{å¤å°ç½}</a>ã<a class="S_link2" target="_blank" href="http://www.yinyuetai.com/">#L{é³æ¦å°}</a>ã<a class="S_link2" target="_blank" href="http://www.letv.com/">#L{ä¹è§ç½}</a>#L{ç­è§é¢ç½ç«çè§é¢æ­æ¾é¡µé¾æ¥ã}</div></div>'+'<div node-type="local" style="display:none;">'+'<div class="WB_minitab">'+'<ul class="minitb_ul S_line1 S_bg1 clearfix tab3up">'+'<li node-type="switchLocal" action-type="switchLocal" action-data="entry=miaopai" class="minitb_item S_line1"><a href="javascript:void(0);" class="minitb_lk S_txt1" suda-data="key=mainpub_choosevideo&value=to_miaopai"><em class="miaopai"></em>#L{ä¸ä¼ è§é¢}</a><span class="cur_block"></span></li>'+'<li node-type="switchLocal" action-type="switchLocal" action-data="entry=tudou" class="minitb_item S_line1"><a href="javascript:void(0);" class="minitb_lk S_txt1" suda-data="key=mainpub_choosevideo&value=to_tudou"><em class="tudou"></em>#L{åè±}</a><span class="cur_block"></span></li>'+'<li node-type="switchLocal" action-type="switchLocal" action-data="entry=youku" class="minitb_item S_line1"><a href="javascript:void(0);" class="minitb_lk S_txt1" suda-data="key=mainpub_choosevideo&value=to_youku"><em class="youku"></em>#L{ä¼é·}</a><span class="cur_block"></span></li>'+"</ul>"+"</div>"+'<iframe node-type="localIframe" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no" allowtransparency="yes" style="width:408px;height:400px;border:0;" _src="about:blank"></iframe>'+"</div>"+"</div>"+"</div>"+'<div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div>"+"</div>"),e,f,g,h,i,j,k={},l=a.core.dom.getStyle,m=a.core.dom.setStyle,n=a.core.evt.addEvent,o=a.core.evt.removeEvent,p=a.core.evt.preventDefault,q=a.core.str.trim,r="http://weibo.com/aj/video/upload";k.getBub=function(){return g};var s=function(){var a=i.videoInput,b=q(a.value);b==""||b==c?a.value="":a.select()},t=function(){var a=i.videoInput,b=q(a.value);if(b==""||b==c){a.value=c;return!1}},u=function(){i.videoInput.value=c;y()},v=function(){var b=a.core.str.trim(i.videoInput.value);b!=j&&y()},w=function(){var b=q(i.videoInput.value);p();if(b!==""){j=b;a.conf.trans.media.getTrans("parseVideo",{onSuccess:function(b){var c=b.data.url+" ";a.custEvent.fire(k,"insert",{value:c});g.hide()},onError:function(a){x()}}).request({url:b})}},x=function(){i.errorWord.style.display="";i.optional.style.display=""},y=function(){i.errorWord.style.display="none";i.optional.style.display="none"},z=function(){var b=a.core.str.trim(i.videoInput.value);a.custEvent.fire(k,"insert",{value:b+" "});g.hide()},A=function(b){var c=b.data.type;i.switcher.style.display="none";i.contenter.style.display="";a.foreach({url:i.url,local:i.local},function(b,d){b.style.display=d===c?"":"none";if(d==="local"){g.stopBoxClose();a.addClassName(i.layer_send_medias,"layer_medias_youku");B({el:i.switchLocal[0],data:{entry:"miaopai"}})}})},B=function(b){a.foreach(i.switchLocal,function(c){if(c===b.el){a.addClassName(c,"current");a.addClassName(c.firstChild,"S_bg2")}else{a.removeClassName(c,"current");a.removeClassName(c.firstChild,"S_bg2")}});b.data.entry=="miaopai"?i.localIframe.src="http://video.weibo.com/upload":a.conf.trans.media.request("videoThirdUrl",{onSuccess:function(a){i.localIframe.src=a.data.url}},b.data)},C=function(){a.custEvent.define(k,["insert","hide","upload","rec"]);var b=a.core.evt.delegatedEvent(h);b.add("normalLink","click",z);b.add("videoSubmit","click",w);b.add("cancel","click",function(){u();g.hide()});b.add("uploadVideo","click",function(){a.custEvent.fire(k,"upload",{el:h,url:r,width:570,height:420})});b.add("switchTab","click",A);b.add("switchLocal","click",B);a.addEvent(i.videoInput,"keyup",v);a.addEvent(i.videoInput,"blur",t);a.addEvent(i.videoInput,"focus",s);g.on("hide",function(){g.i.trigger("close")});g.on("hidden",function(){try{a.custEvent.fire(k,"hide",{});g.startBoxClose();g.i.destroy();g.i=null;g&&g.destroy&&g.destroy()}catch(b){}g=null})};return function(b,c){if(!a.isNode(b))throw"common.bubble.video need el as first parameter!";if(!g){g=a.ui.bubble(d,{clickBlankToHide:!0,showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",showWithSetWidth:!1});i=g.getDomList(!0);h=g.getBox();C();g.show();g.setArrow("top").setAlignPos(b,c.refer,{offset:{left:-1,top:2}});g.i=a.lib.connect.iframe(i.localIframe);g.i.on("insertToPublisher",function(b,c,d){a.custEvent.fire(k,"insert",{value:d+" "})});g.i.on("setHeight",function(a,b,c){b.style.height=parseInt(c)+"px"});g.i.on("close",function(a,b,c){g.hide()})}return k}});
STK.register("lib.publisher.widget.video",function(a){return function(b){var c={},d,e,f,g,h=!1,i=function(c,d){var e=d.value,g=b.nodeList.textEl,h=g.value,i=e.length-2;if(h.indexOf(e)!=-1){var j=h.indexOf(e);a.lib.kit.extra.textareaUtils.setCursor(g,j+1,i)}else b.API.insertText(e,f);var k=b.API.getCurrentLogType();b.API.addShortUrlLog(k)},j=function(c,d){var e,f,g,h=b.API.getWords(),i=b.API.getExtra(),j={pid:i,publish:h};a.core.evt.preventDefault();f=a.core.json.jsonToQuery(j,!0);g=d.url+(f?"?"+f:"");e=a.core.dom.position(d.el);window.open(g,"","height=459,width=660,location=no,left="+e.l+",top="+e.t)},k=function(b,c){var d,e;a.core.evt.preventDefault();e=c.url;window.open(e,"","height=645,width=610,location=no, left=300, top=200")},l=function(){h=!1;d=a.lib.media.publishVideoBubble(g,{refer:b.nodeList.textEl});a.custEvent.add(d,"insert",i);a.custEvent.add(d,"upload",j);a.custEvent.add(d,"rec",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"insert",i);a.custEvent.remove(d,"upload",j);a.custEvent.remove(d,"rec",k);a.custEvent.remove(b,"close",c.hide)});f=b.API.getCurPos()},m=function(c){a.core.evt.preventDefault();if(!h){h=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,d)?g=d:g=b.nodeList.more;l(c)}};c.clear=function(){};c.show=m;c.hide=function(){d&&d.getBub().hide()};c.destroy=function(){c.hide();b=null};return c}});
STK.register("lib.kit.dom.children",function(a){return function(b){if(!a.core.dom.isNode(b))throw"Parameter must be an HTMLEelement!";var c=[];for(var d=0,e=b.childNodes.length;d<e;d++)b.childNodes[d].nodeType==1&&c.push(b.childNodes[d]);return c}});
STK.register("lib.face.destroyFlash",function(a){var b=a.core.util.browser,c=function(a){if(a){for(var b in a)typeof a[b]=="function"&&(a[b]=null);a.parentNode.removeChild(a)}};return function(d){if(!!a.isNode(d)&&d&&d.nodeName==="OBJECT")if(a.IE&&b.OS==="windows"){d.style.display="none";(function(){d.readyState===4?c(d):setTimeout(arguments.callee,10)})()}else d.parentNode.removeChild(d)}});
STK.register("lib.media.publishMusicBubble",function(a){var b=window.$CONFIG&&window.$CONFIG.version,c='<div class="layer_send_music" node-type="outer"><div node-type="inner"><div node-type="tabs"><div class="profile_tab S_line5"><ul class="pftb_ul layer_tab S_line1"><li class="pftb_itm S_line1"><a class="pftb_lk current S_line5 S_txt1 S_bg5" action-type="tab" node-type="tab1" href="javascript:void(0);">#L{æç´¢æ­æ²}</a></li><li class="pftb_itm S_line1"><a class="pftb_lk S_line5 S_txt1 S_bg1" action-type="tab" node-type="tab2" href="javascript:void(0);">#L{åæ¬¢çæ­}</a></li><li class="pftb_itm pftb_itm_lst S_line1"><a href="javascript:void(0);" class="pftb_lk S_line5 S_txt1 S_bg1" action-type="tab" node-type="tab3">#L{è¾å¥é³ä¹é¾æ¥}</a></li><span style="float:left" node-type="miniplayer"></span></p></div><div node-type="content"><div node-type="tab1-block" class="laMed_border" ><div class="laMed_inp"><input type="text" autocomplete="off" style="color: rgb(153, 153, 153);" value="#L{è¯·è¾å¥æ­æ²ãæ­æãä¸è¾å}" class="W_input inp_music" node-type="songInput"><a class="W_btn_b" href="javascript:void(0);" onclick="return false;" node-type="nameSearch"><span>#L{æç´¢}</span></a><div style="display:none" class="layer_menu_list" node-type="suggestLay"></div><p style="display: none;" node-type="searchError" class="laMed_err S_error">#L{æ±æ­ï¼æ²¡ææ¾å°å}"<span node-type="searchKey"></span>"#L{æå³çæ­æ²ï¼æ¢ä¸ªè¯åè¯ä¸ä¸}</p></div><div class="laMed_titS" node-type="searchRusult" style="display:none">#L{æç´¢ç»æ}ï¼</div><div class="laMed_mulist" node-type="songList" style="display:none"></div></div><div node-type="tab2-block" class="laMed_border" style="display:none"><div node-type="favRusult" class="laMed_titS" style="display:none">#L{ææ}<a class="W_fb" href="http://music.weibo.com/ting/?musicpublisher=1#like" target="_blank" node-type="favSongCount">199</a>#L{é¦åæ¬¢çæ­}<i>(å¨<a href="http://ting.weibo.com?musicpublisher=2" target="_blank">#L{å¾®åé³ä¹ç}</a>#L{æ è®°ä¸ºçº¢å¿})</i></div><div class="laMed_mulist" node-type="favSongList" style="display:none"></div><div class="W_pages_minibtn" node-type="favPagingBar" style="display:none"></div><p class="no_music" node-type="favNoSongs" style="display:none">#L{ä½ è¿æ²¡ææ è®°ä¸ºåæ¬¢çæ­ï¼å¿«å»} <a href="http://ting.weibo.com?musicpublisher=3" target="_blank">#L{å¾®åé³ä¹ç}</a> #L{å¬å¬}</p></div><div node-type="tab3-block" class="laMed_border" style="display:none"><div class="laMed_con S_txt2">#L{ç®åå·²æ¯æ}<a href="http://music.sina.com.cn/" target="_blank" class="S_link2">#L{æ°æµªä¹åº}</a>ã<a class="S_link2" href="http://www.kuwo.cn/" target="_blank">#L{é·æé³ä¹}</a>ã<a class="S_link2" href="http://www.songtaste.com/" target="_blank">#L{Songtaste}</a> #L{çæ­æ¾é¡µé¢é¾æ¥ï¼ä¹æ¯æMP3æ ¼å¼æ­æ²é¾æ¥ã}</div><div class="laMed_inp"><input action-type="inputAction" type="text" style="color: rgb(153, 153, 153);" node-type="linkInput" value="#L{è¯·è¾å¥MP3é¾æ¥ææ°æµªä¹åºåæ²æ­æ¾é¡µé¾æ¥}" class="W_input inp_music"><a class="W_btn_b" onclick="return false;" node-type="searchLink" href="javascript:void(0)"><span>#L{æç´¢}</span></a><p node-type="linkError" style="display: none;" class="laMed_err S_error">#L{æ²¡æè¯å«åºç¸åºçæ­æ²ä¿¡æ¯}</p><p node-type="linkOptional" style="display: none;" class="laMed_err"><a href="javascript:void(0)" action-type="normalLink">#L{ä½ä¸ºæ®éçé¾æ¥åå¸}</a>&nbsp;#L{æ}&nbsp;<a href="javascript:void(0)" action-type="closeLayer">#L{åæ¶æä½}</a></p></div><div class="laMed_titS" node-type="integrity" style="display:none">#L{ä¸ºäºæ´å¥½çåäº«é³ä¹ï¼è¯·è±ä¸ç¹æ¶é´å®åæ­æ²èµæ}</div><div class="laMed_muinfo" node-type="songInfo" style="display:none"></div></div></div></div></div></div>',d='<#et tname data><ul><#list data.music_list as list><li action-type="songItem" action-data="index=${list_index}" songKeyWord="${list.title}"><a onclick="return false" href="javascript:void(0);">${list.title}</a></li></#list></ul></#et>',e='<#et tname data><ol><li><span class="mu_song">#L{æ­æ²å}</span></li><li><span class="mu_songer">#L{æ­æå}</span></li><li><span class="mu_album">#L{ä¸è¾å}</span></li><li><span class="mu_play">#L{è¯å¬}</span></li></ol><ul><#list data.music_list as list><li artist="${list.artist}" title="${list.stitle}" mp3_url="${list.mp3_url}" ><div class="mu_name" action-type="song"><span class="mu_song" title="${list.title}"><span>${list.show_title}</span><em class="mu_icon_new" style="display:${list.isnew}"></em></span><span class="mu_songer" title="${list.artist}">${list.show_artist}</span><span class="mu_album" title="${list.album}">${list.show_album}</span></div><div class="W_ico16 icon_toplay" songUrl="${list.mp3_url}" action-type="player"><span></span></div></li></#list></ul></#et>',f='<table><tbody><tr><th><em class="S_spetxt">*</em>#L{æ­æ²å}</th><td><input type="text" value="" node-type="songName" class="W_input"></td></tr><tr><th>#L{æ¼å±è}</th><td><input type="text" value="" node-type="artist" class="W_input"></td></tr><tr class="laMed_err S_error"><th></th><td><span class="S_error" node-type="errorSongName" style="display:none"></span></td></tr><tr class="laMed_btn"><th></th><td><a href="javascript:void(0);" class="W_btn_b" action-type="addSong"><span>#L{æ·»å }</span></a></td></tr></tbody></table>',g='<#et tname data><ul><#list data.music_list as list><li artist="${list.artist}" title="${list.title}" mp3_url="${list.mp3_url}"><div class="mu_name" action-type="favsong">${list.title}</div><div class="W_ico16 icon_toplay" songUrl="${list.mp3_url}" action-type="player" ><span></span></div></li></#list></ul></#et>',h='<a action-type="favSongPage" action-data="num=#{number}" class="page S_bg1" href="javascript:;" onclick="return false;">#{label}</a>',i='<a action-data="num=#{number}" href="javascript:;" class="page S_txt1"  onclick="return false;">#{label}</a>',j='<a class="reverse" action-type="favPagPrev" href="javascript:;" onclick="return false;"></a>',k='<a class="next" action-type="favPagNext" href="javascript:;" onclick="return false;"></a>',l,m,n,o,p,q,r,s,t,u,v,w,x,y=-1,z,A,B,C=$CONFIG.jsPath,D=a.lib.kit.extra.language,E={songInput:D("#L{è¯·è¾å¥æ­æ²ãæ­æãä¸è¾å}"),linkInput:D("#L{è¯·è¾å¥MP3é¾æ¥ææ°æµªä¹åºåæ²æ­æ¾é¡µé¾æ¥}"),songError:D("#L{æ­æ²åä¸è½è¶è¿15ä¸ªæ±å­}"),artistError:D("#L{æ¼å±èä¸è½è¶è¿15ä¸ªæ±å­}"),interError:D("#L{æ¥å£éè¯¯}")},F={searchTab:{idx:0,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"search_click"});this.logstatus=!0}},favTab:{idx:1,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"collect_click"});this.logstatus=!0}},linkTab:{idx:2,logstatus:!1,logfn:function(){N.tabLog.request({coflag:500010,action:"link_click"});this.logstatus=!0}}},G={},H=a.conf.trans.media.getTrans,I=a.core.str.trim,J=a.core.util.easyTemplate,K=a.core.evt.preventDefault,L=function(){l=a.lib.kit.dom.parseDOM(a.core.dom.builder(D(c)).list);p=l.outer;n=a.ui.bubble();n.setArrow({style:"left:82px;"});U();a.custEvent.add(n,"hide",function(b){return function(){b.setArrow({style:"left:30px;"});a.custEvent.remove(b,"hide",arguments.callee);a.custEvent.fire(G,"hide",{});var c=a.sizzle("object,embed",l.miniplayer)[0];a.lib.face.destroyFlash(c);B=!1;s=null;x=null;window.origin_miniplayer_music=undefined}}(n));!F.searchTab.logstatus&&F.searchTab.logfn()},M={currentPage:0,maxShowPage:6,limit:10},N={suggestMusic:H("suggestMusic",{onSuccess:function(a){a.data&&O.rendSugg(a)}}),searchMusic:H("searchMusic",{onSuccess:function(a){O.rendList(a)},onError:function(){O.rendError()}}),parseMusic:H("parseMusic",{onSuccess:function(a){O.rendInfo(a)},onComplete:function(a){a.code!="100000"&&O.urlError(a)}}),addMusic:H("addMusic",{onSuccess:function(a){O.urlSucc(a)},onError:function(){var b=a.sizzle('[node-type="errorSongName"]',l.outer)[0];b.innerHTML=E.interError}}),favSongSearch:H("favSongSearch",{onSuccess:function(a){O.rendFavList(a)}}),getOutlinkInfo:function(a){return H("getOutlinkInfo",{onComplete:function(b){b.code=="1"&&O.listenOutLinkSong(a,b)}})},tabLog:H("tabLog")},O={rendSugg:function(b){var c=l.suggestLay,e,f=b.data;if(b.key==z&&f!==null){for(var g=0,h=f.music_list.length;g<h;g++)f.music_list[g].title=a.leftB(f.music_list[g].title,30);e=J(d,f);c.innerHTML=e;P.showSugg();l.suggestList=a.sizzle('[action-type="songItem"]',c)}},rendError:function(){var b=I(l.songInput.value);b=a.bLength(b)>25?a.leftB(b,25)+"...":b;P.clean();a.core.dom.insertHTML(l.searchKey,a.encodeHTML(b));a.setStyle(l.searchError,"display","");P.hideSugg()},rendList:function(b){var c=l.songList,d,f=b.data,g;P.clean();P.hideSugg();g=f.music_list;for(var h=0;h<g.length;h++){g[h].stitle=[g[h].title,g[h].artist,g[h].album].join("-");a.bLength(g[h].title)>13?g[h].show_title=[a.leftB(g[h].title,13),"..."].join(""):g[h].show_title=g[h].title;a.bLength(g[h].artist)>7?g[h].show_artist=[a.leftB(g[h].artist,7),"..."].join(""):g[h].show_artist=g[h].artist;a.bLength(g[h].album)>9?g[h].show_album=[a.leftB(g[h].album,9),"..."].join(""):g[h].show_album=g[h].album;a.bLength(g[h].stitle)>40&&(g[h].stitle=[a.leftB(g[h].stitle,40),"..."].join(""));g[h].isnew=g[h]["new"]?"":"none"}d=J(D(e),f).toString();c.innerHTML=d;a.setStyle(l.searchRusult,"display","");a.setStyle(l.songList,"display","");a.setStyle(c,"display","")},rendInfo:function(b){var c=a.core.dom.builder(D(f)),d=l.songInfo,e=c.list.artist[0],g=c.list.songName[0],h=b.data.artist?b.data.artist:"",i=b.data.title?b.data.title:"";d.innerHTML="";d.appendChild(c.box);g.value=i;e.value=h;Q.clean();a.setStyle(l.integrity,"display","");a.setStyle(d,"display","")},urlError:function(b){Q.clean();a.setStyle(l.linkError,"display","");a.setStyle(l.linkOptional,"display","")},urlSucc:function(b){var c=b.data.text;a.custEvent.fire(G,"insert",{value:c});Q.clean();n.hide()},favTabClick:function(a){if(a=="tab2"&&!B){B=!0;P.favSong(0)}a=="tab1"&&!F.searchTab.logstatus?F.searchTab.logfn():a=="tab2"&&!F.favTab.logstatus?F.favTab.logfn():a=="tab3"&&!F.linkTab.logstatus&&F.linkTab.logfn()},setFavPagingBar:function(b){function m(b,c){b.push("...");b.push(a.templet(h,{number:c-1,label:c}))}function g(b){b.push(a.templet(h,{number:0,label:1}));b.push("...")}function f(b,d,e){for(var f=d;f<e;f+=1)c==f?b.push(a.templet(i,{number:f,label:f+1})):b.push(a.templet(h,{number:f,label:f+1}))}var c=M.currentPage,d=l.favPagingBar,e=[];if(b<=M.maxShowPage+2)f(e,0,b);else if(M.currentPage<M.maxShowPage/2+1){f(e,0,M.maxShowPage);m(e,b)}else if(M.currentPage+(M.maxShowPage/2+1)>=b){g(e);f(e,b-M.maxShowPage,b)}else{g(e);f(e,M.currentPage-(M.maxShowPage/2-1),M.currentPage+(M.maxShowPage/2-1)+1);m(e,b)}if(b>1){e.unshift(a.templet(j));e.push(a.templet(k))}d.innerHTML=e.join("")},rendFavList:function(b){var c=l.favSongList,d=l.favSongCount,e,f=b.data,h,i,j;h=f.music_list;i=f.music_num;j=Math.ceil(i/M.limit);M.totalPage=j;if(h.length<1){a.setStyle(l.favNoSongs,"display","");a.setStyle(l.favSongList,"display","none");a.setStyle(l.favRusult,"display","none");a.setStyle(l.favPagingBar,"display","none")}else{for(var k=0;k<h.length;k++){h[k].title=[h[k].title,h[k].artist].join("-");a.bLength(h[k].title)>40&&(h[k].title=[a.leftB(h[k].title,40),"..."].join(""))}e=J(g,f);c.innerHTML=e;d.innerHTML=i;O.setFavPagingBar(j);a.setStyle(l.favSongList,"display","");a.setStyle(l.favRusult,"display","");a.setStyle(l.favPagingBar,"display","");a.setStyle(l.favNoSongs,"display","none");a.setStyle(c,"display","")}},listenOutLinkSong:function(a,b){x.setUrl(b.data[a].songurl)}},P={focus:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d==E.songInput||d===""?!1:!0;clearTimeout(v);e?I(l.suggestLay.innerHTML)!==""&&P.showSugg():c.value=""},blur:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d===""||d==E.songInput?!1:!0;e||(c.value=E.songInput);clearTimeout(v);v=setTimeout(P.hideSugg,1e3)},keyhandler:function(a){a.keyCode==13&&setTimeout(P.search,0);a.keyCode==27&&P.hideSugg()},setSuggestLayPos:function(){var b=a.lib.kit.dom.parseDOM(a.builder(n.getOuter()).list).layoutContent,c=a.core.dom.getSize(l.songInput),d=a.position(b),e=a.position(l.songInput),f=e.l-d.l,g=e.t-d.t+c.height-1;a.setStyle(l.suggestLay,"left",f+"px");a.setStyle(l.suggestLay,"top",g+"px")},showSugg:function(){y=-1;P.setSuggestLayPos();a.setStyle(l.suggestLay,"display","");a.custEvent.fire(A,"open",l.songInput);a.addEvent(document,"click",P.hideSugg)},hideSugg:function(b){var c=b?a.core.evt.fixEvent(b).target:null,d=l.suggestLay,e=l.songInput;if(c&&(c==e||a.core.dom.contains(d,c)))return!1;y>-1&&l.suggestList&&l.suggestList[y]&&a.removeClassName(l.suggestList[y],"cur");a.setStyle(d,"display","none");a.custEvent.fire(A,"close");a.removeEvent(document,"click",P.hideSugg)},goSugg:function(b){var c=l.songInput,d=I(c.value);clearTimeout(u);if(d!=E.songInput&&d!=r){if(d===""){P.hideSugg();return}l.suggestLay.innerHTML="";a.setStyle(l.suggestLay,"display","none");u=setTimeout(function(){z=a.core.util.getUniqueKey();N.suggestMusic.request({key:d,_k:z});r=d},200)}},searchChoose:function(a,b){var c=l.songInput,d,e;if(y>=0){d=l.suggestList[b];e=d.getAttribute("songkeyword");c.value=e;r=e}},search:function(){var a=l.songInput,b=I(a.value);if(b!==""&&b!=E.songInput){x&&x.songStop&&x.songStop();window.setTimeout(function(){N.searchMusic.request({key:b,isred:!1});t=b},0)}},clean:function(){var b=l.searchError,c=l.searchRusult,d=l.songList;r="";d.innerHTML="";l.searchKey.innerHTML="";a.setStyle(b,"display","none");a.setStyle(c,"display","none")},add:function(a){var b=a.el.parentNode,c=b.getAttribute("mp3_url"),d=b.getAttribute("title"),e=b.getAttribute("artist");K();N.addMusic.request({url:c,title:d,artist:e})},setIndex:function(b,c){var d;if(y>=0){d=l.suggestList[y]?l.suggestList[y]:null;d.parentNode&&d.parentNode.nodeType!=11&&a.removeClassName(d,"cur")}l.suggestList[c]&&a.addClassName(l.suggestList[c],"cur");y=c},controlSong:function(a){var b=a.el;w&&w!=b&&(w.className="W_ico16 icon_toplay");w=b;b.className!="W_loading"&&(b.className=="W_ico16 icon_toplay"?S.playSong(b):b.className=="W_ico16 icon_tostop"&&S.pauseSong())},addfavSong:function(b){var c=b.el.parentNode,d=c.getAttribute("mp3_url"),e=c.getAttribute("title"),f=c.getAttribute("artist");K();if(d.indexOf("http://t.cn")>=0){var g=e+"-"+d;a.custEvent.fire(G,"insert",{value:g});n.hide()}else N.addMusic.request({url:d,title:e,artist:f})},favSong:function(a){M.currentPage=Math.floor(a/M.limit);N.favSongSearch.request({start:a,limit:M.limit})},favSongPage:function(b){a.preventDefault(b.evt);P.favSong(b.data.num*M.limit)},favSongPrev:function(){a.preventDefault();if(!(M.currentPage<1)){M.currentPage--;P.favSong(M.currentPage*M.limit)}},favSongNext:function(){a.preventDefault();if(!(M.currentPage>=M.totalPage-1)){M.currentPage++;P.favSong(M.currentPage*M.limit)}},getOutlinkInfo:function(a){N.getOutlinkInfo(a).request({short_url:a,source:"872034675"})}},Q={focus:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d==E.linkInput||d===""?!1:!0;e||(c.value="");c.select()},blur:function(b){var c=a.fixEvent(b).target,d=I(c.value),e=d===""||d==E.linkInput?!1:!0;e||(c.value=E.linkInput)},clean:function(){a.setStyle(l.integrity,"display","none");a.setStyle(l.songInfo,"display","none");a.setStyle(l.linkError,"display","none");a.setStyle(l.linkOptional,"display","none")},addSong:function(){var b=I(a.sizzle('[node-type="songName"]',l.outer)[0].value),c=I(a.sizzle('[node-type="artist"]',l.outer)[0].value),d=I(l.linkInput.value),e=a.sizzle('[node-type="errorSongName"]',l.outer)[0];K();if(b===""){e.innerHTML=E.songInput;a.setStyle(e,"display","")}else{if(a.bLength(b)>30){e.innerHTML=E.songError;a.setStyle(e,"display","");return}if(a.bLength(c)>30){e.innerHTML=E.artistError;a.setStyle(e,"display","");return}N.addMusic.request({title:b,url:d,artist:c})}},search:function(){var a=I(l.linkInput.value);if(a!==""&&a!==E.linkInput){N.parseMusic.request({url:a});K()}},normal:function(){var b=I(l.linkInput.value);a.custEvent.fire(G,"insert",{value:b+" "});T.closeLayer()}},R=function(b,c){var d;if(c=="buffer"||c=="playing"){c=="playing"?d="W_ico16 icon_tostop":c=="buffer"&&(d="W_loading");a.core.dom.isNode(w)&&(w.className=d)}},S={init:function(){var c=l.miniplayer,d=a.getUniqueKey();window.origin_miniplayer_music=R;x=a.core.util.swf.create(c,C+"/home/static/swf/player/MiniPlayer.swf?version="+b,{id:d,flashvars:{statusListener:"origin_miniplayer_music"},paras:{quality:"high",allowScriptAccess:"always",wmode:"transparent",allowFullscreen:!0},attrs:{name:d}})},playSong:function(a){var b=a.getAttribute("songUrl");if(b==s)x.songPlay();else if(x&&x.setUrl){if(b.indexOf("http://t.cn/")>=0){var c=b.replace("http://t.cn/","");P.getOutlinkInfo(c)}else x.setUrl(b);s=b}},pauseSong:function(){w.className="W_ico16 icon_toplay";x.songStop()}},T={closeLayer:function(){n.hide()}},U=function(){var b=a.core.evt.delegatedEvent(l.outer);a.custEvent.define(G,"insert");a.custEvent.define(G,"hide");b.add("player","click",P.controlSong);b.add("addSong","click",Q.addSong);b.add("normalLink","click",Q.normal);b.add("closeLayer","click",T.closeLayer);b.add("song","click",P.add);b.add("favsong","click",P.addfavSong);b.add("favSongPage","click",P.favSongPage);b.add("favPagPrev","click",P.favSongPrev);b.add("favPagNext","click",P.favSongNext);a.addEvent(l.songInput,"focus",P.focus);a.addEvent(l.songInput,"blur",P.blur);a.addEvent(l.songInput,"keyup",P.goSugg);a.addEvent(l.songInput,"keydown",P.keyhandler);a.addEvent(l.nameSearch,"click",P.search);a.addEvent(l.linkInput,"focus",Q.focus);a.addEvent(l.linkInput,"blur",Q.blur);a.addEvent(l.searchLink,"click",Q.search);var c=a.ui.mod.tab({templete:l.outer,currentTab:"tab1"});a.custEvent.add(c,"tabIn",function(b,c){a.foreach(a.lib.kit.dom.children(l.content),function(a,b){a.style.display=a.getAttribute("node-type")==c+"-block"?"":"none"});O.favTabClick(c)});A=a.ui.mod.suggest({textNode:l.songInput,uiNode:l.suggestLay,actionType:"songItem",actionData:"index"});a.custEvent.add(A,"onIndexChange",P.setIndex);a.custEvent.add(A,"onSelect",P.searchChoose);setTimeout(S.init,100)};return function(b,c){L();if(!a.isNode(b))throw"common.bubble.music need el as first parameter!";n.setContent(p);n.setAlignPos(b,c.refer,{fail:function(){n.setLayout(b,{offsetX:-77,offsetY:5})}});n.show();G.hide=n.hide;return G}});
STK.register("lib.publisher.widget.music",function(a){return function(b){var c={},d,e,f,g,h=function(c,d){var e=d.value+" ",g=b.nodeList.textEl,h=g.value,i=e.length-2;if(h.indexOf(e)!=-1){var j=h.indexOf(e);a.lib.kit.extra.textareaUtils.setCursor(g,j+1,i)}else b.API.insertText(e,f);var k=b.API.getCurrentLogType();b.API.addShortUrlLog(k)},i=!1,j=function(e){i=!1;d=a.lib.media.publishMusicBubble(g,{refer:b.nodeList.textEl});a.custEvent.add(d,"insert",h);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"insert",h);a.custEvent.remove(b,"close",c.hide)});f=b.API.getCurPos()},k=function(c){a.core.evt.preventDefault();if(!i){i=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,d)?g=d:g=b.nodeList.more;j(c)}};c.clear=function(){};c.show=k;c.hide=function(){d&&d.hide()};c.destroy=function(){b=null};return c}});
STK.register("conf.trans.vote",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("add",{url:"/aj/vote/add",method:"post"});c("join",{url:"/aj/vote/join",method:"post"});return b});
STK.register("lib.kit.dom.parentElementBy",function(a){return function(a,b,c){if(!a||!b)throw new Error("ä¼ å¥çåæ°ä¸ºç©º");var d=0,e;a=a.parentNode;while(a&&a.parentNode){d++;e=c(a);if(e===!1)return!1;if(e===!0)return a;if(e===b)return null;a=a.parentNode;if(d>3e4)return!1}return null}});
STK.register("lib.kit.extra.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("lib.image.imgUploadCode",function(a){var b=a.lib.kit.extra.language,c={"-1":b("#L{æ²¡æç»å½}"),"-2":b("#L{æ²¡ææ¶å°PUTçæ°æ®}"),"-3":b("#L{æ²¡ææå®cbåæ°}"),"-4":b("#L{æ²¡æåç°æäº¤ä¸ä¼ æä»¶}"),"-5":b("#L{è¯¥appæ²¡æå¼æ¾å¾çä¸ä¼ æå¡}"),"-6":b("#L{SINAPROæuidéæ³}"),"-7":b("#L{åæ°så¼ä¸è¢«æ¯æ}"),"-8":b("#L{æ°æ®ä¸ä¼ å¤±è´¥}"),"-9":b("#L{æä»¶mimeç±»åä¸æ¯æ}"),"-10":b("#L{æä»¶å­èæ°è¶é}"),"-11":b("#L{å­å¨éè¯¯}")};return function(a){return c[a]}});
STK.register("lib.image.uploadLog",function(a){return function(){var b={},c=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.lib.kit.extra.merge({cl:d,rnd:(new Date).getTime(),uid:e?e.uid:0,referer:encodeURIComponent(location),tm:+(new Date),ip:"",t:0},b);f.ret=="none"&&(f.err="10003");f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)},d=function(b){var c=new Image,d=encodeURIComponent(navigator.userAgent),e=window.$CONFIG,f=a.lib.kit.extra.merge({rnd:(new Date).getTime(),uid:e?e.uid:0,cl:d,tm:+(new Date),ip:"",t:2,sz:0},b);f=a.core.json.jsonToQuery(f);f="http://stats.t.sinaimg.cn/do_not_delete/fc.html?"+f;c.setAttribute("src",f)};b.sendSucc=d;b.sendError=c;b.destroy=function(){};return b}});
STK.register("pl.setting.uploadPic",function(a){return function(b,c){var d={},e,f=a.core.evt.addEvent,g="weibo.com/",h="picupload.service.weibo.com",i=c,j={complete:function(b,c){a.log("complete",b,i);if(!b||b.ret<0)i.err?i.err(b):i.complete(b);else{var d=j.parseInfo(b);a.log("result",d,b,i);i.complete(d)}},parseInfo:function(b){var c=a.lib.kit.extra.imageURL(b.pid),d=[],e,f;return{url:c,pid:b.pid}}},k={upload:function(b,d){var e=d.value;if(a.core.str.trim(e)!==""){c.start&&c.start.call();a.core.io.ijax({url:"http://"+h+"/interface/pic_upload.php",form:b,abaurl:"http://"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",onComplete:j.complete,onTimeout:c.timeout,args:{marks:1,app:"miniblog",s:"rdxt"}})}}},l={},m={},n=function(){o();p();r();t();u()},o=function(){if(!b)throw"node is not defined"},p=function(){e=a.lib.kit.dom.parseDOM(a.core.dom.builder(b).list);if(!e.fileBtn)throw"[common.content.uploadPic]: nodes.fileBtn is not defined.";if(!e.form)throw"[common.content.uploadPic]: nodes.form is not defined."},q=function(){},r=function(){f(e.fileBtn,"change",function(){k.upload(e.form,e.fileBtn)})},s=function(){},t=function(){},u=function(){},v=function(){},w={};d.doUpload=k.upload;d.destroy=v;n();return d}});
STK.register("lib.vote.publishVoteBubble",function(a){var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.lib.kit.extra.shine,e=a.lib.image.uploadLog(),f,g=function(a,b,c,d,e){if(a>b)return"";var f=[];d||(d="");e||(e="");for(var g=a;g<=b;g++){var h=g;!c||(h=h<10?"0"+h:""+h);f.push('<option value="'+h+'">'+d+h+e+"</option>")}return f.join("")},h=function(a){var b=new Date,c;switch(a){case"Y":c=b.getFullYear();break;case"M":c=b.getMonth()+1;c<10&&(c="0"+c);break;case"D":c=b.getDate();c<10&&(c="0"+c);break;case"H":c=b.getHours();c<10&&(c="0"+c);break;case"I":c=b.getMinutes();c<10&&(c="0"+c);break;case"S":c=b.getSeconds();c<10&&(c="0"+c);break;default:c=b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate()+" "+b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()}return c},i=function(a){var b=a?new Date(a):new Date,c={year:b.getFullYear(),month:b.getMonth()+1,day:b.getDate()};c.month<10&&(c.month="0"+c.month);c.day<10&&(c.day="0"+c.day);return c.year+"-"+c.month+"-"+c.day},j=function(){var a=""+Math.random();return a.replace(/^0\./,"s_")},k={FRAME:'<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_vote" node-type="vote_switcher"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2"><a href="javascript:void(0);" action-type="switcher" action-data="type=0" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_vote_text S_ficon">Ã</em>#L{åèµ·æå­æç¥¨}</span></a></li><li class="S_line2"><a href="javascript:void(0);" action-type="switcher" action-data="type=1" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_vote_pic S_ficon">Ã</em>#L{åèµ·å¾çæç¥¨}</span></a></li></ul></div></div><div class="layer_vote" node-type="vote_content" style="display:none"><div class="title"><h5>#L{åå»ºæ é¢}ï¼</h5><p class="tips" node-type="titleTips"><span class="txt S_txt2">#L{æ é¢æå¤25å­}</span></p></div><div class="con"><input node-type="title" type="text" name="title" class="W_input"/></div><div class="title"><h5>#L{æç¥¨éé¡¹}ï¼</h5><p class="tips" node-type="itemsTips"><span class="txt S_txt2">#L{è³å°2é¡¹,æ¯é¡¹æå¤20å­}</span></p></div><div node-type="items"></div><div class="con"><a node-type="addItems" href="javascript:void(0);" class="addbox S_bg1 S_txt1"><em class="W_ficon ficon_add S_ficon">+</em>#L{æ·»å éé¡¹}</a></div><div class="chooseBox S_line2"><h5>#L{åé/å¤é}ï¼</h5><select  name="num" node-type="num"><option value="1">#L{åé}</option></select></div><div class="seniorBox S_line1"><h5><a node-type="advancedBtn" href="javascript:void(0);" class="S_txt1"><span class="txt">#L{é«çº§è®¾ç½®}</span> <em class="W_ficon ficon_arrow_down S_ficon">c</em></a></h5><div node-type="advanced"><div class="title">#L{æªæ­¢æ¶é´}ï¼<span class="date"><select node-type="deadline"><option value="1 week">#L{ä¸å¨}</option><option value="1 month">#L{ä¸ä¸ªæ}</option><option value=".5 year">#L{åå¹´}</option><option value="1 year">#L{ä¸å¹´}</option><option value="modify">#L{èªå®ä¹}</option></select></span><p style="display:none;" class="date" node-type="modify"><input name="date" type="text" node-type="date_select" class="date_select" readonly /><span class="date"><select name="hours">'+g(0,23,1)+'</select>#L{æ¶}</span><span class="date"><select name="minutes">'+g(0,59,1)+"</select>#L{å}</span></p>"+"</div>"+'<div class="title">#L{æç¥¨ç»æ}ï¼<span node-type="voteResult"><label class="W_label" for="vote_visibility_0"><input id="vote_visibility_0" value="0" type="radio" name="visibility" class="W_radio" checked="checked" /><span>#L{æç¥¨åå¯è§}</span></label><label class="W_label" for="vote_visibility_1"><input id="vote_visibility_1" value="1" type="radio" name="visibility" class="W_radio" /><span>#L{ä»»ä½äººå¯è§}</span></label></div>'+'<div class="title">#L{æç¥¨è¯´æ}ï¼</div>'+'<div class="seniorpic" node-type="desc">'+'<div class="W_input clearfix">'+'<div style="display:none" node-type="pictureArea">'+'<div node-type="pictureArea_pic" class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon">Ã</em><form node-type="pictureForm" id="vote_picture_upload" name="vote_picture_upload" target="upload_target" enctype="multipart/form-data" method="POST" action=""><span node-type="fileBtn"><input name="pic1" action-type="picuploadinput" type="file" style="width:100px;height:100px;position:absolute;bottom:0;right:0;opacity:0;filter:alpha(opacity=0);cursor:pointer;"></span></form></div>'+'<div node-type="pictureArea_pic" class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon">Ã</em><a href="javascript:void(0);" action-type="cancel" class="ico_delpic"></a></div>'+'<div node-type="pictureArea_pic" class="pic S_bg1"><img node-type="pic" height="50" width="50"><a href="javascript:void(0);" action-type="cancel" class="ico_delpic"></a></div>'+"</div>"+'<textarea node-type="info" class="input" onfocus="this.parentNode.className=\'W_input W_input_focus clearfix\'" onblur="this.parentNode.className=\'W_input clearfix\'"></textarea>'+"</div>"+"</div>"+"</div>"+"</div>"+'<div node-type="secodeArea" class="coding S_line2" style="display:none;">#L{éªè¯ç }'+'<input node-type="secode" type="text" class="W_input" name="secode">'+b('<img action-type="secodeImg" node-type="secodeImg" width="75" height="24" title="#L{çä¸æ¸ï¼æ¢ä¸ä¸ª}" alt="#L{çä¸æ¸ï¼æ¢ä¸ä¸ª}" />')+'<p node-type="secodeTips"></p>'+"</div>"+'<div class="W_layer_btn">'+'<a node-type="submitBtn" href="javascript:void(0);" class="W_btn_a">#L{åèµ·}</a>'+"</div>"+"</div>"+'<div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div>'+"</div></div>",ITEM:'<div node-type="vote_item" class="con"><div class="W_input"><span class="S_txt1" node-type="vote_item_index">#{NUMBER}</span><input class="input" onfocus="this.parentNode.className=\'W_input W_input_focus\'" onblur="this.parentNode.className=\'W_input\'" type="text" action-type="item"/><span action-type="removeItem" class="del S_line1"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a></span></div></div>',ITEM_PIC:'<div node-type="vote_item" class="option_pic clearfix"><div class="pic S_bg1"><em class="W_ficon ficon_add_pic S_ficon" node-type="pic_placeholder">Ã</em><em style="display:none;" class="W_ficon ficon_add_pic S_ficon" node-type="pic_loading">Ã</em><img node-type="pic" height="50" width="50" src="" style="display:none;"/><span style="visibility:hidden" node-type="ruTips">'+b("#L{éæ°ä¸ä¼ }")+'</span><form node-type="form" enctype="multipart/form-data" method="POST"><input name="pic1" style="width:100px;height:100px;position:absolute;bottom:0;right:0;opacity:0;filter:alpha(opacity=0);cursor:pointer;" node-type="fileBtn" type="file" /></form></div>'+'<div class="piccon">'+'<div class="W_input">'+'<span class="S_txt1" node-type="vote_item_index">#{NUMBER}</span>'+'<input class="input" type="text" action-type="item" onfocus="this.parentNode.className=\'W_input W_input_focus\'" onblur="this.parentNode.className=\'W_input\'"/><span action-type="removeItem" class="del S_line1"><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon">X</a></span>'+'</div><p class="S_spetxt" node-type="tips"></p>'+"</div>"+"</div>",ITEM_PIC_UPLOADING:$CONFIG.imgPath+"style/images/index/vote_img_loading.png",EDITOR:b("#L{æåèµ·äºä¸ä¸ªæç¥¨}ã#{TITLE}ãï¼#L{å°å} #{SHORTURL}"),ADVANCED:{PICUPLOADINPUT:'<input action-type="picuploadinput" type="file" name="pic1"/>',PICUPLOADTHUMBFRAME:'<div node-type="outer" class="W_layer"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div node-type="inner" class="content" style="padding:5px;"></div></td></tr></table><div class="arrow arrow_t"></div></div></div>',PICUPLOADTHUMBNAIL:'<img src="#{URL}"/>'},TITLE:{DEFAULT:b('<span class="txt S_txt2">#L{æ é¢æå¤25å­}</span>'),SUCCESS:b('<span class="txt S_txt2">#L{æ é¢æå¤25å­}</span>'),EMPTY:b('<span class="W_icon icon_rederrorS"></span><span class="txt S_txt2">#L{æ é¢ä¸è½ä¸ºç©º}</span>')},ITEMS:{DEFAULT:b('<span class="txt S_txt2">#L{è³å°2é¡¹,æ¯é¡¹æå¤20å­}</span>'),LESS:b('<span class="W_icon icon_rederrorS"></span><span class="txt S_txt2">#L{éé¡¹å¤ªå°å¦ï¼è³å°ä¸¤é¡¹å¦ã}</span>')},SUBMIT:{DEFAULT:b("#L{åèµ·åä¸å¯å é¤æä¿®æ¹éé¡¹}"),ERROR:"#{MESSAGE}",ING:b("#L{æ­£å¨æäº¤}"),SUCCESS:b("#L{æç¥¨åèµ·æå}")},SECODE:{DEFAULT:b('<em class="S_txt2">#L{è¯·è¾å¥éªè¯ç }</em>'),EMPTY:b('<span class="icon_del"></span><em class="S_spetxt">#L{éªè¯ç ä¸è½ä¸ºç©º}</em>'),ERROR:b('<span class="icon_del"></span><em class="S_spetxt">#L{éªè¯ç éè¯¯ï¼è¯·éæ°è¾å¥}</em>')},PICTUREUPLOAD:{ERRORSIZE:b("#L{è¯·ä¸ä¼ 5Mä»¥åçJPGãGIFãPNGå¾çã}")}},l={},m={},n,o,p,q,r,s={},t="1 week",u={},v=0,w=!1,x=!1,y=0,z=!1,A=null,B,C,D=!1,E,F=["normal","picture"],G,H={itemMin:5,itemMax:10,defaultItem:5,addItemStep:1,itemMaxLen:20,titleMaxLen:25,maintain:365,itemMinActive:2},I,J={init:function(){J.bind();K.init()},changeTab:function(a){var b=F[a.data.type|0];J.stopLsn();o.vote_switcher.style.display="none";o.vote_content.style.display="";z=!1;x=!1;w=!1;v=0;G=J[b]();J.resetTitle();J.resetDeadline();J.resetVoteResult();J.clearItems();J.itemsNum();J.hideCalendar();J.hideAdvanced();J.startLsn();switch(b){case 0:case"default":H.itemMax=20;K.enable();break;case 1:case"picture":H.itemMax=15;K.disable();break;default:H.itemMax=20;K.enable()}J.addItems(H.defaultItem);o.itemsTips.innerHTML="";o.titleTips.innerHTML="";o.secodeTips.innerHTML="";setTimeout(function(){o.title.focus()},0)},bind:function(){s.items=a.core.evt.delegatedEvent(o.items);s.secode=a.core.evt.delegatedEvent(o.secodeArea);s.switcher=a.core.evt.delegatedEvent(o.vote_switcher);s.items.add("removeItem","click",J.removeItem);s.items.add("item","click",function(){o.itemsTips.innerHTML=k.ITEMS.DEFAULT});s.secode.add("secodeImg","click",J.secodeReflush);s.switcher.add("switcher","click",J.changeTab);a.addEvent(o.addItems,"click",J.addItemStep);a.addEvent(o.advancedBtn,"click",J.toggleAdvanced);a.addEvent(o.deadline,"change",J.toggleDeadline);a.addEvent(o.date_select,"click",J.showCalendar);a.addEvent(o.submitBtn,"click",J.submit);a.addEvent(o.info,"click",J.showInfo);a.addEvent(o.info,"blur",J.hideInfo);a.addEvent(o.title,"keyup",J.getTitle);a.addEvent(o.secode,"keyup",J.getSecode)},startLsn:function(){m.flushNum=window.setInterval(J.itemsReflushStatus,500)},stopLsn:function(){for(var a in m)window.clearInterval(m[a])},getBub:function(){return q},hide:function(){a.custEvent.remove(l,"hide");q.hide()},show:function(){q.show()},itemsNum:function(){v=a.sizzle("[node-type=vote_item]",o.items).length},itemsReMark:function(){var b=a.sizzle("[node-type=vote_item_index]",o.items);for(var c=0;c<v;c++)b[c].innerHTML=c+1+"."},addItems:function(a){G.addItems(a);J.removeItemsBtn.autoToggle();J.addItemsBtn.autoToggle()},addItemStep:function(){J.addItems(H.addItemStep)},clearItems:function(){o.items.innerHTML=""},addItemsBtn:{show:function(){o.addItems.style.display=""},hide:function(){o.addItems.style.display="none"},autoToggle:function(){v<H.itemMax?J.addItemsBtn.show():J.addItemsBtn.hide()}},removeItem:function(a){setTimeout(function(){J.itemsNum();G.removeItem(a.el);J.itemsReMark();J.removeItemsBtn.autoToggle();J.addItemsBtn.autoToggle()},0)},removeItemsBtn:{get:function(){return a.sizzle("[action-type=removeItem]",o.items)},show:function(){var a=J.removeItemsBtn.get();if(a.length>0)for(var b in a)a[b].style.display=""},hide:function(){var a=J.removeItemsBtn.get();if(a.length>0)for(var b in a)a[b].style.display="none"},autoToggle:function(){v>H.itemMin?J.removeItemsBtn.show():J.removeItemsBtn.hide()}},getTitle:function(){var b=a.core.str.trim(o.title.value);if(b=="")o.titleTips.innerHTML=k.TITLE.DEFAULT;else{b.length>=H.titleMaxLen&&(b=b.slice(0,H.titleMaxLen));o.titleTips.innerHTML=k.TITLE.SUCCESS}o.title.value!=b&&(o.title.value=b);return b},resetTitle:function(){o.title.value="";J.getTitle()},itemsFormat:function(){var b=a.sizzle("input[action-type=item]",o.items);if(b&&b.length>0){var c;for(var d in b){c=b[d].value;c=a.core.str.trim(c).replace(/,/,"").slice(0,H.itemMaxLen);b[d].value!=c&&(b[d].value=c)}}},itemsReflushStatus:function(){J.itemsFormat();var a=G.getItemsData();if(y!=a.length){J.flushNum(a.length);y=a.length}},getItemsFormData:function(){J.itemsFormat();var a=G.getItemsFormData();return a},getVoteResult:function(){var b=a.sizzle("[name=visibility]",o.vote);for(var c in b)if(b[c].checked==!0)return b[c].value;return 0},resetVoteResult:function(){a.sizzle("[name=visibility]",o.vote)[0].checked=!0},getDeadline:function(){var b=o.deadline.value,c={};c.hh=h("H");c.mm=h("I");switch(b){case"1 week":c.date=i((Math.round(+(new Date)/1e3)+604800)*1e3);break;case"1 month":c.date=i((Math.round(+(new Date)/1e3)+2592e3)*1e3);break;case".5 year":c.date=i((Math.round(+(new Date)/1e3)+15724800)*1e3);break;case"1 year":c.date=i((Math.round(+(new Date)/1e3)+31536e3)*1e3);break;default:c.date=a.sizzle("[name=date]",o.modify)[0].value;c.hh=a.sizzle("[name=hours]",o.modify)[0].value;c.mm=a.sizzle("[name=minutes]",o.modify)[0].value}return c},getSecode:function(){var b=a.core.str.trim(o.secode.value);if(b==""){o.secodeTips.innerHTML=k.SECODE.DEFAULT;return!1}o.secodeTips.innerHTML="";return b},secodeReflush:function(){if(z){o.secodeArea.style.display="";o.secodeImg.src=A+"&ts="+(new Date).getTime();o.secodeTips.innerHTML=k.SECODE.DEFAULT;o.secode.value="";o.secode.focus()}else o.secodeArea.style.display="none"},flushNum:function(b){o.num.innerHTML="";var c;c=a.C("option");c.value="1";c.innerHTML="åé";o.num.appendChild(c);if(b>=2)for(var d=2;d<=b;d++){c=a.C("option");c.value=d;c.innerHTML="æå¤é "+d+" é¡¹";o.num.appendChild(c)}},showAdvanced:function(){var b=a.sizzle("em",o.advancedBtn)[0];b.innerHTML="d";a.core.dom.toggleClassName("ficon_arrow_up","ficon_arrow_down");o.advanced.style.display="";w=!0},hideAdvanced:function(){var b=a.sizzle("em",o.advancedBtn)[0];b.innerHTML="c";a.core.dom.toggleClassName("ficon_arrow_down","ficon_arrow_up");o.advanced.style.display="none";J.hideCalendar();w=!1},toggleAdvanced:function(){w?J.hideAdvanced():J.showAdvanced()},showCalendar:function(){E||(E=a.ui.calendar({start:u.startDate,end:u.endDate,currentDate:u.currentDate,callback:function(a,b){o.date_select.value=a;E.hide()}}));E.show(o.date_select)},hideCalendar:function(){E&&E.hide()},lastDeadline:function(){t!=o.deadline.value&&o.deadline.value!="modify"&&(t=o.deadline.value)},showDeadline:function(){u.startDate=i();u.endDate=i((Math.round(+(new Date)/1e3)+H.maintain*86400)*1e3);switch(t){case"1 week":u.currentDate=i((Math.round(+(new Date)/1e3)+604800)*1e3);break;case"1 month":u.currentDate=i((Math.round(+(new Date)/1e3)+2592e3)*1e3);break;case".5 year":u.currentDate=i((Math.round(+(new Date)/1e3)+15724800)*1e3);break;case"1 year":u.currentDate=i((Math.round(+(new Date)/1e3)+31536e3)*1e3);break;default:u.currentDate=i((Math.round(+(new Date)/1e3)+604800)*1e3)}o.date_select.value=u.currentDate;a.sizzle("[name=hours]",o.modify)[0].value=h("H");a.sizzle("[name=minutes]",o.modify)[0].value=h("I");o.modify.style.display=""},hideDeadline:function(){o.modify.style.display="none"},toggleDeadline:function(){J.lastDeadline();o.deadline.value=="modify"?J.showDeadline():J.hideDeadline()},resetDeadline:function(){J.hideDeadline();t="1 week";o.deadline.value=a.sizzle("option",o.deadline)[0].value},showInfo:function(){o.info.style.height="100px"},hideInfo:function(){o.info.value=a.core.str.trim(o.info.value);o.info.value==""&&(o.info.style.height="")},getFormData:function(){var b=!0,c=J.getDeadline(),e=J.getTitle();if(!e){o.titleTips.innerHTML=k.TITLE.EMPTY;if(b){a.core.util.scrollTo(o.titleTips,{step:10});o.title.focus();d(o.title)}b&=!1}var f=J.getItemsFormData();if(!f){o.itemsTips.innerHTML=k.ITEMS.LESS;b&&a.core.util.scrollTo(o.titleTips,{step:10});b&=!1}if(z){var g=J.getSecode();if(!g){o.secodeTips.innerHTML=k.SECODE.EMPTY;if(b){o.secode.focus();d(o.secode)}b&=!1}c.secode=g}if(!!b){c.title=e;c.items=f;c.vote_result=J.getVoteResult();c.num=o.num.value;c.pid=K.getPid();c.info=a.core.str.trim(o.info.value);c.poll_category=I;return c}},submit:function(){if(!x){x=!0;p=J.getFormData();if(!p){x=!1;return}a.addClassName(o.submitBtn,"W_btn_a_disable");o.submitBtn.innerHTML=b('<i class="W_loading"></i>#L{æäº¤ä¸­}');a.conf.trans.vote.request("add",{onComplete:J.handle},p)}},handle:function(e){a.removeClassName(o.submitBtn,"W_btn_a_disable");o.submitBtn.innerHTML=b("#L{åèµ·}");if(e.code=="100000")a.ui.tipAlert(k.SUBMIT.SUCCESS).beside(o.submitBtn).on("hide",function(){a.custEvent.fire(l,"insert",c(k.EDITOR,{TITLE:p.title,SHORTURL:e.data.short_url}));x=!1;J.hide()});else{if(e.code=="100024"){z=!0;A=e.data.url;x=!1}else if(e.code=="100025"){o.secodeTips.innerHTML=k.SECODE.ERROR;d(o.secode);x=!1}else if(e.code=="100026"){z=!1;a.ui.tipAlert(e.msg,{icon:"warnS"}).beside(o.submitBtn).on("hide",function(){x=!1})}else if(e.code=="100030"){o.itemsTips.innerHTML=c(k.SUBMIT.ERROR,{MESSAGE:e.msg});x=!1}else{a.lib.dialog.ioError(e.code,e);x=!1}J.secodeReflush()}}};J.normal=function(){return function(){I=0;var b={addItems:function(b){H.itemMax<=v+b&&(b=H.itemMax-v);if(b>0){for(var d=0;d<b;d++)o.items.appendChild(a.core.dom.builder(c(k.ITEM,{NUMBER:v++ +1+"."})).box.firstChild);setTimeout(function(){a.sizzle("input",o.items).pop().focus()},0)}},removeItem:function(b){a.core.dom.removeNode(a.core.dom.dir.parent(b,{expr:"[node-type=vote_item]"})[0]);v--},getItemsData:function(){var b=[],c=a.sizzle('input[action-type="item"]',o.items),d;for(var e in c){d=c[e].value;!!d&&b.push(d)}return b},getItemsFormData:function(){var a=b.getItemsData();return a.length>=H.itemMinActive?a.join(","):""},destroy:function(){}};return b}}();J.picture=function(){return function(){I=1;var b=0,d={addItems:function(d){H.itemMax<=v+d&&(d=H.itemMax-v);if(d>0){var e,f,g;for(var h=0;h<d;h++){e=a.core.dom.builder(c(k.ITEM_PIC,{NUMBER:v++ +1+"."}));f=e.box.firstChild;g=a.lib.kit.dom.parseDOM(e.list);o.items.appendChild(f);a.pl.setting.uploadPic(f,{start:function(c){return function(){c.pic_placeholder.style.display="none";c.pic.style.display="none";c.pic_loading.style.display="";c.pic.setAttribute("last",c.pic.getAttribute("src"));a.setStyle(c.ruTips,"visibility","hidden");b++}}(g),err:null,complete:function(c){return function(d){c.pic_placeholder.style.display="none";c.pic_loading.style.display="none";c.pic.style.display="";if(d.pid){c.pic.setAttribute("src",a.lib.kit.extra.imageURL(d.pid,{size:"square"}));c.pic.setAttribute("pid",d.pid);c.tips.innerHTML=""}else if(d.ret&&d.ret<0){c.pic.setAttribute("src",c.pic.getAttribute("last"));d.ret=="-4"||d.ret=="-9"||d.ret=="-10"?c.tips.innerHTML=k.PICTUREUPLOAD.ERRORSIZE:c.tips.innerHTML=a.lib.image.imgUploadCode(d.ret)}a.setStyle(c.ruTips,"visibility","visible");b--}}(g)})}setTimeout(function(){a.sizzle("input",o.items).pop().focus()},0)}},removeItem:function(b){a.core.dom.removeNode(a.core.dom.dir.parent(b,{expr:"[node-type=vote_item]"})[0]);v--},getItemsData:function(){var b=[],c=a.sizzle(".option_pic",o.items),d,e,f;for(var g in c){f={};e=a.sizzle('img[node-type="pic"]',c[g])[0].getAttribute("pid");d=a.sizzle('input[action-type="item"]',c[g])[0].value;e&&(f.pid=e);d&&(f.content=d);(e||d)&&(b=b.concat([f]))}return b},getItemsFormData:function(){var b=d.getItemsData();return b.length>=H.itemMinActive?a.core.json.jsonToStr(b):""},canBeClose:function(){b>0?q.stopBoxClose():q.startBoxClose()},destroy:function(){}};return d}}();var K={img:{},pictureInUploading:!1,init:function(){var b=a.sizzle("[node-type=pictureArea_pic]",o.pictureArea);o.pictureAreaItems={upload:b[0],uploading:b[1],uploaded:b[2]};K.bind()},enable:function(){K.show.upload();o.pictureArea.style.display="";o.desc.className="seniorpic"},disable:function(){o.pictureArea.style.display="none";K.stopUpload();K.hideAll();o.desc.className="seniortxt"},hideAll:function(){for(var a in o.pictureAreaItems)o.pictureAreaItems[a].style.display="none"},show:{upload:function(){K.img={};K.hideAll();o.pictureAreaItems.upload.style.display=""},uploading:function(){K.hideAll();o.pictureAreaItems.uploading.style.display=""},uploadfail:function(){K.hideAll();o.pictureAreaItems.upload.style.display=""},uploaded:function(){K.hideAll();o.pictureAreaItems.uploaded.style.display="";a.sizzle("img",o.pictureAreaItems.uploaded)[0].src=K.img.url}},startUpload:function(){K.pictureInUploading=!0;q.stopBoxClose();K.show.uploading()},upload:function(){if(!K.pictureInUploading){K.img.name=a.core.str.trim(a.sizzle("input",o.fileBtn)[0].value);if(K.img.name==="")return;var b=K.img.name.split("\\");b.length>1&&(K.img.name=b[b.length-1]);b=null;K.startUpload();f=new Date;a.core.io.ijax({url:"http://picupload.service.weibo.com/interface/pic_upload.php",form:a.E("vote_picture_upload"),abaurl:"http://"+document.domain+"/aj/static/upimgback.html?_wv=5",abakey:"cb",onComplete:K.uploadHandle,onTimeout:K.uploadHandle,args:{marks:1,app:"miniblog",s:"rdxt",nick:"@"+$CONFIG.nick,logo:1,url:"vote.weibo.com"}})}},uploadHandle:function(b){if(b&&b.ret&&b.ret>=0){K.uploadSuccess(b);var c=new Date-f;e.sendSucc({pids:b.pid,ret:b.ret,app:"1001",el:c,ct:"1"})}else{b&&b.ret&&b.ret<0&&(b.ret=="-4"||b.ret=="-9"||b.ret=="-10"?o.updateImageTips.innerHTML=k.PICTUREUPLOAD.ERRORSIZE:o.updateImageTips.innerHTML=a.lib.image.imgUploadCode(b.ret));b?e.sendError({ret:b.ret,app:"1001"}):e.sendError({ret:"none",app:"1001"});K.uploadFailed()}},stopUpload:function(){q.startBoxClose();a.removeEvent(a.sizzle("input",o.fileBtn)[0],"change",K.upload);o.fileBtn.innerHTML="";setTimeout(function(){o.fileBtn.innerHTML=k.ADVANCED.PICUPLOADINPUT;a.addEvent(a.sizzle("input",o.fileBtn)[0],"change",K.upload);K.pictureInUploading=!1},0)},uploadFailed:function(){K.stopUpload();K.show.uploadfail()},uploadSuccess:function(b){K.stopUpload();K.img.pid=b.pid;K.img.url=a.lib.kit.extra.imageURL(K.img.pid);K.show.uploaded()},getPid:function(){return K.img.pid?K.img.pid:""},viewThumbnail:function(b){if(!r){r=a.ui.mod.layer(k.ADVANCED.PICUPLOADTHUMBFRAME);o.vote.appendChild(r.getOuter())}var d=r.getOuter(),e=a.core.dom.position(o.picturePreview),f=a.core.dom.getSize(o.picturePreview);a.core.dom.setXY(d,{t:e.t+f.height+3,l:e.l-5});r.html(c(k.ADVANCED.PICUPLOADTHUMBNAIL,{URL:K.img.url}));r.show()},closeThumbnail:function(){r.hide()},bind:function(){s.pictureUploadfail=a.core.evt.delegatedEvent(o.pictureArea);s.pictureUploadfail.add("cancel","click",function(){K.stopUpload();K.show.upload()});a.addEvent(a.sizzle("input",o.fileBtn)[0],"change",K.upload);a.addEvent(o.picturePreview,"mouseover",K.viewThumbnail);a.addEvent(o.picturePreview,"mouseout",K.closeThumbnail)}},L=function(){E&&E.destroy&&E.destroy();J.stopLsn();l=null;J=null;K=null},M=function(){a.custEvent.define(l,"hide");a.custEvent.add(l,"hide",J.hide);q.on("hidden",function(){E&&E.hide&&E.hide();q&&q.destroy&&q.destroy()})};l.destroy=L;return function(b,c){var d=function(){H=a.parseParam(H,c);q=a.ui.bubble(k.FRAME,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0,showWithSetWidth:!1});n=q.getBox();o=q.getDomList(!0);M();J.init();q.show().setArrow("top").setAlignPos(b,c.refer);D=!0};d();l.layer=q;return l}});
STK.register("lib.publisher.widget.vote",function(a){return function(b){var c={},d,e,f=function(a,d){var e=b.API.getCurrentLogType();b.API.addShortUrlLog(e);b.API.insertText(d);c.hide()},g=!1,h=function(b,c){g=!1;d=a.lib.vote.publishVoteBubble(b,c);i()},i=function(){a.custEvent.define(d,"insert");a.custEvent.add(d,"insert",f);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d.layer,"hide",function(){a.custEvent.remove(d,"insert",f);a.custEvent.remove(b,"close",c.hide)})},j=function(){a.core.evt.preventDefault();if(!g){g=!0;var c,d=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,d)?c=d:c=b.nodeList.more;h(c,{itemMin:2,defaultItem:2,refer:b.nodeList.textEl})}};c.init=function(c,d,f){b=c;e=d;a.addEvent(b.nodeList[e],"click",j)};c.clear=function(){};c.show=j;c.hide=function(){a.custEvent.fire(d,"hide")};c.destroy=function(){b=null;a.custEvent.remove(d,"insert")};return c}});
STK.register("conf.trans.topic",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("getTopic",{url:"/aj/v6/mblog/trend"});return b});
STK.register("lib.topic.publishTopicBubble",function(a){var b=a.lib.kit.extra.language,c=b('<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_send_topic"><div class="layer_send_btn clearfix"><ul class="clearfix"><li class="S_line2 li_s3"><a href="javascript:void(0);" action-type="blank_topic" action-data="text=##L{å¨è¿éè¾å¥ä½ æ³è¦è¯´çè¯é¢}#" class="W_btn_l"><span class="btn_45px"><em class="W_ficon ficon_add_topic S_ficon">Ã</em>#L{æå¥è¯é¢}</span></a></li></ul></div><div class="topic_box"><div class="tit">#L{ç­é¨æ¨è}ï¼</div><ul class="topic_ul clearfix" node-type="topic_list"></ul></div></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>'),d,e,f,g,h,i={},j=function(){f=a.ui.bubble(c,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0});d=f.getDomList(!0);g=f.getBox();h=d.topic_list;n();var b=a.conf.trans.topic.request("getTopic",{onComplete:function(a,b){l(a.data)}},{})},k=function(){j();m.add();a.custEvent.add(f,"hidden",function(b){return function(){a.custEvent.remove(b,"hidden",arguments.callee);m.destroy();b&&b.destroy&&b.destroy()}}(f))},l=function(a){h.innerHTML=a},m={add:function(){a.custEvent.add(i,"hide",function(){f.hide()})},destroy:function(){a.custEvent.remove(i,"blank_topic");a.custEvent.remove(i,"hide");a.custEvent.remove(i,"insert")}},n=function(){a.custEvent.define(i,"blank_topic");a.custEvent.define(i,"insert");a.custEvent.define(i,"hide");var b=STK.core.evt.delegatedEvent(g);b.add("add_topic","click",function(b){a.preventDefault(b.evt);a.custEvent.fire(i,"insert",{value:b.data.text})});b.add("blank_topic","click",function(b){a.preventDefault(b.evt);a.custEvent.fire(i,"blank_topic",{value:b.data.text})})};i.getBub=function(){return f};return function(b,c){if(!a.isNode(b))throw"common.bubble.topic need el as first parameter!";k();f.show().setArrow("top").setAlignPos(b,c.refer);return i}});
STK.register("lib.publisher.widget.topic",function(a){return function(b){var c={},d,e,f=!1,g=a.lib.kit.extra.textareaUtils,h={text:"#å¨è¿éè¾å¥ä½ æ³è¦è¯´çè¯é¢#"},i=function(a,d){b.API.insertText(d.value);c.hide()},j=function(a,d){var e=d.value,f=b.nodeList.textEl,h=f.value,i=e.length;if(h.indexOf(e)!=-1){var j=h.indexOf(e);g.setCursor(f,j+1+i)}else{b.API.insertText(e+" ");var k=g.getCursorPos(f);g.setCursor(f,k)}c.hide();var l=b.API.getCurrentLogType();b.API.addShortUrlLog(l)},k=function(a,d){var e=g.getSelectedText(b.nodeList.textEl),f=e.length*1;if(f==0||h.text.indexOf(e)>-1)j(a,d);else{var i="#"+e+"#";g.replaceText(b.nodeList.textEl,i);c.hide()}},l=function(){a.custEvent.add(d,"insert",j);a.custEvent.add(d,"blank_topic",k);a.custEvent.add(b,"close",c.hide);a.custEvent.add(d,"hide",function(){a.custEvent.remove(d,"blank_topic");a.custEvent.remove(d,"hide",arguments.callee);a.custEvent.remove(d,"insert");a.custEvent.remove(b,"close")})},m=function(){a.core.evt.preventDefault();var c,e=a.fixEvent(a.getEvent()).target;a.contains(b.nodeList.widget,e)?c=e:c=b.nodeList.more;d=a.lib.topic.publishTopicBubble(c,{refer:b.nodeList.textEl});f||l()};c.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",m)};c.clear=function(){};c.show=m;c.hide=function(){d&&d.getBub().hide()};c.destroy=function(){b=null};return c}});
STK.register("widget.module.component",function(a){return function(){var b={};b.initParam=a.core.func.empty;b.initEvent=a.core.func.empty;b.destroyParam=a.core.func.empty;b.destroyEvent=a.core.func.empty;b.init=function(){b.initParam();b.initEvent()};b.destroy=function(){b.destroyEvent();b.destroyParam()};return b}});
STK.register("widget.parse",function(a){var b="http://js.t.sinajs.cn/t5/page/js/",c="STK.",d=["destroy","part_destroy","part_flush"],e=1,f=typeof $CONFIG=="undefined"?e:$CONFIG.version;return function(e,g){var h=a.widget.module.component(),i=a.core.obj.sup(h,["init","destroy"]),j={},k,l;h.handler={getMethod:function(b){b=b.split(".");var c,d=a.namespace();while(c=b.shift())if(!(d=d[c]))break;return d},extract:function(a){var b=h.handler.getMethod(a.ns);if(b){j[a.uniqueID]={info:a,entity:b(a)};j[a.uniqueID].entity.init()}},getDomInfo:function(b){return{dom:b,top:h.entity.dom,ns:b.getAttribute("component"),uniqueID:a.core.dom.uniqueID(b),data:a.queryToJson(b.getAttribute("component-data")||""),param:a.queryToJson(b.getAttribute("component-param")||"")}},loadComponent:function(b){var c=h.handler.getDomInfo(b),d=[{url:[k.baseURL,c.ns.replace(/\./g,"/"),".js?version=",f].join(""),NS:k.baseNS+c.ns}];a.core.io.require(d,h.handler.extract,c)}};h.accept={partDestroy:function(b,c){var d=c.dom;for(var e in j)if(a.contains(d,j[e].info.dom)){j[e].entity.destroy();delete j[e].info;delete j[e].entity;delete j[e]}},partFlush:function(b,c){a.foreach(a.sizzle("[component]",c.dom),h.handler.loadComponent)}};h.initParam=function(){h.entity={dom:e};l=a.custEvent.define(h.entity.dom,d);k=a.parseParam({baseURL:b,baseNS:c},g);j={}};h.destroyParam=function(){k=null;j=null};h.initEvent=function(){a.custEvent.add(l,"part_destroy",h.accept.partDestroy);a.custEvent.add(l,"part_flush",h.accept.partFlush)};h.destroyEvent=function(){a.custEvent.remove(l,"part_destroy",h.accept.partDestroy);a.custEvent.remove(l,"part_flush",h.accept.partFlush)};h.destroy=function(){for(var a in j){j[a].entity.destroy();delete j[a].info;delete j[a].entity;delete j[a]}i.destroy()};h.init=function(){i.init();a.foreach(a.sizzle("[component]",h.entity.dom),h.handler.loadComponent)};return h}});
STK.register("lib.sandbox.publishPluginBubble",function(a){var b={},c=a.lib.kit.extra.language,d='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_title"><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div node-type="inner"></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';return function(e){var f={},g=function(){e.insert(arguments[0],arguments[1]);i.remove(b.ishow)},h=1,i={add:function(a){if(!b[a.id]){b[a.id]={};b[a.id].box=i.build(a)}b.ishow=a.id;return b[a.id]},has:function(a){return b[a.id]},remove:function(c){if(b[c]){a.custEvent.remove(b[c].layer.getInner(),"bridge",g);try{b[c].wbml.destroy&&b[c].wbml.destroy()}catch(d){}try{b[c].iframe.destroy&&b[c].iframe.destroy()}catch(d){}b[c].box.destroy&&b[c].box.destroy();b[c].layer.destroy&&b[c].layer.destroy();var e=b[c].layer.getOuter();e.parentNode.removeChild(e);delete b[c]}},build:function(f){var i=a.ui.bubble(d,{showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast",clickBlankToHide:!0,showWithSetWidth:!1});h++;i.setContent(f.html).rebindClose();b[f.id].layer=i;var j=i.getDomList().inner;b[f.id].wbml=a.widget.parse(j);b[f.id].wbml.init();a.custEvent.define(j,"bridge");a.custEvent.add(j,"bridge",g);a.custEvent.once(i,"show",function(){setTimeout(function(){var d=a.builder(i.getBox()).list,g=d.iframe&&d.iframe[0],h;if(g){var j;(j=g.getAttribute("_src"))&&g.setAttribute("_src",j+(j.indexOf("?")>=0?"&":"?")+"skin="+$CONFIG.skin);b[f.id].iframe=h=a.lib.connect.iframe(g);h.on("insertIntoPublishTop",function(a,b,d,f){function g(a){return typeof a=="string"||a&&typeof a.substr=="function"}g(d)&&(d={text:d});e.insert("è¿ä¸ªå¼æ²¡æç¨",{text:d.text,tip:d.tip||c("#L{æ·»å æå}")})});h.on("setHeight",function(a,b,c,d){b.style.height=c+"px"});h.on("setWidth",function(a,b,c,d){b.style.width=c+"px"});h.on("close",function(a,b,c,d){i.hide();d("callback")});h.on("uiAlert",function(b,c,d,e){a.isArray(d)||(d=[d]);d[1]=d[1]||{};d[1].OK=function(){e("callback")};a.ui.alert.apply(window,d)});h.on("setTittle",function(b,c,d,e){var f=a.sizzle("div",i.getDomList().inner)[0]||null;f&&(f.innerHTML=d)});a.custEvent.add(i,"hide",function(){h.trigger("close")});a.custEvent.add(i,"show",function(){h.trigger("show")})}},10)});return i},destroy:function(){for(var a in b)i.remove(a)}};f.layers=b;f.add=i.add;f.remove=i.remove;f.destroy=i.destroy;return f}});
STK.register("lib.publisher.widget.plugin",function(a){var b=a.conf.trans.publisher;return function(c,d){d=a.parseParam({widget:c.nodeList.widget},d||{});var e={},f,g,h,i=!1,j={init:function(){f=a.delegatedEvent(d.widget);f.add("plugin","click",j.show)},show:function(b){c.API.setCurrentLogType(b.data.log);a.preventDefault();if(!i){i=!0;var d=a.fixEvent(a.getEvent()).target;a.contains(c.nodeList.widget,d)?h=d:h=c.nodeList.more;j.asynShow(b)}},asynShow:function(d){i=!1;g||(g=a.lib.sandbox.publishPluginBubble({insert:j.insert}));var e=function(){g.layers[f].layer.setArrow("top").show().setAlignPos(h,c.nodeList.textEl);setTimeout(function(){a.custEvent.add(c,"close",g.layers[f].layer.hide)},0)},f=d.data.type;g.layers[f]?e():b.request("interactive",{onSuccess:function(b){var c=a.lib.kit.extra.merge({html:b.data.html,id:f},d.data);g.add(c);e()},onError:function(b){a.lib.dialog.ioError(b.code,b)}},d.data)},insert:function(b,d){var e=c.API.getCurrentLogType();c.API.addShortUrlLog(e);c.API.insertText(d.text);a.ui.tip("lite",{msg:d.tip,type:"succ",timer:1e3})}};j.init();e.delegatedEvent=f;e.show=j.show;e.destroy=function(){f.destroy()};return e}});
STK.register("lib.publisher.widget.blog",function(a){return function(b,c){function k(c){var d="http://weibo.com/guide/article";c&&c.data&&c.data.extend&&(d=d+"?extend="+c.data.extend);f=a.ui.dialog({template:'<div style="width:662px;height:512px;position:absolute;z-index:9999;"><iframe allowtransparency="true" style="background:transparent" node-type="iframe" width="662" height="100%" frameborder="no" scrolling="no" _src="'+d+'"></iframe></div>'});var e=function(c){var d=b.nodeList.textEl.getAttribute("drafturl");d&&b.nodeList.textEl.value.indexOf(d)>-1?b.nodeList.textEl.value=b.nodeList.textEl.value.replace(d,c.text):b.API.insertText(i("#L{æåè¡¨äºæç« } ")+c.text+" ");b.nodeList.textEl.setAttribute("withdraft","true");b.nodeList.textEl.setAttribute("drafturl",c.text);a.ui.notice(c.tip).on("hide",function(){var c=0,d=setInterval(function(){c%2==1?a.addClassName(b.nodeList.textElDiv,"clicked"):a.removeClassName(b.nodeList.textElDiv,"clicked");if(c==9){clearInterval(d);c=0}c++},200)})};f.on("show",function(){setTimeout(function(){function d(c){var d=(a.winSize().height-512)/2,e=(a.winSize().width-662)/2;d=d>=0?d:0;if(c){d=0;e=0}b.style.marginTop=d+"px";b.style.marginLeft=e+"px"}var b=f.getOuter(),c=a.sizzle('[node-type="iframe"]',b)[0];h=a.lib.connect.iframe(c);h.on("insertIntoPublishTop",function(a,b,c,d){function g(a){return typeof a=="string"||a&&typeof a.substr=="function"}g(c)&&(c={text:c});f.hide();e({text:c.text,tip:c.tip||i("#L{æ·»å æå}")})});h.on("setHeight",function(a,b,c,d){b.style.height=c+"px"});h.on("setWidth",function(a,b,c,d){b.style.width=c+"px"});h.on("fullscreen",function(a,c,d,e){if(!d){document.body.style.overflowY="hidden";b.style.position="fixed";b.style.top="0";b.style.left="0";b.style.width="100%";b.style.height="100%";c.width="100%";c.height="100%";b.style.zIndex="9999"}else{document.body.style.overflowY="";b.style.position="absolute";c.width="662";c.height="512";b.style.width="662px";b.style.height="512px";f.setMiddle();b.style.zIndex="9999"}});h.on("close",function(a,b,c,d){f.hide();d("callback")});h.on("setTittle",function(b,c,d,e){var f=a.sizzle("div",layer.getDomList().inner)[0]||null;f&&(f.innerHTML=d)});f.on("hide",function(){document.body.style.overflowY=""})},10)});f.show().setMiddle()}var d={},e,f,g,h,i=a.lib.kit.extra.language,j=!0,l=function(b){a.core.evt.preventDefault();j?k(b):window.open("http://c.blog.sina.com.cn/cblog.php?from=weibo","newwindow","height=600, left=300,top=100,width=783, toolbar=no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no")};d.init=function(c,d,f){b=c;e=d;a.addEvent(c.nodeList[e],"click",l)};d.show=l;d.destroy=function(){b=null};return d}});
STK.register("conf.trans.image",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("recmodlayer",{url:"/aj/photo/recomlayer",method:"get"});c("waterfall",{url:"http://photo.weibo.com/page/waterfall",method:"get",varkey:"callback",requestMode:"jsonp"});c("recmodlayer_new",{url:"/aj/v6/photo/morepic",method:"get"});c("createTag",{url:"/aj/publishplug/bainian",method:"get"});c("showtip",{url:"/aj/bubble/checkshowbubble",method:"get"});c("hidetip",{url:"/aj/bubble/closebubble",method:"get"});c("followList",{url:"/aj/mblog/attention"});c("tagtopicList",{url:"/aj/photo/tag/recomtopic"});c("getTags",{url:"/aj/photo/tag/phototag"});c("viewTags",{url:"/aj/photo/tag/getphototag"});return b});
STK.register("lib.image.multiimage.taglist",function(a){var b='<div style="position:absolute;z-index:10000;" class="layer_menu_list" node-type="layer_outer"><ul node-type="suggestWrap"></ul></div>',c={"@":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" action-data="value=${list.screen_name}" value="${list.screen_name}" objid="1042:${list.uid}"><a href="javascript:;">${list.screen_name}<#if (list.remark)>(${list.remark})</#if></a></li><#if (list.count)><span>${list.count}</span></#if></#list></#et>',"#":'<#et temp data><li class="suggest_title">${data.title}</li><#list data.data as list><li action-type="item" suda-data="key=tblog_associate&value=list_${list_index+1}"action-data="value=${list.topic}" value="${list.topic}" objid="${list.object_id}"><a href="javascript:;">${list.topic}<#if (list.count)>(${list.count})</#if></a></li></#list></#et>'};return function(d,e){var f={},g,h,i,j=a.lib.kit.extra.language,k=a.conf.trans.image,l=0,m,n,o=a.parseParam({flag:"@"},e),p=d.value,q={"@":"followList","#":"tagtopicList"},r={"@":{normalTitle:j("#L{éæ©æµç§°æè½»æ²ç©ºæ ¼å®æè¾å¥}"),moreTitle:j("#L{éæ©æè¿@çäººæç´æ¥è¾å¥}"),noTilte:j("#L{è½»æ²ç©ºæ ¼å®æè¾å¥}"),tagTitle:j("#L{è¾å¥æ³è¦@çäººå¹¶åè½¦ç»æ}")},"#":{normalTitle:j("#L{æ³ç¨ä»ä¹è¯é¢ï¼}"),tagTitle:j("#L{è¾å¥æ³è¯´çè¯å¹¶åè½¦ç»æ}")}},s={rendHtml:function(b,d,e){d.title=r[b].tagTitle;var f=a.core.util.easyTemplate(c[b],d);return f},getList:function(){k.getTrans(q[o.flag],{onSuccess:function(b){var c=s.rendHtml(o.flag,b);a.custEvent.fire(i,"open",d);h.innerHTML=c}}).request({q:p});g.style.display="";s.setPos(g)},setPos:function(b){var c=a.position(d);b.style.top=c.t+30+"px";b.style.left=c.l-12+"px";b.style.display=""},checkValue:function(){if(a.trim(d.value)!=p){p=a.trim(d.value);s.getList()}}},t=function(){var c=a.core.dom.builder(b);g=c.list.layer_outer[0];document.body.appendChild(g);h=c.list.suggestWrap[0];i=a.ui.mod.suggest({textNode:d,uiNode:h,actionType:"item",actionData:"value"})},u={item:function(){},blur:function(){clearInterval(n);n=null;setTimeout(function(){a.custEvent.fire(i,"close")},200)},focus:function(){s.getList();!n&&(n=setInterval(function(){s.checkValue()},200))},enterkey:function(b){if(!!a.trim(d.value)){if(d.value.indexOf("#")>=0){a.ui.alert(j("#L{è¯·ä¸è¦åå»ºå¸¦æï¼çè¯é¢}"),{icon:"rederrorB"});return}a.custEvent.fire(f,"createTag",{content:d.value,flag:o.flag,tag_object_id:0});i&&i.hide&&i.hide();d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.preventDefault(b)}},change:function(){var a=30;o.flag=="#"&&(a=100);d.value!=STK.core.str.leftB(d.value,a)&&(d.value=STK.core.str.leftB(d.value,a))}},v=function(){d.focus()},w=function(){a.custEvent.define(f,["createTag"]);a.custEvent.add(i,"onIndexChange",function(b,c){m=a.sizzle("li[class!=suggest_title]",h);m&&m[0]&&a.core.dom.removeClassName(m[l],"cur");a.core.dom.addClassName(m[c],"cur");l=c});a.custEvent.add(i,"onSelect",function(b,c,e,h){if(c==-1)u.enterkey();else{l=0;if(m[0]){var i=m[c].getAttribute("value")+"",j=m[c].getAttribute("objid");d.value=i}else var i=d.value,j=0;d.value="";if(n){clearInterval(n);n=null}g.style.display="none";a.custEvent.fire(f,"createTag",{content:i,flag:o.flag,tag_object_id:j})}});a.custEvent.add(i,"onClose",function(){if(n){clearInterval(n);n=null}g.style.display="none"});a.addEvent(d,"focus",u.focus);a.addEvent(d,"blur",u.blur);a.addEvent(d,"keydown",u.change);a.core.evt.hotKey.add(d,["enter"],u.enterkey)},x=function(){t();w()};x();f.show=v;f.destroy=function(){a.removeEvent(d,"focus",u.focus);a.removeEvent(d,"blur",u.blur);a.core.evt.hotKey.remove(d,["enter"],u.enterkey);g.style.display="none";i&&i.destroy&&i.destroy()};return f}});
STK.register("lib.image.multiimage.multiAddTags",function(a){function l(c){function x(){}function w(a){n||(n=d);a.appendChild(n);return p}function v(){n&&a.removeNode(n);l.value="";m.value="";n=undefined;return p}function u(a){if(n){k(n,a);o=a}return p}function t(){r(f)}function s(){r(e)}function r(b){if(n){a.replaceNode(b,n);n=b;k(n,o);n.suggust&&n.suggust.show()}}function q(b,d){if(n){j("pub_pic_upload",{"@":"main_pub_adperson","#":"main_pub_adtopic"}[d.flag]);c(d.flag,d.content,d.tag_object_id,a.core.json.merge({},o));p.remove()}}var d=a.builder(b(i.add)).box.firstChild,e=a.builder(b(i.topic_editor)).box.firstChild,f=a.builder(b(i.user_editor)).box.firstChild,g=a.sizzle(".inner_call",d)[0],h=a.sizzle(".inner_topic",d)[0],l=a.sizzle("input",e)[0],m=a.sizzle("input",f)[0],n,o={left:0,top:0},p={};e.suggust=a.lib.image.multiimage.taglist(l,{flag:"#"});f.suggust=a.lib.image.multiimage.taglist(m,{flag:"@"});a.custEvent.add(e.suggust,"createTag",q);a.custEvent.add(f.suggust,"createTag",q);a.addEvent(g,"click",t);a.addEvent(h,"click",s);p.setPosition=u;p.remove=v;p.appendTo=w;p.destroy=x;return p}function k(a,b,c){var d=10,e=5,f=a.parentNode,g={width:f.offsetWidth,height:f.offsetHeight};b.left=Math.min(g.width,Math.max(0,b.left));b.top=Math.min(g.height,Math.max(0,b.top));c==="last"&&(c=a.forWard);c===undefined&&(c=b.left<g.width/2?"L":"R");switch(c){case"L":a.className=a.className.replace(/R/g,"L");a.style.top=b.top-d+"px";a.style.left=b.left-e+"px";break;case"R":a.className=a.className.replace(/L/g,"R");a.style.top=b.top-d+"px";a.style.left=b.left-a.offsetWidth+e+"px"}a.forWard=c}function j(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)}var b=a.lib.kit.extra.language,c=6,d=59,e="#L{ç¹å»å¾çæ·»å æ ç­¾ï¼è¿å¯æ·»å %sä¸ªæ ç­¾}",f='<#et data data><li node-type="pic" action-type="select_pic" pid="${data.pid}" suda-data="key=pub_pic_upload&value=main_pub_changethumb"><a href="javascript:void(0);"><img class="S_line2" width="50" height="50" src="${data.src}"></a></li></#et>',g='<i class="W_loading" style="margin-top: 142px;"></i>',h='<div class="W_layer W_layer_pop"><div class="content"><div class="W_layer_close"><a href="javascript:void(0);" action-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_add_tag"><div class="W_layer_con_tit"><h1 class="W_f14 W_fb">#L{æ·»å æ ç­¾ï¼}</h1><h2 class="clearfix"><span class="tit_txt W_fl" node-type="tip"></span><span class="W_fr"><a href="javascript:void(0);" suda-data="key=pub_pic_upload&value=main_pub_tagcomplete" action-type="ok" class="W_btn_a">#L{å®æ}</a></span></h2></div><div class="pic_choose_box clearfix" node-type="slider"><a href="javascript:void(0);" class="arrow_left_small arrow_dis S_bg2"  action-type="slider_prev" node-type="slider_prev" title="#L{ä¸ä¸é¡µ}"><i class="W_ficon ficon_arrow_left S_ficon">b</i></a><div class="stage_box"><ul class="choose_box clearfix" node-type="pic_list" style="-webkit-transition: margin-left .3s ease;-moz-transition: margin-left .3s ease;transition: margin-left .3s ease;"></ul></div><a href="javascript:void(0);" class="arrow_right_small S_bg1" action-type="slider_next" node-type="slider_next" title="#L{ä¸ä¸é¡µ}"><i class="W_ficon ficon_arrow_right S_ficon">a</i></a></div><div class="need_pic addtag_cur"><img/><div node-type="canvas" style="position:absolute;top:0;left:0;background:url(about:blank);"></div></div></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>',i={add:'<span class="tag_addpicL"><span class="inner"><a href="javascript:void(0);" class="inner_call" title="#L{æ·»å äººç©æ ç­¾}">#L{@è¿æ¯è°}</a><a href="javascript:void(0);" class="inner_topic" title="#L{æ·»å è¯é¢æ ç­¾}">#L{è¯´ç¹ä»ä¹}</a></span></span>',topic_editor:'<a href="javascript:void(0);" class="tag_editpicL tag_editTopicL"><span class="inner"><input type="text" placeholder="#L{è¯´ç¹ä»ä¹}"></span></a>',user_editor:'<a href="javascript:void(0);" class="tag_editpicL tag_editUserL"><span class="inner"><i class="codetag">@</i><input type="text" class="" placeholder="æ·»å äººç©æ ç­¾"></span></a>',topic_show:'<a href="javascript:void(0);" node-type="tag" class="tag_showpicL tag_showTopicL"><span class="inner"><em class="txt W_autocut">{content}</em><em class="W_ficon ficon_close S_ficon" action-type="delete_tag" title="#L{å³é­}">X</em></span></a>',user_show:'<a href="javascript:void(0);" node-type="tag" class="tag_showpicL tag_showUserL"><span class="inner"><i class="codetag">@</i><em class="txt W_autocut">{content}</em><em class="W_ficon ficon_close S_ficon" action-type="delete_tag" title="#L{å³é­}">X</em></span></a>'};return function(m,n){function G(){var b=o.getDomList().canvas;a.removeEvent(b,"mousedown",C);a.removeEvent(document,"mousemove",D);a.removeEvent(document,"mouseup",E)}function F(){j("pub_pic_upload","main_pub_cover");o.edited=!1;var b=o.getDomList().canvas;a.addEvent(b,"mousedown",C);a.addEvent(document,"mousemove",D);a.addEvent(document,"mouseup",E)}function E(){if(B){a.preventDefault(event);k(B.tag,B.tag.pos);B=undefined;j("pub_pic_upload","main_pub_move")}}function D(b){a.preventDefault(b);if(B){b=a.fixEvent(b);var c=b.pageX-B.startLeft,d=b.pageY-B.startTop;B.tag.pos.left=c;B.tag.pos.top=d;k(B.tag,B.tag.pos,"last");o.getDomList().canvas.setAttribute("changed","changed")}}function C(b){b=a.fixEvent(b);var c=b.target,d=o.getDomList().canvas;if(c===d&&q()){var e={};e.top=b.clientY-d.getBoundingClientRect().top+7;e.left=b.clientX-d.getBoundingClientRect().left+10;I.remove().appendTo(d).setPosition(e);B=undefined}else{var f;c.getAttribute("node-type")=="tag"?f=c:f=a.core.dom.dir.parent(c,{expr:"[node-type=tag]"})[0];if(f){I.remove();a.preventDefault(b);B={tag:f,startLeft:b.pageX-f.pos.left,startTop:b.pageY-f.pos.top}}else B=undefined}}function A(b){var c=a.core.dom.dir.parent(b.el,{expr:"[node-type=tag]"})[0];a.removeNode(c);o.getDomList().canvas.setAttribute("changed","changed")}function z(a){var b=Math.max(0,o.getDomList().pic_list.childNodes.length-c);x(b)}function y(a){x(0)}function x(a){var b=Math.max(0,o.getDomList().pic_list.childNodes.length-c);a=Math.max(0,Math.min(b,a));o.getDomList().pic_list.style.marginLeft=-d*a+"px";var e=o.getDomList().slider_prev,f=o.getDomList().slider_next;a==0?e.className="arrow_left_small arrow_dis S_bg2":e.className="arrow_left_small S_bg1";a==b?f.className="arrow_right_small arrow_dis S_bg2":f.className="arrow_right_small S_bg1";H=a}function w(b){t();var d=b.el,e=d.getAttribute("tags"),f=d.getAttribute("pid"),h=o.getDomList().canvas,i=0;a.foreach(d.parentNode.childNodes,function(b,c){if(d===b){i=c;a.addClassName(b.firstChild,"current")}else a.removeClassName(b.firstChild,"current")});i==H?x(H-1):i==H+c-1&&x(H+1);a.replaceNode(a.builder(g).box.firstChild,h.previousSibling);h.parentNode.style.height="300px";h.setAttribute("pid",f);h.removeAttribute("changed");I.remove();var j=new Image;j.onload=function(){h.innerHTML="";h.parentNode.style.height="";j.onload=null;a.replaceNode(j,h.previousSibling);j.removeAttribute("width");j.removeAttribute("height");h.removeAttribute("changed");setTimeout(function(){h.style.width=j.offsetWidth+"px";h.style.height=j.offsetHeight+"px";h.style.left=(h.parentNode.offsetWidth-j.offsetWidth)/2+"px";h.style.top=(h.parentNode.offsetHeight-j.offsetHeight)/2+"px";s(e);e==="[]"&&I.appendTo(h).setPosition({left:Math.max(0,j.offsetWidth/2-80),top:Math.max(0,j.offsetHeight/2-18)})})};j.src=a.lib.kit.extra.imageURL(f,{size:"bmiddle"})}function v(){t();var b={},c={};a.foreach(a.sizzle("[node-type=pic]",o.getDomList().pic_list),function(d){var e=a.strToJson(d.getAttribute("tags"));if(e.length){b[e[0].pid]=e;c[e[0].pid]=a.foreach(e,function(a){return{tag:a.content,tag_type:{"@":"user","#":"topic"}[a.flag],tag_object_id:a.object_id,pos:{x:a.x.toFixed(2),y:a.y.toFixed(2)}}})}});for(var d in c)break;if(d)a.conf.trans.image.request("getTags",{onSuccess:function(a){o.trigger("setTags",[a.data,b]);o.hide()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{photo_tag:encodeURIComponent(a.jsonToStr(c))});else{o.trigger("setTags",[{},b]);o.hide()}}function u(c){t();o.edited==!1?o.hide():a.ui.tipConfirm(b("#L{æ¯å¦ä¿å­ç¼è¾è¿çæ ç­¾ï¼}")).beside(c.el).ok(b("#L{ä¿å­}"),function(){v()}).cancel(b("#L{ä¸ä¿å­}"),function(){setTimeout(function(){o.hide()})})}function t(){var b=o.getDomList().canvas,c=o.getDomList().pic_list,d=b.getAttribute("pid"),e=b.getAttribute("changed");if(d&&e){o.edited=!0;var f=a.sizzle("[node-type=pic][pid="+d+"]",c)[0],g=[];a.foreach(a.sizzle("[node-type=tag]",b),function(a){g.push({pid:d,content:a.content,flag:a.flag,x:a.pos.left/a.parentNode.offsetWidth,y:a.pos.top/a.parentNode.offsetHeight,object_id:a.object_id})});f.setAttribute("tags",a.jsonToStr(g))}}function s(b){var c=o.getDomList().canvas;a.foreach(a.strToJson(b),function(a){p(a.flag,a.content,a.object_id,{left:c.offsetWidth*a.x,top:c.offsetHeight*a.y})});q()}function r(){var b;a.foreach(m,function(c){var d=o.getDomList().pic_list.appendChild(a.builder(a.core.util.easyTemplate(f,{pid:c.pid,src:a.lib.kit.extra.imageURL(c.pid,{size:"square"})}).toString()).list.pic[0]);d.setAttribute("tags",c.tags);c.pid===n&&(b=d)});b&&o.trigger(b,"click");m.length<2&&(o.getDomList().slider.style.display="none")}function q(){var c=o.getDomList().tip,d=o.getDomList().canvas,f=a.sizzle("[node-type=tag]",d).length,g=5-f;c.innerHTML=b(e,Math.max(0,g));return g>0}function p(c,d,e,f){var g={"@":"user_show","#":"topic_show"},h=o.getDomList().canvas,j=a.builder(b(i[g[c]].replace("{content}",a.encodeHTML(d)))).box.firstChild;h.appendChild(j);j.pos=f;j.content=d;j.flag=c;j.object_id=e;k(j,j.pos);o.getDomList().canvas.setAttribute("changed","changed");q()}m=a.strToJson(m);var o=a.ui.bubble(b(h),{showWithAni:!1,hideWithAni:!1}),B,H=0,I=l(p);o.on("select_pic","click",w);o.on("slider_prev","click",y);o.on("slider_next","click",z);o.on("delete_tag","click",A);o.on("ok","click",v);o.on("close","click",u);o.on("show",F);o.on("hide",G);r();return o}});
STK.register("lib.image.multiimage.dragRank",function(a){return function(b){var c=b.preList,d={},e=[],f=[],g={},h=!1,i,j,k,l,m,n=!1,o=!1,p={getTargets:function(b){var c=e;for(var d in c)if(a.contains(c[d],b)||b==c[d])return function(a){return{dom:e[a],index:a}}(d);return!1},getDrop:function(a){for(var b=0;e[b];b++){var c=f[b];if(a.pageX>c.l&&a.pageX<c.l+g.width&&a.pageY>c.t&&a.pageY<c.t+g.height){var d=a.pageX-c.l>g.width/2?!0:!1;return function(a){return{tar:e[a],left:d,index:a}}(b)}}return!1},getEffectTar:function(b){var c=a.C("ul");a.addClassName(c,"drag_pic_list");var d=b.cloneNode();d.innerHTML=b.innerHTML;a.addClassName(b,"move");c.appendChild(d);return c},insertArr:function(a,b,c){var d=[],e=a.length;if(b>c)for(var f=0;f<e;f++){f<c&&d.push(a[f]);if(f==c){d.push(a[b]);d.push(a[f])}f>c&&f!=b&&d.push(a[f])}else if(b<c)for(var f=0;f<e;f++)f<b?d[f]=a[f]:f<c?d[f]=a[f+1]:f==c?d[f]=a[b]:f>c&&(d[f]=a[f]);else d=a;return d}},q={mousedown:function(b){var b=a.fixEvent(b);if(!b.target||!b.target.getAttribute("action-type")){if(!n){s();n=!0}var c=p.getTargets(b.target);if(!c)return;document.body.style.cssText="-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;";document.body.setAttribute("onselectstart","return false;");h=c;j=a.position(h.dom);i={x:b.clientX,y:b.clientY};k=p.getEffectTar(h.dom);k.style.position="absolute";k.style.zIndex="9999";k.style.top=j.t;k.style.left=j.l;document.body.appendChild(k)}},mousemove:function(b){if(!!h){var b=a.fixEvent(b),c={x:b.clientX,y:b.clientY},d=j.l+c.x-i.x,f=j.t+c.y-i.y;d<l.l&&(d=l.l);d>l.l+m.width-g.width&&(d=l.l+m.width-g.width);f<l.t&&(f=l.t);f>l.t+m.height-g.height&&(f=l.t+m.height-g.height);k.style.left=d+"px";k.style.top=f+"px";var n=p.getDrop(b);if(n){if(n.tar==h.dom||n.index==h.index)return;n.index>h.index?a.insertAfter(h.dom,e[n.index]):a.insertBefore(h.dom,e[n.index]);e=p.insertArr(e,h.index,n.index);h.index=n.index}}},mouseup:function(b){if(!!h){var b=a.fixEvent(b);document.body.style.cssText="";document.body.removeAttribute("onselectstart","return false;");a.removeNode(k);a.removeClassName(h.dom,"move");h=!1;s();a.custEvent.fire(d,"setExtra",{});o||window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_new_image_upload","drag_pic")}}},r=function(){a.custEvent.define(d,["setExtra"]);a.addEvent(document.body,"mousedown",q.mousedown);a.addEvent(document.body,"mousemove",q.mousemove);a.addEvent(document.body,"mouseup",q.mouseup)},s=function(){e=a.sizzle("li",c);e.pop();if(!!e[0]){g=a.core.dom.getSize(e[0]);f=[];for(var d=0;e[d];d++)f.push(a.position(e[d]));l=a.position(b.box);m=a.core.dom.getSize(b.box)}},t=function(){s();r()};t();d.freshDom=s;d.destroy=function(){o=null;a.removeEvent(document.body,"mousedown",q.mousedown);a.removeEvent(document.body,"mousemove",q.mousemove);a.removeEvent(document.body,"mouseup",q.mouseup)};return d}});
STK.register("lib.image.multiimage.preview",function(a){var b=$CONFIG.imgPath,c='<#et loading data><span class="txt S_txt1"><img class="picloading" src="'+b+'style/images/common/loading.gif">${data.filename}</span>'+'<a href="javascript:;" action-type="deleteImg"  title="#L{å é¤}" class="ico_delpic"></a>'+"</#et>",d='<#et image data><li class="loading" node-type="${data.type}">'+c+"</li>"+"</#et>",e='<#et err data><span class="txt S_txt1">${data.text}</span><span class="txt2 S_txt1">${data.filename}</span><a href="javascript:;" title="#L{å é¤}" action-type="deleteImg" class="ico_delpic"></a></#et>',f='<#et retry data><span class="txt S_txt1">#L{ä¸ä¼ å¤±è´¥}<a class="W_btn_b" href="javascript:;" action-type="retryLoad" action-data="fid=${data.fid}"><span>#L{éä¼ }</span></a></span><a href="javascript:;" title="#L{å é¤}" action-type="deleteImg" class="ico_delpic"></a></#et>';return function(b,g){var h=a.lib.kit.extra.language,i=g.refer&&g.refer.getAttribute("phototag")==="false",j='<div class="layer_pic_list clearfix" node-type="box"><div class="W_layer_con_tit"><h1 class="W_f14 W_fb">#L{æ¬å°ä¸ä¼ }</h1><h2 class="clearfix"><span class="tit_txt W_fl" node-type="picsInfo"></span><span class="W_fr"><a href="javascript:void(0);" class="W_btn_a" action-type="addTag" node-type="title_addTag" suda-data="key=pub_pic_upload&value=main_pub_tag"><em class="W_ficon ficon_add S_ficon">+</em>#L{æ ç­¾}</a></span></h2></div><ul class="drag_pic_list clearfix" node-type="preList"><li class="add" node-type="uploadBtn"><a href="javascript:;" title="">+</a></li></ul>'+(i?"":'<div node-type="tagtip" class="layer_tips_version layer_tips_intro" style="display:none; left:-165px; top:56px;z-index:9999"><div class="layer_tips_bg"><a class="W_ico12 icon_close" action-type="hideTip" href="javascript:;"></a><div class="layer_tips_cont"><p>#L{æ°åè½ï¼é¼ æ ç§»å°å¾çä¸ç¹å»}<i class="ico_showtag"></i>#L{å°±è½ç»å¾çå æ ç­¾}</p></div><span class="arrow_right"></span></div></div>')+"</div>"+"",k='<#et image data><div style="background:url(${data.src}) center center;width:80px;height:80px;"></div><span class="picbg"></span><a action-type="editImg" href="javascript:;" class="ico_editpic"></a><a href="javascript:;" action-type="deleteImg" class="ico_delpic"></a>'+(i?"":'<span class="tag_v2"><a suda-data="key=pub_pic_upload&value=main_pub_tag" action-type="addTag" href="javascript:;" class="W_btn_d"><em class="W_ficon ficon_add">+</em>#L{æ ç­¾}</a></span>')+'<i style="display:none;" class="W_icon icon_taged_pic"></i>'+"</#et>",l=a.parseParam({templete:h(j)},g),m=9,n={},o,p,q,r,s,t,u,v={},w=!1,x=a.lib.image.uploadLog(),y={},z={},A,B={init:function(){E.setNumInfo()},uploading:function(b,c){a.custEvent.fire(n,"loading");(!q||!q.getState())&&H();var e=b.data,f={},g=e.length;for(var i=0;i<g;i++){var j=E.getFileName(e[i].name);v[e[i].fid]={name:j};f[e[i].fid]={name:j}}var k="";for(var l in f)k+=a.core.util.easyTemplate(h(d),{type:l,filename:f[l].name||""});var m=a.builder(k),o=a.lib.kit.dom.parseDOM(m.list);for(var i in o)v[i].imgnode=o[i];a.insertBefore(m.box,p.uploadBtn);E.setNumInfo();C()},uploaded:function(b){var c=a.lib.kit.extra.imageURL(b.data.pid,{size:"square"});v[b.fid].pid=b.data.pid;var d=a.C("img");d.onload=function(){d.onload=null;if(v[b.fid]){v[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(k),{src:c});a.removeClassName(v[b.fid].imgnode,"loading");a.addClassName(v[b.fid].imgnode,"pic")}};d.src=c;v[b.fid].imgnode.setAttribute("action-data",b.data.pid);E.setExtra();(function(){if(!w){var b=a.sizzle("li",p.preList);if(b[0]&&b[1]){a.addClassName(b[0],"first");function c(){a.removeClassName(b[0],"first");a.removeEvent(b[0],"mouseover",c)}a.addEvent(b[0],"mouseover",c);w=!0}}})()},error:function(b){if(b.type=="singleError"){b.data.sourceData&&b.data.sourceData.code=="A20001"?v[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{æä»¶æ ¼å¼éè¯¯}"),filename:v[b.fid].name||""}):v[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(f),{fid:b.fid});v[b.fid].imgnode.className="opt";v[b.fid].err=1;E.setNumInfo()}if(b.type=="fileNumErr")return E.getReFileNum();b.type=="fileSizeErr"&&setTimeout(function(){var c=b.data.sizeErrAry.length;for(var d=0;d<c;d++){var f=a.getUniqueKey();B.uploading({data:[{fid:f,name:b.data.sizeErrAry[d]||""}]});v[f].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{å¾çå¤§äº20M}"),filename:v[f].name||""});v[f].imgnode.className="opt";v[f].err=1}E.setNumInfo()},30);if(b.type=="defaultErr"){v[b.fid].imgnode.innerHTML=a.core.util.easyTemplate(h(e),{text:h("#L{ä¸ä¼ å¤±è´¥}"),filename:v[b.fid].name||""});v[b.fid].imgnode.className="opt";v[b.fid].err=1;E.setNumInfo()}},extra:function(a){a.type=="beclicked"&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_new_image_upload","fast_upload")}},C=function(){s||(s=a.lib.image.mUpload(p.uploadBtn,{h:80,w:80,number:E.getReFileNum(),init:B.init,uploading:B.uploading,uploaded:B.uploaded,error:B.error,extra:B.extra}))},D={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a)},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},E={getExtraInfo:function(a,b){var c=E.getImgNode(a);return c?c.getAttribute(b):null},getImgNode:function(a){if(a==document.body)return null;if(a.tagName.toLowerCase()=="li")return a;a=a.parentNode;return arguments.callee(a)},setExtra:function(){var b="";for(var c in v)if(v[c]&&!v[c].pid&&!v[c].err)return;var d=a.sizzle("li",p.preList);for(var e in d){var f=d[e].getAttribute("action-data");f&&(b+=f+" ")}D.store(b);a.custEvent.fire(n,"setExtra",{pids:b,text:h("#L{åäº«å¾ç}")});u&&u.freshDom();if(!u){u=a.lib.image.multiimage.dragRank(p);a.custEvent.add(u,"setExtra",E.setExtra)}},getNumInfo:function(){var a=0;for(var b in v)v[b]&&!v[b].err&&a++;return a},setNumInfo:function(){var b=E.getNumInfo();if(b<m){p.uploadBtn.style.cssText="";p.picsInfo.innerHTML=h("#L{å±%så¼ ï¼è¿è½ä¸ä¼ %så¼ }",'<em class="num_totla">'+b+"</em>",'<em class="num_remain">'+(m-b)+"</em>")}else{p.uploadBtn.style.cssText="margin-left:-10000px;";p.picsInfo.innerHTML=h('<em class="error_txt">#L{æå¤éæ©9å¼ å¾çä¸ä¼ }</em>')}b>0?a.removeClassName(p.title_addTag,"W_btn_a_disable"):a.addClassName(p.title_addTag,"W_btn_a_disable");try{s&&s.getswf()&&s.getswf().resetFileNum&&s.getswf().resetFileNum(m);s&&s.getswf()&&s.getswf().resetFileNum&&s.getswf().resetUploadedFileNum(E.getNumInfo())}catch(c){}},getReFileNum:function(){var a=E.getNumInfo();return m-a>0?m-a:0},getFileName:function(b,c){var b=b||"",c=c||8,d=b.length,e=b.replace(/\*/g," ").replace(/[^\x00-\xff]/g,"**"),f=e.slice(e.length-c-1,e.length).replace(/\*\*/g," ").replace(/\*/g,"").length;if(e.length>c&&c>0&&d-f-1>0){b=b.slice(d-f-1,d);b="..."+b}return a.encodeHTML(b)}},F={editImg:function(b){a.preventDefault();var c=E.getExtraInfo(b.el,"node-type"),d=E.getExtraInfo(b.el,"action-data"),e=function(a){B.uploaded({data:{pid:a},fid:c})};if(a.lib.kit.extra.getFlashVersion()<10)a.lib.kit.extra.installFlash();else{var f={id:"photo_editor",pos:q.getPosition(),service:"http://picupload.service.weibo.com/interface/pic_upload.php?app=miniblog&s=xml&cb=http://weibo.com/upimgback.html&rq=http%3A%2F%2Fphoto.i.weibo.com%2Fpic%2Fadd.php%3Fapp%3D1",sucess:e,h:385,w:528,swf:"PhotoEditor.swf"};a.lib.image.imgUpload(f,{init:function(b,c){b.setPars(a.lib.kit.extra.imageURL(d,{size:"large"}))},close:function(a,b){}}).show()}},deleteImg:function(b){var c=E.getImgNode(b.el),d=c.getAttribute("node-type"),e=c.getAttribute("action-data");v&&v[d]&&(v[d]=null);a.removeNode(c);s.removeFile(d);E.setExtra();E.setNumInfo();x.sendError({t:1,err:1008,app:1001});delete y[e];delete z[e];a.custEvent.fire(n,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)})},retryLoad:function(b){var d=b.data.fid;v[d].imgnode.innerHTML=a.core.util.easyTemplate(h(c),{filename:v[d].name||""});v[d].imgnode.className="loading";s&&s.getswf()&&s.getswf().reuploadById&&s.getswf().reuploadById(d)},close:function(){q.hide()},sendData:function(){x.sendError({t:1,err:1008,app:1001})},addTag:function(c){if(!a.core.dom.hasClassName(c.el,"W_btn_a_disable")){var d=a.core.dom.dir.parent(c.el,{expr:"li[action-data]"})[0],e=a.sizzle("li[action-data]",q.getBox());if(e.length==0)return;var f=d?d.getAttribute("action-data"):e[0].getAttribute("action-data"),i=a.foreach(e,function(a){var b=a.getAttribute("action-data"),c=a.getAttribute("tags")||"[]";return{pid:b,tags:c}});A=a.lib.image.multiimage.multiAddTags(a.jsonToStr(i),f);A.setArrow("top").show().setAlignPos(b,g.refer,g);A.on("setTags",function(b,c,d){a.foreach(e,function(b){var e=b.getAttribute("action-data");z=d;y=c;var f=z[e];if(f){b.setAttribute("tags",a.jsonToStr(f));a.sizzle("[action-type=addTag]",b)[0].innerHTML=h('<i class="icon_imgtag"></i>#L{ç¼è¾}');a.sizzle(".W_icon.icon_taged_pic",b)[0].style.display=""}else{b.removeAttribute("tags");a.sizzle("[action-type=addTag]",b)[0].innerHTML=h('<em class="W_ficon ficon_add">+</em>#L{æ ç­¾}');a.sizzle(".W_icon.icon_taged_pic",b)[0].style.display="none"}});a.custEvent.fire(n,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)})});F.hideTip()}},hideTip:function(){p.tagtip.style.display="none";a.conf.trans.image.getTrans("hidetip",{onSuccess:function(){p.tagtip.style.display="none"},onError:function(){}}).request({bid:55})}},G=function(){r.add("editImg","click",F.editImg);r.add("deleteImg","click",F.deleteImg);r.add("retryLoad","click",F.retryLoad);r.add("addTag","click",F.addTag);r.add("hideTip","click",F.hideTip);a.addEvent(t,"click",F.sendData);a.custEvent.define(n,["setTags","setExtra","hide","insert","deletePIC","picLoad","loading"])},H=function(){if(q)q.setArrow("top").setAlignPos(b,g.refer,g);else{q=a.ui.bubble({showWithAni:null,hideWithAni:null});q.setContent(p.box);q.setArrow("top").setAlignPos(b,g.refer,g);t=q.getDomList().close;q.on("hide",function(){for(var b in v)try{v[b]&&v[b].imgnode&&a.removeNode(v[b].imgnode);s.removeFile(b);v[b]=null}catch(c){}y={};z={};a.custEvent.fire(n,"setTags",{tags:a.jsonToStr(y),taginfos:a.jsonToStr(z)});v={};E.setExtra();a.custEvent.fire(n,"hide",{});u&&u.destroy();u=null})}},I=function(){o=a.core.dom.builder(l.templete);p=a.lib.kit.dom.parseDOM(o.list);r=a.core.evt.delegatedEvent(p.box)},J=function(){q&&q.setAlignPos(b,g.refer,g)},K=function(){q.show()},L=function(){q.startBoxClose();q.hide()},M=function(){I();G()},N=function(){},O=function(){},P=function(){var a=E.getNumInfo();return a<m?!1:!0},Q=function(a){return p[a]||null};M();var R=function(){q.hide();q.destroy&&q.destroy();r.destroy();a.removeEvent(t,"click",F.sendData);v=null;q=null;u&&u.destroy&&u.destroy();u=null;A&&A.destroy&&A.destroy()};n.destroy=R;n.uploading=B.uploading;n.uploaded=B.uploaded;n.error=B.error;n.extra=B.extra;n.show=K;n.hide=L;n.isOutstanding=P;n.getNumInfo=E.getNumInfo;n.getDomList=Q;return n}});
STK.register("lib.publisher.widget.imgPreview",function(a){return function(b){var c,d={},e={restore:function(){var a=STK.core.util.storage.get("editor_multiimage"+$CONFIG.uid);return a!="null"&&a!=null&&a.length!=0?a:!1},store:function(a){STK.core.util.storage.set("editor_multiimage"+$CONFIG.uid,a||"")},delWord:function(){STK.core.util.storage.del("editor_multiimage"+$CONFIG.uid)}},f=function(a,c){var d=b.API.getImageLogType();b.API.addShortUrlLog(d);b.API.insertText(c.value);image.getBub().hide()},g=function(a,c){b.API.addExtraInfo(c.pids);e.store(c.pids);if(c.pids=="")b.API.delWords(c.text);else{var d=b.API.getWords();d.length==0&&b.API.insertText(c.text)}},h=function(a,c){if(c.tags=="{}"){b.nodeList.textEl.removeAttribute("tags");b.nodeList.textEl.removeAttribute("taginfos")}else{b.nodeList.textEl.setAttribute("tags",encodeURIComponent(c.tags));b.nodeList.textEl.setAttribute("taginfos",encodeURIComponent(c.taginfos))}},i=function(){var d=a.sizzle('a[action-type="multiimage"]',b.nodeList.widget);if(!!d[0]){var e=b.nodeList.textEl;c=a.lib.image.multiimage.preview(d[0],{refer:e});j();b.getPreview=function(){return c}}},j=function(){a.custEvent.add(c,"setExtra",g);a.custEvent.add(c,"insert",f);a.custEvent.add(c,"setTags",h)};i();var k=function(){if(c){a.custEvent.remove(c,"setExtra",g);a.custEvent.remove(c,"insert",f);c.destroy()}};d.destroy=k;return d}});
STK.register("lib.publisher.widget.timing",function(a){return function(b){if(!!b.nodeList.settime){var c={},d=a.delegatedEvent(b.nodeList.settime),e,f=function(a){if(!a||!a.getTime)a=new Date;var b={year:a.getFullYear(),mouth:a.getMonth()+1,date:a.getDate(),hours:a.getHours(),minutes:a.getMinutes(),seconds:a.getSeconds()};b.ymd=b.year+"-"+b.mouth+"-"+b.date;return b},g={settime_date:function(c){var d=(c.data.end||"").split(" ")[0],g=(c.data.start||"").split(" ")[0];!e&&(e=a.ui.calendar({start:g||f().ymd,end:d,callback:function(a){b.nodeList.settime_data.value=a;e.hide()}}));e.show(c.el,{pos:"bottom-left",appendTo:document.body,offsetX:1,offsetY:1})},settime_hour:function(){},settime_min:function(){}},h=function(){d.add("settime_data","click",g.settime_date)},i=function(){h()};i();var j=function(){d.destroy()};c.destroy=j;return c}}});
STK.register("lib.publisher.widget.widgetloader",function(a){var b=a.lib.publisher.widget;return function(c,d){d=a.parseParam({widget:c.nodeList.widget,devent:""},d||{});var e={},f,g,h,i={list:["face","image","multiimage","video","music","vote","topic","blog"],entity:{},widgetList:{},func:function(a){return function(d){d.data.isimage?c.API.setImageLogType(d.data.log):c.API.setCurrentLogType(d.data.log);i.widgetList[a]||(i.widgetList[a]=b[a](c));i.widgetList[a].show(d)}}},j={init:function(){j.bind()},bind:function(){a.custEvent.define(c,"close");f=d.devent?d.devent:a.delegatedEvent(d.widget);for(var e=0,j=i.list.length;e<j;e++){var k=i.list[e];i.entity[k]=i.func(k);f.add(k,"click",i.entity[k])}g=b.plugin(c,d);h=b.imgPreview(c);timing=b.timing(c)},close:function(){a.custEvent.fire(c,"close",{type:"publish"})},destroy:function(){for(var a=0,b=i.list.length;a<b;a++){var c=i.list[a];f.remove(c,"click",i.entity[c])}for(var d in i.widgetList)i.widgetList[d].destroy&&i.widgetList[d].destroy();g.destroy();h.destroy()}};j.init();e.close=j.close;e.destroy=j.destroy;return e}});
STK.register("lib.editor.plugin.morePlugin",function(a){var b=a.lib.kit.extra.language;return function(b){var c={},d,e,f,g,h=!1,i={number:4,defNumber:2},j={list:[],data:{},add:function(a){var b=a.type;j.data[b]=a},destroy:function(){j.list=[];j.data={}}},k,l={init:function(){var c=a.queryToJson(b.nodeList.widget.getAttribute("node-data")||"");i=a.parseParam(i,c);l.buildMenu()},showMenu:function(b){e.style.display="";e.style.zIndex="10000";var c=a.position(b),d=a.core.dom.getSize(b);a.core.dom.setXY(e,{t:c.t+d.height+3,l:c.l-5});a.ui.effect(e,"fadeInDown","fast");window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("tblog_home_edit",'unfold_more"')},hideMenu:function(){a.ui.effect(e,"fadeOutUp","fast",function(){e.style.display="none"})},buildMenu:function(){e=b.nodeList.morePlugin;if(!!e){document.body.appendChild(e);e.style.position="absolute";a.lib.publisher.widget.widgetloader(b,{widget:e});l.menuEvt()}},menuEvt:function(){a.addEvent(e,"click",l.hideMenu)},destroy:function(){a.removeEvent(e,"click",l.hideMenu);d&&d.destroy()}};l.init();c.menu=e;c.show=l.showMenu;c.hide=l.hideMenu;c.destroy=l.destroy;return c}});
STK.register("lib.kit.dom.hover",function(a){function b(b,c){var d=c.length;while(d--)if(c[d]===b||a.contains(c[d],b))return!0;return!1}var c={};return a.lib.kit.touch.cantouch?function(d){var e=d.act,f=d.extra||[],g=function(a){d.onmouseover.apply(e,[a])},h=function(a){d.onmouseout.apply(e,[a])},i=function(c,d){b(a.fixEvent(d).target,[e].concat(f))?g(d):h(d)};if(!("inited"in c)){c.inited=!0;a.custEvent.define(c,["tap"]);a.addEvent(document.body,"tap",function(b){a.custEvent.fire(c,"tap",b)})}a.custEvent.add(c,"tap",i);return{destroy:function(){a.removeEvent(document.body,"tap",i)}}}:function(b){var c=b.delay||300,d=b.moutDelay||c,e=b.isover||!1,f=b.act,g=b.extra||[],h=null,i=function(a){e&&b.onmouseover.apply(f,[a])},j=function(a){e||b.onmouseout.apply(f,[a])},k=function(a){e=!0;h&&clearTimeout(h);h=setTimeout(function(){i(a)},c)},l=function(a){e=!1;h&&clearTimeout(h);h=setTimeout(function(){j(a)},d)};a.core.evt.addEvent(f,"mouseover",k);a.core.evt.addEvent(f,"mouseout",l);for(var m=0,n=g.length;m<n;m+=1){a.core.evt.addEvent(g[m],"mouseover",k);a.core.evt.addEvent(g[m],"mouseout",l)}var o={};o.destroy=function(){a.core.evt.removeEvent(f,"mouseover",k);a.core.evt.removeEvent(f,"mouseout",l);for(var b=0,c=g.length;b<c;b+=1){a.core.evt.removeEvent(g[b],"mouseover",k);a.core.evt.removeEvent(g[b],"mouseout",l)}};return o}});
STK.register("lib.editor.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return b(a)}});
STK.register("lib.editor.editor",function(a){var b=a.addEvent,c=a.removeEvent,d=a.custEvent,e=a.getStyle,f=a.setStyle,g=a.lib.kit.dom.parseDOM,h=a.lib.kit.extra.textareaUtils,i=a.lib.editor.count;return function(e,f){var j={},f=f,k={},l="",m="",n="",o={reset:function(){k.textEl.value="";d.fire(j,"changed");k.textEl.removeAttribute("extra");l=m=n=""},delWords:function(a){var b=o.getWords();if(!(b.indexOf(a)>-1))return!1;k.textEl.value="";q.textInput(b.replace(a,""))},getWords:function(){return a.core.str.trim(k.textEl.value)},getExtra:function(){var b,c=k.textEl.getAttribute("extra")||"";c!=null&&(b=a.core.str.trim(c));return b},focus:function(a,b){if(typeof a!="undefined")h.setCursor(k.textEl,a,b);else{var c=k.textEl.value.length;h.setCursor(k.textEl,c)}p.cacheCurPos()},blur:function(){k.textEl.blur()},addExtraInfo:function(a){typeof a=="string"&&k.textEl.setAttribute("extra",a)},disableEditor:function(a){c(k.textEl,"mouseup",p.cacheCurPos);if(a===!0)k.textEl.setAttribute("disabled","disabled");else{b(k.textEl,"mouseup",p.cacheCurPos);k.textEl.removeAttribute("disabled")}},getCurPos:function(){var a=k.textEl.getAttribute("range")||"0&0";return a.split("&")},count:function(){var b=a.core.str.trim(k.textEl.value).length==0?a.core.str.trim(k.textEl.value):k.textEl.value;return i(b)},addShortUrlLog:function(b){b=b&&a.trim(b);if(b){var c=new RegExp("^"+b+"$|"+"_"+b+"$|^"+b+"_|"+"_"+b+"_");c.test(l)||(l?l=l+"_"+b:l=b)}},getShortUrlLog:function(){return l},setCurrentLogType:function(a){m=a},getCurrentLogType:function(){return m},setImageLogType:function(a){n=a},getImageLogType:function(){return n}},p={textElFocus:function(){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","");d.fire(j,"focus");k.num&&a.core.dom.setStyle(k.num,"display","");o.getWords()==f.tipText&&o.delWords(f.tipText)},textElBlur:function(){setTimeout(function(){if(k.textEl.value.length===0){k.recommendTopic&&a.core.dom.setStyle(k.recommendTopic,"display","block");k.num&&k.recommendTopic&&a.core.dom.setStyle(k.num,"display","none");typeof f.tipText!="undefined"&&(k.textEl.value=f.tipText)}d.fire(j,"blur")},50)},cacheCurPos:function(){var b=h.getSelectedText(k.textEl),c=b==""||b==null?0:b.length,d=a.core.dom.textSelectArea(k.textEl).start,e=d+"&"+c;k.textEl.setAttribute("range",e)}},q={textChanged:function(){d.fire(j,"keyUpCount")},textInput:function(a,b){var c=o.getCurPos(),b=c[0],e=c[1];o.getWords()==f.tipText&&a!=f.tipText&&o.delWords(f.tipText);h.unCoverInsertText(k.textEl,a,{rcs:c[0],rccl:c[1]});p.cacheCurPos();d.fire(j,"changed")}},r={},s=function(){v();w()},t=function(){x();z();A();u()},u=function(){f.storeWords?k.textEl.value.length==0&&q.textInput(f.storeWords):f.tipText&&(k.textEl.value=f.tipText)},v=function(){if(!e)throw"node is not defined in module editor"},w=function(){var b=a.core.dom.builder(e).list;k=g(b);if(!k.widget)throw"can not find nodes.widget in module editor"},x=function(){var a=k.textEl;b(a,"focus",p.textElFocus);b(a,"blur",p.textElBlur);b(a,"mouseup",p.cacheCurPos);b(a,"keyup",p.cacheCurPos)},y=function(){d.define(j,["changed","focus","blur"])},z=function(){y();d.add(j,"changed",q.textChanged)},A=function(){},B=function(){d.remove(j);d.undefine(j);var a=k.textEl;c(a,"focus",p.textElFocus);c(a,"blur",p.textElBlur);c(a,"mouseup",p.cacheCurPos);c(a,"keyup",p.cacheCurPos)};s();var C={reset:o.reset,getWords:o.getWords,getExtra:o.getExtra,delWords:o.delWords,focus:o.focus,blur:o.blur,insertText:q.textInput,check:q.textChanged,addExtraInfo:o.addExtraInfo,disableEditor:o.disableEditor,getCurPos:o.getCurPos,count:o.count,textElFocus:p.textElFocus,cacheCurPos:p.cacheCurPos,addShortUrlLog:o.addShortUrlLog,getShortUrlLog:o.getShortUrlLog,setCurrentLogType:o.setCurrentLogType,getCurrentLogType:o.getCurrentLogType,setImageLogType:o.setImageLogType,getImageLogType:o.getImageLogType};j.destroy=B;j.API=C;j.nodeList=k;j.init=t;j.opts=f;return j}});
STK.register("lib.editor.base",function(a){var b=a.lib.editor.service,c=a.lib.editor.plugin,d;return function(b,e){var f={},g,h,i,j,k,l;e=a.lib.kit.extra.merge({limitNum:140},e);var m=function(b){var c=a.fixEvent(b).target;if(a.contains(i.nodeList.more,c)||c==i.nodeList.more){n.showMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.addClassName(d,"W_arrow_turn")}else{n.hideMenu();var d=a.lib.kit.dom.firstChild(i.nodeList.more);d&&a.removeClassName(d,"W_arrow_turn")}},n={init:function(){n.build();n.bind()},build:function(){i=a.lib.editor.editor(b,e);d=i.nodeList;j=c.at(i,e);(typeof e.count=="undefined"||e.count=="enable")&&c.count(i);l=c.sucTip(i,e);k=c.score(i,e);h=c.morePlugin(i,e);j.init();i.init();l.init()},bind:function(){i.nodeList.more&&a.addEvent(document.body,"click",m)},showMenu:function(){h.show(i.nodeList.more)},hideMenu:function(){h.hide()},destroy:function(){k&&k.destroy&&k.destroy();i.destroy&&i.destroy();j.destroy&&j.destroy();h.destroy()},closeWidget:function(){}};n.init();f.editor=i;f.nodeList=d;f.destroy=n.destroy;f.closeWidget=n.closeWidget;return f}});
STK.register("lib.comment.commentMsg",function(a){return{noPhoneReplyMsg:'#L{ç±äºç¨æ·è®¾ç½®ï¼ä½ æ æ³åå¤è¯è®ºã}<br><a href="http://account.weibo.com/settings/mobile" target="_blank">#L{ç»å®ææº}</a>#L{åå¯ä»¥æ´å¤å°åä¸è¯è®ºã}',noPowerReplyMsg:"#L{ç±äºç¨æ·è®¾ç½®ï¼ä½ æ æ³åå¤è¯è®ºã}"}});
STK.register("lib.comment.commentTemp",function(a){function b(b){b=b||{};var c="LAB_"+a.getUniqueKey(),d=b.canUploadImage;return'<div node-type="commentwrap" class="WB_repeat_in S_bg2"><div class="WB_feed_publish clearfix"><div class="WB_publish"> <div class="p_input"><textarea node-type="textEl" class="W_input"></textarea></div><div class="p_opt clearfix"> <div class="btn W_fr"><a node-type="btnText" action-type="doReply" href="javascript:;" class="W_btn_a W_btn_a_disable">#L{è¯è®º}</a></div> <div node-type="widget" class="opt clearfix"><span class="ico"><a node-type="smileyBtn" href="javascript:void(0);"><i class="W_ficon ficon_face">o</i></a></span>'+(d?'<span class="ico"><a node-type="imgBtn" href="javascript:void(0);"><i class="W_ficon ficon_image">p</i></a></span>':"")+' <ul class="ipt">'+'<li><label class="W_label" for="'+c+'"><input node-type="forward" name="" type="checkbox" value="" class="W_checkbox" id="'+c+'"><span>#L{åæ¶è½¬åå°æçå¾®å}</span></label></li>'+" </ul>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+""}var c='<#et temp data><div class="WB_expand_media ${data.bgClass}"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><li><span class="line S_line1"><a action-type="comment_media_toSmall" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.retract)>suda-data="${data.suda.retract}"</#if> ><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{æ¶èµ·}</a></span></li><li><span class="line S_line1"><a action-type="widget_commentPhotoView" action-data="${data.acdata}" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.showBig)>suda-data="${data.suda.showBig}"</#if>><i class="W_ficon ficon_search S_ficon">f</i>#L{æ¥çå¤§å¾}</a></span></li><li><span class="line S_line1"><a action-type="comment_media_toLeft" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.left)>suda-data="${data.suda.left}"</#if>><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{åå·¦è½¬}</a></span></li><li><span class="line S_line1"><a action-type="comment_media_toRight" href="javascript:void(0);" class="S_txt1" <#if (data.suda && data.suda.right)>suda-data="${data.suda.right}"</#if>><i class="W_ficon ficon_turnright S_ficon">n</i>#L{åå³è½¬}</a></span></li></ul></div></div><div class="WB_media_view"><div class="media_show_box"><ul class="clearfix"><li class="smallcursor" action-type="comment_media_bigimgDiv" <#if (data.suda && data.suda.big)>suda-data="${data.suda.big}"</#if>><div class="artwork_box"><img dynamic-id="${data.uniqueId}" action-type="comment_media_bigimg" src="${data.bigSrc}" width="${data.bigWidth}" alt=""></div></li></ul></div></div></div></#et>';return{reply:b(),getReply:b,mediaImage:c}});
STK.register("lib.kit.extra.keySubmit",function(a){function f(c,e){var f=a.core.dom.uniqueID(c);if(f in b){var g=a.core.arr.indexOf(e,b[f]);g>=0&&b[f].splice(g,1);if(b[f].length==0){delete b[f];a.removeEvent(c,"keydown",d)}}}function e(c,e){var f=a.core.dom.uniqueID(c);if(f in b)a.core.arr.inArray(e,b[f])||b[f].push(e);else{b[f]=[e];a.addEvent(c,"keydown",d)}}function d(d){d=a.fixEvent(d);var e=a.core.dom.uniqueID(d.target),f=d.keyCode===13||d.keyCode===10;f&&(c&&d.metaKey||!c&&d.ctrlKey)&&b[e]&&a.foreach(b[e],function(a){a(d)})}var b={},c=a.core.util.browser.OS==="macintosh";return{on:e,off:f}});
STK.register("lib.image.commentImage",function(a){function f(b){if(!a.contains(document.body,b))return!1;while(b&&b.style){if(a.getStyle(b,"display")==="none")return!1;b=b.parentNode}return!0}var b=a.lib.kit.extra.language,c={width:120,height:120},d=new RegExp(["^",b("#L{åå¤}"),"@([^:]*):$"].join("")),e="loading";return function(g,h,i){function r(){}function q(a){j&&j.removeAttribute("pid");var c,d=!1;if(a.type=="singleError")if(a.data.sourceData&&a.data.sourceData.code=="A20001")c=b("#L{å¾çæ ¼å¼éè¯¯, è¯·éæ°ä¸ä¼ }");else{c=b("#L{å¾çä¸ä¼ å¤±è´¥}");d=!0}if(a.type=="fileNumErr")return 0;a.type=="fileSizeErr"&&(c=b("#L{å¾çå¤§äº20M, è¯·éæ©å°äº20Mçå¾ç}"));a.type=="defaultErr"&&(c=b("#L{å¾çæ ¼å¼éè¯¯, è¯·éæ°ä¸ä¼ }"));if(c){m.getDomList().inner.innerHTML=b('<div class="opt"><span class="txt">'+c+"</span>"+(d?'<a href="javascript:void(0)" action-type="retry" action-data="fid='+a.fid+'" class="W_btn_b">#L{éä¼ }</a>':"")+"</div>");n(m,h)}}function p(f){var g=f.fid,l=f.data.pid,o=a.lib.kit.extra.imageURL(l,{size:"thumbnail"});try{k&&k.getswf()&&k.getswf().resetFileNum&&k.getswf().resetFileNum(1);k&&k.getswf()&&k.getswf().resetFileNum&&k.getswf().resetUploadedFileNum(0)}catch(p){}if(j&&j.getAttribute("pid")===e){j.setAttribute("pid",l);m.getState()||m.show();var q=new Image;q.onload=function(){q.onload=null;var a=q.width,b=q.height,d=a,e=b;if(a>c.width){d=c.width;e=c.width/a*b}if(e>c.height){e=c.height;d=c.height/b*a}q.width=d;q.height=e;m.getDomList().inner.innerHTML="";m.getDomList().inner.appendChild(q);n(m,h)};q.src=o;var r=j.value;r==i.placeholder&&(r="");if(r==""||d.test(a.trim(r)))j.value=r+b("#L{å¾çè¯è®º}")}}function o(){j&&j.setAttribute("pid",e);a.fireEvent(document.body,"click");m.getDomList().inner.innerHTML='<i class="W_loading"></i>';m.getState()||m.show();n(m,h)}function n(a,b){if(a.getState()){var c=a.getBox().parentNode,d=c&&a.getBox().nextSibling;a.setArrow("top").setAlignPos(b,j,{offset:{left:-1,top:2}});d&&c.insertBefore(a.getBox(),d)}}if(!!h){i=i||{};i.placeholder=i.placeholder||"";var j=g.nodeList.textEl,k,l,m=a.ui.bubble({showWithAni:"fadeInDown:fast",hideWithAni:"fadeOutUp:fast"});m.getDomList().inner.className="layer_WB_pic S_bg1";m.on("hide",function(){clearInterval(l);j&&j.removeAttribute("pid")});m.on("show",function(){l=setInterval(function(){if(f(h))n(m,h);else{clearInterval(l);m.hide()}},500)});m.on("retry","click",function(a){var b=a.data.fid;m.getDomList().inner.innerHTML='<i class="W_loading"></i>';j&&j.setAttribute("pid",e);k&&k.getswf()&&k.getswf().reuploadById&&k.getswf().reuploadById(b)});k=a.lib.image.mUpload(h,{w:20,h:20,uploading:o,uploaded:p,error:q,extra:r,number:1});return{hideLayer:function(){m.hide()},destroy:function(){m&&m.destroy();k&&k.destroy();m=k=null}}}}});
STK.register("lib.comment.reply",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.comment,d=a.core.dom.setStyle,e=a.core.dom.getStyle,f=a.core.evt.preventDefault,g=a.lib.kit.extra.setPlainHash,h=[],i={},j={reply:b("#L{åå¤}"),alert:b("#L{è¯è®ºåå®¹ä¸è½ä¸ºç©ºå¦ï¼åç¹ä¸è¥¿å§ã}"),success:b("#L{è¯è®ºæå}"),block:b("#L{åæ¶å°æ­¤ç¨æ·å å¥é»åå}")},k=new RegExp(["^",j.reply,"@([^:]*):"].join("")),l=function(a,c){!a||(c=="normal"?a.innerHTML=b("#L{è¯è®º}"):a.innerHTML=b("#L{æäº¤ä¸­...}"))},m=function(c,e){var f={},h,i,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;a.custEvent.define(f,["reply"]);var G=a.core.evt.delegatedEvent(c),H={add_success:function(b){B=0;q.className="W_btn_a btn_noloading";l(s,"normal");i.API.reset();i.API.insertText(w);i.API.blur();d(c,"display","none");b.forward=t;a.custEvent.fire(f,"reply",[b]);a.ui.tip("lite",{msg:j.success,type:"succM",timer:"500"});D&&D.hideLayer()},add_fail:function(a){B=0;q.className="W_btn_a btn_noloading";l(s,"normal")},add_error:function(a){B=0;q.className="W_btn_a btn_noloading";l(s,"normal")}},I=function(){u=a.core.str.trim(p.value);u==w||u==""?!a.hasClassName(q,"W_btn_a_disable")&&a.addClassName(q,"W_btn_a_disable"):a.hasClassName(q,"W_btn_a_disable")&&a.removeClassName(q,"W_btn_a_disable")},J=function(c){if(!B){B=1;a.core.evt.preventDefault();t=o.checked?1:0;u=a.core.str.trim(p.value);x=u.match(k);var d=p.getAttribute("pid");if(d==="loading"){a.ui.tipAlert(b("#L{å¾çä¸ä¼ ä¸­è¯·ç¨å}"),{icon:"rederrorS"}).beside(p).on("hide",function(){p.focus()});B=0;return}if(u==w||u==""){a.ui.tipAlert(j.alert,{icon:"rederrorS"}).beside(p);B=0;p.focus();!a.hasClassName(q,"W_btn_a_disable")&&a.addClassName(q,"W_btn_a_disable")}else{if(!x||!x[1]||x[1]!=v)e.cid=v=null;u=a.leftB(u,280);e.content=u;y=a.lib.kit.extra.getDiss(a.lib.kit.extra.merge(e,{act:"reply",content:u,forward:t,isroot:0}),c.el);c&&c.el?c.el.className="W_btn_a W_btn_a_disable":q&&(q.className="W_btn_a W_btn_a_disable");l(s,"loading");g("_rnd"+(+(new Date)).toString());m=a.lib.comment.inter(H,y);y=a.lib.kit.extra.merge(c.data,y);d&&(y.pic_id=d);m.post(y)}}};o=a.sizzle('[node-type="forward"]',c)[0];p=a.sizzle('[node-type="textEl"]',c)[0];q=a.sizzle('[action-type="doReply"]',c)[0];s=a.sizzle('[node-type="btnText"]',c)[0];E=a.sizzle('[node-type="smileyBtn"]',c)[0];F=a.sizzle('[node-type="imgBtn"]',c)[0];A=a.core.json.jsonToQuery(e);q.setAttribute("action-data",A);v=e.content;w=[j.reply,"@",v,":"].join("");try{h=a.lib.editor.base(c,{count:"disable"});i=h.editor;a.custEvent.define(i,"close");C=a.lib.publisher.widget.face(i);D=a.lib.image.commentImage(i,F)}catch(K){}z=i.API.getWords();z==""?i.API.insertText(w):i.API.insertText("");G.add("doReply","click",J);a.addEvent(E,"click",C.show);a.lib.kit.extra.keySubmit.on(p,J);n=setInterval(function(){I()},200);a.lib.kit.dom.autoHeightTextArea({textArea:p,maxHeight:9999,inputListener:function(){var b=a.trim(p.value);a.bLength(b)>280&&(p.value=a.leftB(b,280))}});f.focus=function(){i.API.insertText("")};f.destroy=function(){a.removeEvent(E,"click",C.show);D&&D.destroy();G&&G.destroy&&G.destroy();clearInterval(n);a.lib.kit.extra.keySubmit.off(p,J)};return f},n=function(b,c){var d=a.core.arr.indexOf(b,h);if(!i[d]){h[d=h.length]=b;i[d]=m(b,c)}return i[d]};return function(b,c){(!c||!c.mid)&&a.log("lib.comment/reply.js-------mid is not defined");return n(b,c)}});
STK.register("lib.comment.comment",function(a){var b=a.lib.comment.commentMsg,c=a.lib.comment.commentTemp,d=a.lib.kit.extra.setPlainHash,e=a.lib.comment.reply,f="",g=[],h={},i=a.ui.alert,j=a.lib.kit.extra.language,k=a.custEvent,l=k.fire,m=null,n=null,o=a.conf.trans.feed.comment,p={content:j("#L{è¯è®ºåå®¹ä¸è½ä¸ºç©ºå¦ï¼åç¹ä¸è¥¿å§ã}"),"delete":j("#L{ç¡®å®è¦å é¤è¯¥åå¤å}"),reply:j("#L{åå¤}"),blcok:j("#L{åæ¶å°æ­¤ç¨æ·å å¥é»åå}"),unReply:j(b.noPhoneReplyMsg),unPower:j(b.noPowerReplyMsg)},q=function(b,g){var h,i,q=g.mid,r=g.dissDataFromFeed,s,t,u,v,w,x,y,z,A,B,C,D,E=new RegExp(["^",p.reply,"@([^:]*):(.*)"].join("")),F=a.core.str,G={},H,I,J,K=g.isMain,L=function(c){var e=a.trim(w.value),i=e.match(E),k=w.getAttribute("pid");if(k==="loading")a.ui.tipAlert(j("#L{å¾çä¸ä¼ ä¸­è¯·ç¨å}"),{icon:"rederrorS"}).beside(w).on("hide",function(){w.focus()});else{if(e==""||i&&a.trim(i[2])==""){a.ui.tipAlert(p.content,{icon:"rederrorS"}).beside(w);w.focus();return}if(!i||!i[1]||i[1]!=v)t=v=null;var l;c&&c.el?l=c.el:l=a.sizzle('[action-type="post"]',b)[0];f=l.innerHTML;l.className="W_btn_a W_btn_a_disable";l.innerHTML=j("#L{æäº¤ä¸­...}");d("_rnd"+(+(new Date)).toString());var m=a.lib.kit.extra.getDiss({act:i?"reply":"post",cid:t,content:F.leftB(e,280),isroot:z&&z.checked?"1":"0",forward:x&&x.checked?"1":"0",appkey:g.appkey,mark:g.mark},c.el);m=a.core.json.merge(m,c.data);m=a.core.json.merge(m,r);k&&(m.pic_id=k);h.post(m)}},M=function(b){var d=b.el,f=b.data.cid,g=b.data.nick,h=b.data.canUploadImage==1,i=a.core.dom.dir(d,{dir:"parent",expr:'[node-type="replywrap"]',matchAll:!1})[0],k=a.core.dom.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0],l=d.getAttribute("status"),m=G[f]&&G[f].DOM,n=m?a.core.dom.contains(document.body,m):!1;if(m&&a.getStyle(m,"display")!="none"&&n){a.setStyle(m,"display","none");k&&a.removeClassName(k,"curr")}else{if(!m||!n){m=a.builder(j(c.getReply({canUploadImage:h}))).list.commentwrap[0];if(b.data.feed_type==="sub_feed"){a.removeClassName(m,"S_bg2");a.addClassName(m,"S_bg1")}i.appendChild(m);G[f]={handle:e(m,a.lib.kit.extra.merge(b.data,{mid:q,cid:f,content:g,module:"scommlist",dissDataFromFeed:r})),DOM:m};x&&a.core.dom.dir.parent(x,{expr:"li"})[0].style.display==="none"&&(a.core.dom.neighbor(m).child("[node-type=forward]").parent("li").finish().style.display="none");a.custEvent.add(G[f].handle,"reply",function(){k&&a.removeClassName(k,"curr");O.apply(null,arguments)})}k&&a.addClassName(k,"curr");a.setStyle(m,"display","");G[f]&&G[f].handle.focus()}},N=a.core.evt.delegatedEvent(b);N.add("post","click",L);N.add("reply","click",function(b){if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=b.el;if(a.core.dom.hasClassName(c,"unclick_rep")){var d=c.getAttribute("isPhone");d?a.ui.tipAlert(p.unReply,{icon:"rederrorS"}).beside(c):a.ui.tipAlert(p.unPower,{icon:"rederrorS"}).beside(c);return}b.data&&b.data.ispower=="1"?o.request("isComment",{onComplete:function(d){if(d.code=="100000"){var e,f,g;(e=b.data)&&(f=e.nick)&&M(b)}else{if(d.code=="100022")a.ui.tipAlert(p.unPower,{icon:"rederrorS"}).beside(c);else if(d.code=="100001"){c&&c.setAttribute("isphone","1");a.ui.tipAlert(p.unReply,{icon:"rederrorS"}).beside(c)}else a.ui.tipAlert(d.msg,{icon:"rederrorS"}).beside(c);a.addClassName(c,"unclick_rep")}}},b.data):M(b)}});N.add("delete","click",function(b){var c=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',p.blcok,"</label>"].join(""):"",d=a.ui.tipConfirm([p["delete"],c],{stopClickPropagation:!1}).ok(function(a){var c=d.getDomList(!0).block_user&&d.getDomList(!0).block_user.checked,e,f;(e=b.data)&&(f=e.cid)&&h.del({act:"delete",cid:f,is_block:c?"1":"0"})}).beside(b.el,{appendTo:document.body})});a.conf.channel.feed.register("reply",function(a){a.cid==u&&P(a.ret)});var O=function(a,b){P(b)},P=function(c){var d=c.data;if(!d)return!1;t=v=null;s+=1;typeof K=="undefined"&&d.comment&&A&&a.insertHTML(A,d.comment,"afterend");l(i,"count",s);l(i,"comment",{count:s,html:d.comment});if(d.feed){l(i,"feed");a.conf.channel.feed.fire("forward",{html:d.feed})}Q.changeSubmitBtn();a.removeNode(a.sizzle(".WB_empty",b)[0]);return!0},Q={changeSubmitBtn:function(){var c=a.sizzle("[node-type='btnText']",b)[0],d=a.sizzle("a[action-type='post']",b)[0];d.className="W_btn_a btn_noloading";f&&(c.innerHTML=f)},add_success:function(a,b){if(P(a)){w.value="";w.focus();J&&J.hideLayer()}},add_fail:function(){Q.changeSubmitBtn()},add_error:function(){Q.changeSubmitBtn()},delete_success:function(c,d){s=Math.max(s-1,0);l(i,"count",s);var e=a.sizzle(["[comment_id=",d.cid,"]"].join(""),b)[0];e&&e.parentNode.removeChild(e);l(i,"del",{commont_id:d.cid})},delete_fail:function(a,b){},checkIsEmpty:function(){var c=new RegExp(["^",p.reply,"@([^:]*):(.*)"].join("")),d=a.sizzle("[node-type='btnText']",b)[0],e=a.trim(w.value),f=e.match(c);d&&(e==""||f&&a.trim(f[2])==""?!a.hasClassName(d,"W_btn_a_disable")&&a.addClassName(d,"W_btn_a_disable"):a.hasClassName(d,"W_btn_a_disable")&&a.removeClassName(d,"W_btn_a_disable"))},smallList_success:function(c,d){d.focus=d.focus||!0;var e=c.data;if(!!e){e.html&&(b.innerHTML=e.html);d.filter!==4?l(i,"count",[s=e.count*1||0]):l(i,"count",[s=d.count*1||0]);w=a.sizzle("textarea",b)[0];setTimeout(function(){w&&a.lib.kit.dom.autoHeightTextArea({textArea:w,maxHeight:9999,inputListener:function(){var b=a.trim(w.value);F.bLength(b)>280&&(w.value=F.leftB(b,280))}});if(w)try{B=a.lib.editor.base(b,f);C=B.editor;a.custEvent.define(C,"close");var c=a.sizzle('[node-type="smileyBtn"]',b)[0],e=a.sizzle('[node-type="imgBtn"]',b)[0];I=a.lib.publisher.widget.face(C);J=a.lib.image.commentImage(C,e);a.addEvent(c,"click",I.show);y=setInterval(function(){Q.checkIsEmpty()},200);d.focus&&a.core.dom.selectText(w,{start:0});d.focus&&w.focus()}catch(g){}},25);x=a.sizzle("input[name=forward]",b)[0];z=a.sizzle("input[name=isroot]",b)[0];A=a.sizzle("div[node-type=commentList]",b)[0];a.lib.kit.extra.keySubmit.on(w,L);var f={count:"disabled"}}},smallList_error:function(a,b){l(i,"requesterror")}};h=a.lib.comment.inter(Q,g);i=k.define(h,["count","feed","comment","del","requesterror"]);h.destroy=function(){if(H){N.remove("qface_send","click",H.send);H.destroy();H=undefined}a.foreach(G,function(b){a.custEvent.remove(b.handle);b.DOM=null;b.handle=null});y&&clearInterval(y);a.lib.kit.extra.keySubmit.off(w,L);n&&window.clearTimeout(n);m&&m.anihide&&m.anihide();m&&m.destroy&&m.destroy();m=null};return h},r=function(b,c){var d=a.core.arr.indexOf(b,g);if(!h[d]){g[d=g.length]=b;h[d]=q(b,c)}return h[d]};return function(a,b){if(!a||!a.mid)throw"mid is not defined";var c=r(b,a);if(b.firstChild){b.innerHTML="";b.style.display="none";c.destroy()}else if(a){a.act="list";c.load(a);b.style.display=""}return c}});
STK.register("lib.dialog.commentDialogue",function(a){var b=a.lib.comment.commentMsg,c=a.lib.kit.extra.language,d={TITLE:c("#L{æ¥çå¯¹è¯}"),FRAME:c('<div class="layer_dialogue_v5"><div class="WB_empty" node-type="topbox" style="display:none;"><div class="WB_innerwrap"><div class="empty_con clearfix"><p class="subtext" style="display:none;" node-type="more"></p></div>\t\t\t\t\t</div>\t\t\t</div><div class="WB_feed_repeat" node-type="scrollView"><!--æ¨¡åæå¤å±ï¼éè¦è®¾ç½®å®ä½åé«åº¦å¼--><div class="WB_repeat"><div class="repeat_list"><div class="list_box"><div class="list_ul" node-type="repeat_list"></div></div></div></div></div>  </div>'),MOREAREA:{LOADING:c('<span>&nbsp;<i class="W_loading"></i>#L{å è½½ä¸­...}</span>'),DELETEED:c("#L{åå¤è®°å½ä¸­é¨åè¯è®ºå·²è¢«åä½èå é¤ã}"),RETRY:c('#L{å è½½å¤±è´¥ï¼è¯·}<a action-type="older" href="javascript:void(0)" onclick="return false;">#L{éè¯}</a>#L{ã}'),DEFAULT:c('<a action-type="older" href="javascript:void(0)" onclick="return false;"><span class="more_arrow">&laquo;</span>#L{æ¥çæ´æ©çè¯è®º}</a>')}},e={unReply:c(b.noPhoneReplyMsg),unPower:c(b.noPowerReplyMsg)},f=a.conf.trans.comment,g=a.ui.dialog({isHold:!0}),h=null,i=null,j=a.conf.trans.comment,k,l=!1;return function(){var b,c,m,n,o,p,q,r=!0,s=!1,t=[],u,v=function(){g.setTitle(d.TITLE);g.setContent(d.FRAME);var b=g.getDomList().inner;k=a.lib.kit.dom.parseDOM(a.builder(b).list);k.outer=g.getBox();k.inner=b;u=a.ui.scrollView(k.scrollView);w();l=!0},w=function(){q=a.core.evt.delegatedEvent(k.outer);q.add("older","click",b.getDialogueList);q.add("replycomment","click",x.show);a.custEvent.add(g,"hide",b.reset)},x={show:function(b){var c=b.el;{if(!a.core.dom.hasClassName(c,"unclick_rep")){b.data&&b.data.ispower=="1"?j.request("isComment",{onComplete:function(d){if(d.code=="100000")x.showReply(b);else{if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}if(d.code=="100022")h=a.ui.tip("alert",{msg:e.unPower,type:"warn"});else if(d.code=="100001"){c&&c.setAttribute("isphone","1");h=a.ui.tip("alert",{msg:e.unReply,type:"warn"})}else h=a.ui.tip("alert",{msg:d.msg,type:"warn"});h.setLayerXY(c);h.aniShow();a.addClassName(c,"unclick_rep");i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}}},b.data):x.showReply(b);return a.preventDefault(b.evt)}if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}var d=c.getAttribute("isPhone");d?h=a.ui.tip("alert",{msg:e.unReply,type:"warn"}):h=a.ui.tip("alert",{msg:e.unPower,type:"warn"});h.setLayerXY(c);h.aniShow();i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}},showReply:function(b){var c=b.el,d,e,f;while(c.className.toLowerCase()!="list_con")c=c.parentNode;d=a.sizzle('[node-type="commentwrap"]',c)[0];var g=b.el;e=g.getAttribute("status");var h=a.core.dom.dir(g,{expr:"li"});if(a.core.dom.getStyle(d,"display")!="none"&&e=="true"){g.setAttribute("status","false");a.core.dom.setStyle(d,"display","none");h[0]&&a.removeClassName(h[0],"curr")}else{g.setAttribute("status","true");a.core.dom.setStyle(d,"display","");h[0]&&a.addClassName(h[0],"curr");f&&f.focus()}if(!e){f=a.lib.comment.reply(d,b.data);f.liNode=h[0];x.funcs.add(f)}u.reset()},reply:function(b,c){a.conf.channel.feed.fire("reply",{obj:b,ret:c,cid:n});c.data&&c.data.content&&x.newDialogue(c.data.content)},newDialogue:function(b){a.core.dom.insertHTML(k.repeat_list,b,"beforeend")},funcs:{add:function(b){var c=x.funcs.get(b);if(!t[c]){t.push(b);a.custEvent.add(b,"reply",x.reply);a.custEvent.add(b,"reply",function(){b.liNode&&a.removeClassName(b.liNode,"curr")})}},remove:function(b){if(t[b]){a.custEvent.remove(b);t[b]=null;delete t[b]}},get:function(a){var b,c=!1;for(var d=0;d<t.length;d++){var e=t[d];if(e==a){b=d;c=!0;break}}return b},destroy:function(){for(var a=0;a<t.length;a++)x.funcs.remove(a)}}};b={show:function(a){!l&&v();r=!0;c=a.data.cid;m=a.data.ouid;n=c;o=a.data.cuid;p=a.data.type||"small";b.display();b.getDialogueList()},getCid:function(){var d=!1,e=a.lib.kit.dom.firstChild(k.repeat_list);if(e)var d=e.getAttribute("cid");if(d){c=d;b.moreArea.show()}else b.moreArea.hide()},getDialogueList:function(){var e={cid:c,type:p,ouid:m,cuid:o};r&&(e.is_more=1);if(!s){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.addContent(c.data.html);r=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);u.reset()}},e)}u.reset()},getOldDialogueList:function(){var e={cid:c,type:p,ouid:m,cuid:o};r&&(e.is_more=1);if(!s){b.loading.start();f.request("dialogue",{onComplete:function(c){b.loading.end();if(c.code=="100000"){c.data&&c.data.html&&b.loadmore(c.data.html);r=!1;b.getCid();b.moreArea.setContent(c.msg?c.msg:d.MOREAREA.DEFAULT)}else if(c.code=="100001"){b.moreArea.setContent(d.MOREAREA.RETRY);b.moreArea.show()}else if(c.code=="100011"){b.moreArea.setContent(d.MOREAREA.DELETEED);b.moreArea.show()}else a.lib.dialog.ioError(c.code,c);u.reset()}},e)}u.reset()},loading:{start:function(){s=!0;b.moreArea.setContent(d.MOREAREA.LOADING)},end:function(){s=!1;b.moreArea.setContent(d.MOREAREA.DEFAULT)}},addContent:function(b){a.core.dom.insertHTML(k.repeat_list,b,"afterbegin")},loadmore:function(b){var c=a.sizzle('[node-type="commentconversation"]',k.repeat_list)[0];a.core.dom.insertHTML(c,b,"afterbegin")},moreArea:{show:function(){a.setStyle(k.more,"display","");a.setStyle(k.topbox,"display","")},hide:function(){a.setStyle(k.more,"display","none");a.setStyle(k.topbox,"display","none")},setContent:function(a){k.more.innerHTML=a}},display:function(){b.clear();g.show();g.setMiddle();a.setStyle(k.outer,"top",parseInt(a.getStyle(k.outer,"top"))-30+"px")},clear:function(){k.repeat_list.innerHTML=""},reset:function(){r=!0;b.moreArea.show();b.clear();x.funcs.destroy()},destroy:function(){b=null,x=null;x.funcs.destroy();i&&window.clearTimeout(i);h&&h.aniHide&&h.aniHide();h&&h.destroy&&h.destroy();h=null}};return b}});
STK.register("lib.feed.plugins.comment",function(a){var b=a.core.dom.uniqueID,c=a.lib.feed.feedTemps,d={},e=a.lib.kit.extra.language,f=e("#L{è¯è®º}"),g=e("#L{è½¬å}"),h=a.conf.trans.feed.comment,i=a.lib.kit.extra.setPlainHash;return function(j,k){var l=j.utils,m=!1,n=null,o=null,p={};if(!j)a.log("comment : need object of the baseFeedList Class");else{var q=a.core.obj.parseParam({trans:h},k),r=j.getNode(),s={},t=!1,u=function(b,c,d,e){var f=a.core.dom.dir(b,{expr:"ul"})[0],g=!1,h=c.split(" "),i;if(!a.core.dom.hasClassName(b,c)){i=a.core.dom.sizzle("."+e,f)[0];for(var j=0;j<h.length;j++)a.core.dom.removeClassName(i,h[j]);a.core.dom.addClassName(i,d);a.core.dom.addClassName(b,c);a.core.dom.removeClassName(b,d);g=!0}b.blur();return g},v=function(h){t=!1;var k=h.el,n=b(k),q=d[n],s=l.getMid(k,r),v=l.getFeedNode(k,r),w=a.sizzle('[node-type="feed_list_repeat"]',v)[0],x=a.sizzle('[node-type="cmtarrow"]',v),y=a.sizzle('div[node-type="commentBox"]',v);y=y[0]?y[0]:null;var z=k.dataset&&k.dataset.mark||k.getAttribute("data-mark")||"",A={};z&&(A=a.queryToJson(z));if(!w)a.log("feedList.plugins.comment: è¯è®ºåè¡¨çå±ç¤ºåºä¸å­å¨ï¼");else{if(!q){y&&(y.style.display="none");x[0]&&(x[0].style.display="");a.addClassName(h.el.parentNode,"curr");i((+(new Date)).toString());q=d[n]=a.lib.comment.comment(a.lib.kit.extra.getDiss(a.core.json.merge(a.core.json.merge({mid:s,appkey:h.data.appkey,isMain:!0,dissDataFromFeed:a.lib.kit.extra.getDiss(v)},h.data),A),h.el),w);a.custEvent.add(q,"count",function(b,c){parseInt(c)<1?c="":c=" "+c;a.sizzle(">span",k).length?k.innerHTML='<span class="pos"><span class="line S_line1">'+f+c+"</span></span>":k.innerHTML=f+c});a.custEvent.add(q,"comment",function(b,c){o=a.sizzle('a[node-type="feed_list_commentTabAll"]',v)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',v)[0],f=c.html,g=parseInt(c.count),h=a.sizzle('[node-type="feed_list_commentListNum"]',v)[0];parseInt(g)>0&&h&&(h.innerHTML=e("#L{å±}")+g+e("#L{æ¡}"));if(!o)f&&a.insertHTML(d,f,"afterbegin");else if(!p[s])f&&a.insertHTML(d,f,"afterbegin");else{d.innerHTML=p[s];u(o,"current S_txt1","S_func1","S_txt1");m=!1;f&&a.insertHTML(d,f,"afterbegin")}p[s]=d.innerHTML});a.custEvent.add(q,"feed",function(){var b=a.sizzle('a[action-type="fl_forward"]',k.parentNode)[0];if(!b)a.log("feedList.plugins.comment: è½¬åæé®èç¹ä¸å­å¨ï¼");else{var c=b.innerHTML.match(/\(([\d]*)\)/);b.innerHTML=g+"("+(c?parseInt(c[1])+1:1)+")"}});a.custEvent.add(q,"del",function(b,c){o=a.sizzle('a[node-type="feed_list_commentTabAll"]',v)[0];var d=a.sizzle('[node-type="feed_list_commentList"]',v)[0];if(p[s])if(!m)d&&(p[s]=d.innerHTML);else{var e=document.createElement("div");e.innerHTML=p[s];a.core.util.hideContainer.appendChild(e);var f=a.sizzle(["dl[comment_id=",c.cid,"]"].join(""),e)[0];f&&f.parentNode.removeChild(f);p[s]=e.innerHTML;a.core.util.hideContainer.removeChild(e);e=null}else o&&(p[s]=d.innerHTML)});w.innerHTML=c.loadingIMG;w.style.display="";a.custEvent.fire(j,"commentShow",k)}else{a.removeClassName(h.el.parentNode,"curr");a.custEvent.remove(q);q.destroy();delete d[n];w.on=0;w.innerHTML="";w.style.display="none";a.custEvent.fire(j,"commentHide",k);y&&(y.style.display="")}return l.preventDefault()}},w=function(b){a.core.evt.preventDefault();if(!t){t=!0;v(b)}},x={getListByType:function(b,c){var d=b.data,f=d.mid,g=b.el,j=l.getFeedNode(g,r),k=u(b.el,"S_txt1 curr","S_txt1","curr");if(!k)return l.preventDefault();i((+(new Date)).toString());h.request("cfilter",{onSuccess:function(b){c.innerHTML=b.data.html;m||(p[f]=b.data.html);var d=a.sizzle('[node-type="feed_list_commentListNum"]',j)[0];d&&b.data&&typeof b.data.count!="undefined"&&(d.innerHTML=e("#L{å±}")+b.data.count+e("#L{æ¡}"));j=null},onFail:function(b){a.lib.dialog.ioError(b.code,b);j=null},onError:function(b){a.lib.dialog.ioError(b.code,b);j=null}},d);return!1}},y=function(b){a.preventDefault();if($CONFIG.islogin==="0")a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"});else{var c=b.data.mid;m=b.el.getAttribute&&b.el.getAttribute("node-type")=="feed_list_commentTabAll"?!1:!0;var d=b.el,e=l.getFeedNode(d,r),f=b.data,g=a.sizzle('[node-type="feed_list_commentList"]',e)[0];p[c]||(p[c]=g.innerHTML);if(!g){a.log("feedList.plugins.comment: è¯è®ºåè¡¨ä¸å­å¨ï¼");return}x.getListByType(b,g)}},z=function(b){var c=l.getFeedNode(b.el,r),d=a.sizzle('[action-type="feed_list_commentSearch"]',c);for(var e=0;d[e];e++){var f=a.queryToJson(d[e].getAttribute("action-data"));if(b.data.filter==f.filter){b.el=d[e];y(b);return}}};j.getDEvent().add("feed_list_commentSearch","click",y);j.getDEvent().add("fl_comment","click",w);j.getDEvent().add("anotherSearchTab","click",z);j.getDEvent().add("feed_private_tipclose","click",function(b){var c=b.data&&b.data.type,d=l.getFeedNode(b.el,r),e=a.sizzle("[node-type='feed_privateset_tip']",d),f=e.length&&e[0];f&&a.setStyle(f,"display","none");h.request("privateNoMore",{onSuccess:function(){c&&(window.location.href=b.el.getAttribute("href"))},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{bubbletype:7,time:604800});return l.preventDefault()});var A=a.lib.dialog.commentDialogue(),B=function(a){A.show(a)};j.getDEvent().add("commentDialogue","click",B);j.regCustEvent("showComment",function(a,b){w(b)});s.destroy=function(){for(var a in d)d[a].destroy();o=null;p=null;d={};n=null};return s}}});
STK.register("lib.feed.plugins.page",function(a){var b=typeof $CONFIG!="undefined"&&$CONFIG.bigpipe=="true";return function(b){if(!b)a.log("page : need object of the baseFeedList Class");else{var c={},d=b.getNode(),e=b.utils,d,f,g,h,i,j,k=function(b){return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)},l={pageMoreDisplay:function(b){if(i==undefined){h.style.display="";a.ui.effect(h,"fadeInUp","fast");b=a.fixEvent(b);var c=g.getAttribute("action-data");if(c){c=a.core.json.queryToJson(c);if(c.currentPage){var d=1*c.currentPage,f=a.lib.kit.dom.firstChild(h),j=1*(c.countPage||a.lib.kit.dom.children(h).length),l=(j-d-9)*(k(f)-1);l>0&&(h.scrollTop=l)}}}i=1;return e.preventDefault(b)},pageMoreOver:function(b){if(i==undefined){h.style.display="";a.ui.effect(h,"fadeInUp","fast")}i=1;return e.preventDefault(b)},pageMoreOut:function(b){i=0;clearTimeout(j);j=setTimeout(function(){i==0&&a.ui.effect(h,"fadeOutDown","fast",function(){h&&(h.style.display="none");i=undefined})},500);return e.preventDefault(b)},pageNClick:function(a){if(window.WBAD&&window.WBAD.refresh){var b={rt:3};window.WBAD.refresh(b)}return e.preventDefault(a.evt)}},m=function(){if(!!d&&(h=a.sizzle("div[action-type=feed_list_page_morelist]",d)[0])&&(g=a.sizzle("a[action-type=feed_list_page_more]",d)[0])){a.addEvent(g,"mouseover",l.pageMoreDisplay);a.addEvent(h,"mouseover",l.pageMoreOver);a.addEvent(g,"mouseout",l.pageMoreOut);a.addEvent(h,"mouseout",l.pageMoreOut)}},n=function(){if(d){clearTimeout(j);f&&f.destroy&&f.destroy();if(g){a.removeEvent(g,"mouseover",l.pageMoreOver);a.removeEvent(h,"mouseover",l.pageMoreOver);a.removeEvent(g,"mouseout",l.pageMoreOut);a.removeEvent(h,"mouseout",l.pageMoreOut)}g=h=i=undefined}},o=function(c,d){if(d=="page"){a.custEvent.fire(b,"lazyload");b.getCurrentPage()==1&&a.custEvent.fire(b,"updateEndId")}n();m()};a.custEvent.add(b,"updateFeed",o);m();c.destroy=function(){a.custEvent.remove(b,"updateFeed",o);n()};return c}}});
STK.register("conf.trans.feed.favorite",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("add",{url:"/aj/fav/mblog/add",method:"post"});c("del",{url:"/aj/fav/mblog/del",method:"post"});c("change",{url:"/aj/fav/tag/renew",method:"get"});c("tagList",{url:"/aj/fav/tag/list",method:"get"});c("delTag",{url:"/aj/fav/tag/destroy",method:"post"});c("updateTag",{url:"/aj/fav/tag/update",method:"post"});c("alter",{url:"/aj/fav/tag/alter",method:"post"});c("favlist",{url:"/aj/fav/mblog/favlist",method:"get"});c("getFav",{url:"/aj/fav/mblog/byTag",method:"get"});c("saveTag",{url:"/aj/fav/mblog/save",method:"post"});c("legend",{url:"/aj/fav/mblog/legend",method:"get"});c("edit",{url:"/aj/fav/tag/edit",method:"get"});return b});
STK.register("lib.feed.plugins.favorite.favorite",function(a){var b=a.lib.kit.extra.language,c=b("#L{æå}!"),d=b("#L{å¤±è´¥}!"),e=b("#L{åæ¶æ¶è}"),f=b("#L{æ¶è}"),g=b("#L{å æ ç­¾}"),h,i="",j=b("#L{æ¨å·²ç»æ¶èè¿æ­¤å¾®å}ï¼"),k=b("#L{æ·»å æ¶èæ ç­¾}"),l=b("#L{æ¶èæå!}");TipInfoDel=b("#L{ç¡®è®¤è¦åæ¶æ¶èè¿æ¡å¾®ååï¼}");var m=function(b,c,d){!b||a.ui.tipAlert(b,{icon:d?"rederrorS":"succ"}).beside(c)},n,o,p,q=function(b){return a.ui.tip("confirm",{msg:TipInfoDel,okCallback:function(){n&&n()},hideCallback:function(){o&&o()}})};return function(b){var i={},j=a.conf.trans.feed.favorite;b=a.parseParam({showTip:!0,mid:null,node:null,bubbleEl:null,mark:"",trans:j,dissDataFromFeed:{}},b);if(!b.mid||!b.node)a.log("opts.mid, opts.node é½ä¸è½ä¸ºç©º!");else{a.custEvent.define(i,["success","showForward","fail","error","cancel"]);var k=function(g,h,i,j,k,l,n){var o=j=="add"?f:e;b.trans.request(j,{onSuccess:function(b){m(o+c,n||i);a.custEvent.fire(g,"success",b)},onFail:function(b){m(o+d,n||i,!0);a.custEvent.fire(g,"fail")},onError:function(b){if(b.code==100002||b.code==100008){a.lib.dialog.ioError(b.code,b);a.custEvent.fire(g,"error",b)}else{m(b.msg||o+d,i,!0);a.custEvent.fire(g,"error",b)}}},a.core.json.merge(a.lib.kit.extra.getDiss({mid:h,mark:l},i),b.dissDataFromFeed))};i.add=function(){k(i,b.mid,b.node,"add",b.showTip,b.mark,b.bubbleEl)};i.del=function(){n=function(){k(i,b.mid,b.node,"del",b.showTip,b.mark,b.bubbleEl)};o=function(){a.custEvent.fire(i,"cancel")};p=p||q();p.setLayerXY(b.bubbleEl||b.node);p.aniShow()};i.hideTip=function(){h&&h.hide()};i.aniHideTip=function(){h&&h.aniHide()};i.msgTipDetroy=function(){h&&h.destroy();h=null};i.destroy=function(){h&&h.destroy();a.custEvent.undefine(i);i=b=h=p=null};i.showSuccTip=function(a){m(g+c,a)};i.showErrTip=function(a,b){m(b,a,!0)};return i}}});
STK.register("lib.feed.plugins.favorite.items.DataController",function(a){return function(b){var c={},d={},e=[],f=0;a.custEvent.define(c,["DispItem","DeletedItem","ItemSuggest"]);c.addItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(!d[h.id]){f++;d[h.id]={data:h,index:e.length};e.push(h)}}};c.removeItems=function(b){a.isArray(b)||(b=[b]);for(var c=0,g=b.length;c<g;c++){var h=b[c];if(d[h.id]){f>0&&f--;var i=d[h.id].index;delete d[h.id];e[i]=null}}};c.getResult=function(){var a=[];for(var b=0,c=e.length;b<c;b++)e[b]&&a.push(e[b]);return a};c.getResultLength=function(){return f};c.hasKey=function(a){return d[a.id]};c.destroy=function(){a.custEvent.undefine(c);c=d=e=f=undefined};return c}});
STK.register("lib.feed.plugins.favorite.items.DispItem",function(a){return function(b){if(typeof b!="object")throw"DispItem need param object";if(typeof b.custObj!="object")throw"DispItem need custObj custEvent depute";if(typeof b.chosenTpl!="string")throw"DispItem need chosenTpl param";if(typeof b.unChosenTpl!="string")throw"DispItem need unChosenTpl param";if(!a.isNode(b.nodeList))throw"DispItem need nodeList to depute dom";if(typeof b.limitCount!="undefined"&&typeof b.DataController=="undefined")throw"DispItem need DataController when set limitCount";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.dom.firstChild,f=a.lib.kit.extra.merge,g={},h,i;g.addItems=function(e,f){a.isArray(e)||(e=[e]);var g=c(d(f.type=="chosen"?b.chosenTpl:b.unChosenTpl),e).toString();a.insertHTML(b.nodeList,g,"beforeend")};g.addDefalutItems=function(e,f){if(b.defaultNodeList){a.isArray(e)||(e=[e]);var g=c(d(f.type=="chosen"?b.chosenTpl:b.unChosenTpl),e).toString();a.insertHTML(b.defaultNodeList,g,"beforeend")}};g.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};var j=function(f,g){a.isArray(f)||(f=[f]);for(var h=0,i=f.length;h<i;h++){var j=a.sizzle("[itemid='"+f[h].id+"']",b.nodeList);if(j.length){var k=a.C("DIV"),l=c(d(g?b.chosenTpl:b.unChosenTpl),[f[h]]).toString();k.innerHTML=l;a.replaceNode(e(k),j[0])}if(b.defaultNodeList){j=a.sizzle("[itemid='"+f[h].id+"']",b.defaultNodeList);if(j.length){var k=a.C("DIV"),l=c(d(g?b.chosenTpl:b.unChosenTpl),[f[h]]).toString();k.innerHTML=l;a.replaceNode(e(k),j[0])}}}},k=function(){if(b.limitCount){var a=b.DataController.getResultLength();return a>=b.limitCount?!0:!1}return!1};g.setCheckedItems=function(a){j(a,!0)};g.setUncheckedItems=function(a){j(a,!1)};g.fireDelegateCheck=function(c){a.foreach(c,function(c){var d=a.sizzle("[itemid="+c.id+"]",b.nodeList)[0];d&&h.fireDom(d,"click",null)})};var l=function(c){setTimeout(function(){if(!k()){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setCheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"check",data:d})}else a.custEvent.fire(b.custObj,"DispItem",{type:"focusInput",data:{}})},0)},m=function(c){setTimeout(function(){var d=f(c.data,{data:c.el.getAttribute("action-data")});g.setUncheckedItems(d);a.custEvent.fire(b.custObj,"DispItem",{type:"uncheck",data:d})},0)};h=a.delegatedEvent(b.nodeList);h.add("check","click",l);h.add("uncheck","click",m);if(b.defaultNodeList){i=a.delegatedEvent(b.defaultNodeList);i.add("check","click",l);i.add("uncheck","click",m)}g.destroy=function(){h&&h.destroy();i&&i.destroy();c=d=e=f=g=h=j=k=undefined};return g}});
STK.register("lib.feed.plugins.favorite.items.DeletedItem",function(a){return function(b){if(typeof b!="object")throw"DeletedItem need param object";if(typeof b.custObj!="object")throw"DeletedItem need custObj custEvent depute";if(typeof b.template!="string")throw"DeletedItem need template to display";if(!a.isNode(b.nodeList))throw"DeletedItem need nodeList to depute dom";if(!a.isNode(b.insertBeforeNode))throw"DeletedItem need insertBeforeNode to insert dom";var c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=a.lib.kit.extra.merge,f={},g;f.addItems=function(e){a.isArray(e)||(e=[e]);var f=c(d(b.template),e).toString();a.insertHTML(b.insertBeforeNode,f,"beforebegin")};f.removeItems=function(c,d){a.isArray(c)||(c=[c]);for(var e=0,f=c.length;e<f;e++){var g=a.sizzle("[itemid='"+(d?c[e].id:c[e])+"']",b.nodeList);g.length&&a.removeNode(g[0])}};g=a.delegatedEvent(b.nodeList);g.add("remove","click",function(c){setTimeout(function(){var d=e(c.data,{data:c.el.getAttribute("action-data")});f.removeItems(d,!0);a.custEvent.fire(b.custObj,"DeletedItem",{type:"remove",data:d})},0)});f.destroy=function(){g&&g.destroy();c=d=e=g=f=undefined};return f}});
STK.register("lib.feed.plugins.favorite.items.dynamicInputWidth",function(a){return function(b,c){c=c||{};var d={},e,f,g,h=a.core.dom.getSize,i=a.core.dom.setStyle,j,k;a.custEvent.define(d,"textChange");var l=function(){if(!e){e=1;var b=a.core.dom.cssText("");b.push("width","1000px");b.push("height","55px");b.push("position","absolute");b.push("left","-10000px");b.push("top","-10000px");b.push("visibility","hidden");var c=b.getCss();e=1;var d='<div node-type="wrap" style="'+c+'">'+'<span node-type="before"></span>'+"</div>",h=a.core.dom.builder(d);g=h.box;f=a.lib.kit.dom.parseDOM(h.list);document.body.appendChild(g)}},m={focus:function(){clearTimeout(k);k=setTimeout(m.focusFun,200)},focusFun:function(){var e=b.value;if(c.limitWords){var g=a.bLength(e);g>c.limitWords&&(b.value=e=a.leftB(e,c.limitWords))}if(e==j)m.focus();else{j=e;l();f.before.innerHTML=a.encodeHTML(e);var k=h(f.before),n=k.width+20;c.maxInputWidth&&n>c.maxInputWidth&&(n=c.maxInputWidth);i(b,"width",n+"px");m.focus();a.custEvent.fire(d,"textChange",e)}},blur:function(){clearTimeout(k)}},n=function(){a.addEvent(b,"focus",m.focus);a.addEvent(b,"blur",m.blur)},o=function(){a.removeEvent(b,"focus",m.focus);a.removeEvent(b,"blur",m.blur);d=null},p={custObj:d,destroy:o};n();return p}});
STK.register("lib.feed.plugins.favorite.items.ItemSuggest",function(a){return function(b){if(typeof b!="object")throw"ItemSuggest need object params";if(typeof b.textEl=="undefined")throw"ItemSuggest need textEl";if(typeof b.uiNode=="undefined")throw"ItemSuggest need uiNode";if(typeof b.suggestConf=="undefined")throw"ItemSuggest need suggestConf";if(typeof b.custObj=="undefined")throw"ItemSuggest need custObj";var c=a.lib.kit.dom.parseDOM(a.builder(b.uiNode).list),d,e,f;b=a.lib.kit.extra.merge({actionType:"suggestItem",actionData:"index",suggestType:"local"},b);var g={},h=a.ui.mod.suggest({textNode:b.textEl,uiNode:b.uiNode,actionType:b.actionType,actionData:b.actionData}),i={BACKSPACE:8,SPACE:32},j=a.core.util.easyTemplate,k=a.lib.kit.extra.language,l=a.core.dom.getSize,m={hideSuggest:function(){a.setStyle(b.uiNode,"display","none");a.custEvent.fire(h,"close",{})},keyboardSubmit:function(){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"keyboardSubmit",data:{}})},addOneItem:function(){var c=a.trim(b.textEl.value),e=b.suggestConf.regexp;if(c)if(e(c)){a.custEvent.fire(b.custObj,"ItemSuggest",{type:"addItem",data:{id:c}});a.setStyle(b.textEl,"width","20px");b.textEl.value="";m.hideSuggest();d=null}else a.custEvent.fire(b.custObj,"ItemSuggest",{type:"inputError",data:{value:c}})},localSearch:function(a){var c=b.suggestConf.data,d=b.suggestConf.searchKey,e=[],f=b.suggestConf.suggestMaxCount,g=0;for(var h=0,i=c.length;h<i;h++)if(c[h][d]&&c[h][d].indexOf(a)==0)if(f){if(!(g<f))break;g++;e.push(c[h])}else e.push(c[h]);return e},setLayerPos:function(){a.lib.kit.dom.layoutPos(b.uiNode,b.textEl)},getTemplate:function(d){var e=j(k(b.suggestConf.template),d);c.suggestContent.innerHTML=e;m.setLayerPos();if(d.length){a.setStyle(b.uiNode,"display","");a.custEvent.fire(h,"open",b.textEl)}else m.hideSuggest()},reqSucc:function(b,c){a.isArray(b.data)?m.getTemplate(b.data):m.getTemplate([])},reqFail:function(a,b){m.getTemplate([])},buildTrans:function(){e=b.suggestConf.trans.getTrans(b.suggestConf.transName,{onSuccess:m.reqSucc,onError:m.reqFail,onFail:m.reqFail})},textChange:function(c,d){d&&(d=a.trim(d));if(!d)m.hideSuggest();else if(b.suggestType==="local"){var e=m.localSearch(d);m.getTemplate(e)}else if(b.suggestType==="net"){clearTimeout(f);f=setTimeout(function(){m.sendRequest(d)},100)}a.custEvent.fire(b.custObj,"ItemSuggest",{type:"textChange",data:{value:d}})},sendRequest:function(a){e||m.buildTrans();e.abort();e.request({q:a})},removeJudge:function(){var c=b.textEl.value;c==""&&a.custEvent.fire(b.custObj,"ItemSuggest",{type:"remove",data:{}})},onSpace:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.SPACE){m.addOneItem();a.preventDefault()}},onKeyDown:function(b){b=a.fixEvent();var c=b.keyCode||b.which;if(c==i.BACKSPACE)m.removeJudge();else if(c==13||c==10){m.hideSuggest();m.keyboardSubmit()}},blur:function(){var a=m.hideSuggest;setTimeout(function(){a();a=undefined},150)},changeCurrent:function(c,e){var f=b.suggestConf.currentClass;d&&a.removeClassName(d,f);var g=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(g[e]){a.addClassName(g[e],f);d=g[e]}else d=null},selectItem:function(c,e){c=a.fixEvent();if(!c.ctrlKey){var f=a.sizzle(b.suggestConf.itemTagName,b.uiNode);if(f[e]){a.setStyle(b.textEl,"width","20px");b.textEl.value="";var g=f[e].getAttribute("action-data");a.custEvent.fire(b.custObj,"ItemSuggest",{type:"select",data:g});m.hideSuggest();try{b.textEl.focus()}catch(h){}d=null}}}},n=a.lib.feed.plugins.favorite.items.dynamicInputWidth(b.textEl,{maxInputWidth:b.maxInputWidth,limitWords:b.limitWords});a.custEvent.add(n.custObj,"textChange",m.textChange);a.addEvent(b.textEl,"blur",m.blur);a.addEvent(b.textEl,"keypress",m.onSpace);a.addEvent(b.textEl,"keydown",m.onKeyDown);a.custEvent.add(h,"onIndexChange",m.changeCurrent);a.custEvent.add(h,"onSelect",m.selectItem);g.destroy=function(){a.custEvent.fire(h,"close",{});n&&a.custEvent.undefine(n.custObj);n&&n.destroy();a.removeEvent(b.textEl,"blur",m.blur);a.removeEvent(b.textEl,"keypress",m.onSpace);a.removeEvent(b.textEl,"keydown",m.onKeyDown);c=d=e=f=g=h=i=j=k=l=m=n=undefined};return g}});
STK.register("lib.feed.plugins.favorite.items.DataItemPicker",function(a){return function(b){var c=a.core.dom.getSize,d=a.lib.kit.extra.merge,e={},f,g,h,i,j,k,l,m,n=0,o=!1,p=function(){if(typeof b!="object")throw"DataItemPicker need params object";if(!a.isNode(b.container))throw"DataItemPicker need container(node)";if(typeof b.DispItem=="undefined")throw"DataItemPicker need DispItem(boolean)";if(typeof b.DispItemConf!="object")throw"DataItemPicker need DispItemConf";if(typeof b.DeletedItem=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.DeletedItemConf!="object")throw"DataItemPicker need DeletedItemConf";if(typeof b.ItemSuggest=="undefined")throw"DataItemPicker need DeleteItem(boolean)";if(typeof b.ItemSuggestConf!="object")throw"DataItemPicker need ItemSuggestConf";k=b.DispItem;l=b.DeletedItem;m=b.ItemSuggest;o=b.resetHeight},q=function(){f=a.lib.kit.dom.parseDOM(a.builder(b.container).list)},r=function(){if(m){a.addEvent(f.container,"click",u.focusInput);a.addEvent(f.suggestInput,"focus",u.suggestFocus);a.addEvent(f.suggestInput,"blur",u.suggestBlur)}},s=function(){g=a.lib.feed.plugins.favorite.items.DataController({custObj:e});k&&(h=a.lib.feed.plugins.favorite.items.DispItem({custObj:g,limitCount:b.limitCount,DataController:g,nodeList:f.dispItemList,defaultNodeList:f.dispItemListRecommend,chosenTpl:b.DispItemConf.chosenTpl,unChosenTpl:b.DispItemConf.unChosenTpl}));l&&(i=a.lib.feed.plugins.favorite.items.DeletedItem({custObj:g,template:b.DeletedItemConf.template,nodeList:f.container,insertBeforeNode:f.suggestInput}));m&&(j=a.lib.feed.plugins.favorite.items.ItemSuggest({textEl:f.suggestInput,uiNode:b.ItemSuggestConf.suggestList,suggestType:b.ItemSuggestConf.suggestType,suggestConf:b.ItemSuggestConf.suggestConf,maxInputWidth:b.ItemSuggestConf.maxInputWidth,limitWords:b.ItemSuggestConf.limitWords,regexp:b.ItemSuggestConf.regexp,custObj:g}));k&&a.custEvent.add(g,"DispItem",function(b,c){if(c.type=="check"){if(!u.getLimitReach()){g.addItems(c.data);a.custEvent.fire(e,"checkedDespItem",{data:c})}}else c.type=="uncheck"?g.removeItems(c.data):c.type=="focusInput"&&u.focusInput()});l&&a.custEvent.add(g,"DeletedItem",function(b,c){if(c.type=="remove"){g.removeItems(c.data);h.setUncheckedItems(c.data);u.resetHeight();a.custEvent.fire(e,"DeletedItemRemove",{DataController:g})}});m&&a.custEvent.add(g,"ItemSuggest",function(b,c){if(c.type=="remove"){var j=a.sizzle("[action-type='remove']:last",f.container);if(j.length){var k=a.queryToJson(j[0].getAttribute("action-data"));k=d(k,{data:j[0].getAttribute("action-data")});g.removeItems(k);i.removeItems(k,!0);h.setUncheckedItems(k);u.resetHeight()}a.custEvent.fire(e,"backspaceKey",{})}else if(c.type=="select"){var l=c.data,k=a.queryToJson(l);k=d(k,{data:l});var m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k)}u.resetHeight()}}else if(c.type=="textChange"){u.resetHeight();a.custEvent.fire(e,"textChange",c.data)}else if(c.type=="inputError")a.custEvent.fire(e,"inputError",c.data);else if(c.type=="addItem"){var n=c.data.id,k={id:n,data:"id="+n+"&text="+n,text:n},m=g.hasKey(k);if(!m){if(!u.getLimitReach()){g.addItems(k);i.addItems(k);h.setCheckedItems(k);a.custEvent.fire(e,"spaceAddItem",c.data)}u.resetHeight()}}else c.type=="keyboardSubmit"&&a.custEvent.fire(e,"keyboardSubmit",c.data)})},t=function(){a.custEvent.define(e,["resultChange","textChange","inputError","keyboardSubmit","backspaceKey","DeletedItemRemove","spaceAddItem","checkedDespItem"])},u={suggestFocus:function(){n=1},suggestBlur:function(){n=0},getLimitReach:function(){if(b.limitCount){var a=g.getResultLength();return a>=b.limitCount?!0:!1}return!1},focusInput:function(){if(!n){a.lib.kit.extra.textareaUtils.setCursor(f.suggestInput);n=1}},resetHeight:function(){if(!!o){var d=g.getResultLength();if(d){var e=a.position(f.suggestInput),h=a.position(f.container),i=c(f.suggestInput),j=e.t+i.height-h.t+3,k=c(f.container).height;k!=j&&a.setStyle(f.container,"height",j+"px")}else a.setStyle(f.container,"height",b.containerMinHeight+"px")}}},v=function(){p();q();r();s();t()};v();e.getDispItem=function(){return h};e.getDeletedItem=function(){return i};e.getDataController=function(){return g};e.focusInput=u.focusInput;e.resetHeight=u.resetHeight;e.destroy=function(){g.destroy();k&&h&&h.destroy();l&&i&&i.destroy();if(m){j&&j.destroy();a.removeEvent(f.container,"click",u.focusInput);a.removeEvent(f.suggestInput,"focus",u.suggestFocus);a.removeEvent(f.suggestInput,"blur",u.suggestBlur)}e=f=g=h=i=j=undefined;c=d=k=l=m=n=v=u=undefined};return e}});
STK.register("lib.feed.plugins.favorite.borderedInput",function(a){return function(b,c){c=a.parseParam({addClass:"W_input_focus",removeClass:"W_input_focus",findEl:null},c);var d={};if(!a.isNode(b))return{destroy:a.funcEmpty};var e=function(){var a;c.findEl?a=c.findEl(b):a=b;return a},f=function(){var b=e();a.addClassName(b,c.addClass)},g=function(){var b=e();a.removeClassName(b,c.removeClass)};a.addEvent(b,"focus",f);a.addEvent(b,"blur",g);d.destroy=function(){a.removeEvent(b,"focus",f);a.removeEvent(b,"blur",g)};return d}});
STK.register("lib.feed.plugins.favorite.rectsPosition",function(a){var b=a.core.util.browser,c={},d=5,e=20,f={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},g={domSize:function(b){var c=a.core.dom.getSize(b);return{w:Math.max(c.width,a.getStyle(b,"width").replace(/px|auto/gi,"")),h:Math.max(c.height,a.getStyle(b,"height").replace(/px|auto/gi,""))}},mouseXY:function(c){var d={x:c.pageX,y:c.pageY};if(b.IE6||b.IE7){var e=a.core.util.scrollPos();d.x=d.x+e.left;d.y=d.y+e.top}return d},getRows:function(a){var c=a.getClientRects();if(b.IE6||b.IE7){var d=[],e={},f;for(var g=0,h=c.length;g<h;g++){var i=c[g];e[i.top]||(e[i.top]=[]);e[i.top].push(i)}for(var j in e){var k=e[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);d.push(l)}c=d}return c},getTextRect:function(b,c){var d=a.parseParam({evt:""},c),e=a.core.util.scrollPos(),f;if(!b.getClientRects){var h=g.domSize(b);return{width:h.w,height:h.h,left:"",right:"",top:"",bottom:""}}var i={rows:g.getRows(b)},j=g.mouseXY(d.evt),k={x:j.x-e.left,y:j.y-e.top};for(var l=0,m=i.rows.length;l<m;l++){var n=i.rows[l];l==0&&(f=n);if(k.y>n.top&&k.y<n.bottom){f=n;break}}if(a.IE){var h=g.domSize(b);f=a.parseParam({width:h.w,height:h.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(b,c){var d=a.core.util.winSize(),e=g.getTextRect(b,c);return{win:d,rect:e,w:e.width,h:e.height,t:e.top,l:e.left,r:d.width-e.right,b:d.height-e.bottom}},getSeat:function(b,c,d){var h=a.parseParam({distance:e,priority:"trbl"},d),i=g.getDistance(b,d),j=g.domSize(c);i.area="b";var k=h.priority.split("");for(var l=0,m=k.length;l<m;l++){var n=k[l];if(!f[n])throw'priority error, random use "tbrl" combination';if(f[n](i,j)){i.area=n;break}}return i},setArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];var j=g.domSize(c.layer),k=a.scrollPos(),l,m;if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance}else{l=i.top+k.top-c.distance;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px"},setLayer:function(b){var c=a.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";var d=g.getSeat(c.node,c.layer,c),e=d.area,f=d.rect,h=g.domSize(c.layer),i=a.scrollPos(),j,k;if(e=="t"||e=="b"){j=e=="t"?f.top+i.top-h.h+c.offsetY:f.bottom+i.top-c.offsetY;k=f.left+i.left+c.offsetX}else{j=f.top+i.top+c.offsetY;k=e=="r"?f.right+i.left-c.offsetX:f.left+i.left-h.w+c.offsetX}c.layer.style.top=j+"px";c.layer.style.left=k+"px"}};c.getTextRect=g.getTextRect;c.getDistance=g.getDistance;c.getSeat=g.getSeat;c.setArrow=g.setArrow;c.setLayer=g.setLayer;return c});
STK.register("lib.feed.plugins.favorite.tagBubble",function(a){var b=function(a,b){window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(a,b)};return function(c){var d,e,f,g,h,i,j,k,l,m,n={},o=0,p,q,r,s=a.lib.kit.extra.language,t=a.core.util.easyTemplate,u={ADD:{text:s("#L{æå¤ä¸¤ä¸ªæ ç­¾ï¼ç¨ç©ºæ ¼åé}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},DEFAULT:{text:s("#L{æ·»å æ ç­¾æ¥ç®¡çä½ çæ¶èã}"),className:"W_tips tips_warn clearfix",classNameS:"icon_warnS W_icon"},ERROR:{text:s("#L{ä»æ¯æä¸­è±æãæ°å­ãåå·ä¸â_â}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},MAX:{text:s("#L{æ¯æ¡å¾®åæå¤æ·»å ä¸¤ä¸ªæ ç­¾}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"},SAME:{text:s("#L{æ ç­¾ä¸è½éå¤}"),className:"W_tips tips_rederror clearfix",classNameS:"W_icon icon_rederrorS"}},v=function(){if(typeof c=="undefined")throw"tagBubble need params";if(!a.isNode(c.el))throw"tagBubble need el to show";if(typeof c.mid=="undefined")throw"tagBubble need mid to commit";if(typeof c.serverData=="undefined")throw"tagBubble need serverData to show"},w=function(){d=(c.serverData.my_tags||"").split(" ");d.length==1&&d[0]==""?d.length=0:d.sort(function(a,b){return a.length>b.length});e=(c.serverData.recommend_tags||"").split(" ");e.length==1&&e[0]==""?e.length=0:e.sort(function(a,b){return a.length>b.length});f=(c.serverData.choose_tags||"").split(" ");f.length==1&&f[0]==""&&(f.length=0);g=c.serverData.mblog_tags||[];var b=z.getLabel(),j={labelText:b.text,labelClass:b.className,labelClassS:b.classNameS,uniqueId:a.getUniqueKey()},k=d.length&&e.length?"S_line1":"",l='<#et favouriteBubble data><div class="W_layer W_layer_pop"><div class="content" node-type="inner"><div node-type="eventnode"><div class="W_layer_close"><a node-type="close" href="javascript:;" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_favor_addtags"><div class="W_layer_con_tit W_f14 W_fb"><h1 class="W_f14 W_fb">#L{æ¶èæå}</h1></div><div class="addbox"><div class="W_tips tips_warn clearfix" node-type="tipState"><p class="icon"><span class="W_icon icon_warnS" node-type="tipStateS"></span></p><p class="txt" node-type="labelText">#L{æ·»å æ ç­¾æ¥ç®¡çä½ çæ¶èã}</p></div><dl class="f_normal clearfix" '+(e.length?"":'style="display:none;"')+">"+'<dt class="f_tit">#L{æ¨èæ ç­¾ï¼}</dt>'+'<dd class="f_con">'+'<div class="tags" node-type="dispItemListRecommend">'+"</div>"+"</dd>"+"</dl>"+'<dl class="f_normal clearfix" '+(d.length?"":'style="display:none;"')+">"+'<dt class="f_tit">#L{æçæ ç­¾ï¼}</dt>'+'<dd class="f_con">'+'<div class="tags" node-type="dispItemList">'+"</div>"+"</dd>"+"</dl>"+'<a href="javascript:void(0);" '+(e.length==0&&d.length==0?'style="display:none;"':"")+' action-type="createNew" class="btn_add S_txt1"><em class="W_ficon ficon_add">+</em>#L{åå»ºæ°æ ç­¾}</a>'+'<div class="input_outer W_input_focus" node-type="container" '+(e.length==0&&d.length==0?"":'style="display:none;"')+">"+'<input type="text" class="W_input" name="${data.uniqueId}" id="${data.uniqueId}" node-type="suggestInput" autocomplete="off">'+"</div>"+"</div>"+"</div>"+'<div class="W_layer_btn S_bg1">'+'<a action-type="commitBtn" node-type="commitBtn" href="javascript:;" class="W_btn_a">#L{æ·»å }</a>'+'<a  action-type="cancelBtn" href="javascript:;" class="W_btn_b">#L{åæ¶}</a>'+"</div>"+'<div class="W_layer_arrow">'+'<span node-type="arrow" class="W_arrow_bor W_arrow_bor_t">'+'<i class="S_line3"></i><em class="S_bg2_br"></em>'+"</span>"+"</div>"+"</div>"+'<div node-type="suggestList" class="layer_menu_list" style="position:absolute;z-index:10000;display:none;">'+'<ul node-type="suggestContent">'+"</ul>"+"</div>"+"</div>"+"</#et>",m=t(s(l),j).toString();i=a.ui.bubble({template:m,clickBlankToHide:!0});h=a.lib.kit.dom.parseDOM(a.builder(i.getBox()).list)},x=function(){l=a.delegatedEvent(h.eventnode);l.add("commitBtn","click",z.commitBtn);l.add("createNew","click",z.createNew);l.add("cancelBtn","click",z.cancelBtn);r=a.lib.feed.plugins.favorite.borderedInput(h.suggestInput,{addClass:"W_input_focus",removeClass:"W_input_focus",findEl:function(a){return h.container}})},y=function(){var b=[];d.length&&(b=b.concat(z.buildItems(d)));g.length&&(b=b.concat(z.buildItems(g)));var c={};for(var e=0,f=b.length;e<f;e++)c[b[e].id]=b[e];b.length=0;for(var k in c)b[b.length]=c[k];j=a.lib.feed.plugins.favorite.items.DataItemPicker({resetHeight:!1,limitCount:2,container:i.getBox(),DispItem:!0,DeletedItem:!0,ItemSuggest:!0,DispItemConf:{chosenTpl:'<#et chosenTpl data><#list data as list><span action-type="uncheck" action-data="${list.data}" title="${list.text}" itemid="${list.id}" class="W_btn_b W_btn_tag W_btn_tag_cur"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg1_br"></em></span><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1">${list.text}</a></span></#list></#et>',unChosenTpl:'<#et unChosenTpl data><#list data as list><span action-type="check" action-data="${list.data}" itemid="${list.id}" title="${list.text}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="tag_txt W_autocut S_txt1">${list.text}</a></span></#list></#et>'},DeletedItemConf:{template:function(){return'<#et deleteList data><#list data as list><span itemid="${list.id}" class="W_btn_b W_btn_tag"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span>${list.text}<a href="javascript:void(0);" action-type="remove" action-data="${list.data}" class="W_ficon ficon_close S_ficon">X</a></span></#list></#et>'}()},ItemSuggestConf:{suggestType:"none",suggestList:h.suggestList,suggestConf:{regexp:function(a){return a==="å¨é¨"||a==="æªå æ ç­¾"||a==="æªå æ¨ç±¤"?!1:/^[a-zA-Z0-9\u4e00-\u9fa5_:ï¼]+$/.test(a)?!0:!1},suggestMaxCount:5,itemTagName:"li",currentClass:"cur",template:'<#et suggest data><#list data as list><li action-type="suggestItem" action-data="${list.data}"><a href="javascript:void(0)">${list.text}</a></li></#list></#et>',data:b,searchKey:"text"},maxInputWidth:200,limitWords:12},containerMinHeight:22})},z={deletedItemRemove:function(b,c){var d=a.trim(h.suggestInput.value);z.regExpTest({},{value:d})},commitSucc:function(){a.custEvent.fire(n,"success",{})},commitError:function(b,c){a.custEvent.fire(n,"error",{msg:b.msg})},commitFail:function(){a.custEvent.fire(n,"error",{msg:s("#L{æ ç­¾æ·»å å¤±è´¥}")})},getResultStr:function(){var a=k.getResult(),b=[];for(var c=0,d=a.length;c<d;c++)b.push(a[c].id);return b.join(" ")},cancelBtn:function(b){a.preventDefault(b.evt);i.hide()},realSubmit:function(b){var d=z.getResultStr();b&&(d?d+=" "+b:d=b);if(!d)i.hide();else{var e={mid:c.mid,tags:d};e=a.lib.kit.extra.getDiss(e);o=1;try{h.suggestInput.blur()}catch(f){}a.conf.trans.feed.favorite.request("alter",{onSuccess:z.commitSucc,onError:z.commitError,onFail:z.commitFail},e);i.hide()}},inArray:function(a,b){for(var c=0,d=b.length;c<d;c++)if(b[c].id==a)return!0;return!1},commit:function(){z.commitSuda();var b=a.trim(h.suggestInput.value);if(b){var c=k.getResult();if(c.length>=2){z.setLabel("max");j.focusInput()}else if(!/^[a-zA-Z0-9\u4e00-\u9fa5_:ï¼]+$/.test(b)){z.setLabel("error");j.focusInput()}else{var d=z.inArray(b,c);if(d){z.setLabel("same");j.focusInput()}else z.realSubmit(b)}}else z.realSubmit()},commitBtn:function(b){a.preventDefault(b.evt);o||z.commit()},createNew:function(a){a.el.style.display="none";h.container.style.display="";j.focusInput()},getLabel:function(){return d.length?u.ADD:u.DEFAULT},buildItems:function(a){var b=[];for(var c=0,d=a.length;c<d;c++){var e=a[c];b.push({id:e,data:"id="+e+"&text="+e,text:e})}return b},regExpTest:function(a,b){var c=b.value;if(c==""||/^[a-zA-Z0-9\u4e00-\u9fa5_:ï¼]+$/.test(c)){var d=k.getResultLength();d?z.setLabel("add"):z.setLabel("default")}},backSpaceKey:function(){z.regExpTest({},{value:""})},setLabel:function(a,b){if(a=="right"){var c=z.getLabel();h.labelText.innerHTML=c.text;h.tipState.className=c.className;h.tipStateS.className=c.classNameS}else{var c=u[a.toUpperCase()];h.labelText.innerHTML=b||c.text;h.tipState.className=c.className;h.tipStateS.className=c.classNameS}},inputError:function(a,b){b.value==="å¨é¨"||b.value==="æªå æ ç­¾"||b.value==="æªå æ¨ç±¤"?z.setLabel("error",s("#L{å¯¹ä¸èµ·ï¼ä¸è½ä½¿ç¨æ­¤æ ç­¾}")):z.setLabel("error")},bubbleHide:function(){o||z.closeSuda();C();a.custEvent.remove(i,"hide",arguments.callee)},showFavSucc:function(){o||a.custEvent.fire(n,"success",{blankNoTag:!0});o=undefined;a.custEvent.remove(i,"hide",arguments.callee)},setPos:function(){var b=a.position(c.el);if(!q||q.l!=b.l||q.t!=b.t){q=b;var d=a.builder(i.getBox()).list;i.beside(c.el)}},spaceAddItemSuda:function(){b("favor","input_tag")},checkedDespItemSuda:function(){b("favor","click_tag")},closeSuda:function(){b("favor","identify_cancel")},commitSuda:function(){b("favor","identify_do")}},A=function(){a.custEvent.define(n,["success","error"]);a.custEvent.add(j,"textChange",z.regExpTest);a.custEvent.add(j,"inputError",z.inputError);a.custEvent.add(j,"keyboardSubmit",z.commit);a.custEvent.add(j,"backspaceKey",z.backSpaceKey);a.custEvent.add(j,"DeletedItemRemove",z.deletedItemRemove);a.custEvent.add(j,"spaceAddItem",z.spaceAddItemSuda);a.custEvent.add(j,"checkedDespItem",z.checkedDespItemSuda)},B=function(){var b=j.getDispItem(),h=z.buildItems(d.slice(0,5));b.addItems(h,{type:"unChosen"});if(f.length){h=z.buildItems(f.slice(0,5));b.fireDelegateCheck(h)}if(e.length){h=z.buildItems(e.slice(0,5));b.addDefalutItems(h,{type:"unChosen"})}var l=j.getDeletedItem(),m=z.buildItems(g);l.addItems(m);b.setCheckedItems(m);k=j.getDataController();k.addItems(m);document.body.appendChild(i.getBox());i.show();a.custEvent.add(i,"hidden",z.showFavSucc);a.custEvent.add(i,"hidden",z.bubbleHide);z.setPos();q=a.position(c.el);p=setInterval(z.setPos,1e3);j.resetHeight()},C=function(){r&&r.destroy&&r.destroy();clearInterval(p);l&&l.destroy();j&&j.destroy();a.removeNode(i.getBox());i&&i.destroy();a.custEvent.undefine(j);d=g=j=k=l=m=p=q=undefined;h=p=s=t=u=z=B=D=C=r=undefined},D=function(){v();w();x();y();A();a.lib.kit.touch.cantouch||B()};D();n.destroy=C;return n}});
STK.register("lib.feed.plugins.favorite.init",function(a){var b=a.lib.kit.extra.language,c,d=b('<span class="pos"><span class="line S_line1">#L{åæ¶æ¶è}</span></span>'),e=b('<span class="pos"><span class="line S_line1">#L{æ¶è}</span></span>'),f=b("#L{åæ¶æ¶è}"),g=b("#L{æ¶è}"),h,i,j=function(){window.location.href="/fav";return},k=function(i,k,l,m,n,o,p,q){h&&h.destroy();var r=!0;n===!1&&o===!0&&(r=!1);h=a.lib.feed.plugins.favorite.favorite({showTip:r,mid:m,node:k,bubbleEl:q,mark:p,dissDataFromFeed:a.lib.kit.extra.getDiss(l)});if(!h)a.log("favoriteObj is undefined!");else{var s=a.sizzle(">span",k).length?d:f;a.custEvent.add(h,"success",function(d,e){if(n&&!o){h&&h.destroy();l.style.height=l.offsetHeight+"px";l.innerHTML="";var f=a.tween(l,{end:function(){f.destroy();a.removeNode(l);k=l=null;var b=a.lib.kit.extra.parseURL(),c=a.core.json.queryToJson(b.query),d="";b.path=="fav"&&(d="page");a.custEvent.fire(i,"request",[d,c]);i.getFeedCount()<1&&j()}}).play({height:0})}else{k.innerHTML=s;k.setAttribute("favorite",o?"1":"0");if(o&&e.data&&e.data.ispower){k.setAttribute("tagBubble","1");try{var g=a.lib.feed.plugins.favorite.tagBubble({mid:m,el:q||k,serverData:e.data||{}})}catch(p){console.log(p)}a.custEvent.add(g,"success",function(b,c){a.custEvent.undefine(g);g=undefined;c.blankNoTag||h.showSuccTip(q||k);k.removeAttribute("tagBubble")});a.custEvent.add(g,"error",function(c,d){a.custEvent.undefine(g);g=undefined;h.showErrTip(q||k,d.msg||b("#L{æ ç­¾æ·»å å¤±è´¥}"));k.removeAttribute("tagBubble")})}}c=null});a.custEvent.add(h,"fail",function(){c=null});a.custEvent.add(h,"error",function(){c=null});a.custEvent.add(h,"cancel",function(){c=null});if(o)h.add();else{s=a.sizzle(">span",k).length?e:g;h.del()}}},l=function(a,b,d,e,f,g){var j=b.el,l=i.getMid(j,d),m=b.data.mark,n=i.getFeedNode(j,d);if(c!=l){j.getAttribute("tagBubble")&&setTimeout(function(){h&&h.msgTipDetroy()},0);c=l;var o=j.getAttribute("favorite")!="1";k(a,j,n,l,e,o,m,g)}};return function(b,c){if(!b)a.log("favorite : need object of the baseFeedList Class");else{c=a.parseParam({isFavoritePage:!1},c);i=b.utils;var d=b.getNode(),e={};a.custEvent.define(e,"showForward");var f=function(f){a.custEvent.fire(b,"clearTips","favorite");var g=f.el,h=g.dataset&&g.dataset.mark||g.getAttribute("data-mark")||"",j={};h&&(j=a.queryToJson(h));f.data=a.core.json.merge(f.data,j);l(b,f,d,c.isFavoritePage,e,f.bubbleEl);return i.preventDefault(f.evt)};b.getDEvent().add("fl_favorite","click",f);b.regCustEvent("fl_favorite_plus",function(a,b){f(b)});e.hideTip=function(a){h&&(a?h.hideTip():h.anihideTip());setTimeout(function(){h&&h.msgTipDetroy()},0)};e.destroy=function(){h&&h.destroy()};return e}}});
STK.register("lib.kit.dom.rotateImage",function(a){var b={},c=function(c){var d=a.core.dom.uniqueID(c);return b[d]||(b[d]={})},d={0:0,90:1,180:2,270:3},e=function(a,b){a=((b||0)+a)%360;a<0&&(a=360+a);var c=Math.PI*a/180,d=Math.round(Math.cos(c)*Math.pow(10,15))/Math.pow(10,15),e=Math.round(Math.sin(c)*Math.pow(10,15))/Math.pow(10,15);return{sin:e,cos:d,M11:d,M12:-e,M21:e,M22:d,angle:a,rotation:c}},f=function(b,c,f,g){f=f||440;var h=e(c,g.oldAngle);c=g.oldAngle=h.angle;b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11="+h.M11+",M12="+h.M12+",M21="+h.M21+",M22="+h.M22+",SizingMethod='auto expand')";a.setStyle(b.parentNode,"position","relative");if(d[c]%2==0){b.width=g.originalWidth;b.height=g.originalHeight;a.setStyle(b.parentNode,"height",b.height+"px");a.setStyle(b,"position","static")}else if(d[c]%2==1){b.height=g.originalHeight>f?f:g.originalHeight;b.width=b.height*g.originalWidth/g.originalHeight;a.setStyle(b.parentNode,"height",b.width+"px");a.setStyle(b,"position","absolute");a.setStyle(b,"left",Math.abs((b.parentNode.offsetWidth-b.height)/2)+"px");a.setStyle(b,"top","0")}},g=function(a,b,c,d){var e=a;d.oldAngle=e.angle=((e.angle==undefined?0:e.angle)+b)%360;if(e.angle>=0)var f=Math.PI*e.angle/180;else var f=Math.PI*(360+e.angle)/180;var g=Math.cos(f),h=Math.sin(f),i=document.createElement("canvas");e.oImage?i.oImage=e.oImage:i.oImage=e;var j=new Image;j.onload=function(){i.style.width=i.width=Math.abs(g*j.width)+Math.abs(h*j.height);i.style.height=i.height=Math.abs(g*j.height)+Math.abs(h*j.width);if(i.width>c){i.style.width=c+"px";i.style.height=c*j.width/j.height+"px"}var a=i.getContext("2d");a.save();f<=Math.PI/2?a.translate(h*j.height,0):f<=Math.PI?a.translate(i.width,-g*j.height):f<=1.5*Math.PI?a.translate(-g*j.width,i.height):a.translate(0,-h*j.width);a.rotate(f);try{a.drawImage(j,0,0,j.width,j.height)}catch(b){}a.restore();i.angle=e.angle;e.parentNode.replaceChild(i,e);i.id=e.id;j.onload=null};j.src=i.oImage.src;return i},h=function(){var a=["transform","MozTransform","webkitTransform","OTransform"],b=0,c=document.createElement("div").style;while(a[b]&&!(a[b]in c))++b;return a[b]}(),i=function(b,c,f,g){var i=e(c,g.oldAngle),j;c=g.oldAngle=i.angle;if(!g.rotated){g.rotated=!0;j=a.C("div");j.style.position="relative";g.textAlign=j.style.textAlign=a.getStyle(b.parentNode,"textAlign");b.parentNode.insertBefore(j,b);j.appendChild(b);b.style.position="absolute"}else j=b.parentNode;if(d[c]%2==0){g.originalWidth>f?g.imgViewWidth=b.width=f:g.imgViewWidth=b.width=g.originalWidth;g.imgViewHeight=b.height=g.originalHeight}else if(d[c]%2==1){g.originalHeight>f?g.imgViewWidth=b.height=f:g.imgViewWidth=b.height=g.originalHeight;g.imgViewHeight=b.width=b.height*g.originalWidth/g.originalHeight}j.style.height=g.imgViewHeight+"px";f>j.offsetWidth&&(j.style.width=f+"px");b.style[h]="matrix("+i.M11+","+i.M21+","+i.M12+","+i.M22+", 0, 0)";var k=(g.imgViewHeight-g.imgViewWidth)/2,l=(g.imgViewWidth-g.imgViewHeight)/2;if(d[c]%2==0){b.style.top="0px";g.textAlign=="center"?b.style.left=(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]="0px"}else{b.style.top=k+"px";g.textAlign=="center"?b.style.left=l+(j.offsetWidth-g.imgViewWidth)/2+"px":b.style[g.textAlign=="right"?"right":"left"]=l+"px"}},j=function(b,d,e){var j=c(b);if(!("originalWidth"in j)){j.originalWidth=b.width;j.originalHeight=b.height}e||(e=j.originalWidth);h?i(b,d,e,j):"getContext"in a.C("canvas")?g(b.canvas?b.canvas:b,d,e,j):"filters"in a.C("div")&&f(b,d,e,j)},k={rotateRight:function(a,b,c){j(a,b==undefined?90:b,c)},rotateLeft:function(a,b,c){j(a,b==undefined?-90:-b,c)},rotateDefault:function(a){var b=c(a);b.oldAngle&&j(a,360-b.oldAngle,b.originalWidth)},removeDataCache:function(c){var d=a.uniqueID(c),e;if(h)if(e=c.parentNode&&c.parentNode.parentNode){c.parentNode.parentNode.insertBefore(c,e);a.removeNode(e)}b[d]&&delete b[d]},destroy:function(){b={}}};return k});
STK.register("lib.kit.dom.fix",function(a){function f(c,e,f){if(!!d(c)){var g="fixed",h,i,j,k,l=c.offsetWidth,m=c.offsetHeight,n=a.core.util.winSize(),o=0,p=0,q=a.core.dom.cssText(c.style.cssText);if(!b){g="absolute";var r=a.core.util.scrollPos();o=h=r.top;p=i=r.left;switch(e){case"lt":h+=f[1];i+=f[0];break;case"lb":h+=n.height-m-f[1];i+=f[0];break;case"rt":h+=f[1];i+=n.width-l-f[0];break;case"rb":h+=n.height-m-f[1];i+=n.width-l-f[0];break;case"c":default:h+=(n.height-m)/2+f[1];i+=(n.width-l)/2+f[0]}j=k=""}else{h=k=f[1];i=j=f[0];switch(e){case"lt":k=j="";break;case"lb":h=j="";break;case"rt":i=k="";break;case"rb":h=i="";break;case"c":default:h=(n.height-m)/2+f[1];i=(n.width-l)/2+f[0];k=j=""}}if(e=="c"){h<o&&(h=o);i<p&&(i=p)}q.push("position",g).push("top",h+"px").push("left",i+"px").push("right",j+"px").push("bottom",k+"px");c.style.cssText=q.getCss()}}function e(b){b=a.core.arr.isArray(b)?b:[0,0];for(var c=0;c<2;c++)typeof b[c]!="number"&&(b[c]=0);return b}function d(b){return a.core.dom.getStyle(b,"display")!="none"}var b=!(a.core.util.browser.IE6||document.compatMode!=="CSS1Compat"&&STK.IE),c=/^(c)|(lt)|(lb)|(rt)|(rb)$/;return function(d,g,h){var i,j,k=!0,l;if(a.core.dom.isNode(d)&&c.test(g)){var m={getNode:function(){return d},isFixed:function(){return k},setFixed:function(a){(k=!!a)&&f(d,i,j);return this},setAlign:function(a,b){if(c.test(a)){i=a;j=e(b);k&&f(d,i,j)}return this},destroy:function(){b||b&&a.core.evt.removeEvent(window,"scroll",n);a.core.evt.removeEvent(window,"resize",n);a.core.evt.custEvent.undefine(l)}};l=a.core.evt.custEvent.define(m,"beforeFix");m.setAlign(g,h);function n(c){c=c||window.event;a.core.evt.custEvent.fire(l,"beforeFix",c.type);k&&(!b||i=="c")&&f(d,i,j)}b||a.core.evt.addEvent(window,"scroll",n);a.core.evt.addEvent(window,"resize",n);return m}}});
STK.register("lib.face.magic",function(a){var b=a.core.util.swf,c=a.ui.mask,d,e,f,g,h,i,j,k=(new Date).getTime()+"",l=(Math.random()+"").replace(".",""),m="STK_flash_"+k+l,n=function(b){if(!d){d=a.C("div");if(!b)d.style.cssText="display:none;width:440px;height:360px;z-index:100000;";else{var c=a.core.util.winSize();d.style.cssText="display:none;width:"+c.width+"px;height:"+c.height+"px;z-index:100000;"}e=a.core.dom.uniqueID(d);h=function(b){b=a.fixEvent(b||window.event);b.target.getAttribute("name")!=e&&o.hide()};document.body.appendChild(d)}},o=function(k,l,p){j=typeof l=="function"?l:a.funcEmpty;p=a.parseParam({isV5update:!1},p);n(p.isV5update);if(!f){f=!0;c.showUnderNode(d);a.addEvent(c.getNode(),"click",h);c.getNode().title="ç¹å»å³é­";d.style.display="";if(!p.isV5update){g?g.setAlign("c"):g=a.lib.kit.dom.fix(d,"c");d.innerHTML=b.html(k,{id:e,width:440,height:360,paras:{allowScriptAccess:"never",wmode:"transparent"},attrs:{name:e},flashvars:{playMovie:"true"}})}else{g?g.setAlign("lb"):g=a.lib.kit.dom.fix(d,"lb");_closeFun=function(){o.hide()};d.innerHTML=b.html(k,{id:e,width:"100%",height:"100%",paras:{menu:"false",scale:"noScale",allowFullscreen:"false",allowScriptAccess:"always",bgcolor:"#FFFFFF",wmode:"transparent",base:"http://flashcrossdomain.mps.weibo.com/t5/home/static/upgrade/v5/"},attrs:{name:e},flashvars:{closeAPI:m,v:$CONFIG.version,bgMusic:"http://service.weibo.com/staticjs/v5/bg001.mp3"}})}clearInterval(i);i=setInterval(function(){var a=document[e]||window[e],b=0;if(a&&a.PercentLoaded()==100){clearInterval(i);i=setInterval(function(){var c=a.CurrentFrame(),d;try{d=a.TotalFrames()}catch(e){d=a.TotalFrames}c<0||(c<d&&b<=c?b=c:o.hide())},80)}},100)}};o.hide=function(){clearInterval(i);if(d){d.style.display="none";a.lib.face.destroyFlash(a.sizzle("embed,object",d)[0]);d.innerHTML=""}a.removeEvent(c.getNode(),"click",h);c.getNode().title="";c.back();f=!1;setTimeout(function(){typeof j=="function"&&j()},0);return o};o.destroy=function(){o.hide();g&&g.destroy();a.removeNode(d);i=d=e=f=g=h};window[m]=function(){o.hide()};return o});
STK.register("lib.feed.widget",function(a){var b={};return{add:function(c,d){if(!b[c]){b[c]=a.widget.parse(d);b[c].init()}},clear:function(a){if(b[a]){b[a].destroy();delete b[a]}},destroy:function(){for(var a in b){b[a].destroy();delete b[a]}}}});
STK.register("lib.kit.extra.actionData",function(a){return function(b){return{set:function(c,d){if(!!a.isNode(b)){var e=a.queryToJson(b.getAttribute("action-data")||"")||{};e[c]=d;b.setAttribute("action-data",a.jsonToQuery(e))}},del:function(c){if(!!a.isNode(b)){var d=a.queryToJson(b.getAttribute("action-data")||"")||{};delete d[c];b.setAttribute("action-data",a.jsonToQuery(d))}},get:function(c){if(!a.isNode(b))return"";var d=a.queryToJson(b.getAttribute("action-data")||"")||{};return d[c]||""}}}});
STK.register("conf.trans.feed.attitude",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedSmall",{url:"/aj/attitude/small",method:"get"});c("add",{url:"/aj/attitude/add",method:"post"});c("big",{url:"/aj/v6/attitude/big",method:"get"});c("in",{url:"/aj/attitude/in",method:"get"});c("del",{url:"/aj/attitude/destroy",method:"get"});c("miniadd",{url:"/aj/v6/like/add",method:"post"});c("minismall",{url:"/aj/v6/like/small",method:"get"});c("likein",{url:"/aj/like/in",method:"get"});c("likebig",{url:"/aj/v6/like/big",method:"get"});c("minidel",{url:"/aj/like/del",method:"post"});c("objLike",{url:"/aj/v6/like/objectlike",method:"post"});c("photosmall",{url:"/aj/v6/like/object/photosmall",method:"get"});c("cmtLike",{url:"/aj/v6/like/object/small",method:"get"});c("cmtLikeMore",{url:"/aj/like/object/big",method:"get"});c("likeStatus",{url:"/aj/like/status",method:"get"});return b});
STK.register("lib.feed.plugins.like.likestatus",function(a){var b={},c={},d=a.conf.trans.feed.attitude,e=function(a,c,e){d.getTrans("likeStatus",{onSuccess:function(c){var d=c.data.count,f=c.data.exists;for(var g in d){!b[g]&&(b[g]={});b[g].count=d[g]}for(var g in f)b[g].exits=f[g];e(b[a],b)},onError:function(){},onFail:function(){}}).request({object_ids:c})};return e});
STK.register("lib.kit.extra.feedControlHash",function(a){var b=$CONFIG.g_mathematician||0;return function(){var c=Math.random();c<=b&&a.lib.kit.extra.setPlainHash("_rnd"+(+(new Date)).toString())}});
STK.register("lib.image.multiimage.hastags",function(a){var b={};return function(){return{add:function(a){if(!!a){_tags=a.split(",");for(var c in _tags)b[_tags[c]]=!0}},check:function(a){return!!b[a]}}}});
STK.register("lib.image.multiimage.showtag",function(a){var b='<#et temp data><a  title="${data.content}" node-type="tag"  action-type="tag" <#if (data.url)>target="_blank" href="${data.url}" class="tag_showpic${data.offset} tag_show${data.flag_type}${data.offset}"<#else>href="javascript:void(0);" onclick="return false;" class="tag_showpic${data.offset}"</#if> style="left:${data.left}px;top:${data.top}px;white-space: nowrap;"><span <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> class="inner"><#if (data.flag == "#")><em node-type="tagmove" class="txt W_autocut">${data.content}</em></#if><#if (data.flag == "@")><i class="codetag">@</i><em <#if (data.tag_uid)>usercard="id=${data.tag_uid}"</#if> node-type="tagmove" class="txt W_autocut">${data.content}</em></#if><#if (data.isshow != 1)><span action-type="removeTag" class="W_ficon ficon_close S_ficon" title="å³é­">X</span></span></a></#if></#et>',c={};return function(d){function m(b,c){if(!b)return!1;var e,f=0,g=b.getAttribute("src"),h=a.C("img");h.onload=function(){e=setInterval(function(){f++;f>50&&e&&clearInterval(e);b||e&&clearInterval(e);if(b.parentNode){e&&clearInterval(e);d.container=b.parentNode;c&&c()}},100)};g&&(h.src=g)}function j(a,b){if(typeof a!="string")return a;b&&(a=a.replace(/\&/g,"&amp;"));return a.replace(/"/g,"&quot;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\'/g,"&#39;").replace(/(\u0020|\u000B|\u2028|\u2029|\f)/g,"&#32;")}var e={},f=a.conf.trans.image,g=[],h=!0,i=function(a,b){if(!a||a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},k={getRPos:function(b,c,d){var e=a.position(b),f=a.position(c),g=a.core.dom.getSize(c),h={left:f.l-e.l+g.width*d.x-5,top:f.t-e.t+g.height*d.y-15};h={left:h.left>0?h.left:0,top:h.top>0?h.top:0};h.offset=d.x>.5?"R":"L";return h},offsetTar:function(b,c){if(c=="R"){var d=a.core.dom.getSize(b);b.style.marginLeft=0-d.width+12+"px"}else b.style.marginLeft=""},createTag:function(c,e){if(!!h){var f={};for(var i in e)f[i]=e[i];f.content=j(f.content);f.flag_type={"@":"User","#":"Topic"}[f.flag];var l=a.core.util.easyTemplate(b,f).toString(),m=a.lib.kit.dom.parseDOM(a.builder(l).list);d.container.appendChild(m.tag);k.offsetTar(m.tag,e.offset);m.tag.setAttribute("tag-id",c);g.push(m.tag);d.from!="add"&&a.addEvent(m.tag,"click",k.stopEvent)}},fixData:function(b){for(var c in b){var e=k.getRPos(d.container,d.img,{x:b[c].pos_x,y:b[c].pos_y});e.flag={user:"@",topic:"#"}[b[c].tag_type]||"@";e.content=a.encodeHTML(b[c].tag_name);e.url=b[c].url;!d.fromLayer&&e.flag=="@"&&b[c].url&&(e.tag_uid=b[c].tag_id.replace("1042:",""));e.isshow=1;k.createTag(c,e)}k.bindEvent()},showtags:function(a){if(!!i(a||window.event,d.container)){if(d.img.style.cssText.toLowerCase().indexOf("filter")!=-1&&!d.fromLayer)return;if(d.container!=d.img.parentNode){k.hidetags();return}for(var b in g)g[b].style.display=""}},hidetags:function(a){if(!!i(a||window.event,d.container))for(var b in g)g[b].style.display="none"},bindEvent:function(){a.addEvent(d.container,"mouseover",k.showtags);a.addEvent(d.container,"mouseout",k.hidetags)},removetags:function(){var b=a.sizzle('[node-type="tag"]',d.container);for(var c in b)b[c]&&a.removeNode(b[c])},stopEvent:function(b){b=a.fixEvent(b);b.cancelBubble=!0;b.stopPropagation&&b.stopPropagation()}},l=function(){},n=function(){if(!d.container){if(!d.img)return;d.container=d.img.parentNode}if(!d.tags){if(c[d.postdata.pid]){m(d.img,function(){k.fixData(c[d.postdata.pid])});return}if(!a.lib.image.multiimage.hastags().check(d.postdata.pid)&&!d.fromLayer)return;f.getTrans("viewTags",{onSuccess:function(a){for(var b in a.data){c[d.postdata.pid]=a.data[b].pic_tags;m(d.img,function(){k.fixData(a.data[b].pic_tags)})}},onError:function(a){c[d.postdata.pid]=[]}}).request(d.postdata)}else for(var b in d.tags)k.createTag(b,d.tags[b])};n();var o=function(){a.removeEvent(d.container,"mouseover",k.showtags);a.removeEvent(d.container,"mouseout",k.hidetags);k.hidetags();k.removetags();h=null;g=null};e.rend=l;e.destroy=o;return e}});
STK.register("lib.kit.extra.loadImageInBackground",function(a){function f(b){a.foreach([].concat(b),function(a){a&&c.push(a)});d()}function e(a,c){b[a]&&c();var d=function(){clearTimeout(e);b[a].onload=b[a].onerror=null;c()},e=setTimeout(d,2e3);b[a]=new Image;b[a].onload=b[a].onerror=d;b[a].src=a}function d(){var a=c.shift();a&&e(a,function(){d()})}var b={},c=[];return f});
STK.register("lib.publisher.widget.count",function(a){function b(b){var c=41,d=140,e=20,f=b,g=b.match(/http:\/\/[a-zA-Z0-9]+(\.[a-zA-Z0-9]+)+([-A-Z0-9a-z_\$\.\+\!\*\(\)\/,:;@&=\?\~\#\%]*)*/gi)||[],h=0;for(var i=0,j=g.length;i<j;i++){var k=a.core.str.bLength(g[i]);if(/^(http:\/\/t.cn)/.test(g[i]))continue;/^(http:\/\/)+(t.sina.com.cn|t.sina.cn)/.test(g[i])||/^(http:\/\/)+(weibo.com|weibo.cn)/.test(g[i])?h+=k<=c?k:k<=d?e:k-d+e:h+=k<=d?e:k-d+e;f=f.replace(g[i],"")}var l=Math.ceil((h+a.core.str.bLength(f))/2);return l}return function(a){a=a.replace(/\r\n/g,"\n");return b(a)}});
STK.register("conf.trans.publishTo",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("list",{url:"/aj/f/group/list",method:"get"});c("chatlist",{url:"/aj/f/groupchat/list",method:"get"});return b});
STK.register("lib.publisher.widget.keyboardCapture",function(a){var b={13:"enter",27:"esc",32:"space",38:"up",40:"down",9:"tab"};return function(c,d){d=d||{};var e={},f,g={keydown:function(c){d.stopScroll&&a.stopEvent();var f,g;!!(f=c)&&!!(g=f.keyCode)&&b[g]&&a.custEvent.fire(e,b[g])}},h={init:function(){h.pars();h.bind()},pars:function(){},bind:function(){for(var b in g)a.addEvent(c,b,g[b])},getKey:function(a){return b[a]},destroy:function(){for(var b in g)a.removeEvent(c,b,g[b])}};h.init();e.getKey=h.getKey;e.destroy=h.destroy;return e}});
STK.register("lib.kit.dom.textSelection",function(a){return function(b,c){var d,e;d={};e=a.parseParam({},c);var f=function(c){return a.core.dom.selectText(b,c)},g=function(){b.__areaQuery=a.jsonToQuery(a.core.dom.textSelectArea(b))},h=function(){b.__areaQuery=!1};a.addEvent(b,"beforedeactivate",g);a.addEvent(b,"active",h);var i=function(){var c=null;try{c=a.core.dom.textSelectArea(b)}catch(d){c=a.queryToJson(b.__areaQuery)}c.start===0&&c.len===0&&b.__areaQuery&&(c=a.queryToJson(b.__areaQuery));c.start=parseInt(c.start,10);c.len=parseInt(c.len,10);return c},j=function(a,c){var d=b.value,e=c.start,f=c.len||0,g=d.slice(0,e),h=d.slice(e+f,d.length);b.value=g+a+h;d=null;g=null;h=null;var e=null,f=null};d.setCursor=function(a){f(a)};d.getCursor=function(){return i()};d.insertCursor=function(a){var b=i();j(a,b);b.len=a.length;f(b)};d.TempletCursor=function(c){var d,e,g;d=i();d.len>0?e=b.value.substr(d.start,d.len):e="";g=a.templet(c,{origin:e});j(g,d);d.start=d.start+c.indexOf("#{origin");d.len=g.length-c.replace(/#\{[origin].+?\}/,"").length;f(d)};d.insertText=j;d.destroy=function(){a.removeEvent(b,"beforedeactivate",g);a.removeEvent(b,"active",h);b=null};return d}});
STK.register("lib.kit.dom.smartInput",function(a){return function(b,c){var d,e,f,g,h,i,j,k,l,m="stop",n,o,p,q,r;d=a.parseParam({notice:"",currentClass:null,noticeClass:null,noticeStyle:null,maxLength:null,needLazyInput:!1,LazyInputDelay:200},c);e=a.cascadeNode(b);h=a.lib.kit.dom.textSelection(b);a.custEvent.define(e,"enter");a.custEvent.define(e,"ctrlEnter");a.custEvent.define(e,"lazyInput");f=function(){d.maxLength&&a.bLength(b.value)>d.maxLength&&(b.value=a.leftB(b.value,d.maxLength))};o=function(){if(b.value===d.notice){b.value="";d.noticeClass!=null&&a.removeClassName(b,d.noticeClass)}d.currentClass!=null&&a.addClassName(b.parentNode,d.currentClass)};p=function(){if(b.value===""){b.value=d.notice;d.noticeClass!=null&&a.addClassName(b,d.noticeClass)}d.currentClass!=null&&a.removeClassName(b.parentNode,d.currentClass)};g=function(){f();return b.value===d.notice?"":b.value};q=function(b){b.keyCode===13&&a.custEvent.fire(e,"enter",g())};r=function(b){(b.keyCode===13||b.keyCode===10)&&b.ctrlKey&&a.custEvent.fire(e,"ctrlEnter",g())};i=function(){if(m==="stop"){l=setInterval(k,d.LazyInputDelay);m="sleep"}};j=function(){clearInterval(l);m="stop"};k=function(){if(n===b.value)if(m==="weakup"){a.custEvent.fire(e,"lazyInput",b.value);m="sleep"}else m==="waiting"&&(m="weakup");else m="waiting";n=b.value};if(d.needLazyInput){a.addEvent(b,"focus",i);a.addEvent(b,"blur",j)}a.addEvent(b,"focus",o);a.addEvent(b,"blur",p);a.addEvent(b,"keyup",f);a.addEvent(b,"keydown",q);a.addEvent(b,"keydown",r);e.getValue=g;e.setValue=function(a){b.value=a;f();return e};e.setNotice=function(a){d.notice=a;return e};e.setNoticeClass=function(a){d.noticeClass=a;return e};e.setNoticeStyle=function(a){d.noticeStyle=a;return e};e.setMaxLength=function(a){d.maxLength=a;return e};e.restart=function(){p()};e.startLazyInput=i;e.stopLazyInput=j;e.setCursor=h.setCursor;e.getCursor=h.getCursor;e.insertCursor=h.insertCursor;e.insertText=h.insertText;e.destroy=function(){if(d.needLazyInput){a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p)}j();a.removeEvent(b,"focus",o);a.removeEvent(b,"blur",p);a.removeEvent(b,"keyup",f);a.removeEvent(b,"keydown",q);a.removeEvent(b,"keydown",r);a.custEvent.undefine(e,"enter");a.custEvent.undefine(e,"ctrlEnter");a.custEvent.undefine(e,"lazyInput");h.destroy();e=null};return e}});
STK.register("conf.trans.groupMember",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("create",{url:"/aj/groupchat/create",method:"post"});c("update",{url:"/aj/groupchat/edit",method:"post"});c("userList",{url:"/aj/relation/groupallmembers",method:"get"});c("info",{url:"/aj/groupchat/query",method:"get"});c("setSummary",{url:"/aj/groupchat/setsummary",method:"post"});c("setAdmin",{url:"/aj/groupchat/setadmin",method:"post"});c("unsetAdmin",{url:"/aj/groupchat/unsetadmin",method:"post"});c("suggest",{url:"/aj/groupchat/attention",method:"get"});c("groupList",{url:"/aj/relation/grouplist",method:"get"});c("check",{url:"/aj/groupchat/getuser",method:"get"});c("getUser",{url:"/aj/groupchat/getlist",method:"get"});c("editGroup",{url:"/p/aj/groupchat/updategroupcard",method:"post"});c("fansgroup",{url:"/aj/groupchat/queryjoingroups",method:"get"});c("addFans",{url:"/aj/groupchat/addaffiliation",method:"post"});return b});
STK.register("lib.group.groupMember",function(a){var b='<#et data data><#if (!data.islist)><div node-type="group_fan_tool"><div class="webim_tab_hd" node-type="group_fan_filternav"><div class="hd_mod S_line1 clearfix"><h3 class="W_fl W_fb">#L{æè¿èç³»äºº}</h3><div class="W_fr" ><a href="javascript:void(0);" action-type="group_fans_filter" suda-data="key=button_build_group&value=screen_fans"  action-data="type=2">#L{ç­éç²ä¸}</a></div></div></div><div  node-type="group_fan_nav" style="display:none;"><div class="webim_tab_hd hd_two S_line1"><div class="back"><a href="javascript:void(0);" suda-data="key=button_build_group&value=back" action-type="group_fan_back" action-data="type=1" class="S_txt1"><em class="W_ficon ficon_back S_ficon">Â«</em></a></div><p class="title W_fb">#L{ç­éç²ä¸}</p></div><div class="webim_tab_btn"><div class="WB_minitab"><ul class="minitb_ul S_line1 S_bg1 clearfix"><li class="minitb_item current S_line1" action-type="group_fan_tab" suda-data="key=button_build_group&value=intera_group"  node-type="group_fan_tab" action-data="type=2"><a href="javascript:void(0);" class="minitb_lk S_txt1 S_bg2" node-type="group_fan_tabtext">#L{å¿ è¯åº¦}</a><span class="cur_block"></span></li><li class="minitb_item S_line1" action-type="group_fan_tab" suda-data="key=button_build_group&value=fans" node-type="group_fan_tab" action-data="type=3"><a href="javascript:void(0);" class="minitb_lk S_txt1" node-type="group_fan_tabtext">#L{ç²ä¸æ°}</a><span class="cur_block"></span></li></ul></div></div></div></div><div class="webim_tab_bd" ><div class="webim_contacts_group" node-type="group_fan_scrollC"><ul class="webim_contacts_list" node-type="group_list_c"></#if><#list data.list as item><li class="contacts SW_fun_bg clearfix" action-type="add_group_member"  action-data="uid=${item.id}&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="å¾®åä¸ªäººè®¤è¯" class="W_icon icon_approve"></i></#if></div><div class="icon_add W_fr"><a href="javascript:void(0);"   class="W_ficon ficon_add S_ficon">+</a></div></li></#list><#if (!data.islist)></ul></div></div></#if></#et>';return function(c,d){var e={offest:50,isloading:!1,trans:"",page:1,isEnd:!1,extraParam:{}},f=a.lib.kit.extra.language;d=a.parseParam({isAjax:!0,members:""},d||{});var g={},h,i,j,k=a.conf.trans.groupMember,l={getData:function(){i&&clearInterval(i);e.trans&&e.trans.abort();e.isloading=!0;var c=e.extraParam;c.page=e.page;e.trans=k.getTrans("getUser",{onSuccess:function(c){var d={list:c.data.users,islist:!0},g=a.core.util.easyTemplate(f(b),d).toString();e.isloading=!1;h.group_list_c.innerHTML=g;uiscroll.reset();i=setInterval(l.srcollEvent,200)},onFail:function(){e.isloading=!1},onError:function(){e.isloading=!1}}).request(c)},srcollEvent:function(){if(!e.isloading){if(e.isEnd){clearInterval(i);return}if(uiscroll.scrollHeight()-uiscroll.offsetHeight()-uiscroll.scrollTop()<=e.offest){e.isloading=!0;e.page=e.page+1;e.trans&&e.trans.abort();var c=e.extraParam;c.page=e.page;e.trans=k.getTrans("getUser",{onSuccess:function(c){var d={list:c.data.users,islist:!0},g=a.core.util.easyTemplate(f(b),d).toString();e.isloading=!1;a.core.dom.insertHTML(h.group_list_c,g,"beforeend");e.page>=c.data.total_page&&(e.isEnd=!0)},onFail:function(){e.page=e.page-1;e.isloading=!1},onError:function(){e.page=e.page-1;e.isloading=!1}}).request(c)}}},addGroupMember:function(b){a.custEvent.fire(g,"addMember",b.data)},addGroupInject:function(a){return!1},groupFanBack:function(a){h.group_fan_filternav.style.display="";h.group_fan_nav.style.display="none";e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=a.data;l.setListHeight();l.getData()},tabDomchange:function(b){var c;a.foreach(h.group_fan_tab,function(b,d){c=a.sizzle('[node-type="group_fan_tabtext"]',b)[0];c&&a.core.dom.removeClassName(c,"S_bg2");a.core.dom.removeClassName(b,"current")});c=a.sizzle('[node-type="group_fan_tabtext"]',b)[0];a.core.dom.addClassName(b,"current");c&&a.core.dom.addClassName(c,"S_bg2")},groupFanTab:function(b){if(!a.core.dom.hasClassName(b.el,"current")){l.tabDomchange(b.el);e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=b.data;l.setListHeight();l.getData()}},groupFansFilter:function(a){h.group_fan_filternav.style.display="none";h.group_fan_nav.style.display="";e.page=1;e.isloading=!1;e.isEnd=!1;e.extraParam=a.data;l.setListHeight();l.tabDomchange(h.group_fan_tab[0]);l.getData()},setListHeight:function(){var a=h.group_fan_tool.offsetHeight;h.group_fan_scrollC.style.height=d.height-a+"px"}},m=function(){h=a.lib.kit.dom.parseDOM(a.builder(c).list)},n=function(){var b=a.delegatedEvent(c);a.custEvent.define(g,["addMember","addGroup","getUserInfo"]);b.add("add_group_member","click",l.addGroupMember);b.add("add_group_inject","click",l.addGroupInject);b.add("group_fans_filter","click",l.groupFansFilter);b.add("group_fan_tab","click",l.groupFanTab);b.add("group_fan_back","click",l.groupFanBack)},o=function(){n();k.getTrans("getUser",{onSuccess:function(d){var j={list:d.data.users},k=a.core.util.easyTemplate(f(b),j).toString(),n={currUser:d.data.viewer,addUser:d.data.members};a.custEvent.fire(g,"getUserInfo",n);c.innerHTML=k;m();l.setListHeight();uiscroll=a.ui.scrollView(h.group_fan_scrollC);e.page>=d.data.total_page&&(e.isEnd=!0);i=setInterval(l.srcollEvent,200)},onFail:function(){},onError:function(){}}).request({page:1,members:d.members})};o();g.setHeight=function(a){d.height=a;l.setListHeight();uiscroll.reset()};g.destroy=function(){i&&clearInterval(i);dEvent.destroy()};return g}});
STK.register("lib.group.gmemberSelect",function(a){return function(b){var c=a.lib.kit.extra.language,d={ENTER:13,ESC:27,UP:38,DOWN:40,LEFT:37,RIGHT:39},e=500,f="",g,h,i,j,k=!1,l,m='<div class="W_layer"><div class="content group_content"><div class="W_layer_hd"><div class="h_name_box clearfix" node-type="groupNamePanel"><p class="h_name W_fl W_autocut W_f14" node-type="titleText"></p><div class="h_change W_fl" action-type="editGroupName" suda-data="key=button_build_group&value=rev_name_group"  node-type="editGroupName" title="#L{ä¿®æ¹ç¾¤åç§°}"><em class="W_ficon ficon_edit S_ficon">7</em><span>#L{ä¿®æ¹ç¾¤åç§°}</span></div></div><div class="h_change_box clearfix" node-type="editGroupFrom" style="display:none;"><input name="" type="text" node-type="group_edit_input"  class="W_input W_fl" value="#L{è¾å¥ç¾¤åç§°}"><a href="javascript:void(0);" class="W_btn_a W_fl" action-type="subimtEditGroup">#L{ä¿å­åç§°}</a><a href="javascript:void(0);" class="W_btn_b W_fl" action-type="cannelEditGroup">#L{åæ¶}</a></div><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div></div><div class="layer_msg_group"><ul class="group_nav S_line1 clearfix"><li class="W_fl S_line1 S_bg1 g_first">#L{æ·»å ç¾¤æå}</li><li class="W_fl S_bg1">å·²ææå ( <span class="online" node-type="group_all_count">0</span>/<span class="all" node-type="maxConut">500</span> )<a href="http://weibo.com/" class="group_nav_href" node-type="batManage" style="display:none;">#L{æ¹éç®¡ç}</a> </li></ul><div class="group_members clearfix"><div class="add_box S_bg1 W_fl"><div class="a_serch"><span class="WB_search_s"><input type="text" value="#L{æ¥æ¾èç³»äºº}"  class="W_input" node-type="group_search_input"><span class="pos"><a href="javascript:void(0);" title="#L{æ¥æ¾èç³»äºº}" class="W_ficon ficon_search S_ficon">f</a></span></span></div><div class="webim_contacts_bd" node-type="groupSelect"><div  node-type="groupMember"></div><div class="webim_tab_bd"><div node-type="searchLists" style="display:none;"></div></div></div></div><div class="existing_box W_fl"><div class="webim_contacts_bd" node-type="existing_box"><div class="webim_tab_bd"><div node-type="addUserLists" style="display:none;"><div class="webim_contacts_group mt10"><div class="webim_group_title webim_existing_title"><a href="javascript:void(0);" class="group_title_cont S_txt1"><span class="name" node-type="addUserCount"></span></a></div><ul class="webim_contacts_list" node-type="addUserListsContain"></ul></div><div class="W_layer_line S_line2" node-type="line" style="display:none;"></div></div><div class="webim_contacts_group mt10" node-type="joinMemberList"></div><div node-type="joinMemberListContain"></div></div></div></div></div></div><div class="W_layer_btn S_line1 S_bg1"><a href="javascript:void(0);" node-type="editsubmitBtn" action-type="groupPostSubmit" class="W_btn_a btn_34px W_btn_a_disable">#L{ç¡®å®}</a><a href="javascript:void(0);" action-type="groupPostCannel" class="W_btn_b btn_34px">#L{åæ¶}</a></div></div></div>',n='<ul class="webim_contacts_list">#L{%s}</ul>',o='<#et data data><#list data as item><li class="contacts SW_fun_bg clearfix" node-type="userItem" action-type="addMember" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="å¾®åä¸ªäººè®¤è¯" class="W_icon icon_approve"></i></#if></div><div class="icon_add W_fr"><a href="javascript:void(0);"  action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url=${item.profile_image_url}" class="W_ficon ficon_add S_ficon">+</a></div></li></#list></#et>',p=c('<#et data data><#list data as item><li class="contacts <#if (!item.nopower)> SW_fun_bg</#if> clearfix" node-type="addUserItem"><div class="head W_fl"><img width="30" height="30"  src="${item.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14"><#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if></p><div class="icon_mod W_fl"><#if (item.verified && item.verified_type == 0)><i title="å¾®åä¸ªäººè®¤è¯" class="W_icon icon_approve"></i></#if></div><#if (item.is_owner)><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_main" title="#L{ç¾¤ä¸»}"></a></div><#elseif (item.is_admin)><#if (!item.nopower)><div class="close W_fr"><a href="javascript:void(0);" class="icon_group icon_admin" title="#L{ç¾¤ç®¡çå}"></a><a href="javascript:void(0);" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url="${item.profile_image_url}" class="W_ficon ficon_close S_ficon"<#if (item.actiontype)> action-type="${item.actiontype}" <#else> action-type="kickMember" </#if> >X</a></div><#else><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_admin" title="#L{ç¾¤ç®¡çå}"></a></div></#if><#else><div class="close W_fr"><a href="javascript:void(0);" action-data="uid=<#if (item.id)>${item.id}<#else>${item.uid}</#if>&screen_name=<#if (item.remark)>${item.remark}<#else>${item.screen_name}</#if>&profile_image_url="${item.profile_image_url}" class="W_ficon ficon_close S_ficon"<#if (item.actiontype)> action-type="${item.actiontype}" <#else> action-type="kickMember" </#if> >X</a></div></#if></li></#list></#et>'),q=c('<#et data data><li class="contacts  clearfix" node-type="addUserItem"><div class="head W_fl"><img width="30" height="30" src="${data.profile_image_url}"></div><p class="name W_autocut W_fl S_txt1 W_f14">${data.screen_name}</p><div class="icon_mod W_fl"><#if (data.verified && data.verified_type == 0)><i title="å¾®åä¸ªäººè®¤è¯" class="W_icon icon_approve"></i></#if></div><div class="main W_fr"><a href="javascript:void(0);" class="icon_group icon_main" title="#L{ç¾¤ä¸»}"></a></div><div class="close W_fr"></div></li></#et>'),r={},s=a.ui.dialog(c(m)),t="";b=a.parseParam({gid:"",addUsers:"",minNum:3,extraData:{},addSuccessCallback:"",editSuccessCallback:""},b);var u=-1,v=[],w=[],x=[],y=[],z,A={},B,C,D,E,F,G=b.gid,H=a.conf.trans.groupMember,I,J,K={editGroupName:function(){D.groupNamePanel.style.display="none";D.editGroupFrom.style.display="";E.value=z?a.decodeHTML(z):t},cannelEditGroup:function(){D.groupNamePanel.style.display="";D.editGroupFrom.style.display="none"},subimtEditGroup:function(){var b=F.getValue();if(!b)a.ui.tipAlert("è¯·è¾å¥ç¾¤åç§°!").beside(E).on("hide",function(){E.foucs()});else{k=!0;D.groupNamePanel.style.display="";D.editGroupFrom.style.display="none";if(b==t)return;z=b.substring(0,16);D.titleText.innerHTML=a.encodeHTML(z);K.updateGroupName()}},groupPostCannel:function(a){s.hide()},checkIsOk:function(){if(!k&&b.extraData&&b.extraData.page_id){var d=D.editGroupFrom.style.display=="",e=d?E:D.editGroupName,f=d?c("#L{æµç§°è¿æ²¡ä¿å­å¦}"):c("#L{è¯·åæ¢ä¸ªå¥½ç¹çæµç§°å§}");a.ui.tipAlert(f).beside(e,{pos:"bottom-middle",appendTo:document.body,offsetY:d?-10:-20});return!1}if(D.editGroupFrom.style.display==""){a.ui.tipAlert(c("#L{æµç§°è¿æ²¡ä¿å­å¦}")).beside(E,{pos:"bottom-middle",appendTo:document.body,offsetY:-10});return!1}return!0},groupPostSubmit:function(c){if(!a.hasClassName(c.el,"W_btn_a_disable")&&!!K.checkIsOk()){var d=b.extraData;if(G){d=a.lib.kit.extra.merge(d,{join_uids:x.join(","),kick_uids:w.join(","),name:z,gid:G});var e=d.name;k||delete d.name;H.getTrans("update",{onSuccess:function(c){c.data.name=e;a.custEvent.fire(r,"editSuccess",c.data);s.hide();try{b.editSuccessCallback&&b.editSuccessCallback(c.data)}catch(d){}K.errorBack(c)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d)}else{d=a.lib.kit.extra.merge(d,{name:z?z:t,members:y.join(",")});var e=d.name;k||delete d.name;H.getTrans("create",{onSuccess:function(c){c.data.name=e;a.custEvent.fire(r,"addSuccess",c.data);s.hide();try{b.addSuccessCallback&&b.addSuccessCallback(c.data)}catch(d){}K.errorBack(c)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d)}}},errorBack:function(b){var d=b.data,e=["error_uids","exceed_uids","unspported_uids"],f=[c("#L{è¿ä¸æ¯ä½ çç²ä¸ï¼ææ¶æ æ³å ç¾¤ã}"),c("#L{ç¾¤æåå·²æ»¡ï¼æä½å¤±è´¥ã}"),c("#L{ä¸æ¯æç¾¤èçç¨æ·ã}")],g=[],h=1;for(var i=0;i<e.length;i++)if(d[e[i]]){g.push(h+"."+d[e[i]].join(" ")+" "+f[i]+"<br>");h++}h>1&&a.ui.alert(g.join(""))},removeIndexElement:function(b,c){var d=a.core.arr.indexOf(b,c);d!=-1&&c.splice(d,1)},getCurItem:function(b){var c=b.length;while(c--)if(a.hasClassName(b[c],"cur"))return b[c];return null},groupSuggest:function(b){var c=a.fixEvent().keyCode,e=D.searchLists;if(c==d.UP||c==d.DOWN||c==d.ENTER){a.preventDefault(b);var f=a.sizzle("[node-type='userItem']",e),g=f.length,h=K.getCurItem(f);if(c==d.UP){u=u<1?g-1:u-1;h&&a.removeClassName(h,"cur");a.addClassName(f[u],"cur")}else if(c==d.DOWN){u=u>=g-1?0:u+1;h&&a.removeClassName(h,"cur");f[u]&&a.addClassName(f[u],"cur")}else if(c==d.ENTER){var i=h&&a.queryToJson(h.getAttribute("action-data"));i&&K.addGroupMember(undefined,i)}}},groupinputclick:function(a){window.SUDA&&window.SUDA.uaTrack("button_build_group","search_box")},groupinputkeyup:function(b){var e=a.trim(B.getValue()),f=a.fixEvent().keyCode;if(f==d.UP||f==d.LEFT||f==d.DOWN||f==d.RIGHT||f==d.ENTER)a.preventDefault(b);else if(e){i&&clearTimeout(i);j&&j.abort&&j.abort();i=setTimeout(function(){j=H.getTrans("suggest",{onSuccess:function(b){u=-1;var d=a.core.util.easyTemplate(o,b.data).toString();d=c(n,d);D.groupMember.style.display="none";D.searchLists.innerHTML=d;D.searchLists.style.display=""},onFail:function(){},onError:function(){}}).request({q:e})},200)}else{i&&clearTimeout(i);j&&j.abort&&j.abort();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"}},kickMember:function(b){var c=b.data,d=a.core.arr.indexOf(c.uid,y);if(d!=-1){y.splice(d,1);K.removeIndexElement(c.screen_name,v);K.removeIndexElement(c.uid,x);K.removeIndexElement(c.uid,y);w.push(c.uid)}var e=a.lib.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.getAttribute("node-type")=="addUserItem")return!0});e&&a.removeNode(e);var f=a.sizzle("[node-type='addUserItem']",D.joinMemberListContain).length;K.updateGroupName()},addMember:function(b){var c=b.data.uid;b.data.actiontype="removeMember";if(y.length>e-1)a.ui.tipAlert("ç¾¤äººæ°å·²è¾¾ä¸é!",{icon:"rederrorS",hideDelay:2e3}).beside(b.el);else if(!a.inArray(c,y)){y.push(c);x.push(c);v.push(b.data.screen_name);K.addMemberFunc([b.data]);K.updateGroupName();if(D.groupMember.style.display=="none"){C.value="";C.blur();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"}}},addMemberFunc:function(b){var d=a.core.util.easyTemplate(p,b).toString();D.addUserLists.style.display="";a.insertHTML(D.addUserListsContain,d,"afterbegin");var e=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;D.addUserCount.innerHTML=c("#L{æ°å æåï¼%sï¼}",e);e>0&&D.addUserCount.style.display==""},removeMember:function(b){var d=b.data;K.removeIndexElement(d.uid,y);K.removeIndexElement(d.screen_name,v);K.removeIndexElement(d.uid,x);var e=a.lib.kit.dom.parentElementBy(b.el,document.body,function(a){if(a.getAttribute("node-type")=="addUserItem")return!0});e&&a.removeNode(e);var f=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;f!=0&&(D.addUserCount.innerHTML=c("#L{æ°å æåï¼%sï¼}",f));f==0&&(D.addUserLists.style.display="none");K.updateGroupName()},addGroupMember:function(b,c){c.actiontype="removeMember";var d=c.uid+"";if(!a.inArray(d,y)){y.push(d);x.push(d);v.push(c.screen_name);K.addMemberFunc([c])}K.updateGroupName()},updateGroupName:function(){D.group_all_count.innerHTML=y.length+(G?0:1);l&&l.reset();if(G)w.length==0&&x.length==0&&f==z?!a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.addClassName(D.editsubmitBtn,"W_btn_a_disable"):a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.removeClassName(D.editsubmitBtn,"W_btn_a_disable");else{var d=b.minNum-1;d=d>0?d:2;x.length>=d&&D.titleText.innerHTML!=""?a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.removeClassName(D.editsubmitBtn,"W_btn_a_disable"):!a.hasClassName(D.editsubmitBtn,"W_btn_a_disable")&&a.addClassName(D.editsubmitBtn,"W_btn_a_disable")}if(!z){var e=v.length,g=c("#L{æ°å»ºç¾¤}");t=g;e>0&&(g="");for(var h=0;h<e&&h<4;h++)g=g+v[h]+"ã";e==1&&(g=g.substring(0,g.length-1));t=g.substring(0,16);D.titleText.innerHTML=t}},addGroupAllFunc:function(b){var d=b.length,f,g=[];for(var h=0;h<d;h++){var i=b[h];f=i.id+"";if(y.length>=e)break;if(!a.inArray(f,y)){i.actiontype="removeMember";g.push(i);y.push(f);x.push(f);v.push(i.screen_name)}}K.addMemberFunc(g);K.updateGroupName()},groupEditInputKeyup:function(){var b=F.getValue(),c=a.trim(b);c!=b&&F.setValue(c.substring(0,16))},addUserByName:function(){var b=B.getValue(),c=a.sizzle("[node-type='userItem']",D.searchLists),d=K.getCurItem(c);if(!d){if(y.length>e-1){a.ui.tipAlert("ç¾¤æåå·²æ»¡!",{icon:"rederrorS",hideDelay:2e3}).beside(C);return}var f={nick:b};H.getTrans("check",{onSuccess:function(a){K.addGroupMember(undefined,a.data);C.value="";C.blur();D.groupMember.style.display="";D.searchLists.innerHTML="";D.searchLists.style.display="none"},onError:function(b){a.ui.tipAlert(b.msg,{icon:"rederrorS",hideDelay:2e3}).beside(C)},onFail:function(a){}}).request(f)}},setUserInfo:function(b,d){if(!G&&!!d){var e=d.currUser,f=d.addUser,g=a.core.util.easyTemplate(q,e).toString();K.addGroupAllFunc(f);D.addUserLists.style.display="";a.insertHTML(D.addUserListsContain,g,"afterbegin");var h=a.sizzle("[node-type='addUserItem']",D.addUserListsContain).length;D.addUserCount.innerHTML=c("#L{æ°å æåï¼%sï¼}",h);h>0&&D.addUserCount.style.display==""}},hideDialog:function(){a.custEvent.fire(r,"hide")}},L=function(){C=s.getDomList().group_search_input;E=s.getDomList().group_edit_input;D=s.getDomList();s.on("editGroupName","click",K.editGroupName);s.on("cannelEditGroup","click",K.cannelEditGroup);s.on("groupPostSubmit","click",K.groupPostSubmit);s.on("kickMember","click",K.kickMember);s.on("groupPostCannel","click",K.groupPostCannel);s.on("removeMember","click",K.removeMember);s.on("addMember","click",K.addMember);s.on("subimtEditGroup","click",K.subimtEditGroup);a.custEvent.define(r,["addSuccess","editSuccess","hide"])},M=function(){var b={gid:G};H.getTrans("info",{onSuccess:function(b){function j(){var c=b.data.admins,e=d,f={};a.foreach(e,function(a){f[a.uid]=a});a.foreach(c,function(a){f[a].is_admin=1});e=[];a.foreach(f,function(a){e.push(a)});e.sort(function(a,b){return(b.is_admin|0)-(a.is_admin|0)});e.sort(function(a,b){return(b.is_owner|0)-(a.is_owner|0)});d=e;e=f=null}z=b.data.name;f=z;var d=b.data.members||[],g=d.length,h=b.data.is_owner==1,i=a.inArray(parseInt($CONFIG.uid),b.data.admins);j();var k;for(var m=0;m<g;m++){k=d[m];y.push(k.uid+"");v.push(k.remark?k.remark:k.screen_name);d[m].nopower=!0;if(h)d[m].nopower=!1;else if(i){console.log(d[m],d[m].is_owner,d[m].is_admin);!d[m].is_owner&&!d[m].is_admin&&(d[m].nopower=!1)}}if(h||i){var o="http://weibo.com/p/230491"+G+"/members?from=managelayer";if(D.batManage){D.batManage.setAttribute("href",o);D.batManage.style.display=""}}e=parseInt(b.data.max_member)||e;D.maxConut.innerHTML=e;D.line.style.display="";var q=a.core.util.easyTemplate(p,d).toString();q=c(n,q);D.titleText.innerHTML=z;D.joinMemberListContain.innerHTML=q;!l&&(l=a.ui.scrollView(D.existing_box));l&&l.reset();!h&&!i&&(D.editGroupName.style.display="none");K.updateGroupName()},onFail:function(a){},onError:function(a){}}).request(b)},N=function(){B=a.lib.kit.dom.smartInput(C,{notice:C.defaultValue});F=a.lib.kit.dom.smartInput(E,{notice:E.defaultValue});a.custEvent.add(B,"enter",K.addUserByName);a.addEvent(C,"keydown",K.groupSuggest);a.addEvent(C,"keyup",K.groupinputkeyup);a.addEvent(C,"click",K.groupinputclick);a.addEvent(E,"keyup",K.groupEditInputKeyup);a.addEvent(s,"hide",K.hideDialog);G?M():K.updateGroupName();J=a.lib.group.groupMember(s.getDomList().groupMember,{members:b.addUsers});a.custEvent.add(J,"addMember",K.addGroupMember);a.custEvent.add(J,"getUserInfo",K.setUserInfo)},O=function(){L();N();s.on("shown",function(){var b=D.groupSelect.offsetHeight,c=D.existing_box.offsetHeight;D.searchLists.style.height=b+"px";!l&&(l=a.ui.scrollView(D.existing_box));l&&l.reset();J.setHeight(b)}).on("hide",function(){r.destroy()}).show()};O();r.destroy=function(){a.custEvent.undefine(r,["addSuccess","editSuccess","hide"]);a.removeEvent(C,"keydown",K.groupSuggest);a.removeEvent(C,"keyup",K.groupinputkeyup);a.removeEvent(E,"keyup",K.groupEditInputKeyup);a.custEvent.remove(B,"enter",K.addUserByName);a.removeEvent(C,"click",K.groupinputclick);J.destroy();F.destroy();B.destroy();l.destroy()};return r}});
STK.register("lib.publisher.source.publishTo",function(a){var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.core.util.easyTemplate,e;return function(c){var d,f,g=c&&c.editorWrapEl,h=c&&c.textEl,i=c&&c.trans||a.conf.trans.publishTo,j=c&&c.transName||"chatlist",k={},l=[],m,n={},o=c.isforward,p,q=!1,r,s,t,u=function(){if(!a.isNode(g))throw"publishTo need a wrapper node to parseDOM"},v=a.getUniqueKey(),w=function(a){var b=[],c;b.push('<div style="position: absolute;display:none;z-index:29999;outline:none;" hideFocus="true" node-type="publishTo" class="layer_menu_list" tabindex="10">');b.push('<ul id="'+v+'">');b.push('<li action-type="select" rank="0"><a title="#L{å¬å¼-ä½ åè¡¨çå¾®åå¯ä»¥è¢«å¤§å®¶å¬å¼æ¥çå¦}" suda-data="key=tblog_edit_exposure&value=edit_public" href="javascript:void(0)" action-data="rank=0&text=#L{å¬å¼}&rankid=" action-type="publishTo"><i class="W_icon icon_type_public"></i>#L{å¬å¼}</a></li>');b.push('<li action-type="select" rank="6"><a title="#L{å¥½åå-åè¡¨çå¾®ååªæä½ çå¥½åæè½çå°}" href="javascript:void(0)" action-data="rank=6&text=#L{å¥½åå}&rankid=" action-type="publishTo"><i class="W_icon icon_type_friends"></i>#L{å¥½åå}</a></li>');b.push('<li action-type="select" rank="1"><a title="#L{ä»èªå·±å¯è§-åè¡¨çå¾®ååªæèªå·±æè½çå°}" suda-data="key=tblog_edit_exposure&value=edit_private" href="javascript:void(0)" action-data="rank=1&text=#L{ä»èªå·±å¯è§}&rankid=" action-type="publishTo"><i class="W_icon icon_type_self"></i>#L{ä»èªå·±å¯è§}</a></li>');b.push('<li class="line S_line1"></li>');b.push('<li action-type="select"><a action-type="more" title="#L{ç¾¤å¯è§-åè¡¨çå¾®åææç¾¤æåé½å¯ä»¥çå°}" href="javascript:void(0);"><i class="W_icon icon_type_group_v2"></i>#L{ç¾¤å¯è§}</a></li>');b.push("</ul></div>");return b.join("")},x=function(a){var b=[],c=a.length,d;c>6?b.push('<ul class="scroll_bar W_scroll" id="'+v+'">'):b.push('<ul class="scroll_bar W_scroll" id="'+v+'" style="">');for(var e=0;e<c;e++){d=a[e];b.push('<li action-type="select"><a action-type="publishTo" action-data="rank=7&text='+d.gname+"&rankid="+d.gid+'" title="'+d.gname+'" href="javascript:void(0);" onclick="return false;"><em class="S_txt1">'+d.gname+"</em>");b.push('<span class="qunlist_right" action-type="setting" suda-data="key=adm_group&value=mail_publish"><em class="W_ficon ficon_setup S_ficon">J</em></span></a></li>')}b.push("</ul>");b.push('<ul><li class="line S_line1"></li>');b.push('<li  class="lotopt"><a href="javascript:void(0)" onclick="return false;" action-type="back">#L{è¿å}</a>');b.push('<a href="javascript:void(0);"sudaï¼data="key=build_group&value=mail_publish"  action-data="minNum=2" action-type="createGroup" class="right"><em class="W_ficon ficon_add S_ficon">+</em><em class="S_txt1">#L{æ°å»ºç¾¤}</em></a></li>');b.push("</ul>");return b.join("")},y=function(){f=a.lib.kit.dom.parseDOM(a.builder(g).list);f.wrap||(f.wrap=g);r=f.wrap.className;f.submit&&(s=f.submit.innerHTML)},z=function(){d=function(){var c={},d,k,n,o,u=f.showPublishTo;k=d=u&&u.getAttribute("action-data")&&a.core.json.queryToJson(u.getAttribute("action-data"))||{rank:"all",rankid:""};c.node=a.core.evt.delegatedEvent(g);var y=!1,z={hotKeyChangeRank:function(c,f){var g=f.match(/\d+/);if(g&&g[0]){var h=parseInt(g[0],10)-1,i=[{rank:0,rankid:"",text:b("#L{å¬å¼}"),title:b("#L{å¬å¼-ä½ åè¡¨çå¾®åå¯ä»¥è¢«å¤§å®¶å¬å¼æ¥çå¦}")},{rank:6,rankid:"",text:b("#L{å¥½åå}"),title:b("#L{å¥½åå-åè¡¨çå¾®ååªæä½ çå¥½åæè½çå°}")},{rank:1,rankid:"",text:b("#L{ä»èªå·±å¯è§}"),title:b("#L{ä»èªå·±å¯è§-åè¡¨çå¾®ååªæèªå·±æè½çå°}")}],j=function(){a.foreach(k,function(a){a.rank=7;a.rankid=a.gid;a.text=a.gname;a.title=a.gname});i=i.concat(k);var b=window.$CONFIG&&window.$CONFIG.miyou=="1";b||i.splice(1,1);if(i[h]){d=i[h];E.btnContent(d.text);E.btnTitle(d.title);y=!1;a.custEvent.fire(E,"changeRank",d)}},k=function(){if(e)return a.core.arr.copy(e);F.group.request(function(b){k=a.core.arr.copy(b);j()});return null}();k&&j()}}},A=function(){c.node.add("showPublishTo","click",E.show)},B=function(){F.normal.bind();F.group.bind();C.bind()},C={keyboardManager:null,keyTypes:["up","down","esc","enter"],getIndex:function(b){var c=C.getList(),d=C.lastCur,e;a.foreach(c,function(a,b){if(d===a){e=b;return!1}});b>0?e++:e--;e>=c.length?e=0:e<0&&(e=c.length-1);return e},up:function(){q=!0;var a=C.getIndex(-1),b=C.getList()[a];C.setCur(b,a);q=!1},down:function(){q=!0;var a=C.getIndex(1),b=C.getList()[a];C.setCur(b,a);q=!1},enter:function(){var b=C.lastCur;if(!b.getAttribute("action-type")||b.getAttribute("action-type")=="select")b=a.sizzle("[action-type]",b)[0];b&&c.layer.fireDom(b,"click",null)},esc:function(){E.hide()},bind:function(){C.keyboardManager=a.lib.publisher.widget.keyboardCapture(f.publishTo,{stopScroll:!0});a.custEvent.define(C.keyboardManager,C.keyTypes);for(var b=0,c=C.keyTypes.length;b<c;b++){var d=C.keyTypes[b];a.custEvent.add(C.keyboardManager,d,C[d])}},list:null,lastCur:null,focusPublishTo:function(){f.publishTo.focus();var b=this.getList(!0),c=a.sizzle('li[rank="'+d.rank+'"]',f.publishTo)[0];this.setCur(c||b[0],0)},setCur:function(b,c,d){this.lastCur&&a.removeClassName(this.lastCur,"cur");a.addClassName(b,"cur");this.lastCur=b;var e=a.E(v);if(a.contains(e,b)){var f=function(b){return a.core.dom.getSize(b).height+(parseFloat(a.core.dom.getStyle(b,"marginTop"))||0)+(parseFloat(a.core.dom.getStyle(b,"marginBottom"))||0)},g=c+1,h=Math.max(f(b),f(a.sizzle("a",b)[0]));if(d)return;g>6?e.scrollTop=(g-6)*h:e.scrollTop=0}},getList:function(b){if(b||!this.list){var c=a.sizzle("li",f.publishTo),d=[];a.foreach(c,function(b){a.getStyle(b,"display")!="none"&&b.className!="line"&&d.push(b)});this.list=d}return this.list}},D={setPos:function(){var b=a.core.dom.getSize;document.body.appendChild(f.publishTo);var c=b(f.showPublishTo).width-b(f.publishTo).width;a.lib.kit.dom.layoutPos(f.publishTo,f.showPublishTo,{offsetX:c+2,offsetY:2})},overHandler:function(b){if(!q){var c=a.sizzle("[action-type=select]",f.publishTo);index=a.core.arr.indexOf(b.el,c);list=a.sizzle(".cur",f.publishTo);list&&list[0]&&a.core.dom.removeClassName(list[0],"cur");a.core.dom.addClassName(c[index],"cur");C.setCur(c[index],index,!0)}},init:function(){c.layer=a.core.evt.delegatedEvent(f.publishTo);c.closeFriend=a.core.evt.delegatedEvent(f.publishTo)},show:function(){var b=a.getStyle(f.publishTo,"display")!="none";a.setStyle(f.publishTo,"display","");D.setPos();C.focusPublishTo();b||a.ui.effect(f.publishTo,"fadeInDown","fast");if(!m){m=1;D.bindBodyEvt()}return!1},hide:function(){!f.publishTo||a.ui.effect(f.publishTo,"fadeOutUp","fast",function(){a.setStyle(f.publishTo,"display","none");y=!1;if(m){m=0;D.removeBodyEvt()}})},autoHide:function(b){b=a.core.evt.fixEvent(b);f.showPublishTo!==b.target&&!a.core.dom.contains(f.showPublishTo,b.target)&&!a.core.dom.contains(f.publishTo,b.target)&&E.hide()},content:function(a){if(typeof a=="undefined")return f.publishTo.innerHTML;f.publishTo.innerHTML=a},bindBodyEvt:function(){a.addEvent(document.body,"click",D.autoHide)},removeBodyEvt:function(){a.removeEvent(document.body,"click",D.autoHide)}},E={enable:function(){f.showPublishTo.setAttribute("action-type","showPublishTo")},disable:function(){f.showPublishTo.setAttribute("action-type","")},miYouStyle:function(a,c){var d="2",e=$CONFIG.lang=="zh-cn"?"":"_CHT";d==c.rank?f.submit.innerHTML=b('<span class="btn_30px">#L{å¥½ååå¸}</span>'):f.submit.innerHTML=s},show:function(){var b=function(){a.custEvent.fire(E,"show");y?F.group.show():F.normal.show()};if(f.publishTo){var c=a.getStyle(f.publishTo,"display");if(c==="none")b();else{a.setStyle(f.publishTo,"display","none");y=!1}}else b();a.preventDefault()},btnContent:function(b){b&&(n.innerHTML=a.encodeHTML(b))},btnTitle:function(a){a&&f.showPublishTo.setAttribute("title",a)},hide:function(){D.hide()},toggle:function(){y||(f.publishTo.style.display=="none"?E.show():E.hide())},rank:function(){return d},reset:function(){E.enable();f.wrap.className=r;f.submit.innerHTML=s;E.btnContent(o.content);E.btnTitle(o.title);d=null;y=!1;d=k},destroy:function(){try{for(var b in c)c[b].destroy()}catch(d){}l.length&&a.hotKey.remove(h,l,z.hotKeyChangeRank);a.removeNode(f.publishTo);a.custEvent.undefine(E);if(C.keyboardManager){C.keyboardManager.destroy();a.custEvent.undefine(C.keyboardManager,C.keyTypes)}},changeRank:function(b){b=b>0?b-1:0;var c=a.sizzle('a[action-type="publishTo"]',f.publishTo)[b];if(c){F.normal.changeRank({el:c,data:a.core.json.queryToJson(c.getAttribute("action-data")||"")});var d=c.getAttribute("suda-data");if(d){var e=d.match(/key=(.+?)&value=(.+)/);e&&e.length===3&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(e[1],e[2])}}},getDomHeight:function(){return f.publishTo.style.display=="none"?{width:0,heigth:0}:a.core.dom.getSize(f.publishTo)},bindAltKey:function(){if(a.isNode(h)){var b=a.core.util.browser.OS==="macintosh";if(b)for(var c=1;c<=9;c++)l.push("ctrl+"+c);else for(var c=1;c<=9;c++)l.push("alt+"+c);a.hotKey.add(h,l,z.hotKeyChangeRank)}}},F={normal:{bind:function(){c.layer.add("publishTo","click",F.normal.changeRank);c.layer.add("more","click",F.normal.more);c.layer.add("select","mousemove",D.overHandler)},getList:function(){D.content(p)},more:function(){F.group.show();y=!0;a.core.evt.stopEvent()},show:function(){var a=function(){if(!f.publishTo){G();D.init();B()}F.normal.getList();D.show()};e?a():F.group.request(a)},editGroupCallback:function(b){F.group.request(function(b){groups=a.core.arr.copy(b);F.group.cache=null})},changeRank:function(c){try{a.preventDefault(c.evt)}catch(e){}var g=a.fixEvent().target,h=!1;if(g.getAttribute("action-type")=="setting")h=!0;else{var i=a.lib.kit.dom.parentElementBy(g,f.publishTo,function(a){if(a.getAttribute("action-type")=="setting")return!0});i&&(h=!0)}if(h){var j=c.data.rankid.split(":")[1];E.hide();t=a.lib.group.gmemberSelect({gid:j,editSuccessCallback:F.normal.editGroupCallback})}else{d=c.data;var k=c.data.text;E.btnContent(k);E.btnTitle(c.el.getAttribute("title"));d.rank=="group"?F.group.show():E.hide();a.custEvent.fire(E,"changeRank",d);c.data.rank=="6"?f.submit.innerHTML=b("#L{å¥½ååå¸}"):f.submit.innerHTML=b("#L{åå¸}")}}},group:{request:function(b){i.request(j,{onSuccess:function(a){var c=a.data.length;for(var d=0;d<c;d++)a.data[d].index=d+1;e=a.data;b&&b(e)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{})},bind:function(){c.layer.add("back","click",F.group.back);c.layer.add("createGroup","click",F.group.createGroup)},getList:function(){if(!F.group.cache){var a=b(x(e));F.group.cache=a;D.content(F.group.cache)}else D.content(F.group.cache)},show:function(){F.group.getList();D.show()},back:function(){var b=a.core.evt.fixEvent();a.core.evt.stopEvent(b);y=!1;F.normal.show()},groupSelectCallback:function(b){d={rank:7,rankid:b.page_objectid,text:b.name,title:b.name};var c=b.name;E.btnContent(c);E.btnTitle(c);a.custEvent.fire(E,"changeRank",d);F.group.request(function(b){groups=a.core.arr.copy(b);F.group.cache=null})},createGroup:function(b){E.hide();var c=b.data;c.extraData={fromapp:1};c.addSuccessCallback=F.group.groupSelectCallback;t=a.lib.group.gmemberSelect(c)}}},G=function(c){var d=b(w(c));f.publishTo=a.insertHTML(document.body,d,"beforeend");p=f.publishTo.innerHTML},H=function(){if(!a.isNode(f.showPublishTo))return 0;n=f.publishTotext;o={content:n.innerHTML,title:f.showPublishTo.getAttribute("title")};A();return 1},I=H();a.custEvent.define(E,["show","hide","changeRank"]);return I?E:null}();d&&d.bindAltKey&&d.bindAltKey()},A=function(){u();y();z()};A();return d}});
STK.register("lib.publisher.source.shine",function(a){var b=function(a){return a.slice(0,a.length-1).concat(a.concat([]).reverse())};return function(c,d){var e=a.parseParam({start:"#fff",color:"#fbb",times:2,step:5,length:4},d),f=e.start.split(""),g=e.color.split(""),h=[];for(var i=0;i<e.step;i+=1){var j=f[0];for(var k=1;k<e.length;k+=1){var l=parseInt(f[k],16),m=parseInt(g[k],16);j+=Math.floor(parseInt(l+(m-l)*i/e.step,10)).toString(16)}h.push(j)}for(var i=0;i<e.times;i+=1)h=b(h);var n=!1,o=a.timer.add(function(){if(!h.length)a.timer.remove(o);else{if(n){n=!1;return}n=!0;c.style.backgroundColor=h.pop()}})}});
STK.register("lib.publisher.source.scoreshine",function(a){return function(b,c){var d=a.lib.kit.extra.language,e,f=0,e=setInterval(function(){c.innerHTML=d("#L{äº²ï¼åæä¸ªåå§}");b.style.width=f%2==0?"100%":"0%";f++;f>3&&clearInterval(e)},200)}});
STK.register("conf.trans.rteditor",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("create",{url:"/aj/article/create",method:"post"});c("getvideo",{url:"/aj/article/getvideo",method:"post"});c("setdraft",{url:"/aj/article/setdraft",method:"post"});c("getdraft",{url:"/aj/article/getdraft",method:"post"});c("cleandraft",{url:"/aj/article/cleandraft",method:"post"});c("import",{url:"/aj/article/import",method:"get"});return b});
STK.register("lib.publisher.publisher",function(a){var b={title:"#L{æä»ä¹æ°é²äºæ³åè¯å¤§å®¶}"},c=a.lib.kit.extra.language,d=a.lib.publisher.widget.widgetloader,e="#å¨è¿éè¾å¥ä½ æ³è¦è¯´çè¯é¢#";return function(b){var f={limitNum:140,extendText:""},g=140,h={},i,j=!0,k,l,m,n,o,p,q,r,s,t;i=a.parseParam({trans:a.conf.trans.publisher,transName:"publish",node:null,styleId:"1",appkey:"",pid:"",info:"",content:"",extraUrl:"",extraSend:{}},b);var u,v="#L{è¿å¯ä»¥è¾å¥%så­}",w="#L{å·²è¶åº%så­}",x=v;i.extraSend.location=i.extraSend.location||$CONFIG.location||"";p=a.custEvent.define(h,["publish","share"]);var y=function(){var b=l.textEl;if(j){k==="error"&&a.lib.publisher.source.shine(b);u&&u.get("score")==0&&l.scorecontrol&&a.lib.publisher.source.scoreshine(l.scorecontrol,l.score_title)}else{if(a.hasClassName(l.submit,"W_btn_a_disable"))return;j=!0;k="loading";var c=a.lib.kit.extra.getDiss(z(),l.submit);c=a.lib.kit.extra.merge(c,a.queryToJson(l.submit.getAttribute("action-data")||""));u&&(c=a.lib.kit.extra.merge(c,u.read()));c.pub_type="dialog";s&&s.disable();o.request(c);if(l.followpresenter&&l.followpresenter.checked==!0){var d=a.queryToJson(l.followpresenter.getAttribute("action-data")||"");i.trans.getTrans("follow",{}).request(d)}}},z=function(){var b=n.API.getWords();q&&b.indexOf(q)===-1&&(b=b+q);var c={};c=a.core.json.merge(c,i.extraSend);c.appkey=i.appkey;c.style_type=i.styleId;c.pic_id=i.pid;c.text=b;c.pdetail=$CONFIG.page_id;c.location=$CONFIG.location;var d=n.API.getExtra();if(d)if(d.indexOf("=")<0)c.pic_id=n.API.getExtra()||"";else{var e=d,f=a.core.json.queryToJson(e);for(var g in f)c[g]=f[g]}if(s&&s.rank){var h=s.rank();c.rank=h.rank;c.rankid=h.rankid}l.settime_data&&(c.addtime=l.settime_data.value+" "+l.settime_hour.value+":"+l.settime_min.value);n.nodeList.textEl&&n.nodeList.textEl.getAttribute("tags")&&(c.photo_tag=n.nodeList.textEl.getAttribute("tags"));n.nodeList.textEl&&n.nodeList.textEl.getAttribute("taginfos")&&(c.photo_taginfo=n.nodeList.textEl.getAttribute("taginfos"));return c},A=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){y();n.API.blur()}},B=function(b,d){var h=u&&u.get("extraurl")||"";h==="ABSENT"&&(h="");var i=u&&u.get("prefixtext")||"";i==="ABSENT"&&(i="");f.limitNum=g-a.lib.publisher.widget.count(h+i);var m=d.isOver;if(!m&&l.textEl.value!=e){j=!1;k="";a.core.dom.removeClassName(l.submit,"W_btn_a_disable");var n=f.limitNum-d.count<0?'class="S_error"':"";l.num.innerHTML=(f.extendText?c(f.extendText):"")+c("#L{è¿å¯ä»¥è¾å¥%så­}","<span "+n+">"+(f.limitNum-d.count)+"</span>")}else{j=!0;k="error";a.core.dom.addClassName(l.submit,"W_btn_a_disable");ok=(num=f.limitNum-d.count)>=0;var n=f.limitNum-d.count<0?'class="S_error"':"";if(d.count===0){x=v;_lock()}else if(ok){x=v;_unlock()}else{x=w;_lock()}l.num.innerHTML=extendText+c(x,ok?"<span>"+Math.abs(num)+"</span>":'<span class="S_error">'+Math.abs(num)+"</span>")}f.limitNum-d.count<0&&a.core.dom.addClassName(l.submit,"W_btn_a_disable");if(u&&u.get("score")!=="ABSENT"&&u.get("score")==0){j=!0;a.core.dom.addClassName(l.submit,"W_btn_a_disable")}},C=function(b,d){n.API.blur();k="";l.successTip.style.display="";l.textEl.value=l.textEl.getAttribute("defaulttopic")||"";var e=a.sizzle(".W_icon",l.successTip)[0],g=a.sizzle(".txt",l.successTip)[0];g.style.display="none";a.ui.effect(e,"flipInY","normal");setTimeout(function(){g.style.display="";a.ui.effect(g,"fadeInRight","normal")},50);E();setTimeout(function(){j=!1;a.ui.effect(l.successTip,"fadeOut","fast",function(){l.successTip.style.display="none"});var b=n.API.count();b>0?a.core.dom.removeClassName(l.submit,"W_btn_a_disable"):l.submit&&a.core.dom.addClassName(l.submit,"W_btn_a_disable");l.num.innerHTML=(f.extendText?c(f.extendText):"")+c("#L{è¿å¯ä»¥è¾å¥%så­}","<span>"+(f.limitNum-b)+"</span>")},2e3);a.custEvent.fire(p,"publish",[b.data,d]);a.custEvent.fire(p,"share");setTimeout(function(){b.data.feedtype=="timefeed"?a.conf.channel.feed.fire("timeFeedPublish",[b.data.html,d]):a.conf.channel.feed.fire("publish",[b.data,d])},1500);a.core.dom.addClassName(l.submit,"W_btn_a_disable");s&&s.reset&&s.reset();t&&t.close&&t.close();n.nodeList.textEl&&n.nodeList.textEl.getAttribute("tags")&&n.nodeList.textEl.removeAttribute("tags");if(n.nodeList.textEl&&n.nodeList.textEl.getAttribute("withdraft")=="true"){n.nodeList.textEl.removeAttribute("withdraft");a.conf.trans.rteditor.getTrans("cleandraft",{}).request()}},D=function(b,d){j=!1;k="";b.msg=b.msg||c("æä½å¤±è´¥");a.lib.dialog.ioError(b.code,b);l.submit&&a.core.dom.removeClassName(l.submit,"W_btn_a_disable");s&&s.enable()},E=function(){l.num.style.display="block"},F=function(){l.num.style.display="block"},G=function(){a.removeClassName(l.textEl.parentNode,"clicked")},H=function(){a.addClassName(l.textEl.parentNode,"clicked")},I=function(b){var b=a.parseParam({appkey:"",content:"",info:"",pid:"",extraSend:{}},b);i.extraSend=b.extraSend;i.extraSend.location=i.extraSend.location||$CONFIG.location||"";i.pid=b.pid;if(!!a.contains(document.body,l.textEl)){l.textEl.defaultValue&&(l.textEl.value=l.textEl.defaultValue);b.content&&(l.textEl.value=b.content);l.textEl.setAttribute("content",b.content);l.info&&(l.info.innerHTML=b.info);b.appkey&&(i.appkey=b.appkey);var d=n.API.count();if(d>0){j=!1;k="";a.core.dom.removeClassName(l.submit,"W_btn_a_disable")}else{j=!0;k="error";a.core.dom.addClassName(l.submit,"W_btn_a_disable")}if(u&&u.get("score")!=="ABSENT"&&u.get("score")==0){j=!0;a.core.dom.addClassName(l.submit,"W_btn_a_disable")}l.num.innerHTML=(f.extendText?c(f.extendText):"")+c("#L{è¿å¯ä»¥è¾å¥%så­}","<span>"+(f.limitNum-d)+"</span>");t&&t.close&&t.close()}},J=function(){j=!1},K=function(b){var c=a.core.dom.textSelectArea(b),d=c.start||b.value.length,e=c.len||0,f=d+"&"+e;b.setAttribute("range",f)},L=function(){m=a.lib.editor.base(i.node,f);n=m.editor;l=n.nodeList;u=a.lib.publisher.source.formdata(l.extradata);var b=u&&u.get("extraurl")||"";b==="ABSENT"&&(b="");var c=u&&u.get("prefixtext")||"";c==="ABSENT"&&(c="");f.limitNum=f.limitNum-a.lib.publisher.widget.count(b+c);try{K(l.textEl)}catch(d){}l.wrap&&(s=a.lib.publisher.source.publishTo({editorWrapEl:l.wrap,textEl:l.textEl}));r=a.lib.dialog.validateCode()},M="",N=function(b){if(!!l&&!!l.feedconfig){if(a.core.dom.hasClassName(l.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(l.feedconfig,"send_weibo_simple_remark_fold")){a.removeClassName(l.feedconfig,"send_weibo_simple_remark_fold");M="send_weibo_simple_remark_fold"}if(a.core.dom.hasClassName(l.feedconfig,"send_weibo_simple")&&a.core.dom.hasClassName(l.feedconfig,"send_weibo_simple_fold")){a.removeClassName(l.feedconfig,"send_weibo_simple_fold");M="send_weibo_simple_fold"}}},O=function(b){if(!!l&&!!l.feedconfig){var b=a.fixEvent(b),c=b.target;a.core.dom.hasClassName(l.feedconfig,"send_weibo_simple")&&!a.core.dom.hasClassName(l.feedconfig,M)&&c!==l.feedconfig&&(a.core.dom.hasClassName(c,"WB_miniblog_fb")||a.core.dom.hasClassName(c,"WB_frame_c")||a.core.dom.hasClassName(c,"WB_main"))&&a.addClassName(l.feedconfig,M)}},P=function(){a.addEvent(l.submit,"click",y);a.lib.kit.extra.keySubmit.on(l.textEl,y);a.custEvent.add(n,"blur",G);a.custEvent.add(n,"focus",H);a.addEvent(l.feedconfig,"click",N);a.addEvent(document.body,"click",O)},Q=function(){s&&s.miYouStyle.apply(null,arguments)},R=function(){a.custEvent.add(n,"textNum",B);s&&a.custEvent.add(s,"changeRank",Q)},S=function(){u&&u.get("api")&&u.get("api")!=="ABSENT"&&(i.transName="proxy");o=i.trans.getTrans(i.transName,{onComplete:function(b,c){var d={onSuccess:C,onError:D,requestAjax:o,param:z(),onRelease:function(){j=!1;k="";l.submit&&a.core.dom.removeClassName(l.submit,"W_btn_a_disable");s&&s.enable()}};r.validateIntercept(b,c,d)},onFail:D,onTimeout:D})},T=function(){L();P();R();S();try{I(i)}catch(a){}try{t=d(n)}catch(a){}},U=function(){s&&s.reset&&s.reset();s&&s.hide&&s.hide();t&&t.close&&t.close()},V=function(a){n.API.addExtraInfo(a)},W=function(a){n.API.disableEditor(a)},X=function(){l&&l.submit&&a.removeEvent(l.submit,"click",y);l&&l.textEl&&a.lib.kit.extra.keySubmit.off(l.textEl,y);a.custEvent.remove(n,"textNum",B);a.custEvent.remove(n,"blur",G);a.custEvent.remove(n,"focus",H);a.removeEvent(l.feedconfig,"click",N);a.removeEvent(document.body,"click",O);s&&a.custEvent.remove(s,"changeRank",Q);a.custEvent.undefine(p,"publish");r&&r.destroy&&r.destroy();s&&s.destroy&&s.destroy();t&&t.destroy&&t.destroy();l=null;o=null;j=!1;for(var b in h)delete h[b];h=null;m&&m.destroy&&m.destroy()};T();h.publishTo=s;h.close=U;h.editor=n;h.rend=I;h.unrend=J;h.addExtraInfo=V;h.disableEditor=W;h.destroy=X;return h}});
STK.register("lib.publisher.publisherDialog",function(a){var b='<#et temp data><div class="detail" node-type="outer"><div class="send_weibo clearfix" node-type="wrap"><div class="title_area clearfix"><div class="title" node-type="info"></div><div class="num S_txt2" node-type="num">#L{è¿å¯ä»¥è¾å¥}<span>140</span>#L{å­}</div><div class="key S_textb"></div></div><div class="input "><textarea placeholder="" class="W_input" name="" node-type="textEl" range="26&amp;0"></textarea><div class="send_succpic" style="display:none" node-type="successTip"><span class="W_icon icon_succB"></span><span class="txt">åå¸æå</span></div><form style="display:none;" node-type="extradata"></form></div><div class="func_area clearfix"><div class="func"><div class="limits"><a href="javascript:void(0);" class="S_txt1" node-type="showPublishTo" action-type="showPublishTo" action-data="rank=0"><span node-type="publishTotext" class="W_autocut">#L{ææäººå¯è§}</span><em class="W_ficon ficon_arrow_down S_ficon" node-type="publish_to_arrow">c</em></a></div><a href="javascript:void(0)" class="W_btn_a btn_30px" node-type="submit">#L{åå¸}</a></div><div class="kind" node-type="widget"><#if (data.face)><a href="javascript:void(0);" class="S_txt1" action-type="face" action-data="type=500&amp;action=1&amp;log=face&amp;cate=1" title="#L{è¡¨æ}" node-type="smileyBtn" suda-uatrack="key=tblog_home_edit&amp;value=phiz_button"><em class="W_ficon ficon_face">o</em></a></#if><#if (data.face)><a href="javascript:void(0);" class="S_txt1" action-type="multiimage" action-data="type=508&amp;action=1&amp;log=image&amp;cate=1" title="#L{å¾ç}" suda-uatrack="key=tblog_new_image_upload&amp;value=image_button"><em class="W_ficon ficon_image">p</em></a></#if></div></div></div></div></#et>',c={title:"#L{æä»ä¹æ°é²äºæ³åè¯å¤§å®¶?}"},d=a.lib.kit.extra.language,e=a.lib.publisher.publisher,f=a.core.util.easyTemplate,g=window.$CONFIG||{},h={limitNum:140,extendText:'<a target="_blank" class="S_txt2" href="http://weibo.com/z/guize/gongyue.html">#L{åè¨è¯·éµå®ç¤¾åºå¬çº¦}</a>ï¼'};return function(i){var j={},k,l;conf=a.parseParam({trans:a.conf.trans.publisher,transName:"publish",template:d(b),appkey:"",styleId:"1",face:!0,image:!0,pid:"",content:"",info:"",title:d(c.title),extraUrl:"",extraSend:{},html:null},i);conf.extraSend.location=conf.extraSend.location||g.location||"";var m=f(d(conf.template),conf).toString();conf.html&&(m=conf.html);conf.editorOpts=h;a.custEvent.define(j,["show","hide","publishShare"]);var n=function(b){var e=a.parseParam({appkey:"",content:"",info:"",pid:"",title:d(c.title),extraSend:{}},b);e.extraSend.location=e.extraSend.location||g.location||"";l.setTitle(e.title);l.show();a.custEvent.add(l,"hidden",r);k.rend(e);k.editor.API.focus();a.custEvent.fire(j,"show")},o=function(){setTimeout(r,1500)},p=function(b,c,d){a.custEvent.fire(j,"publishShare",[c,d])},q=function(){a.custEvent.add(k,"publish",o);a.custEvent.add(k,"publish",p)},r=function(){a.custEvent.remove(l,"hidden",r);k.close();l.hide();a.custEvent.fire(j,"hide")},s=function(){a.custEvent.remove(k,"publish",o);k.destroy();l.destroy()},t=function(){if(!l){l=a.ui.dialog();l.setContent(m)}conf.node=l.getBox();k=e(conf);a.custEvent.hook(k,j,{publish:"publish",hide:"hide"});q();n(conf);l.on("hide",function(){k.destroy()})};t();j.dialog=l;j.publishTo=k.publishTo;j.addExtraInfo=k.addExtraInfo;j.disableEditor=k.disableEditor;j.show=n;j.hide=r;j.destroy=s;return j}});
STK.register("lib.feed.plugins.media",function(a){var b,c=a.lib.feed.feedTemps,d=a.core.util.easyTemplate,e=a.lib.kit.extra.language,f=e("#L{å è½½å¤±è´¥}!"),g=e("#L{å¾æ±æ­ï¼è¯¥åå®¹æ æ³æ¾ç¤ºï¼è¯·ç¨ååè¯ã}"),h=e("#L{æä½å¤±è´¥ï¼è¯·ç¨åéè¯ã}"),i=a.core.util.browser.IE,j=60,k=a.conf.trans.feed.feed,l=450,m=function(b,c){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},n=function(f,g,h,i){var j=f.el,k=f.data,n=decodeURIComponent(k.pic_objects||""),o=k.photo_filter_ids===undefined?undefined:k.photo_filter_ids.split(":")[1],p=n.split("|");if(!j.loading){j.tagName.toLowerCase()!=="img"&&(j=a.sizzle("img",j)[0]);j.loading=1;var q=/\/thumbnail\/.+(?=\.\w+)/.exec(j.src);q&&(q=q[0].replace("/thumbnail/",""));var r=j.src.replace("/thumbnail/","/bmiddle/");r=r.split("?")[0];var s="http://photo.weibo.com/"+k.uid+"/wbphotos/large/photo_id/"+k.mid+"?refer=weibofeedv5",t=b.getFeedNode(j,g),u=t.getAttribute("isForward")?1:"",v=b.getMid(j,g),w="pid="+(k.pid?k.pid:q)+"&mid="+k.mid+"&uid="+k.uid+"&pic_objects="+k.pic_objects,x,y;if(!t){a.log("parents attribute mid node is undefined!");return}t.isForward=u;var z=m(t,u);if(!z||!z.prev||!z.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}if(h.voteObj[v]){h.voteObj[v].destroy();delete h.voteObj[v]}var A=function(){j.loading=0;if(x){j.bigImgWidth=x.width;x.onload=null}y&&(y.style.display="none");z.prev.style.display="none";z.disp.innerHTML="";z.disp.appendChild(a.builder(d(c.mediaIMGTEMPwithBtn,{notForward:!u,uniqueId:a.core.util.getUniqueKey(),bigSrc:r,acdata:w,notShowLikeBtn:n!="",pid:k.pid?k.pid:q,mid:k.mid,is_liked:+p[1],count:p[2]||0,object_id:p[3],bigWidth:j.bigImgWidth>l?l:j.bigImgWidth,suda:{retract:"key=feed_image_click&value=image_zoomout",showBig:"key=tblog_newimage_feed&value=single_larger_image",left:"key=feed_image_click&value=image_turnlift",right:"key=feed_image_click&value=image_turnright",big:"key=feed_image_click&value=image_zoomout"}}).toString()).box);z.disp.style.display="";var b=a.sizzle('[node-type="count"]',z.disp)[0];b&&b.innerHTML=="(0)"&&a.removeNode(b);var f=a.sizzle('[action-type="feed_list_image_like"]',t)[0];if(k.object_ids){var g=decodeURIComponent(k.object_ids);a.lib.feed.plugins.like.likestatus(g,g,function(a){var b=a.count;a.exits==!0?innerHTML=b!=0?e('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i><em>'+b+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i></span></a>'):innerHTML=b!=0?e('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i><em>'+b+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i></span></a>');f.innerHTML=innerHTML;f.setAttribute("action-data","object_id="+g+"&mid="+k.mid+"&photo_id="+(k.pid?k.pid:q)+"&count="+a.count);f.style.display=""})}else f.style.display="";var h=a.sizzle('[action-type="feed_list_media_bigimg"]',t)[0];a.lib.image.multiimage.showtag({container:"",img:h,postdata:{mid:k.mid,pid:k.pid?k.pid:q}});o&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pc_image","stickers_image:"+o)};if(j.bigImgWidth)A();else{var B=j.offsetWidth,C=parseInt(j.offsetHeight/2-8);(y=a.core.dom.next(j)).style.cssText="margin:"+C+"px "+parseInt(B/2-8)+"px "+C+"px -"+parseInt(B/2+8)+"px;";(x=new Image).onload=A;x.src=r}}},o=function(c,d,e){var f=c.el;if(!!e||!!/(img)|(canvas)/.test(c.evt.target.tagName.toLowerCase())){var g=b.getFeedNode(f,d);if(!g){a.log("parents attribute mid is undefined!");return}g.disp="";var h=m(g,g.isForward);if(!h||!h.prev||!h.disp){a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');return}a.position(h.disp).t<a.scrollPos().top&&g.scrollIntoView();h.prev.style.display="";h.disp.style.display="none";h.disp.innerHTML=""}},p=function(c,d,e){var f=c.el,g=b.getFeedNode(f,d);if(!f.parentNode.uid){var h=a.sizzle('img[action-type="feed_list_media_bigimg"],canvas[id]',g)[0];f.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(h.oImage||h);h.setAttribute("id",f.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(f.parentNode.uid),e,l)},q=function(e,g,h,l){var n=e.el,o=e.data,p=b.getFeedNode(n,g),q=p.getAttribute("isForward")?"1":"",r=b.getMid(n,g),t=m(p,q);if(!t||!t.prev||!t.disp)a.log('node-type="feed_list_media_prev" or node-type="feed_list_media_disp" in a feed\'s node is undefined!');else{if(p.disp==o.short_url)return;if(l.voteObj[r]){l.voteObj[r].destroy();delete l.voteObj[r]}p.disp=o.short_url;p.isForward=q;t.prev.style.display="none";var u=decodeURIComponent(o.title),v=a.bLength(u)>71?a.leftB(u,70)+"...":u;u=a.bLength(u)>24?a.leftB(u,23)+"...":u;t.disp.innerHTML="";t.disp.appendChild(a.builder(d(c.mediaVideoMusicTEMP,{notForward:!q,short_url:decodeURIComponent(o.short_url),full_url:decodeURIComponent(o.full_url),title:u,fTitle:v,type:h}).toString()).box);t.disp.style.display="";var w=a.sizzle('div[node-type="feed_list_media_big'+h+'Div"]',t.disp)[0];if(!w){a.log('media: node-type="feed_list_media_big'+h+'Div" is not be found in feed_list_media_disp node!');return}l.dispContentNode[r]=w;var x="default";try{i?x="object":navigator.plugins["Shockwave Flash"]?x="embed":x="html5"}catch(y){}var z=function(){w.innerHTML=f},A=function(b){if(!b.result||b.error_code||b.error)z();else{var c=l.dispContentNode[r];c.mediaData=b.result;c.innerHTML="";c.appendChild(a.builder(c.mediaData).box);s&&s.setFixed(!0)}};k.request("mediaShow",{onComplete:A,onFail:z},{vers:3,lang:$CONFIG.lang,mid:r,short_url:o.short_url.replace(/http\:\/\/(t|sinaurl)\.cn\//,""),template_name:x,source:"3818214747"});if(h==="video"){a.scrollTo(t.disp,{step:1,top:j});setTimeout(function(){($CONFIG.islogin=="2"||$CONFIG.islogin=="0")&&a.lib.dialog.loginLayer()},1e3)}}},r,s,t=function(e,f,g){r&&a.fireEvent(r,"click");var h=e.el,i=e.data.title,j=b.getMid(h,f),k=g.dispContentNode[j],l=k.mediaData,m=a.builder(d(c.mediaVideoMusicFloatTEMP,{title:a.encodeHTML(i)}).toString()),n=m.list.outer[0],p=m.list.mediaContent[0];r=m.list.close[0];document.body.appendChild(n);s=a.lib.kit.dom.fix(n,"rb");if(l){p.innerHTML="";p.appendChild(a.builder(l).box);s.setFixed(!0)}else g.dispContentNode[j]=p;a.addEvent(r,"click",function(){a.removeEvent(r,"click",arguments.callee);s&&s.destroy();if(a.IE){var b=a.sizzle("object",n);for(var c=0,d=b.length;c<d;c++){var e=b[c];e&&(e=e.parentNode)&&(e.innerHTML="")}}a.removeNode(n);s=m=n=r=null});o(e,f,!0)},u=function(){r&&a.fireEvent(r,"click")},v=function(e,g,h){var i=e.el,j=b.getMid(i,g),l=e.data,n=b.getFeedNode(i,g),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=l.short_url&&!!p.disp){p.disp.innerHTML="";a.lib.feed.widget.clear(j);p.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!o,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',p.disp)[0];k.request("widget",{onSuccess:function(b){b=b.data;if(!!b.html){q.innerHTML=b.html;a.lib.feed.widget.add(j,p.disp)}},onFail:function(a){q.innerHTML=a&&a.msg||f},onError:function(a){q.innerHTML=a&&a.msg||f}},{short_url:decodeURIComponent(l.short_url),isforward:o,mid:j});n.disp=l.short_url;n.isForward=o}},w=function(a){return a==document.body?!1:a.getAttribute("feedtype")=="ad"?a:arguments.callee(a.parentNode)},x=function(a,b,c,d){var e=c;if(!!e){e=(e|0)+"px";b.style.height!=e&&(b.style.height=e);d("callback")}},y=function(b,c,d,e){var f=a.lib.publisher.publisherDialog(d||{});a.custEvent.add(f,"publish",function(){e("callback")})},z=function(b){a.foreach(a.sizzle("iframe",b),function(a){try{if(a.connect){a.connect.destroy();a.connect=null;a.src="about:blank"}}catch(b){}})},A=function(e,g,h){var i=e.el,j=b.getMid(i,g),l=e.data,n=b.getFeedNode(i,g),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=a.jsonToStr(l)){p.disp.innerHTML="";a.lib.feed.widget.clear(j);p.disp.appendChild(a.builder(d(c.widgetTEMP,{notForward:!o,short_url:l.short_url&&decodeURIComponent(l.short_url),full_url:l.full_url&&decodeURIComponent(l.full_url),title:l.title&&decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_widgetDiv"]',p.disp)[0],r=w(i);if(r){var s=r.getAttribute("data-mark");s=a.queryToJson(s)||{};l=a.lib.kit.extra.merge(l,s)}k.request("third_rend",{onSuccess:function(b){b=b.data;if(b.html){q.innerHTML=b.html;a.lib.feed.widget.add(j,p.disp)}else if(b.iframe){var c="feed_iframe_"+a.getUniqueKey();b.iframe=b.iframe+(b.iframe.indexOf("?")>=0?"&":"?")+"skin="+$CONFIG.skin;q.innerHTML='<iframe name="'+c+'" _src="'+b.iframe+'" allowTransparency="true" frameBorder="no" scrolling="no" style="width:100%;height:"'+(b.height||500)+';overflow:hidden;">';var d=q.firstChild;d.connect=a.lib.connect.iframe(d);d.connect.on("setHeight",x);d.connect.on("uiPublish",y)}},onFail:function(a){q.innerHTML=a&&a.msg||f},onError:function(a){q.innerHTML=a&&a.msg||f}},a.lib.kit.extra.merge({isforward:o,mid:j},l));n.disp=a.jsonToStr(l);n.isForward=o}},B=function(e,f,h){var i=e.el,k=b.getMid(i,f),l=e.data,n=b.getFeedNode(i,f),o=n.getAttribute("isForward")?"1":"",p=m(n,o);if(n.disp!=l.short_url){p.disp.innerHTML="";a.lib.feed.widget.clear(k);p.disp.appendChild(a.builder(d(c.qingTEMP,{notForward:!o,short_url:decodeURIComponent(l.short_url),full_url:decodeURIComponent(l.full_url),title:decodeURIComponent(l.title),suda:decodeURIComponent(l.suda||"")}).toString()).box);p.prev.style.display="none";p.disp.style.display="";var q=a.sizzle('div[node-type="feed_list_media_qingDiv"]',p.disp)[0],r=function(b){var c=b.code;if(c+""=="1"){b=b.data;if(!b.result)return;q.innerHTML=b.result;a.lib.feed.widget.add(k,p.disp)}else s(b)},s=function(a){q.innerHTML=g},t=l.template_name;t?t=="video"&&(a.IE?t="object":navigator.plugins&&navigator.plugins["Shockwave Flash"]?t="embed":t="html5"):t="";b.getTrans("qingShow",{onComplete:r,onFail:s}).request({short_url:l.short_url,lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn",mid:k,vers:3,template_name:t});n.disp=l.short_url;n.isForward=o;a.scrollTo(p.disp,{step:1,top:j})}};return function(c,d){if(!c)a.log("media : need object of the baseFeedList Class");else{var f=c.getNode(),g=c.getDEvent();b=c.utils;var h={},i=!0,j={dispContentNode:{},voteObj:{}},k=function(){a.custEvent.fire(c,"clearTips","media")},l=function(){var b=a.foreach(a.sizzle("img[node-type=fl_media_bgimg], img[node-type=feed_list_media_bgimg]",f),function(a){return a.src?a.src.replace("thumbnail","bmiddle"):null});a.lib.kit.extra.loadImageInBackground(b);FM.unallRenderReady(l)};a.custEvent.add(c,"updateFeed",l);FM.isOrigPageRenderReady()?l():FM.onallRenderReady(l);g.add("feed_list_media_toSmall","click",function(c){a.lib.feed.widget.clear(b.getMid(c.el,f));z(b.getFeedNode(c.el,f));k();o(c,f,!0);return b.preventDefault(c.evt)});g.add("feed_list_media_img","click",function(c){k();a.lib.image.multiimage.hastags().add(c.data.photo_tag_pids);a.lib.kit.extra.feedControlHash();n(c,f,j,d);return b.preventDefault(c.evt)});g.add("feed_list_media_bigimgDiv","click",function(a){k();o(a,f);return b.preventDefault(a.evt)});g.add("feed_list_media_toRight","click",function(a){k();p(a,f,90);return b.preventDefault(a.evt)});g.add("feed_list_media_toLeft","click",function(a){k();p(a,f,-90);return b.preventDefault(a.evt)});g.add("feed_list_media_video","click",function(a){k();q(a,f,"video",j);return b.preventDefault(a.evt)});g.add("feed_list_media_music","click",function(b){a.preventDefault();k();q(b,f,"music",j);return});g.add("feed_list_media_toFloat","click",function(d){k();a.custEvent.fire(c,"clearToFloat");t(d,f,j);return b.preventDefault(d.evt)});a.custEvent.define(c,"clearToFloat");a.custEvent.add(c,"clearToFloat",u);g.add("feed_list_media_magic","click",function(c){k();c.data.swf?a.lib.face.magic(c.data.swf):a.log("é­æ³è¡¨æçå°åä¸å­å¨: nodeä¸çaction-data swfä¸å­å¨!");return b.preventDefault(c.evt)});g.add("feed_list_media_v5update","click",function(c){k();c.data.swf?a.lib.face.magic(decodeURIComponent(c.data.swf),undefined,{isV5update:!0}):a.log("é­æ³è¡¨æçå°åä¸å­å¨: nodeä¸çaction-data swfä¸å­å¨!");return b.preventDefault(c.evt)});g.add("feed_list_media_widget","click",function(c){var d=a.fixEvent(c.evt),e=d.target,g=b.getFeedNode(e,f),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=h.feed_list_pulishMood;if(i){a.isArray(i)||(i=[i]);for(var l=0,m=i.length;l<m;l++){var n=i[l];if(e==n||a.core.dom.contains(n,e))return}}k();v(c,f,j);return b.preventDefault(c.evt)});g.add("feed_list_third_rend","click",function(a){k();A(a,f,j);return b.preventDefault(a.evt)});g.add("fl_playmusic","click",function(a){k();"WEIBO_MUSIC_PLAYER"in window?window.WEIBO_MUSIC_PLAYER.playSongByObjectId(a.data.object_id):A(a,f,j);return b.preventDefault(a.evt)});g.add("feed_list_media_qing","click",function(a){k();B(a,f,j);return b.preventDefault(a.evt)});g.add("feed_list_url","click",function(a){var c=a.el,d=b.getMid(c,f),e=b.getFeedNode(c,f),g="";e&&(g=e.getAttribute("minfo")?"&"+e.getAttribute("minfo"):"");var h=e.dataset&&e.dataset.mark||e.getAttribute("data-mark")||"",i=c.href+(c.href.indexOf("?")>=0?"&":"?");h?window.open(i+"u="+$CONFIG.oid+"&m="+d+"&cu="+$CONFIG.uid+"&"+h+g):window.open(i+"u="+$CONFIG.oid+"&m="+d+"&cu="+$CONFIG.uid+g);return b.preventDefault()});g.add("vote_toSmallInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_bigInfo&&(g.vote_bigInfo.style.display="none");g.vote_smallInfo&&(g.vote_smallInfo.style.display="");return a.preventDefault(c.evt)});g.add("vote_toBigInfo","click",function(c){var d=c.el,e=b.getFeedNode(d,f),g=a.lib.kit.dom.parseDOM(a.builder(e).list);g.vote_smallInfo&&(g.vote_smallInfo.style.display="none");g.vote_bigInfo&&(g.vote_bigInfo.style.display="");return a.preventDefault(c.evt)});g.add("vote_refresh_code","click",function(b){var c=b.el,d=c.src.replace(/ts=.+/,"")+"ts="+a.getUniqueKey();c.src=d;return a.preventDefault(b.evt)});g.add("feed_list_image_like","click",function(c){if(!!i){i=!1;var d=c.el,g=a.core.json.merge(c.data,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(c,g){var h=c.data.is_del?!0:!1,j=g.count;h?j--:j++;var k=j>0?j:0,l;h?l=k!=0?e('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i><em>'+k+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i></span></a>'):l=k!=0?e('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i><em>'+k+"</em></span></a>"):e('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i></span></a>');d.innerHTML=l;var n=a.lib.kit.extra.actionData(d);n.set("count",k);n.set("is_liked",h?0:1);var o=b.getFeedNode(d,f),p=o.getAttribute("isForward")?1:"",q=m(o,p),r=a.sizzle('[action-type="feed_list_media_img"]',q.prev)[0],s=a.lib.kit.extra.actionData(r),t=decodeURIComponent(s.get("pic_objects")),u=t.split("|");u[1]=h?0:1;u[2]=k;s.set("pic_objects",encodeURIComponent(u.join("|")));var v=a.sizzle('[action-type="widget_photoview"]',q.disp)[0],w=a.lib.kit.extra.actionData(v);w.set("pic_objects",encodeURIComponent(u.join("|")));i=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);i=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);i=!0}}).request(g)}});g.add("fl_url_addparams","click",function(a){var c=a.el,d=b.getMid(c,f),e=b.getFeedNode(c,f),g="";e&&(g=e.getAttribute("tbinfo")?"&"+e.getAttribute("tbinfo"):"");var h=e.getAttribute("omid")||"",i=e.getAttribute("data-mark");i=i?"&"+i:"";var j="mid="+d+(h?"&omid="+h:"")+g+i;window.open(c.href.indexOf("?")>-1?c.href+"&"+j:c.href+"?"+j);return b.preventDefault()});window.playCompleted=function(){$CONFIG.islogin=="1"&&location.href.indexOf("spr_sinamkt_buy_baiduv_weibouv_v001")!=-1&&a.lib.dialog.loginLayer({lang:window.$CONFIG&&window.$CONFIG.lang||"zh-cn"})};h.destroy=function(){z(f);s&&s.destroy();f=g=undefined;a.lib.feed.widget.destroy();a.custEvent.remove(c,"clearToFloat",u);window.playCompleted=null;FM.unallRenderReady(l);a.custEvent.remove(c,"updateFeed",l)};return h}}});
STK.register("lib.image.multiimages",function(a){var b=a.lib.feed.imageLikeWhiteList(),c=$CONFIG.imgPath,d='<div style="top:0px;left:0px;display:none;" node-type="recLayer" class="W_layer"></div>',e='<#et recimg data><ul class="pic_list clearfix"><#list data.recimgs as list><li><a target="_blank" href="${list.imgsrc}"><img src="${list.img}"></a></li></#list></ul></#et>',f='<#et images data><div node-type="imagesBox" class="WB_expand_media S_bg1"><div class="tab_feed_a clearfix"><div class="tab"><ul class="clearfix"><#if (data.toSmall == 1)><li><span class="line S_line1"><a action-type="feed_list_media_toSmall" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_arrow_fold S_ficon">k</i>#L{æ¶èµ·}</a></span></li></#if><li><span class="line S_line1"><a action-type="widget_photoview" node-type="tobig" action-data="pid=${data.currentPid}" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_search S_ficon">f</i>#L{æ¥çå¤§å¾}</a></span></li><li><span class="line S_line1"><a action-type="turnLeft" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnleft S_ficon">m</i>#L{åå·¦æè½¬}</a></span></li><li><span class="line S_line1"><a action-type="turnRight" href="javascript:;" class="S_txt1"><i class="W_ficon ficon_turnright S_ficon">n</i>#L{åå³æè½¬}</a></span></li></ul></div></div><div class="WB_media_view"><div class="media_show_box">          <ul class="clearfix" node-type="picShow"><!--æ ¹æ®é¼ æ æå¨åºåèå´éæ©ï¼åå·¦çé¼ æ æåç±»åleftcursorï¼åå³é¼ æ æåç±»årightcursor,å¾çåå°smallcursor--><li node-type="imgBox" class="leftcursor"><div class="artwork_box"><div node-type="imgSpanBox"><img node-type="imgShow" src="${data.currentUrl}"></div><span node-type="multi_image_like" style="display:none;" action-type="multi_image_like" action-data="mid=${data.mid}&photo_id=${data.pid}&is_liked=${data.is_liked}&count=${data.count}&object_id=${data.object_id}"><a href="" class="W_btn_alpha" title="èµ"><i class="icon_praise"></i><span>èµ</span></a><a href="" class="W_btn_alpha" title="åæ¶èµ"><i class="icon_praised"></i><span>(3220000)</span></a></span></div><i node-type="loading" style="display: none;" class="W_loading"></i></li></ul>'+d+"</div>"+'<div class="pic_choose_box clearfix">'+'<a href="javascript:;" node-type="prev" action-type="prev" class="arrow_left_small S_bg2 arrow_dis" title="ä¸ä¸é¡µ"><i class="W_ficon ficon_arrow_left S_ficon">b</i></a>'+'<div class="stage_box">'+'<ul node-type="picChoose" class="choose_box clearfix">'+"<#list data.picChoose as picChoose>"+'<li><a href="javascript:;"<#if (picChoose.pid == data.currentPid)> class="current"</#if> node-type="thumbItem" action-type="thumbItem" action-data="pid=${picChoose.pid}"><img class="S_line2" src="${picChoose.url}" alt=""></a></li>'+"</#list>"+"</ul>"+"</div>"+'<a href="javascript:;" node-type="next" action-type="next" class="arrow_right_small arrow_dis S_bg2" title="#L{ä¸ä¸é¡µ}"><i class="W_ficon ficon_arrow_right S_ficon">a</i></a>'+"</div>"+" </div>"+"</div>"+"</#et>";return function(b){var c={},d,e,g="",h=0,i=0,j="",k,l,m={},n=450,o=!1,p=!1,q=!1,r=a.lib.kit.extra.language,s=[],t,u="",v=a.parseParam({currentPid:"",pids:[],object_ids:"",filter_ids:[],pic_objects:"",picShowWidth:440,sum:7,thumbWidth:59,mid:"",uid:"",isForward:0,toSmall:1},b),w=[],x=[],y=[],z=[],A=!0,B,C={pic:[3,7],rec:[1,8.6]},D={getIndex:function(a,b){var c=0;for(var d=0;a[d];d++)if(a[d]==b){c=d;break}return c},setPic:function(b,c){var e=b.pid;if(!(!e&&(j=e)||e==j)){var f=a.lib.kit.extra.imageURL(e,{size:"bmiddle"}),g=a.C("img");m[e]=g;j=e;d.loading.style.display="";g.onload=function(){g.onload=null;D.setpid();d.loading.style.display="none";var c=a.core.ani.tween(d.imgSpanBox,{duration:150,end:function(){d.imgSpanBox.innerHTML="";a.setStyle(d.imgSpanBox,"height","");d.imgSpanBox.appendChild(g);a.tween(d.imgSpanBox,{duration:100,animationType:"easeoutcubic"}).play({opacity:1}).destroy();D.setLikeStatus(b)}});c.play({opacity:.3}).destroy();setTimeout(function(){var b=g;a.lib.image.multiimage.showtag({container:"",img:b,postdata:{mid:v.mid,pid:e}})},0)};g.src=f;for(var h=0;s[h];h++)s[h].onload=null;s.push(g)}},setIndex:function(b){switch(b){case"min":h--;break;case"add":h++;break;default:h=b}h<0&&(h=0);if(h>i-1){q?h=i:h=i-1;D.showRec()}a.position(d.imagesBox).t<a.scrollPos().top&&a.scrollTo(d.imagesBox,{top:120,step:10});h>i-3&&D.getRecPics();D.setCurrentThumb();D.scrollList();var c=v.filter_ids[h];c&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pc_image","stickers_image:"+c)},setLikeStatus:function(a){var b=d.multi_image_like;if(b){var c=a.count;a.is_liked?b.innerHTML=c!=0?r('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i><em>'+c+"</em></span></a>"):r('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i></span></a>'):b.innerHTML=c!=0?r('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i><em>'+c+"</em></span></a>"):r('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i></span></a>');b.setAttribute("action-data","mid="+v.mid+"&photo_id="+a.pid+"&is_liked="+a.is_liked+"&count="+a.count+"&object_id="+a.object_id);b.style.display=""}},showRec:function(){if(!!q){var b=a.core.dom.getSize(d.picShow),c=a.core.dom.getSize(d.recLayer);b.height<c.height&&(d.picShow.style.height=c.height+"px");var e=t||(b.height-c.height)/2;e=e-c.height/2;e>b.height-c.height&&(e=b.height-c.height);e<0&&(e=0);d.imgSpanBox.innerHTML=reclayerHTML;d.multi_image_like.style.display="none";o=!0;window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_pic_recommend","recommend_exposure")}},scrollList:function(){return function(a,b){var c=Math.floor(v.sum/2),e=h;b&&(e=a);var f=i;if(f>v.sum){var g=e-c;if(g<=0){g=0;d.prev.className!="arrow_left_small arrow_dis S_bg2"&&(d.prev.className="arrow_left_small arrow_dis S_bg2")}else d.prev.className!="arrow_left_small S_bg2"&&(d.prev.className="arrow_left_small S_bg2");if(g>=f-v.sum){g=f-v.sum;d.next.className!="arrow_right_small arrow_dis S_bg2"&&(d.next.className="arrow_right_small arrow_dis S_bg2")}else d.next.className!="arrow_right_small S_bg2"&&(d.next.className="arrow_right_small S_bg2");var j=0-v.thumbWidth*g;l.play({marginLeft:j})}}}(),setCurrentThumb:function(){for(var b in d.thumbItem)a.removeClassName(d.thumbItem[b],"current");d.thumbItem[h]&&a.addClassName(d.thumbItem[h],"current")},rotateImg:function(b,c){var e=b.el,f=a.sizzle("img",d.imgSpanBox)[0];!f&&(f=document.getElementById(u));e.parentNode.uid=a.core.dom.uniqueID(f)+"_"+a.core.util.getUniqueKey();u=e.parentNode.uid;f.setAttribute("id",e.parentNode.uid);a.lib.kit.dom.rotateImage.rotateRight(a.E(e.parentNode.uid),c,n)},getImgsrc:function(a,b,c){var d="http://photo.weibo.com/"+a+"/wbphotos/large/mid/"+b+"/pid/"+c+"?refer=weibofeedv5";return d},setpid:function(){var a="pid="+j+"&mid="+v.mid+"&uid="+v.uid+"&pic_objects="+B;d.tobig.setAttribute("action-data",a)},getRecPics:function(){if(!p){p=!0;a.conf.trans.image.getTrans("recmodlayer_new",{onSuccess:function(a){reclayerHTML=a.data.html;q=!0},onError:function(a){o=!1;q=!1}}).request({mid:v.mid,uid:v.uid})}}},E=function(){B=v.pic_objects;var b=decodeURIComponent(v.pic_objects);b=b.split(",");var c=decodeURIComponent(v.object_ids);c=c.split(",");if(c&&c[0]&&c[0]!=""){w=v.pids||[];z=c;a.lib.feed.plugins.like.likestatus(z[h],z.join(","),function(a,b){for(var c=0,d=z.length;c<d;c++){x.push(b[z[c]].exits);y.push(b[z[c]].count)}var e=[];for(var c=0,d=w.length;c<d;c++)e.push(w[c]+"|"+x[c]+"|"+y[c]+"|"+z[c]);B=encodeURIComponent(e.join(","));D.setLikeStatus({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]});D.setpid()})}else for(var e=0,g=b.length;e<g;e++){var m=b[e];m=m.split("|");w.push(m[0]);x.push(m[1]);y.push(m[2]);z.push(m[3])}var n=w.length==1&&w[0]==""?v.pids:w;j=v.currentPid||n[0];i=n.length;h=D.getIndex(n,j);var o=[],p=[];for(var e=0;e<i;e++)p.push({pid:n[e],url:a.lib.kit.extra.imageURL(n[e],{size:"square"})});var q=a.core.util.easyTemplate(r(f),{picShow:o,picChoose:p,currentPid:n[h],currentUrl:a.lib.kit.extra.imageURL(n[h],{size:"bmiddle"}),isForward:v.isForward,toSmall:v.toSmall,pic_objects:v.pic_objects,notShowLikeBtn:v.pic_objects!="",is_liked:+x[h],count:y[h]||0,object_id:z[h],mid:v.mid,pid:n[h]}).toString(),s=a.builder(q);d=a.lib.kit.dom.parseDOM(s.list);b&&b[0]&&b[0]!=""&&(d.multi_image_like.style.display="");k=a.delegatedEvent(d.imagesBox);d.picChoose.style.marginLeft="1px";var t=d.count;t&&t.innerHTML=="(0)"&&a.removeNode(t);l=a.core.ani.tween(d.picChoose,{duration:150});D.setIndex(h);D.setpid();setTimeout(function(){var b=d.imgShow;a.lib.image.multiimage.showtag({container:"",img:b,postdata:{mid:v.mid,pid:n[h]}})},0)},F={gesture:function(b){b=a.fixEvent(b);var c=b.clientX-a.position(d.picShow).l,e=C.pic;o&&(e=C.rec);if(c<v.picShowWidth*e[0]/10)if(h==0)if(v.toSmall==1){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else{d.imgBox.className="clearfix leftcursor";g="left"}else if(c<v.picShowWidth*e[1]/10)if(v.toSmall==1&&!o){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else if(c>v.picShowWidth*e[1]/10)if(o)if(v.toSmall==1){d.imgBox.className="clearfix smallcursor";g="small"}else{d.imgBox.className="clearfix";g=""}else{d.imgBox.className="clearfix rightcursor";g="right"}},left:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(d.imagesBox).t,c=a.core.dom.getSize(d.imagesBox).height,e=a.scrollPos().top,f=a.winSize().height;if(e>b+c)return;if(e+f<b)return;D.setIndex("min");D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]},!0);return w[h]||v.pids[h]}},right:function(){if(!a.inArray(document.activeElement.tagName.toUpperCase(),["TEXTAREA","INPUT","SELECT"])){var b=a.position(d.imagesBox).t,c=a.core.dom.getSize(d.imagesBox).height,e=a.scrollPos().top,f=a.winSize().height;if(e>b+c)return;if(e+f<b)return;D.setIndex("add");D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]});return w[h]||v.pids[h]}},gestureClick:function(b){var c=a.core.dom.dir.parent(d.picShow,{expr:"[mid]"})[0],e=c.getAttribute("omid")||c.getAttribute("mid")||"",f=a.fixEvent(b);if(f.target.tagName.toLowerCase()!="a"&&f.target.parentNode.tagName.toLowerCase()!="a")switch(g){case"left":o&&F.closeRecLayer();var h=F.left();h&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",e,h].join(":"));break;case"small":F.tosmall();break;case"right":b=a.fixEvent(b);t=b.pageY-a.position(d.picShow).t;var h=F.right();h&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",e,h].join(":"))}},prev:function(){var a=h-7;D.scrollList(a,!0)},next:function(){var a=h+7;D.scrollList(a,!0)},tosmall:function(b){v.toSmall!=0&&a.custEvent.fire(c,"tosmall")},thumbItem:function(b){var c=a.core.dom.dir.parent(d.picShow,{expr:"[mid]"})[0],e=c.getAttribute("omid")||c.getAttribute("mid")||"";o&&F.closeRecLayer();var f=b.data.pid,g=D.getIndex(v.pids,f),i=g<h?!0:!1;D.setIndex(g);D.setPic({pid:w[h]||v.pids[h],is_liked:+x[h],count:y[h]||0,object_id:z[h]},i);window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack("tblog_newimage_feed",["image_feed_next",e,f].join(":"))},turnRight:function(a){o||D.rotateImg(a,90)},turnLeft:function(a){o||D.rotateImg(a,-90)},closeRecLayer:function(){o=!1},like:function(b){var b=a.fixEvent(b);a.core.evt.stopEvent(b);if(!!A){A=!1;var e=d.multi_image_like,f=a.queryToJson(e.getAttribute("action-data"));f=a.core.json.merge(f,{location:$CONFIG.location,object_type:"pic",ref:"feed"});a.conf.trans.feed.attitude.getTrans("objLike",{onSuccess:function(b,d){var f=b.data.is_del?!0:!1,g=d.count;f?g--:g++;var h=g>0?g:0,i;f?i=h!=0?r('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i><em>'+h+"</em></span></a>"):r('<a class="W_btn_alpha" title="#L{èµ}" href="javascript:"><span><i class="W_ficon ficon_praised">Ã±</i></span></a>'):i=h!=0?r('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i><em>'+h+"</em></span></a>"):r('<a class="W_btn_alpha" title="#L{åæ¶èµ}" href="javascript:"><span class="W_praised"><i class="W_ficon ficon_praised">Ã±</i></span></a>');e.innerHTML=i;var j=a.lib.kit.extra.actionData(e);j.set("count",h);j.set("is_liked",f?0:1);for(var k=0,l=z.length;k<l;k++)if(z[k]==d.object_id){x[k]=f?"0":"1";y[k]=h;break}a.custEvent.fire(c,"rewritedata",{isDel:f,count:h,object_id:d.object_id});A=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);A=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);A=!0}}).request(f)}}},G=function(){d.picShow.style.backgroundImage="url(about:blank)";a.addEvent(d.picShow,"mousemove",F.gesture);a.addEvent(d.picShow,"click",F.gestureClick);a.lib.kit.touch.cantouch&&a.addEvent(d.picShow,"swipeLeft",F.right);a.lib.kit.touch.cantouch&&a.addEvent(d.picShow,"swipeRight",F.left);d.multi_image_like&&a.addEvent(d.multi_image_like,"click",F.like);k.add("tosmall","click",F.tosmall);k.add("thumbItem","click",F.thumbItem);k.add("prev","click",F.prev);k.add("next","click",F.next);k.add("turnLeft","click",F.turnLeft);k.add("turnRight","click",F.turnRight);k.add("closeRecLayer","click",F.closeRecLayer);a.core.evt.hotKey.add(document.body,["ctrl+Left"],F.left);a.core.evt.hotKey.add(document.body,["ctrl+Right"],F.right);a.custEvent.define(c,["tosmall","rewritedata"])},H=function(){E();G()};H();var I=function(){a.removeEvent(d.picShow,"mousemove",F.gesture);a.removeEvent(d.picShow,"click",F.gestureClick);a.lib.kit.touch.cantouch&&a.removeEvent(d.picShow,"swipeLeft",F.right);a.lib.kit.touch.cantouch&&a.removeEvent(d.picShow,"swipeRight",F.left);d.multi_image_like&&a.removeEvent(d.multi_image_like,"click",F.like);a.core.evt.hotKey.remove(document.body,["ctrl+Left"],F.left);a.core.evt.hotKey.remove(document.body,["ctrl+Right"],F.right);k.destroy();a.removeNode(d.imagesBox)},J=function(){return d.imagesBox};c.destroy=I;c.getOuter=J;return c}});
STK.register("lib.image.inImagesList",function(a){return function(){var a={1652503967:!0,1591509437:!0,1143373133:!0,1764389994:!0,1280811967:!0,1729169932:!0,1651510284:!0,1617764514:!0,1946554430:!0,1285469314:!0,1262112935:!0,1676636885:!0,1708288973:!0,1400565967:!0,1495295187:!0,1402678221:!0,1739933965:!0,1570387057:!0,2189475170:!0,1934174435:!0,1957919150:!0,1591319844:!0,1688756227:!0,1210454405:!0,1650751185:!0,1056937372:!0,1727194535:!0,1659551324:!0,2722504223:!0,1809031027:!0,1549063143:!0,1650555225:!0,1151306150:!0,1596771247:!0,1418859182:!0,1005343850:!0,1111681197:!0,1650555225:!0,1514267615:!0,1984946117:!0,1382274984:!0,1674710384:!0,1833036301:!0,1790518657:!0,1680967943:!0,1862732053:!0,1396386905:!0,1708062733:!0,1787875513:!0,2355472515:!0,1161646031:!0,2306169161:!0,1980500411:!0,1663593323:!0,1767645900:!0,2394143903:!0,2126255307:!0,2425455271:!0,1385892075:!0,1233463251:!0,1729076850:!0,1605275581:!0,1957375697:!0,1798857424:!0,2790784425:!0,2016713117:!0,1787355915:!0,1928349275:!0,1658790201:!0,2407023267:!0,1984946117:!0,1970683355:!0},b=$CONFIG.uid.split("");return a[$CONFIG.uid]?!0:(b.pop()||!0)&&b.pop()==4?!0:!1}});
STK.register("lib.feed.plugins.images",function(a){var b=$CONFIG.imgPath;return function(b,c){if(!b)a.log("images : need object of the baseFeedList Class");else{var d=a.lib.image.multiimages,e=b.getNode(),f=b.getDEvent(),g=b.utils,h={},i,j={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)}},k={fl_pics:function(b){var c=g.getFeedNode(b.el,e);if(c.getAttribute("isimgloading")!=="true"){c.setAttribute("isimgloading","true");if(!i){i=a.C("i");i.className="W_loading"}var f=b.data||{};b.el.parentNode.appendChild(i);i.style.display="";var h=a.C("img"),k=j.getPDNodes(c),m=a.core.json.queryToJson(j.getActionData(b.el,"fl_pic_list"));a.lib.image.multiimage.hastags().add(m.photo_tag_pids);var n=m.pic_ids.split(","),o=m.uid,p=m.mid?m.mid:g.getMid(b.el,e),q=f.pic_id||n[0],r=m.pic_objects||"";h.onload=function(){h.onload=null;i.style.display="none";a.removeNode(i);i=null;var b=m.photo_filter_ids===undefined?undefined:function(b){var c=Array(n.length);a.foreach(b.split(","),function(a){a=a.split(":");c[a[0]|0]=a[1]});return c}(m.photo_filter_ids);k.prev.style.display="none";var e=d({pids:n,pic_objects:r,object_ids:m.object_ids||"",filter_ids:b,currentPid:q,mid:p,uid:o});k.disp.appendChild(e.getOuter());k.disp.style.display="";c.removeAttribute("isimgloading");a.custEvent.add(e,"tosmall",function(b,d){a.position(k.disp).t<a.scrollPos().top&&c.scrollIntoView();k.disp.style.display="none";k.prev.style.display="";e.destroy()});a.custEvent.add(e,"rewritedata",function(b,c){var d=a.sizzle('[node-type="fl_pic_list"]',k.prev)[0],e=a.lib.kit.extra.actionData(d),f=decodeURIComponent(e.get("pic_objects"));f=f.split(",");var g=f.length,h=[],i=[],j=[],l=[];for(var m=0,n=g;m<n;m++){var o=f[m];o=o.split("|");if(o[3]==c.object_id){o[1]=c.isDel?"0":"1";o[2]=c.count}h.push(o[0]);i.push(o[1]);j.push(o[2]);l.push(o[3])}var p=[];for(var m=0,n=g;m<n;m++)p.push(h[m]+"|"+i[m]+"|"+j[m]+"|"+l[m]);e.set("pic_objects",encodeURIComponent(p.join(",")));var q=a.sizzle('[node-type="tobig"]',k.disp)[0],r=a.lib.kit.extra.actionData(q);r.set("pic_objects",encodeURIComponent(p.join(",")))});l(n)};var s=a.lib.kit.extra.imageURL(q,{size:"bmiddle"});h.src=s;a.lib.kit.extra.feedControlHash()}}},l=function(b){var c=a.foreach(b,function(b){return a.lib.kit.extra.imageURL(b,{size:"bmiddle"})});a.lib.kit.extra.loadImageInBackground(c)},m=function(b){var c=a.sizzle("[node-type=imagesBox]",e),d;while(d=c.shift())if(d.getBoundingClientRect().bottom>0&&d.getBoundingClientRect().top<a.winSize().height)break;if(d){var f=a.sizzle("[action-type=thumbItem]",d),g;if(f&&f.length){var h=b==="left"?"pop":"shift";while(g=f[h]())if(a.core.dom.hasClassName(g,"current"))break;if(g=f[h]()){a.core.evt.fireEvent(g,"click");return}}}},n=function(a){m("left")},o=function(a){m("right")},p=function(){f.add("fl_pics","click",k.fl_pics);a.hotKey.add(document.documentElement,["left"],n,{type:"keydown",disableInInput:!0});a.hotKey.add(document.documentElement,["right"],o,{type:"keydown",disableInInput:!0})},q=function(){p()};q();h.destroy=function(){f.destroy();a.hotKey.remove(document.documentElement,["left"],n,{type:"keydown",disableInInput:!0});a.hotKey.remove(document.documentElement,["right"],o,{type:"keydown",disableInInput:!0})};return h}}});
STK.register("conf.trans.feed.feedShield",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedShield",{url:"/aj/user/block",method:"post"});c("activityDelete",{url:"/aj/activities/del",method:"post"});c("activityShield",{url:"/aj/activities/block",method:"post"});c("friendShied",{url:"/aj/mblog/friendsmblogshield?_wv=5",method:"post"});return b});
STK.register("lib.feed.plugins.feedShield",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.feedShield,d=a.lib.dialog.ioError;return function(e){function r(){f.remove("feed_list_shield_by_user","click",m);f.remove("feed_list_shield_by_ad","click",k);f.remove("feed_list_shield_by_mid","click",l);f.remove("feed_list_shield_by_app","click",n);f.remove("feed_list_shield_topic","click",o);f.remove("feed_list_shield_by_friends","click",p);f.remove("feed_list_shield_setkeyword","click",q)}function q(){a.custEvent.fire(e,"setkeyword")}function p(e){a.ui.confirm([b("#L{ç¡®è®¤å°%sç§»åºå¥½ååï¼}",decodeURIComponent(e.data.nickname)),b("#L{ç§»åºåï¼å½¼æ­¤åå¸çå¾®åå¨å¥½ååä¸å¯è§ï¼ä½ å¯ä»¥å¨%sä¸­æ¢å¤è¯¥æä½ã}",decodeURIComponent(e.data.nickname))]).ok(function(){c.request("friendShied",{onSuccess:function(a){j(e.el)},onError:function(a){d(a.code,a)},onFail:function(a){d(a.code,a)}},e.data)})}function o(c){a.ui.confirm([b("#L{ç¡®è®¤å±è½æ¥èª %s çå¾®ååï¼}",decodeURIComponent(c.data.topic)),b("#L{å¨âæçé¦é¡µâå°èªå¨å±è½è¯¥è¯é¢çæ°å¾®åã}"),b("#L{å¯ä»¥å¨%så¸å·è®¾ç½®-éç§è®¾ç½®%sä¸­å¢å æåæ¶å±è½ã}",'<a href="http://account.weibo.com/set/feed" target="_blank">',"</a>")]).ok(function(){i(c.data,function(){j(c.el)})})}function n(c){var d=b("#L{ä½ æ¯éä¼åç¨æ·å¯è¯ç¨æ­¤åè½24å°æ¶ï¼è¿æå¤±æï¼è¥æ³é¿æä½¿ç¨è¯·å¼é%så¾®åä¼å%s,}",'<a href="http://vip.weibo.com/privilege" target="_blank">',"</a>");c.data.member_type==1&&(d=b('#L{æ¨å½åä¸º}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>#L{ï¼}#L{å¯æ­£å¸¸ä½¿ç¨å±è½åè½ï¼}'));a.ui.confirm([b("#L{ç¡®è®¤å±è½æ¥èª  %s çå¾®ååï¼}",decodeURIComponent(c.data.appname)),d,b("#L{å¯ä»¥å¨%så¸å·è®¾ç½®-éç§è®¾ç½®%sä¸­å¢å æåæ¶å±è½}",'<a href="http://account.weibo.com/set/feed" target="_blank">',"</a>")]).ok(function(){i(c.data,function(){j(c.el)})})}function m(c){a.ui.confirm([b("#L{ç¡®è®¤å±è½ %s çå¾®ååï¼}",decodeURIComponent(c.data.nickname)),b("#L{å¨âæçé¦é¡µâå°èªå¨å±è½ä»çæ°å¾®åã}"),b("#L{å¯ä»¥å¨%så¸å·è®¾ç½®-éç§è®¾ç½®%sä¸­å¢å æåæ¶å±è½ã}",'<a href="http://account.weibo.com/set/feed" target="_blank">',"</a>")]).ok(function(){i(c.data,function(){j(c.el)})})}function l(a){j(a.el);a.data.justhide!=1&&i(a.data)}function k(a){j(a.el);c.request("adShield",{},a.data)}function j(b){var c=h.getFeedNode(b,g);c.style.height=c.offsetHeight+"px";c.style.overflow="hidden";var d=a.tween(c,{duration:200,animationType:"easeoutcubic",end:function(){c.innerHTML="";a.removeNode(c);g=b=c=null;d.destroy();e.getFeedCount()<1&&window.location.reload()}}).play({height:0})}function i(a,b){c.request("feedShield",{onSuccess:function(a){b&&b(a)},onError:function(a){b&&d(a.code,a)},onFail:function(a){b&&d(a.code,a)}},a)}var f=e.getDEvent(),g=e.getNode(),h=e.utils;f.add("feed_list_shield_by_user","click",m);f.add("feed_list_shield_by_ad","click",k);f.add("feed_list_shield_by_mid","click",l);f.add("feed_list_shield_by_app","click",n);f.add("feed_list_shield_by_friends","click",p);f.add("feed_list_shield_topic","click",o);f.add("feed_list_shield_setkeyword","click",q);return{destroy:r}}});
STK.register("lib.feed.plugins.activityShield",function(a){var b=a.lib.kit.extra.language,c=a.templet,d=a.conf.trans.feed.feedShield,e={FRAME:'<div style="display:none;position:absolute" node-type="FSLayer" action-type="feed_list_layer" class="layer_menu_list"></div>',SHIELD:{USER:{ITEM:b('<li><a action-type="activity_list_shield_by_user" href="javascript:void(0)" suda-data="#{SUDA_DATA}" action-data="filter_type=1&uid=#{UID}&nickname=#{NICKNAME}&gender=#{GENDER}">#L{å±è½} #{NICKNAME} #L{çå¾®å}</a></li>'),CONFIRM:b("<span>#L{ç¡®è®¤å±è½}<strong> #{NICKNAME}</strong> #L{çå¾®ååï¼}</span>"),SMALLTEXT:'#L{å¨âæçé¦é¡µâå°èªå¨å±è½%sçæ°å¾®åã}<br />#L{å¯ä»¥å¨}<a href="http://account.weibo.com/set/feed" target="_blank">#L{å¸å·è®¾ç½®-éç§è®¾ç½®}</a>#L{ä¸­å¢å æåæ¶å±è½ã}'},ACT_ID:{ITEM:b('<li><a action-type="activity_list_shield_by_mid" href="javascript:void(0)"  suda-data="#{SUDA_DATA}" action-data="filter_type=0&act_id=#{ACT_ID}&uid=#{UID}">#L{éèè¿æ¡å¨æ}</a></li>'),CONFIRM:b("<span>#L{ç¡®è®¤å±è½} <strong>#{NICKNAME} #L{çå¨æåï¼}</strong></span>"),SMALLTEXT:b('#L{ç³»ç»å°å¨ä½ çé¦é¡µèªå¨å±è½}#{GENDER}#L{çæ°å¨æã}<br />#L{å¯ä»¥å¨}<a href="http://account.weibo.com/set/feed" target="_blank">#L{å¸å·è®¾ç½®-éç§è®¾ç½®}</a>ä¸­è®¾ç½®ååæ¶å±è½ã}')},APP:{ITEM:b('<li><a action-type="activity_list_shield_by_app" href="javascript:void(0)"  suda-data="#{SUDA_DATA}" action-data="filter_type=2&uid=#{UID}&nickname=#{NICKNAME}&act_id=#{ACT_ID}&appname=#{APPNAME}&gender=#{GENDER}&member_type=#{MEMBERTYPE}">#L{å±è½æ¥èª} #{APPNAME} #L{çå¾®å}</a></li>'),CONFIRM:b("<span>#L{ç¡®è®¤å±è½æ¥èª}<strong> #{APPNAME} </strong> #L{çå¾®ååï¼}</span><br />"),SMALLTEXT:b('#L{å¨âæçé¦é¡µâå°èªå¨å±è½æ¥èªå®çæ°å¾®åã}<br />#L{å¯ä»¥å¨}<a href="http://account.weibo.com/set/feedsource" target="_blank">#L{å¸å·è®¾ç½®-éç§è®¾ç½®}</a>#L{ä¸­åæ¶å±è½ã}'),SMALLTEXTMEMBER:b('#L{æ¨å½åä¸º}<a href="http://vip.weibo.com/privilege">#L{å¾®åä¼å}</a>#L{ï¼}#L{å¯æ­£å¸¸ä½¿ç¨å±è½åè½ï¼}<br />#L{å¯å¨}<a href="http://account.weibo.com/set/feedsource" target="_blank">#L{å¸å·è®¾ç½®-éç§è®¾ç½®}</a>#L{ä¸­åæ¶å±è½ã}')}},TIPS:{USER:{USERMAX:{TITLE:b("#L{æç¤º}"),CONTENT:b('<dl class="point clearfix"><dt><span class="icon_warnM"></span></dt><dd><p class="S_txt1">#L{æ±æ­ï¼ä½ å·²ç»å±è½äº10äººçå¾®åï¼ä¸è½ç»§ç»­æä½äºã}</p><p class="S_txt2">#L{ä½ä½ å¯ä»¥è¯è¯ä¸é¢çåæ³}</p></dd></dl><div class="btn"><a class="W_btn_b" href="http://account.weibo.com/set/feed"><span>#L{ç®¡çæçå±è½}</span></a><a class="W_btn_i" href="http://vip.weibo.com/paycenter"><span><img src="'+$CONFIG.imgPath+"style/images/common/transparent.gif?version="+$CONFIG.version+'" alt="" class="ico_member">#L{ç«å³å¼éä¼å}</span></a></div>')},MEMBERMAX:{TITLE:b("#L{æç¤º}"),CONTENT:b('<dl class="point clearfix"><dt><span class="icon_warnM"></span></dt><dd><p class="S_txt1">#L{ä½ çå±è½æ°å·²æ»¡ï¼ç­ä¼ååçº§ååè¯å§ï¼}</p></dd></dl><div class="btn"><a href="http://vip.weibo.com/privilege"><span>#L{äºè§£æ´å¤ä¼åç¹æ}&raquo;</span></a><a action-type="iknow" class="W_btn_d" href="javascript:void(0)"><span>#L{ç¥éäº}</span></a></div>')},MEMBERTIMEOUT:{TITLE:b("#L{æç¤º}"),CONTENT:b('<dl class="point clearfix"><dt><span class="icon_warnM"></span></dt><dd><p class="S_txt1">#L{æ±æ­ï¼ä½ å·²ç»å±è½äºå¤ªå¤äººçå¾®åï¼ä¸è½ç»§ç»­æä½äºã}</p><p class="S_txt2">#L{ä½ä½ å¯ä»¥è¯è¯ä¸é¢çåæ³}</p></dd></dl><div class="btn"><a class="W_btn_b" href="http://account.weibo.com/set/feed"><span>#L{ç®¡çæçå±è½}</span></a><a class="W_btn_i" href="http://vip.weibo.com/paycenter"><span><img src="'+$CONFIG.imgPath+"style/images/common/transparent.gif?version="+$CONFIG.version+'" alt="" class="ico_member">#L{ç«å³å¼éä¼å}</span></a></div>')}},APP:{UNABLE:{TITLE:b("#L{è¯¥æ¥æºææ¶ä¸å¯å±è½å¦ã}"),CONTENT:b('<a href="http://weibo.com/zt/s?k=9286" target="_blank">#L{æè¦æå»ºè®®ã}</a>')},NOPERISSION:{TITLE:b("#L{æç¤º}"),CONTENT:b('<dl class="point clearfix"><dt><span class="icon_warnM"></span></dt><dd><p class="S_txt1">#L{æ¨è¿ä¸æ¯å¾®åä¼åï¼ä¸è½ä½¿ç¨æ­¤åè½ï¼}</p><p class="S_txt2">#L{å¼é}<a class="S_link2" href="http://vip.weibo.com/paycenter">#L{å¾®åä¼å}</a>#L{ï¼å¯å±è½æ¥èªç¬¬ä¸æ¹çåºç¨}</p><p class="S_txt2"><a href="http://vip.weibo.com/privilege"><span>#L{äºè§£æ´å¤ä¼åç¹æ}&raquo;</span></a></p></dd></dl><div class="btn"><a class="W_btn_b" href="http://account.weibo.com/set/feedsource"><span>#L{ç®¡çæçå±è½}</span></a><a class="W_btn_i" href="http://vip.weibo.com/paycenter"><span><img src="'+$CONFIG.imgPath+"style/images/common/transparent.gif?version="+$CONFIG.version+'" alt="" class="ico_member">#L{ç«å³å¼éä¼å}</span></a></div>')},MEMBERTIMEOUT:{TITLE:b("#L{æç¤º}"),CONTENT:b('<dl class="point clearfix"><dt><span class="icon_warnM"></span></dt><dd><p class="S_txt1">#L{æ¨çä¼åèº«ä»½å·²è¿æï¼ä¸è½ä½¿ç¨æ­¤åè½ï¼}</p><p class="S_txt2">#L{æ¨å¯ä»¥å}<a class="S_link2" href="http://vip.weibo.com/paycenter">#L{å¼éä¼å}</a>#L{åæ¥å±è½ç¬¬ä¸æ¹åºç¨}</p></dd></dl><div class="btn"><a class="W_btn_b" href="http://account.weibo.com/set/feedsource"><span>#L{ç®¡çæçå±è½}</span></a><a class="W_btn_i" href="http://vip.weibo.com/paycenter"><span><img src="'+$CONFIG.imgPath+"style/images/common/transparent.gif?version="+$CONFIG.version+'" alt="" class="ico_member">#L{ç«å³å¼éä¼å}</span></a></div>')}}}},f,g;return function(h){if(!h)throw"that : need object of the baseFeedList Class";var i=h.utils,j,k,l={},m=h.getNode(),n=h.getDEvent(),o,p,q={cache:null,dEvt:null,init:function(){q.cache=a.ui.dialog();a.addClassName(q.cache.getDomList().inner,"layer_point");q.dEvt=a.core.evt.delegatedEvent(q.cache.getDomList().inner);q.dEvt.add("iknow","click",q.cache.hide)},show:function(a){q.cache.setTitle(a.title);q.cache.setContent(a.content);q.cache.show();q.cache.setMiddle()},destroy:function(){q&&q.dEvt&&q.dEvt.destroy();q.cache=null;q=undefined}},l={create:function(){f=a.lib.kit.dom.parseDOM(a.core.dom.builder(e.FRAME).list).FSLayer;a.sizzle("body")[0].appendChild(f);p=a.core.evt.delegatedEvent(f);p.add("activity_list_shield_by_user","click",s.user.behavior);p.add("activity_list_shield_by_mid","click",s.actId.behavior);p.add("activity_list_delete","click",s.actId.my_behavior);p.add("activity_list_shield_by_app","click",s.app.behavior)},toggle:function(a){k=a.el;f||l.create();if(g===k)if(f.style.display=="none"){l.show();l.setLayerPos()}else l.hide();else{j=a.data;l.reDisplay()}},reDisplay:function(){var b=[];for(var c in s)b.push(s[c].item());f.innerHTML="<ul>"+b.join("")+"</ul>";b=null;l.setLayerPos();l.show();g&&a.setStyle(g,"visibility","");g=k},show:function(){a.setStyle(k,"visibility","visible");f&&a.setStyle(f,"display","");a.addEvent(document.body,"click",l.autoHide)},hide:function(){a.setStyle(k,"visibility","");f&&a.setStyle(f,"display","none");a.removeEvent(document.body,"click",l.autoHide)},setLayerPos:function(){var b=a.core.dom.getSize(f),c=a.core.dom.getSize(k),d=a.core.dom.position(k);a.setStyle(f,"top",d.t+c.height+"px");a.setStyle(f,"left",d.l+c.width-b.width+"px")},outLayer:function(){o&&clearTimeout(o);o=window.setTimeout(function(){l.autoHide()},50)},autoHide:function(b){var c=a.core.evt.getEvent(),d=a.fixEvent(c);!a.core.dom.contains(f,d.target)&&!a.core.dom.contains(k,d.target)&&d.target!==k&&l.hide()},reflushFeedList:function(){}},r=function(b,c,d){var e=i.getFeedNode(c,d);e.style.height=e.offsetHeight+"px";e.style.overflow="hidden";var f=a.tween(e,{duration:200,animationType:"easeoutcubic",end:function(){e.innerHTML="";a.removeNode(e);d=c=e=null;f.destroy();b.getFeedCount()<1&&window.location.reload()}}).play({height:0})},s={actId:{item:function(){if(j.act_id){var a="",d=e.SHIELD.ACT_ID.ITEM;j.cuid==j.uid&&(d=b("<li>"+(j.count_obj<=1?'<a action-type="activity_list_delete" href="javascript:void(0)"  suda-data="" action-data="filter_type=0&act_id=#{ACT_ID}&uid=#{UID}">#L{å é¤è¿æ¡å¨æ}</a>':"")+'<a target="_blank" href="http://app.weibo.com/myaction?refer=single_feed">#L{å¨æéç§è®¾ç½®}</a></li>'));return c(d,{ACT_ID:j.act_id,UID:j.uid})}return""},behavior:function(a){var b=k,c=a.data;c.location=$CONFIG.location;d.request("activityShield",{onComplete:function(a){s.user.handle(a,b)}},c);l.hide()},my_behavior:function(c){var e=k,f=c.data;a.ui.confirm(b("#L{ç¡®è®¤è¦å é¤è¿æ¡å¨æåï¼}"),{OK:function(){d.request("activityDelete",{onComplete:function(a){t(a,e);l.hide()}},f)}})},handle:function(a,b){t(a,b)}},user:{item:function(){return j.uid&&j.nickname?c(e.SHIELD.USER.ITEM,{ACT_ID:j.act_id,NICKNAME:j.nickname,GENDER:j.gender,SUDA_DATA:j.mblogsorttype=="1"?"key=smart_feed&value=block_sbsfeed":""}):""},behavior:function(f){var g=f.data;g.location=$CONFIG.location;var h=k;a.ui.confirm(c(e.SHIELD.USER.CONFIRM,{UID:f.data.uid,NICKNAME:f.data.nickname,GENDER:f.data.gender=="m"?"ä»":"å¥¹"}),{textSmall:b(e.SHIELD.USER.SMALLTEXT,f.data.gender=="m"?b("#L{ä»}"):b("#L{å¥¹}")),OK:function(){d.request("activityShield",{onComplete:function(a){s.user.handle(a,h)}},g)}})},handle:function(a,b){t(a,b)}},app:{item:function(){return j.uid&&j.nickname&&j.mid&&j.appname&&j.isactive&&j.isactive=="1"?c(e.SHIELD.APP.ITEM,{UID:j.uid,NICKNAME:j.nickname,APPNAME:j.appname,ACT_ID:j.act_id,GENDER:j.gender,SUDA_DATA:j.mblogsorttype=="1"?"key=smart_feed&value=block_appkey":"",MEMBERTYPE:j.member_type||0}):""},behavior:function(b){var f=k,g=b.data;g.location=$CONFIG.location;a.ui.confirm(c(e.SHIELD.APP.CONFIRM,{UID:b.data.uid,NICKNAME:b.data.nickname,APPNAME:b.data.appname,GENDER:b.data.gender=="m"?"ä»":"å¥¹"}),{textSmall:g.member_type==1?e.SHIELD.APP.SMALLTEXTMEMBER:e.SHIELD.APP.SMALLTEXT,OK:function(){d.request("activityShield",{onComplete:function(a){s.user.handle(a,f)}},g)}});l.hide()},handle:function(a,b){t(a,b)}}},t=function(b,c){var d="error";if(b.code=="100000"){d="succM";r(h,c,m)}else if(b.code=="100033"){if(b.data&&b.data.member_type>-1){var f={title:e.TIPS.USER.USERMAX.TITLE,content:e.TIPS.USER.USERMAX.CONTENT};switch(b.data.member_type){case 0:break;case 1:f.content=e.TIPS.USER.MEMBERMAX.CONTENT;break;case 2:f.content=e.TIPS.USER.MEMBERTIMEOUT.CONTENT;break;default:}q.show(f);return}}else if(b.code=="100035"){if(b.data&&b.data.member_type>-1){var f={title:e.TIPS.APP.NOPERISSION.TITLE,content:e.TIPS.APP.NOPERISSION.CONTENT};switch(b.data.member_type){case 0:break;case 1:break;case 2:f.content=e.TIPS.APP.MEMBERTIMEOUT.CONTENT;break;default:}q.show(f);return}a.ui.alert(e.TIPS.APP.UNABLE.TITLE,{type:"warn",textSmall:e.TIPS.APP.UNABLE.COCONTENT})}else a.ui.litePrompt(b.msg,{type:d,timeout:"1000"})},u=function(){n.add("activity_list_shield","click",l.toggle);q.init()};u();l.destroy=function(){p&&p.destroy();q&&q.destroy();p=q=l=undefined;f=null;g=null};return l}});
STK.register("conf.trans.feed.keywordShield",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("showblock",{url:"/aj/blockword/showblock",method:"get"});c("update",{url:"/aj/blockword/update",method:"get"});c("showfiltermblogs",{url:"/aj/mblog/showfiltermblogs",method:"get"});return b});
STK.register("lib.feed.plugins.keywordShield",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.keywordShield,d=a.lib.dialog.ioError,e={empty:b("#L{è¯·è¾å¥å³é®è¯}"),normal:b("#L{é3-20ä¸ªå­ç¬¦ï¼ç©ºæ ¼åé}"),"char":b("#L{å³é®è¯ä»æ¯æä¸­è±æåæ°å­}"),tooShort:b("#L{å±è½çå³é®è¯ä¸å¯å°äº3ä¸ªå­ç¬¦}"),tooLong:b("#L{å±è½çå³é®è¯ä¸å¯è¶è¿20ä¸ªå­ç¬¦}")},f=b('<div class="W_layer"><div class="content"><div class="W_layer_title" node-type="title">#L{å±è½å³é®è¯}</div><div class="W_layer_close"><a href="javascript:void(0);" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_setkeyword"><div class="setkeyword"><h2 class="tit W_fb">#L{éè¦å±è½çå³é®è¯ï¼}</h2><div class="con W_input" node-type="fake_area"><input node-type="textarea" type="text" value="" class="W_input width_value"></div></div><div node-type="tip_menber" class="W_tips tips_rederror clearfix" style="display:none;"><p class="icon"><span class="W_icon icon_rederrorS"></span></p><p class="txt">#L{ä½ è®¾ç½®çè¯ä¼çæ24å°æ¶ï¼è¿æå¤±æï¼è¥æ³é¿æçæè¯·å¼é}<a href="http://pay.vip.weibo.com/vippay?from=pbkeyword">#L{å¾®åä¼å}</a></p><p class="close"></p></div>       <div node-type="tip_menber_for_year" class="W_tips tips_rederror clearfix" style="display:none;"><p class="icon"><span class="W_icon icon_rederrorS"></span></p><p class="txt">#L{æå¤3ä¸ªå³é®è¯}<a href="http://pay.vip.weibo.com/vippay?from=pbkeyword">#L{åçº§æä¸ºå¹´è´¹ä¼å}</a>#L{å¯æ·»å 6ä¸ªå³é®è¯}</p><p class="close"></p></div> </div><div class="W_layer_btn S_bg1"><span class="pos"><a href="http://account.weibo.com/set/privacy#open=privacy_feeduser" target="_blank" class="link">#L{æ´å¤å±è½è®¾ç½®}</a></span><a href="javascript:void(0);" action-type="ok" class="W_btn_a btn_34px">#L{ä¿å­}</a><a href="javascript:void(0);" action-type="cancel" class="W_btn_b btn_34px">#L{åæ¶}</a></div></div></div>'),g='<span class="W_btn_b W_btn_tag" node-type="tag_item" value="{tagName}"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span>{tagName}<a href="javascript:void(0);" action-type="tag_del" class="W_ficon ficon_close S_ficon">X</a></span>',h='<div class="layer_menu_list" style="position:absolute;"><ul><li class="title S_txt2" node-type="msg"></li></ul></div>';return function(e){function G(){a.custEvent.remove(e,"setkeyword",r);i.remove("setKeyword","click",r);if(j){a.remove(fake_area,"click",C);a.remove(m,"foucs",D);a.remove(m,"blur",E);j.destroy();j=null}}function F(b){b=a.fixEvent(b);switch(b.keyCode){case 32:var c=a.trim(m.value);c.length&&y(c)&&(m.value="");a.preventDefault(b);break;case 8:m.value.length===0&&x()}setTimeout(function(){m.value=a.leftB(a.trim(m.value),v().length<p?20:0);u(a.trim(m.value))})}function E(){q.hide();a.removeClassName(l,"W_input_focus");if(m.value.length===0&&v().length===0){m.className="W_input width_value";m.value=b("#L{æ·»å å³é®è¯,æå¤3ä¸ªå±è½è¯,å¤ä¸ªå³é®è¯ç¨ç©ºæ ¼åé}")}}function D(){u(m.value);a.addClassName(l,"W_input_focus");a.core.dom.hasClassName(m,"width_value")&&(m.value="");m.className="W_input width_input"}function C(){m.focus()}function B(b){a.removeNode(a.core.dom.dir.parent(b.el,{expr:"[node-type=tag_item]"})[0])}function A(e){y(m.value);a.addClassName(e.el,"W_btn_a_disable");c.request("update",{onSuccess:function(){a.removeClassName(e.el,"W_btn_a_disable");j.once("hidden",function(){a.ui.notice(b("#L{ä¿å­æåï¼}")).on("hidden",function(){location.reload()})});j.hide()},onError:function(b){d(b.code,b);a.removeClassName(e.el,"W_btn_a_disable")},onFail:function(b){d(b.code,b);a.removeClassName(e.el,"W_btn_a_disable")}},{blockwords:encodeURIComponent(w().join(" "))})}function z(){c.request("showblock",{onSuccess:function(b){var c=b.data.is_member;if(c===0){n.style.display="";p=3}else if(c===1){o.style.display="";p=3}else p=6;b.data.blockwords.length&&a.foreach(b.data.blockwords.split(" "),function(a){y(a)});E()},onFail:function(a){d(a.code,a);j.hide()},onError:function(a){d(a.code,a);j.hide()}})}function y(b){b=a.trim(b);if(u(b)){var c=a.builder(g.replace(/\{tagName\}/g,a.encodeHTML(b))).box.firstChild;a.insertBefore(c,m);return!0}return!1}function x(){var b=v();b.length&&a.removeNode(b[b.length-1])}function w(){var b=[];a.foreach(v(),function(a){b.push(a.getAttribute("value"))});return b}function v(){return a.sizzle("[node-type=tag_item]",k)}function u(c){c=a.trim(c);if(a.core.str.bLength(c)<3){t(b("#L{å±è½çå³é®è¯ä¸å¯å°äº3ä¸ªå­ç¬¦}"));return!1}if(!/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(c)){t(b("#L{å³é®è¯ä»æ¯æä¸­è±æåæ°å­}"));return!1}if(a.core.str.bLength(c)>20){t(b("#L{å±è½çå³é®è¯ä¸å¯è¶è¿20ä¸ªå­ç¬¦}"));return!1}if(a.core.arr.indexOf(c,w())!=-1){t(b("#L{æ­¤å³é®è¯å·²å­å¨ï¼è¯·éæ°è¾å¥}"));return!1}t(b("#L{é3-20ä¸ªå­ç¬¦ï¼ç©ºæ ¼åé}"));return!0}function t(b){q||(q=a.ui.mlayer(h));q.getDomList().msg.innerHTML=b;document.activeElement===m&&(q.getState()?q.beside(m,{pos:"bottom-left"}):q.show().beside(m,{pos:"bottom-left"}))}function s(){a.foreach(v(),function(b){a.removeNode(b)})}function r(){if(!j){j=a.ui.dialog(f);k=j.getBox();m=j.getDomList().textarea;l=j.getDomList().fake_area;n=j.getDomList().tip_menber;o=j.getDomList().tip_menber_for_year;a.addEvent(l,"click",C);a.addEvent(m,"focus",D);a.addEvent(m,"blur",E);a.addEvent(m,"keydown",F);j.on("ok","click",A).on("cancel","click",function(){j.hide()}).on("tag_del","click",B).show()}else{s();j.show()}z()}var i=e.getDEvent(),j,k,l,m,n,o,p,q;a.custEvent.define(e,"setkeyword");a.custEvent.add(e,"setkeyword",r);i.add("setKeyword","click",r);return{destroy:G}}});
STK.register("conf.trans.map",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("getInternalInfo",{url:"http://api.weibo.com/2/location/geocode/is_domestic.json",method:"get",varkey:"callback",requestMode:"jsonp"});return b});
STK.register("lib.map.map",function(a){var b="http://js.t.sinajs.cn/t5/";if(!1)b=$CONFIG.jsPath;var c=b+"page/static/map/",d='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:500">\n\t\t  <div class="bg">\n\t\t\t\t<table border="0" cellspacing="0" cellpadding="0">\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t\t\t\t<div node-type="inner" class="map_box">\n\t\t\t\t\t\t\t\t\t\t<iframe node-type="iframe" frameborder="0" scrolling="no" src="about:blank;" style="width: 400px; height: 250px; border: 0pt none;" id="mini_map_panel"></iframe>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<a node-type="close" title="å³é­" class="W_close" href="javascript:;"></a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\t<div node-type="arrow" class="arrow arrow_b"></div>\n\t\t\t</div>\n\t\t</div>',e=function(){var b,e;return function(){var f=!1;if(!b){e=a.builder(d).list;b=a.ui.mod.layer(e.outer[0],{appendTo:null});var g=a.core.obj.sup(b,["show"]).show,h=e.close[0],i=e.outer[0],j=e.iframe[0],k=function(){b.hide()};a.addEvent(h,"click",k);b.refresh=function(){f=!1;return this};b.show=function(b,d){if(!b)a.log("common.map : node is no defined");else{if(f){g();return}d=a.parseParam({longitude:"",latitude:"",head:"",internal:"",addr:""},d);var e=d.internal==0?"g":"m";j.onload=j.onreadystatechange=function(){if(!f&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){g();j.onload=j.onreadystatechange=null;f=!0}};j.src=[c,e,"map.html?ver=",$CONFIG.version,"&",a.jsonToQuery(d)].join("")}};document.body.appendChild(i);b.destroy=function(){a.removeEvent(h,"click",k);a.removeNode(i);f=!1;return this}}return b}}();return e});
STK.register("lib.kit.extra.rects",function(a){var b=a.core.util.browser,c={},d=5,e=20,f={t:function(a,b){return a.t>b.h},b:function(a,b){return a.b>b.h},l:function(a,b){return a.l>b.w},r:function(a,b){return a.r>b.w}},g={domSize:function(b){var c=a.core.dom.getSize(b);return{w:Math.max(c.width,a.getStyle(b,"width").replace(/px|auto/gi,"")),h:Math.max(c.height,a.getStyle(b,"height").replace(/px|auto/gi,""))}},mouseXY:function(c){var d={x:c.pageX,y:c.pageY};if(b.IE6||b.IE7){var e=a.core.util.scrollPos();d.x=d.x+e.left;d.y=d.y+e.top}return d},getRows:function(a){var c=a.getClientRects();if(b.IE6||b.IE7){var d=[],e={},f;for(var g=0,h=c.length;g<h;g++){var i=c[g];e[i.top]||(e[i.top]=[]);e[i.top].push(i)}for(var j in e){var k=e[j],h=k.length,l=k[0];h>1&&(l.right=k[h-1].right);d.push(l)}c=d}return c},getTextRect:function(b,c){var d=a.parseParam({evt:""},c),e=a.core.util.scrollPos(),f;if(!b.getClientRects){var h=g.domSize(b);return{width:h.w,height:h.h,left:"",right:"",top:"",bottom:""}}var i={rows:g.getRows(b)},j=g.mouseXY(d.evt),k={x:j.x-e.left,y:j.y-e.top};for(var l=0,m=i.rows.length;l<m;l++){var n=i.rows[l];l==0&&(f=n);if(k.y>n.top&&k.y<n.bottom){f=n;break}}if(a.IE){var h=g.domSize(b);f=a.parseParam({width:h.w,height:h.h,left:"",right:"",top:"",bottom:""},f)}return f},getDistance:function(b,c){var d=a.core.util.winSize(),e=g.getTextRect(b,c);return{win:d,rect:e,w:e.width,h:e.height,t:e.top,l:e.left,r:d.width-e.right,b:d.height-e.bottom}},getSeat:function(b,c,d){var h=a.parseParam({distance:e,priority:"trbl"},d),i=g.getDistance(b,d),j=g.domSize(c);i.area="b";var k=h.priority.split("");for(var l=0,m=k.length;l<m;l++){var n=k[l];if(!f[n])throw'priority error, random use "tbrl" combination';if(f[n](i,j)){i.area=n;break}}return i},setArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e,followNode:!1,isFixed:!1,setArrowMiddle:!1},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];c.arrow.style.cssText="";var j=g.domSize(c.layer),k=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(k.top=0);var l,m,n,o=a.winSize().width-20,p=a.winSize().height-20,q=j.w,r=j.h,s=0;if(c.setArrowMiddle){if(h=="t"||h=="b")s=parseInt(i.width/2)-d;if(h=="l"||h=="r")s=parseInt(i.height/2)-d}if(h=="t"||h=="b"){if(i.left+j.w>o){c.distance=-(o-(i.left+j.w));c.arrow.style.cssText="left:"+c.distance+"px;right:auto;"}if(i.left-c.distance<0){c.distance=c.followNode?0:i.left;c.arrow.style.cssText="left:"+c.distance+"px;right:auto;"}}if(h=="l"||h=="r"){if(i.top+j.h>p){c.distance=-(p-(i.top+j.h));c.arrow.style.cssText="top:"+c.distance+"px;bottom:auto;"}if(i.top-c.distance<0){c.distance=c.followNode?0:i.top;c.arrow.style.cssText="top:"+c.distance+"px;bottom:auto;"}}if(c.isFixed){a.setStyle(c.layer,"position","fixed");k.top=k.left=0}if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance+s}else{l=i.top+k.top-c.distance+s;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px";return h},setLevelCardArrow:function(b){var c=a.parseParam({evt:"",node:"",layer:"",arrow:"",priority:"trbl",css_t:"arrow arrow_b",css_r:"arrow arrow_l",css_b:"arrow arrow_t",css_l:"arrow arrow_r",offset:d,distance:e},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";if(!c.arrow)throw"arrow node is undefined";var f=g.getSeat(c.node,c.layer,c),h=f.area,i=f.rect;c.arrow.className=c["css_"+h];c.arrow.style.cssText="";var j=g.domSize(c.layer),k=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(k.top=0);var l,m,n,o=a.winSize().width,p=j.w;if(h=="t"||h=="b"){l=h=="t"?i.top+k.top-j.h-c.offset:i.bottom+k.top+c.offset;m=i.left+k.left-c.distance;n=i.right+k.left-p+c.distance;if(n>0&&m+p>o+k.left){m=n;c.arrow.style.cssText="right:30px;left:auto;"}}else{l=i.top+k.top-c.distance;m=h=="r"?i.right+k.left+c.offset:i.left+k.left-j.w-c.offset}c.layer.style.top=l+"px";c.layer.style.left=m+"px"},setLayer:function(b){var c=a.parseParam({evt:"",node:"",layer:"",priority:"btrl",offsetX:0,offsetY:0},b);if(!c.node)throw"target node is undefined";if(!c.layer)throw"layer node is undefined";var d=g.getSeat(c.node,c.layer,c),e=d.area,f=d.rect,h=g.domSize(c.layer),i=a.scrollPos();window.navigator.userAgent.indexOf("iPad")>-1&&window.navigator.userAgent.indexOf("Version/7.0")>-1&&(i.top=0);var j,k,l,m=a.winSize().width,n=h.w;if(e=="t"||e=="b"){j=e=="t"?f.top+i.top-h.h+c.offsetY:f.bottom+i.top-c.offsetY;k=f.left+i.left+c.offsetX;l=f.right+i.left-n+c.distance;l>0&&k+n>m+i.left&&(k=l)}else{j=f.top+i.top+c.offsetY;k=e=="r"?f.right+i.left-c.offsetX:f.left+i.left-h.w+c.offsetX}c.layer.style.top=j+"px";c.layer.style.left=k+"px"}};c.getTextRect=g.getTextRect;c.getDistance=g.getDistance;c.getSeat=g.getSeat;c.setArrow=g.setArrow;c.setLevelCardArrow=g.setLevelCardArrow;c.setLayer=g.setLayer;return c});
STK.register("lib.feed.plugins.map",function(a){return function(b){var c=b.utils;if(!b)a.log("map : need object of the baseFeedList Class");else{var d,e;b.getDEvent().add("feed_list_geo_info","click",function(b){var f=a.fixEvent(),g=b.el,h=b.data,i=h.geo;if(!i)a.log("map: feed_list_geo_info node geo is empty");else{var j=function(b){a.lib.dialog.ioError(b.code,b)},k=function(c){if(typeof c=="object"&&c.code==1){var k=c.data.geo.type,l=i.split(",");d||(d=a.lib.map.map());var m=a.builder(d.getBox()).list;m.outer=[d.getBox()];e!=g&&d&&d.refresh();d.show(g,{latitude:l[1],longitude:l[0],head:h.head,addr:h.title,internal:k});a.lib.kit.extra.rects.setArrow({evt:f,node:b.el,layer:m.outer[0],arrow:m.arrow[0]});e=g}else j()};a.conf.trans.map.request("getInternalInfo",{onComplete:k,onFail:j},{coordinates:i+",geo",source:"4526198296"});return c.preventDefault(b.evt)}});var f=function(b){if(!!e){var c=a.fixEvent(b).target;e!=c&&!a.contains(e,c)&&d&&d.hide()}};a.addEvent(document,"click",f);a.custEvent.add(d,"hide",function(){e=undefined});var g={destroy:function(){a.removeEvent(document,"click",f);a.custEvent.remove(d);d&&d.destroy()}};return g}}});
STK.register("lib.feed.plugins.like.commentLike",function(a){return function(b,c){var d={},e,f,g=1,h=a.conf.trans.feed.attitude,i=!1,j,k=1,l,m,n,o=function(){n=a.lib.kit.extra.language},p={TITLE:"#L{%säººèµè¿æ­¤è¯è®º}",MAIN:{LOADING:['<div class="quick_reply_list S_line1" node-type="diaContent">','<ul class="clearfix" node-type="commentLikeList">',"#L{æ­£å¨å è½½...}","</ul>","</div>"].join("")}},q={moreLike:function(b){var c=b.el,d=b.data;h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.like_counts||0,c=a.data.html;c=n(c);k=parseInt(a.data.page.totalpage);q.newDialog(b,c);q.dialogEvtInit()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)},setLoading:function(){l&&(l.innerHTML=n("#L{æ­£å¨å è½½...}"))},newDialog:function(b,c){j&&j.destroy&&j.destroy();j=a.ui.dialog("likeDialog_"+a.getUniqueKey());j.setTitle(n(p.TITLE,b));j.setContent(c||"");j.show();j.setMiddle();j.setBeforeHideFn(q.beforeHide);l=a.sizzle("[node-type=commentLikeList]",j.getBox())[0]},getPageData:function(b,c){i=!0;q.setLoading();h.getTrans("cmtLikeMore",{onSuccess:function(a){var b=a.data.html;q.setContent(b);i=!1;c&&c()},onFail:function(b){a.lib.dialog.ioError(b.code,b);i=!1},onError:function(b){a.lib.dialog.ioError(b.code,b);i=!1}}).request(b)},listNextPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},listPrevPage:function(a){if(!i){var b=a.data;q.getPageData(b)}},setContent:function(a){j&&j.setContent&&j.setContent(a)},beforeHide:function(){g=1;q.dialogEvtDestroy();i=!1},dialogEvtInit:function(){f=a.delegatedEvent(j.getBox());f.add("nextPageOfLike","click",q.listNextPage);f.add("prevPageOfLike","click",q.listPrevPage);f.add("like_del","click",c)},dialogEvtDestroy:function(){f&&f.destroy()}},r=function(){e=b;e.add("moreCommentLike","click",q.moreLike)},s=function(){o();r()};s();d.destroy=function(){e&&e.destroy();j&&j.destroy&&j.destroy();l=null;m=null};return d}});
STK.register("lib.feed.plugins.like.init",function(a){return function(b){var c=a.conf.trans.feed.attitude,d=a.lib.kit.extra.language,e=b.getNode(),f=!1,g,h,i={},j=[],k=b.utils,l=b.getDEvent(),m,n=!0,o=[],p={},q,r=null,s,t,u,v,w=600,x=350,y='<div class="W_layer W_layer_pop" style="display:none;z-index:9998;" node-type="outer"><div class="content"><div class="layer_emotion" node-type="inner"><ul class="emotion_list clearfix" node-type="faceList"></ul></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_b" style="left:120px;"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';g=a.lib.kit.dom.parseDOM(a.builder(y).list);document.body.appendChild(g.outer);u=a.delegatedEvent(g.outer);var z,A,B={go:function(b){if(!$CONFIG||!$CONFIG.islogin||$CONFIG.islogin!="2"){A=b.el;var c=a.sizzle("em",b.el)[0];z=c&&parseInt(c.innerHTML)||0;f=!0;if(a.core.dom.contains(b.el,b.evt.relatedTarget)||g&&g.outer.style.display!="none"&&b.data.mid==q&&b.data.object_id==r){D();return}B.stop(b,!0);a.lib.kit.touch.cantouch||(v=setTimeout(function(){B.trans(b)},w))}},fill:function(b){A=b.el;if(!!n){n=!1;var f=k.getFeedNode(A,e),h=a.core.json.merge(b.data,{location:$CONFIG.location});h=a.core.json.merge(h,a.lib.kit.extra.getDiss(f));var i="miniadd";b.data.object_type&&b.data.object_type==="comment"&&(i="objLike");c.request(i,{onSuccess:function(c){var e=a.sizzle("em",b.el)[0];z=parseInt(e.innerHTML)||0;var f=c.data.is_del?!0:!1,h="W_icon icon_praised_b"+(f?"":"c"),i=f?"":"S_link1";f?z>0&&z--:z++;var j=a.sizzle('[node-type="like_status"]',b.el);z=z<=0?"":z;j[0]&&(j[0].innerHTML='<i node-type="fl_like_icon" class="'+h+'"></i> <em>'+z+"</em>");var k=a.sizzle("[node-type=fl_like_icon]",j[0])[0];f?setTimeout(function(){n=!0},1e3):k&&a.ui.effect(k,"bounce","slow",function(){setTimeout(function(){n=!0},1e3)});if(!f&&c.data.html&&g){m&&(m.style.display="none");b.el.title=d("#L{åæ¶èµ}");a.insertHTML(g.faceList,c.data.html,"afterbegin")}else{b.el.title=d("#L{èµ}");a.removeNode(a.sizzle('[uid="'+$CONFIG.uid+'"]',g.faceList)[0]);m&&(m.style.display="");a.sizzle("[uid]",g.faceList).length<=0&&B.stop(b,!0)}var l=a.sizzle('[node-type="faceMore"]',g.faceList)[0];z>4?l&&l.style.display=="none"&&(l.style.display=""):l&&l.style.display!="none"&&(l.style.display="none");if(g.outer.style.display!="none"){var o=a.sizzle("[uid]",g.faceList);o=function(a){var b=[],c;while(c=a.shift())c.style.display!="none"&&b.push(c);return b}(o);var p=a.sizzle("[node-type=faceMore]",g.faceList);p=p[0]?p[0].style.display==="none"?0:1:0;g.outer.style.width=o.length*40+p*40+13+"px";a.ui.card(g.outer).showByTarget(b.el)}},onFail:function(b){a.lib.dialog.ioError(b.code,b);n=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);n=!0}},h)}},trans:function(b){g&&g.outer&&(g.outer.style.display="none");var d="minismall",e="faceList",f={};if(b.data.object_type&&b.data.object_type==="comment"){d="cmtLike";e="likeList"}f=b.data;f.location=$CONFIG.location;g&&(g.outer.show=!0);c.request(d,{onSuccess:function(c){D();var d=c.data.total_number||c.data.like_counts||0;if(d!="0"){z=d;q=b.data.mid;r=b.data.object_id;g.object_id=b.data.object_id;var f=a.sizzle("em",b.el)[0];f.innerHTML=d;var h=a.lib.kit.dom.parseDOM(a.builder(c.data.html).list);g.faceList.innerHTML=h[e].innerHTML;var i=a.sizzle("[uid]",g.faceList),j=a.sizzle("[node-type=faceMore]",g.faceList);j=j[0]?j[0].style.display==="none"?0:1:0;a.sizzle('[uid="'+$CONFIG.uid+'"]',g.faceList)[0]||(m=i[3]);g.mid=b.data.mid;document.body.appendChild(g.outer);g.outer.style.display="";if(g&&g.outer.show===!0){document.body.appendChild(g.outer);g.outer.style.display="";g.outer.style.width=i.length*40+j*40+13+"px";a.ui.card(g.outer).showByTarget(b.el)}}},onFail:function(a){},onError:function(a){}},f)},stop:function(a,b){f=!1;if(b)C();else{D();j.push(setTimeout(C,x))}},checkPosition:function(b){p=a.position(g.outer);clearInterval(o);o=setInterval(function(){var c=a.position(b);(p.l!=parseInt(c.l+b.offsetWidth/2-120)||p.t!=parseInt(c.t-58))&&B.stop()},500)},cancelLike:function(b){a.preventDefault();z--;a.removeNode(a.core.dom.neighbor(b.el).parent("li").getCurrent());var e=a.sizzle('[action-type="like_del"]',g.faceList);e[0]&&a.removeNode(a.core.dom.neighbor(e[0]).parent("li").getCurrent());A.title=d("#L{èµ}");var f=a.sizzle('[node-type="like_status"]',A);f[0]&&(f[0].innerHTML='<i class="W_icon icon_praised_b"></i> <em> '+(z||"")+"</em>");m&&(m.style.display="");a.sizzle("[uid]",g.faceList).length<=0&&(g.outer.style.display="none");var h="minidel";b.data.object_type&&b.data.object_type=="comment"&&(h="objLike");c.request(h,{onSuccess:a.core.func.empty,onError:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)}},C=function(){clearTimeout(v);D();clearInterval(o);g&&(g.outer.style.display="none");g&&(g.outer.show=!1);p=undefined},D=function(){while(j.length)clearTimeout(j.pop())},E=!1,F=function(b){if(!E){E=!0;var e=a.core.json.merge(b.data,{location:$CONFIG.location});c.request("objLike",{onSuccess:function(c){var e=c.data.is_del?!0:!1,f="W_icon icon_praised_b"+(e?"":"c"),g=e?"":"S_link1",h=e?d("#L{èµ}"):d("#L{åæ¶èµ}"),i=a.sizzle("em",b.el)[0];count=i?parseInt(i.innerHTML||0):0;e?count--:count++;var j=count>0?count:"";b.data&&b.data.hide_num==1&&(j="");count=count<=0?"":count;b.el.innerHTML='<span class="btn_26px btn_inborder"><i node-type="fl_like_icon" class="'+f+'"></i>'+'<em class="'+g+'" node-type="fl_like_count">'+count+"</em></span>";var k=a.sizzle("i",b.el)[0];e?E=!1:k&&a.ui.effect(k,"bounce","slow",function(){E=!1});b.el.title=h},onFail:function(b){a.lib.dialog.ioError(b.code,b);E=!1},onError:function(b){a.lib.dialog.ioError(b.code,b);E=!1}},e)}},G=function(b){c.request("minidel",{onSuccess:function(c){var d=k.getFeedNode(b.el,e);d.style.height=d.offsetHeight+"px";d.innerHTML="";var f=a.tween(d,{end:function(){f.destroy();a.removeNode(d);el=d=null}}).play({height:0})},onError:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)},H=function(){l.add("fl_like","mouseover",B.go);l.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);l.add("fl_like","mouseout",B.stop);u.add("like_del","click",B.cancelLike);l.add("object_like","click",F);l.add("fl_remove_like","click",G);if(s){s.add("fl_like","mouseover",B.go);s.add("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);s.add("fl_like","mouseout",B.stop);s.add("object_like","click",F)}if(t){t.add("forward_like","mouseover",B.go);t.add("forward_like","click",B.fill);t.add("forward_like","mouseout",B.stop);t.add("object_like","click",F)}},I=function(){var b=a.sizzle('div[node-type="comment_detail"]')[0]||null,c=a.sizzle('div[node-type="forward_detail"]')[0]||null;b&&(s=a.delegatedEvent(b));c&&(t=a.delegatedEvent(c));h=a.lib.feed.plugins.like.commentLike(u,B.cancelLike);H();a.addEvent(g.outer,"mouseover",function(){clearTimeout(j)});a.addEvent(g.outer,"mouseout",function(){B.stop()})};I();i.destroy=function(){h.destroy&&h.destroy();l.remove("fl_like","mouseover",B.go);l.remove("fl_like",a.lib.kit.touch.cantouch?"tap":"click",B.fill);l.remove("fl_like","mouseout",B.stop);l.remove("object_like","click",F);l.remove("fl_remove_like","click",G);u.destroy();s&&s.destroy();t&&t.destroy();a.removeEvent(g.outer,"mouseover");a.removeEvent(g.outer,"mouseout")};return i}});
STK.register("lib.feed.plugins.deleteFeed",function(a){var b,c,d,e,f=a.conf.channel.feed,g=a.lib.kit.extra.language,h=a.core.util.templet,i=a.conf.trans.feed.feed,j={DERRORTEXT:g("#L{å é¤å¤±è´¥}ï¼")},k=function(b,d){e=a.ui.tip("confirm",{showCallback:function(){setTimeout(function(){e.aniHide()},600)},hideCallback:function(){c=undefined;e&&e.destroy&&e.destroy();e=null},direct:"up",msg:b,type:"error"});e.setLayerXY(d);e.aniShow()},l=function(c,d,e,g){var h=b.getFeedNode(e,g);h.style.height=h.offsetHeight+"px";h.style.overflow="hidden";var i=a.tween(h,{duration:200,animationType:"easeoutcubic",end:function(){h.innerHTML="";a.removeNode(h);g=e=h=null;i.destroy();c.getFeedCount()<1&&window.location.reload()}}).play({height:0});f.fire("delete")};return function(f,h){if(!f)a.log("deleteFeed : need object of the baseFeedList Class");else{b=f.utils;var j=f.getNode(),k=f.getDEvent(),m={},n=a.core.obj.parseParam({trans:i},h),o={init:function(){o.bind()},bind:function(){f.getDEvent().add("feed_list_delete","click",o.requestDelete)},requestDelete:function(e){a.custEvent.fire(f,"clearTips","deleteFeed");var i=e.el,k=b.getMid(i,j);if(c!=k){c=k;var m=b.getFeedNode(i,j).getAttribute("feedtype"),o={okCallback:function(){n.trans.request("delete",{onSuccess:function(){h.isWeiboDetail==1?window.location.href="http://weibo.com":l(f,k,i,j)},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{mid:k})},hideCallback:function(){c=undefined}};m&&m=="top"?o.msg=[g("#L{æ­¤æ¡å¾®åä¸ºç½®é¡¶ç¶æ}"),g("#L{ç¡®è®¤è¦å é¤è¿æ¡å¾®ååï¼}")]:o.msg="ç¡®è®¤è¦å é¤è¿æ¡å¾®ååï¼";var p=i;p=a.core.dom.neighbor(i).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();d=a.ui.tipConfirm(o.msg).ok(o.okCallback).on("hide",o.hideCallback).beside(p);return b.preventDefault(e.evt)}},hideTip:function(a){d&&(a?d.hide():d.anihide())},destroy:function(){e&&e.destroy();d&&d.destroy();d=e=okCallback=o=m=null}};o.init();m.hideTip=o.hideTip;m.destroy=o.destroy;return m}}});
STK.register("lib.dialog.popularizeLayer",function(a){return function(b){var c=a.lib.kit.extra.language,d=a.parseParam({src:"http://promote.vip.weibo.com/promote?from=promote_profile",isHold:!0,width:"460",height:"367",mid:"",title:c("#L{æ¨å¹¿}"),succCallback:a.core.func.empty,failCallback:a.core.func.empty},b||{}),e,f,g="http://weibo.com",h=FM&&FM.getURL&&FM.getURL().href||window.location.href;h=encodeURIComponent(h);var i={},j=function(b){var c="popularizeLayer_"+a.getUniqueKey(),i=decodeURIComponent(d.src)+"&mid="+d.mid+"&rnd="+a.getUniqueKey()+"&ru="+g+"&failRu="+h,j=a.builder('<iframe id="'+c+'" name="'+c+'" node-type="frame" width="'+d.width+'" height="'+d.height+'" allowtransparency="true" scrolling="no" frameborder="0" ></iframe>');e.setTitle(d.title);e.setContent(j.box);e.show().setMiddle();var k=a.E(c);setTimeout(function(){k.setAttribute("_src",i);f=a.lib.connect.iframe(k);f.on("setHeight",function(a,b,c,d){var f=c;if(!!f){f=(f|0)+"px";b.style.height!=f&&(b.style.height=f);e.setMiddle();d("callback")}})},200);k.attachEvent?k.attachEvent("onload",function(){k.height=d.height;e.setMiddle()}):k.onload=function(){k.height=d.height;e.setMiddle()}},k=function(){e=a.ui.dialog(d)},l=function(){f&&f.destroy&&f.destroy();e&&e.destroy&&e.destroy()};k();i.show=j;i.destroy=l;i.dialog=e;return i}});
STK.register("pl.base.source.widgetsource.publish",function(a){function d(b){var g=function(b){var g=b.data||{},h=b.el,i={title:g.title?decodeURIComponent(g.title):c("#L{åäº«}"),content:g.content?decodeURIComponent(g.content):"",extraUrl:g.extraUrl?decodeURIComponent(g.extraUrl):"",pid:g.pid,extraSend:g};if(d){try{d&&d.destroy&&d.destroy()}catch(j){}d=null}var k={};for(var l in g)l!="module"&&l!="title"&&l!="content"&&l!="spr"&&(k[l]=g[l]);e.getTrans("getpublish",{onSuccess:function(b){i.html=b.data.html;d=a.lib.publisher.publisherDialog(i);a.custEvent.add(d,"publishShare",function(){var b=a.sizzle('[node-type="shareCount"]',h)[0];if(b){var d=a.trim(b.innerHTML).match(/^.*\((\d+)\)$/);d=d?parseInt(d[1]):0;b.innerHTML=c("#L{åäº«}")+"&nbsp;&nbsp;("+ ++d+")"}});f(h,"widgetPublish",d)},onError:function(b){a.lib.dialog.ioError(b.code,b)},onFail:function(){}}).request(k)};b&&b.add("widget_publish","click",g);var h=FM.getURL().query||"";if(a.queryToJson(h).withpublisher==1){var i=a.sizzle(['[action-type="widget_publish"].W_btn_a','[action-type="widget_publish"].W_btn_b','[action-type="widget_publish"].W_btn_c','[action-type="widget_publish"].W_btn_d'].join(","),a.E("plc_frame"));i[0]&&i[0].click()}var j={};j.publish=function(a){g(a);return d};j.destroy=function(){b&&b.remove("widget_publish","click",g);d&&d.destroy()};return j}var b=window.$CONFIG||{},c=a.lib.kit.extra.language,d,e=a.conf.trans.publisher,f=a.namespace().data;d.init=function(b){if(d){try{d&&d.destroy&&d.destroy()}catch(c){}d=null}return d=a.lib.publisher.publisherDialog(b)};return d});
STK.register("lib.feed.plugins.feedOnTop",function(a){function g(a,b){window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack(a,b)}var b=a.lib.kit.extra.language,c=a.core.util.templet,d=a.conf.trans.feed.feed,e=!1,f={TIPCONFIRM:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="javascript:void(0)"><span class="btn_30px W_f14" suda-data="key=tblog_fstt&value=chick_top_yes" >#L{ç¡®å®}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b" href="javascript:void(0)"><span class="btn_30px W_f14">#L{åæ¶}</span></a></p></div></td></tr></tbody></table>'),TIPCONFIRMTRY:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="javascript:void(0)"><span class="btn_30px W_f14" suda-data="key=tblog_fstt&value=chick_top_yes">#L{è¯ç¨}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b" href="javascript:void(0)"><span class="btn_30px W_f14">#L{åæ¶}</span></a></p></div></td></tr></tbody></table>'),INVALIDTOP:b("#L{ç¡®è®¤è¦åæ¶è¿æ¡å¾®åç½®é¡¶åï¼}"),EXPIRED:b('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td><div class="content layer_mini_info layer_mini_center">#{CONTENT}<p class="btn"><a node-type="ok" action-type="ok" class="W_btn_a" href="http://vip.weibo.com/paycenter?from=zdsygq" target="_blank"><span class="btn_30px W_f14"><em class=W_icon icon_member"></em>#L{å¼éä¼å}</span></a><a node-type="cancel" action-type="cancel" class="W_btn_b"><span class="btn_30px W_f14">#L{ç¥éäº}</span></a></p></div></td></tr></tbody></table>')};return function(c,h){if(!c)throw"feedOnTop : need object of the baseFeedList Class";var i=c.utils,j={},k=c.getNode(),l=c.getDEvent(),m={},n,o,p=function(){if($CONFIG.bigpipe=="true"){var b=FM.getURL(),c=a.queryToJson(b.query);c.pids=h.plNode.id;FM.iLoad(b.path+"?"+a.jsonToQuery(c))}else setTimeout(function(){window.location.reload()},200)},q={init:function(){q.bind()},bind:function(){l.add("fl_setToTop","click",q.requestSetTop);l.add("fl_invalidTop","click",q.requestInvalidTop)},hideAllTip:function(){if(o){o.destroy();o=null}},removeFeed:function(b,c){var d=i.getFeedNode(b,k);a.setStyle(d,"height",d.offsetHeight);a.setStyle(d,"overflow","hidden");var e=a.tween(d,{end:function(){d.innerHTML="";a.core.dom.removeNode(d);c&&c();e.destroy();e=d=undefined}}).play({height:0})},requestSetTop:function(c){var f=a.core.dom.dir.parent(c.el,{expr:"[action-type=feed_list_item]"})[0];f=f.getAttribute("mid");if(!e){e=!0;q.hideAllTip();m={mid:i.getMid(c.el,k),el:c.el};var j;h.isWeiboDetail?j=a.core.dom.neighbor(c.el).parent('[node-type="feed_list"]').child('[action-type="fl_menu"]').finish():j=a.core.dom.neighbor(c.el).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();j.getAttribute("action-type")!="fl_menu"&&(j=c.el);d.request("memberTopFeed",{onComplete:function(d){e=!1;if(d.code=="100094")o=a.ui.tipConfirm(d.msg,{}).ok(function(){q.setTop(f)}).cancel(function(){o.destroy();o=null}).beside(j||c.el);else if(d.code=="100092")o=a.ui.tipConfirm(d.msg).ok(function(){q.setTop(f)}).cancel(function(){o.destroy();o=null}).beside(j||c.el);else if(d.code=="100095")a.ui.tipConfirm(d.msg).ok(b("#L{å¼éä¼å}"),function(){location.href="http://vip.weibo.com/paycenter?from=zdsygq"}).beside(j||c.el);else if(d.code=="100096")a.ui.tipConfirm(d.msg).ok(b("#L{ç«å³è´­ä¹°}"),function(){location.href="http://pay.vip.weibo.com/vip/pay?uid="+$CONFIG.uid+"&productid=weibo_top&usetimes=1&from=profile&client=pc&return_url="+location.href}).beside(j||c.el);else if(d.code=="100093"){var g=a.ui.confirm([b("#L{ç½®é¡¶åè½ä¸ºå¾®åä¼åä¸å±ç¹æ }"),b("#L{ä½ å·²ç»è¯ç¨è¿æ­¤åè½äºï¼å¼éå¾®åä¼ååå³å¯ä½¿ç¨}")],{okText:b('<i class="W_icon icon_member"></i> #L{å¼éä¼å}'),cancelText:b("#L{ç¥éäº}"),OK:function(){window.open("http://vip.weibo.com/paycenter?from=zdsygq")}});g.getDomList().OK.className="W_btn_v"}else a.lib.dialog.ioError(d.code,d)}},{opttype:1,mid:m.mid});g("tblog_fstt","chick_top");return i.preventDefault(c.evt)}},setTop:function(e){q.hideAllTip();a.custEvent.fire(c,"clearTips");d.request("memberTopFeed",{onSuccess:function(c){if(a.trim(c.msg)=="")p();else if(c.data.verified==!1){var d=function(){setTimeout(function(){var c={data:{title:encodeURIComponent(b("#L{å°ä½ çç½®é¡¶å¾®åæ¨èç»ç²ä¸ä»¬å§O(â©_â©)O}")),content:encodeURIComponent(b("#L{æååä½¿ç¨äºå¾®åä¼åç¹æï¼å°ä¸æ¡ç²¾å½©çå¾®åç½®é¡¶æ¾ç¤ºå¯ï¼å¿«æ¥æçä¸ªäººä¸»é¡µç§ç§å§ï¼}")+"http://weibo.com/u/"+$CONFIG.uid),pid:"a1d3feabjw1eaqax0634kj20c80bcwfi"}};n=a.pl.base.source.widgetsource.publish().publish(c)},10);g("tblog_fstt","top_suc_share")},f=a.ui.confirm(b("#L{ç½®é¡¶æåãæ¨å¹¿å°é¦é¡µè®©æ´å¤ç²ä¸çè§ï¼}"),{icon:"succB",cancelText:b("#L{åæ¶}"),okText:b("#L{æ¨å¹¿}"),OK:function(){setTimeout(function(){var b=a.lib.dialog.popularizeLayer({mid:e,src:"http://promote.vip.weibo.com/promote?from=zhiding_promote"});a.custEvent.add(b.dialog,"hide",function(){setTimeout(function(){if($CONFIG.bigpipe=="true"){var b=FM.getURL(),c=a.queryToJson(b.query);c.pids=h.plNode.id;FM.iLoad(b.path+"?"+a.jsonToQuery(c))}else setTimeout(function(){window.location.reload()},200)},200)});b.show()},10);g("tblog_fstt","top_suc_pop")}});$CONFIG.bigpipe=="true"&&p()}else p()},onFail:function(b){a.lib.dialog.ioError(b.code,b)},onError:function(c){c.code=="100095"?a.ui.confirm(c.msg,{icon:"warnB"}).ok(b("#L{å¼éä¼å}"),function(){location.href="http://vip.weibo.com/paycenter?from=zdsygq"}):c.code=="100096"?a.ui.confirm(c.msg,{icon:"warnB"}).ok(b("#L{ç«å³è´­ä¹°}"),function(){location.href="http://pay.vip.weibo.com/vip/pay?uid="+$CONFIG.uid+"&productid=weibo_top&usetimes=1&from=profile&client=pc&return_url="+location.href}):a.lib.dialog.ioError(c.code,c)}},{opttype:2,mid:m.mid});$CONFIG.bigpipe=="true"&&p()},requestInvalidTop:function(b){q.hideAllTip();m={mid:i.getMid(b.el,k),el:b.el};var c=a.core.dom.neighbor(b.el).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish();c.getAttribute("action-type")!="fl_menu"&&(c=b.el);o=a.ui.tipConfirm(f.INVALIDTOP).ok(q.invalidTop).cancel(function(){o=null}).beside(c||b.el);return i.preventDefault(b.evt)},invalidTop:function(){a.custEvent.fire(c,"clearTips");d.request("memberTopFeed",{onSuccess:function(a){p()},onFail:function(){},onError:function(b){a.lib.dialog.ioError(b.code,b)}},{opttype:3,mid:m.mid})},destroy:function(){o&&o.destroy&&o.destroy();m=j=q=l=null}};q.init();j.destroy=q.destroy;return j}});
STK.register("conf.trans.feed.tag",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("feedTagList",{url:"/aj/mblog/tag/mytaglist",method:"post"});c("feedTagListHtml",{url:"/p/aj/v6/mblog/taglist",method:"get"});c("feedTagUpdate",{url:"/aj/v6/mblog/tag/updatetags",method:"post"});c("feedTagDel",{url:"/aj/mblog/tag/destroy",method:"post"});c("feedTagEdit",{url:"/aj/mblog/tag/update",method:"post"});return b});
STK.register("lib.feed.plugins.tag.addTag",function(a){var b=a.lib.kit.extra.language,c=b('<#et temp data><div node-type="tagOuter" class="layer_favor_addtags"><div class="form_table_s">\t<dl class="f_normal clearfix">\t\t<dt  class="f_tit" node-type="tagListTitle" style="">#L{æçæ ç­¾}ï¼</dt>\t\t<dd class="f_con"><div node-type="tagList" class="tags" style="display:none"></div><div node-type="pageList"></div></dd>\t</dl><div class="W_tips tips_warn clearfix"><p class="icon"><span class="W_icon icon_warnS"></span></p><p class="txt" node-type="tag_tip">#L{æå¤5ä¸ªæ ç­¾ï¼ç¨ç©ºæ ¼åé}</p><p class="txt" style="display:none;" node-type="tagsInputTip">#L{æ¯ä¸ªæ ç­¾ä»é14ä¸ªå­ç¬¦}</p><p class="close"></p></div><dl class="f_normal clearfix">\t\t<dt class="f_tit">#L{æ·»å æ ç­¾}ï¼</dt>       <dd class="f_con"><div class="input_outer W_input_focus"><input type="text" class="W_input" node-type="tagsInput" value="${data.lastTags}"/></div></dd>\t</dl></div><div class="W_layer_btn S_bg1"><a node-type="tagSave" href="javascript:;" class="W_btn_a btn_34px">#L{ç¡®å®}</a><a action-type="cancel" node-type="cancel" href="javascript:;" class="W_btn_b btn_34px">#L{åæ¶}</a></div></div></#et>'),d=b("#L{æ¯ä¸ªæ ç­¾ä»é14ä¸ªå­ç¬¦}"),e=b("#L{æå¤5ä¸ªæ ç­¾ï¼ç¨ç©ºæ ¼åé}"),f=b("#L{å½åå¾®åå·²æ·»æ»¡5ä¸ªæ ç­¾}"),g="W_btn_tag_cur",h=0,i,j=function(b,c,d){if(b)return c(b);var e=function(a){if(++h==3){h=0;c()}else j(b,c,a)};a.conf.trans.feed.tag.request("feedTagList",{onSuccess:function(a){h=0;c(a.data)},onFail:e,onError:e},d)};return function(h){var k={},l=1;i=a.parseParam({title:"",tipType:"",flag:"add",mid:"",lastTags:"",myTags:""},h);if(!i.mid)a.log("common.dialog.addTag: opts.mid is not defined!");else{var m=function(b){i=a.parseParam({title:"",tipType:"",flag:"add",mid:"",lastTags:"",myTags:""},b);/^(success|error)$/.test(i.tipType)?i.tipType=i.tipType=="success"?"succS":"errorS":i.tipType="succS";o.setTitle(i.title)},n=function(a){a=parseInt(a,10);var b=[];if(a>1){b.push('<div class="W_pages">');for(var c=1;c<=a;c++)b.push('<a class="'+(l==c?"page S_txt1 S_bg1":"page S_txt1")+'" href="javascript:void(0);" action-type="page" action-data="page='+c+'">'+c+"</a>");b.push("</div>")}return b.join("")};a.custEvent.define(k,["success","error","hide"]);var o=a.ui.dialog();o.setTitle(i.title);a.custEvent.add(o,"hide",function(){a.custEvent.fire(k,"hide")});/^(success|error)$/.test(i.tipType)?i.tipType=i.tipType=="success"?"succS":"errorS":i.tipType="succS";var p=a.builder(a.core.util.easyTemplate(c,{tipType:i.tipType,tipInfo:i.tipInfo,lastTags:i.lastTags}).toString()).list,q=p.tagOuter[0],r=p.tagsInputTip[0],s=p.tagsInput[0],t=p.tagListTitle[0],u=p.tagList[0],v=p.pageList[0],w=p.tagSave[0],x=p.tag_tip[0],y=function(b){var c=a.trim(b).split(/ +/);c=a.core.arr.clear(c);var d=b.charAt(b.length-1)==" ";c=a.unique(c);var e={isEndEmpty:d,value:c.join(" ")+(d?" ":"")};return e},z=function(){var b=y(s.value),c=b.value;if(c.length>0){r.style.display="none";x.style.display=""}else{r.style.display="";x.style.display="none"}var h=a.sizzle(">span",u);if(c==d)for(var i=0;i<h.length;i++){h[i]&&a.removeClassName(h[i],g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg2_br");x.innerHTML=e}else{var k=a.trim(c).split(/ +/);k=k.slice(0,5);var l=k.length;for(var i=0;i<k.length;i++){k[i]||l--;k[i]=a.leftB(k[i],14)}k=" "+(s.value=k.join(" ")+(b.isEndEmpty?" ":""))+" ";if(l>=5)for(var i=0;i<h.length;i++){a.addClassName(h[i],g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg1_br");x.innerHTML=f}else for(var i=0;i<h.length;i++){var m=h[i],n=m.getAttribute("action-data").replace(/^tagName=/,"");if((new RegExp(" "+n+" ")).test(k)){a.addClassName(m,g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg1_br")}else{a.removeClassName(m,g);var j=a.sizzle("em",h[i]);j[0]&&(j[0].className="S_bg2_br");x.innerHTML=e}}}};s.value=i.lastTags?i.lastTags:d;var A=a.lib.kit.dom.smartInput(s,{notice:d,needLazyInput:!0,noticeClass:"W_input_default"});A.on("focus",function(){window.setTimeout(function(){if(s.value==""){r.style.display="";x.style.display="none"}},0)});A.on("blur",function(){setTimeout(function(){z&&z()},0)});a.custEvent.add(A,"lazyInput",z);var B=a.delegatedEvent(q);B.add("tagItem","click",function(b){if(!a.hasClassName(b.el,g)){var c=b.data,e=s.value;s.value==d&&(e="");s.value=e+" "+c.tagName;z()}});B.add("cancel","click",function(){o.hide()});B.add("page","click",function(a){l=parseInt(a.data.page,10);j(i.myTags,function(a){var b=a.tags,c=a.total_num,d=[];if(b){var e=b.split(/\ +/);for(var f=0;f<e.length;f++)d.push('<span class="W_btn_b W_btn_tag" action-type="tagItem" action-data="tagName='+e[f]+'"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="S_txt1">'+e[f]+"</a></span>");var g=Math.ceil(parseInt(c,10)/50);if(f>0){t.style.display="";u.style.display=""}else{t.style.display="none";u.style.display="none"}d=d.join("");u.innerHTML=d;v.innerHTML=n(g);s.focus();z();o&&o.setMiddle()}},a.data)});var C=function(c,e){var f=s.value;s.value==d&&(f="");if(f!=""&&/[^a-zA-Z0-9\u4e00-\u9fa5\s\u3000\-_]+/.test(f))a.ui.alert(b('#L{å¾®åæ ç­¾ä»æ¯æä¸­è±æãæ°å­ã"_"æåå·}'));else{var g=function(){o.hide();a.conf.trans.feed.tag.request("feedTagUpdate",{onSuccess:function(b){a.conf.channel.feed.fire("feedTagUpdate",{res:i.lastTags,now:b.data.tags,mid:c.mid});a.conf.channel.feed.fire("feedTagMoreUpdate",{res:i.lastTags,now:b.data.tags,mid:c.mid});a.custEvent.fire(k,"success",b);o.hide()},onFail:function(b){a.custEvent.fire(k,"error",b);a.lib.dialog.ioError(b.code,b);o.hide()},onError:function(b){a.custEvent.fire(k,"error",b);a.lib.dialog.ioError(b.code,b);o.hide()}},a.lib.kit.extra.getDiss({mid:c.mid,tags:f,from:"page",script_url:FM.getURL().path}))};g()}},D=function(a){var b,c;s.value=s.value.replace(/(.+)\s\1$/g,"$1 ");if(i.flag=="add"&&s.value==d){if(i.lastTags){b={mid:i.mid,tags:""};C(b,a)}o.hide()}else{var e=s.value==d?"":s.value;if(e==i.lastTags){o.hide();return}b={mid:i.mid,tags:e};C(b,a)}};a.hotKey.add(s,"enter",D);a.addEvent(w,"click",D);k.show=function(a){m(a);l=1;j(a.myTags,function(a){var b=a.tags,c=a.total_num,d=[];if(b){var e=b.split(/\ +/);for(var f=0;f<e.length;f++)d.push('<span class="W_btn_b W_btn_tag" action-type="tagItem" action-data="tagName='+e[f]+'"><span class="W_arrow_bor W_arrow_bor_l"><i class="S_line3"></i><em class="S_bg2_br"></em></span><a href="javascript:void(0);" class="S_txt1">'+e[f]+"</a></span>");var g=Math.ceil(parseInt(c,10)/50);if(f>0){t.style.display="";u.style.display=""}else{t.style.display="none";u.style.display="none"}d=d.join("");u.innerHTML=d;v.innerHTML=n(g);s.focus();z()}o.setMiddle()},{page:1});s.value=a.lastTags?a.lastTags:d;o.setContent(q);o.show();o.setMiddle()};k.hide=function(){o.hide()};k.destroy=function(){a.hotKey.remove(s,"enter",D);a.removeEvent(w,"click",D);a.custEvent.undefine(k);B.destroy();A.destroy();i=p=q=r=s=w=z=null};return k}}});
STK.register("lib.feed.plugins.tag.showAddTag",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e={},f,g,h,i,j,k=function(b,c){if(!f){c.mid=b;f=a.lib.feed.plugins.tag.addTag(c);a.custEvent.add(f,"success",function(b,c){if(!g)a.log("addtag : there is not 'div[node-type=\"feed_list_tagList\"]' in the feed_item ");else{var d=c.data.tags;if(typeof d!="undefined"){if(d==""){j&&a.setStyle(j,"display","");g&&a.setStyle(g,"display","none")}else{j&&a.setStyle(j,"display","none");g&&a.setStyle(g,"display","")}h&&h.setAttribute("_tagList",d);i&&i.setAttribute("_tagList",d)}g.innerHTML=c.data.html}});a.custEvent.add(f,"hide",function(b,c){var d=c.data.tags,e=g;d==""&&(e=j);a.core.util.browser.IE6&&document.body.focus();(function(a){setTimeout(function(){a&&a.style.display!="none"&&a.focus();h=null;j=null;g=null},200)})(e)})}f.show(c)},l=function(c,e,f,l){var m=e,n=d.getFeedNode(f);g=a.sizzle('div[node-type="feed_list_tagList"]',n)[0];h=a.sizzle('[node-type="feed_list_addTag"]',n)[0];j=a.sizzle('[node-type="feed_list_addtagDiv"]',n)[0];i=a.sizzle('[node-type="feed_list_editTag"]',n)[0];var o={};o.lastTags=m;m?o.title=b("#L{ç¼è¾æ ç­¾}"):o.title=b("#L{æ·»å æ ç­¾}");var p=a.sizzle('[node-type="feed_list_content"]',n)[0];if(!p){a.log("addtag : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return d.preventDefault()}var q=a.sizzle(">em",p)[0],r=a.sizzle('dt[node-type="feed_list_forwardContent"]',n)[0];for(var s in l)o[s]=l[s];k(c,o)},m=function(){l(c.mid,c.taglist,c.el,c.data)};e.destroy=function(){if(f){a.custEvent.remove(f);f.destroy();f=null}j=g=null};m();return e}});
STK.register("lib.feed.plugins.tag.init",function(a){return function(b,c){var d=b.utils;if(!b)a.log("forward : need object of the baseFeedList Class");else{var e={},f;b.getDEvent().add("fl_addTag","click",function(b){f=a.lib.feed.plugins.tag.showAddTag({mid:d.getMid(b.el),taglist:b.el.getAttribute("_taglist"),el:b.el,data:b.data},d);return d.preventDefault()});e.showAddtag=a.lib.feed.plugins.tag.showAddTag;e.destroy=function(){f&&f.destroy&&f.destroy()};return e}}});
STK.register("conf.trans.group",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("add",{url:"/aj/f/group/add",method:"post"});c("modify",{url:"/aj/relation/rename",method:"post"});c("del",{url:"/aj/relation/delete",method:"post"});c("info",{url:"/aj/f/group/getgroupinfo",method:"get"});c("set",{url:"/aj3/attention/aj_group_update_v4.php",method:"post"});c("batchSet",{url:"/aj3/attention/aj_group_batchupdate_v4.php",method:"post"});c("list",{url:"/aj/f/group/list",method:"get"});c("order",{url:"/aj/f/group/order",method:"post"});c("listbygroup",{url:"/aj/f/attchoose",method:"post"});c("infolist",{url:"/aj/f/attfilterlist",method:"get"});c("orientGroup",{url:"/aj/v6/f/group/groupmembers",method:"get"});c("recommendfollow",{url:"/aj3/recommend/aj_addrecommend.php",method:"post"});c("groupupdate",{url:"/aj/relation/groupupdate",method:"post"});c("unInterest",{url:"/aj/f/group/notinterest",method:"post"});c("editdesc",{url:"/aj/f/group/editdesc",method:"post"});c("update",{url:"/aj/f/group/update",method:"post"});c("followgroup",{url:"/aj/f/group/followgroup",method:"post"});c("getGroupDesc",{url:"/aj/f/group/getdesc",method:"get"});c("closebubble",{url:"/aj/bubble/closebubble",method:"get"});c("canadd",{url:"/p/aj/relation/getgroupnum",method:"post"});return b});
STK.register("conf.trans.follow",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("follow",{url:"/aj/f/followed",method:"post"});c("unFollow",{url:"/aj/f/unfollow",method:"post"});c("block",{url:"/aj/f/addblack",method:"post"});c("unBlock",{url:"/aj/f/delblack",method:"post"});c("removeFans",{url:"/aj/f/remove",method:"post"});c("follow_object",{url:"/p/aj/relation/follow",method:"post"});c("unFollow_object",{url:"/p/aj/relation/unfollow",method:"post"});c("unloginfollow",{url:"/p/aj/official/unloginfollow",method:"post"});c("proxy",{url:"/aj/proxy",method:"post"});return b});
STK.register("conf.channel.follow",function(a){var b=["changeStatus"];return a.lib.kit.extra.listener.define("conf.channel.follow",b)});
STK.register("lib.follow.utils.follow",function(a){var b=a.lib.kit.extra.merge,c=a.conf.channel.follow;return function(d){var e={};d=a.parseParam({trans:a.conf.trans.follow,transNameFollow:"follow",transNameUnfollow:"unFollow",transNameBlock:"block",transNameUnBlock:"unBlock",transNameRemoveFans:"removeFans",refer_sort:"",refer_flag:""},d);var f=a.lib.kit.extra.merge,g=a.lib.dialog.validateCode(),h=function(b,c){a.lib.dialog.ioError(b.code,b)},i=function(e,h){var j=b({uid:undefined,objectid:undefined,f:0,extra:"",refer_sort:d.refer_sort,refer_flag:d.refer_flag,location:window.$CONFIG&&$CONFIG.location||"",oid:window.$CONFIG&&$CONFIG.oid||"",wforce:1,nogroup:!1},h),k=e+(j.objectid?"_object":"");if(e==="follow"){j.api?k="proxy":j.unlogin&&(k="unloginfollow");var l=d.trans.getTrans(k,{onComplete:function(b,d){var j={onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,both:d.relation&&d.relation.follow_me==1})},onError:function(b,c){b.code==100050?a.ui.confirm(b.msg,{OK:function(){h.wforce=0;i(e,h)}}):a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d()},requestAjax:l,param:d,onRelease:function(){var a=h.onFailCb;typeof a=="function"&&a()}};g.validateIntercept(b,d,j)}});l.request(j)}else d.trans.request(k,{onSuccess:function(a,b){var d=f(h,a.data),g=h.onSuccessCb;typeof g=="function"&&g(d);c.fire("changeStatus",{uid:d.uid,objectid:d.objectid,action:e,fan:d.relation&&d.relation.follow_me==1})},onError:function(b,c){a.lib.dialog.ioError(b.code,b);var d=h.onFailCb;typeof d=="function"&&d()}},j)};e.follow=function(a){i(d.transNameFollow,a)};e.unFollow=function(a){i(d.transNameUnfollow,a)};e.block=function(a){i(d.transNameBlock,a)};e.unBlock=function(a){i(d.transNameUnBlock,a)};e.removeFans=function(a){i(d.transNameRemoveFans,a)};return e}});
STK.register("lib.group.orientGrpMem",function(a){var b=a.lib.kit.extra.language,c=a.lib.follow.utils.follow,d='<div class="W_layer" node-type="outer" style="display:none;position:absolute;z-index:10001"><div class="bg"><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="content" node-type="layoutContent"><div class="title" node-type="title"><span node-type="title_content"></span></div><a href="javascript:void(0);" class="W_layer_close" title="#L{å³é­}" node-type="close"></a><div node-type="inner" class="layer_group_person"></div></div></td></tr></table></div></div>';return function(e){var f=0,g=[],h=1,i,j,k,l,m,n,o,p=!1,q={},r=function(a){if(!j||!k)return!1;j.innerHTML="("+a+")";a==0?k.className="W_btn_a_disable":k.className="W_btn_a"},s=function(c){a.conf.trans.group.request("orientGroup",{onSuccess:function(c){var d=c.data.html;d&&m.setContent(d);u.initPars();if(p){o="#L{æ¥çåç»æå}ï¼("+c.data.num+"#L{äºº})";m.setTitle(b(o));a.custEvent.fire(q,"showDia",!0);p=!1}},onError:function(c){a.ui.alert(c.msg||b("#L{éè¯¯}"));a.custEvent.fire(q,"showDia",!1)}},c)},t={prev:function(b){a.preventDefault();h=h-1;i.page=b.data.page;s(i)},next:function(b){a.preventDefault();h=h+1;i.page=b.data.page;s(i)},tab:function(b){a.preventDefault();h=1;var c=b.data;i.page=c.page;i.g_type=c.g_type;s(i)},followBtnClick:function(b){a.preventDefault();if(f==0)return!1;var d={};if(g.length){d.uid=g.join(",");d.location="all";d.refer_sort="targeted-micro";d.refer_flag="all";d.onSuccessCb=function(){i.page=h;s(i)};c.follow(d)}},itemClick:function(b){var c=b.data.uid,d=a.core.arr.indexOf(c,g);if(d<0){g.push(c);r(++f);b.el.className="myfollow_list selected S_line2 SW_fun"}else{g.splice(d,1);r(--f);b.el.className="myfollow_list S_line2 SW_fun"}}},u={init:function(){m=a.ui.dialog(null,{template:b(d),haveMask:!1});q=m;u.bind()},bind:function(){a.custEvent.define(q,"showDia");l=a.core.evt.delegatedEvent(m.getBox());for(var b in t)l.add(b,"click",t[b])},newGroup:function(b){p=!0;h=1;i=a.parseParam({uid:"",gid:"",g_type:0,page:1},b);s(i)},initPars:function(){try{f=0;g=[];n=m.getDomList(!0);j=n.followNumNode;k=n.followBtn}catch(a){}},destroy:function(){l&&l.destroy();m.hide();m=null}};u.init();q.newGroup=u.newGroup;q.destroy=u.destroy;return q}});
STK.register("lib.feed.plugins.orientGrpMem",function(a){return function(b){if(!b)a.log("orientGrpMem : need object of the baseFeedList Class");else{var c=b.utils,d,e,f,g,h=!1,i=function(){var b=g.offsetHeight,e=c.getFeedNode(g),f=d.getBox(),h=a.position(e);h.l=h.l+e.offsetWidth/2-f.offsetWidth/2;h.t=h.t+b;d.setPosition(h)},j={feed_list_grpMember:function(b){f=c.getMid(b.el);g=b.el;if(e==f||h)return!1;if(!d){d=a.lib.group.orientGrpMem();d.setBeforeHideFn(function(){e=undefined;h=!1});a.custEvent.add(d,"showDia",function(a,b){if(f!=e&&b){d.show();i();e=f}h=!1})}h=!0;d.newGroup(b.data);return c.preventDefault(b.evt)}},k={init:function(){k.bind()},bind:function(){b.getDEvent().add("feed_list_grpMember","click",j.feed_list_grpMember)},destroy:function(){b.getDEvent().remove("feed_list_grpMember","click",j.feed_list_grpMember);d&&d.destroy&&d.destroy()}};k.init();var l={};l.destroy=k.destroy;return l}}});
STK.register("conf.channel.window",function(a){return a.lib.kit.extra.listener.define("conf.channel.window",["scroll"])});
STK.register("lib.feed.plugins.lazyload.lazyload",function(a){function f(){clearTimeout(c);c=setTimeout(e,100)}function e(){var b=a.core.util.scrollPos(),c=a.core.util.pageSize(),d={scrollLeft:b.left,scrollTop:b.top,winWidth:c.win.width,winHeight:c.win.height,pageWidth:c.page.width,pageHeight:c.page.height};a.conf.channel.window.fire("scroll",d)}function d(b,c,d,e){var f,g,h,i=b.length,j=new Date;if(b.length>0)for(var k=b.length-1;k>=0;k--){f=b[k];h=d.parent?f.parentNode:f;g=a.core.dom.position(h).t;if(g>e.top&&g<e.bottom){b.splice(k,1);c(f)}}}var b=!1,c;return function(c,e,g){if(b==!1){b=!0;a.addEvent(window,"scroll",f);a.addEvent(window,"resize",f);f()}var h=function(b){var f={type:"",threshold:600,parent:!1,over:!1};f=a.core.obj.parseParam(f,g);d(c,e,g,{top:f.over?0:b.scrollTop,bottom:parseInt(b.scrollTop+b.winHeight+f.threshold,10)})};a.conf.channel.window.register("scroll",h);var i={destroy:function(){a.conf.channel.window.remove("scroll",h)}};return i}});
STK.register("lib.feed.plugins.lazyload.init",function(a){return function(b,c){if(!b)a.log("lazyload : need object of the baseFeedList Class");else{var d={},e=b.getNode(),f,g=0,h=function(){f&&f.destroy();var c=a.sizzle('div[node-type="lazyload"]',e)[0];if(!!c){b.setBottomNode(c);f=a.lib.feed.plugins.lazyload.lazyload([c],function(){var c={pre_page:b.getCurrentPage(),page:b.getCurrentPage(),max_id:b.getLastFeedId(),end_id:b.getEndId(),pagebar:g,filtered_min_id:b.getLastFeedAttr("filtered_min_id")};b.showWait("lazyload");a.custEvent.fire(b,"request",["lazyload",a.parseParam(c)]);f.destroy();f=undefined},{threshold:a.winSize().height*1.5})}};b.regCustEvent("lazyload",function(){g=0;h()});a.custEvent.add(b,"updateFeed",function(a,b){if(b=="lazyload"){g++;h()}});h();d.destroy=function(){f&&f.destroy();a.custEvent.remove(b,"lazyload");d=b=e=f=undefined};return d}}});
STK.register("conf.trans.feed.translate",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("translate",{url:"/aj/mblog/translation",method:"get"});return b});
STK.register("lib.kit.extra.toFeedText",function(a){var b=function(a){return/^http\:\/\/(t\.cn|sinaurl\.cn)/.test(a)};return function(c){if(typeof c!="string")throw"[lib.kit.extra.toFeedText]:need string as first parameter";var d=a.core.str.parseHTML(c),e=[],f=!1;for(var g=0,h=d.length;g<h;g+=1)if(!d[g][2])f===!1&&e.push(d[g][0]);else if(d[g][2].toLowerCase()==="img"){var i=d[g][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/),j=d[g][3].match(/(?:brand_face\s*=\s*["|']?([^"|'|\s]+)["|']?)/);j?e.push(j[1]):i&&e.push(i[1])}else if(d[g][2].toLowerCase()==="a")if(d[g][1]==="/")f=!1;else{var k;if((k=d[g][3].match(/(?:ignore\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1])f=!0;else if((k=d[g][3].match(/(?:alt\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]){e.push(" "+k[1]+" ");f=!0}else if((k=d[g][3].match(/(?:href\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]&&b(k[1])){e.push(" "+k[1]+" ");f=!0}else if((k=d[g][3].match(/(?:shorthref\s*=\s*["|']?([^"|'|\s]+)["|']?)/))&&k[1]){e.push(" http://t.cn/"+k[1]+" ");f=!0}}return e.join("")}});
STK.register("conf.trans.forward",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("toMicroblog",{url:"/aj/v6/mblog/forward",method:"post",withDomain:!0});c("setDefault",{url:"/aj/mblog/repost/setdefault",method:"post"});c("simpleForwardLinks",{url:"/aj/v6/mblog/repost/unexpanded",method:"get"});c("detailForwardLinks",{url:"/aj/v6/mblog/repost/small",method:"get"});c("toMicrogroup",{url:"/aj/weiqun/forward",method:"post",withDomain:!0});c("microgroupList",{url:"/aj/weiqun/mylist",method:"get"});c("importMiyou",{url:"/aj/f/closefriendsrecom",method:"get"});c("toMiyouCircle",{url:"/aj/mblog/forwardmiyou",method:"post",withDomain:!0});c("toMiyouCirclev5",{url:"/aj/mblog/forwardmiyou",method:"post"});c("create",{url:"/aj/message/add",method:"post"});c("toPriv_delete",{url:"/aj/message/del",method:"post"});c("toPriv_getMsg",{url:"/aj/message/getmessagedetail",method:"get"});return b});
STK.register("lib.forward.source.API",function(a){var b={checkAtNum:function(a){var b=a.match(/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g),c=a.match(/\/\/@[a-zA-Z0-9\u4e00-\u9fa5_]{0,20}/g);b=b?b.length:0;c=c?c.length:0;return b-c},preventDefault:function(b){a.core.evt.preventDefault(b);return!1}};return b});
STK.register("lib.forward.plugin.report",function(a){return function(b){window.open("http://weibo.com/complaint/complaint.php?url="+a.lib.kit.extra.parseURL().url);a.core.evt.preventDefault(b.evt);return!1}});
STK.register("lib.forward.source.like",function(a){return function(b){var c=a.conf.trans.feed.attitude,d=!1,e,f={},g=[],h=a.delegatedEvent(b),i,j=!0,k,l=null,m,n,o=600,p=350,q='<div class="W_layer W_layer_pop" style="display:none;" node-type="outer"><div class="content"><div class="layer_emotion" node-type="inner"><ul class="emotion_list clearfix" node-type="faceList"></ul></div><div class="W_layer_arrow"><span node-type="arrow" class="W_arrow_bor W_arrow_bor_t" style="right:20px;"><i class="S_line3"></i><em class="S_bg2_br"></em></span></div></div></div>';e=a.lib.kit.dom.parseDOM(a.builder(q).list);document.body.appendChild(e.outer);m=a.delegatedEvent(e.outer);var r,s,t={go:function(b){s=b.el;r=a.sizzle('[node-type="forward_like_count"]',s)[0];r=r&&r.innerHTML||0;d=!0;if(a.core.dom.contains(b.el,b.evt.relatedTarget)||e&&e.outer.style.display!="none"&&b.data.mid==k&&b.data.object_id==l)v();else{t.stop(b,!0);n=setTimeout(function(){t.trans(b)},o)}},fill:function(b){if(!!j){j=!1;var d=a.core.json.merge(b.data,{location:$CONFIG.location}),f="miniadd";c.getTrans(f,{onSuccess:function(c){r=a.sizzle('[node-type="forward_like_count"]',s)[0];r=r&&r.innerHTML||0;var d=a.sizzle("em",b.el)[0],f=c.data.is_del?!0:!1,g="W_icon icon_praised_b"+(f?"":"c");f?r>0&&r--:r++;r=r<=0?"":r;b.el.innerHTML='<em class="'+g+'"></em><em node-type="forward_like_count">'+r+"</em>";if(!f&&c.data.html&&e){i&&(i.style.display="none");b.el.title=a.lib.kit.extra.language("#L{åæ¶èµ}");a.insertHTML(e.faceList,c.data.html,"afterbegin")}else{b.el.title=a.lib.kit.extra.language("#L{èµ}");a.removeNode(a.sizzle('[uid="'+$CONFIG.uid+'"]',e.faceList)[0]);i&&(i.style.display="");a.sizzle("[uid]",e.faceList).length<=0&&t.stop(b,!0)}var h=a.sizzle('[node-type="faceMore"]',e.faceList)[0];r>4?h&&h.style.display=="none"&&(h.style.display=""):h&&h.style.display!="none"&&(h.style.display="none");if(e.outer.style.display!="none"){var k=a.sizzle("[uid]",e.faceList);k=function(a){var b=[],c;while(c=a.shift())c.style.display!="none"&&b.push(c);return b}(k);var l=a.sizzle("[node-type=faceMore]",e.faceList)[0].style.display==="none"?0:1;e.outer.style.width=k.length*40+l*40+13+"px";a.ui.card(e.outer).showByTarget(b.el)}j=!0},onFail:function(b){a.lib.dialog.ioError(b.code,b);j=!0},onError:function(b){a.lib.dialog.ioError(b.code,b);j=!0}}).request(d)}},trans:function(b){e&&e.outer&&(e.outer.style.display="none");var d="minismall",f="faceList",g={mid:b.data.mid,location:$CONFIG.location};e&&(e.outer.show=!0);c.getTrans(d,{onSuccess:function(c){v();var d=c.data.total_number||c.data.like_counts||0;if(d!="0"){r=d;k=b.data.mid;l=b.data.object_id;var g=a.sizzle('[node-type="forward_like_count"]',b.el)[0];g&&(g.innerHTML=d?d:"");var h=a.lib.kit.dom.parseDOM(a.builder(c.data.html).list);e.faceList.innerHTML=h[f].innerHTML;var j=a.sizzle("[uid]",e.faceList),m=a.sizzle("[node-type=faceMore]",e.faceList)[0].style.display==="none"?0:1;a.sizzle('[uid="'+$CONFIG.uid+'"]',e.faceList)[0]||(i=j[3]);e.mid=b.data.mid;document.body.appendChild(e.outer);if(e&&e.outer.show===!0){document.body.appendChild(e.outer);e.outer.style.display="";e.outer.style.width=j.length*40+m*40+13+"px";a.ui.card(e.outer).showByTarget(b.el)}}},onFail:function(){},onError:function(){}}).request(g)},stop:function(a,b){d=!1;if(b)u();else{v();g.push(setTimeout(u,p))}},cancelLike:function(b){a.preventDefault();r--;a.removeNode(a.core.dom.neighbor(b.el).parent("li").getCurrent());var d=a.sizzle('[action-type="like_del"]',e.faceList);d[0]&&a.removeNode(a.core.dom.neighbor(d[0]).parent("li").getCurrent());s.title=a.lib.kit.extra.language("#L{èµ}");s.innerHTML='<em class="W_icon icon_praised_b"></em><em node-type="forward_like_count">'+r+"</em>";i&&(i.style.display="");a.sizzle("[uid]",e.faceList).length<=0&&(e.outer.style.display="none");var f="minidel";c.getTrans(f,{onSuccess:a.core.func.empty,onError:a.core.func.empty}).request(b.data)}},u=function(){clearTimeout(n);v();e&&(e.outer.style.display="none");e&&(e.outer.show=!1)},v=function(){while(g.length)clearTimeout(g.pop())},w=function(){h.add("forward_like","mouseover",t.go);h.add("forward_like","click",t.fill);h.add("forward_like","mouseout",t.stop);m.add("like_del","click",t.cancelLike)},x=function(){w();a.addEvent(e.outer,"mouseover",function(){v()});a.addEvent(e.outer,"mouseout",function(){t.stop()})};x();f.destroy=function(){h.destroy();m.destroy();a.removeEvent(e.outer,"mouseover");a.removeEvent(e.outer,"mouseout");a.removeNode(e.outer)};return f}});
STK.register("lib.forward.source.forwardLink",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.forward,d=a.lib.kit.dom.parseDOM,e=a.lib.kit.extra.actionData,f,g={on:b('#L{æ¶èµ·}<span class="W_arrow" title="#L{æ¶èµ·}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=2"><em>â</em></span>'),off:b('#L{å±å¼}<span class="W_arrow" title="#L{å±å¼}" href="javascript:;" onclick="return false;" action-type="show" action-data="id=1"><em>â</em></span>')},h;return function(b,i){h=b;var j=i.flNode,k=i.mid,l=i.data,m={},n,o,p,q=!1,r,s,t=a.parseParam({forward_link_status:"on",inDialog:!0,mid:""},l);if(typeof t.mid!="string"&&typeof t.mid!="number")throw new Error("forward.forwardLlink: need string (or number) as mid");var u=function(b){r=r||d(a.builder(f).list);if(!!r.forward_link_more){b.el.innerHTML=g[o];if(o=="on"){r.forward_link_more.style.display="";a.addClassName(b.el,"W_arrow_turn");e(b.el).set("id","2");r.check_more_link&&(r.check_more_link.style.display="")}else if(o=="off"){r.forward_link_more.style.display="none";a.removeClassName(b.el,"W_arrow_turn");e(b.el).set("id","1");r.check_more_link&&(r.check_more_link.style.display="none")}}},v=function(){q=!0;c.request("detailForwardLinks",{onSuccess:function(b,c){if(!b.data.num)a.removeNode(f.parentNode);else{o=o=="on"?"off":"on";f.innerHTML=b.data.html||"";a.custEvent.fire(h,"resetComment",[b]);a.custEvent.fire(h,"updateNum",[b.data]);w(f)}},onError:function(){f.innerHTML=""},onFail:function(){f.innerHTML=""}},{mid:k,d_expanded:p,expanded_status:q?o==="on"?1:2:""})},w=function(b){var c=a.sizzle("div.list_ul",b)[0];if(!!c){c.style.marginTop=-a.core.dom.getSize(c).height+"px";setTimeout(function(){c.style.webkitTransition="margin-top 0.4s";c.style.mozTransition="margin-top 0.4s";c.style.msTransition="margin-top 0.4s";c.style.transition="margin-top 0.4s";c.style.marginTop="0px"},0)}},x=function(b){var c=a.core.dom.dir.parent(b.el,{expr:'[node-type="forward_link_item"]'})[0],d=b.data,e,f,g,i;if(c){e=a.sizzle('[node-type="forward_again"]',c)[0];i=d.name;if(e){var j="//@"+i+": "+a.trim(e.innerHTML.replace(/[\r|\n|\t]/g,""));a.custEvent.fire(h,"forwardAgain",[d,j])}}},y=function(){f=a.C("div");f.className="list_box";s=a.delegatedEvent(f);j.innerHTML="";j.appendChild(f);s.add("show","click",function(a){o=a.data.id*1==1?"on":"off";switch(t.forward_link_status){case"off":v(a);break;case"on":default:u(a)}});s.add("forward_again","click",x);p=a.core.util.storage.get("forward_link_status");if(p=="null"||!p)p=t.forward_link_status;o=p;v()};a.custEvent.define(m,["switch"]);a.custEvent.add(m,"switch",function(a,b){if(b.node){var c=f.innerHTML;b.node.innerHTML="";b.node.appendChild(f);f.innerHTML=c}b.base&&(h=b.base)});m.destroy=function(){s.destroy();a.custEvent.undefine(m);a.removeNode(f);f=null};if(f&&t.forward_link_status==n){n=t.forward_link_status;j.innerHTML="";j.appendChild(f)}else y();return m}});
STK.register("lib.forward.source.toMicroblog",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.toFeedText,d=a.lib.kit.extra.textareaUtils,e=a.lib.kit.extra.shine,f=a.lib.kit.dom.parseDOM,g=null,h,i=a.lib.dialog.validateCode(),j=b('<#et userlist data><div node-type="toMicroblog_client"><#if (data.isDialog == true)><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div></#if><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{è½¬åå¾®å}#L{åå®¹}" node-type="textEl">${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{åå¸æå}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr"><div class="limits" style="position:relative;" layout-shell="true"><a action-data="rank=0" title="" class="S_txt1" href="javascript:void(0)" action-type="showPublishTo" node-type="showPublishTo" title=#L{å¬å¼-ä½ åè¡¨çå¾®åå¯ä»¥è¢«å¤§å®¶å¬å¼æ¥çå¦}><span class="W_autocut" node-type="publishTotext">#L{å¬å¼}</span> <i class="W_ficon ficon_arrow_down S_ficon" node-type="publish_to_arrow">c</i></a></div><a href="javascript:void(0)" node-type="submit" class="W_btn_a">#L{è½¬å}</a></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0)" title="#L{è¡¨æ}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a></span><ul class="ipt" node-type="cmtopts"><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="forward_comment_opt_forwardLi_Dialog${data.isDialog}" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_forwardLi_Dialog${data.isDialog}"><span>#L{åæ¶è¯è®ºç»} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label for="forward_comment_opt_originLi_Dialog${data.isDialog}" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_originLi_Dialog${data.isDialog}"><span><#if (data.forwardNick)> #L{åæ¶è¯è®ºç»åæä½è} <#else>#L{åæ¶è¯è®ºç»}</#if> ${data.originNick}</span></label></li></#if></ul></div></div></div></div><#if (data.isDialog == true)><div node-type="forward_link" class="repeat_list S_line1"></div></#if></div></div></#et>'),k={notice:"#L{è¯·è¾å¥è½¬åçç±}",defUpdate:"#L{è½¬åå¾®å}",netError:"#L{ç³»ç»ç¹å¿}",success:"#L{è½¬åæå}!",off:"#L{å³é­}",on:"#L{å¼å¯}"},l={limitNum:140,tipText:b(k.notice),count:"disable"},m=function(a,c){c=="normal"?a.innerHTML=b("#L{è½¬å}"):a.innerHTML=b('<i class="W_loading"></i>#L{è½¬åä¸­...}')};return function(n,o,p){if(n==null||o==null)throw new Error("[common.forward.toMicroblog]Required parameter client is missing");var q,r=p.data,s=56,t=!1,u=r.originNick?"@"+r.originNick:"",v=c(r.origin.replace(/<[^>]+>/gi,""));v=a.trim(v);r.content=v+"";if(a.bLength(a.core.str.decodeHTML(c(v+u)))>s){r.content=a.leftB(v,s-a.bLength(u))+"...";t=!0}else r.content=r.origin;u?u='<a class="S_txt1" href="/'+(r.domain||r.rootuid||r.uid)+'" target="_blank">'+u+"</a>:":u="";r.content=u+r.content;var w=r.reason||"",x=r.forwardNick?"//@"+r.forwardNick+":"+" ":"",y,z,A,B,C,D,E,F,G,H,I,J,K,L,M=!1,N=!1,O,P,Q=a.lib.forward.source.API,R,S,T={};T.client=n;T.opts=p.data||{};T.isInit=!1;A=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",pic_src:"",extra:"",dissDataFromFeed:{}},T.opts);a.custEvent.define(T,["forward","hide","center","count","updateNum","forwardAgain","resetComment"]);var U=function(){if(B)C==="error"&&a.lib.kit.extra.shine(z.textEl);else{var c=a.trim(y.API.getWords()||"");c===b(k.notice)&&(c="");B=!0;C="loading";z.submit.className="W_btn_a W_btn_a_disable";m(z.submit,"loading");var d={};d.pic_src=A.pic_src;d.appkey=A.appkey;d.mid=o;d.style_type=A.styleId;d.mark=A.mark;d.reason=c||b(k.defUpdate);d.location=$CONFIG.location;d.pdetail=$CONFIG.page_id;d.module=A.module;d.page_module_id=A.page_module_id;d.refer_sort=A.refer_sort;z.originInput&&z.originInput.checked&&(d.is_comment_base="1");if(z.forwardInput&&z.forwardInput.checked){d.is_comment="1";M=!0}!z.forwardInput&&d.is_comment_base=="1"&&(M=!0);R&&R.disable();if(R){var e=R.rank();d.rank=e.rank;d.rankid=e.rankid}d=a.lib.kit.extra.getDiss(d,z.submit);d=a.core.json.merge(d,A.dissDataFromFeed);if(r.postdata){var f=r.postdata.split(";");for(var h=0;f[h];h++){var i=f[h].split(",");i[0]&&i[0]&&(d[i[0]]=i[1])}}g=d;if(Q.checkAtNum(c)>5){a.ui.confirm(b("#L{åæ¡å¾®åéé¢@ å¤ªå¤çäººï¼å¯è½è¢«å¶å®ç¨æ·æè¯ãå¦ææè¯å¤ªå¤å¯è½ä¼è¢«ç³»ç»å°ç¦ãæ¯å¦ç»§ç»­è½¬åï¼}"),{OK:function(){D.request(d)},cancel:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal")}});return}A.extra&&(d.ref=A.extra);D.request(d)}},V=function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){y.API.blur();U()}},W=function(){var a=y.API.count(),b=l.limitNum-a,c=b>=0?!0:!1;if(c){B=!1;C="";c&&(z.num.innerHTML="<span>"+b+"</span>")}else{B=!0;C="error";z.num.innerHTML='<span class="S_error">'+b+"</span>"}},X=function(b,c){y.API.blur();z.success_tip.style.display="";var d=a.sizzle(".W_icon",z.success_tip)[0],e=a.sizzle(".txt",z.success_tip)[0];e.style.display="none";a.ui.effect(d,"flipInY","normal");setTimeout(function(){e.style.display="";a.ui.effect(e,"fadeInRight","normal")},50);y.API.reset();setTimeout(function(){B=!1;C="";g=null;z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");try{b.data.mid=c.mid;b.data.isComment=M;b.data.isToMiniBlog=!0;a.custEvent.fire(T,"forward",[b.data,c,p.inDialog]);a.conf.channel.feed.fire("forward",[b.data,c,p.inDialog])}catch(d){}a.custEvent.fire(T,"hide");M=!1;R&&R.reset();a.ui.effect(z.success_tip,"fadeOut","fast",function(){z&&z.success_tip&&(z.success_tip.style.display="none")})},1e3)},Y=function(c,d){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");c.msg=c.msg||b(k.netError);a.lib.dialog.ioError(c.code,c);M=!1;R&&R.enable()},Z=function(b,c){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");R&&R.enable();a.lib.dialog.ioError(b.code,b)},_=function(){H=a.builder(n);H=a.lib.kit.dom.parseDOM(H.list).toMicroblog_client;y=a.lib.editor.base(H,l);z=y.nodeList;y.API=y.editor.API;a.custEvent.define(y.editor,"close");S=a.lib.publisher.widget.face(y.editor);R=a.lib.publisher.source.publishTo({editorWrapEl:n,textEl:z.textEl,isforward:!0});a.addEvent(z.textEl,"focus",function(){O=setInterval(function(){try{W()}catch(a){}},200)});a.addEvent(z.textEl,"blur",function(){clearInterval(O)});y.API.insertText(x+a.trim(a.core.str.decodeHTML(c(w))));a.lib.kit.dom.autoHeightTextArea({textArea:z.textEl,maxHeight:145,inputListener:a.funcEmpty});if(L){q=a.lib.forward.source.like(H);h=a.lib.forward.source.forwardLink(T,{flNode:z.forward_link,mid:o,data:A})}},ba=function(){a.addEvent(z.submit,"click",U);a.lib.kit.extra.keySubmit.on(z.textEl,U);a.addEvent(z.smileyBtn,"click",S.show);if(L){K=a.delegatedEvent(H);K.add("origin_all","click",function(a){z.content.innerHTML='<span class="con S_txt2">'+u+r.origin+"</span>"});K.add("report","click",function(b){return a.lib.forward.plugin.report(b)});K.add("switch","click",function(c){var d={1:"on",2:"off"},e=d[c.data.id];setSwitchStatus(e);a.setStyle(c.el,"left",e=="on"?"23px":"0px");c.el.setAttribute("action-data",e=="on"?"id=2":"id=1");c.el.setAttribute("title",e=="on"?b(k.off):b(k.on))});K.add("show","click",function(a){J=a.data.id*1==1?"on":"off";getForwardInfo_more(a)});K.add("forward_again","click",bh)}},bb=function(b,g,h){w=h;y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);d.setCursor(z.textEl,0,0);e(z.textEl);A=a.parseParam(A,g);o=g.mid;r=$merge(r,g);g.forwardNick=g.name;g.originNick=g.rootname;z.cmtopts.innerHTML=a.core.util.easyTemplate(bg,g).toString();z=$merge(z,f(a.builder(z.cmtopts).list))},bc=function(a,b){if(z.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){z.cmtopts.style.display="none";z.cmtopts.innerHTML=""}else if(z.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){z.originLi.style.display="none";z.originLi.innerHTML=""}},bd=function(){a.custEvent.add(T,"forwardAgain",bb);a.custEvent.add(T,"resetComment",bc)},be=function(a,b){J=J=="on"?"off":"on"},bf=function(b){a.lib.dialog.ioError(b.code,b)},bg=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi"><input id="forward_comment_opt_forwardLi" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{åæ¶è¯è®ºç»} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi"><input id="forward_comment_opt_originLi" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.forwardNick)>#L{åæ¶è¯è®ºç»åæä½è} <#else>#L{åæ¶è¯è®ºç»} </#if>${data.originNick}</span></label></li></#if>'),bh=function(b){var d=a.core.dom.dir.parent(b.el,{expr:"dl"})[0],e=b.data,f,g,h,i;if(d){f=a.sizzle('em[node-type="forward_again"]',d)[0];i=e.name;if(f){w="//@"+i+": "+a.trim(f.innerHTML.replace(/[\r|\n|\t]/g,""));y.API.reset();y.API.insertText(a.trim(a.core.str.decodeHTML(c(w))),0);a.lib.kit.extra.textareaUtils.setCursor(z.textEl,0,0);a.lib.kit.extra.shine(z.textEl);A=a.parseParam(A,e);o=e.mid;e.forwardNick=e.name;e.originNick=e.rootname;r=a.lib.kit.extra.merge(r,b.data);z.cmtopts.innerHTML=a.core.util.easyTemplate(bg,e).toString();z=a.lib.kit.extra.merge(z,a.lib.kit.dom.parseDOM(a.builder(z.cmtopts).list))}}},bi=function(){D=a.conf.trans.forward.getTrans("toMicroblog",{onComplete:function(a,b){var c={onSuccess:X,onError:Y,requestAjax:D,param:g,onRelease:function(){B=!1;C="";z.submit.className="W_btn_a btn_noloading";m(z.submit,"normal");M=!1;R&&R.enable()}};i.validateIntercept(a,b,c)},onFail:Z,onTimeout:Y});E=function(b){a.conf.trans.forward.request("setDefault",{onSuccess:be,onError:bf,onFail:bf},b)}},bj=function(){},bk=function(){bi();_();ba();bj();bd()},bl=function(b){if(T.isInit==!1){p.data.isDialog=b;L=b;p.data.showArrow=t;a.addHTML(n,a.core.util.easyTemplate(j,p.data));y||bk();T.isInit=!0}else{H&&a.setStyle(H,"display","");h&&a.custEvent.fire(h,"switch",[{node:z.forward_link,base:T}])}setTimeout(function(){y.API.focus(0)},100)},bm=function(){a.lib.kit.extra.shine(y.nodeList.textEl)},bn=function(){y.API.blur();H!=null&&a.setStyle(H,"display","none")},bo=function(){a.removeEvent(z.submit,"click",U);a.lib.kit.extra.keySubmit.off(z.textEl,U);a.custEvent.undefine(T);K&&K.remove("origin_all","click");K&&K.remove("report","click");K&&K.remove("switch","click");K&&K.remove("retry","click");K&&K.remove("show","click");K.destroy();K=null;h&&h.destroy&&h.destroy();i&&i.destroy&&i.destroy();R&&R.destroy&&R.destroy();q&&q.destroy&&q.destroy();y.closeWidget();O&&clearInterval(O);y=null;z=null;D=null;H=null;for(var b in T)delete T[b];T=null};T.show=bl;T.hide=bn;T.shine=bm;T.destroy=bo;return T}});
STK.register("lib.forward.source.toFriends",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.lib.kit.extra.merge,h=a.lib.kit.extra.textareaUtils,i=a.conf.channel.feed,j=a.lib.kit.dom.parseDOM,k=a.conf.trans.forward,l=a.lib.forward.source.API,m=a.lib.kit.extra.report,n=a.lib.kit.extra.toFeedText,o=a.lib.kit.extra.getDiss,p=a.lib.dialog.ioError,q=a.lib.forward.source.forwardLink,r=null,s=a.lib.dialog.validateCode(),t=b('<#et userlist data><div node-type="toFriends_client"><div class="W_tips tips_warn clearfix"><p class="icon"><i class="W_icon icon_warnS"></i></p><p class="txt">å°å¾®åå®åè½¬åå°å¥½ååï¼åªæä½ çå¥½åå¯è§è¿æ¡å¾®åã</p></div><div class="WB_text S_bg1" node-type="content"><#if (data.showArrow == true)><a href="javascript:void(0);" action-type="origin_all" class="W_ficon ficon_arrow_down_lite S_ficon">g</a></#if><span class="con S_txt2">${data.content}</span></div><div class="WB_feed_repeat forward_rpt1"><div class="WB_repeat"><div class="WB_feed_publish clearfix"><div class="WB_publish"><div class="p_input p_textarea"><textarea class="W_input" name="" rows="" cols="" title="#L{è½¬åå¾®å}#L{åå®¹}" node-type="textEl">${data.reason}</textarea><span class="tips S_txt2" node-type="num"></span><div class="send_succpic" node-type="success_tip" style="display:none"><span class="W_icon icon_succB"></span><span class="txt">#L{åå¸æå}</span></div></div><div class="p_opt clearfix"><div class="btn W_fr"><a href="javascript:void(0)" node-type="submit" class="W_btn_a">è½¬å</a><!--<a href="" class="W_btn_a W_btn_a_disable"><i class="W_loading"></i>è½¬åä¸­</a>--></div><div class="opt clearfix" test=1 node-type="widget"><span class="ico"><a href="javascript:void(0)" title="#L{è¡¨æ}" node-type="smileyBtn"><i class="W_ficon ficon_face">o</i></a></span><ul class="ipt" node-type="cmtopts"><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label for="forward_comment_opt_forwardLi_f" class="W_label"><input node-type="forwardInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_forwardLi_f"><span>#L{åæ¶è¯è®ºç»} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label for="forward_comment_opt_originLi_f" class="W_label"><input node-type="originInput" name="" type="checkbox" value="" class="W_checkbox" id="forward_comment_opt_originLi_f"><span><#if (data.forwardNick)>#L{åæ¶è¯è®ºç»åæä½è} <#else>#L{åæ¶è¯è®ºç»} </#if>${data.originNick}</span></label></li></#if></ul></div></div></div></div><div node-type="forward_link" class="repeat_list S_line1"></div></div></div></div>'),u=b('<#et cmt data><#if (data.forwardNick)><li node-type="forwardLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_forwardLi_f"><input id="forward_comment_opt_forwardLi_f" type="checkbox" node-type="forwardInput" class="W_checkbox"  /><span>#L{åæ¶è¯è®ºç»} ${data.forwardNick}</span></label></li></#if><#if (data.originNick)><li node-type="originLi" class="W_autocut"><label class="W_label" for="forward_comment_opt_originLi_f"><input id="forward_comment_opt_originLi_f" type="checkbox" node-type="originInput" class="W_checkbox" /><span><#if (data.forwardNick)>#L{åæ¶è¯è®ºç»åæä½è} <#else>#L{åæ¶è¯è®ºç»} </#if>${data.originNick}</span></label></li></#if>'),v={notice:"#L{è¯·è¾å¥è½¬åçç±}",defUpdate:"#L{è½¬åå¾®å}",netError:"#L{ç³»ç»ç¹å¿}",success:"#L{è½¬åæå}!",off:"#L{å³é­}",on:"#L{å¼å¯}"};return function(o,w,x){(o==null||w==null)&&a.log("[common.forward.toMiyouCircle]Required parameter client is missing");var y=a.parseParam({limitNum:140,tipText:b(v.notice),count:"disable"},x||{}),z,A,B,C,D=!0,E,F=x.data,G=56,H=!1,I=F.originNick?"@"+F.originNick:"",J=n(F.origin.replace(/<[^>]+>/gi,""));F.content=a.trim(J)+"";if(a.bLength(a.core.str.decodeHTML(n(J+I)))>G){F.content=a.leftB(J,G-a.bLength(I))+"...";H=!0}else F.content=F.origin;I?I='<a class="S_func1" href="/'+(F.domain||F.rootuid||F.uid)+'" target="_blank">'+I+"</a>:":I="";F.content=I+F.content;var K=a.trim(F.reason.replace(/[\r|\n|\t]/g,""))||"",L=F.forwardNick?"//@"+F.forwardNick+":"+" ":"",M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,ba=!1,bb=!1,bc,bd,be=l,bf,bg={};bg.client=o;bg.opts=x.data||{};bg.isInit=!1;O=a.parseParam({appkey:"",styleId:"1",mark:"",module:"",page_module_id:"",refer_sort:"",forward_link_status:"on",dissDataFromFeed:{}},bg.opts);a.custEvent.define(bg,["forward","hide","center","count","forwardAgain","resetComment","updateNum"]);var bh={changeBtnText:function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{è½¬å}")}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{è½¬åä¸­...}')}},canForward:function(){if(!!M&&!!M.API){var a=M.API.count(),b=y.limitNum-a,c=b>=0?!0:!1;if(c){P=!1;Q="";c&&(N.num.innerHTML="<span>"+b+"</span>")}else{P=!0;Q="error";N.num.innerHTML='<span class="S_error">'+b+"</span>"}}}},bi={updateForward:function(c){if(P)Q==="error"&&f(N.textEl);else{var d=a.trim(M.API.getWords()||"");d===b(v.notice)&&(d="");P=!0;Q="loading";a.addClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"loading");var e={};e.appkey=O.appkey;e.mid=w;e.style_type=O.styleId;e.mark=O.mark;e.reason=d||b(v.defUpdate);N.originInput&&N.originInput.checked&&(e.is_comment_base="1");if(N.forwardInput&&N.forwardInput.checked){e.is_comment="1";ba=!0}e.rank=2;e.rankid="";e.group_source="group_all";e.module=O.module;e.page_module_id=O.page_module_id;e.refer_sort=O.refer_sort;e=a.core.json.merge(e,O.dissDataFromFeed);r=e;if(be.checkAtNum(d)>5){a.ui.confirm(b("#L{åæ¡å¾®åéé¢@ å¤ªå¤çäººï¼å¯è½è¢«å¶å®ç¨æ·æè¯ãå¦ææè¯å¤ªå¤å¯è½ä¼è¢«ç³»ç»å°ç¦ãæ¯å¦ç»§ç»­è½¬åï¼}"),{OK:function(){R.request(e)},cancel:function(){P=!1;Q="";a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal")}});return}R.request(e)}},putAside:function(){N.putAside.style.display="none";N.submit.innerHTML=b("#L{è½¬å}");N.submit.removeAttribute("suda-data")},ctrlUpdateForward:function(a){if((a.keyCode===13||a.keyCode===10)&&a.ctrlKey){M.API.blur();bi.updateForward()}}},bj=function(){X=a.core.util.storage.get("forward_link_status");if(X=="null"||!X)X=O.forward_link_status;Y=X},bk=function(b,c){M.API.blur();N.success_tip.style.display="";M.API.reset();setTimeout(function(){P=!1;Q="";r=null;a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal");try{b.data.mid=c.mid;b.data.isComment=ba;b.data.isToMiniBlog=!0;a.custEvent.fire(bg,"forward",[b.data,c,x.inDialog]);i.fire("forward",[b.data,c,x.inDialog])}catch(d){}a.custEvent.fire(bg,"hide");bi.putAside();ba=!1},500)},bl=function(a,c){P=!1;Q="";bh.changeBtnText(N.submit,"normal");a.msg=a.msg||b(v.netError);p(a.code,a);ba=!1},bm=function(b,c){P=!1;Q="";a.removeClassName(N.submit,"W_btn_a_disable");bh.changeBtnText(N.submit,"normal");p(b.code,b)},bn=function(b,c,d){K=d;M.API.reset();M.API.insertText(a.trim(a.core.str.decodeHTML(n(K))),0);h.setCursor(N.textEl,0,0);f(N.textEl);O=a.parseParam(O,c);w=c.mid;F=g(F,c);c.forwardNick=c.name;c.originNick=c.rootname;N.cmtopts.innerHTML=a.core.util.easyTemplate(u,c).toString();N=g(N,j(a.builder(N.cmtopts).list))},bo=function(a,b){if(N.cmtopts&&b.data.permission&&b.data.permission.allowComment==0){N.cmtopts.style.display="none";N.cmtopts.innerHTML=""}else if(N.originLi&&b.data.permission&&b.data.permission.allowRootComment==0){N.originLi.style.display="none";N.originLi.innerHTML=""}},bp=function(){a.custEvent.add(bg,"forwardAgain",bn);a.custEvent.add(bg,"resetComment",bo)},bq=function(){R=k.getTrans(x.isWeiboDetail?"toMiyouCirclev5":"toMiyouCircle",{onComplete:function(a,b){var c={onSuccess:bk,onError:bl,requestAjax:R,param:r,onRelease:function(){P=!1;Q="";bh.changeBtnText(N.submit,"normal");ba=!1}};s.validateIntercept(a,b,c)},onFail:bm,onTimeout:bl},F)},br=function(){W=a.builder(o);W=j(W.list).toFriends_client;M=c(W,y);M.API=M.editor.API;a.custEvent.define(M.editor,"close");C=d(M.editor);N=M.nodeList;a.addEvent(N.textEl,"focus",function(){bc=setInterval(function(){bh.canForward()},200)});a.addEvent(N.textEl,"blur",function(){clearInterval(bc)});M.API.insertText(L+a.core.str.decodeHTML(n(K)));e({textArea:N.textEl,maxHeight:145,inputListener:a.funcEmpty});if(_){z=a.lib.forward.source.like(W);A=q(bg,{flNode:N.forward_link,mid:w,data:O})}},bs=function(){a.addEvent(N.submit,"click",bi.updateForward);a.addEvent(N.putAside,"click",bi.putAside);a.lib.kit.extra.keySubmit.on(N.textEl,bi.updateForward);a.addEvent(N.smileyBtn,"click",C.show);if(_){Z=a.delegatedEvent(W);Z.add("origin_all","click",function(b){N.content.innerHTML='<span class="con S_txt2">'+I+a.trim(F.origin)+"</span>"});Z.add("report","click",function(a){return m(a)})}},bt=function(){bj();bp();bq();br();bs()},bu=function(b){if(bg.isInit==!1){x.data.isDialog=b;_=b;x.data.showArrow=H;a.addHTML(o,a.core.util.easyTemplate(t,x.data));M||bt();bg.isInit=!0}else{W&&a.setStyle(W,"display","");a.custEvent.fire(A,"switch",[{node:N.forward_link,base:bg}])}M.API.focus(0)},bv=function(){a.lib.extra.shine(M.nodeList.textEl)},bw=function(){M.API.blur();W!=null&&a.setStyle(W,"display","none")},bx=function(){a.removeEvent(N.submit,"click",bi.updateForward);a.removeEvent(N.putAside,"click",bi.putAside);a.lib.kit.extra.keySubmit.off(N.textEl,bi.updateForward);a.custEvent.undefine(bg);Z&&Z.remove("origin_all","click");Z&&Z.remove("report","click");Z&&Z.remove("switch","click");Z&&Z.remove("retry","click");Z&&Z.remove("show","click");Z=null;A&&A.destroy&&A.destroy();s&&s.destroy&&s.destroy();z&&z.destroy&&z.destroy();M.closeWidget();bc&&clearInterval(bc);M=null;N=null;R=null;W=null;for(var b in bg)delete bg[b];bg=null};bg.show=bu;bg.hide=bw;bg.shine=bv;bg.destroy=bx;return bg}});
STK.register("conf.trans.global",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("language",{url:"/aj/user/lang",method:"post"});c("followList",{url:"/aj/mblog/attention"});c("topicList",{url:"/aj/mblog/topic"});c("myFollowList",{url:"/aj/relation/attention"});c("closetipsbar",{url:"/aj/tipsbar/closetipsbar",method:"post"});c("weiqunnew",{url:"/ajm/weiqun?action=aj_remindunread"});c("quiet_suggest",{url:"/aj/f/lenovo?ct=10&_wv=5",method:"get"});c("like_object",{url:"/p/aj/like/update",method:"post",withDomain:!0});c("like_weibo",{url:"/p/aj/like/set",method:"post",withDomain:!0});c("take",{url:"/p/aj/general/button",method:"get"});c("pageTabDelete",{url:"/p/aj/tab/delete",method:"post",withDomain:!0});c("getenvelope",{url:"/p/aj/proxy",method:"get"});c("rss",{url:"/p/aj/proxy",method:"get"});return b});
STK.register("conf.channel.flashUpload",function(a){var b=["uploading","uploaded","uploadfail","nofile","complete","deleteFile"];return a.lib.kit.extra.listener.define("conf.channel.flashUpload",b)});
STK.register("lib.message.upload.start",function(a){var b=a.lib.kit.extra.language,c=b('<#et userlist data><div class="img_mod W_fl" fid=${data.fid}><div class="mod_top S_bg1"><p class="prompt S_txt2" node-type="imgLoading_${data.fid}"><i class="W_loading"></i></p><img style="display:none;" width="92" height="92" node-type="imgUrl_${data.fid}" src="${data.url}" alt="${data.fileName}" class="send_img"></div><div class="mod_btm clearfix"><span class="W_autocut S_txt2 W_fl">${data.fileName}</span><a href="javascript:void(0);" class="W_fr" node-type="deleteImg_${data.fid}" action-type="cancelImg" action-data="fid=${data.fid}">#L{å é¤}</a></div></div>'),d=b('<#et userlist data><div class="files clearfix" fid=${data.fid}><div class="private_file_mod W_fl W_autocut"><span class="mes_acc_icon ${data.fileTypeClass}" node-type="fileType_${data.fid}"></span><span class="W_autocut name S_txt2" node-type="fileName_${data.fid}">${data.fileName} </span> </div><div class="state_mod W_fr"><i class="W_loading" node-type="uploading_icon_${data.fid}"></i><span class="state S_txt1" node-type="uploading_${data.fid}">#L{æ­£å¨ä¸ä¼ }</span><a href="javascript:void(0);" class="W_ficon ficon_close S_ficon" node-type="deleteFile_${data.fid}" action-type="cancelFile" action-data="fid=${data.fid}">X</a></div></div></#et>'),e=a.core.util.easyTemplate,f={img:8,file:38};return function(b){var g={};if(!b.target)return g;var h=a.E(b.target),i,j,k=b.fileName,l=b.fileName.toString().replace(/.*\.(\S{1,8})$/,"$1"),m=h.getAttribute("fileType");if(m=="img"){h.parentNode.style.display="";i=c}else{h.style.display="";i=d}j="acc_icon_"+l;f[m]&&a.core.str.bLength(k)>=f[m]&&(k=a.core.str.leftB(k,f[m]-3)+"...");var n=e(i,{fid:b.fid,fileName:k,fileTypeClass:j}).toString();a.insertHTML(h,n,"beforeend");a.conf.channel.flashUpload.fire("uploading",{fid:b.fid,fileName:b.fileName});return g}});
STK.register("lib.message.upload.complete",function(a){var b=a.lib.kit.extra.language,c=a.lib.kit.extra.actionData,d={1e3:"K",1e6:"M",1e9:"G"};return function(b,d){var e={};if(!b.target)return e;var f,g=a.E(b.target),h=a.lib.kit.dom.parseDOM(a.builder(g).list),i=b.fid,j=b.data.vfid,k=b.data.tovfid,l=b.fileSize,m=b.fileName,n=b.data.thumbnail_120+"&source=209678993",o=b.data.thumbnail_180+"&source=209678993",p=function(){if(l<1024)return l+" B";if(l<1048576)return parseInt(l/102.4)/10+" K";if(l<1073741824)return parseInt(l/104857.6)/10+" M"}();if(g.getAttribute("fileType")=="file"){f=g;a.removeNode(h["uploading_"+i]);a.removeNode(h["uploading_icon_"+i]);h["fileName_"+i].innerHTML=m+" ("+p+")";c(h["deleteFile_"+i]).set("fileSize",l);h["deleteFile_"+i].setAttribute("action-type","deleteFile")}else{f=g.parentNode;a.removeNode(h["imgLoading_"+i]);h["imgUrl_"+i].style.display="";h["imgUrl_"+i].setAttribute("src",n);h["imgUrl_"+i].setAttribute("action-type","imgEnlarge");h["imgUrl_"+i].setAttribute("action-data","s="+n+"&l="+o+"&size=120");c(h["deleteImg_"+i]).set("fileSize",l);h["deleteImg_"+i].setAttribute("action-type","deleteImg")}f.setAttribute("fids",(f.getAttribute("fids")||"")+","+i);f.setAttribute("tovfids",(f.getAttribute("tovfids")||"")+","+k);f.setAttribute("vfids",(f.getAttribute("vfids")||"")+","+j);a.conf.channel.flashUpload.fire("uploaded",b);return e}});
STK.register("lib.message.upload.init",function(a){return function(){}});
STK.register("lib.message.upload.error",function(a){var b=a.lib.kit.extra.language,c=b('<p class="prompt S_txt2">#L{å¾çä¸ä¼ å¤±è´¥}</p>'),d=b("#L{ä¸ä¼ å¤±è´¥}");return function(e,f){if(e.code&&e.code==-1)return a.ui.alert(b("#L{æä»¶ä¸ºç©ºæèæ ¼å¼éè¯¯ï¼è¯·éæ©æ­£ç¡®çæä»¶ä¸ä¼ ã}"));if(e.code&&e.code==-3)return a.ui.alert(b("#L{ä½ æ·»å çæä»¶ä¸ªæ°å·²ç»è¾¾å°5ä¸ªäºï¼ä¸å¯ä»¥åæ·»å äºå¦ã}"));var g={};if(!e.target)return g;var h,i=a.E(e.target),j=a.lib.kit.dom.parseDOM(a.builder(i).list),k=e.fid,l=e.fileName,m=e.data.thumbnail_120+"&source=209678993",n=e.data.thumbnail_180+"&source=209678993";if(i.getAttribute("fileType")=="file"){h=i;a.removeNode(j["uploading_"+k]);j["fileName_"+k].innerHTML=l+" ("+d+")";j["deleteFile_"+k].setAttribute("action-type","deleteFile")}else{h=i.parentNode;j["imgUrl_"+k].parentNode.innerHTML=c;j["deleteImg_"+k].setAttribute("action-type","deleteImg")}h.setAttribute("fids",(i.getAttribute("fids")||"")+","+k);a.conf.channel.flashUpload.fire("uploadfail",e);return g}});
STK.register("lib.kit.extra.runFlashMethod",function(a){return function(a,b,c){var d,e,f,g=function(){if(a[b]){e=!0;clearTimeout(d);try{a.TotalFrames()}catch(h){a.TotalFrames}c()}else f=setTimeout(g,100)};g();d=setTimeout(function(){e||clearTimeout(f)},1e4);return{destroy:function(){clearTimeout(d);clearTimeout(f)}}}});
STK.register("lib.message.upload.loadSwf",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e={},f,g=!1,h=a.C("span"),i,j,d=a.parseParam({fileListNode:null,fn_start:"STK.namespace.v6page.lib.message.upload.start",fn_init:"STK.namespace.v6page.lib.message.upload.init",fn_complete:"STK.namespace.v6page.lib.message.upload.complete",fn_error:"STK.namespace.v6page.lib.message.upload.error",uid:$CONFIG.uid,source:"209678993",uploadAPI:"http://upload.api.weibo.com/2/mss/upload.json",flashURL:"http://service.weibo.com/staticjs/tools/upload.swf",fileType:"file",maxFileSize:50,maxFileCount:5,flash_width:25,flash_height:20,areaInfo:"0-20|10-22",flashID:"uploadflash_id_"+a.getUniqueKey(),multiSelect:0,deleteConfirm:null,flashCssText:"",pasteEl:null},d||{});if(!d.fileListNode)throw new Error("message.upload.loadSwf:ç¼ºå°fileListNodeä½ä¸ºæä»¶å®¹å¨ï¼");if(d.fileType=="img"){i=a.C("div");i.className="imgs clearfix";d.fileListNode.appendChild(i)}else i=d.fileListNode;var k=50,l=1,m={},n={},o=function(c,e){var f=window.$CONFIG&&window.$CONFIG.version||(new Date).getTime(),g={swfid:d.flashID,maxSumSize:d.maxFileSize,maxFileSize:d.maxFileSize,maxFileNum:d.maxFileCount,multiSelect:0,uploadAPI:encodeURIComponent(d.uploadAPI+"?source=209678993&tuid="+$CONFIG.uid),initFun:d.fn_init,sucFun:d.fn_complete,errFun:d.fn_error,beginFun:d.fn_start,areaInfo:d.areaInfo,fExt:d.fileType=="img"?"*.jpg;*.gif;*.jpeg;*.png":"*",fExtDec:d.fileType=="img"?b("#L{éæ©å¾ç}"):b("#L{éæ©æä»¶}")},h=a.core.util.swf.create(c,d.flashURL,{width:d.flash_width,height:d.flash_height,paras:{menu:"false",scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"",wmode:"transparent"},flashvars:g});return h},p=function(a){m[a.fid]={fileName:a.fileName,fileSize:a.fileSize}},q=function(b){n[b.fid]={fileName:b.fileName,fileSize:b.fileSize,vfid:b.data.vfid,tovfid:b.data.tovfid};a.custEvent.fire(e,"uploaded",[b.fid,n[b.fid]])},r=function(a,b){},s=function(b){var c=b.clipboardData,d,e,f;if(c){d=c.items;if(!d)return;f=d[0];e=c.types||[];for(var g=0;g<e.length;g++)if(e[g]==="Files"){f=d[g];break}if(f&&f.kind==="file"&&f.type.match(/^image\//i)){var h=f.getAsFile(),i=new FileReader;i.onload=function(b){a.lib.kit.extra.runFlashMethod(j,"screenCapture",function(){j.screenCapture(b.target.result.split(",")[1])})};i.readAsDataURL(h)}}},t=function(){var a=d.fileListNode.getAttribute("fids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},u=function(){var a=d.fileListNode.getAttribute("vfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},v=function(){var a=d.fileListNode.getAttribute("tovfids");a=(a||"").replace(/^\,/,"");return a&&a.split(",")||[]},w=function(){for(var a in m)if(!n[a])return!1;return!0},x=function(){a.lib.kit.extra.installFlash()},y=function(b){var c=a.sizzle('[fid="'+b+'"]',i)[0],f=n[b]||{},g=f.fileSize,h=f.vfid,k=f.tovfid;if(!c||!g)return a.log("æ¾ä¸å°è¦å é¤çæä»¶ï¼");a.removeNode(c);var l=a.sizzle("[fid]",i);l.length||(d.fileListNode.style.display="none");z("fids",b);h&&z("vfids",h);k&&z("tovfids",k);a.lib.kit.extra.runFlashMethod(j,"removeFileBySize",function(){j.removeFileBySize(g)});a.custEvent.fire(e,"deleted",[b,n[b]]);delete m[b];delete n[b]},z=function(a,b){var c=d.fileListNode.getAttribute(a),e=c.replace(","+b,"");d.fileListNode.setAttribute(a,e)},A=function(){try{j.resetUploadedFileNum(0);j.resetUploadedFileSize(0)}catch(a){}d.fileListNode.style.display="none";i.innerHTML="";d.fileListNode.setAttribute("fids","");d.fileListNode.setAttribute("vfids","");d.fileListNode.setAttribute("tovfids","");m={};n={}},B=function(b){var c=b.data.fid,e=a.sizzle('[fid="'+c+'"]',i)[0],f=(n[c]||{}).fileSize;a.removeNode(e);var g=a.sizzle("[fid]",i);g.length||(d.fileListNode.style.display="none");delete m[c]},C=function(c){var e=c.data;typeof d.deleteConfirm!="function"?a.ui.confirm(b("#L{ç¡®å®è¦å é¤è¯¥"+(d.fileType=="img"?"å¾ç":"éä»¶")+"ï¼}"),{OK:function(){y(e.fid)}}):d.deleteConfirm(e,c)},D=function(b){a.lib.kit.extra.runFlashMethod(j,"resetUploadAPI",function(){j.resetUploadAPI(b)})},E=function(){c.style.position="relative";h.style.cssText=d.flashCssText||"display:inline-block;position:absolute;left:0px;top:-2px;z-index:9999";c.appendChild(h);d.fileListNode.className="sendbox_"+(d.fileType=="img"?"img":"file")+" S_line2"},F=function(){f=a.delegatedEvent(d.fileListNode);f.add(d.fileType=="img"?"deleteImg":"deleteFile","click",C);f.add(d.fileType=="img"?"cancelImg":"cancelFile","click",B);a.custEvent.define(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.register("uploading",p);a.conf.channel.flashUpload.register("uploaded",q);a.conf.channel.flashUpload.register("uploading",r);d.fileType=="img"&&d.pasteEl&&d.pasteEl.addEventListener&&d.pasteEl.addEventListener("paste",s)},G=function(){f.destroy();a.custEvent.undefine(e,["deleteConfirm","uploading","uploaded","deleted"]);a.conf.channel.flashUpload.remove("uploading",p);a.conf.channel.flashUpload.remove("uploaded",q);a.removeNode(h)};e.resetUploadAPI=D;e.deleteFile=y;e.checkUploadComplete=w;e.getFids=t;e.getVfids=u;e.getTovfids=v;e.deleteAllFiles=A;e.destroy=G;E();F();if(a.lib.kit.extra.getFlashVersion()>=10){j=o(h);e.flashNode=j;if(i){i.setAttribute("id",d.flashID);i.setAttribute("fileType",d.fileType);i.setAttribute("swfid",j.getAttribute("id"))}}else a.addEvent(c,"click",x);return e}});
STK.register("lib.message.upload.mergeFileCount",function(a){return function(b,c){var d={};if(!b)return d;var e=c||{},f={},g=parseInt(e.count)||5,h=0,i=function(c,d,e){if(!f[d]&&!!e){h++;f[d]=e;a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}},j=function(c,d,e){if(!!f[d]&&!!e){h--;delete f[d];a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetUploadedFileNum",function(){b.flashNode.resetUploadedFileNum(h)})})}};a.foreach(b,function(b,c){b.flashNode&&a.lib.kit.extra.runFlashMethod(b.flashNode,"resetFileNum",function(){b.flashNode.resetFileNum(g)});a.custEvent.add(b,"uploaded",i);a.custEvent.add(b,"deleted",j)})}});
STK.register("lib.message.upload.getFlash",function(a){return function(b){return a.sizzle('[flashobj="'+b+'"]')[0]}});
STK.register("lib.forward.source.toMessage",function(a){var b=a.lib.kit.extra.language,c=a.lib.editor.base,d=a.lib.publisher.widget.face,e=a.lib.kit.dom.autoHeightTextArea,f=a.lib.kit.extra.shine,g=a.ui.tip,h=a.lib.kit.extra.getDiss,i=a.conf.channel.feed,j=a.lib.forward.source.API,k=a.conf.trans.forward,l=a.lib.kit.dom.smartInput,m=a.lib.dialog.validateCode,n=a.lib.message.upload.loadSwf,o=a.lib.message.upload.getFlash,p=a.lib.dialog.ioError,q=a.lib.kit.dom.parseDOM,r,s,t,u={limitNum:1e4,count:"disable"},v=b('<#et userlist data><div node-type="toMessage_client"><div class="WB_feed_repeat forward_rpt2" ><div class="WB_repeat"><!--è¯è®º-åè¡¨--><div class="WB_feed_publish clearfix"><div class="WB_face W_fl">æ¶ä¿¡äººï¼</div><div class="WB_publish"><div class="p_input"><textarea class="W_input" node-type="msgTo"></textarea></div></div></div><!--è¯è®º-åè¡¨--><div class="WB_feed_publish clearfix"><div class="WB_face W_fl">å   å®¹ï¼</div><div class="WB_publish"><div class="sendbox_mod sendbox_mod_down sendbox_mod_focus" node-type="uploadTd"><div class="sendbox_area S_bg2"><textarea node-type="textEl" name="" cols="" rows="" class="W_input W_f14" style="">#L{ç»ä½ æ¨èä¸æ¡å¾®å}&#13;<#if (data.url)>${data.url}</#if></textarea></div><!-- ç§ä¿¡æ¨¡å --><div node-type="uploadList" class="sendbox_annex S_bg2 S_line3"><div class="sendbox_file S_line2" node-type="uploadFile" style="display:none;"></div><!-- ç§ä¿¡æ¨¡å --><!-- å¾çæ¨¡å --><div class="sendbox_img S_line2" style="display:none;" node-type="uploadImg"></div></div><!-- å¾çæ¨¡å --><div class="sendbox_bar clearfix"><div class="sendbox_menu W_fl" node-type="widget"><a href="javascript:void(0);" class="icon_send" node-type="smileyBtn"> <em class="W_ficon ficon_face">o</em></a><a href="javascript:void(0);" class="icon_send" node-type="picBtn"> <em class="W_ficon ficon_image">p</em></a><a href="javascript:void(0);" class="icon_send" node-type="attachBtn"><em class="W_ficon ficon_file">x</em></a></div><div class="sendbox_btn W_fr"><span class="prompt S_txt1" node-type="num" style="display:none;"> è¿å¯ä»¥è¾å¥ <em>10000</em> å­ </span><a href="javascript:void(0);" node-type="submit" class="W_btn_a">åé</a></div></div></div></div><!-- åééä»¶åå¾ç --> </div><!--/è¯è®º-åè¡¨--><#if (data.isDialog == true)></div></div></#if></div></#et>'),w={notice:"#L{è¯·è¾å¥è½¬åçç±}",nameNotice:"#L{è¯·è¾å¥æ¶ä¿¡äººæµç§°}",defUpdate:"#L{è½¬åå¾®å}",netError:"#L{ç³»ç»ç¹å¿}",success:"#L{è½¬åæå}!",retry:'#L{è¯»åå¤±è´¥ï¼è¯·}<a href="#" onclick="return false;" action-type="retry" value="retry">#L{éè¯}</a>',off:"#L{å³é­}",on:"#L{å¼å¯}"},x=function(c,d){if(d=="normal"){a.removeClassName(c,"W_btn_a_disable");c.innerHTML=b("#L{è½¬å}")}else{a.addClassName(c,"W_btn_a_disable");c.innerHTML=b('<i class="W_loading"></i>#L{è½¬åä¸­...}')}};return function(h,i,o){function U(){a.removeEvent(y.msgTo,"focus",U);sugg=$suggest({textNode:y.msgTo,callback:function(a){}});sugg.show()}var r=m();if(h==null||i==null)throw new Error("[lib.invoke.forward.publisher.toPrivateMsg]Required parameter client is missing");var t,y,z,A,B,C,D,E,F,G,H=j,I,J,K={};K.client=h;K.opts=o||{};K.isInit=!1;var L,M;a.custEvent.define(K,["forward","hide","center","updateNum"]);var N=function(){if(s){A=!1;B="";s=null;x(y.submit,"normal")}},O=function(){var c=t.API.getExtra();if(A)B==="error"&&f(y.textEl);else{var d=a.trim(t.API.getWords()||"");d===b(w.notice)&&(d="");var e=a.trim(y.msgTo.value);e===b(w.nameNotice)&&(e="");if(d===""){f(y.textEl);return}if(e===""){f(y.msgTo);return}A=!0;B="loading";x(y.submit,"loading");var g={};g.text=d||b(w.defUpdate);var h=L.getTovfids().concat(M.getTovfids());if(h.length!=0){g.fids=h.join(",");g.tovfids=h.join(",")}g.appkey=K.opts.data.appkey;g.id=i;g.screen_name=e;s=g;s.module=K.opts.data.module;s.page_module_id=K.opts.data.page_module_id;s.refer_sort=K.opts.data.refer_sort;V()}},P=function(b){if((b.keyCode===13||b.keyCode===10)&&b.ctrlKey){t.API.blur();a.core.evt.fireEvent(y.submit,"click")}},Q=function(){if(!!t&&!!t.API){var a=t.API.count(),c=u.limitNum-a,d=c>=0?!0:!1;if(d){A=!1;B="";if(d){y.num.innerHTML=b("#L{è¿å¯ä»¥è¾å¥}<span>"+c+"</span> #L{å­}");y.num.style.display="none"}}else{A=!0;B="error";y.num.innerHTML=b('#L{å·²ç»è¶è¿}<span class="S_error">'+Math.abs(c)+"</span> #L{å­}");y.num.style.display=""}}},R=function(c,d){t.API.blur();s=null;A=!1;B="";x(y.submit,"normal");try{c.data.mid=d.mid;c.data.toPrivateMsg=!0;a.custEvent.fire(K,"forward",[c.data,d,o.inDialog])}catch(e){}a.custEvent.fire(K,"hide");g("lite",{msg:b(w.success),type:"succ",timer:"500"});t.API.reset();G.reset()},S=function(a,b){A=!1;s=null;B="";x(y.submit,"normal");p(a.code,a)},T=function(a,b){A=!1;B="";s=null;x(y.submit,"normal");p(a.code,a)},V=function(b){if(!L.checkUploadComplete()||!M.checkUploadComplete())setTimeout(function(){V(b)},100);else{s=a.lib.kit.extra.getDiss(s,y.submit);C.request(s)}},W=function(b,c){a.ui.confirm("ç¡®è®¤å é¤ï¼",{OK:function(){L.deleteFile(c.fid,c.fileSize)}})},X=function(b,c){a.ui.confirm("ç¡®è®¤å é¤ï¼",{OK:function(){M.deleteFile(c.fid,c.fileSize)}})},Y=function(){var b;D=a.builder(h);b=q(D.list);D=b.toMessage_client;t=c(D,u);t.API=t.editor.API;a.custEvent.define(t.editor,"close");J=d(t.editor);y=t.nodeList;L=n(b.picBtn,{fileType:"img",fileListNode:b.uploadImg,pasteEl:y.textEl});M=n(b.attachBtn,{fileType:"file",fileListNode:b.uploadFile});a.lib.message.upload.mergeFileCount([L,M]);a.addEvent(y.textEl,"focus",function(){Q();a.addClassName(y.uploadTd,"sendbox_mod_focus");F=setInterval(function(){Q()},200)});a.addEvent(y.textEl,"blur",function(){a.removeClassName(y.uploadTd,"sendbox_mod_focus");clearInterval(F)});e({textArea:y.textEl,maxHeight:145,inputListener:a.funcEmpty})},Z=function(){a.addEvent(y.submit,"click",O);a.lib.kit.extra.keySubmit.on(y.textEl,O);a.addEvent(y.smileyBtn,"click",J.show)},_=function(){},ba=function(){C=k.getTrans("create",{onComplete:function(a,b){var c={onSuccess:R,onError:S,requestAjax:C,param:b,onRelease:function(){A=!1;s=null;B="";x(y.submit,"normal")}};r.validateIntercept(a,b,c)},onFail:T})},bb=function(){ba();Y();Z();_();I=l(y.msgTo,{notice:b(w.nameNotice)});I.restart();a.ui.suggest(y.msgTo).on("suggest",function(b,c,d){a.conf.trans.global.request("followList",{onSuccess:function(b){var c=[];a.foreach(b.data,function(a){var b=a.remark?"("+a.remark+")":"";c.push([a.screen_name+b,a.screen_name])});d(c)}},{q:c})})},bc=function(c){if(K.isInit==!1){E=c;o.data.msgTo=b(w.nameNotice);o.data.isDialog=c;o.data.origin=a.trim(o.data.origin);a.addHTML(h,a.core.util.easyTemplate(v,o.data));t||bb();K.isInit=!0}else D&&a.setStyle(D,"display","");t.API.focus(0)},bd=function(){t.API.blur();D!=null&&a.setStyle(D,"display","none")},be=function(){a.removeEvent(y.submit,"click",O);a.lib.kit.extra.keySubmit.off(y.textEl,O);a.custEvent.undefine(K);sugg&&sugg.destroy();t.closeWidget();s=null;F&&clearInterval(F);r&&r.destroy&&r.destroy();t=null;y=null;C=null;D=null;for(var b in K)delete K[b];L&&L.destroy&&L.destroy();M&&M.destroy&&M.destroy();K=null};K.show=bc;K.hide=bd;K.destroy=be;return K}});
STK.register("lib.forward.source.publisher",function(a){var b=a.lib.kit.extra.language,c=a.lib.forward.source,d=b('<#et userlist data><div class="froward_wrap"><div node-type="forward_tab" class="WB_minitab clearfix"><span class="txt">#L{è½¬åå°}ï¼</span><ul class="minitb_ul S_line1 S_bg1 clearfix"><#list data.tab as list><li <#if (list.id==data.type)> class="minitb_item current S_line1" <#else> class="minitb_item S_line1" </#if>><a href="javascript:void(0);" action-type="tab_item" action-data="id=${list.id}"<#if (list.id==data.type)> class="minitb_lk S_txt1 S_bg2"<#else> class="minitb_lk S_txt1"</#if><#if (list.suda)> suda-data="key=tblog_tran_miyou&value=miyou_group_click"</#if>node-type="tab_item_bg">${list.name}<#if (list.id==3)><i title="#L{ä»æ¯ä½ çå¥½åå¦~}" class="W_icon icon_type_friends"></i></#if></a><span class="cur_block"></span></li></#list></ul></div><div node-type="forward_client"></div></div>'),e=[{id:1,name:b("#L{æçå¾®å}"),first_one:!0}];e.push({id:3,name:b("#L{å¥½åå}"),suda:!0});e.push({id:2,name:b("#L{ç§ä¿¡}"),last_one:!0});return function(f,g){if(f==null)throw new Error("[common.forward.publisher]Required parameter mid is missing");g=g||{type:1,styleId:"1"};var h={instances:{}},i=g.type,j,k,l,m,n,o,p=a.lib.kit.extra.toFeedText,q={1:c.toMicroblog,2:c.toMessage,3:c.toFriends},r={appkey:"",domInit:!1,forwardNick:"",originNick:"",origin:"",reason:"",url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",uid:"",rootuid:"",pid:"",domain:"",mark:"",page_module_id:"",module:"",refer_sort:"",pic_src:"",dissDataFromFeed:{}},s=function(){if(g.domInit==!1)var b=a.core.util.easyTemplate(d),c=b({type:i,tab:e,tab_count:e.length}).toString(),f=a.builder(c);var h=a.lib.kit.dom.parseDOM(f.list);j=h.forward_tab;k=h.forward_client;return f.box};a.custEvent.define(h,["hide","center","forward","updateNum"]);var t=function(a){if(f==null)throw new Error("[common.forward.publisher]Required parameter inner is missing");l=a;v();x(i,{data:g,client:k})},u=function(b){if(m){a.removeClassName(m.parentNode,"current");a.removeClassName(m,"S_bg2")}m=b.el;a.addClassName(m.parentNode,"current");a.addClassName(m,"S_bg2");i=b.data.id||i;x(i,{data:g,client:k})},v=function(){m=a.sizzle('a[node-type="tab_item_bg"]',l);m=m.length>0?m[0]:null;var b=a.sizzle('div[node-type="forward_tab"]',l);b=b.length>0?b[0]:null;if(b){n=a.delegatedEvent(b);n.add("tab_item","click",function(a){i!=a.data.id&&u(a)})}},w=function(b){var c=function(a,b){return a[b]},d=b.split("."),e=a,f,g=0;while(d[g]){f=d[g];e=c(e,f);g++}return e},x=function(c,d){o!=null&&o.hide();!!k.offsetHeight;c=c.toString();var e;if(h.instances[c]==null){var g={},i;for(var j in r)g[j]=d.data[j];g.type=c;i={client:k,data:g,inDialog:!0};if(i.data.allowForward==="0"){i.data.originNick="";i.data.origin=b("#L{æ­¤å¾®åå·²è¢«åä½èå é¤}")}i.data.reason=p(i.data.reason);e=q[c](k,f,i);h.instances[c]=e;a.custEvent.add(e,"hide",function(){a.custEvent.fire(h,"hide")});a.custEvent.add(e,"center",function(){a.custEvent.fire(h,"center")});a.custEvent.add(e,"updateNum",function(b,c){a.custEvent.fire(h,"updateNum",c)});a.custEvent.add(e,"forward",function(b,c){a.custEvent.fire(h,"forward",c)})}else e=h.instances[c];e.show(!0);o=e},y=function(){for(var b in h.instances){var c=h.instances[b];c&&c.destroy&&c.destroy();c=null}h.instances=null;a.custEvent.undefine(h);j=null;k=null;l=null;m=null;n&&n.remove("tab_item","click");n=null};h.getDom=s;h.init=t;h.destroy=y;return h}});
STK.register("lib.forward.source.init",function(a){var b={title:"#L{è½¬åå¾®å}",commentPerson:"#L{åæ¶è¯è®ºç»}",originPerson:"#L{åæ¶è¯è®ºç»åæä½è}",notice:"#L{è¯·è¾å¥è½¬åçç±}",defUpdate:"#L{è½¬åå¾®å}"},c=a.lib.kit.extra.language;return function(d,e){var f={},g={},h,i,j,k=function(){g.cevt=["forward","hide","show","updateNum"];g.callbackCevt=["forward","hide","updateNum"];a.custEvent.define(g,g.cevt)},l=function(){},m=function(){a.custEvent.add(g,"hide",function(){g.destroy()})},n=function(d,e){if(typeof d!="string"&&typeof d!="number")throw new Error("$.common.dialog.forward.show need string (or number) as weiboId");mid=d;e.pic&&(e.pid=e.pic);var k=a.parseParam({appkey:"",type:1,origin:"",reason:"",originNick:"",forwardNick:"",title:c(b.title),domInit:!1,url:null,styleId:"1",allowComment:"1",allowForward:"1",allowRootComment:"1",module:"",page_module_id:"",refer_sort:"",pid:"",domain:"",mark:"",pic_src:"",dissDataFromFeed:{}},e);i=a.ui.dialog();h=i.getDomList().inner;h.className="layer_forward";i.setTitle(k.title);i.show().setMiddle();j=new a.lib.forward.source.publisher(mid,k);h.appendChild(j.getDom());i.setBeforeHideFn(function(){});j.init(h);a.custEvent.add(j,"hide",function(){o()});a.custEvent.add(j,"updateNum",function(b,c){f.backnum=c.num;a.custEvent.fire(g,"updateNum",f)});a.custEvent.add(j,"center",function(){i.setMiddle()});a.custEvent.add(j,"forward",function(b,c){c=a.core.json.merge(c,f);c.cevtType=b.type;a.custEvent.fire(g,"forward",c)});a.custEvent.add(i,"hidden",function(){h.className="detail";j.destroy();i.clearBeforeHideFn();var b=arguments.callee;a.custEvent.remove(i,"hidden",b);i.clearContent();a.custEvent.fire(g,"hide",f)});i.setMiddle();var l=i._.node;l.style.top=parseInt(l.style.top)-80+"px";a.custEvent.fire(g,"show",{box:i});g.publisher=j},o=function(){i&&i.hide&&i.hide()};g.destroy=function(){o();j.destroy()};var p=function(){k();l();m()};p();g.show=n;return g}});
STK.register("lib.forward.forwardDialog",function(a){return function(b,c){var d=a.lib.forward.source.init();d.show(b,c);return d}});
STK.register("lib.feed.plugins.translate",function(a){var b=a.core.util.easyTemplate,c=a.lib.kit.extra.language,d=a.lib.kit.extra.toFeedText,e=a.lib.kit.extra.textareaUtils,f="#"+c("#L{ææ¥ç¿»è¯}")+"#",g=a.lib.feed.feedTemps.translateTEMP,h=300,i='<div class="WB_empty"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>å è½½ä¸­</p></div></div></div>';return function(c){var e=c.getNode(),j=c.getDEvent(),k={},l={},m=[],n=function(b){var c={parent:"[node-type=feed_list_reason],[node-type=feed_list_content]",translate:"[node-type=feed_translate]"},d=a.core.dom.dir(b,{dir:"parent",expr:c.parent})[0],e=d?a.core.dom.dir(d,{dir:"next",expr:c.translate})[0]:null;return{parent:d,translate:e}},o=function(b,c){c=c||{};var d=c.callback||a.funcEmpty,e=c.text||"";l[b]={prev:e};l[b].translated?d(l[b].translated):a.conf.trans.feed.translate.request("translate",{onSuccess:function(a){var c=a.data;l[b]={prev:e,translated:c};d(c)},onError:function(a){var b=a.msg;b&&d(b)}},{text:e})},p=function(a,b){if(a.type!="mouseout"&&a.type!="mouseover")return!1;var c=a.relatedTarget?a.relatedTarget:a.type=="mouseout"?a.toElement:a.fromElement;while(c&&c!=b)c=c.parentNode;return c!=b},q,r=function(b){clearTimeout(q);q=setTimeout(function(){var c=n(b.el),d=c.translate;d&&a.custEvent.fire(d,"hide")},h)},s=function(c){clearTimeout(q);q=setTimeout(function(){var e=c.data,f=c.el,j=n(c.el),k=j.translate;if(!k){var l={text:i,bymedata:a.jsonToQuery(c.data)},r=a.builder(b(g,l).toString()).list,s=r.translate_rs[0],k=r.feed_translate[0],t;while(t=m.shift())t.parentNode&&a.custEvent.fire(t,"hide");m.push(k);var u=function(a){a=a||window.event;p(a,k)&&clearTimeout(q)},v=function(b){b=b||window.event;if(p(b,k)){clearTimeout(q);q=setTimeout(function(){k&&a.custEvent.fire(k,"hide")},h)}},w=function(b){var c=b.obj;if(c){a.custEvent.remove(c,"hide",w);a.custEvent.undefine(c,"hide");a.removeEvent(c,"mouseout",v);a.removeEvent(c,"mouseover",u);a.ui.effect(c,"fadeOutUp","fast",function(){a.removeNode(c)})}};a.custEvent.define(k,"hide");a.custEvent.add(k,"hide",w);a.addEvent(k,"mouseout",v);a.addEvent(k,"mouseover",u);o(e.mid,{text:a.decodeHTML(d(j.parent.innerHTML)),callback:function(a){s.innerHTML=a}});a.insertAfter(k,j.parent);a.ui.effect(k,"fadeInDown","fast");try{window.SUDA&&SUDA.uaTrack&&SUDA.uaTrack("tblog_bowen_translate","click_translate")}catch(x){}}},h)},t=function(b){var c=a.core.dom.dir(b.el,{dir:"parent",expr:"[node-type=feed_translate]"})[0];c&&a.custEvent.fire(c,"hide")},u=function(b){var c=b.data,d=b.el,e=1,g={};g.mid=c.mid;g.forwardOpts={originNick:c.originNick,reason:f,uid:c.uid,origin:l[c.mid].prev,type:e,url:c.url};a.lib.forward.forwardDialog(g.mid,g.forwardOpts)},v=function(){j.add("feed_translate","mouseover",s);j.add("feed_translate","mouseout",r);j.add("feed_translate_close","click",t);j.add("feed_translate_by_me","click",u)},w=function(){var b;while(b=m.shift())b.parentNode&&a.custEvent.fire(b,"hide");j.add("feed_translate","mouseover",s);j.add("feed_translate","mouseout",r);j.remove("feed_translate_close","click",t);j.remove("feed_translate_by_me","click",u)};v();k.destroy=w;return k}});
STK.register("lib.feed.plugins.jumpurl",function(a){return function(b){if(!b)a.log("quote : need object of the baseFeedList Class");else{var c=b.utils,d=b.getNode(),e=function(a,b){return a==b||a==document.body||!a?!1:a.tagName.toUpperCase()=="A"?!0:e(a.parentNode,b)},f=function(a){var b=a.evt,c=a.el,d=a.data,f=decodeURIComponent(d.url),g=d.target;e(b.target,a.el)||(g=="_blank"?window.open(f):location.href=f)},g=function(a){if(a.data.target_url)window.open(decodeURIComponent(a.data.target_url));else{var b=c.getMid(a.el,d);if(a.data.short_url){var e=a.data.short_url+"?mid="+b+"&uid="+$CONFIG.uid;window.open(e)}}},h=b.getDEvent();h.add("fl_jumpurl","click",f);h.add("fl_objjumpurl","click",g);var i={};i.destroy=function(){h.destroy()};return i}}});
STK.register("lib.feed.plugins.feedViews",function(a){return function(b){if(!b)a.log("images : need object of the baseFeedList Class");else{var c=b.getNode(),d=b.getDEvent(),e=a.conf.trans.feed.feed,f={},g={},h="",i,j,k,l,m=!1,n=!1,o=a.lib.kit.extra.language,p={showLayer:function(a,b){if(a&&b&&h!==b){k.setContent("");k.setContent(g[b]);h=b}l&&clearTimeout(l);l=null;k.show().setMiddle();!n&&i&&j&&window.SUDA&&window.SUDA.uaTrack&&window.SUDA.uaTrack(i,j);n=!0},getTarget:function(a){return a?a==document.body?!1:a.getAttribute("action-type")=="fl_feed_views"?a:arguments.callee(a.parentNode):!1},hideLayer:function(){!l&&(l=setTimeout(function(){k.hide();n=!1},200))}},q={overViews:function(b){var c=b.data,d=c.uid,f=c.mid,h=b.el;if(g[f])p.showLayer(h,f);else{if(m)return;m=!0;e.request("feedViews",{onSuccess:function(b){var c=b.data;g[f]=c.html;var d=a.queryToJson(c.suda);i=d.key;j=d.value;p.showLayer(h,f);m=!1},onFail:function(b){m=!1;a.lib.dialog.ioError(b.code,b)},onError:function(b){m=!1;a.lib.dialog.ioError(b.code,b)}},{uid:d,mid:f})}},outViews:function(b){var c=a.fixEvent(b);c.target!=bubble.getBox()&&!a.contains(bubble.getBox(),c.target)&&bubble.hide()}},r=function(){d.add("fl_feed_views","click",q.overViews)},s=function(){k=a.ui.dialog({isHold:!0});k.setTitle(o("#L{å¾®ä»»å¡}"));r()};s();var t=function(){d.destroy()};f.destroy=t;return f}}});
STK.register("lib.dialog.popularizeEffect",function(a){var b=!1,c=a.lib.kit.extra.language;return function(d){var e=a.parseParam({mid:""},d||{}),f=a.ui.dialog({isHold:!0});f.setTop();var g=a.delegatedEvent(f.getBox()),h={},i=function(){if(!b){b=!0;f.setTitle(c("#L{æ¨å¹¿}"));a.conf.trans.feed.feed.request("popularizeEffect",{onSuccess:function(c){f.setContent(c.data.html);f.show().setMiddle();var d=f.getBox(),e=a.sizzle('[action-type="widget_publish"]',d);a.addEvent(e[0],"click",k);b=!1},onFail:function(c){f.destroy();a.lib.dialog.ioError(c.code,c);b=!1},onError:function(c){f.destroy();a.lib.dialog.ioError(c.code,c);b=!1}},{mid:e.mid})}},j=function(b){if($CONFIG.islogin=="3")a.lib.dialog.loginLayer();else{f.destroy();var c=a.lib.dialog.popularizeLayer({mid:b.data.mid});c.show()}},k=function(a){setTimeout(function(){f.destroy()},1)};g.add("fl_pop","click",j);var l=function(){g.remove("fl_pop","click",j);f.destroy()};h.show=i;h.destroy=l;return h}});
STK.register("lib.feed.plugins.more",function(a){var b=a.lib.kit.extra.language;return function(b){var c=b.getDEvent(),d,e={},f,g,f,h,i,j,k={popularize:function(b){if($CONFIG.islogin=="3")a.lib.dialog.loginLayer();else{var c=b.data.mid||m(b.el);b.data.mid=c;b.data.src&&(b.data.src=decodeURIComponent(b.data.src));b.data.title&&(b.data.title=decodeURIComponent(b.data.title));i=a.lib.dialog.popularizeLayer(b.data);i.show()}},popularize_effect:function(b){var c=b.data.mid||m(b.el);j=a.lib.dialog.popularizeEffect({mid:c});j.show()}},l={more:function(b){if(f){a.removeEvent(f,"mouseover",l.layerOver);a.removeEvent(f,"mouseout",l.hide)}g&&o(g);clearTimeout(h);g=b.el;f=n(b.el);a.addEvent(f,"mouseover",l.layerOver);a.addEvent(f,"mouseout",l.hide)},hide:function(a){h=setTimeout(function(){o(g)},100)},layerOver:function(){clearTimeout(h)}},m=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').finish();return c.getAttribute("mid")},n=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').child('[node-type="fl_more_option_layer"]').finish();f=c;c.style.display="";a.addClassName(b,"W_arrow_turn");return c},o=function(b){var c=a.core.dom.neighbor(b).parent('[action-type="feed_list_item"]').child('[node-type="fl_more_option_layer"]').finish();c.style.display="none";a.removeClassName(b,"W_arrow_turn");return c},p=function(){},q=function(){c.add("fl_more_option","mouseover",l.more);c.add("fl_more_option","mouseout",l.hide);c.add("fl_pop","click",k.popularize);c.add("fl_pop_effect","click",k.popularize);c.add("thrid_rend_iframe","click",k.popularize)},r=function(){p();q()};r();var s=function(){c.remove("fl_more_option","mouseover",l.more);c.remove("fl_more_option","mouseout",l.hide);c.remove("fl_pop","click",k.popularize);c.remove("fl_pop_effect","click",k.popularize);c.remove("thrid_rend_iframe","click",k.popularize);i&&i.destroy&&i.destroy();j&&j.destroy&&j.destroy()};e.destroy=s;return e}});
STK.register("conf.trans.feed.thirdExpand",function(a){var b=a.lib.kit.io.inter(),c=b.register;c("Addtbcard",{url:"/Aj/Thirdinter/Addtbcard",method:"post"});return b});
STK.register("lib.feed.plugins.thirdExpand",function(a){return function(b){if(!b)a.log("thirdExpand : need object of the baseFeedList Class");else{var c=b.getNode(),d=b.getDEvent(),e=b.utils,f={},g=a.conf.trans.feed.thirdExpand,h={getPDNodes:function(b){return{prev:a.sizzle("[node-type=feed_list_media_prev]",b)[0],disp:a.sizzle("[node-type=feed_list_media_disp]",b)[0]}},getMid:function(b,c){return b.mid||(b.mid=a.lib.kit.dom.parentAttr(b,"mid",c))},getFeeds:function(b,c){return a.sizzle("["+c+"]",b)},getFeedNode:function(b,c){var d=h.getMid(b,c),e=h.getFeeds(c,'mid="'+d+'"');for(var f=1;f<e.length;f++)if(a.contains(e[f],b))return e[f];return e[0]},getActionData:function(a,b){return a.tagName.toLowerCase=="body"?null:a.getAttribute("node-type")==b?a.getAttribute("action-data"):arguments.callee(a.parentNode,b)},getActionNode:function(b,c){return a.sizzle('[node-type="'+c+'"]',b)},showActionNode:function(a,b){var c=h.getActionNode(a,b);for(var d=0;c[d];d++)c[d].style.display=""},hideActionNode:function(a,b){var c=h.getActionNode(a,b);for(var d=0;c[d];d++)c[d].style.display="none"},getItemIds:function(){}},i={fl_third_expand:function(a){var b=h.getFeedNode(a.el,c);h.showActionNode(b,"WB_card_hide");h.hideActionNode(b,"WB_card_show")},fl_third_pack:function(a){var b=h.getFeedNode(a.el,c);h.hideActionNode(b,"WB_card_hide");h.showActionNode(b,"WB_card_show")},fl_third_addtbcart:function(b){var d=b.data||{},e=h.getFeedNode(b.el,c),f=h.getPDNodes(e).prev,i=a.sizzle("li",f),j=[];for(var k=0;i[k];k++){var l=i[k].getAttribute("action-data")||"",m=a.queryToJson(l);m&&m.item_id&&j.push(m.item_id)}d.item_id=j.join(",");g.getTrans("Addtbcard",{onSuccess:function(c){if(c.data.html){var d=a.builder(c.data.html).box;a.replaceNode(d,b.el)}},onFail:function(b){a.ui.alert(b.msg)},onError:function(b){a.ui.alert(b.msg)}}).request(d)}},j=function(){d.add("fl_third_expand","click",i.fl_third_expand);d.add("fl_third_pack","click",i.fl_third_pack);d.add("fl_third_addtbcart","click",i.fl_third_addtbcart)},k=function(){j()};k();var l=function(){d&&d.destroy&&d.destroy()};f.destroy=l;return f}}});
STK.register("lib.feed.plugins.rightmenu",function(a){var b=a.lib.kit.extra.language;return function(b,c){if(!b)a.log("rightmenu : need object of the baseFeedList Class");else{var d,e={},f=b.getNode(),g=b.getDEvent(),h=b.utils,i,j=function(b){var c=h.getFeedNode(b),d=a.sizzle('[node-type="fl_menu_right"]',c);return d[0]?d[0]:!1},k=function(a){return!a||a==document.body?!1:a.getAttribute&&a.getAttribute("action-type")=="fl_menu"?a:arguments.callee(a.parentNode)},l=function(b){d=j(b.el);i&&i!=d&&i.style.display!="none"&&~function(b){a.ui.effect(b,"fadeOutUp",100,function(){b.style.display="none";n(b)})}(i);if(d.style.display=="none"){d.style.display="";a.ui.effect(d,"fadeInDown",100)}else a.ui.effect(d,"fadeOutUp",100,function(){d.style.display="none";n(d)});i=d},m=function(b){var c=a.fixEvent();c.target.getAttribute("node-type")!=="fl_menu_see_more"&&!a.core.dom.dir.parent(c.target,{expr:"[node-type=fl_menu_see_more]"}).length&&!k(c.target)&&i&&i.style.display!="none"&&a.ui.effect(i,"fadeOutUp",100,function(){i.style.display="none";n(i)})},n=function(b){if(b){var c=a.sizzle("[node-type=fl_menu_see_more]",b)[0],d=a.sizzle("[node-type=hide]",b)[0];if(c&&d){c.style.display="";d.style.display="none"}}},o=function(b){if(b){var c=a.sizzle("[node-type=fl_menu_see_more]",b)[0],d=a.sizzle("[node-type=hide]",b)[0];if(c&&d){c.style.display="none";d.style.display=""}}},p=function(a){var b=j(a.el);o(b)},q=function(){g.add("fl_menu","click",l);g.add("fl_menu_see_more","click",p);a.addEvent(document.body,"click",m)};q();var r=function(){g.destroy();a.removeEvent(document.body,"click",m)};return e}}});
STK.register("lib.feed.plugins.replyback",function(a){return function(b){if(!b)a.log("deleteFeed : need object of the baseFeedList Class");else{var c=b.getNode(),d=b.getDEvent(),e={},f=b.utils,g=a.lib.comment.commentTemp,h=null,i,j={},k=a.lib.comment.reply,l=a.lib.kit.extra.language,m=a.conf.trans.feed.comment,n,o=a.conf.trans.feed.comment,p=a.lib.comment.commentMsg,q={content:l("#L{è¯è®ºåå®¹ä¸è½ä¸ºç©ºå¦ï¼åç¹ä¸è¥¿å§ã}"),"delete":l("#L{ç¡®å®è¦å é¤è¯¥åå¤å}"),reply:l("#L{åå¤}"),blcok:l("#L{åæ¶å°æ­¤ç¨æ·å å¥é»åå}"),unReply:l(p.noPhoneReplyMsg),unPower:l(p.noPowerReplyMsg)},r=function(b){var d=b.el,e=b.data.cid,h=b.data.nick,i=b.data.canUploadImage==1,m=f.getFeedNode(d,c),o=f.getMid(d,m),p=a.core.dom.dir(d,{dir:"parent",expr:'[node-type="replywrap"]',matchAll:!1})[0],q=a.core.dom.dir(d,{dir:"parent",expr:"li",matchAll:!1})[0];n=a.sizzle("div[node-type=feed_list_commentList]",m)[0];var r=d.getAttribute("status"),t=j[e]&&j[e].DOM,u=t?a.core.dom.contains(document.body,t):!1;if(t&&a.getStyle(t,"display")!="none"&&u){a.setStyle(t,"display","none");q&&a.removeClassName(q,"curr")}else{if(!t||!u){t=a.builder(l(g.getReply({canUploadImage:i}))).list.commentwrap[0];p&&p.appendChild(t);var v=a.lib.kit.extra.merge(b.data,{mid:o,cid:e,content:h,module:"scommlist"});j[e]={handle:k(t,v),DOM:t};a.custEvent.add(j[e].handle,"reply",function(){q&&a.removeClassName(q,"curr");s.apply(null,arguments)})}q&&a.addClassName(q,"curr");a.setStyle(t,"display","");j[e]&&j[e].handle.focus()}},s=function(a,b,c){t(b,c)},t=function(b,c){var d=b.data;if(!d)return!1;d.comment&&n&&a.insertHTML(n,d.comment,"afterbegin");return!0},u={delete_success:function(b,d){var e=a.sizzle(["[comment_id=",d.cid,"]"].join(""),c)[0],g=a.sizzle("[comment_id]",e.parentNode);if(!g[1]){var h=f.getFeedNode(e,c),i=a.sizzle('[node-type="commentBox"]',h)[0];i.style.display="none"}e&&e.parentNode.removeChild(e)},delete_fail:function(a,b){}},v={replyback:function(b){var c=b.el;if(a.core.dom.hasClassName(c,"unclick_rep")){if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}var d=c.getAttribute("isPhone");d?h=a.ui.tip("alert",{msg:q.unReply,type:"warn"}):h=a.ui.tip("alert",{msg:q.unPower,type:"warn"});h.setLayerXY(c);h.aniShow();i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}else b.data&&b.data.ispower=="1"?m.getTrans("isComment",{onComplete:function(d){if(d.code=="100000"){var e,f,g;if((e=b.data)&&(f=e.nick))try{r(b)}catch(j){alert(j)}}else{if(h){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null}if(d.code=="100022")h=a.ui.tip("alert",{msg:q.unPower,type:"warn"});else if(d.code=="100001"){c&&c.setAttribute("isphone","1");h=a.ui.tip("alert",{msg:q.unReply,type:"warn"})}else h=a.ui.tip("alert",{msg:d.msg,type:"warn"});h.setLayerXY(c);h.aniShow();a.addClassName(c,"unclick_rep");i&&window.clearTimeout(i);i=window.setTimeout(function(){h.aniHide&&h.aniHide();h.destroy&&h.destroy();h=null},3e3)}}}).request(b.data):r(b)},deletereply:function(b){var c=b.data.block?['<input node-type="block_user" id="block_user" name="block_user" value="1" type="checkbox"/><label for="block_user">',q.blcok,"</label>"].join(""):"",d=a.ui.tipConfirm([q["delete"],c]).ok(function(a){var c=d.getDomList(!0).block_user&&d.getDomList(!0).block_user.checked,e,f;(e=b.data)&&(f=e.cid)&&(e=b.data)&&(f=e.cid)&&o.getTrans("delete",{onSuccess:u.delete_success,onError:u.delete_fail,onFail:u.delete_fail}).request({act:"delete",cid:f,is_block:c?"1":"0"})}).beside(b.el)}},w=function(){d.add("hot_commment_reply","click",v.replyback);d.add("hot_commment_delete","click",v.deletereply)};w();var x=function(){d.destroy()};e.destroy=x;return e}}});
STK.register("lib.feed.plugins.forward",function(a){var b=a.lib.kit.extra.language;return function(c){var d,e={},f=c.getDEvent(),g=function(c){var e=c.el,f=c.data,g=a.core.dom.neighbor(c.el).parent('[action-type="feed_list_item"]').finish(),i=c.el.getAttribute("error-msg");if(i){a.ui.alert(i);return a.preventDefault()}if(f.allowForward=="0"){a.ui.alert(b("#L{æ±æ­ï¼æ­¤å¾®åå·²ç»è¢«å é¤ï¼æ æ³è¿è¡è½¬åå¦ï¼è¯·è¯è¯å¶ä»åå®¹å§ã }"));return a.preventDefault()}var j=g.getAttribute("mid")||c.data.mid,k=a.lib.kit.extra.getDiss(g),l={},m=a.sizzle('[node-type="feed_list_content"]',g)[0];l.uid=f.uid?f.uid:"";l.uid=f.rootuid?f.rootuid:"";l.url=(f||"")&&f.url;l.dissDataFromFeed=k;if(!m){a.log("forward : there is not '[node-type=\"feed_list_content\"]' in the feed_item ");return a.preventDefault()}var n=a.sizzle('[node-type="feed_list_reason"]',m)[0];if(!n){var o=a.sizzle("[nick-name]",g);o.length&&(l.originNick=o[0].getAttribute("nick-name"));l.reason=m.innerHTML}else{l.originNick=a.sizzle('[node-type="feed_list_originNick"]',m)[0].getAttribute("nick-name")||"";l.reason=(n.innerHTML||"").replace(/[\r\n]+/g,"")}var p=a.sizzle('[node-type="feed_list_forwardContent"]',g)[0];if(p){l.forwardNick=f.name||l.originNick;l.originNick=a.sizzle('[node-type="feed_list_originNick"]',p)[0].getAttribute("nick-name");var q=a.sizzle('[node-type="feed_list_reason"]',p)[0];if(!q){a.log("forward : there is not 'em' node in the feed_list_forwardContent node ");return a.preventDefault()}l.origin=q.innerHTML}else{l.origin=l.reason;delete l.reason}for(var r in f)l[r]=f[r];d=a.lib.forward.forwardDialog(j,l);a.custEvent.add(d,"forward",function(b,e){a.custEvent.remove(d,"forward",arguments.callee);!e.toPrivateMsg&&h(c.el,e)});a.custEvent.add(d,"updateNum",function(b,e){a.custEvent.remove(d,"updateNum",arguments.callee);h(c.el,e)})},h=function(c,d){var e=a.core.dom.neighbor(c).parent('[action-type="feed_list_item"]').finish(),f=a.sizzle('[node-type="forward_btn_text"]',c)[0]||c,g=a.sizzle('[node-type="comment_btn_text"]',e)[0]||a.sizzle('[action-type="fl_comment"]',e)[0];if(f){var h=d.backnum,i=f.innerHTML.match(/\s\d+/);i=i?parseInt(i[0]):0;var j=0;d.cevtType=="forward"&&(j=1);h&&h>i?f.innerHTML=b("#L{è½¬å}")+" "+(h+j<=0?"":h+j):f.innerHTML=b("#L{è½¬å}")+" "+(i+j<=0?"":i+j)}if(g&&d.isComment){var i=g.innerHTML.match(/\(([\d]*)\)/);g.innerHTML=b("#L{è¯è®º}")+" "+(i?parseInt(i[1])+1:1)}};f.add("fl_forward","click",g);e.destroy=function(){f.remove("fl_forward","click",g)};return e}});
STK.register("pl.content.homeFeed.source.eventrouter",function(a){return{fl_forward:"forward.forwardStart"}});
STK.register("pl.content.homeFeed.source.invokeFilter",function(a){return function(b,c){var d=b.getNode(),e=b.utils;return{forward:{forwardStart:function(b,c,f){var g=e.getMid(c,d),h=a.queryToJson(c.getAttribute("action-data")||""),i=a.core.dom.dir.parent(c,{expr:'[action-type="feed_list_item"]'})[0],j,k,l;if(i){j=a.sizzle('[node-type="feed_list_reason"]',i)[0];k=a.sizzle('[node-type="feed_list_content"]',i)[0];h.forwardNick=h.rootname;h.originNick=h.name;k&&(h.origin=a.trim(k.innerHTML.replace(/[\r|\n|\t]/g,"")));if(j){h.origin=a.trim(j.innerHTML.replace(/[\r|\n|\t]/g,""));h.reason=a.trim(k.innerHTML.replace(/[\r|\n|\t]/g,""));h.forwardNick=a.trim(h.name)}}return{mid:g,forwardOpts:h}}}}}});
STK.register("pl.content.homeFeed.source.invokeCallback",function(a){var b=a.lib.kit.extra.language;return function(c,d){var e=c.getNode(),f=c.utils;return{forward:{forwardStart:{success:function(c){var d=a.sizzle("[mid="+c.mid+"][action-type=feed_list_item] [action-type=fl_forward]",e)[0],f=a.sizzle("[mid="+c.mid+"][action-type=feed_list_item] [action-type=fl_comment]",e)[0];if(d){var g=c.backnum,h=d.innerHTML.match(/\(([\d]*)\)/);h=h?parseInt(h[1]):0;var i=0;c.cevtType=="forward"&&(i=1);g&&g>h?d.innerHTML=b("#L{è½¬å}")+"("+(g+i)+")":d.innerHTML=b("#L{è½¬å}")+"("+(h+i)+")"}if(f&&c.isComment){var h=f.innerHTML.match(/\(([\d]*)\)/);f.innerHTML=b("#L{è¯è®º}")+"("+(h?parseInt(h[1])+1:1)+")"}},error:function(a){}}}}}});
STK.register("lib.feed.plugins.feedSet",function(a){var b=a.lib.kit.extra.language,c=a.conf.trans.feed.feed;return function(d,e){function n(b){var c=i.getFeedNode(b,g);c.style.height=c.offsetHeight+"px";c.style.overflow="hidden";var e=a.tween(c,{duration:200,animationType:"easeoutcubic",end:function(){c.innerHTML="";a.removeNode(c);g=b=c=null;e.destroy();d.getFeedCount()<1&&window.location.reload()}}).play({height:0})}var f={},g=d.getNode(),h=d.getDEvent(),i=d.utils,j,k={okCallback:function(){},hideCallback:function(){}},l=function(a){var c={PRIVATE:[b("#L{ç¡®å®å°æ­¤å¾®åæ´æ¹ä¸ºä»èªå·±å¯è§å}"),b("(#L{è½¬æ¢ä¸ºèªå·±å¯è§å¾®ååä¸å¯åæ¬¡è½¬ä¸ºå¬å¼å¾®å})")],FRIENDS:[b("#L{ç¡®å®å°æ­¤å¾®åæ´æ¹ä¸ºä»å¥½ååå¯è§å}"),b("(#L{è½¬æ¢ä¸ºå¥½ååå¾®ååä¸å¯åæ¬¡è½¬ä¸ºå¬å¼å¾®å})")]};return c[a]},m=function(a){return a==document.body?!1:a.getAttribute("id")?a.getAttribute("id"):arguments.callee(a.parentNode)},o={closeConfirmTip:function(b){var c=b.el,d=b._confirmTipParam,e=a.core.dom.neighbor(c).parent('[action-type="feed_list_item"]').child('[action-type="fl_menu"]').finish(),f=a.ui.tipConfirm(d.template).ok(d.okCallback).cancel(d.hideCallback).beside(e)},fl_friendVisible:function(b){var d=b.el,f=i.getMid(d,g),h=i.getFeedNode(d);b.data.mid=f;k.template=l("FRIENDS");k.okCallback=function(){c.getTrans("changeLevel",{onSuccess:function(b){if(e&&e.isWeiboDetail==!0)window.location.reload();else{var c=a.builder(b.data.html);a.core.dom.replaceNode(c.box,h)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:d,_confirmTipParam:k})},fl_personalVisible:function(b){var d=b.el,f=i.getMid(d,g),h=i.getFeedNode(d);b.data.mid=f;k.template=l("PRIVATE");k.okCallback=function(){c.getTrans("changeLevel",{onSuccess:function(b){if(e&&e.isWeiboDetail==!0)window.location.reload();else{var c=a.builder(b.data.html);a.core.dom.replaceNode(c.box,h)}},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:d,_confirmTipParam:k})},fl_feedset:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;d.data.type==1?e.template=b("#L{ç¡®å®å°æ­¤å¾®åç½®é¡¶åï¼}"):d.data.type==2?e.template=b("#L{ç¡®å®åæ¶ç½®é¡¶ï¼}"):d.data.type==3?e.template=[b("#L{ç¡®å®éèè¯¥å¾®åï¼}"),b("(#L{éèåè¯¥å¾®åå°ä¸åæ¾ç¤ºï¼æ æ³æ¢å¤})")]:e.template=b("#L{ç¡®å®ï¼}");e.okCallback=function(){c.getTrans("feedset",{onSuccess:function(b){var c=m(d.el),e=FM.getURL().href;e.replace("#"+FM.getURL().hash,"");e=e.indexOf("?")==-1?e+"?":e+"&";a.historyM.pushState(e+"pids="+c+"#"+c,{callChange:!0})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e})},fl_user_settings:function(b){var d={},e=i.getMid(b.el,g),f=i.getFeedNode(b.el);b.data.mid=e;d.msg=b.data.text;d.okCallback=function(){c.getTrans("accountset",{onSuccess:function(a){window.location.reload()},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(b.data)};o.closeConfirmTip({el:b.el,_confirmTipParam:d})},proxy:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;e.template={4:b("#L{ç¡®å®å°æ­¤å¾®åæ¨èç»å³æ³¨ç¨æ·å}ï¼"),5:b("#L{ç¡®å®å°æ­¤å¾®åæ¨èç»å³æ³¨ç¨æ·å}ï¼")}[d.data.type||4];e.okCallback=function(){c.getTrans("proxy",{onSuccess:function(c){a.ui.tip("lite",{msg:b("#L{æ¨èæå}ï¼"),type:"succ",timer:"500"})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e})},feed_set:function(d){var e={},f=i.getMid(d.el,g),h=i.getFeedNode(d.el);d.data.mid=f;e.template={1:b("#L{ç¡®å®å°æ­¤å¾®åç½®é¡¶åï¼}"),2:b("#L{ç¡®å®å°æ­¤å¾®ååæ¶ç½®é¡¶åï¼}"),3:b("#L{ç¡®å®å°æ­¤å¾®åæ¨èç»å³æ³¨ç¨æ·å}ï¼"),4:b("#L{ç¡®å®å±è½æ­¤å¾®åå}ï¼"),5:b("#L{ç¡®å®å±è½}"+d.data.screen_name+"#L{çå¾®åå}ï¼")}[d.data.msgtype||4];var j={1:b("#L{ç½®é¡¶æå}"),2:b("#L{åæ¶ç½®é¡¶æå}"),3:b("#L{æ¨èæå}")}[d.data.msgtype||4],k="";d.data.msgtype==4?k=b("å¨æ­¤ä¸»é¡µå°èªå¨å±è½è¿æ¡å¾®åãå¯ä»¥å¨è®¾ç½®-åå®¹ç®¡çä¸­åæ¶å±è½ã"):d.data.msgtype==5&&(k=b("è¯¥ä¸»é¡µå°èªå¨å±è½æ¥èªTAçå¾®åãå¯ä»¥å¨è®¾ç½®-åå®¹ç®¡çä¸­åæ¶å±è½ã"));d.data.is_top==1&&(k=b("#L{å±è½åè¯¥å¾®åçç½®é¡¶ç¶æä¼åæ¶åæ¶}"));switch(d.data.msgtype){case"1":case"2":case"3":e.okCallback=function(){c.getTrans("feedset_new",{onSuccess:function(b){a.ui.tip("lite",{msg:j,type:"succ",timer:"500"}).on("hide",function(){window.location.reload()})},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)};o.closeConfirmTip({el:d.el,_confirmTipParam:e});break;case"4":case"5":a.ui.confirm([e.template,k]).ok(function(){c.getTrans("feedset_new",{onSuccess:function(a){n(d.el)},onError:function(b){a.lib.dialog.ioError(b.code,b)}}).request(d.data)})}}},p=function(){h.add("fl_friendVisible","click",o.fl_friendVisible);h.add("fl_personalVisible","click",o.fl_personalVisible);h.add("fl_feedset","click",o.fl_feedset);h.add("fl_user_settings","click",o.fl_user_settings);h.add("proxy","click",o.proxy);h.add("feed_set","click",o.feed_set)},q=function(){p()};q();f.destroy=function(){h.remove("fl_friendVisible","click",o.fl_friendVisible);h.remove("fl_personalVisible","click",o.fl_personalVisible);h.remove("fl_feedset","click",o.fl_feedset);h.remove("fl_user_settings","click",o.fl_user_settings);h.remove("proxy","click",o.proxy);h.remove("feed_set","click",o.feed_set)};return f}});
STK.register("conf.channel.like",function(a){var b=["like","unlike"];return a.lib.kit.extra.listener.define("conf.channel.like",b)});
STK.register("lib.feed.plugins.spreadFeed",function(a){var b=a.lib.dialog.ioError,c=a.conf.trans.feed.feed,d=a.lib.kit.extra.language;return function(e){function y(){a.conf.channel.like.remove("like",t);i.remove("feed_spread_follow","click",r);i.remove("feed_spread_close","click",q);i.remove("feed_spread_pageNext","click",w);i.remove("feed_spread_pagePrev","click",x)}function x(b){var c=b.data,d=k(b.el,h);f=n.getPage(d);if(!(f<=1)){n.setPage(d,f-1);v(d);u(c.type,d);return a.preventDefault(b.evt)}}function w(b){var c=b.data,d=k(b.el,h),e=a.sizzle("[node-type='feed_spread_list']",d),g=e[0],i=a.sizzle("[node-type='feed_spread_list']",d).length,j=a.sizzle("[node-type='feed_spread_contain']",d)[0],l=a.sizzle("[node-type='feed_spread_cdivs']",d)[0],m=Math.floor(l.offsetWidth/g.offsetWidth),o=Math.ceil(i/m);f=n.getPage(d);if(!(f>=o)){n.setPage(d,f+1);v(d);u(c.type,d);return a.preventDefault(b.evt)}}function v(b){f=n.getPage(b);if(!!b){var c=a.sizzle("[node-type='feed_spread_contain']",b)[0],d=a.sizzle("[node-type='feed_spread_cdivs']",b)[0],e=a.sizzle("[node-type='feed_spread_list']",b),g=e.length,h=e[0],i=Math.floor(d.offsetWidth/h.offsetWidth),j=Math.ceil(g/i),k=a.sizzle('[node-type="feed_spread_pagecount"]',b)[0],l=a.sizzle("[node-type='feed_spread_btnPrev']",b)[0],m=a.sizzle("[node-type='feed_spread_btnNext']",b)[0],o=a.sizzle('[node-type="feed_spread_page"]',b)[0],p=a.sizzle("[node-type='feed_spread_pagePrev']",b)[0],q=a.sizzle("[node-type='feed_spread_pageNext']",b)[0];if(f>j){f=parseInt(j);n.setPage(b,f)}if(j>1){o.style.display="";k.innerHTML=f+"/"+j;p&&(p.style.display=f==j?"":"none");q&&(q.style.display=f==j?"none":"");l&&f!=1?a.removeClassName(l,"W_btn_b_disable"):!a.hasClassName(l,"W_btn_b_disable")&&a.addClassName(l,"W_btn_b_disable");m&&f==j?!a.hasClassName(m,"W_btn_b_disable")&&a.addClassName(m,"W_btn_b_disable"):m&&a.removeClassName(m,"W_btn_b_disable")}else{o.style.display="none";q&&(q.style.display="none");p&&(p.style.display="none");l&&!a.hasClassName(l,"W_btn_b_disable")&&a.addClassName(l,"W_btn_b_disable");m&&!a.hasClassName(m,"W_btn_b_disable")&&a.addClassName(m,"W_btn_b_disable")}}}function u(b,c){var d=a.sizzle("[node-type='feed_spread_list']",c),e=d[0],h=d.length,i=-e.offsetWidth-6,j=a.sizzle("[node-type='feed_spread_contain']",c)[0],k=a.sizzle("[node-type='feed_spread_cdivs']",c)[0],l=Math.floor(k.offsetWidth/e.offsetWidth);f=n.getPage(c);if(g==undefined){var m=a.getStyle(j,"marginLeft"),o=parseFloat(m);o.toString()!="NaN"?g=o:g=0}var p=Math.ceil(h/l);if(f>p){f=parseInt(p);n.setPage(c,f)}var q=i*(f-1)*l+g,r=k.offsetWidth%e.offsetWidth;f==p&&p!=1&&(q=k.offsetWidth-(e.offsetWidth+6)*h+10);var s=a.tween(j,{end:function(){s.destroy();var a=q+"px";f==1&&(a="");j&&(j.style.marginLeft=a)}}).play({marginLeft:q})}function t(d){function l(a){if(e){e.style.overflow="hidden";p(e,a.data.html)}}var e,f,g,i,k,n=d.object_id||d.mid;i=a.sizzle("[node-type=feed_spread_list] [spread_like_id="+n+"]")[0];e=i&&j(i);if(e){f=m(i);g=a.core.json.merge(a.queryToJson(e.getAttribute("extra-data")||""),{filterids:f});c.getTrans("delSpread",{onSuccess:l,onFail:function(a){b(a.code,a)},onError:function(a){b(a.code,a)}}).request(g)}k=a.sizzle("[action-type=feed_list_item][trend-data]",h)[0];if(d.mid&&k&&k.getAttribute("mid")==d.mid){var o=a.queryToJson(k.getAttribute("trend-data")||"");k.removeAttribute("trend-data");c.getTrans("delSpread",{onSuccess:function(b){if(b.data.html){var c=a.core.dom.dir.parent(k,{expr:"[node-type=feed_spread]"})[0]||k;a.insertAfter(a.builder(b.data.html).box,c)}},onFail:function(a){b(a.code,a)},onError:function(a){b(a.code,a)}}).request(o)}}function s(b){a.foreach(a.sizzle("[spread_follow_uid]",h),function(c){if(b.uid&&c.getAttribute("spread_follow_uid")==b.uid){var c=a.lib.kit.dom.firstChild(c);if(b.action==="follow"){var e=a.builder(d('<a class="W_btn_b W_btn_b_disable">#L{å·²å³æ³¨}</a>')).box.firstChild;e.setAttribute("action-data",c.getAttribute("action-data"));a.replaceNode(e,c)}else if(b.action==="unFollow"){var e=a.builder(d('<a class="W_btn_b" action-type="feed_spread_follow"><em class="W_ficon ficon_add">+</em>#L{å³æ³¨}</a>')).box.firstChild;e.setAttribute("action-data",c.getAttribute("action-data"));a.replaceNode(e,c)}}})}function r(e){function o(b){a.replaceNode(f,g);if(!b.data.html)a.conf.channel.follow.fire("changeStatus",{uid:n.uid,action:"follow",fan:!1});else{p(k,b.data.html);a.conf.channel.follow.fire("changeStatus",{uid:n.uid,action:"follow",fan:!1})}}var f=a.builder(d('<a class="W_btn_b W_btn_b_disable">#L{å·²å³æ³¨}</a>')).box.firstChild,g=a.builder(d('<a class="W_btn_b W_btn_b_disable"><i class="W_loading"></i>#L{å³æ³¨}</a>')).box.firstChild,h=e.el,i=e.el.parentNode,k=j(e.el),l=m(e.el),n=a.core.json.merge(e.data,{filterids:l});setTimeout(function(){a.replaceNode(g,h);c.getTrans("delSpread",{onSuccess:o,onFail:function(c){b(c.code,c);a.replaceNode(h,g)},onError:function(c){b(c.code,c);a.replaceNode(h,g)}}).request(n)},100)}function q(d){function k(b){f?o(a.core.dom.dir.parent(e,{expr:"[node-type=feed_spread]"})[0]):g&&p(g,b.data.html)}var e=d.el,f=!!a.core.dom.dir.parent(e,{expr:"[action-type=feed_list_item]"})[0],g,h,i;if(!f){g=j(e);h=m(e);i=a.core.json.merge(d.data,{filterids:h})}else i=d.data;c.getTrans("delSpread",{onSuccess:k,onFail:function(a){b(a.code,a)},onError:function(a){b(a.code,a)}}).request(i);a.preventDefault(d.evt)}function o(b){b.style.height=b.offsetHeight+"px";b.style.overflow="hidden";var c=a.tween(b,{duration:200,animationType:"easeoutcubic",end:function(){b.innerHTML="";a.removeNode(b);h=el=b=null;c.destroy();e.getFeedCount()<1&&window.location.reload()}}).play({height:0})}function p(b,c){var d=l(b).length,e=k(b,h);if(d==1&&!c)o(k(b));else var f=a.tween(b,{end:function(){if(c){var d=a.C("div");d.innerHTML=c;var f=a.builder(d).list.feed_spread_list[0];f&&a.replaceNode(f,b);f&&a.setStyle(f,"opacity","0");var g=a.tween(f,{end:function(){g.destroy();f&&a.setStyle(f,"opacity","");f=null;v(e);u(undefined,e)},duration:200}).play({opacity:1})}else{b&&a.removeNode(b);u(undefined,e);v(e)}},duration:200}).play({opacity:0})}function o(b){b.style.overflow="hidden";b.style.position="relative";var c=a.tween(b,{duration:200,animationType:"easeoutcubic",end:function(){b.innerHTML="";a.removeNode(b);b=null;c.destroy();e.getFeedCount()<1&&window.location.reload()}}).play({height:0})}function m(b){var c=[];a.foreach(l(b),function(a){c.push(a.getAttribute("data-filterid"))});return c.join(",")}function l(b){return a.sizzle("[node-type=feed_spread_list]",k(b))}function k(b){return a.core.dom.dir.parent(b,{expr:"[node-type=feed_spread]"})[0]}function j(b){return a.core.dom.dir.parent(b,{expr:"[node-type=feed_spread_list]"})[0]}var f=1,g,h=e.getNode(),i=e.getDEvent(),n={myPage:{},getKey:function(b){var c;if(!b._currKey){c=a.getUniqueKey();b._currKey=c}else c=b._currKey;return c},getPage:function(a){var b=n.getKey(a),c=1;n.myPage[b]?c=n.myPage[b]:n.setPage(a,c);return c},setPage:function(a,b){var c=n.getKey(a);n.myPage[c]=b}};a.conf.channel.like.register("like",t);a.conf.channel.follow.register("changeStatus",s);i.add("feed_spread_follow","click",r);i.add("feed_spread_close","click",q);i.add("feed_spread_pageNext","click",w);i.add("feed_spread_pagePrev","click",x);var z={};z.destroy=y;return z}});
STK.register("lib.feed.plugins.adFeed",function(a){return function(b){if(!b)a.log("wbmlLoader : need object of the baseFeedList Class");else{var c={},d=b.utils,e=b.getNode(),f=function(b){var c=d.getMid(b.el,e),f=d.getFeedNode(b.el,e),g=b.evt,h=a.core.evt.fixEvent(g).target,i=a.sizzle("[extra-data]",f);if(i[0]){var j=h.getAttribute("extra-data")||"",k=b.el.getAttribute("href",4)||h.getAttribute("href",4),l=a.core.json.queryToJson(j);l.mid=c;var m=f.getAttribute("data-mark")||"",n=a.queryToJson(m);l=a.core.json.merge(l,n);if(j){d.preventDefault(b.evt);if(b.el.getAttribute("target")=="_blank"){k&&window.open(k);a.conf.trans.feed.feed.getTrans("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}}).request(l)}else a.conf.trans.feed.feed.getTrans("setAD",{onSuccess:function(){k&&(window.location.href=k)},onFail:function(){k&&(window.location.href=k)},onError:function(){k&&(window.location.href=k)}}).request(l);return!1}}},g=function(b){var c=a.core.evt.fixEvent(b).target,d;d=a.lib.kit.dom.parentElementBy(c,e,function(a){if(a.getAttribute("mid")||a.getAttribute("node-type")=="feed_spread_list")return!0});if(d&&(d.getAttribute("feedtype")&&d.getAttribute("feedtype")=="ad"||d.getAttribute("node-type")=="feed_spread_list")){var f=d.getAttribute("mid")||"",g;c.getAttribute("markad-data")&&(g=c);g=g||a.lib.kit.dom.parentElementBy(c,d,function(a){if(a.getAttribute("markad-data"))return!0});if(g){var h=g.getAttribute("markad-data")||"",i=a.core.json.queryToJson(h);f&&(i.mid=f);var j=d.getAttribute("data-mark")||"",k=a.queryToJson(j);i=a.core.json.merge(i,k);a.conf.trans.feed.feed.getTrans("setAD",{onSuccess:function(){},onFail:function(){},onError:function(){}}).request(i)}}};b.getDEvent().add("feed_list_ad","click",f);a.addEvent(e,"click",g);c.destroy=function(){a.removeEvent(e,"click",g)};return c}}});
STK.register("lib.comment.commentMedia",function(a){var b=a.lib.comment.commentTemp,c=a.core.util.easyTemplate,d=a.lib.kit.extra.language,e=d("#L{å è½½å¤±è´¥}!"),f=d("#L{å¾æ±æ­ï¼è¯¥åå®¹æ æ³æ¾ç¤ºï¼è¯·ç¨ååè¯ã}"),g=d("#L{æä½å¤±è´¥ï¼è¯·ç¨åéè¯ã}"),h=450,i=function(b){return a.core.dom.dir(b,{expr:"[comment_id]"})[0]},j=function(b){var c=b.getAttribute("comment_id")?b:i(b);return{prev:a.sizzle("[node-type=comment_media_prev]",c)[0],disp:a.sizzle("[node-type=comment_media_disp]",c)[0]}},k=function(e,f){var g=e.el,k=e.data,l=decodeURIComponent(k.pic_objects||""),m=l.split("|");if(!g.loading){g.tagName.toLowerCase()!=="img"&&(g=a.sizzle("img",g)[0]);g.loading=1;var n=/\/thumbnail\/.+(?=\.\w+)/.exec(g.src);n&&(n=n[0].replace("/thumbnail/",""));var o=g.src.replace("/thumbnail/","/bmiddle/"),p=i(g),q=p.getAttribute("comment_id"),r="pid="+(k.pid?k.pid:n)+"&cid="+(k.cid?k.cid:q),s,t,u=j(p),v=function(){g.loading=0;if(s){g.bigImgWidth=s.width;s.onload=null}t&&(t.style.display="none");u.prev.style.display="none";u.disp.innerHTML="";var e=a.core.dom.dir.parent(g,{expr:".WB_feed_comment"})[0]||a.core.dom.dir.parent(g,{expr:".WB_sonFeed"})[0]?"S_bg1":"S_bg2";u.disp.appendChild(a.builder(c(d(b.mediaImage),{bgClass:e,uniqueId:a.core.util.getUniqueKey(),bigSrc:o,acdata:r,pid:k.pid?k.pid:n,mid:k.mid,object_id:m[3],bigWidth:g.bigImgWidth>h?h:g.bigImgWidth,suda:{showBig:"key=comment_pic_click&value=big_pic_button",left:"key=comment_pic_click&value=turnleft_button",right:"key=comment_pic_click&value=turnright_button"}}).toString()).box);u.disp.style.display=""};if(g.bigImgWidth)v();else{var w=g.offsetWidth,x=parseInt(g.offsetHeight/2-8);(t=a.core.dom.next(g)).style.cssText="margin:"+x+"px "+parseInt(w/2-8)+"px "+x+"px -"+parseInt(w/2+8)+"px;";(s=new Image).onload=v;s.src=o}}},l=function(b,c,d){var e=b.el;if(!!d||!!/(img)|(canvas)/.test(b.evt.target.tagName.toLowerCase())){var f=i(e);if(!f){a.log("parents attribute mid is undefined!");return}f.disp="";var g=j(f);if(!g||!g.prev||!g.disp){a.log('node-type="comment_media_prev" or node-type="comment_media_disp" in a feed\'s node is undefined!');return}a.position(g.disp).t<a.scrollPos().top&&f.scrollIntoView();g.prev.style.display="";g.disp.style.display="none";g.disp.innerHTML=""}},m=function(b,c,d){var e=b.el,f=i(e);if(!e.parentNode.uid){var g=a.sizzle('img[action-type="comment_media_bigimg"],canvas[id]',f)[0];e.parentNode.uid="rotate_img_"+a.core.dom.uniqueID(g.oImage||g);g.setAttribute("id",e.parentNode.uid)}a.lib.kit.dom.rotateImage.rotateRight(a.E(e.parentNode.uid),d,h)};return function(b){var c=a.delegatedEvent(b),d={};c.add("comment_media_img","click",function(c){a.lib.kit.extra.feedControlHash();k(c,b);return a.preventDefault(c.evt)});c.add("comment_media_toSmall","click",function(c){l(c,b,!0);return a.preventDefault(c.evt)});c.add("comment_media_bigimgDiv","click",function(c){l(c,b);return a.preventDefault(c.evt)});c.add("comment_media_toRight","click",function(c){m(c,b,90);return a.preventDefault(c.evt)});c.add("comment_media_toLeft","click",function(c){m(c,b,-90);return a.preventDefault(c.evt)});d.destroy=function(){c.destroy()};return d}});
STK.register("lib.feed.plugins.commentMedia",function(a){return function(b){var c=b.getNode(),d=a.lib.comment.commentMedia(c);return{destroy:function(){d.destroy()}}}});
STK.register("conf.trans.theme",function(a){var b=a.lib.kit.io.inter(),c=b.register,d=$CONFIG.domain;c("getskinSet",{url:"/aj/skin/getskinlist?pcate=1&isSuit=1",method:"get"});c("setskinSet",{url:"/aj/skin/updatesys",method:"post"});c("getskinTemplate",{url:"/aj/skin/getskinlist?pcate=0&isSuit=0",method:"get"});c("setskinTemplate",{url:"/aj/skin/updatesys",method:"post"});c("getskinCover",{url:"/aj/skin/getcoversystem",method:"get"});c("setskinCover",{url:"/aj/skin/setcoversystem",method:"post"});c("getskinCustom",{url:"/aj/skin/getcustom",method:"get"});c("setskinCustom",{url:"/aj/skin/updatecustom",method:"post"});c("setskinCoverCustom",{url:"/aj/skin/setcovercustom",method:"post"});c("getskinSet_page",{url:"/p/aj/v6/skin/getskinsystem?pcate=1&isSuit=1",method:"get"});c("setskinSet_page",{url:"/p/aj/v6/skin/setskinsystem",method:"post"});c("getskinTemplate_page",{url:"/p/aj/v6/skin/getskinsystem?pcate=0&isSuit=0",method:"get"});c("setskinTemplate_page",{url:"/p/aj/v6/skin/setskinsystem",method:"post"});c("getskinCover_page",{url:"/p/aj/v6/skin/getcoversystemlist",method:"get"});c("setskinCover_page",{url:"/p/aj/v6/skin/setcoversystem",method:"post"});c("getskinCustom_page",{url:"/p/aj/v6/skin/getskincustom",method:"get"});c("setskinCustom_page",{url:"/p/aj/v6/skin/setskincustom",method:"post"});c("getCardbg",{url:"/aj/cardbackground/list",method:"get"});c("setCardbg",{url:"/aj/cardbackground/update",method:"post"});c("setskinCoverCustom_page",{url:"/p/aj/v6/skin/setcovercustom",method:"post"});c("getskinSet_object",{url:"/p/aj/v6/skin/matter/getskinsystem?pcate=1&isSuit=1",method:"get"});c("setskinSet_object",{url:"/p/aj/v6/skin/matter/setskinsystem?domain="+d,method:"post"});c("getskinTemplate_object",{url:"/p/aj/v6/skin/matter/getskinsystem?pcate=0&isSuit=0",method:"get"});c("setskinTemplate_object",{url:"/p/aj/v6/skin/matter/setskinsystem?domain="+d,method:"post"});c("getskinCover_object",{url:"/p/aj/v6/skin/matter/getcoversystemlist",method:"get"});c("setskinCover_object",{url:"/p/aj/v6/skin/matter/setcoversystem?domain="+d,method:"post"});c("getskinCustom_object",{url:"/p/aj/v6/skin/matter/getskincustom",method:"get"});c("setskinCustom_object",{url:"/p/aj/v6/skin/matter/setskincustom?domain="+d,method:"post"});c("setskinCoverCustom_object",{url:"/p/aj/v6/skin/matter/setcovercustom?domain="+d,method:"post"});return b});
STK.register("lib.feed.plugins.cardbg",function(a){var b=a.lib.kit.extra.language,c='<#et list data><div class="W_layer"><div class="content"><div class="W_layer_title" node-type="title">${data.title}</div><div class="W_layer_close"><a href="javascript:void(0)" node-type="close" class="W_ficon ficon_close S_ficon">X</a></div><div class="layer_point"><dl class="point clearfix"><dt><span class="W_icon icon_warnB"></span></dt><dd><p class="S_txt1">${data.text}</p><p class="S_txt2">${data.desc}</p></dd></dl></div><div class="W_layer_btn S_bg1"><a href="javascript:void(0);" action-type="btn_l" class="W_btn_b btn_34px">${data.btn_l}</a><a href="javascript:void(0);" action-type="btn_r" class="W_btn_a btn_34px"><span><i class="W_icon icon_member"></i> ${data.btn_r}</span></a></div></div></div></#et>';return function(d){function h(c){var d=c.data;if(d.isvip!="1")g();else{if(d.same=="1"){a.ui.confirm(b("#L{ä½ å½åæ­£å¨ä½¿ç¨æ­¤èæ¯ï¼å»æ¨¡æ¿ååæéæ´å¤å¡çèæ¯å§~}")).ok(b("#L{å»çç}"),function(){window.open("http://weibo.com?skinTab=4")});return}a.ui.confirm([b("#L{ç¡®å®ä½¿ç¨æ­¤å¡çèæ¯å?}"),b('#L{æ­¤èæ¯å°å±ç¤ºå¨ä½ å¾®åçå³ä¸è§ï¼å»<a target="_blank" href="http://weibo.com?skinTab=4">æ¨¡æ¿åå</a>æéæ´å¤å¡çèæ¯}')],{title:b("#L{æä¹è¦ç¨å¡çèæ¯}")}).ok(function(){a.conf.trans.theme.request("setCardbg",{onSuccess:function(c){a.ui.notice(b("#L{ä¿å­æå!}")).on("hidden",function(){c.data.statusText&&a.lib.publisher.publisherDialog({content:c.data.statusText})})},onError:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)},onFail:function(b){b.data&&b.data.noprivilege===!0?g():a.lib.dialog.ioError(b.code,b)}},{id:d.id})})}}function g(){var d={title:b("#L{æç¤º}"),text:b("#L{å¯¹ä¸èµ·ï¼ä½ è¿ä¸æ¯å¾®åä¼åï¼æ­¤èæ¯ä»ä¼åå¯ç¨å¦ã}"),desc:b("#L{æ¸©é¦¨æç¤ºï¼å¼éå¾®åä¼åå¯åè´¹ä½¿ç¨å¨é¨èæ¯ã}"),btn_l:b("#L{æç¥éäº}"),btn_r:b("#L{ç«å³å¼éä¼å}"),btn_l_cb:function(){f&&f.hide()},btn_r_cb:function(){window.open("http://pay.vip.weibo.com/vippay?from=cardbackground");f&&f.hide()}},e=a.core.util.easyTemplate(c,d).toString(),f=a.ui.dialog({template:e,autoRelease:!0}).on("btn_l","click",d.btn_l_cb).on("btn_r","click",d.btn_r_cb).show()}var e=d.getNode(),f=d.getDEvent();f.add("fl_cardCover","click",h);return{destroy:function(){f.remove("fl_cardCover","click",h)}}}});
STK.register("pl.content.homeFeed.source.feedList",function(a){var b=a.pl.content.homeFeed.source;return function(c,d){var e=[],f=a.lib.feed.base(c,{plNode:c});d=d||{};d.plNode=c;d.router=b.eventrouter;d.invokeFilter=b.invokeFilter(f,d);d.invokeCallback=b.invokeCallback(f,d);e.push(a.lib.feed.plugins.comment(f,d));e.push(a.lib.feed.plugins.favorite.init(f,a.core.json.merge(d,{isFavoritePage:!1})));e.push(a.lib.feed.plugins.media(f,d));e.push(a.lib.feed.plugins.images(f,d));e.push(a.lib.feed.plugins.keywordShield(f,d));e.push(a.lib.feed.plugins.feedShield(f,d));e.push(a.lib.feed.plugins.map(f,d));e.push(a.lib.feed.plugins.like.init(f,d));e.push(a.lib.feed.plugins.deleteFeed(f,d));e.push(a.lib.feed.plugins.page(f,d));e.push(a.lib.feed.plugins.translate(f,d));e.push(a.lib.feed.plugins.tag.init(f,d));e.push(a.lib.feed.plugins.orientGrpMem(f,d));e.push(a.lib.feed.plugins.activityShield(f,d));e.push(a.lib.feed.plugins.lazyload.init(f,d));e.push(a.lib.feed.plugins.feedOnTop(f,d));e.push(a.lib.feed.plugins.jumpurl(f,d));e.push(a.lib.feed.plugins.forward(f,d));e.push(a.lib.feed.plugins.feedViews(f,d));e.push(a.lib.feed.plugins.thirdExpand(f,d));e.push(a.lib.feed.plugins.more(f,d));e.push(a.lib.feed.plugins.rightmenu(f,d));e.push(a.lib.feed.plugins.replyback(f,d));e.push(a.lib.feed.plugins.feedSet(f,d));e.push(a.lib.feed.plugins.adFeed(f,d));e.push(a.lib.feed.plugins.spreadFeed(f,d));e.push(a.lib.feed.plugins.commentMedia(f,d));e.push(a.lib.feed.plugins.cardbg(f,d));var g=function(){for(var a in e)try{e[a].destroy&&e[a].destroy()}catch(b){}f=null};f.destroy=g;return f}});
STK.register("conf.channel.timeBase",function(a){return a.lib.kit.extra.listener.define("conf.channel.timeBase",["setTimeBase"])});
STK.register("pl.content.homeFeed.source.init",function(a){var b=window.$CONFIG||{},c=a.conf.channel.feed,d,e=0,f=function(b){e>0&&b.domid==d&&window.WBEXP&&window.WBEXP.start(a.E(d))},g=function(){FM.unallRenderReady(g);FM.onplViewReady(f)};FM.isOrigPageRenderReady()?FM.onplViewReady(f):FM.onallRenderReady(g);return function(f,g){function p(){a.queryToJson(FM.getURL().query).firstfeed==="1"&&setTimeout(function(){var b=a.sizzle("[action-type=feed_list_item]");a.scrollTo(b[b.length-1],{top:50})},500);FM.unallJsReady(p)}var h={},i=a.delegatedEvent(f),j=a.builder(f).list;j=j&&j.feedconfig&&j.feedconfig[0];var k=j&&j.getAttribute("data-update")=="true",l=a.pl.content.homeFeed.source.feedList(f),m=function(a,b){k&&l.insertFakeFeed(a.html)},n=function(a,b){};c.register("publish",m);c.register("forward",n);var o=function(){if(b.bigpipe=="true"){var c=FM.getURL(),d=a.queryToJson(c.query);d.pids=f.id;FM.setState(c.path+"?"+a.jsonToQuery(d)+"#feedtop")}else setTimeout(function(){window.location.reload()},200)};a.custEvent.define(l,"reload");a.custEvent.add(l,"reload",o);d=f.id;e++;FM.onallJsReady(p);i.add("fl_nextTimeBase","click",function(){a.conf.channel.timeBase.fire("setTimeBase","next")});h.destroy=function(){a.custEvent.remove(l,"reload",o);l&&l.destroy&&l.destroy();i.destroy();c.remove("publish",m);c.remove("forward",n);FM.unallJsReady(p)};return h}});
STK.register("lib.publisher.source.dragImage",function(a){var b=a.lib.kit.extra.language,c='<div class="img_upload" node-type="dragTip" style="display:none;"><b></b><span class="iu-tip"><i class="W_ico12 icon_sw_ipt"></i>#L{æå¨å¾çå°è¿éä¸ä¼ }</span></div>';return function(d){var e={},f=d.nodeList.textEl.parentNode,g,h=[],i=[],j,k={contain:function(b,c){return b==c||a.core.dom.contains(b,c)?!0:!1},deleteInArr:function(a,b){var c=[],d=b.length;for(var e=0;e<d;e++)a!=b[e]&&c.push(b[e]);return c},showTip:function(){if(!j){j=a.builder(b(c)).list.dragTip[0];f.appendChild(j)}j.style.display=""}},l=function(b){if(!!a.inArray("Files",b.dataTransfer.types)){b.preventDefault();var c=b.target;i.push(c);k.showTip()}},m=function(b){if(!!a.inArray("Files",b.dataTransfer.types)){b.preventDefault();var c=b.target;i=k.deleteInArr(c,i);i[0]||(j.style.display="none")}},n={uploading:function(a){g.uploading({data:[{fid:a.fid,name:a.name}]})},uploaded:function(a){g.uploaded({data:{pid:a.pid},fid:a.fid})},error:function(a){var b="fileSizeErr",c="";if(a.code==9){b="singleError";c="A20001"}g.error({type:b,fid:a.fid,data:{sourceData:{code:c}}})}},o=function(a){switch(a){case"image/jpeg":case"image/png":case"image/gif":case"image/bmp":case"image/jpg":return!0;default:return!1}},p=function(b){if(!!a.inArray("Files",b.dataTransfer.types)){b.stopPropagation();b.preventDefault();if(!k.contain(d.nodeList.textElDiv,b.target)&&g&&g.getDomList("box")&&!k.contain(g.getDomList("box"),b.target))return;i=[];j.style.display="none";var c=b.dataTransfer.files;for(var e=0,f;f=c[e];e++){var l=f.type?f.type:"n/a",m=new FileReader;if(o(l)){m.onload=function(b){return function(c){var d=a.getUniqueKey();if(!g.isOutstanding()){h[d]=a.lib.kit.extra.upload({type:"base64",imgName:b.name,base64Str:c.target.result.split(",")[1]});n.uploading({fid:d,name:b.name});a.custEvent.add(h[d],"uploadSucc",function(a,b){var c=b.pid;n.uploaded({fid:d,pid:b.pid})});a.custEvent.add(h[d],"uploadError",function(a,b){n.error({code:b.code,fid:d})})}}}(f);m.readAsDataURL(f)}}}},q=function(b){if(!!a.inArray("Files",b.dataTransfer.types)){if(!k.contain(d.nodeList.textElDiv,b.target)&&g&&g.getDomList("box")&&!k.contain(g.getDomList("box"),b.target)){a.core.dom.removeClassName(d.nodeList.textElDiv,"clicked");return}a.core.dom.addClassName(d.nodeList.textElDiv,"clicked");b.stopPropagation();b.preventDefault()}},r=function(){if(document.body.addEventListener){document.body.addEventListener("dragenter",l,!1);document.body.addEventListener("dragleave",m,!1);document.body.addEventListener("dragover",q,!1);document.body.addEventListener("drop",p,!1)}},s=function(){if(!!d.getPreview){g=d.getPreview();a.custEvent.add(d,"close",function(){g&&g.hide()});r()}},t=function(){if(document.body.removeEventListener){document.body.removeEventListener("dragenter",l,!1);document.body.removeEventListener("dragleave",m,!1);document.body.removeEventListener("dragover",q,!1);document.body.removeEventListener("drop",p,!1)}};s();e.destroy=t;return e}});
STK.register("lib.feed.plugins.timeFeed",function(a){var b=a.conf.channel.feed;return function(c){var d={},e=a.delegatedEvent(c),f=a.conf.trans.feed.feed,g,h=function(b){if(typeof b!="string")a.log("insertFakeFeed feedHtml is not String!");else{var d=a.C("div");d.innerHTML=b;var e=a.sizzle('[node-type="time_feed_item"]',d);e=e[0];var f=a.sizzle('[node-type="time_feed_item"]',c);if(f[0])a.core.dom.insertBefore(e,f[0]);else{listbox=a.sizzle("ul",c)[0]||c;listbox.innerHTML="";a.core.dom.insertElement(listbox,e,"afterbegin")}}};b.register("timeFeedPublish",h);var i=function(a){return!a||a==document.body?!1:a.getAttribute&&a.getAttribute("node-type")=="time_feed_item"?a:arguments.callee(a.parentNode)},j=function(b,c){var d=i(b,c);d.style.height=d.offsetHeight+"px";d.style.overflow="hidden";var e=a.tween(d,{end:function(){d.innerHTML="";a.removeNode(d);c=b=d=null;e.destroy()}}).play({height:0})},k={time_feed_delete:function(b){var d=b.el,e={okCallback:function(){f.request("deleteTimingBlog",{onSuccess:function(){j(d,c)},onFail:function(){},onError:function(b){a.lib.dialog.ioError(b.code,b)}},b.data)},hideCallback:function(){tipOnMid=undefined}};e.msg="ç¡®è®¤è¦å é¤è¿æ¡å¾®ååï¼";e.type="ask";var h=d;g&&g.anihide&&g.anihide();g=a.ui.tipConfirm(e.msg,e).beside(h,{appendTo:document.body}).ok(e.okCallback).cancel(e.hideCallback)}};e.add("time_feed_delete","click",k.time_feed_delete)}});
STK.register("pl.content.homeFeed.source.timeFeed",function(a){return function(b,c){var d={},e=a.sizzle('[node-type="timepublish"]',b);if(e[0]&&(e=e[0]))var f=a.builder(e).list,g=f.textEl[0],h=decodeURIComponent(g.getAttribute("extraUrl")||""),i=a.lib.publisher.publisher({node:e,extraUrl:h,transName:"timingPublish"}),j=a.lib.publisher.source.dragImage(i.editor);var k=a.sizzle('[node-type="feedconfig"]',b);if(k[0]&&(k=k[0])){var f=a.builder(k).list;if(f.textEl)var g=f.textEl[0],h=decodeURIComponent(g.getAttribute("extraUrl")||""),i=a.lib.publisher.publisher({node:k,extraUrl:h}),j=a.lib.publisher.source.dragImage(i.editor)}var l=a.sizzle('[node-type="time_feed_list"]',b);l[0]&&(l=l[0])&&a.lib.feed.plugins.timeFeed(l);d.destroy=function(){j&&j.destroy();i&&i.destroy()};return d}});
FM.register("pl.content.homeFeed.index",function(b,c){var d,e;try{d=a.pl.content.homeFeed.source.timeFeed(a.E(b),{})}catch(f){}e=a.pl.content.homeFeed.source.init(a.E(b),{});return{destroy:function(){e.destroy&&e.destroy();d&&d.destroy&&d.destroy()}}})});
