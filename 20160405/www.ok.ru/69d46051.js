define("OK/utils/utils",["jquery","OK/logger"],function(f,d){var c=f("#hook_Cfg_GwtExperimentsCfg");var h=c?OK.util.parseJSON(c.html()):{};var b=document.getElementById("pointerOverlay");function a(j,l){var k=false;if(b&&OK.css.hasClass(b,"__auto")){k=true;OK.css.removeClass(b,"__auto");}var i=document.elementFromPoint(j,l);if(k){OK.css.addClass(b,"__auto");}return i;}function g(n,k,m){var j=n.split(OK.navigation.SPLITER);for(var l=0;l<j.length;l++){if(m[l]){OK.hookModel.setHookContent(m[l],j[l]);}}}function e(l,j,k,i){var m=f.ajax(l);i.fail(function(){m.abort();});m.done(function(p,r,q){if(p&&q.responseText&&p.length===0&&q.responseText.length!==0){d.error("ajax",r);d.clob("ajax",JSON.stringify({requestData:l,response:q.responseText}));}var o=q.getResponseHeader("TKN");if(o){OK.tkn.set(o);}var n=q.getResponseHeader("Redirect-Location");if(n){j(n);i.reject(q,r,"Redirect");return;}i.resolve(p,r,q);});m.fail(function(n,p,o){if(k>0){e(l,j,--k,i);}else{i.reject(n,p,o);}});return i;}return{ajax:function(j,i,l){if(arguments.length>1){if(typeof arguments[1]!=="function"){l=i;i=undefined;}}l=l||0;i=i||function(n){if(OK.navigation.redirect){OK.navigation.redirect(n);}else{document.location.href=decodeURIComponent(n);}};var m=j.data||{};var k=j.beforeSend;m["gwt.requested"]=window.pageCtx.gwtHash;j.type=j.type||"POST";j.data=m;j.beforeSend=function(o,n){o.setRequestHeader("TKN",OK.tkn.get());if(k){k.apply(this,arguments);}};return e(j,i,l,f.Deferred());},updateBlockModelCallback:function(k,i,l){var j=l.getResponseHeader(OK.navigation.HEADER).split(",");g(k,i,j);},updateBlocks:g,gwtExperimentsCfg:h,encodeHtml:function(i){return f("<div/>").text(i).html();},isElementInViewport:function(i){var j=i.getBoundingClientRect();if(j.top<0||j.left<0||j.bottom>(window.innerHeight||document.documentElement.clientHeight)||j.right>(window.innerWidth||document.documentElement.clientWidth)){return false;}return(i.contains(a(j.left,j.top))||i.contains(a(j.right,j.top))||i.contains(a(j.right,j.bottom))||i.contains(a(j.left,j.bottom)));},isElementPartiallyInViewport:function(m,j){if(!j){return this.isElementInViewport(m);}var n=m.getBoundingClientRect(),i=Math.min(n.bottom,window.innerHeight||document.documentElement.clientHeight)-Math.max(0,n.top),k=Math.min(n.right,window.innerWidth||document.documentElement.clientWidth)-Math.max(0,n.left),l=m.offsetHeight,o=m.offsetWidth;return l*j<=i&&o*j<=k;}};});define("OK/registration/Registration",["jquery","OK/utils/utils"],function(b,a){return{activate:function(f){var j=f.getAttribute("data-modal")==="true",h=j?"m-":"",d=document.getElementById(h+"login-nav"),e=document.getElementById(h+"registrationContentBlock"),g=document.getElementById(h+"loginContentBlock"),c=document.getElementById(h+"enterHeader"),i=document.getElementById(h+"registration");f.getElementsByClassName("js-st.field_fJS")[0].value="on";f.getElementsByClassName("js-field_st.screenSize")[0].value=screen.width+" x "+screen.height;f.getElementsByClassName("js-field_st.browserSize")[0].value=OK.util.getVpHeight();f.getElementsByClassName("js-field_st.flashVer")[0].value=(okFlashVersion||[]).join(".");if(j){OK.loader.use(["OKCustomJs"],function(){OK.Layers.register("registration",function(){OK.hookModel.setHookContent("PopLayer","");},null,false,null,null);});}d.addEventListener("click",function(n){var m=(n.target===c)?g:e,k=(n.target===c)?i:c,l=(n.target===c)?e:g;k.classList.remove("__active");l.classList.add("invisible");n.target.classList.add("__active");m.classList.remove("invisible");OK.historyManager.replaceState(n.target.getAttribute("href"));n.preventDefault();});},activateLoginForm:function(c){b(c).submit(function(f){var d={};b(f.currentTarget).find("input").each(function(){d[this.name]=this.value;});a.ajax({url:f.currentTarget.action,data:d}).done(a.updateBlockModelCallback);return false;});}};});define("OK/capture",["OK/logger"],function(p){var m=document,e,b,q="h-mod",g="href",l="data-module",j="data-activate",d="activate",i="OK/",o=[],f=function(r){var u,s,t;if(r.id&&r.id.indexOf("hook_")===0){s=r.id.substr(5);t=s.substr(0,s.indexOf("_"));if(t!=="Block"){p.success("capture.gwt",t,e);}}u=r.firstChild;while(u){f(u);u=u.nextSibling;}},a=function(v){var t,r,s;try{t=Array.prototype.slice.call(v);}catch(u){s=v.length;if(s>0){t=new Array(s);for(r=0;r<s;r+=1){t[r]=v[r];}}else{t=[];}}return t;},k=function(r){var t=r.getAttribute(j)||d;return function s(v){var u;if(typeof v==="function"){u=new v(r.id);}else{u=v;}u[t](r);o.push(u);};},c=function(t,r){var u,s;r=i+r;u=k(t);if(require.defined(r)){s=require(r);u(s);}else{require([r],u);}},h=function(x){var y,A,r,u,z,v,t,s,w;x=x||m;y=x.getElementsByClassName(q);r=a(y);u=r.length;for(z=0;z<u;z+=1){t=r[z];s=t.getAttribute(l);if(s){c(t,s);}}if(b){A=x.getElementsByTagName("a");r=a(A);u=r.length;for(z=0;z<u;z+=1){t=r[z];w=t.getAttribute(g);if(w){for(v=0;v<b.length;v+=1){s=b[v];if(w&&(w.indexOf("cmd="+s)!==-1)){c(t,s);}}}}}if(e){f(x);}},n=function(r){if(m.readyState==="interactive"||m.readyState==="complete"){h(r);}else{m.addEventListener("DOMContentLoaded",h);}};return{activate:n,activateDocument:function(r,s){b=r;e=s;n();}};});define("OK/registration/Utils",["OK/utils/utils","OK/capture"],function(c,e){var b="data-",f="st.r.",a=document.getElementById("generalErrorHook"),d=a.getAttribute("data-general");a.parentNode.removeChild(a);return{lastSmsTimeCookieName:"_lastSmsForCodeTime",addSubmitHook:function(g,h){g.addEventListener("keyup",function(i){if(i.keyCode==13){h();}});},getAttributesFromHook:function(k,h){if(typeof k==="string"){k=document.getElementById(k);}var l={};for(var j=0;j<k.attributes.length;j++){var g=k.attributes[j];if(g.name.indexOf(b)==0){l[g.name.substring(b.length)]=g.value;}}if(h){k.parentNode.removeChild(k);}return l;},proceed:function(l,g,i){var k={};for(var h in l){k[f+h]=l[h];}var j={data:k,url:"/dk"};j.data["st.cmd"]="anonymMain";j.data.cmd="AnonymRegistration";c.ajax(j).done(function(n,m,o){if(n!=""){g.innerHTML=n;e.activate(g);}}).fail(function(m,o,n){if(n!="Redirect"&&i){i.classList.remove("invisible");i.textContent=d;}});},toggleClass:function(h,g,i){if(i){h.classList.add(g);}else{h.classList.remove(g);}},hideFieldError:function(g,h){if(g){g.classList.remove("form_i__error");}if(h){h.classList.remove("invisible");}},showFieldError:function(i,j,h,g){if(h){h.textContent=g;}if(i){i.classList.add("form_i__error");}if(j){j.classList.add("invisible");}}};});define("OK/registration/enterPhone",["OK/registration/Utils"],function(a){return{activate:function(f){var b=f.parentNode,i=b.getElementsByClassName("js-general-error")[0],c=f.getElementsByClassName("js-country")[0],e=f.getElementsByClassName("js-phone-code")[0],j=f.getElementsByClassName("js-phone")[0],d=f.getElementsByClassName("js-proceed-registration")[0],h=function(){e.textContent=c.value;},g=function(){var k=c.options[c.selectedIndex].getAttribute("data-id"),l={countryId:k,countryCode:c.value,phone:j.value,registrationAction:"ValidatePhoneNumber"};OK.cookie.clearCookie(a.lastSmsTimeCookieName,"/");a.proceed(l,b,i);};c.addEventListener("change",h);c.addEventListener("input",h);d.addEventListener("click",g);e.addEventListener("click",j.focus);a.addSubmitHook(j,g);}};});define("OK/registration/enterCode",["OK/registration/Utils"],function(a){return{activate:function(h){var c=h.parentNode,n=c.getElementsByClassName("js-general-error")[0],k=h.getElementsByClassName("js-back-to-enter-phone")[0],e=h.getElementsByClassName("js-proceed-registration")[0],f=h.getElementsByClassName("js-proceed-registration-container")[0],l=h.getElementsByClassName("js-resend-sms-code")[0],m=h.getElementsByClassName("js-resend-sms-code-disabled")[0],i=h.getElementsByClassName("js-resend-sms-code-container")[0],g=h.getElementsByClassName("js-sms-code")[0],b=m.value,j=function(){var o={smsCode:g.value,registrationAction:"ValidateCode"};a.proceed(o,c,n);},d=function(){var p=parseInt(OK.cookie.readCookie(a.lastSmsTimeCookieName),10),q=Date.now(),r,o;if(!p){p=q;OK.cookie.setCookie(a.lastSmsTimeCookieName,p,1,"/");}r=Math.round((q-p)/1000);m.value=b.replace("%d",20-r);if(r<=20){m.classList.remove("invisible");l.classList.add("invisible");o=window.setInterval(function(){q=Date.now();r=Math.round((q-p)/1000);if(r<=20){m.value=b.replace("%d",20-r);}else{window.clearInterval(o);m.classList.add("invisible");l.classList.remove("invisible");}},300);}else{m.classList.add("invisible");l.classList.remove("invisible");}};l.classList.remove("__disabled");k.addEventListener("click",function(){var o={registrationAction:"BackToEnterPhone"};a.proceed(o,c,n);});e.addEventListener("click",j);a.addSubmitHook(g,function(){if(!f.classList.contains("invisible")){j();}});l.addEventListener("click",function(){var o={registrationAction:"ResendCode"};a.proceed(o,c,n);OK.cookie.clearCookie(a.lastSmsTimeCookieName,"/");d();});g.addEventListener("keyup",function(){var o=(g.value==="");a.toggleClass(f,"invisible",o);a.toggleClass(i,"invisible",!o);});d();}};});define("OK/registration/chooseUser",["OK/registration/Utils"],function(a){return{activate:function(e){var b=e.parentNode,l=b.getElementsByClassName("js-general-error")[0],k=e.getElementsByClassName("js-its-not-me-button")[0],h=b.getElementsByClassName("chooseUserButton"),d=a.getAttributesFromHook(e.getElementsByClassName("js-action-hook")[0],true)["action"],f,c,j=function(n){var m=n.target.getAttribute("data-value"),i={userId:m,registrationAction:"RecoverUser"};a.proceed(i,b,l);},g=function(){var i={registrationAction:d};a.proceed(i,b,l);};if(h){for(f=0,c=h.length;f<c;f++){h[f].addEventListener("click",j);}}k.addEventListener("click",g);}};});define("OK/registration/authorize",["OK/registration/Utils"],function(a){return{activate:function(g){var p=g.parentNode,v=p.getElementsByClassName("js-general-error")[0],m=g.getElementsByClassName("js-proceed")[0],c=g.getElementsByClassName("js-enter-password")[0],t=g.getElementsByClassName("js-enter-login")[0];if(t){var j=a.getAttributesFromHook(g.getElementsByClassName("js-login-restrictions-hook")[0],true),y=new RegExp(j["allowed-symbols-pattern"]),B=j["min-length"],z=g.getElementsByClassName("js-login-hint")[0],l=g.getElementsByClassName("js-login-form")[0],x=g.getElementsByClassName("js-login-error")[0],k=a.getAttributesFromHook(g.getElementsByClassName("js-hook-login-msg")[0],true);var u=function(D){var E=t.value;if(!y.test(E)){a.showFieldError(l,z,x,k["invalid-characters"]);}else{if(!D){if(E==""){a.showFieldError(l,z,x,k.empty);}else{if(E.length<B){a.showFieldError(l,z,x,k["short"]);}else{a.hideFieldError(l,z);return true;}}}else{a.hideFieldError(l,z);return true;}}return false;};t.addEventListener("keyup",function(){u(true);});}var o=a.getAttributesFromHook(g.getElementsByClassName("js-password-restrictions-hook")[0],true);var f=o["min-length"];var n=new RegExp(o["allowed-symbols-pattern"]);var e=new RegExp(o["must-contain-pattern"]);var w=g.getElementsByClassName("js-password-error")[0];var b=g.getElementsByClassName("js-password-form")[0];var s=g.getElementsByClassName("js-password-indicator-container")[0];var C=g.getElementsByClassName("js-password-rate")[0];var d=C.getElementsByClassName("progress-rate_bar");var A=g.getElementsByClassName("js-password-indicator-hint")[0];var r=a.getAttributesFromHook(g.getElementsByClassName("js-hook-pwd-msg")[0],true);var h=function(G,F,E){C.className="progress-rate mt-2x "+G;if(F>0){for(var D=0;D<F;D++){d[D].classList.add("__full");}}if(F<3){for(D=F;D<d.length;D++){d[D].classList.remove("__full");}}a.toggleClass(b,"form_i__error",E);a.toggleClass(A,"reg_error_txt",E);};var i=function(D,E){if(w){a.toggleClass(b,"form_i__error",!E);w.parentNode.removeChild(w);a.toggleClass(s,"invisible",!E);}if(D==""){A.textContent=r.empty;h("",0,E);}else{if(!n.test(D)){h("__weak",3,true);A.textContent=r.invalid;}else{if(D.length<f||!e.test(D)){if(D.length<f&&!e.test(D)){h("__weak",1,true);}else{h("__normal",2,true);}if(D.length<f){A.textContent=r["short"];}else{A.textContent=r["must-contain"];}}else{A.textContent=r.ok;h("__strong",3,false);return true;}}}return false;};c.addEventListener("keyup",function(){i(c.value,true);});var q=function(){var E=true;if(t){E=u();}if(!i(c.value,true)||!E){return;}var D={password:c.value,registrationAction:"Authorize"};if(t){D.login=t.value;}a.proceed(D,p,v);};m.addEventListener("click",q);a.addSubmitHook(c,q);i(c.value,false);}};});define("b/registration",["require","OK/registration/Registration","OK/registration/Utils","OK/registration/enterPhone","OK/registration/enterCode","OK/registration/chooseUser","OK/registration/authorize"],function(a){a("OK/registration/Registration");a("OK/registration/Utils");a("OK/registration/enterPhone");a("OK/registration/enterCode");a("OK/registration/chooseUser");a("OK/registration/authorize");return function(){};});