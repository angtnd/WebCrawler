!function(){function a(a){this.name=a,this.attributes={"class":"",id:""},this.id=null,this.children=[],this.data=null,this.extraData={},this.errorStrategy=P.CONST.ErrorStrategy.REMOVE,this.options={},this.uid="",this.async=!1,this.resource=null,this.outerHtml=null,this.error=null}goog.provide("P.ModuleTree"),goog.require("P.interfaces.IResource"),goog.require("P.logging");var b=P.logging.getLogger("ModuleTree");a.prototype={setAttributes:function(a){this.attributes=a},setId:function(a){this.id=a},addChild:function(a){this.children.push(a)},setData:function(a){this.data=a},setExtraData:function(a){this.extraData=a},setErrorStrategy:function(a){this.errorStrategy=a},setError:function(a){this.error=a},setOptions:function(a){this.options=a},setUid:function(a){this.uid=a},setAsync:function(a){this.async=a},setResource:function(a){this.resource=a},setOuterHtml:function(a){this.outerHtml=a},setChildrenAndOuterHtml:function(c,d){this.children=c,this.outerHtml=a.replacePlaceholders(d,function(a){var d=c[a];if(d){var e=d.outerHtml||"";return d.outerHtml=null,e}return b.warn("child index missing",a),""})}},a.fromPlainObject=function(b){var c=new a(b.name);if("attributes"in b&&c.setAttributes(b.attributes),"id"in b&&c.setId(b.id),"data"in b&&c.setData(b.data),"extraData"in b&&c.setExtraData(b.extraData),"errorStrategy"in b&&c.setErrorStrategy(b.errorStrategy),"options"in b&&c.setOptions(b.options),"uid"in b&&c.setUid(b.uid),"async"in b&&c.setAsync(b.async),"resource"in b&&c.setResource(b.resource),"error"in b){var d=P.Error.fromPlainObject(b.error);c.setError(d)}return _.each(b.children,function(b){var d=a.fromPlainObject(b);c.addChild(d)}),c},a.getModulePlaceholder=function(a){return"<!--placeholder "+a+"-->"};var c=/<!--placeholder (\d+)-->/g;a.replacePlaceholders=function(a,d){return(null===a||void 0===a)&&b.warn("HTML is null or undefined; can't replace placeholders.",a),a.replace(c,function(a,b){var c=b;return d(c)})},P.ModuleTree=a}(),function(){goog.provide("P.moduleTemplate"),goog.provide("P.moduleTemplate.IRenderer"),goog.require("P.interfaces.IResource"),P.moduleTemplate={},P.moduleTemplate.Result=function(){this.outerHtml="",this.childrenModuleRenderOptions=[],this.options={},this.data=null,this.extraData={},this.uid=""},P.moduleTemplate.IRenderer=function(){},P.moduleTemplate.IRenderer.prototype={render:function(){}}}(),function(){goog.provide("P.moduleTemplateNunjucks"),goog.require("P.moduleTemplate"),goog.require("P.experiments"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.ModuleTree"),goog.require("P.user"),goog.require("P.moduleTemplate.IRenderer");var a=P.logging.getLogger("ModuleTemplateNunjucks"),b=function(a){return nunjucks.runtime.markSafe(P.ModuleTree.getModulePlaceholder(a))},c=function(a,b){for(var c in b)"__keywords"!==c&&(a[c]=b[c])},d=function(){this.childrenModuleRenderOptions=[],this.additionalClasses=[],this.additionalAttributes={},this.data=null,this.extraData={},this.tagName=null},e=function(a,b,c,d){this.options=_.extend({},a),this.data=b,this.resource=c,this._result=d,this.module=this.module.bind(this),this.ProxyModule=this.ProxyModule.bind(this),this.tag_name=this.tag_name.bind(this),this.addclass=this.addclass.bind(this),this.attr=this.attr.bind(this),this.extra_data=this.extra_data.bind(this),this._describe=this._describe.bind(this),this._base=this._base.bind(this),this.context=_.extend({},this.context,P.CONTEXT,{is_authenticated:P.currentUser.isAuthenticated()})};e.prototype={context:{experiments:{in_experiment_group:function(a,b,c){var d=c&&c.activate;return P.experiments.instance.inExperimentGroup(a,b,d)},in_experiment_groups:function(a,b,c){var d=c&&c.activate;return P.experiments.instance.inExperimentGroups(a,b,d)},get_group_for_experiment:function(a,b){var c=b&&b.activate;return P.experiments.instance.getGroupForExperiment(a,c)},in_experiment_groups_active_or_triggered:function(a,b){return P.experiments.instance.inExperimentGroupsActiveOrTriggerable(a,b)},in_experiment_group_active_or_triggered:function(a,b){return P.experiments.instance.inExperimentGroupActiveOrTriggerable(a,b)},activate_and_persist_experiment:function(a){P.experiments.instance.activateAndPersistExperiment(a)},add_to_experiment:function(a){P.experiments.instance.addToExperiment(a)}},experiences:{is_placed_experience:function(a,b){return P.ExperienceManager.instance().isPlacedExperience(a,b)},is_placed:function(a){return P.ExperienceManager.instance().isPlaced(a)},get_placed_experience:function(a){return P.ExperienceManager.instance().getPlacedExperienceId(a)},experience_viewed:function(a,b){P.ExperienceManager.instance().viewPlacedExperience(a,b)},experience_completed:function(a,b){P.ExperienceManager.instance().completePlacedExperience(a,b)},trigger_placed_experiences:function(a,b){P.ExperienceManager.instance().triggerPlacedExperienceIds(a,b)}},user:P.currentUser.attributes},get_seo_experiment_group:function(){},create_localized_interest_url:function(a){var b=a.url_name,c="/explore/"+b+"/";if("en-us"===P.CONTEXT.locale.toLowerCase())return c;var d=a.name.replace(" ","-").toLowerCase();return b===d?c:"/explore/"+d+"-"+a.id+"/"},module:function(a,c){c=c||{};var d=P.ModuleRenderOptions.fromPlainObject(c);d.setName(a);var e=this._result.childrenModuleRenderOptions.length;return this._result.childrenModuleRenderOptions.push(d),b(e)},ProxyModule:function(a){var c=P.ModuleRenderOptions.fromPlainObject(a),d=this._result.childrenModuleRenderOptions.length;return this._result.childrenModuleRenderOptions.push(c),b(d)},create_resource:function(a,b){b=b||{};var c=P.resourceFactory.create(a);return c.options=b.options||{},c},tag_name:function(a){this._result.tagName=a},addclass:function(a){this._result.additionalClasses.push(a)},attr:function(a){c(this._result.additionalAttributes,a)},extra_data:function(a){_.extend(this._result.extraData,a)},_describe:function(a){c(this.options,a)},_base:function(b){var c=b.replace(".","-");b||a.warn("moduleName is null or undefined",{options:this.options,data:this.data,resource:this.resource}),this.addclass(c)},Experience:P.Experiences.Experience,Placement:P.Experiences.Placement},P.moduleTemplateNunjucks.Renderer=function(a){this._templateName=a},P.moduleTemplateNunjucks.Renderer.prototype={_getOuterHtml:function(a,b,c,d){var e=b.replace(".","-"),f=["Module",e].concat(d.additionalClasses);f.sort();var g={"class":f.join(" "),id:a};_.extend(g,d.additionalAttributes);var h=d.tagName||"div",i="<"+h;return Object.keys(g).sort().forEach(function(a){var b=g[a];i+=" "+_.escape(a)+'="'+_.escape(b)+'"'}),i+=">",i+=c,i+="</"+h+">"},render:function(a,b,c,f){var g=new d,h=new e(b,c,f,g),i=P.nunjucks.render(this._templateName,h),j=_.uniqueId("m"),k=this._getOuterHtml(j,a,i,g),l=new P.moduleTemplate.Result;return l.outerHtml=k,l.options=h.options,l.childrenModuleRenderOptions=g.childrenModuleRenderOptions,l.data=c,l.extraData=g.extraData,l.uid=j,l}}}(),function(){goog.provide("P.moduleRenderer"),P.moduleRenderer=P.moduleRenderer||{},goog.provide("P.moduleRenderer.IRenderer"),P.moduleRenderer.IRenderer=function(){},P.moduleRenderer.IRenderer.prototype={render:function(){}},goog.provide("P.moduleRendererFactory"),P.moduleRendererFactory=P.moduleRendererFactory||{},P.moduleRendererFactory.RendererConfig,P.moduleRendererFactory.moduleNameToConfig={},P.moduleRendererFactory.RendererType={LOCAL:1,REMOTE:2},P.moduleRendererFactory.getRenderer=function(a,b){var c=P.moduleRendererFactory.moduleNameToConfig[a];if(!c)throw new Error("Missing config for module "+a);return b===P.moduleRendererFactory.RendererType.LOCAL?c.localRenderer:b===P.moduleRendererFactory.RendererType.REMOTE?P.moduleRendererRemote.instance:c.defaultToLocal?c.localRenderer:P.moduleRendererRemote.instance}}(),function(){function a(){return P.loadPromise.then(function(){var a=Pc.templateBundles.map(function(a){return Promise.resolve($.ajax({dataType:"script",cache:!0,url:a}))});return Promise.all(a)})}goog.provide("P.ModuleRendererLocal"),goog.provide("P.templateLoadPromise"),goog.require("P.logging"),goog.require("P.moduleRenderer.IRenderer"),goog.require("P.moduleRendererFactory"),goog.require("P.moduleTemplate"),goog.require("P.ModuleTree"),goog.require("P.loadPromise"),goog.require("P.resourceCache");var b=P.logging.getLogger("ModuleRendererLocal"),c=Pc.lazyLoadTemplates?a():Promise.resolve();P.templateLoadPromise=c;var d=function(a){this._templateRenderer=a};d.prototype={_getData:function(a){var b=a.resource,c=a.module,d=a.data;if(d||!b)return Promise.resolve(d);var e;return b.options.allow_stale&&(e={freshness:P.resourceCache.Freshness.POSSIBLY_STALE_AND_INCOMPLETE}),P.resourceCache.instance.callGet(b,c,e).then(function(a){return a})},_getErrorModuleTree:function(a){var b=new P.ModuleTree(a.name);return b.setOuterHtml('<div class="Module '+a.name+'">error</div>'),Promise.resolve(b)},_getAsyncModuleTree:function(a){var b=new P.ModuleTree(a.name);a.id&&b.setId(a.id),a.options&&b.setOptions(a.options),a.resource&&b.setResource(a.resource),b.uid=_.uniqueId("m");var c=[a.name,"Module","loading"];return c.sort(),b.setChildrenAndOuterHtml([],'<div class="'+c.join(" ")+'" id="'+b.uid+'"></div>'),b.setAsync(a.async),Promise.resolve(b)},_renderModuleTree:function(a,b){var c=a.resource,d=this._templateRenderer.render(a.name,a.options,b,c);if(a.forceRenderLocal)for(var e=0;e<d.childrenModuleRenderOptions.length;e++)d.childrenModuleRenderOptions[e].setForceRenderLocal(!0);var f=d.childrenModuleRenderOptions.map(function(a){if(a.async)return this._getAsyncModuleTree(a);var b;a.forceRenderLocal&&(b=P.moduleRendererFactory.RendererType.LOCAL);var c=P.moduleRendererFactory.getRenderer(a.name,b);return c.render(a)}.bind(this));return Promise.all(f).then(function(b){var c=b,e=new P.ModuleTree(a.name);return a.id&&e.setId(a.id),e.setOptions(d.options),a.resource&&e.setResource(a.resource),e.setData(d.data),e.setExtraData(d.extraData),e.setChildrenAndOuterHtml(c,d.outerHtml),e.setUid(d.uid),e})},render:function(a){return c.then(function(){return this._getData(a)}.bind(this)).then(function(b){return this._renderModuleTree(a,b)}.bind(this)).then(void 0,function(c){switch(b.error(c,"moduleRenderOptions",a),a.errorStrategy){case P.CONST.ErrorStrategy.SHOW:return this._getErrorModuleTree(a);case P.CONST.ErrorStrategy.REMOVE:return null;default:return b.warn("unknown moduleRenderOptions.errorStrategy",a.errorStrategy),null;case P.CONST.ErrorStrategy.BUBBLE:throw c}}.bind(this))}},P.ModuleRendererLocal=d}(),function(){goog.provide("P.moduleRendererRemote"),goog.require("P.moduleRenderer.IRenderer");var a=function(){};a.prototype={render:function(a){var b=a.resource;return b||(b=P.resourceFactory.create(P.Resource.NOOP_RESOURCE.name,P.Resource.NOOP_RESOURCE.options)),b.callGet({showError:!1},a).then(function(b){return a.id&&b.moduleTree.setId(a.id),b.moduleTree})}},P.ModuleRendererRemote=a,P.moduleRendererRemote={},P.moduleRendererRemote.instance=new a}(),function(){"use strict";function a(a,b,c,d){var f=a.$el,g=_.map(b,c);return Promise.all(g).then(function(b){var c=[],g=[];_.each(b,function(a){c=c.concat(a.errors),g=g.concat(a.warnings)});var h={$el:f,errors:c,warnings:g};return a.trigger(e,h),d&&d(h),h})}goog.provide("P.Form"),goog.provide("P.Validator"),goog.require("P.placeholder"),goog.require("P.logging"),goog.require("P.Validator");var b=P.logging.getLogger("Form"),c="hasError",d="hasWarning",e="validated",f="disabled",g="[type=submit]",h=["button","file","image","reset","submit"],i=100,j=["pinterest","password","123456","welcome","ninja","abc123","123456789","12345678","sunshine","princess","qwerty","master","michael","jordan","dragon","soccer","killer","pepper","devil","princess","1234567","iloveyou"],k=function(a,b){this.$el=a,this.rules=b};_.extend(k.prototype,Backbone.Events),_.extend(k.prototype,{validate:function(b){return a(this,this.rules,function(a){return a(this.$el)}.bind(this),b)}}),k.Required=function(a){return function(b,c){var d=b.val(),e=[],f="checkbox"===b.attr("type")&&!b.is(":checked"),g="radio"===b.attr("type")&&!b.is(":checked");if(f||g||!d){var h=a&&a.message?a.message:P._("Required");("userFirstName"===b.attr("id")||"userUserName"===b.attr("id"))&&(h=P._("Missed a spot!")),e.push(h)}var i={$el:b,errors:e,warnings:[]};return c&&c(i),Promise.resolve(i)}},k.Email=function(a){return function(b,c){var d=$.trim(b.val()),e=[];if(d&&!d.match(/.+@.+\..+/gi)){var f=a&&a.message?a.message:P._("Not a valid email.");e.push(f)}var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.Name=function(a){return function(b,c){var d=$.trim(b.val()),e=[];if(!d.match(/^[^0-9].*$/)){var f=a&&a.message?a.message:P._("Not a valid name.");e.push(f)}var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.Age=function(a){return function(b,c){var d=$.trim(b.val()),e=[],f=a&&a.message?a.message:P._("Not a valid age.");""!==d&&d.length<2&&(f=P._("Please enter at least two digits."),e.push(f));var g=Math.floor(d);""===d||/^\d+$/.test(d)&&g>0&&g<300||e.push(f);var h={$el:b,errors:e,warnings:[]};return c&&c(h),Promise.resolve(h)}},k.PhoneNumber=function(a){return function(b,c){var d=$.trim(b.val()),e=d.replace(/[\(\)\+\-\. ]/g,""),f=/^(\(?\+?[0-9]*\)?)?[0-9_\- \.\(\)]*$/g,g=[];if(d&&(!d.match(f)||e.length<7)){var h=a&&a.message?a.message:P._("Not a phone number.");g.push(h)}var i={$el:b,errors:g,warnings:[]};return c&&c(i),Promise.resolve(i)}},k.Number=function(a){return function(b,c){var d=$.trim(b.val()),e=/^\d+$/,f=[];if(d&&!d.match(e)){var g=a&&a.message?a.message:P._("Not a number.");f.push(g)}var h={$el:b,errors:f,warnings:[]};return c&&c(h),Promise.resolve(h)}},k.URL=function(a){return function(b,c){var d=b.val(),e=[];if(d&&!d.match(/^(https?:\/\/){0,1}[a-z0-9_\-]+\..+/gi)){var f=a&&a.message?a.message:P._("Not a valid url.");e.push(f)}var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.Password=function(a){return function(b,c){var d=b.val(),e=[],f=$('[name="username"]'),g={shortPassStr:a&&a.shortPassStr||P._("Too short"),badPassStyle:a&&a.badPassStyle||P._("Not proper style"),samePasswordStr:a&&a.samePasswordStr||P._("Password and username can't match"),blackPassStr:a&&a.blackPassStr||P._("Please try using a stronger password"),goodPassStr:a&&a.goodPassStr||P._("Great!"),userid:f.length?f.val():""},h=$.fn.teststrength(d,g,j);if(h.length){var i=h[h.length-1];if(i){var k=h[0];e.push(k)}}var l={$el:b,errors:e,warnings:[]};return c&&c(l),Promise.resolve(l)}},k.Length=function(a){return function(b,c){var d,e,f=b.val(),g=a.max||1/0,h=a.min||0,i=a.should_trim||!1,j=[];i&&(f=f.trim());var k=f.length;k<h?(d=P.string.format(P._("Please enter at least {{ character_count }} characters."),{character_count:h}),e=a&&a.messages&&a.messages.min?a.messages.min:d,j.push(e)):k>g&&(d=P.string.format(P._("Please enter no more than {{ character_count }} characters."),{character_count:g}),e=a&&a.messages&&a.messages.max?a.messages.max:d,j.push(e));var l={$el:b,errors:j,warnings:[]};return c&&c(l),Promise.resolve(l)}},k.EqualTo=function(a){return function(b,c){var d=b.val(),e=$('[name="'+a.targetFieldName+'"]').val(),f=[];d!==e&&f.push(a.message);var g={$el:b,errors:f,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.GreaterThan=function(a){return function(b,c){var d=$.trim(b.val()),e=[];d.length&&d<=a.value&&e.push(a.message);var f={$el:b,errors:e,warnings:[]};return c&&c(f),Promise.resolve(f)}},k.GreaterThanOrEqualTo=function(a){return function(b,c){var d=$.trim(b.val()),e=[];d.length&&d<a.value&&e.push(a.message);var f={$el:b,errors:e,warnings:[]};return c&&c(f),Promise.resolve(f)}},k.LaterThanOrEqualToDate=function(a){return function(b,c){var d=new Date(b.val()),e=a.date,f=[];!b.is(":disabled")&&e instanceof Date&&d.getTime()&&e.getTime()&&d<e&&f.push(a.message);var g={$el:b,errors:f,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.ContainsOnlyAscii=function(a){return function(b,c){var d=b.val(),e=[],f=/^[\040-\176]*$/.test(d);f||e.push(a.message);var g={$el:b,errors:e,warnings:[]};return c&&c(g),Promise.resolve(g)}},k.CurrencyValue=function(a){return function(b,c){var d=$.trim(b.val()),e=/^\d*(\.\d\d?)?$/,f=[];if(d&&!d.match(e)){var g=a&&a.message?a.message:P._("Not a valid currency value.");f.push(g)}var h={$el:b,errors:f,warnings:[]};return c&&c(h),Promise.resolve(h)}},k.Date=function(a){return function(b,c){var d=$.trim(b.val()),e=[],f=new Date(d);if(d&&!f.getTime()){var g=a&&a.message?a.message:P._("Not a valid date.");e.push(g)}var h={$el:b,errors:e,warnings:[]};return c&&c(h),Promise.resolve(h)}},k.Time=function(a){return function(b,c){var d=$.trim(b.val()),e=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/,f=[];if(d&&!d.match(e)){var g=a&&a.message?a.message:P._("Not a valid time.");f.push(g)}var h={$el:b,errors:f,warnings:[]};return c&&c(h),Promise.resolve(h)}},k.MatchesRegex=function(a){return function(b,c){var d=b.val(),e=[];a.pattern.test(d)||e.push(a.message);var f={$el:b,errors:e,warnings:[]};return c&&c(f),Promise.resolve(f)}},P.Validator=k,P.Form=function(a,c,d){d=d||{},this.$el=a,this.validators={},this.errorFields={},this.warningFields={},this.fastValidateFields={},this.hideErrors=!!d.hideErrors,this.prevalidating=!!d.prevalidate,this.disableAutoValidation=!!d.disableAutoValidation,this.onFieldBlur=this.onFieldBlur.bind(this),this.onFieldChange=this.onFieldChange.bind(this),this.onFieldKeyup=this.onFieldKeyup.bind(this),this.onFieldValidated=this.onFieldValidated.bind(this),this.onSubmit=this.onSubmit.bind(this),_.each(c,function(a,c){var d=this.getField(c);if(d[0]){var f=new P.Validator(d,a);this.validators[c]=f,f.on(e,this.onFieldValidated),d.on("blur",this.onFieldBlur),d.on("change",this.onFieldChange),d.on("keyup",this.onFieldKeyup)}else b.debug(c+" wasn't found in the form")}.bind(this)),this.prevalidating&&this.validate(function(){this.prevalidating=!1}.bind(this)),a.submit(this.onSubmit),a.find("[placeholder]").placeholder()},_.extend(P.Form.prototype,Backbone.Events),_.extend(P.Form.prototype,{validate:function(b){return a(this,this.validators,function(a){return a.validate()},b)},getField:function(a){var b=this.$el.find("[name="+a+"]");return"radio"===b.attr("type")&&(b=this.$el.find("[name="+a+"]:checked")),b},getFieldLabels:function(a){var b=a.attr("id"),c=this.$el.find('label[for="'+b+'"]'),d=a.closest("label",this.$el);return c.add(d)},validateField:function(a,b){var c=a.attr("name");return this.validators[c].validate(b)},getValue:function(a){var b=this.getField(a);return"checkbox"===b.attr("type")?b.is(":checked"):b.val()},getSubmitButtons:function(){return this.$el.find(g)},disableSubmitButtons:function(){this.getSubmitButtons().prop(f,!0).addClass(f)},enableSubmitButtons:function(){this.getSubmitButtons().not(".loading").prop(f,!1).removeClass(f)},hasErrors:function(){return!(!_.find(this.errorFields,function(a){return a})&&!this.$el.find("."+c)[0])},hasWarnings:function(){return!(!_.find(this.warningFields,function(a){return a})&&!this.$el.find("."+d)[0])},setFieldErrorsAndWarnings:function(a,b,e){this.clearFieldErrorAndWarningMessages(a);var f=!!b[0],g=!!e[0];if(this.errorFields[a.attr("name")]=f,this.warningFields[a.attr("name")]=g,!this.prevalidating&&!this.hideErrors){var h=this.getFieldLabels(a),i=h.add(a);i.toggleClass(c,f),i.toggleClass(d,g),this.appendFieldErrorMessages(a,b),this.appendFieldWarningMessages(a,e)}},appendFieldErrorMessages:function(a,b){b&&b.length&&a.parent().children().last().after('<p class="formFieldMessage formErrorMessage">'+b.join(" ")+"</p>")},appendFieldWarningMessages:function(a,b){b&&b.length&&a.parent().children().last().after('<p class="formFieldMessage formWarningMessage">'+b.join(" ")+"</p>")},clearFieldErrorAndWarningMessages:function(a){a.nextAll(".formErrorMessage, .formWarningMessage").remove()},clearAllErrorAndWarning:function(){var a,b=_.keys(this.errorFields),c=_.keys(this.warningFields),d=_.uniq(_.union(b,c));_.each(d,function(b){(this.errorFields[b]||this.warningFields[b])&&(a=this.getField(b),this.setFieldErrorsAndWarnings(a,[],[]))}.bind(this))},enableFastValidateOnField:function(a){this.fastValidateFields[a]=1},onSubmit:function(a){return a.preventDefault(),a.stopPropagation(),this.trigger("submitStarted",this.$el),this.validate(function(a,b){this.trigger(P.CONST.EVENT_SUBMIT_VALIDATED,a,b)}.bind(this))},onFieldValidated:function(a){var b=a.$el,c=a.errors,d=a.warnings;(c[0]||d[0])&&this.enableFastValidateOnField(b.attr("name")),this.setFieldErrorsAndWarnings(b,c,d),this.hasErrors()?this.disableSubmitButtons():this.enableSubmitButtons()},onFieldKeyup:function(a){if(a.keyCode!==P.keyCode.TAB){var b=$(a.target);this.fastValidateFields[b.attr("name")]&&!this.disableAutoValidation&&this.validateField(b)}},onFieldBlur:function(a){if(!this.disableAutoValidation){var b=$(a.target);_.delay(function(){this.validateField(b)}.bind(this),i)}},onFieldChange:function(a){if(!this.disableAutoValidation){var b=$(a.target);this.validateField(b)}},getData:function(a){for(var b,c,d,e,f,g=this.$el.find("input,select,textarea"),i=g.length,j={},k=0;k<i;++k)b=$(g[k]),d=b.attr("name"),void 0===d||!a&&b.is(":disabled")||(c=b.attr("type"),_.contains(h,c)||"radio"===c&&!b.is(":checked")||(e="checkbox"===c?b.is(":checked"):b.val(),_.has(j,d)?(f=j[d],_.isArray(f)||(f=[f],j[d]=f),f.push(e)):j[d]=e));return j}}),P.Errors.wrap(P.Form.prototype,["onSubmit"])}(),function(){goog.provide("P.placeholder");var a=P.logging.getLogger("Placeholder"),b="placeholder",c="placeholder",d="placeholder-visible";if(P.isPlaceholderSupported=b in document.createElement("input"),P.isPlaceholderSupported)jQuery.fn.placeholder=function(){return this};else{var e={initPlaceholder:function(){this.blur(e._onPlaceholderBlur),this.focus(e._onPlaceholderFocus),this.each(function(a,b){e._clearPlaceholder(b),e._setPlaceholder(b)})},_onPlaceholderBlur:function(){e._setPlaceholder(this)},_onPlaceholderFocus:function(){e._clearPlaceholder(this)},_setPlaceholder:function(a){var e=$(a),f=e.val();f||(a[d]=!0,e.addClass(c),a.value=e.attr(b))},_clearPlaceholder:function(a){var b=$(a);a&&a[d]&&(a[d]=!1,b.removeClass(c),a.value="")}};jQuery.fn.placeholder=function(){return e.initPlaceholder.apply(this),this};var f={get:function(a){var c=$(a),e=a[d];return e&&c.attr(b)===a.value?"":a.value},set:function(a,b){var c=$(a);return b&&a[d]?e._clearPlaceholder(a):b||e._setPlaceholder(a),a.value=b,e._setPlaceholder(a),c}};a.debug("Adding hooks on input and textarea for placeholders."),$.valHooks.input=f,$.valHooks.textarea=f,$(document).delegate("form","submit",function(){var a=$("input",this).each(e._clearPlaceholder);window.setTimeout(function(){a.each(e._setPlaceholder)},10)})}}(),function(){goog.provide("P.Module"),goog.provide("P.Module.console"),goog.provide("P.Module.objectHash"),goog.provide("P.Module.window"),goog.require("P.CONST"),goog.require("P.errors"),goog.require("P.Event"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.moduleRenderer"),goog.require("P.ModuleRenderOptions"),goog.require("P.ModuleRenderType"),goog.require("P.navigateData.NavigateData"),goog.require("P.Spinner");var a=300,b="fadeIn",c="fadeOut",d="hideModule",e=b+" "+c,f="loading",g=300,h="moduleMask",i="inModal",j="notNavigatable",k="normalNavigationOnClick",l="savedScrollLeft",m="savedScrollTop",n="data-element-type",o="data-component-type",p="data-aux",q=_.invert(P.CONST.ErrorStrategy),r=0,s=function(a,b,c){var d="other";this.object=a,this.event=b,this.fn=c,this.id="",this.object instanceof P.Module?this.id=this.object.cid:(this.id=d+r,r+=1)};P.Module=function(){},P.Module=Backbone.View.extend({className:"Module",GACategory:null,mixins:[],CssClassName:{},constructor:function(a){Backbone.View.call(this,a),a&&(a.id&&(this.id=a.id),a.options&&this.setOptions(a.options),a.resource&&this.setResource(a.resource),a.data&&(this.data=a.data))},initialize:function(a){this.log=P.logging.getLogger(this.className),this.id=null,this.cid=this.cid||"",this.options={},a&&a.options&&(this.options=a.options),this.resource=null,this.parent=null,this.children=[],this._childrenIdMap={},this._listeners={},this._pubsubHandlers={},this.inDom=!1,this.contentReady=!1,this._html=null,this._pendingRenderRequest=!1,this._optionsDirty=!1,this.extraState={},this._spinner=null,this._$mask=null,this._loadingTimer=null,this.data=null,this.extraData=null,this.model=null,this.modal=null,this.error=null,this.onCreated()},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var a=this.attributes||{};if(!a["class"]){var b=["Module"],c=this.className.replace(/\./g,"-");b.push(c),a["class"]=b.join(" ")}var d=$(document.createElement(this.tagName));d.attr(a),this.setElement(d,!1)}},setAsMainModule:function(a,b,c){return this.errorStrategy=P.CONST.ErrorStrategy.SHOW,this.hasSameOptions(a,b)&&this.contentReady&&!this._forceRefreshRequested(c)?Promise.resolve(void 0):(this.empty(),this._forceRefreshRequested(c)&&(this.extraState={}),this.setOptions(a),this.setResource(b),this.performTransition(c))},getMainModuleNavCategory:function(){return null},_forceRefreshRequested:function(a){return!!(a&&a.evt&&a.evt.data&&a.evt.data.forceRefresh)},performTransition:function(){return this.render()},setResource:function(a){(!a||_.isEqual(a,{}))&&(a=P.Resource.NOOP_RESOURCE),this.resource=P.resourceFactory.create(a.name,a.options)},setOptions:function(a){var b=this.options;this.options=a||{},_.isEqual(b,a)||(this._optionsDirty=!0),this.onOptionsChanged(b,this.options)},updateOptions:function(a){var b=P.valueUtil.deepCopy(this.options),c=_.extend(b,a);this.setOptions(c)},updateDom:P.NOOP,updateOptionsAndDom:function(a){this.updateOptions(a),this.updateDom()},setModal:function(a){this.$el.toggleClass(i,!!a),this.modal!==a&&(this.modal=a,a&&this.onAddedToModal(a))},animateEntranceToModal:P.NOOP,animateExitFromModal:P.NOOP,prependChild:function(a){this.$el.prepend(a.$el),this.addChild(a,0)},appendChild:function(a){this.insertChild(a,this.$el)},insertChild:function(a,b,c,d){d?a.$el.insertAfter(d):a.$el.appendTo(b),this.addChild(a,c)},insertChildBefore:function(a,b,c,d){d?a.$el.insertBefore(d):a.$el.appendTo(b),this.addChild(a,c)},removeChild:function(a){if(a.parent===this){a.parent=null,this._removeListenersOnModule(a),this.children=_.filter(this.children,function(b){return a!==b}),a.id&&delete this._childrenIdMap[a.id];var b=a.getParentElement();a.detachElement(),a.onRemoved(),this.onChildRemoved(a,b)}},getChildByElement:function(a){var b=_.find(this.children,function(b){return b.$el.is(a)});return b},_getDescendantByElement:function(a){if(this.$el.is(a))return this;for(var b=0;b<this.children.length;b++){var c=this.children[b],d=c._getDescendantByElement(a);if(d)return d}return null},getChildByModuleName:function(a){var b=_.find(this.children,function(b){return b.className===a});return b},getChildrenByModuleName:function(a){var b=_.filter(this.children,function(b){return b.className===a});return b},getChildById:function(a){return this._childrenIdMap[a]},getHasError:function(){return!!this.error},removeChildById:function(a){var b=this.getChildById(a);b&&b.remove()},remove:function(){this.parent&&this.parent.removeChild(this)},detachElement:function(){this.remove(),this.$el.detach(),this.inDom&&this._setInDom(!1)},destroy:function(){this.triggerEvent(P.CONST.EVENT_DESTROYED),this.empty(),this.detachElement(),this._removeListeners(),this._subscribers&&_.each(this._subscribers,function(a){a.unsubscribe()}),this.undelegateEvents(),this.destroyed=!0,this.onDestroyed()},destroyIfEmpty:function(){return this.isEmpty()?(this.destroy(),!0):!1},empty:function(){for(this.$el.empty();this.children.length;)this.children[0].destroy();this.children=[],this._childrenIdMap={},this.contentReady=!1,this.onEmpty()},onEmpty:P.NOOP,onRendered:P.NOOP,onContentReady:P.NOOP,onAdded:P.NOOP,onRemoved:P.NOOP,onDestroyed:P.NOOP,onCreated:P.NOOP,onChildAdded:function(){},onChildRemoved:function(){},onChildRendered:P.NOOP,onAddedToDom:P.NOOP,onRemovedFromDom:P.NOOP,onPubSubMessage:function(){},onOptionsChanged:function(){},onAddedToModal:function(){},handleError:function(a){var b=this.getFullName();this.errorStrategy===P.CONST.ErrorStrategy.REMOVE?(this.log.warn("Removing module because of error."),this.destroy()):this.errorStrategy===P.CONST.ErrorStrategy.BUBBLE&&(this.log.warn("Bubbling up the error."),this.parent&&this.parent.handleError(a)),this.log.warn("Error in: "+b+"\nError Strategy: "+q[this.errorStrategy]+"\nStack Trace:"+a.stack_trace+"\nError Object: ",a),this.triggerEvent(P.CONST.EVENT_ERROR,a,this)},getSubscriber:function(a){if(this._subscribers||(this._subscribers={}),!this._subscribers[a]){var b=P.pubsub.createSubscriber(a,{handler:this._handlePubsub,scope:this,name:this.className});this._subscribers[a]=b}return this._subscribers[a]},pubsubSubscribe:function(a,b){var c=this.getSubscriber(a);c.subscribe.apply(c,_.keys(b)),this._pubsubHandlers[a]||(this._pubsubHandlers[a]={}),_.extend(this._pubsubHandlers[a],b)},pubsubUnsubscribe:function(a){var b=_.tail(_.toArray(arguments)),c=this.getSubscriber(a);c.unsubscribe.apply(c,b)},_handlePubsub:function(a,b,c){var d=(this._pubsubHandlers[a]||{})[b];d&&d.call(this,a,b,c),this.onPubSubMessage(a,b,c)},ensureAuthentication:function(){if(!P.currentUser.isAuthenticated()){var a={contextualResource:this.getContextualResource(),authRedirectUrl:this.getAuthRedirectUrl()};return this.triggerEvent(P.CONST.EVENT_REQUIRES_AUTHENTICATION,a,!0),!1}return!0},getAuthRedirectUrl:function(){return P.getRegisterUrl()},getContextualResource:function(){return null},getFullName:function(){for(var a=[this.toString(!0,!0)],b=this;b.parent;)b=b.parent,a.unshift(b.toString());return a.join(">")},toString:function(a,b){var c=this.className,d=[];return a&&this.options&&d.push(P.toScrubbedArgumentString(this.options)),b&&this.resource&&"NoopResource"!==this.resource.name&&d.push("resource="+this.resource.toString()),d=d.length>0?"("+d.join(", ")+")":"",c+d},getHeight:function(a){return a=a||!1,this.$el.outerHeight(a)},getWidth:function(a){return a=a||!1,this.$el.outerWidth(a)},getOffset:function(){return this.$el.offset()},getPosition:function(){return this.$el.position()},getParentElement:function(){return this.$el.parent()},getContent:function(){return this.$el},getScrollableElement:function(){return this.getScrollableElementForElement(this.$el)},getScrollableElementForElement:function(a){var b=this.getOwnedScrollables();if(b.length>0){var c=a;c=c.add(a.parentsUntil(this.$el)),c=c.add(this.$el);var d=c.filter(b);if(d.length>0)return d.last()}return this.parent?this.parent.getScrollableElementForElement(this.$el.parent()):$(window)},listen:function(a,b,c){var d=function(){c.apply(this,_.toArray(arguments))}.bind(this);a.on(b,d);var e=new s(a,b,d);return this._listeners[e.id]||(this._listeners[e.id]=[]),this._listeners[e.id].push(e),e},childListen:function(a,b){return this.listen(this,"child:"+a,b)},delegateEvents:function(){if(!this.__wrapEvents){this.events=this.events||{},this.events["click.logging"]="_logContextEvent",this.events["click.logging ["+n+"]"]="_logContextEvent",this.events["click a"]="_handleLinkClick";var a={};_.each(this.events,function(b,c){a[c]=_.isFunction(b)?P.Errors.wrapFn("eventFunction",b):P.Errors.wrapFn(b,function(){return P.state.activeTarget=this,this[b].apply(this,_.toArray(arguments))}.bind(this))}.bind(this)),this._wrappedLogContextEvent=this.events["click.logging"],this.events=a,this.__wrapEvents=!0}return this.$el.attr(n)||0===this.$el.attr(n)?this.events["click.logging"]=this._wrappedLogContextEvent:delete this.events["click.logging"],Backbone.View.prototype.delegateEvents.call(this)},navigate:function(a,b,c,d){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_NAVIGATE_STARTED);var e=!0,f={url:a,$el:b};c&&(f.forceRefresh=1),_.extend(f,d);var g=new RegExp("/pin/[\\w|-]+/$");if(a){var h=a.match(g);h&&h.index>=0&&P.router.get().getStatus()!==P.Router.NavStatus.READY&&(e=!1)}else e=!1;if(this.triggerEvent(P.CONST.EVENT_NAVIGATE,f,!0)&&e){this.log.debug("Navigate event wasn't prevented. Navigating to:",a);
var i=new P.navigateData.NavigateData;i.evt=new P.Event("",null,f),i.reuseLast=!!f.handled,P.router.get().getHistoryManager().populateNavigateData(i),P.getHistoryNavigator().navigate(a,i)}},showInModal:function(a,b){var c={module:a,showModalOptions:b};this.triggerEvent(P.CONST.EVENT_MODAL,c,!0)},removeListener:function(a){a.object.off(a.event,a.fn),this._listeners[a.id]=_.filter(this._listeners[a.id],function(b){return a!==b})},triggerEvent:function(a,b,c){var d=new P.Event(a,this,b);if(this.trigger(a,d),d.shouldPropagate()&&c){for(var e=new P.Event("child:"+a,this,b),f=this.parent;f&&e.shouldPropagate();)f.trigger.call(f,e.type,e),e.currentTarget=f,f=f.parent;return e.shouldPropagate()}return d.shouldPropagate()},_removeListenersOnModule:function(a){_.each(this._listeners[a.cid],function(a){a.object.off(a.event,a.fn)}),delete this._listeners[a.cid]},showLoading:function(a,b){if(!this.isLoading()){if(a=!!a,b=b||this.$el,this.$el.addClass(f),null===this._spinner){var c=this.getLoadingSpinnerOptions();null===c||void 0!==c.enable&&!c.enable||(this._spinner=new P.Spinner(c),this._spinner.spin(b,this.getLoadingSpinnerClassName()))}a?this.showMask():this.hideMask()}},hideLoading:function(){this.$el.removeClass(f),null!==this._spinner&&(this._spinner.stop(),this._spinner=null),this.hideMask()},isLoading:function(){return this.$el.hasClass(f)},_clearLoadingTimer:function(){this._loadingTimer?(clearTimeout(this._loadingTimer),this._loadingTimer=null):this.hideLoading()},showMask:function(){null===this._$mask&&(this._$mask=$("<div></div>").addClass(h).css({left:0,top:0,width:this.getWidth(),height:this.getHeight()}).prependTo(this.$el))},hideMask:function(){null!==this._$mask&&(this._$mask.remove(),this._$mask=null)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},hideModule:function(){this.$el.addClass(d)},showModule:function(){this.$el.removeClass(d)},fadeIn:function(d){this.$el.removeClass(c).addClass(b);var e=function(){d&&d()};P.setTimeout(e,a)},fadeOut:function(d){this.$el.removeClass(b).addClass(c);var e=function(){d&&d()};P.setTimeout(e,a)},clearFades:function(){this.$el.removeClass(e)},getLoadingSpinnerOptions:function(){return _.extend({enable:!0},this.options.spinner||{})},getLoadingSpinnerClassName:function(){return null},render:function(){return this._renderInternal(!1)},renderExistingData:function(){return this._renderInternal(!0)},_renderInternal:function(a){var b=this.getParentElement();return 0===b.length&&(b=$(document.body)),this._render(b,a)},renderAdditional:function(a){if(!this.contentReady||this._pendingRenderAdditionalRequest||this.resource.atEnd())return Promise.resolve(void 0);var b=this._fetch(a,!1);return this._pendingRenderAdditionalRequest=!0,b.fin(function(){this._pendingRenderAdditionalRequest=!1,this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this)),b},renderAbort:function(){return this._pendingRenderRequest?(this.resource?this.resource.abort():this._pendingRenderRequest=!1,!0):!1},insertAfterModule:function(a,b){a.insertAfter(b.$el)},appendToElement:function(a){a.append(this.$el)},_render:function(a,b){if(this._pendingRenderRequest){if(!this._optionsDirty)return Promise.reject(new Error("render already in progress"));this.renderAbort()}this._pendingRenderAdditionalRequest&&this.resource.abort(),this._clearLoadingTimer(),this._loadingTimer=P.setTimeout(function(){this.showLoading(),this._loadingTimer=null}.bind(this),g,"_render Loading"),this._pendingRenderRequest=!0;var c=this._fetch(P.ModuleRenderType.NORMAL,b).then(function(){this._optionsDirty=!1,this.onRendered(),this.parent&&this.parent.onChildRendered(this),this.triggerEvent(P.CONST.EVENT_CONTENT_CHANGED,null,!0)}.bind(this)).fin(function(){this._pendingRenderRequest=!1,this._clearLoadingTimer()}.bind(this));return c},_fetch:function(a,b){a!==P.ModuleRenderType.PREPEND&&a!==P.ModuleRenderType.APPEND&&this.resource&&this.resource.resetBookmark();var c=new P.ModuleRenderOptions(this.className);if(c.setOptions(this.options),b){var d=this.model?this.model.getData():this.data;c.setData(d)}c.setResource(this.resource),c.setRenderType(a),c.setErrorStrategy(this.errorStrategy),c.setModule(this);var e;this.options.force_render_local||P.experiments.instance.inExperimentGroup("web_force_render_local","employees")?(e=P.moduleRendererFactory.RendererType.LOCAL,c.setForceRenderLocal(!0)):this.options.force_render_remote&&(e=P.moduleRendererFactory.RendererType.REMOTE);var f=P.moduleRendererFactory.getRenderer(this.className,e);return f.render(c).then(function(b){return this.loadFromModuleTree(b,a)}.bind(this),function(a){return this.error=a,this.handleError(a),Promise.reject(a)}.bind(this))},loadFromModuleTree:function(a,b){var c=a.outerHtml,d=c?$(c):this.$el;if(b=b||P.ModuleRenderType.NORMAL,d&&b!==P.ModuleRenderType.APPEND&&b!==P.ModuleRenderType.PREPEND&&(this.contentReady=!1),a.id&&(this.id=a.id),a.data&&(this.data=a.data),a.extraData&&(this.extraData=a.extraData),a.options&&this.setOptions(a.options),a.resource&&(!a.error||b===P.ModuleRenderType.APPEND&&b===P.ModuleRenderType.PREPEND)&&this.setResource(a.resource),this.data&&this.resource&&(this.model=P.resourceCache.instance.ensureModel(this.resource,this.data)),b===P.ModuleRenderType.APPEND)d.children().appendTo(this.$el);else if(b===P.ModuleRenderType.PREPEND)d.children().prependTo(this.$el);else{var e=d.attr("id"),f=e&&!!document.getElementById(e),g=!this.inDom&&f;this.inDom=this.inDom||f,this._replaceElement(d),this.$el.removeAttr("id"),g&&this.onAddedToDom()}if(_.isUndefined(a.errorStrategy)||null===a.errorStrategy||(this.errorStrategy=a.errorStrategy),this.error=a.error,a.error)return this.handleError(a.error),Promise.resolve();if(a.async)return P.Module.allowAsyncRender&&this.render(),Promise.resolve();var h=a.children.map(function(a){return a?P.moduleFactory.create(a,this.$el,this):null}.bind(this));return Promise.all(h).then(function(){d&&b!==P.ModuleRenderType.APPEND&&b!==P.ModuleRenderType.PREPEND&&(this.contentReady=!0,this.onContentReady())}.bind(this),function(a){throw this.handleError(a),a}.bind(this))},addChild:function(a,b){var c="undefined"===typeof b&&-1||b;a.parent!==this&&(a.parent&&a.remove(),a.parent=this,-1===c?this.children.push(a):this.children.splice(c,0,a),a.id&&(this._childrenIdMap[a.id]=a),a.onAdded(),this.onChildAdded(a,b),this.inDom&&a._setInDom(!0))},isEmpty:function(){return!this.$el.html().trim()&&!this.children.length},isInModal:function(){return!!this.modal},isElement:function(a){return this.$el.get(0)===$(a).get(0)},loadFromData:function(){this.log.error("override method loadFromData")},hasSameOptions:function(a,b){var c=this.hasSameModuleOptions(a),d=this.hasSameResourceOptions(b);return this.log.debug("has same options? ",c,this.options,a,d,!this.resource||this.resource.options,b),c&&d},hasSameModuleOptions:function(a){return a=a||{},_.isEqual(this.options,a)},hasSameResourceOptions:function(a){(!a||_.isEqual(a,{}))&&(a=P.Resource.NOOP_RESOURCE);var b=!this.resource&&_.isEqual(a,P.Resource.NOOP_RESOURCE);return b||this.resource&&this.resource.isEqual(a)},setChildId:function(a,b){a.parent===this&&(this.removeChildId(a),a.id=b,this._childrenIdMap[a.id]=a)},removeChildId:function(a){a.id&&a.parent===this&&(delete this._childrenIdMap[a.id],delete a.id)},getOwnedScrollables:function(){return $()},saveExtraState:function(a){if(a){var b=this.getScrollableElement().scrollTop();this.extraState={scrollableElementScrollTop:b}}this.getOwnedScrollables().each(function(a,b){var c=$(b),d=c.scrollTop(),e=c.scrollLeft();c.data(m,d),c.data(l,e)}),_.each(this.children,function(a){a.saveExtraState(!1)})},restoreExtraState:function(a){if(a){var b=this.extraState.scrollableElementScrollTop||0;this.getScrollableElement().scrollTop(b)}var c=this.getOwnedScrollables();c.length&&P.deferDomManipulation(function(){c.each(function(a,b){var c=$(b),d=c.data(m),e=c.data(l);void 0!==d&&c.scrollTop(d),void 0!==e&&c.scrollLeft(e)})}),_.each(this.children,function(a){a.restoreExtraState(!1)})},_setInDom:function(a){this.inDom!==a&&(this.inDom=a,a?this.onAddedToDom():this.onRemovedFromDom(),_.each(this.children,function(b){b._setInDom(a)}))},_replaceElement:function(a){a[0]!==this.$el[0]&&(this.empty(),this.undelegateEvents(),a.insertBefore(this.$el),this.$el.remove(),this.$el=a,this.el=a[0],this.delegateEvents())},_removeListeners:function(){_.each(this._listeners,function(a){_.each(a,function(a){a.object.off(a.event,a.fn)})}),this._listeners={}},_handleLinkClick:function(a){this._logContextEvent(a);var b=$(a.currentTarget),c=$(a.target),d=b.attr("href"),e=!c.hasClass(j)&&!b.hasClass(j),f=b.hasClass(k),g=b.hasClass("external"),h=c.attr("data-ga");if(h&&P.trackGAEvent(h,P.CONST.GA_ACTION_CLICK),f)return!0;if(!e)return!1;if(g)return P.changeWindowLocation(d,!0),this.triggerEvent(P.CONST.EVENT_EXTERNAL_CLICK,null,!0),!1;if(P.isOffsiteUrl(d)||!(a.which>1||a.metaKey||a.ctrlKey||a.shiftKey||a.altKey)){var i=d&&d.length&&"#"!==d.charAt(0)&&!P.beginsWith(d,"javascript:")&&!P.beginsWith(d,"mailto:");return i?(this.navigate(d,c,!!b.attr("data-force-refresh")),!1):void 0}},_logContextEvent:function(a){this._logContextEventFromElem($(a.target),a)},_logContextEventFromElem:function(a,b){if(!b||!P.ContextLogger.getInstance().eventLogged(b)){var c=P.ContextLogging.EventType.CLICK,d=a.closest("["+n+"]",this.$el),e=d.parent().closest("["+o+"]");if(0!==d.length&&0!==e.length){var f=d.attr(p)||"{}",g=P.ContextEvent.fromEventType(c),h=parseInt(d.attr(n),10),i=parseInt(e.attr(o),10),j=JSON.parse(f);g.setElement(h),g.setComponent(i),g.updateAuxData(j);var k=this.getModuleAdditionalAuxData();k&&g.updateAuxData(k);var l=this.getLoggingObjectIdStr();l&&g.setObjectIdStr(l),P.ContextLogger.getInstance().addEvent(g,b)}}},_logCustomContextEvent:function(a,b,c,d){var e=P.ContextEvent.fromEventType(a);e.setElement(b),e.setComponent(c),e.updateAuxData(d),P.ContextLogger.getInstance().addEvent(e,null)},getDebugInfo:function(){return this.className},getGridIndex:function(){return this.data&&"grid_index"in this.data?this.data.grid_index:null},getModuleAdditionalAuxData:function(){var a=this.getGridIndex();return _.isNumber(a)?{grid_index:a}:null},getLoggingObjectIdStr:function(){return null},focus:function(){this.$el.focusWithoutScrolling()},getChildInfoByModuleName:function(a){function b(a){return a.data}for(var c=[],d=this,e=null;d;){if(e=d.getChildByModuleName(a))return{resource:e.resource,data:e.children.map(b)};c=c.concat(d.children),d=c.shift()}},initScroll:P.NOOP}),P.Errors.wrap(P.Module.prototype,["loadFromModuleTree","render","renderExistingData"]);var t=P.Module.extend;P.Module.extend=function(a,b){return a&&a.mixins&&_.extend.apply(_,[a].concat(a.mixins)),t.call(this,a,b)},P.Module.console=null,P.Module.window=null,P.Module.allowAsyncRender=!0}(),function(){goog.provide("P.integrationTesting"),goog.require("P.Module");var a=function(){};a.prototype.getChildrenByModuleName=function(a,b){var c=[];return _.each(a.children,function(a){a.className===b&&c.push(a),c=c.concat(this.getChildrenByModuleName(a,b))}.bind(this)),c},a.prototype.getParentsForModule=function(a){for(var b=[];a.parent;)a=a.parent,b.push(a);return b},a.prototype.getElementsForModules=function(a){return a?_.isArray(a)?_.map(a,function(a){return a.$el.get()}):[a.$el.get()]:[]},P.integrationTesting.getHelper=function(){return new a}}(),function(){goog.provide("P.tutorialManager"),goog.require("P.CONST"),goog.require("P.Event"),goog.require("P.interfaces.ModalTutorialStep"),goog.require("P.interfaces.TutorialStep"),goog.require("P.logging"),goog.require("P.navigateData.NavigateData");var a=P.logging.getLogger("TutorialManager"),b=function(a,b){this.url=a,this.forceRefresh=!!b};P.TutorialManager=function(){this.TUTORIAL_CONFIG={testTutorial:{stepNames:[],nextUrlInfo:function(){return new b(null,!1)},canExit:!1,onUserExit:P.NOOP},newUserBastilleMaleSteps:{stepNames:["NewUserInterestPicker","NewUserFindFriends","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},onUserExit:P.NOOP},newUserBastilleNonMaleSteps:{stepNames:["NewUserInterestPicker","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},newUserExtensionMaleSteps:{stepNames:["NewUserInterestPicker","NewUserFindFriends","NewUserInstallExtension","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.get("is_partner")?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},newUserExtensionNonMaleSteps:{stepNames:["NewUserInterestPicker","NewUserInstallExtension","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.get("is_partner")?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},jpUserAutofollowSteps:{stepNames:["InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!0}}},nextUrlInfo:function(){return P.currentUser.attributes.is_partner?new b("/business/getstarted/",!0):new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},rebuildHomeFeedSteps:{stepNames:["NewUserInterestPicker","InitializeHomeFeedSpinner"],expiredSteps:{},canExit:!1,stepExtraData:{InitializeHomeFeedSpinner:{moduleName:"BuildingHomeFeedSpinner",options:{is_nux:!1}}},nextUrlInfo:function(){return new b("/?allow_nux=no",!0)},onUserExit:P.NOOP},interestsNuxMweb:{stepNames:["NewUserWelcome","NewUserInterestPicker","NewUserSetupSpinner"],expiredSteps:{},canExit:!1,nextUrlInfo:function(){return new b("/",!0)},onUserExit:P.NOOP},profileFollow:{stepNames:["ProfileFollowOne","ProfileFollowTwo","ProfileFollowThree","ProfileFollowFour"],stepExtraData:{ProfileFollowOne:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("Like this user's boards? Follow your favorites to see their new Pins in your home feed"),zoomed_in:!0,step_type:P.CONST.StepTypes.BEGINNING,stacked_group:1}},ProfileFollowTwo:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("For example, Liz followed Samâs art and DIY boards"),zoomed_in:!0,step_type:P.CONST.StepTypes.CONTINUE,stacked_group:1},backgroundImage:"styleBoard"},ProfileFollowThree:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("When Sam adds Pins to them, Liz sees them in her home feed"),zoomed_in:!0,step_type:P.CONST.StepTypes.CONTINUE,stacked_group:1},backgroundImage:"keithProfile"},ProfileFollowFour:{moduleName:"UserEducationGuideStepBase",options:{body_html:P._("You can always unfollow boards later if you change your mind"),zoomed_in:!0,step_type:P.CONST.StepTypes.END,stacked_group:1}}},expiredSteps:{},canExit:!1,nextUrlInfo:function(){return new b(null,!1)},onUserExit:P.NOOP}},this.init()},P.TutorialManager.prototype={init:function(){this._isActive=!1,this.moduleContainer=null,this.renderModule=!0,this.progressModule=null,$("body").removeClass(this.tutorialClassName),this.tutorialName=null,this.tutorialClassName=null,this.tutorial=null,this.allStepNames=null,this.numTotalSteps=null,this.currentStep=null,this.isZoomedIn=!1},startTutorial:function(a,b){if(b=b||{},this.isTutorialActive())return Promise.reject(new Error("another tutorial is already active"));var c=this.TUTORIAL_CONFIG[a];return c?(this.moduleContainer=b.moduleContainer,this.renderModule=b.renderModule,this.progressModule=b.progressModule||this.progressModule,this._isActive?(this.renderModule===!1||this.currentModule||this._loadModuleForStep(this.currentStep),Promise.resolve()):(this._start(a,!0),Promise.resolve())):Promise.reject(new Error("tutorial config does not exist"))},setProgressModule:function(a){this.progressModule!==a&&(this.progressModule=a,this.progressModule.listen(this.progressModule,P.CONST.EVENT_NEXT,this._next.bind(this)),this.progressModule.listen(this.progressModule,P.CONST.EVENT_PREVIOUS,this._previous.bind(this)),this._updateProgressModuleStep())},stopTutorial:function(){this._isActive&&this.init()},resumeTutorial:function(){if(!this.isTutorialActive()){var a=this._getStoredData();a&&a.name&&this._start(a.name,!1)}},_start:function(a,b){var c=this.TUTORIAL_CONFIG[a];c&&(this._clear(b),this._isActive=!0,this.tutorialName=a,this.tutorialClassName=this.tutorialName+P.CONST.TUTORIAL_POSTFIX,$("body").addClass(this.tutorialClassName),this.tutorial=c,this.expiredSteps=this.tutorial.expiredSteps,this.allStepNames=this.tutorial.stepNames,this.numTotalSteps=this.tutorial.stepNames.length,this._funnelPrefix="tutorial_"+a,this.renderModule=this.renderModule===!1?!1:!0,(this.moduleContainer||!this.renderModule)&&this._setStep(this._getStoredStep()||this.allStepNames[0]))},isRunningTutorial:function(){return this._isActive},isTutorialActive:function(){return P.TutorialManager.instance().isRunningTutorial()||P.ExperienceTutorialManager.instance().isRunningTutorial()},_next:function(){var a=this._getStepIndex(this.currentStep);return this.currentStep===_.last(this.allStepNames)?void this._endTutorial(!0):void this._setStep(this.allStepNames[a+1])},_previous:function(){var a=this._getStepIndex(this.currentStep);return 0===a?(P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.LOG,P.logToServer.HTTP_METHOD.GET,{type:"tutorial",tutorial:this.tutorialName,step:this.currentStep,step_number:a,action:"exit"}),this.tutorial.onUserExit(a),void this._endTutorial(!1)):void this._setStep(this.allStepNames[a-1])},_dismiss:function(){this._endTutorial(!1)},_endTutorial:function(a){var b=function(){var b=this.tutorial.nextUrlInfo().url,c=this.tutorial.nextUrlInfo().forceRefresh;if(this._clear(!0),a&&b){var d=new P.navigateData.NavigateData;c&&(d.evt=new P.Event("",null,{forceRefresh:1})),P.getHistoryNavigator().navigate(b,d)}}.bind(this),c=function(){return this.progressModule?this.progressModule.endMandatoryFlow().then(function(){this.progressModule&&this.progressModule.remove();var a=P.app;a.updateNavigationBar()}.bind(this)):Promise.resolve()}.bind(this),d=function(){var b;if(this.currentModule){var c=a?this.currentModule.completePlacedExperience():this.currentModule.dismissPlacedExperience();b=c.fin(function(){return new Promise(function(a){this.currentModule.onExit(a)}.bind(this))}.bind(this)),this.currentModule.onTutorialComplete()}else b=Promise.resolve();return b}.bind(this);d().then(c).then(b),a&&P.trackRegisterAction(this._funnelPrefix+"_complete")},_setStep:function(b){return P.trackRegisterAction(this._funnelPrefix+"_"+b),a.debug("set step from",this.currentStep,"to",b),b!==this.currentStep?(_.contains(this.allStepNames,b)||this.expiredSteps[b]||this._endTutorial(!0),this.expiredSteps[b]&&(b=this.expiredSteps[b]),this.currentStep=b,this._saveCurrentStep(),this.currentModule?void this.currentModule.onExit(function(){this.currentModule.onRemoved(),this._loadModuleForStep(b)}.bind(this)):void(this.renderModule&&this._loadModuleForStep(this.currentStep))):void 0},_setNextStepClass:function(a){var b=$("body"),c=null,d=this._getStepIndex(a);d>0&&(c=this.allStepNames[d-1],b.removeClass(c+P.CONST.TUTORIAL_STEP_POSTFIX)),b.addClass(a+P.CONST.TUTORIAL_STEP_POSTFIX)},_updateProgressModuleStep:function(){if(this.currentStep){var a=this._getStepIndex(this.currentStep);this._setNextStepClass(this.currentStep),this.progressModule&&this.progressModule.nextStep(a+1)}},_loadModuleForStep:function(a){this.renderStepModule(a)},renderStepModule:function(a){var b=this.getModuleArgs(a);a=a?a:this.tutorial.stepNames[0],P.loadModule(b).then(function(a){var b=this.currentModule;this.currentModule=a;var c=a;c.onEnter(function(){this._renderStepModule(a,b)}.bind(this))}.bind(this))},_renderStepModule:function(a){a.render().then(function(){var b=this.moduleContainer.children[0];this.moduleContainer.prependChild(a),b&&b.destroy(),a.onShow(this._updateProgressModuleStep())}.bind(this))},getModuleArgs:function(a){var b=a,c={tutorial_name:this.tutorialName,current_step:this._getStepIndex(a),total_steps:this.numTotalSteps,can_exit:this.tutorial.canExit};return this.tutorial.stepExtraData&&this.tutorial.stepExtraData[a]&&(b=this.tutorial.stepExtraData[a].moduleName,$.extend(c,this.tutorial.stepExtraData[a].options||{})),{name:b,options:c}},_getStepIndex:function(a){var b=_.indexOf(this.allStepNames,a);return-1!==b?b:0},_getStoredStep:function(){var a=this._getStoredData();return a&&a.name!==this.tutorialName&&(this._clearStoredData(),a=null),a&&a.step||null},_getStoredData:function(){var a=P.SessionStorage.getItem(P.CONST.TUTORIAL_SESSION_KEY);return a&&a.experienceTutorial?null:a},_saveCurrentStep:function(){P.SessionStorage.setItem(P.CONST.TUTORIAL_SESSION_KEY,{name:this.tutorialName,step:this.currentStep,experienceTutorial:!1})},_clear:function(a){this.tutorial&&(this.stopTutorial(),a&&this._clearStoredData())},_clearStoredData:function(){P.SessionStorage.removeItem(P.CONST.TUTORIAL_SESSION_KEY)}};var c=null;P.TutorialManager.instance=function(){return c||(c=new P.TutorialManager),c}}(),function(){goog.provide("P.experienceTutorialManager"),goog.require("P.CONST"),goog.require("P.Event"),goog.require("P.logging"),goog.require("P.navigateData.NavigateData");var a=P.logging.getLogger("ExperienceTutorialManager");P.ExperienceTutorialManager=function(a){this.TUTORIAL_MAP={},this.TUTORIAL_MAP[P.Experiences.ExperienceType.NOOP]=P.ExperienceTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.GUIDE]=P.UserEducationGuideTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.NUX]=P.NuxModalTutorial,this.TUTORIAL_MAP[P.Experiences.ExperienceType.TOOLTIP]=P.ModalTutorial,this._tutorialManager=a,this.init()},P.ExperienceTutorialManager.prototype={init:function(){this._isActive=!1,this.experience=null,this.tutorial=null,this.currentStep=0,this.steps=null},startTutorial:function(a){if(this._tutorialManager.isTutorialActive())return Promise.reject(new Error("another tutorial is already active"));var b=this._getStoredData();return!b||a&&b.experience.id!==a.id||(a=b.experience,this.currentStep=b.step),a&&void 0!==a.type&&_.has(this.TUTORIAL_MAP,a.type)?(this._isActive=!0,this.experience=a,this.tutorial=new this.TUTORIAL_MAP[this.experience.type](this.experience,this),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_GO_TO_STEP,function(a,b,c){this._setStep(c)}.bind(this)),this.tutorial.onStart().then(function(){this.steps=this.experience.display_data.steps,this._funnelPrefix="tutorial_"+this.experience.id,this._setStep(this.currentStep)}.bind(this),function(){this._isActive=!1,Promise.reject(new Error("failed to start tutorial"))}.bind(this))):Promise.reject(new Error("invalid placedExperience or no placedExperience to be resumed"))},_next:function(){return this.currentStep>=this.steps.length-1?void this._endTutorial(!0):void this._setStep(this.currentStep+1)},_previous:function(){return this.currentStep<=0?void this._endTutorial(!1):void this._setStep(this.currentStep-1)},_dismiss:function(){this._endTutorial(!1)},_endTutorial:function(a){var b=function(){var b=this.experience.display_data.nextUrlInfo,c=b?b.url:null,d=b?b.forceRefresh:!1,e=b?b.forceFullPageRefresh:!1;if(this.clearStoredData(),this.init(),a&&c){var f=new P.navigateData.NavigateData;e?P.changeWindowLocation(c):d&&(f.evt=new P.Event("",null,{forceRefresh:1})),P.getHistoryNavigator().navigate(c,f)}}.bind(this),c=a?this.tutorial.completePlacedExperience():this.tutorial.dismissPlacedExperience();return a&&P.trackRegisterAction(this._funnelPrefix+"_complete"),c.fin(this.tutorial.onExit.bind(this.tutorial)).then(b)},_setStep:function(b){return a.debug("set step from",this.currentStep,"to",b),P.trackRegisterAction(this._funnelPrefix+"_step"+b),b<0||b>=this.steps.length?(this._endTutorial(!0),Promise.reject(new Error("step is out of range"))):(this.currentStep=b,this._saveCurrentStep(),this.tutorial.nextStep(b))},isRunningTutorial:function(){return this._isActive},setTutorialActive:function(a){this._isActive=a},_getStoredData:function(){var a=P.SessionStorage.getItem(P.CONST.TUTORIAL_SESSION_KEY);return a&&a.experienceTutorial?a:null},_saveCurrentStep:function(){P.SessionStorage.setItem(P.CONST.TUTORIAL_SESSION_KEY,{experience:this.experience,step:this.currentStep,experienceTutorial:!0})},clearStoredData:function(){P.SessionStorage.removeItem(P.CONST.TUTORIAL_SESSION_KEY)}};var b=null;P.ExperienceTutorialManager.instance=function(){return b||(b=new P.ExperienceTutorialManager(P.TutorialManager.instance())),b}}(),function(){goog.provide("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.TutorialStep"),P.ExperienceTutorial=function(a,b){this.placedExperience=a,this.displayData=this.placedExperience.display_data,this.tutorialManager=b},P.ExperienceTutorial.prototype={onStart:function(){return new Promise(function(a){a(void 0)})},nextStep:function(a){return new Promise(function(b,c){(a<0||a>=this.displayData.steps.length)&&c(new Error("stepNumber out of range")),this._removeStepModule().then(function(){this.loadStepModule(a),b(void 0)}.bind(this))}.bind(this))},loadStepModule:function(a){var b=this.getModuleArgs(a);P.loadModule(b).then(function(a){var b=this.currentModule;this.currentModule=a;var c=a;c.onEnter(function(){this.renderStepModule(a,b)}.bind(this))}.bind(this))},renderStepModule:function(){},_removeStepModule:function(){var a=this.currentModule;return new Promise(function(b){a&&a.onExit(function(){a.onRemoved()}),b(void 0)})},getModuleArgs:function(a){var b=this.displayData.steps,c=b[a].moduleName,d={tutorial_name:this.displayData.tutorialName,current_step:a,total_steps:b.length,can_exit:this.displayData.can_exit||!1,experienceID:this.placedExperience.experience_id,placementID:this.placedExperience.placement_id};return $.extend(d,b[a].options),{name:c,options:d}},onExit:function(){return this._removeStepModule().then(function(){return this.currentModule&&this.currentModule.destroy(),Promise.resolve()}.bind(this))},dismissTutorial:function(){this.tutorialManager&&this.tutorialManager.isRunningTutorial()&&this.tutorialManager._dismiss()},completePlacedExperience:function(){return this.currentModule?this.currentModule.completePlacedExperience():Promise.resolve()},dismissPlacedExperience:function(){return this.currentModule?this.currentModule.dismissPlacedExperience():Promise.resolve()}}}(),function(){goog.provide("P.ModalTutorial"),goog.require("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.ModalTutorialStep"),P.ModalTutorial=function(a,b){P.ExperienceTutorial.call(this,a,b),this.modal=null},P.ModalTutorial.prototype=Object.create(P.ExperienceTutorial.prototype),P.ModalTutorial.prototype.onStart=function(){return new Promise(function(a,b){return this.displayData.anchor&&!this._isOnScreen($(this.displayData.anchor))?(P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_WINDOW_SCROLL_CHANGE,function(){this._isOnScreen($(this.displayData.anchor))&&P.ExperienceTutorialManager.instance().startTutorial(this.placedExperience).then(function(){P.ExperienceManager.instance().viewPlacedExperience(this.placedExperience.placement_id,this.placedExperience.experience_id)}.bind(this))}.bind(this)),void b(new Error("Highlighted element is not on screen."))):void a(void 0)}.bind(this))},P.ModalTutorial.prototype.onExit=function(){this.modal&&(this.modal.destroy(),this.modal=null),P.ExperienceTutorial.prototype.onExit.call(this)},P.ModalTutorial.prototype._ensureModal=function(){if(this.modal)return Promise.resolve();var a=(this.displayData.modalStyle+" "||"")+P.currentUser.attributes.gender,b={name:"Modal",options:{mask_type:"dark",can_dismiss:!1,modal_style:a}};return P.loadModule(b).then(function(a){return a.render().then(function(){this.modal=a,this.modal.childListen(P.CONST.EVENT_NEXT,this.tutorialManager._next.bind(this.tutorialManager)),this.modal.childListen(P.CONST.EVENT_PREVIOUS,this.tutorialManager._previous.bind(this.tutorialManager)),P.getModalManager().showModal(this.modal,null)}.bind(this))}.bind(this))},P.ModalTutorial.prototype.renderStepModule=function(a,b){this._ensureModal().then(function(){this.modal.setSubmodule(a).then(function(){var c=a;b&&b.destroy(),_.isUndefined(c.setModalPosition)||c.setModalPosition(),c.onShow()})}.bind(this))},P.ModalTutorial.prototype._isOnScreen=function(a){if(a.length){var b=$(window),c=b.scrollTop(),d=c+b.height(),e=a.offset().top,f=e+a.height();return f<=d&&e>=c}return!1}}(),function(){goog.provide("P.UserEducationGuideTutorial"),goog.require("P.ExperienceTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.interfaces.TutorialStep"),goog.require("P.viewport");var a="userEducationGuideBackgroundImage";P.UserEducationGuideTutorial=function(a,b){P.ExperienceTutorial.call(this,a,b)},P.UserEducationGuideTutorial.prototype=Object.create(P.ExperienceTutorial.prototype),P.UserEducationGuideTutorial.prototype.onStart=function(){return new Promise(function(a,b){return window.self!==window.top?void b(new Error("window is not the topmost window")):(this.trigger=this.displayData.trigger,this.setUpPubSub(),void("automatic"===this.trigger?this.moduleContainer?(this._prefetchAllImages(),a(void 0)):P.loadModule({name:"UserEducationGuide"}).then(function(b){b.render().then(function(){$("body").append(b.$el),this.moduleContainer=b,this._prefetchAllImages(),a(void 0)}.bind(this))}.bind(this)):(this.tutorialManager.setTutorialActive(!1),a(void 0))))}.bind(this))},P.UserEducationGuideTutorial.prototype.nextStep=function(a){return new Promise(function(b){if("automatic"!==this.trigger)return b(void 0),void this.tutorialManager.clearStoredData();var c=this._getStepInfo(a)||{};if(c.backgroundImage?this._showBackgroundImage(c.backgroundImage):this._hideBackgroundImages(),c.options&&c.options.zoomed_in&&!this.isZoomedIn)this._enterZoomedInMode();else if(c.options&&!c.options.zoomed_in&&this.isZoomedIn)return this._exitZoomedInMode().then(this.loadStepModule.bind(this,a)),void b(void 0);this.loadStepModule(a),b(void 0)}.bind(this))},P.UserEducationGuideTutorial.prototype.onExit=function(){return new Promise(function(a){this._hideBackgroundImages(),this.isZoomedIn&&this._exitZoomedInMode(),this.moduleContainer.$el.empty(),this.viewChangeSubscriber&&(P.pubsub.getChannel(P.CONST.PUBSUB_CHANNEL_TUTORIAL).removeSubscriber(this.viewChangeSubscriber,[P.CONST.PUBSUB_TOPIC_VIEW_CHANGE]),this.viewChangeSubscriber=null),this.navigationSubscriber&&(P.pubsub.getChannel(P.CONST.PUBSUB_CHANNEL_SITE).removeSubscriber(this.navigationSubscriber,[P.CONST.PUBSUB_TOPIC_DEEP_LINK]),this.navigationSubscriber=null),a(void 0)}.bind(this))},P.UserEducationGuideTutorial.prototype.loadStepModule=function(a){this._isCurrentCardStacked()||(this.getModuleArgs(a),P.loadModule(this.moduleArgs).then(function(b){var c=this.currentModule;this.currentModule=b;var d=b;d.onEnter(function(){this._renderUserEducationGuide(b,c,a)}.bind(this))}.bind(this)))},P.UserEducationGuideTutorial.prototype._renderUserEducationGuide=function(a,b,c){var d=this._getStepInfo(c);a.render().then(function(){b&&b.destroy(),this.moduleContainer.$el.appendTo(d&&d.options&&d.options.attach_to?d.options.attach_to:$("body")),this.moduleContainer.prependChild(a),a.onShow()}.bind(this))},P.UserEducationGuideTutorial.prototype.setUpPubSub=function(){_.contains(["automatic","manual"],this.trigger)?P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,this.placedExperience):P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_TUTORIAL_TRIGGER_ACTIVE,$.extend({},this.placedExperience,{showFlyout:!0})),"automatic"===this.trigger&&(this.viewChangeSubscriber=P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_TUTORIAL,P.CONST.PUBSUB_TOPIC_VIEW_CHANGE,this.onViewChange.bind(this)),this.navigationSubscriber=P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_DEEP_LINK,this.dismissTutorial.bind(this)))
},P.UserEducationGuideTutorial.prototype.onViewChange=function(a,b,c){if(this.viewChangeSubscriber){var d=this._getStepInfo(this.tutorialManager.currentStep)||{};c=c||{};var e=c.options||{},f=d.options&&d.options.viewChangeFilter||{};(c.moduleName!==f.moduleName||e.view_type!==f.view_type)&&this.dismissTutorial()}},P.UserEducationGuideTutorial.prototype._isCurrentCardStacked=function(){var a=this._getStepInfo(this.tutorialManager.currentStep);return a&&a.options&&this.moduleArgs&&a.options.step_type!==P.CONST.StepTypes.TOOLTIP?!0:!1},P.UserEducationGuideTutorial.prototype._getStackedCardGroup=function(a,b,c){var d=[];return _.each(a,function(a,e){a.options.stacked_group===c&&e>b&&d.push(a.options)}),d},P.UserEducationGuideTutorial.prototype._enterZoomedInMode=function(){var a=$("body");a.addClass("userEducationGuideZoomedIn");var b=$('<div class="userEducationGuideOverlay" />');a.append(b),b.transition({scale:.8}),$(".App").transition({scale:.8}),this.isZoomedIn=!0},P.UserEducationGuideTutorial.prototype._exitZoomedInMode=function(){return new Promise(function(a){var b=function(){$("body").removeClass("userEducationGuideZoomedIn"),$(".App").css("transform",""),this.isZoomedIn=!1,a(void 0)}.bind(this),c=function(){$(".App").transition({scale:1},500,"ease",b)};$(".userEducationGuideOverlay").remove(),window.setTimeout(c,200)}.bind(this))},P.UserEducationGuideTutorial.prototype._prefetchAllImages=function(){var b=$("body");_.each(this.displayData.steps,function(c){if(c.backgroundImage){var d=c.backgroundImage;d+=P.Viewport.width<1400?" small":" big",b.append($('<div class="'+a+" "+d+'" />'))}})},P.UserEducationGuideTutorial.prototype._showBackgroundImage=function(b){if(b){var c=$("."+a+"."+b),d=$("."+a+".active");c&&c.length&&(d.length?(c.addClass("visible"),d.transition({opacity:0},function(){d.removeClass("active"),c.addClass("active").removeClass("visible")})):(c.addClass("visible"),$(".App").transition({opacity:0},function(){c.addClass("active").removeClass("visible")})))}},P.UserEducationGuideTutorial.prototype._hideBackgroundImages=function(){var b=$("."+a+".active");$(".App").css({opacity:1}),b.transition({opacity:0},function(){b.remove()})},P.UserEducationGuideTutorial.prototype.getModuleArgs=function(a){this.moduleArgs=P.ExperienceTutorial.prototype.getModuleArgs.call(this,a),this.moduleArgs.name||(this.moduleArgs.name="UserEducationGuideStepBase");var b=this._getStepInfo(a);b&&(this.moduleArgs.options.stacked_cards=this._getStackedCardGroup(this.displayData.steps,this.moduleArgs.options.current_step,b.options.stacked_group))},P.UserEducationGuideTutorial.prototype._getStepInfo=function(a){return this.displayData.steps&&this.displayData.steps[a]}}(),function(){goog.provide("P.NuxModalTutorial"),goog.require("P.ModalTutorial"),goog.require("P.interfaces.ITutorial"),goog.require("P.viewport"),P.NuxModalTutorial=function(a,b){this.storage={},P.ModalTutorial.call(this,a,b)},P.NuxModalTutorial.prototype=Object.create(P.ModalTutorial.prototype),P.NuxModalTutorial.prototype.onExit=function(){var a=this.modal;return a?(this.modal=null,P.getModalManager().removeModalWithAnimation(a,".flexibleSetup",500)):new Promise(function(a){a(void 0)})},P.NuxModalTutorial.prototype.getStorage=function(a){return this.storage[a]},P.NuxModalTutorial.prototype.setStorage=function(a,b){this.storage[a]=b}}(),function(){goog.provide("P.resourceResponse"),P.resourceResponse={fromPlainObject:function(a){var b=new P.ResourceResponse;b.client_context=a.client_context,b.page_info=a.page_info,b.request_identifier=a.request_identifier;var c=a.resource;c&&c.options&&(b.bookmarks=c.options.bookmarks||[]),b.resource_response.data=a.resource_response.data;var d=a.resource_response.error;b.resource_response.error=d?P.Error.fromPlainObject(d):null;var e=a.module;if(e){var f=P.ModuleTree.fromPlainObject(e.tree);f.setOuterHtml(e.html),b.moduleTree=f}return b}},P.ResourceResponse=function(){this.resource_response={data:null,error:null},this.client_context=null,this.moduleTree=null,this.page_info=null,this.request_identifier="",this.bookmarks=[]}}(),function(){goog.provide("P.resource"),goog.require("P.Error"),goog.require("P.interfaces.IResource"),goog.require("P.logging"),goog.require("P.resourceFactory"),goog.require("P.resourceResponse"),goog.require("P.Module");var a=P.logging.getLogger("Resource"),b="-end-",c=P.DEBUG?["allow_api_side_effects","memoize_api","request_debug"]:[],d=1,e=1e3;P.Resource=function(a,b){this.name=a,this.options=b?P.valueUtil.deepCopy(b):{}},_.extend(P.Resource.prototype,{getName:function(){return this.name},setOptions:function(a){this.options=a},set:function(a,b){this.options[a]=b},get:function(a){return this.options[a]||null},copyOptions:function(a){var b=P.valueUtil.deepCopy(this.options);return b&&a&&delete b.bookmarks,b},callGet:function(a,b){return this.call("get",a,b)},callCreate:function(a){return this.call("create",a)},callUpdate:function(a){return this.call("update",a)},callDelete:function(a){return this.call("delete",a)},_isUrlShortEnoughForHttpGet:function(a,b){var c=a+"?"+$.param(b);return c.length<=2e3},call:function(a,b,c){var d=b&&void 0!==b.async?b.async:!0,e=b&&b.timeout||null,f=this._call(a,d,e,c);return f.then(function(a){this.onResponseSuccess(a)}.bind(this),function(a){this.onResponseError(a)}.bind(this)),f.then(void 0,function(a){var c=new P.Module;if(a&&19===a.api_error_code)P.writeban.showWriteBanned(c);else if(a&&3===a.api_error_code&&P.currentUser.isLimitedLogin())P.limitedLogin.showLogin(c);else{if(a&&804===a.api_error_code)return;(void 0===b||b.showError)&&P.showError(a.message)}}),f},_call:function(a,b,f,g){this.abort();var h,i=d,j=e,k={options:this.options,context:_.pick(P.CONTEXT,c)};h="/resource/"+this.name+"/"+a+"/",g&&(i=g.retries||i,j=g.retryAfter||j,k.module={name:g.name,options:g.options},k.render_type=g.renderType,k.error_strategy=g.errorStrategy,g.data&&(k.module_data=g.data));var l={source_url:P.getCurrentUrl(),data:JSON.stringify(k)};P.state.activeTarget&&(l.module_path=P.state.activeTarget.getFullName());var m="get"===a&&this._isUrlShortEnoughForHttpGet(h,l),n={"X-Pinterest-AppState":P.windowIsInFocus?"active":"background"};return new Promise(function(a,c){var d=null,e={cache:!1,url:h,async:b,data:l,dataType:"json",headers:n,timeout:f,type:m?"GET":"POST"},g={url:h,requestData:l,resourceDict:k},o=function(){return i--,i<0?c(d):void(this.xhr=this._createXhr(g,e,function(b){return a(b)},function(a,b){return b?c(a):(d=a,o.again())}))}.bind(this);o.again=function(){P.setTimeout(o,j)},o.start=function(){o()},o.start()}.bind(this))},_createXhr:function(b,c,d,e){var f=null,g=b.url,h=b.resourceDict,i=b.requestData;return c.error=function(a,b,c){f=c},c.complete=function(b,c){if("abort"===c)return void e(new Error("aborted"),!0);var j={resource_name:this.name,response_headers:b.getAllResponseHeaders(),http_status:b.status,text_status:c,respose_text:b.responseText,error_thrown:f,xhrUrl:g};if(0===b.status)return j.userAgent=window.navigator.userAgent,j.payload=i,a.error("Connectivity error or cancelled by navigation",j),void e(new Error(P._("Connectivity error or cancelled by navigation")),!0);var k=null,l=null;try{var m=JSON.parse(b.responseText);if(!(m instanceof Object))throw Error("JSON.parse did not return an object");k=P.resourceResponse.fromPlainObject(m),l=k.resource_response.error;var n=!!b.getResponseHeader("X-Pinterest-New-Version");n&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION_AVAILABLE)}catch(o){l=new P.Error,l.message=P.string.common.defaultErrorMessage,l.http_status=b.status,a.error("Failed to parse resource response. HTTP "+b.status,o.message,j)}if(l&&403===l.http_status&&!P.currentUser.isAuthenticated())return void P.changeWindowLocation(P.getLoginUrl(),!1);var p=h&&h.options&&h.options.disable_auth_failure_redirect===!0;if(l&&401===l.http_status&&1001===l.api_error_code&&!p){var q=P.getLoginUrl();return void P.changeWindowLocation(q,!1)}l?k&&k.moduleTree?d(k):e(l):k?d(k):a.error("no error and no resource response",j),this.xhr=null}.bind(this),$.ajax(c)},abort:function(){this.xhr&&(this.xhr.abort(),this.xhr=null)},resetBookmark:function(){this.options&&delete this.options.bookmarks},setBookmarks:function(a){this.set("bookmarks",a)},getLatestBookmark:function(){var a=this.options.bookmarks;return a?a[a.length-1]:void 0},atEnd:function(){return this.getLatestBookmark()===b},onResponseSuccess:function(a){if(a.client_context){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_APP_VERSION,a.client_context.app_version);var b=a.client_context.event_log_info;b&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CONTEXT_LOGGING,P.CONST.PUBSUB_TOPIC_CONTEXT_LOG_PLAIN_OBJECT,b);var c=a.client_context.placed_experiences;c&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,c)}var d=P.CONTEXT.is_test_mode?P.CONTEXT.test_context:null;P.CONTEXT=a.client_context,d&&_.extend(P.CONTEXT,d),a.page_info&&(a.page_info.title||_.keys(a.page_info.meta).length)&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PAGE_INFO,a.page_info),a.bookmarks&&this.setBookmarks(a.bookmarks),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_REQUEST,P.CONST.PUBSUB_TOPIC_REQUEST_IDENTIFIER,a.request_identifier)},onResponseError:function(b){a.debug("Request error for "+this.name,b,b.stack_trace)},isEqual:function(a,b){if(this.name!==a.name)return!1;var c=_.omit(this.options,"bookmarks"),d=_.omit(a.options,"bookmarks");if(b){c.latest_bookmark=this.getLatestBookmark();var e=a.options.bookmarks;d.latest_bookmark=e&&e[e.length-1]}return _.isEqual(c,d)},toString:function(){var a=_.omit(this.options,"bookmarks","field_set_key");return this.name+"("+P.toScrubbedArgumentString(a)+")"},isCalling:function(){return!!this.xhr}}),P.Resource.NOOP_RESOURCE={name:"NoopResource",options:{}},P.resourceFactory.setDefaultConstructorFn(P.Resource),P.logFrontEndEvent=function(a,b){var c=P.resourceFactory.create("IncrementEventResource",{event:a,sample_rate:b});c.callCreate({showError:!1})}}(),function(){goog.provide("P.safeLink");var a="offsite_",b="-";P.SafeLink={open:function(c,d){var e=Math.round(1e3*Math.random())+"",f=Math.round(1e3*Math.random())+"";Cookie.set(a+e,f);var g={token:e+b+f,url:c};d&&(g.pin=d),P.changeWindowLocation("/offsite/?"+$.param(g),!0)}}}(),function(){goog.provide("P.socialConnect"),goog.require("P.experiments"),goog.require("P.fb"),goog.require("P.script"),P.SocialConnect=function(){};var a;_.extend(P.SocialConnect.prototype,Backbone.Events),_.extend(P.SocialConnect.prototype,{connect:function(a,b){b=_.extend({},{success:P.NOOP,error:P.NOOP,complete:P.NOOP},b);var c=null,d=null;a===P.SocialConnect.RAKUTEN&&(c=800,d=600);var e=P.FacebookDialog.getWindowOptions(c,d);if(b.rerequest_facebook_email)P.fb.ensureInit(function(a){a.login(function(a){var c,d,e=a.authResponse;e&&(c=e.grantedScopes,c&&(c=c.split(",")),d=e.userID);var f=_.find(c,function(a){return"email"===a}),g={id:d};"connected"===a.status&&f?b.success(g):b.error(g),b.complete()},{scope:"email",auth_type:"rerequest",return_scopes:!0})});else{var f=window.open("/connect/"+a+"/","",e);if(!f)return P.showError(P._("You must enable popups!")),void b.error({network:a,alertedUpstream:!0});var g=P.setInterval(function(){f.closed&&(clearInterval(g),this.handleComplete({network:a,error_message:"Window closed."}))}.bind(this),1e3);this.once("connect:"+a,function(a){clearInterval(g),a.error_message?b.error(a):b.success(a),b.complete()})}},complete:function(a){var b=JSON.parse(a);this.handleComplete(b)},handleComplete:function(a){var b="connect:"+a.network,c=a.network;if("facebook"===c){var d=a.id;d&&"string"!==typeof d&&(a.error_message="Facebook id must be of string type")}this.trigger(b,a)}}),_.extend(P.SocialConnect,{instance:function(){return a||(a=new P.SocialConnect),a},FACEBOOK:"facebook",TWITTER:"twitter",GOOGLE:"google",GPLUS:"gplus",YAHOO:"yahoo",RAKUTEN:"rakuten",MICROSOFT:"microsoft"})}(),function(){goog.provide("P.facebookDialog");var a=20,b=580,c=400;P.FacebookDialog={open:function(a){var d=_.pick(a,P.FacebookDialog._validParams),e=P.FacebookDialog._getDialogType(a),f=P.FacebookDialog.generateFbRef(),g=a.object_type&&a.object_id&&"feed"===e;if(d.method=e,d.link=P.absolutify(a.path),g&&(d.link+="?"+$.param({fb_ref:f})),"feed"===e){var h=P.FacebookDialog.getWindowOptions(a.width||b,a.height||c);window.open("http://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(d.link),"sharer",h)}else P.fb.ensureInit(function(b){b.getLoginStatus(function(){b.ui(d,function(b){if(g&&b&&b.post_id){var c=P.resourceFactory.create("LogFacebookFeedShare",{});c.options={object_type:a.object_type,object_id:a.object_id,fb_ref:f},c.callCreate({showError:!1})}a.callback&&a.callback(b)})})})},_validParams:["description","name","picture","to","href"],_validOptions:["send","feed","share"],generateFbRef:function(){for(var b="";b.length<a;)b+=Math.floor(65535*Math.random()).toString(16);return P.currentUser.id+":"+b},_getDialogType:function(a){var b=_.contains(P.FacebookDialog._validOptions,a.type),c=b?a.type:"feed";return c},getWindowOptions:function(a,d){var e=a?a:b,f=d?d:c,g=screen.width,h=screen.height,i=Math.round((g-e)/2),j=h>f?Math.round((h-f)/2):0;return"scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+e+",height="+f+",left="+i+",top="+j}}}(),function(){!function(a){a.fn.getCursorPosition=function(){var a=this.get(0);if(a){if("selectionStart"in a)return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange(),c=document.selection.createRange().text.length;return b.moveStart("character",-a.value.length),b.text.length-c}}}}(jQuery)}(),function(){goog.provide("P.Set"),P.Set=function(a){this.items={},a&&this.addMultiple(a)},P.Set.prototype.add=function(a){this.items[a]=!0},P.Set.prototype.addMultiple=function(a){a.forEach(function(a){this.items[a]=!0}.bind(this))},P.Set.prototype.remove=function(a){delete this.items[a]},P.Set.prototype.contains=function(a){return Object.prototype.hasOwnProperty.call(this.items,a)}}(),function(){goog.provide("P.model.Model"),P.model.Model=function(a){this._modelOrCollection=null,this._modelAvailablePromise=a.then(function(a){this.set(a)}.bind(this))},_.extend(P.model.Model.prototype,Backbone.Events),P.model.Model.prototype.set=function(a){var b=a instanceof Array;this._modelOrCollection||(this._modelOrCollection=b?new Backbone.Collection:new Backbone.Model,this.on("all",function(){this.trigger.apply(this,arguments)}.bind(this)));var c;b?c=a:(c=this._modelOrCollection.toJSON(),$.extend(!0,c,a)),this._modelOrCollection.set(c)},P.model.Model.prototype.updateData=function(a){a.then(function(a){this.set(a)}.bind(this))},P.model.Model.prototype.getNonEmptyData=function(){return this._modelAvailablePromise.then(function(){return this.getData()}.bind(this))},P.model.Model.prototype.getData=function(){if(this._modelOrCollection){var a=this._modelOrCollection.toJSON();if(a instanceof Object)return a}return null},P.model.Model.prototype.on=function(a,b){this._modelAvailablePromise.then(function(){return this._modelOrCollection.on(a,b)}.bind(this))},P.model.Model.prototype.once=function(a,b){this._modelAvailablePromise.then(function(){return this._modelOrCollection.once(a,b)}.bind(this))},P.model.Model.prototype.off=function(a,b){this._modelAvailablePromise.then(function(){return this._modelOrCollection.off(a,b)}.bind(this))}}(),function(){goog.provide("P.modelManager"),goog.require("P.LruCache"),goog.require("P.model.Model"),P.modelManager=P.modelManager||{},P.modelManager.EntityType={PIN:"pin"},P.modelManager.EntityDict,P.modelManager.EntityId,P.modelManager.CACHE_FOR_TYPE_SIZE=1e3,P.modelManager.CacheForType=function(a){this.cache=new P.LruCache(P.modelManager.CACHE_FOR_TYPE_SIZE),this._entityType=a},P.modelManager.CacheForType.prototype.getModel=function(a){return this.cache.get(a)},P.modelManager.CacheForType.prototype.addEntityDict=function(a){if(a.type!==this._entityType)throw new Error("invalid entityDict type");var b=a.id;this.ensureModel(b,Promise.resolve(a))},P.modelManager.CacheForType.prototype.ensureModel=function(a,b){var c=this.cache.get(a);return c||(c=new P.model.Model(b),this.cache.set(a,c)),c.updateData(b),c},P.modelManager.CacheForType.prototype.remove=function(a){this.cache.remove(a)},P.modelManager.ModelManager=function(){this.entityTypeToCache={},_.each(P.modelManager.EntityType,function(a){this.entityTypeToCache[a]=new P.modelManager.CacheForType(a)}.bind(this))},P.modelManager.ModelManager.prototype.getModel=function(a,b){var c=this.entityTypeToCache[a];return c?c.getModel(b):null},P.modelManager.ModelManager.prototype.add=function(a){if(a instanceof Array)a.forEach(function(a){this._addEntity(a)}.bind(this));else if(a instanceof Object){var b=a;this._addEntity(b)}},P.modelManager.ModelManager.prototype.ensureModel=function(a,b,c){var d=this.entityTypeToCache[a];if(!d)throw new Error("unexpected entityType "+a);return d.ensureModel(b,c)},P.modelManager.ModelManager.prototype.invalidate=function(a,b){var c=this.entityTypeToCache[a];if(!c)throw new Error("unexpected entityType "+a);c.remove(b)},P.modelManager.ModelManager.prototype._addEntity=function(a){var b=a.type;if(b){var c=b,d=this.entityTypeToCache[c];if(d){var e=a.id;"string"===typeof e&&d.ensureModel(e,Promise.resolve(a))}}},P.modelManager.instance=new P.modelManager.ModelManager}(),function(){goog.provide("P.resourceCache"),goog.require("P.model.Model"),goog.require("P.modelManager"),P.resourceCache={};var a=["NetworkStoriesResource","NotificationsResource","BoardInvitesResource"],b=function(a){return _.isObject(a)?_.sortBy(_.map(_.pairs(a),function(a){return[a[0],b(a[1])]}),function(a){return a[0]}):a},c=function(a){return JSON.stringify(b(a))};P.resourceCache.IResourceCacheStrategy=function(){},P.resourceCache.IResourceCacheStrategy.prototype.ensureModel=function(){},P.resourceCache.IResourceCacheStrategy.prototype.invalidate=function(){},P.resourceCache.ResourceCacheStrategyEntity=function(a,b){this._entityType=a,this._modelManager=b},P.resourceCache.ResourceCacheStrategyEntity.prototype.ensureModel=function(a,b){var c=a.options.id;return this._modelManager.ensureModel(this._entityType,c,b)},P.resourceCache.ResourceCacheStrategyEntity.prototype.invalidate=function(){},P.resourceCache.ResourceCacheStrategySimple=function(){this._cache={},this._bookmarkResponses={}},P.resourceCache.ResourceCacheStrategySimple.prototype._getKey=function(a){var b=_.omit(a.options,"bookmarks");return b.bookmark=a.getLatestBookmark(),c(b)},P.resourceCache.ResourceCacheStrategySimple.prototype.ensureModel=function(b,c){var d=this._getKey(b),e=this._cache[d];return-1!==_.indexOf(a,b.name)&&b.options.bookmarks&&(e=null),e?e.updateData(c):e=this._cache[d]=new P.model.Model(c),e},P.resourceCache.ResourceCacheStrategySimple.prototype.invalidate=function(){this._cache={}},P.resourceCache.ResourceCacheStrategySimple.prototype.getBookmarkResponse=function(a){return this._bookmarkResponses[a]},P.resourceCache.ResourceCacheStrategySimple.prototype.setBookmarkResponse=function(a,b){this._bookmarkResponses[a]=b},P.resourceCache.ResourceCache=function(a){this._resourceCacheStrategies=a},P.resourceCache.Freshness={POSSIBLY_STALE_AND_INCOMPLETE:1,FRESH:2},P.resourceCache.ResourceCache.prototype.callGet=function(b,c,d){var e=this._resourceCacheStrategies[b.name],f=b.getLatestBookmark(),g=-1!==_.indexOf(a,b.name),h=b.callGet({showError:!1}).then(function(a){return g&&(e.setBookmarkResponse(f,a.bookmarks),c&&c.resource.setBookmarks(a.bookmarks)),a.resource_response.data});if(e){var i=e.ensureModel(b,h);return d&&d.freshness===P.resourceCache.Freshness.POSSIBLY_STALE_AND_INCOMPLETE?(g&&c.resource.setBookmarks(e.getBookmarkResponse(f)),i.getNonEmptyData()):h}return h},P.resourceCache.ResourceCache.prototype.callCreate=function(a){var b=a.callCreate();return b.then(function(){"PinCommentResource"===a.name&&P.modelManager.instance.invalidate(P.modelManager.EntityType.PIN,a.options.pin_id)}),b},P.resourceCache.ResourceCache.prototype.ensureModel=function(a,b){var c=this._resourceCacheStrategies[a.name];return c?c.ensureModel(a,Promise.resolve(b)):null},P.resourceCache.ResourceCache.prototype.invalidate=function(a){var b=this._resourceCacheStrategies[a.name];b&&b.invalidate(a)},P.resourceCache.instance=new P.resourceCache.ResourceCache({PinResource:new P.resourceCache.ResourceCacheStrategyEntity(P.modelManager.EntityType.PIN,P.modelManager.instance),BoardsResource:new P.resourceCache.ResourceCacheStrategySimple,BoardPickerBoardsResource:new P.resourceCache.ResourceCacheStrategySimple,ConversationsResource:new P.resourceCache.ResourceCacheStrategySimple,NotificationsResource:new P.resourceCache.ResourceCacheStrategySimple,NetworkStoriesResource:new P.resourceCache.ResourceCacheStrategySimple,UserExperienceWithContextResource:new P.resourceCache.ResourceCacheStrategySimple,BoardInvitesResource:new P.resourceCache.ResourceCacheStrategySimple})}(),function(){goog.provide("P.TypeaheadProvider"),goog.require("P.LruCache");var a=5;P.TypeaheadProvider=function(b){b=b||{},this.tags=b.tags,this.enable_recent_queries=!!b.enable_recent_queries,this.minimum_term_character_length=b.minimum_term_character_length||0,this.bypass_lru_cache=b.bypass_lru_cache;var c={tags:b.tags,pin:b.pin_id},d=b.num_places;d?c.num_places=d:c.count="count"in b?b.count:a,b.should_geocode&&(c.should_geocode=!0),b.exclude_non_followers&&(c.exclude_non_followers=!0),b.field_set_key&&(c.field_set_key=b.field_set_key);var e="TypeaheadResource";b.resource_name&&(e=b.resource_name),this.searchResource=P.resourceFactory.create(e,c),this.itemsCache=new P.LruCache},_.extend(P.TypeaheadProvider.prototype,Backbone.Events),_.extend(P.TypeaheadProvider.prototype,{search:function(a,b){var c;if(a=a.trim(),!a&&"pinners_and_contacts"===this.tags)return this.abortSearch(),this.publishData(a,[],{},b);if(!a&&P.currentUser.isLimitedLogin())return this.abortSearch(),this.publishData(a,[],{},b);if(!a&&this.enable_recent_queries&&P.currentUser&&P.currentUser.isAuthenticated())c="recent_search";else{var d=this.bypass_lru_cache?{}:this.itemsCache.get(a);if(d){var e=d.items;if(e&&e.length){this.abortSearch();var f=d.hint;return void this.publishData(a,e,f,b)}}}a.length>=this.minimum_term_character_length?this.fetch(a,c,b):this.publishData(a,[],{},b)},getResource:function(){return this.searchResource},abortSearch:function(){this.getResource().abort()},publishData:function(a,b,c,d){var e={term:a,items:b,hint:c};this.trigger(P.CONST.EVENT_DATA,e),d&&d(e)},setAutocompleteScope:function(a){this.getResource().set("autocompleteScope",a)},fetch:function(a,b,c){var d=this.getResource();if(d.isCalling()){var e=d.get("term");if(a===e)return;this.abortSearch()}""!==this.tags&&(this.trigger(P.CONST.EVENT_TYPEAHEAD_SEARCH_START,a),d.set("term",a),d.set("tags",b||this.tags),d.resetBookmark(),d.callGet({showError:!1}).then(function(b){var d=b.resource_response.data,e=d.items,f=d.hint||{},g={hint:f,items:e};this.cacheData(a,g),this.publishData(a,e,f,c)}.bind(this),function(a){this.trigger("fetchError",a)}.bind(this)),this.warm=!0)},removeCacheForTerm:function(a){this.itemsCache.remove(a)},cacheData:function(a,b){this.itemsCache.set(a,b)},prefetch:function(){if(!this.warm){var a=P.resourceFactory.create("TypeaheadPrepareResource");a.callGet({showError:!1}),this.warm=!0}}})}(),function(){goog.provide("P.invite"),P.Invite={_logInvites:function(a){var b={invite_id:null,invite_code:null,invite_metadata:{invite_type:a,to_follow:[P.currentUser.id]}},c={topic:"sent_invites",content:b},d=P.resourceFactory.create("EventLoggingResource",c);d.callCreate({showError:!1})},trackInvite:function(a,b){b?P.trackGACategoryEvent("user_invite",a,P.CONST.GA_ACTION_SUCCESS):P.trackGACategoryEvent("user_invite",a,P.CONST.GA_ACTION_ERROR),"gplus"===a&&P.Invite._logInvites(a)},_createFacebookInvite:function(){var a=P.resourceFactory.create("FacebookInviteCreateResource",{});return a.callCreate()},_showFacebookDialog:function(a,b){return P.Invite._createFacebookInvite().then(function(c){var d=c.resource_response.data,e=d.url,f=d.invite_code;P.FacebookDialog.open({type:"send",name:"name",path:e,to:a,callback:function(a){if(a&&a.success){P.Invite.trackInvite("facebook",!0);var c=P.resourceFactory.create("FacebookInviteSentResource",{invite_code:f});c.callCreate()}b&&b(a&&a.success)}}),P.trackGACategoryEvent("user_invite","facebook",P.CONST.GA_ACTION_OPEN_MODAL)},function(){P.Invite.trackInvite("facebook",!1)})},userInviteFacebook:function(a,b){return P.fb.ensureLoggedIn(function(){P.Invite._showFacebookDialog(a,b)})},userInviteEmail:function(a,b){var c=P.resourceFactory.create("EmailInviteSentResource",{email:a,type:"email"});c.callCreate().then(function(){P.Invite.trackInvite("email",!0),b&&b(!0)},function(){P.Invite.trackInvite("email",!1),b&&b(!1)})},trackInviteFunnelAction:function(a,b){b="undefined"!==typeof b?b:!1;var c={action:a,is_recipient_funnel:b};P.resourceFactory.create("TrackInviteFunnelActionResource",c).callCreate({showError:!1})}}}(),function(){goog.provide("P.userRegistration"),goog.require("P.CONST"),goog.require("P.experiments"),goog.require("P.fb"),goog.require("P.logging"),goog.require("P.NoEmailProvidedError");var a=P.logging.getLogger("UserRegistration"),b=function(){};b.prototype={fastTrackSocialRegistration:function(a,b){if(a===P.SocialConnect.FACEBOOK)return this.fetchNetworkData(a).then(function(a){return a.email?this.sendImmediateFbRegisterRequest(a,b):Promise.reject(new P.NoEmailProvidedError)}.bind(this));if(a===P.SocialConnect.RAKUTEN){var c={rakuten_id:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_ID),rakuten_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_TOKEN),rakuten_refresh_token:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_REFRESH_TOKEN),first_name:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_FIRST_NAME),email:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_EMAIL),gender:P.SessionStorage.getItem(P.CONST.SESSION_RAKUTEN_GENDER),country:null};return"rakuten"===P.getQueryStringParams().cmp&&(c.follow_rakuten=!0),this.register(P.SocialConnect.RAKUTEN,c)}return Promise.resolve(void 0)},sendImmediateFbRegisterRequest:function(a,b){var c={first_name:a.first_name,last_name:a.last_name,email:a.email,gender:a.gender,image_url:a.image_url,facebook_id:a.id,facebook_token:a.access_token,country:null};return b&&_.extend(c,b),this.addExtraSocialParams(P.SocialConnect.FACEBOOK,c),this.register(P.SocialConnect.FACEBOOK,c)},addExtraSocialParams:function(a,b){var c=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_ID),d=P.SessionStorage.getItem(P.CONST.SESSION_FACEBOOK_TOKEN);c&&(b.facebook_id||(b.facebook_id=c),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_ID)),d&&(b.facebook_token||(b.facebook_token=d),P.SessionStorage.removeItem(P.CONST.SESSION_FACEBOOK_TOKEN));var e=P.SessionStorage.getItem(P.CONST.SESSION_KEY_INVITE_FOLLOW);e&&(e.invite_follow_board&&(b.board_to_follow=e.invite_follow_board),e.invite_follow_user&&(b.user_to_follow=e.invite_follow_user))},fetchNetworkData:function(a){return a===P.SocialConnect.FACEBOOK?(P.trackRegisterAction("register_facebook"),new Promise(function(a,b){P.fb.ensureInit(function(c){c.getLoginStatus(function(d){if(d.authResponse){var e=["picture.type(large)","id","first_name","last_name","email","gender"],f="/me?fields="+e.join(",");c.api(f,function(c){c&&!c.error?(c.picture&&c.picture.data&&c.picture.data.url&&!c.picture.data.is_silhouette&&(c.image_url=c.picture.data.url),a(c)):b(new Error("FB.api errored: "+c.error))})}else b(new Error("not authed"))},!0)})})):Promise.reject(new Error("Unsupported social network: "+a))},register:function(b,c){var d=P.UserRegistration.getResource(c);return d.callCreate().then(function(b){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_SUCCESS),P.SessionStorage.removeItem(P.CONST.SESSION_KEY_INVITE_FOLLOW),a.debug("Login, successful",b),Cookie.set(P.CONST.COOKIE_USER_JUST_REGISTERED,"1");var d;switch(c.container){case"home_page":d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.HOME_PAGE_SIGNUP),P.trackRegisterAction("signup_home_page");break;case"plain_signup_modal":d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PLAIN_MODAL_SIGNUP),P.trackRegisterAction("signup_plain_modal");break;case"closeup_signup_modal":d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.CLOSEUP_MODAL_SIGNUP),P.trackRegisterAction("signup_closeup_modal");break;case"widescreen_signup_modal":d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.WIDESCREEN_MODAL_SIGNUP),P.trackRegisterAction("signup_widescreen_modal");break;case"pinit_button_landing":d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.PIN_IT_BUTTON_LANDING_SIGNUP),P.trackRegisterAction("signup_pinit_button_landing");break;case"inspired_banner":P.trackRegisterAction("signup_inspired_banner");break;default:d=P.ContextEvent.fromEventType(P.ContextLogging.EventType.UNKNOWN_PLACEMENT_SIGNUP),P.trackRegisterAction("signup_unknown_placement")}d&&P.ContextLogger.getInstance().addEvent(d)},function(a){P.trackGAEvent("user_signup",P.CONST.GA_ACTION_ERROR),a.api_error_code===P.CONST.API_ERROR_UNDERAGE_REGISTER_ATTEMPT&&(P.trackRegisterAction("multi_step_set_age_restrict_cookie"),Cookie.set(P.CONST.COOKIE_REGISTER_RESTRICT,"1",87600),Cookie.set(P.CONST.COOKIE_PERSONALIZE_FROM_OFFSITE_BROWSING_COOKIE_NAME,"disabled"));var d=this.signupRequestAttempts||0,e=_.isEmpty(a.api_error_code)||_.contains([P.CONST.API_SERVER_ERROR,P.CONST.API_REQUEST_TIMEOUT],a.api_error_code);if(e&&d<3)return this.signupRequestAttempts=d+1,this.register(b,c);throw a}.bind(this))},getResource:function(a){return P.resourceFactory.create("UserRegisterResource",a)},showSignupModal:function(a,b,c){var d={name:a,options:c||{}};b&&(d.resource=b),P.loadModule(d).then(function(a){P.getModalManager().createAndShowModal(a,{mask_type:"dark",modal_style:c.modal_style,can_dismiss:c.can_dismiss})}).fin(function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HIDE_UNAUTH_BANNER)})}},P.UserRegistration=new b}(),function(){goog.provide("P.preventScroll"),goog.require("P.Mixins");var a=function(){};a.prototype.listen=function(){},P.Mixins.PreventScroll={startPreventScroll:function(a,b){this.stopPreventScroll(),this._preventScrollListener=this.listen(a,"mousewheel",function(c){var d=c.originalEvent.wheelDeltaY<0?"down":"up",e=a.scrollTop();if("down"===d){var f=a.outerHeight()+e;f>=b.outerHeight()&&c.preventDefault()}else 0===e&&c.preventDefault()})},stopPreventScroll:function(){this._preventScrollListener&&(this.removeListener(this._preventScrollListener),this._preventScrollListener=null)}}}(),function(){goog.provide("P.nuxFindFriends"),goog.require("P.Mixins");var a=function(){};a.prototype.listen=function(){},P.Mixins.NuxFindFriends={resetFollowState:function(a){this.friendsFollowed=[],this.friendsUnfollowed=[],this.followAllSelected=a},followFriend:function(a){this.friendsUnfollowed=_.without(this.friendsUnfollowed,a),this.friendsFollowed.push(a)},unfollowFriend:function(a){this.friendsFollowed=_.without(this.friendsFollowed,a),this.friendsUnfollowed.push(a)},toggleFollowAll:function(){this.resetFollowState(!this.followAllSelected)},getFriendsFollowed:function(){return this.friendsFollowed},getFriendsUnfollowed:function(){return this.friendsUnfollowed},isFollowAllSelected:function(){return this.followAllSelected},followingFriendsChanged:function(){return this.followAllSelected||this.friendsFollowed||this.friendsUnfollowed},setNetwork:function(a){this.network=a,this.resetFollowState(!1)},getNetwork:function(){return this.network},initializeFollowState:function(){this.resetFollowState(!1)},showSelectAllCheckbox:function(a){this.selectAllCheckbox.setChecked(a,!1),this.$selectAllWrapper.css("visibility","visible")},hideSelectAllCheckbox:function(){this.$selectAllWrapper.css("visibility","hidden")},_onSelectAllTextClicked:function(){this.selectAllCheckbox.toggle()},_onSelectAllCheckboxToggled:function(){this.toggleFollowAll(),this.updateCheckForGridItems(this.isFollowAllSelected())
},updateCheckForGridItems:function(a){var b=this.getFriendsContent();if(b&&(b.options.item_options.is_checked=a,b.getGrid()&&(b.getGrid().options.item_options.is_checked=a,b.getGrid().getGridItems()))){b.getGrid().getGridItems().options.item_options.is_checked=a;var c=b.getGrid().getGridItemsChildren();_.each(c,function(b){b.data&&b.setChecked(a)})}},resetFollowAllState:function(){var a="male"!==P.currentUser.get("gender");this.showSelectAllCheckbox(a),this.resetFollowState(a),this.updateCheckForGridItems(a)},signalFollowFriends:function(){if(this.isFollowAllSelected()){var a={network:this.getNetwork(),import_friends:!1,excluded_user_ids:this.getFriendsUnfollowed()},b=P.resourceFactory.create("UserFollowAllResource",a);return b.callCreate()}var c={followee_ids:this.getFriendsFollowed()},d=P.resourceFactory.create("UserBatchFollowResource",c);return d.callCreate()},followedFriendsIdsList:function(){var a=[],b=this.getFriendsContent();if(b&&b.getGrid()&&b.getGrid().getGridItems()){var c=b.getGrid().getGridItemsChildren();_.each(c,function(b){b.isChecked()&&b.data&&a.push(b.data)})}return a},_onFriendClick:function(a){var b=a.data||{},c=b.user_id;if(c)switch(this.tab){case P.SocialConnect.FACEBOOK:case P.SocialConnect.TWITTER:b.is_following?this.followFriend(c):this.unfollowFriend(c)}},getFriendsContent:function(){return this.getChildById("friendsContent")},setup:function(){this.selectAllCheckbox=this.getChildById("selectAllCheckbox"),this.$selectAllWrapper=this.$(".selectAllWrapper"),this.twitterConnected=_.isString(P.currentUser.get("twitter_url")),this.facebookConnected=_.isString(P.currentUser.get("facebook_url")),this.tab=P.SocialConnect.FACEBOOK,this.hideSelectAllCheckbox(),this.initializeFollowState(),this.listen(this.getChildById("fbTab"),P.CONST.EVENT_BUTTON_CLICK,this._onButtonTabClick),this.listen(this.getChildById("twTab"),P.CONST.EVENT_BUTTON_CLICK,this._onButtonTabClick),this.listen(this.selectAllCheckbox,P.CONST.EVENT_CHANGE,this._onSelectAllCheckboxToggled),this.childListen(P.CONST.EVENT_USER_CLICK,this._onFriendClick),this._showSelectedTab()},_onButtonTabClick:function(a){var b=a.target;switch(this.tab=null,b.id){case"fbTab":this.tab=P.SocialConnect.FACEBOOK,this._showSelectedTab();break;case"twTab":this.tab=P.SocialConnect.TWITTER,this._showSelectedTab()}}}}(),function(){goog.provide("P.navigateData.NavigateData"),P.navigateData.NavigateData=function(){this.evt=null,this.handled=!1,this.reuseLast=!1,this.fromHistoryUid=null,this.fromNavigate=!1,this.currentModule=null}}(),function(){goog.provide("P.number"),P.number.quantize=function(a,b){var c=a*Math.pow(10,b),d=Math.round(10*(c-parseInt(c,10)))/10;return d===-.5&&(d=-.6),c=Math.round(parseInt(c,10)+d)/Math.pow(10,b)},P.number.toRadians=function(a){return a*Math.PI/180},P.number.dollarToMicrodollar=function(a){var b=parseInt(100*a,10);return 1e4*b},P.number.microdollarToDollar=function(a){return a/1e6},P.number.formatUSD=function(a){return a.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}}(),function(){goog.provide("P.positioning"),P.Positioning={positionElementAtAnchor:function(a,b,c,d,e){var f=P.CONST.PositionPointFlag,g=b.offset(),h=a.outerWidth(),i=b.outerWidth();if(g){var j=0,k=0;if(c&f.FLAG_VERTICAL_BOTTOM||c&f.FLAG_VERTICAL_TOP?(j=c&f.FLAG_VERTICAL_BOTTOM?g.top+b.outerHeight():g.top-a.outerHeight(),k=c&f.FLAG_VERTICAL_LEFT?g.left:c&f.FLAG_VERTICAL_RIGHT?g.left+i-h:g.left+(i-h)/2):c&f.FLAG_HORIZONTAL_LEFT||c&f.FLAG_HORIZONTAL_RIGHT?(k=c&f.FLAG_HORIZONTAL_LEFT?g.left-h:g.left+i,j=c&f.FLAG_HORIZONTAL_TOP?g.top:c&f.FLAG_HORIZONTAL_BOTTOM?g.top+b.outerHeight()-a.outerHeight():g.top+(b.outerHeight()-a.outerHeight())/2):c&f.FLAG_VERTICAL_CENTER&&c&f.FLAG_HORIZONTAL_CENTER&&(k=g.left+(i-h)/2,j=g.top+(b.outerHeight()-a.outerHeight())/2),d){var l=j-$(window).scrollTop();l>0&&(j=l)}else{var m=a.parents().filter(function(){return"fixed"===$(this).css("position")});m[0]&&(j+=m.scrollTop(),j-=$(window).scrollTop())}var n={left:k,top:j};return e&&(n=P.Positioning.checkIfInViewportAndAdjustAccordingly(a,n,c)),a.css(n),c}},checkIfInViewportAndAdjustAccordingly:function(a,b){var c,d,e=a.width(),f=b.left,g=b.top,h=f+e,i=7;h>P.Viewport.width?c=f-(h-P.Viewport.width+i):f<i&&(c=i);var j={};return j.left=c?c:f,j.top=d?d:g,j}}}(),function(){!function(){function a(a,b){var c='font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;font-size: 15px;'+(a?"font-weight: bold;":"")+"color: "+b+";";return c}console.log("%câ¥ web? %c--> %cjoinUs()",a(!0,"#d22"),a(!0,"#777"),a(!0,"#2b2")),window.joinUs=function(){return console.log("%cWe're excited to have you! %câ",a(!1,"#d22"),a(!1,"#333")),window.location.href="/_/_/about/careers/",""}}()}(),function(){goog.provide("P.date"),P.date.today=function(){var a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate())},P.date.UTCToday=function(){var a=new Date;return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate())},P.date.addDays=function(a,b){return new Date(a.getTime()+24*b*60*60*1e3)},P.date.UTCDate=function(a){var b=new Date(a);return new Date(b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate())},P.date.toOrdinal=function(a){function b(a){return a%4===0&&(a%100!==0||a%400===0)}a=a||new Date;var c=a.getDate(),d=a.getMonth(),e=a.getFullYear()-1,f=365*e+e/4-e/100+e/400,g=[0,31,59,90,120,151,181,212,243,273,304,334],h=g[d];return d>1&&b(e)&&h++,Math.floor(f+h+c)}}(),function(){goog.provide("P.socialNetworkSettingsManager"),goog.require("P.string"),goog.require("P.socialConnect");var a=1e3,b=110;P.SocialNetworkSettingsManager=function(){},_.extend(P.SocialNetworkSettingsManager.prototype,{handleConnect:function(a,b,c){if(b&&!P.currentUser.isLimitedLogin()){var d={success:function(d){var e={network:a,data:d};this._internalConnectNetwork(b,e,c)}.bind(this),error:function(a){c.error&&c.error(a)},complete:function(){c.complete&&c.complete()}};this._externalConnectNetwork(a,b,d)}else{var e={network:a};this._internalConnectNetwork(b,e,c)}},updateConnectStatus:function(){var a=P.resourceFactory.create("UserResource",{user_id:P.currentUser.get("id"),username:P.currentUser.get("username"),field_set_key:"social_connect"});a.callGet().then(function(a){var b=a.resource_response.data;P.currentUser.set(b),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_CURRENT_USER,P.CONST.PUBSUB_TOPIC_SOCIAL_NETWORK_UPDATED)})},_externalConnectNetwork:function(a,b,c){return b?void P.SocialConnect.instance().connect(a,c):void(c.success&&c.success({}))},_internalConnectNetwork:function(a,b,c){var d=P.resourceFactory.create("UserSocialNetworkResource",b);(a?d.callCreate():d.callDelete()).then(function(a){this.updateConnectStatus(),c.success&&c.success(a)}.bind(this),function(a){c.error&&a instanceof Object&&c.error(a)}).fin(function(){c.complete&&c.complete()})},_getResourceNameForNetworkFriends:function(a){var b=null;switch(a){case P.SocialConnect.FACEBOOK:b="UserFacebookFriendsResource";break;case P.SocialConnect.TWITTER:b="UserTwitterFriendsResource";break;case P.SocialConnect.GOOGLE:b="UserGmailFriendsResource";break;case P.SocialConnect.YAHOO:b="UserYahooFriendsResource";break;case P.SocialConnect.MICROSOFT:b="UserMicrosoftFriendsResource";break;default:return}return b},pollForFriends:function(c,d){d=d||{};var e=d.resourceOptions||{},f=this._getResourceNameForNetworkFriends(c);if(f){var g=P.resourceFactory.create(f,e);g.callGet({showError:!1}).then(function(){var a=d.success;a&&a(g)},function(e){if(e.api_error_code===b)P.setTimeout(function(){this.pollForFriends(c,d)}.bind(this),a);else{var f=d.error;f&&f()}}.bind(this))}}});var c=null;P.SocialNetworkSettingsManager.instance=function(){return c||(c=new P.SocialNetworkSettingsManager),c}}(),function(){goog.provide("P.conversationsManager"),goog.require("P.resourceResponse"),goog.require("P.modules.Conversation"),goog.require("P.modules.ActiveConversations"),goog.require("P.modules.ConversationHead");var a=5,b="activeConversations",c=72,d=function(){this.activeConversationsContainer=null,this.conversations={},this.conversationIdToLastMessageId={},this.conversationIds=[],this._openConversation=null,this._logger=P.logging.getLogger("ConversationsManager")};_.extend(d.prototype,Backbone.Events),_.extend(d.prototype,{_fetchingConversations:!1,_pendingRequest:null,getContainer:function(){return this.activeConversationsContainer},setContainer:function(a){this.activeConversationsContainer=a},setDraggedObject:function(a){this._draggedObject=a},getDraggedObject:function(){return this._draggedObject},listenForConversations:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&this.listenTo(P.Updater.instance(),"conversations_unseen_count",this.onUnseenConversationsCount)},onUnseenConversationsCount:function(a){(a>0||this._shouldUpdateConversations)&&this._fetchConversations().then(function(b){this._shouldUpdateConversations=!1,this._updateActiveConversations(b),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT,a)}.bind(this))},_fetchConversations:function(){if(!this._fetchingConversations){var a=P.resourceFactory.create("ConversationsResource",{});this._pendingRequest=P.resourceCache.instance.callGet(a),this._pendingRequest.then(function(){this._conversationsBookmarks=a.get("bookmarks")}.bind(this)).fin(function(){this._fetchingConversations=!1}.bind(this)),this._fetchingConversations=!0}return this._pendingRequest},getConversationsBookmarks:function(){return this._conversationsBookmarks},_updateActiveConversations:function(a){_.each(a,function(a){var b=a.id,c=this.conversationIdToLastMessageId[b],d=a.last_message;if(d){var e=d.id;if(!_.isUndefined(c)){var f=d.sender.id;if(e!==c){var g=_.contains(this.conversationIds,b);if(g){var h=this.conversations[b];h.updateConversation(a)}else f!==P.currentUser.get("id")&&this.addConversation(a,!1)}}this.conversationIdToLastMessageId[b]=e}}.bind(this))},deleteConversationBadgeCount:function(){var a=P.resourceFactory.create("ConversationBadgeResource",{});a.callDelete({showError:!1}).then(function(){P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_CONVERSATION_UNREAD_COUNT,0)})},sendMessageToUsers:function(a,b,c){var d={user_ids:a||[],emails:b||[]},e=this._sendNewMessage("ConversationsResource",d,c);return e.then(function(a){var b=a.resource_response.data;this.addConversation(b)}.bind(this)),e},sendMessageToConversation:function(a,b){var c={conversation_id:a};return this._sendNewMessage("ConversationMessagesResource",c,b)},_sendNewMessage:function(a,b,c){c.text&&(b.text=c.text),c.object_id&&(b[c.object_type]=c.object_id);var d=P.resourceFactory.create(a,b),e=d.callCreate({error:this._handleSendMessageError.bind(this)});return e.then(function(){this._shouldUpdateConversations=!0}.bind(this)),e},_handleSendMessageError:function(a){var b=a.extra_data;if(243===a.api_error_code&&b.objects){var c=b.objects;P.loadModule({name:"ConfirmDialog",options:{template:"message_object_auth_error",attached_object:c.object,users:c.users,emails:c.emails}}).then(function(a){P.getModalManager().createAndShowModal(a)})}},logContextEvent:function(a,b,c,d){var e=P.ContextEvent.fromEventType(a);if(c&&e.setObjectIdStr(c),d){if(d.attr("data-element-type")){var f=parseInt(d.attr("data-element-type"),10);e.setElement(f)}var g=d.closest("[data-component-type]");if(g.length){var h=parseInt(g.attr("data-component-type"),10);e.setComponent(h)}}e.updateAuxData({conversation_id:b}),P.ContextLogger.getInstance().addEvent(e)},_addConversationToDom:function(a,b,c){var d=this.getContainer();if(d){var e=a.id;this.conversationIds.push(e),this.cacheActiveConversations();var f={id:e};(!P.currentUser.isAuthenticated()||P.currentUser.isLimitedLogin())&&(f.unauth=!0),a.users=_.reject(a.users,function(a){return a.id===P.currentUser.get("id")}),b&&(f.peek=!1);var g=new P.modules.Conversation({options:f,data:a});g.renderExistingData().then(function(){this.conversations[e]=g,this.resetConversationHeadTransforms(),d.appendChild(g),c&&g.setInactive(),b?this.openConversation(g):(g.setBadgeCount(a.unread),this._openConversation&&this._openConversation.adjustPopup()),g.focus()}.bind(this)),this._ensureWithinMaxNumberOfConversations()}},_animateAddConversation:function(a,b,c){var d=_.reject(a.users,function(a){return a.id===P.currentUser.get("id")}),e=this._addConversationToDom.bind(this,a,b);b&&this._openConversation&&this._openConversation.closePopup();var f;if(c&&c.length)f=this._makeAnimatedElement(c),this._animateShowConversationHead(f,e);else{var g=new P.modules.ConversationHead({options:{users:d,emails:a.emails}});g.render().then(function(){f=this._makeAnimatedElement(g.$el),this._animateShowConversationHead(f,e)}.bind(this))}},_makeAnimatedElement:function(a){var b=a.clone();return b.addClass("cloned").offset({left:-1e3,top:-1e3}).appendTo($("body")),b},_animateShowConversationHead:function(a,b){var d=this.getContainer(),e=d.getContent(),f=e.offset(),g=f.left,h=f.top,i=d.getHeight(!0),j=e.find(".ConversationHead");j.transition({y:-c},280,"ease"),a.addClass("normal opening"),a.removeClass("medium small"),a.width(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).height(P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION).css("visibility","hidden"),a.offset({left:g,top:h+i-P.CONST.ACTIVE_CONVERSATION_HEAD_DIMENSION-3}),a.transition({scale:0,duration:1},function(){$(this).css("visibility","")}).transition({scale:1.2,duration:180}).transition({scale:1,duration:100},function(){b(),a.remove()})},cacheActiveConversations:function(){P.LocalStorage.setItem(b,this.conversationIds)},_ensureWithinMaxNumberOfConversations:function(){if(this.conversationIds.length>a){var b=this.conversationIds[0];this.removeOverboundsConversation(b)}},removeOverboundsConversation:function(a){var b=this.conversations[a],c=b.getContent();c.transition({scale:.8},200).transition({scale:2,opacity:0},200,"ease",function(){this.resetConversationHeadTransforms(),this.removeConversationById(a)}.bind(this))},loadInitialConversations:function(a){var c=P.LocalStorage.getItem(b);c&&c.length||(c=[],this._publishNoActiveConversationsIfNeeded());var d=[].concat(c);this._fetchConversations().then(function(b){var c=!!a;_.each(b,function(b){var e=b.id===a;e?(this._addConversationToDom(b,!0),c=!1):_.contains(d,b.id)&&this._addConversationToDom(b,!1)}.bind(this)),c&&this.addConversationById(a,!0),this.cacheActiveConversations()}.bind(this))},addConversation:function(a,b,c){_.isUndefined(b)&&(b=!0);var d=a.id,e=this.conversations[d];e?(e.updateConversation(a),b&&this.openConversation(e)):this._animateAddConversation(a,b,c),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_ADDED)},addConversationById:function(a,b){if(_.contains(this.conversationIds,a))return void(b&&this.openConversation(this.conversations[a]));var c=P.resourceFactory.create("ConversationResource",{conversation_id:a});c.callGet({showError:!1}).then(function(a){var c=a.resource_response.data;this.addConversation(c,b)}.bind(this))},addConversationForUnauthUser:function(a){var b=P.getQueryStringParams(),c=b.user_id,d=b.od;if(c&&d){var e=P.resourceFactory.create("UnauthConversationResource",{conversation_id:a,user_id:c,od:d});e.callGet().then(function(a){var b=a.resource_response.data;this._unauthUserEmail=b.unauth_user_email;var c=b.conversation;this.addConversation(c,!0)}.bind(this))}},getUnauthUserEmail:function(){return this._unauthUserEmail},listenForActiveConversationUpdates:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&(P.Updater.instance().setMinPoll(P.CONST.UPDATES_WITH_ACTIVE_CONVERSATIONS_MIN_POLL),P.ConversationsUpdater.instance().activate(),this.activeConversationsListener||(this.activeConversationsListener=this.listenTo(P.ConversationsUpdater.instance(),"active_conversations",this.onActiveConversationsUpdate)))},getOpenConversationId:function(){return this._openConversation?this._openConversation.data.id:!1},onActiveConversationsUpdate:function(a){this._updateActiveConversations(a)},stopListeningForActiveConversationUpdates:function(){P.currentUser.isAuthenticated()&&!P.currentUser.isLimitedLogin()&&(P.ConversationsUpdater.instance().deactivate(),P.Updater.instance().setMinPoll(P.CONST.UPDATES_MIN_POLL),this.stopListening(this.activeConversationsListener),this.activeConversationsListener=null)},getConversationIds:function(){return this.conversationIds},hasActiveConversations:function(){return this.getConversationIds().length>0},resetConversationHeadTransforms:function(){var a=this.getContainer();a&&a.$(".ConversationHead").css("transform","")},scaleConversationDownAndRemove:function(a){var b=this.conversations[a],d=b.getContent(),e=_.indexOf(this.conversationIds,a),f=this.getContainer().getConversationHeads(),g=f.slice(0,e);d.transition({scale:1.1},120,function(){g.length&&g.transition({y:c},140)}).transition({scale:0},140,"ease",function(){this.resetConversationHeadTransforms(),this.removeConversationById(a)}.bind(this))},removeConversationById:function(a){if(this.conversationIds=_.without(this.conversationIds,a),this.conversations[a]){this._openConversation&&(this._openConversation.getConversationId()===a?this.closeConversation(this._openConversation):this._openConversation.adjustPopup());var b=this.conversations[a];b.destroy(),delete this.conversations[a],this.cacheActiveConversations(),this._publishNoActiveConversationsIfNeeded()}},_publishNoActiveConversationsIfNeeded:function(){0===this.conversationIds.length&&P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_NO_ACTIVE_CONVERSATIONS)},closeAllConversations:function(){_.each(this.conversations,function(a){this.closeConversation(a)}.bind(this))},closeConversation:function(a){this.stopListeningForActiveConversationUpdates(),this.setAllActive(),a.closePopup(),this._openConversation===a&&(this._openConversation=null,P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_CLOSED,null))},setAllActive:function(){_.each(this.conversations,function(a){a.setActive()})},setAllInactive:function(){_.each(this.conversations,function(a){a!==this._openConversation&&a.setInactive()}.bind(this))},closeConversationById:function(a){var b=this.conversations[a];b&&this.closeConversation(b)},openConversation:function(a){this.conversations[a.getConversationId()]&&(this._openConversation?(this._openConversation.setInactive(),this._openConversation.closePopup()):this.setAllInactive(a),this._openConversation=a,this._openConversation.setActive(),a.showPopup(),P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_MESSAGES,P.CONST.PUBSUB_TOPIC_CONVERSATION_OPEN,null),this.listenForActiveConversationUpdates())}}),P.setConversationsManager=function(a){P._conversationsManager=a},P.getConversationsManager=function(){return P._conversationsManager},P.setConversationsManager(new d)}(),function(){goog.provide("P.conversationsUtil"),P.getConversationFromUrl=function(){var a,b=P.getQueryStringParams(),c=window.location.pathname,d="/conversation/",e=0===c.indexOf(d);if((b.conversation||e)&&(a=b.conversation,!a)){var f=c.split(d),g=f[1];a=g.split("/")[0]}return a}}(),function(){goog.provide("P.updater");var a="mousemove.updater";P.Updater=function(){this.decay=0,this.lastFetchTime=0,this.timeout=null,this.recentPinId=null,this._minPoll=P.CONST.UPDATES_MIN_POLL,this._numRetries=0,this.updatesResource=P.resourceFactory.create("UpdatesResource",{}),$(document).on(a,_.throttle(function(){this.wake()}.bind(this),1e3)),this.deferredFetch()},_.extend(P.Updater.prototype,Backbone.Events),_.extend(P.Updater.prototype,{getUpdatesResourceOptions:function(){var a={};return this.recentPinId&&(a.last_pin_id=this.recentPinId),a},setRecentPinId:function(a){this.recentPinId=a},setMinPoll:function(a){this._minPoll=a},wake:function(){this.msSinceLastFetch()>this._minPoll&&(this._numRetries=0,this.decay=0,this.fetch())},fetch:function(){clearTimeout(this.timeout),this.lastFetchTime=(new Date).getTime(),this.updatesResource.setOptions(this.getUpdatesResourceOptions()),this.updatesResource.callGet({showError:!1}).then(function(a){var b=a.resource_response.data;this._numRetries=0,_.each(b,function(a,b){this.trigger(b,a)}.bind(this)),this.deferredFetch()}.bind(this),function(){this.attemptDeferredFetch()}.bind(this))},attemptDeferredFetch:function(){this._numRetries++,this._numRetries<5?this.deferredFetch():$(document).off(a)},deferredFetch:function(){this.decay=Math.min(2*(this.decay||1e3),P.CONST.UPDATES_MAX_POLL),this.timeout=P.setTimeout(function(){this.fetch()}.bind(this),this._minPoll+this.decay)},msSinceLastFetch:function(){return(new Date).getTime()-this.lastFetchTime}}),P.Updater.instance=function(){return P.Updater._instance||(P.Updater._instance=new P.Updater),P.Updater._instance}}(),function(){goog.provide("P.conversationsUpdater"),P.ConversationsUpdater=function(){this.conversationsUpdatesResource=P.resourceFactory.create("ConversationsUpdatesResource",{}),this.poller=null,this._numRetries=0,this._requestConversationId=null,this._pollInterval=null},_.extend(P.ConversationsUpdater.prototype,Backbone.Events),_.extend(P.ConversationsUpdater.prototype,{fetch:function(){if(!this.pendingRequest){var a=P.getConversationsManager().getOpenConversationId();a&&(this.pendingRequest=!0,this._requestConversationId!==a&&(this._requestConversationId=a,this.conversationsUpdatesResource.resetBookmark(),this.conversationsUpdatesResource.setOptions({conversation_ids:[this._requestConversationId]})),this.conversationsUpdatesResource.callGet({showError:!1}).then(function(a){this.pendingRequest=!1,this._numRetries=0;var b=a.resource_response.data,c=b.updated_conversations||[];this._activated&&b.wait&&this._setNextPoll(1e3*b.wait),c.length>0&&this.trigger("active_conversations",c)}.bind(this),function(){this.pendingRequest=!1,this.deactivateIfNecessary()}.bind(this)))}},deactivateIfNecessary:function(){this._numRetries++,this._numRetries>5&&this.deactivate()},deactivate:function(){this._resetPoller(),this.pendingRequest=!1,this._activated=!1},activate:function(){this._setNextPoll(P.CONST.OPEN_CONVERSATION_MIN_POLL),this._numRetries=0,this._activated=!0},_setNextPoll:function(a){this.pendingRequest||(a&&this._pollInterval===a||this._resetPoller(),a&&this._pollInterval!==a&&(this.poller=window.setInterval(function(){this.fetch()}.bind(this),a)),this._pollInterval=a)},_resetPoller:function(){this.poller&&clearInterval(this.poller),this.poller=null,this._pollInterval=null},isActive:function(){return this._activated}}),P.ConversationsUpdater.instance=function(){return P.ConversationsUpdater._instance||(P.ConversationsUpdater._instance=new P.ConversationsUpdater),P.ConversationsUpdater._instance}}(),function(){goog.provide("P.title"),P.Title=function(){this.prefixCount=0,this.previousCount=0},_.extend(P.Title.prototype,{setPrefixCount:function(a){this.previousCount=this.prefixCount,this.prefixCount=Math.max(a,0),this._updateTitle()},incrementPrefixCount:function(){this.setPrefixCount(this.prefixCount+1)},resetPrefix:function(){this.setPrefixCount(0)},decrementPrefixCount:function(){this.setPrefixCount(this.prefixCount-1)},_updateTitle:function(){if(this.prefixCount!==this.previousCount){var a,b=document.title,c=b.split("("+this.previousCount+") "),d=c.length>1?_.rest(c).join(""):c[0];a=this.prefixCount?"("+this.prefixCount+") "+d:d,window.document.title=a}}}),P.Title.instance=function(){return P.Title._instance||(P.Title._instance=new P.Title),P.Title._instance}}(),function(){goog.provide("P.writeban"),P.writeban={},P.writeban.showWriteBanned=function(a){var b=P.string.format(P._("Due to strange activity, we put your account in safe mode to protect your Pins. You just need to reset your password.")),c={name:"ConfirmDialog",options:{button_text:P._("Reset Password"),body_message:b,title:P._("Safe mode alert!"),template:"generic"}},d=function(){this.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)}.bind(a),e=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_CLICK),this.showLoading();var a=P.resourceFactory.create("UserResetPasswordResource",{username_or_email:P.currentUser.attributes.username}),b=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_SUCCESS);var a={name:"ConfirmDialog",options:{email:P.currentUser.attributes.email,template:"password_reset_email_sent"}};P.loadModule(a).then(function(a){this.showInModal(a,null),this.listen(a,P.CONST.EVENT_DESTROYED,d)}.bind(this))}.bind(this),c=function(){this.hideLoading()}.bind(this),e=function(){P.trackGAEvent("reset_password",P.CONST.GA_ACTION_ERROR)};a.callCreate({showError:!1}).then(b,e).fin(c)}.bind(a);P.loadModule(c).then(function(a){this.showInModal(a,null),this.listen(a,P.CONST.EVENT_CONFIRM,e),this.listen(a,P.CONST.EVENT_DISMISS,d)}.bind(a))}}(),function(){goog.provide("P.limitedLogin"),goog.require("P.router"),P.limitedLogin={},P.limitedLogin.showLogin=function(a){var b={name:"ConfirmDialog",options:{button_text:P._("Log In"),body_message:P._("You just need to log in first."),title:P._("Almost there..."),template:"generic"}},c=function(){var a=encodeURIComponent(P.getCurrentUrl());P.router.get().navigate("/login/?next="+a)},d=function(){a.triggerEvent(P.CONST.EVENT_DISMISS,null,!1)};P.loadModule(b).then(function(a){this.showInModal(a,{can_dismiss:!0}),this.listen(a,P.CONST.EVENT_CONFIRM,c),this.listen(a,P.CONST.EVENT_DISMISS,d)}.bind(a))}}(),function(){goog.provide("P.translate"),P.translate={},P.translate.detect=function(a){var b=P.resourceFactory.create("LanguageDetectionResource",{text:a});return b.callGet()},P.translate.translate=function(a,b){var c=P.resourceFactory.create("LanguageTranslationResource",{text:a,to:b});return c.callGet()}}(),function(){goog.provide("P.browserExtension"),goog.require("P.BrowserDetector"),goog.require("P.BrowserExtensionUrls");var a=_.object([[P.CONST.BrowserType.CHROME,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_CHROME_URL,newWindow:!0}],[P.CONST.BrowserType.FIREFOX,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_FIREFOX_URL,newWindow:!1}],[P.CONST.BrowserType.SAFARI,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_SAFARI_URL,newWindow:!1}],[P.CONST.BrowserType.IE,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_IE_URL,newWindow:!1}],[P.CONST.BrowserType.OPERA,{url:P.BrowserExtensionUrls.EXTENSION_PINIT_OPERA_URL,newWindow:!0}]]),b=function(){};b.prototype={handleExtensionInstall:function(a,b){var c=this._getBrowserExtensionUrl();c&&(this.isChrome()?this._handleChromeExtensionInstall(a,b):P.changeWindowLocation(c,this._openInNewWindow()))},_handleChromeExtensionInstall:function(a,b){if(!this.isExtensionInstalled()){var c=this._getBrowserExtensionUrl();chrome.webstore.install(c,a,b)}},isExtensionInstalled:function(){return void 0!==$("body").attr("data-pinterest-extension-installed")},isChrome:function(){return P.BrowserDetector.getBrowser()===P.CONST.BrowserType.CHROME},_getBrowserExtensionUrl:function(){var b=P.BrowserDetector.getBrowser();return b?a[b].url:void 0},_openInNewWindow:function(){var b=P.BrowserDetector.getBrowser();return b?a[b].newWindow:void 0}},P.browserExtension.instance=new b}(),function(){goog.provide("P.BrowserDetector"),P.BrowserDetector={},P.BrowserDetector.getBrowser=function(){var a=!!window.opera||window.navigator.userAgent.indexOf(" OPR/")>=0,b="InstallTrigger"in window,c=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,d=!!window.chrome&&!a,e=!1||!!document.documentMode;return b?P.CONST.BrowserType.FIREFOX:a?P.CONST.BrowserType.OPERA:d?P.CONST.BrowserType.CHROME:e?P.CONST.BrowserType.IE:c?P.CONST.BrowserType.SAFARI:P.CONST.BrowserType.OTHER}}(),function(){goog.provide("P.interfaces.IToastsManager"),goog.require("P.modules.Toasts"),goog.require("P.modules.ToastBase"),P.interfaces.IToastsManager=function(){},_.extend(P.interfaces.IToastsManager.prototype,Backbone.Events),_.extend(P.interfaces.IToastsManager.prototype,{setContainer:function(){},getContainer:function(){},addToast:function(){}})}(),function(){goog.provide("P.toastsManager"),goog.require("P.modules.ToastBase"),goog.require("P.modules.Toasts");var a=function(){this.container=null,this.toasts=[]};_.extend(a.prototype,Backbone.Events),_.extend(a.prototype,{setContainer:function(a){this.container=a},getContainer:function(){return this.container},addToast:function(a,b){b=b||50,a.renderExistingData().then(function(){var c=this.getContainer();c.children.length?P.setTimeout(function(){c.appendChild(a)},b):c.appendChild(a)}.bind(this))},removeAllToasts:function(){this.getContainer().$el.empty()}}),P.experiments.instance.inExperimentGroupsActiveOrTriggerable("web_pin_create2",["enabled_v5_toast"])&&(P._toastsManager=new a,P.getToastsManager=function(){return P._toastsManager})}(),function(){goog.provide("P.focusWithoutScrolling"),jQuery.fn.focusWithoutScrolling=function(){var a=$(".Closeup");return this.each(function(b,c){var d=$(window),e=d.scrollLeft(),f=d.scrollTop();return $(c).focus(),a.length?(f=a.scrollTop(),void a.scrollTop(f)):(d.scrollLeft(e),void d.scrollTop(f))}),this}}(),function(){goog.provide("P.signupModalManager"),P.signupModalManager={modalsEnabled:!0},P.signupModalManager.disableModals=function(){P.signupModalManager.modalsEnabled=!1},P.signupModalManager.ENTICING_CATEGORIES=["food_drink"],P.signupModalManager.PINVITATIONAL_BOARDS=["/PinterestPH/discover-philippines/"],P.signupModalManager.showInlineSignupModalOnButtonClick=function(a){var b=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled"]),c={LikeButton:P._("Sign up to get more details about this Pin"),ShowModalButton:P._("Sign up to get more details about this Pin"),ContinueButton:P._("Sign up for free!"),InterestFollowButton:P._("Sign up to see more Pins"),UserFollowButton:P._("Sign up to get more details about this Pinner"),BoardFollowButton:P._("Sign up to get more details about this board"),ContinueSignupButton:P._("Sign up to see more Pins"),SignupButton:P._("Sign up to see more Pins")},d={extra_class:"redesign",can_dismiss:!1,prev:window.location.pathname,next:window.location.pathname};["InterestFollowButton","UserFollowButton","BoardFollowButton"].indexOf(a)>-1&&(d.auto_follow=!0);var e=c[a];e&&(d.tagline=c[a],P.pubsub.publish(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_HIDE_UNAUTH_BANNER),b?P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,d):P.UserRegistration.showSignupModal("PlainSignupModal",null,d))},P.signupModalManager.showInlineSignupModal=function(a,b){var c=P.experiments.instance.inExperimentGroups("pinvitational_philippines",["enabled"]),d=P._("Sign up to see more Pins"),e={BoardPage:P._("Sign up to get more details about this board"),UserProfilePage:P._("Sign up to get more details about this Pinner"),DomainFeedPage:P._("Sign up to see more Pins from this website"),Closeup:P._("Sign up to get more details about this Pin"),PaddedPin:P._("Sign up to get more details about this Pin"),SearchPage:d,InterestFeedPage:d,CategoriesPage:d,FeedPage:d};P.experiments.instance.inExperimentGroups("unified_auth_v2_email",["enabled","employees"])&&(e.Closeup=P._("Continue to get more details about this Pin"));var f=["Closeup","PaddedPin"],g={extra_class:"redesign",can_dismiss:!1,prev:window.location.pathname,next:window.location.pathname},h=e[a.className],i=c&&"BoardPage"===a.className&&_.contains(P.signupModalManager.PINVITATIONAL_BOARDS,a.data.url);if(h&&!i)if(g.tagline=h,_.contains(f,a.className)&&!P.CONTEXT.is_mobile_agent)b.options.bookmarks&&delete b.options.bookmarks,b.callGet({showError:!1}).then(function(a){var d=a.resource_response.data;d.board&&_.contains(P.signupModalManager.PINVITATIONAL_BOARDS,d.board.url)||(c?P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,g):d.board&&_.contains(P.signupModalManager.ENTICING_CATEGORIES,d.board.category)?(g.category=d.board.category,P.UserRegistration.showSignupModal("WidescreenSignupModal",b,g)):P.UserRegistration.showSignupModal("CloseupSignupModal",b,g))});else if(c)P.UserRegistration.showSignupModal("PinvitationalRequestModal",null,g);else if(P.experiments.instance.activateAndPersistExperiment("plain_modal_replacement"),P.experiments.instance.inExperimentGroups("plain_modal_replacement",["enabled_inspired"])){if(!a.options.show_full_page_takeover){var j=P.app.getChildByModuleName("Nags").getChildByModuleName("UnauthBanner");
j.showFullPageTakeover(),j.lockFullScreen=!0}}else P.experiments.instance.inExperimentGroups("plain_modal_replacement",["enabled_closeup"])?P.UserRegistration.showSignupModal("CloseupSignupModal",b,g):P.UserRegistration.showSignupModal("PlainSignupModal",null,g)}}(),function(){goog.provide("P.SourceContentManager");var a=10,b=function(a,b,c){this.currentPinId=null,this.handleContentChange=c,this.sourceContent=[],this.currentPosition=null,this.resource=null,this.setupSourceContentManager(b,a)};b.prototype={setupSourceContentManager:function(a,b){this.currentPinId=b,this.currentPosition=null,this.resource=this._duplicateResource(a.resource),this.sourceContent=[],this.appendSourceContent(a.data)},appendSourceContent:function(a){a=a||[];for(var b=0,c=null,d=0;d<a.length;d++)c=a[d],c&&"pin"===c.type?(this.sourceContent.push(c),this.currentPinId===c.id&&(this.currentPosition=d-b)):b+=1},setupResource:function(a,b){this.currentPinId=b,this.sourceContent=[],this.currentPosition=null,this.resource=a,this.getSourcePins()},_duplicateResource:function(a){return P.resourceFactory.create(a.getName(),a.copyOptions(!1))},setItemByKeyPress:function(a){var b=this.keyCodeToIncrement(a);b&&this.setItemByIncrement(b)},keyCodeToIncrement:function(a){switch(a){case P.keyCode.LEFT:return-1;case P.keyCode.RIGHT:return 1;default:return null}},setItemByIncrement:function(b){null!==this.currentPosition&&this.sourceContent.length?this.currentPosition+b<0||this.resource.atEnd()&&this.currentPosition+b>=this.sourceContent.length?this.handleContentChange(null):(this.currentPosition>this.sourceContent.length-a&&!this.resource.atEnd()&&this.getSourcePins(),this.currentPosition+=b,this.currentPinId=this.sourceContent[this.currentPosition].id,this.handleContentChange(this.sourceContent[this.currentPosition].id)):this.getSourcePins()},getSourcePins:function(){this.resource&&(0===this.sourceContent.length&&this.resource.resetBookmark(),this.resource.callGet({showError:!1}).then(function(a){this.setSourceContentFromResponse(a)}.bind(this)))},setSourceContentFromResponse:function(a){var b=a.resource_response;b.error||this.appendSourceContent(b.data)},getCurrentPinData:function(){return this.sourceContent[this.currentPosition]}},P.SourceContentManager=b}(),function(){goog.provide("P.imageDimensions");var a=736,b=370,c=553,d=166;P.ImageDimensions={getDetailedImageDimensions:function(e){var f={width:a,height:b},g={youtube:f,vimeo:f,vevo:f,soundcloud:{width:c,height:d}};if(e.is_playable&&(e.is_video||e.attribution&&e.attribution.embed)){if(e.attribution){var h=g[e.attribution.provider_name];if(h)return h}if(e.embed)return e.embed}return e.images["736x"]}}}(),goog.provide("P.experienceManager"),goog.require("P.Experiences"),goog.require("P.logging"),goog.require("P.resourceFactory"),goog.require("P.Set");var logger=P.logging.getLogger("ExperienceManager"),PlacedExperience,PlacedExperiences;P.ExperienceManager=function(a){this._placedExperiences=a,this._triggered=new P.Set},P.ExperienceManager.prototype={_getResource:function(a,b){return P.resourceFactory.create(a,b)},constructPlacedExperienceId:function(a,b){return a&&b?a+":"+b:null},isPlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);return c&&this.triggerPlacedExperienceId(c),null!==c},isPlaced:function(a){return void 0!==this._placedExperiences[a]},getPlacedExperienceId:function(a,b){if(a&&b){var c=this._placedExperiences[a];if(c&&c.experience_id===b)return c.id}return null},launchPlacedExperience:function(a,b,c){return this.getPlacedExperienceWithContext(a,b).then(function(b){if(b){if(b.experience_id===P.Experiences.Experience.WEB_BLANK_SESSION)return void this.viewPlacedExperience(a,P.Experiences.Experience.WEB_BLANK_SESSION);if(b.placement_id=a,b.type===P.Experiences.ExperienceType.GUIDE||b.type===P.Experiences.ExperienceType.NUX||b.type===P.Experiences.ExperienceType.TOOLTIP)return P.ExperienceTutorialManager.instance().startTutorial(b).then(function(){return this.viewPlacedExperience(a,b.experience_id),Promise.resolve(!0)}.bind(this));if(b.experience_id===P.Experiences.Experience.WEB_PINVITATIONAL_HOMEFEED_MODAL){var d={name:"PinvitationalInviteHomefeedModal",options:{placedExperienceId:b.id}};if(!P.TutorialManager.instance().isTutorialActive())return P.loadModule(d).then(function(a){return P.getModalManager().createAndShowModal(a,{can_dismiss:!1,only_modal:!0}),Promise.resolve(!0)})}else if(b.experience_id===P.Experiences.Experience.WEB_USER_NEWS_APP_UPSELL){var e={name:"AppInstallModal",options:{placedExperienceId:b.id}};if(!P.TutorialManager.instance().isTutorialActive())return P.loadModule(e).then(function(a){return P.getModalManager().createAndShowModal(a,{only_modal:!0}),Promise.resolve(!0)})}else if(b.type===P.Experiences.ExperienceType.SURVEY){if(c){var f={name:"ConfirmDialog",options:b.display_data};return P.loadModule(f).then(function(d){return P.getModalManager().createAndShowModal(d,{mask_type:"dark",can_dismiss:!1}),this.viewPlacedExperience(a,b.experience_id),P.trackRegisterAction("web_survey_viewed"),c.listen(d,P.CONST.EVENT_CONFIRM,function(){window.open(b.display_data.uri),this.completePlacedExperience(a,b.experience_id),P.trackRegisterAction("web_survey_completed")}.bind(this)),c.listen(d,P.CONST.EVENT_CLOSE,function(){this.dismissPlacedExperience(a,b.experience_id),P.trackRegisterAction("web_survey_dismissed")}.bind(this)),Promise.resolve(!0)}.bind(this))}}else{if(b.type===P.Experiences.ExperienceType.TOAST)return b.display_data.module?(this.viewPlacedExperienceId(b.id),P.loadModule({name:b.display_data.module}).then(function(a){return P.getToastsManager().addToast(a),Promise.resolve(!0)})):Promise.resolve(!1);var g=P.ExperienceManager.Tutorials[b.experience_id];if(g)return P.TutorialManager.instance().startTutorial(g,{display_data:b.display_data}).then(function(){return this.viewPlacedExperience(a,b.experience_id),Promise.resolve(!0)}.bind(this))}return Promise.resolve(!0)}return Promise.resolve(!1)}.bind(this))},getPlacedExperienceWithContext:function(a,b){if(!a)return Promise.resolve(null);var c=this.getPlacedExperience(a);if(c&&c.experience_id!==P.Experiences.Experience.NOOP||_.isEmpty(b))return c?(c.triggerable_placed_exps&&c.triggerable_placed_exps.forEach(function(a){this.triggerPlacedExperienceId(a,b)}.bind(this)),Promise.resolve(c)):Promise.resolve(null);var d=this._getResource("UserExperienceResource",{placement_ids:[a],extra_context:b});return d.callGet({showError:!1}).then(function(c){var d=c.resource_response.data||{},e=d[a];return e?(e.triggerable_placed_exps&&e.triggerable_placed_exps.forEach(function(a){this.triggerPlacedExperienceId(a,b)}.bind(this)),e):null}.bind(this))},getPlacedExperience:function(a){return this._placedExperiences[a]||null},refreshPlacedExperiences:function(){logger.debug("Refreshing all placed experiences.");var a=this._getResource("UserExperiencePlatformResource");a.callGet({showError:!1}).then(function(a){var b=a.resource_response.data;this._placedExperiences=b}.bind(this))},dismissPlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);return c?(delete this._placedExperiences[a],this.dismissPlacedExperienceId(c)):Promise.resolve()},dismissPlacedExperienceId:function(a){if(a){logger.debug("Delete placed experience: ",a);var b=this._getResource("UserExperienceResource",{placed_experience_id:a});return b.callDelete({showError:!1}).then(function(){return void this.refreshPlacedExperiences()}.bind(this))}return Promise.resolve()},viewPlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);c&&this.viewPlacedExperienceId(c)},triggerPlacedExperienceId:function(a,b){if(!this._triggered.contains(a)){this._triggered.add(a);var c=this._getResource("UserExperienceTriggerResource",{placed_experience_id:a,extra_context:b});c.callUpdate({showError:!1})}},triggerPlacedExperienceIds:function(a,b){a.forEach(function(a){this.triggerPlacedExperienceId(a,b)}.bind(this))},viewPlacedExperienceId:function(a){if(a){logger.debug("Viewed placed experience: ",a);var b=this._getResource("UserExperienceViewedResource",{placed_experience_id:a});b.callUpdate({showError:!1})}},completePlacedExperience:function(a,b){var c=this.getPlacedExperienceId(a,b);return c?(delete this._placedExperiences[a],this.completePlacedExperienceId(c)):Promise.resolve()},completePlacedExperienceId:function(a){if(a){logger.debug("Complete placed experience: ",a);var b=this._getResource("UserExperienceCompletedResource",{placed_experience_id:a});return b.callUpdate({showError:!1}).then(function(){return void this.refreshPlacedExperiences()}.bind(this))}return Promise.resolve()}};var instance=null;P.ExperienceManager.instance=function(){if(!instance){var a=P.expns;instance=new P.ExperienceManager(a),P.pubsub.subscribe(P.CONST.PUBSUB_CHANNEL_SITE,P.CONST.PUBSUB_TOPIC_PLACED_EXPERIENCES_FROM_SERVER,function(a,b,c){instance=new P.ExperienceManager(c)})}return instance},P.ExperienceManager.Tutorials={},P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_PIN_USER_ED]="firstPinIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_YOUR_BOARDS_USER_ED]="yourBoards",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIND_FRIENDS_USER_ED]="findFriends",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_PLACES_BOARD_USER_ED]="emptyPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FILLED_PLACES_BOARD_USER_ED]="filledPlacesBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_FIRST_BOARD_USER_ED]="firstBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_MOBILE_NUX_INTERESTS]="interestsNuxMweb",P.ExperienceManager.Tutorials[P.Experiences.Experience.ANALYTICS_HOME_USER_ED]="analyticsHomeUserEd",P.ExperienceManager.Tutorials[P.Experiences.Experience.ANALYTICS_AUDIENCE_SELECTOR_USER_ED]="analyticsAudienceSelectorUserEd",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_BOARD_ED]="emptyBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_EMPTY_BOARD_ED_MANUAL]="emptyBoardIntro",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_V2]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_MANUAL]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_HOME_FEED_ED_V2_MANUAL]="homeFeedGuide",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_REPIN_ED]="repin",P.ExperienceManager.Tutorials[P.Experiences.Experience.WEB_REPIN_ED_MANUAL]="repin",goog.provide("P.versionedFileLoader"),goog.require("P.logging"),goog.require("P.script");var versionedFileLoaderLog=P.logging.getLogger("VersionedFileLoader");P.VersionedFileLoader=function(){},P.VersionedFileLoader.prototype={getUrl:function(a){return Pc.originalFilenameToUrl[a]},loadScript:function(a,b){var c=this.getUrl(a);return c?(P.script.load([],c,a),void P.script.ready(a,function(){b()})):void versionedFileLoaderLog.error("Tried loading file (",+a+"), but it does not exist.")}},P.VersionedFileLoader.instance=new P.VersionedFileLoader,goog.provide("P.adTracking"),P.AdTracking={};var GO_CONVERSION_PIXEL="983308403",GO_CONVERSION_LABEL="BAZXCN218AYQ87Dw1AM";P.AdTracking.trackConversions=function(){P.currentUser.isAuthenticated()&&Cookie.get(P.CONST.COOKIE_USER_JUST_REGISTERED)&&(P.AdTracking.pingGoogleConversion(GO_CONVERSION_PIXEL,GO_CONVERSION_LABEL),P.AdTracking.pingFacebookConversion(),Cookie.unset(P.CONST.COOKIE_USER_JUST_REGISTERED))},P.AdTracking.pingUrl=function(a){var b=new Image;a+="&cache_bust="+Date.now(),b.src=a},P.AdTracking.pingGoogleConversion=function(a,b){P.AdTracking.pingUrl("https://www.googleadservices.com/pagead/conversion/"+a+"/?value=0&label="+b+"&guid=ON&script=0")},P.AdTracking.pingFacebookConversion=function(){P.AdTracking.pingUrl("https://www.facebook.com/offsite_event.php?id=6016714330942&value=0&currency=USD")},function(){goog.provide("P.nuxUtils"),goog.require("P.Event"),P.NuxUtils={},P.NuxUtils.MODULE_NAME_CLOSEUP="Closeup",P.NuxUtils.MODULE_NAME_FEEDPAGE="FeedPage",P.NuxUtils.MODULE_NAME_SEARCHPAGE="SearchPage",P.NuxUtils.preventNavigationIfNecessary=function(a){var b=a&&a.data?a.data.url:"";if(P.ExperienceManager.instance().isPlacedExperience(P.Experiences.Placement.WEB_HOME_TAKEOVER,P.Experiences.Experience.WEB_MANDATORY_AUTOBAHN)){var c=P.router.get().resolve(b);if(!c)return P.NuxUtils.handleAutobahnExternalClick(a),!0;var d=c.module;if(d!==P.NuxUtils.MODULE_NAME_CLOSEUP&&d!==P.NuxUtils.MODULE_NAME_FEEDPAGE&&d!==P.NuxUtils.MODULE_NAME_SEARCHPAGE)return P.NuxUtils.handleAutobahnExternalClick(a),!0}return!1},P.NuxUtils.handleAutobahnExternalClick=function(a){P.trackRegisterAction("autobahn_disabled_link"),a.stopPropagation();var b={name:"ConfirmDialog",options:{template:"autobahn_click_tip"}};P.loadModule(b).then(function(a){P.app.showInModal(a,{mask_type:"dark",can_dismiss:!1})})}}(),function(){goog.provide("P.reportMetrics"),goog.require("P.logToServer");var a={reportPageLoadMetrics:function(){if(Pc.reportPageLoadTimings){var a={};if(window.performance){if(window.performance.getEntriesByType){var b=window.performance.getEntriesByType("resource").filter(function(a){return a.name.match(/com\/\d+x/)})[0];b&&(a.firstPinTiming={url:b.name,start:Math.floor(b.startTime),duration:Math.floor(b.duration),responseEnd:Math.floor(b.responseEnd)})}if(window.performance.timing){var c=window.performance.timing,d=c.navigationStart;a.performanceTiming={navigationStart:d,requestStart:c.requestStart-d,responseStart:c.responseStart-d,domLoading:c.domLoading-d,responseEnd:c.responseEnd-d,domInteractive:c.domInteractive-d,domContentLoaded:c.domContentLoadedEventEnd-d,domComplete:c.domComplete-d,loadEventStart:c.loadEventStart-d}}if(Object.keys(a.performanceTiming).forEach(function(b){a.performanceTiming[b]<=0&&delete a.performanceTiming[b]}),window.chrome&&window.chrome.loadTimes){var e=window.chrome.loadTimes();a.firstPaint=1e3*(e.firstPaintTime-e.startLoadTime)}else if("number"===typeof window.performance.timing.msFirstPaint&&window.performance.timing.navigationStart){var f=window.performance.timing.msFirstPaint;a.msFirstPaint=f-window.performance.timing.navigationStart}_.isEmpty(a)||(P.PAGE_ROUTE_PATTERN&&(a.routePattern=P.PAGE_ROUTE_PATTERN),P.currentUser.attributes.country&&(a.country=P.currentUser.attributes.country),a.userAgent=window.navigator.userAgent,a.browser=P.CONTEXT.browser_name,a.isMobile=P.CONTEXT.is_mobile_agent,a.pathname=window.location.pathname,a.moduleName=P.app._getCurrentMainModule().className,P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.PAGE_LOAD_METRIC,P.logToServer.HTTP_METHOD.POST,a))}}P.logToServer.logToServer(P.logToServer.SERVER_LOG_TYPE.BROWSER_EXTENSION,P.logToServer.HTTP_METHOD.GET,{browser_extension_installed:P.browserExtension.instance.isExtensionInstalled()})}};$(window).on("load",function(){a.reportPageLoadMetrics()}),P.Errors.wrap(a,["reportPageLoadMetrics"])}(),function(){function a(a){return a===window.setTimeout?function(a,b){return window.setTimeout(a,b)}:a===window.setInterval?function(a,b){return window.setInterval(a,b)}:a===window.clearTimeout?function(a){return window.clearTimeout(a)}:a===window.clearInterval?function(a){return window.clearInterval(a)}:a}goog.provide("P.window");var b=function(b,c){var d=a(c);if(!P.Errors.ENABLE_WRAPPING)return d;var e=function(a,c,e){if("string"===typeof a&&(a=window[a]),!a)return-1;var f=b+":"+e,g=_.isFunction(a)?P.Errors.wrapFn(f,a):a;return d(g,c)};return e};P.setTimeout=b("setTimeout",window.setTimeout),P.setInterval=b("setInterval",window.setInterval),P.clearTimeout=b("clearTimeout",window.clearTimeout),P.clearInterval=b("clearInterval",window.clearInterval)}(),function(){goog.provide("P.Sticky");var a="sticky",b="absolute",c="below",d=b+" "+c,e=d+" "+a,f=a,g=0,h=1,i=2;P.Sticky=function(a,b){this.$el=a,this.elementHeight=null,this.headerHeight=b.headerHeight,this.boundElementHeight=null,this.$boundTo=b.$boundTo,this.$scrollable=b.$scrollable,this.updateFixed=this.updateFixed.bind(this),this._onScroll=this._onScroll.bind(this),this.$scrollable.on("scroll.sticky",this._onScroll),this.pendingScrollRAF=!1,this.lastState=null,P.deferDomManipulation(function(){this.elementHeight=a.height(),this.boundElementHeight=this.$boundTo.height()}.bind(this))},_.extend(P.Sticky.prototype,Backbone.Events),P.Sticky.prototype.destroy=function(){this.$scrollable.off("scroll.sticky",this.updateFixed)},P.Sticky.prototype.unSticky=function(){this.destroy()},P.Sticky.prototype._onScroll=function(){this.pendingScrollRAF||(P.deferDomManipulation(function(){return this.scrollTop=this.$scrollable.scrollTop(),this.scrollTop===this.lastScrollTop?void(this.pendingScrollRAF=!1):(this.updateFixed(),this.lastScrollTop=this.scrollTop,void(this.pendingScrollRAF=!1))}.bind(this)),this.pendingScrollRAF=!0)},P.Sticky.prototype.updateFixed=function(){var b,c=$(window),f=c.scrollTop(),j=f,k=this.$boundTo.offset().top,l=k-this.headerHeight,m=k+this.boundElementHeight-this.headerHeight;b=j>=l&&j<=m?h:j>=m?i:g,b!==this.lastState&&(b===h?(this.$el.css("top","").addClass(a).removeClass(d),this.trigger(P.CONST.EVENT_STICKY_FIXED,!0)):b===i?(this.$el.removeClass(a),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1),this.handleReachingBottom()):b===g&&(this.$el.removeClass(e),this.trigger(P.CONST.EVENT_STICKY_NORMAL),this.trigger(P.CONST.EVENT_STICKY_FIXED,!1))),this.lastState=b},P.Sticky.prototype.handleReachingBottom=function(){if(!this.$el.hasClass(d)){var a=this.boundElementHeight||0,e=this.$el.css("top");e=e?e.split("px")[0]:0,e=parseInt(e,10)||0,this.$el.addClass(b+" "+c).css("top",a+e+1)}},jQuery.fn.sticky=function(b){return this.each(function(c,d){var e=$(d),g=e.data(f);if(g&&(g.destroy(),e.removeData(a)),"unsticky"===b);else if("object"===typeof b){var h={$scrollable:b.$scrollable,$boundTo:b.$boundTo,headerHeight:b.headerHeight||0};b.$scrollable&&(g=new P.Sticky(e,h),e.data(f,g))}}),this}}(),function(){goog.provide("P.overflowingText"),jQuery.fn.overflowingText=function(){return this.each(function(a,b){if(b.offsetHeight<b.scrollHeight||b.offsetWidth<b.scrollWidth){var c=$(b);c.addClass(P.CONST.OVERFLOWING_TEXT_OVERFLOWING_CLASS)}}),this}}(),function(){goog.provide("P.style"),P.Style=function(a,b){P.Style.addStyle(a,b)},P.Style.addStyle=function(a,b){var c=a+"Styles",d=document.getElementById(c);d||(d=document.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("id",c),document.getElementsByTagName("head")[0].appendChild(d)),d.styleSheet?d.styleSheet.cssText=b:d.appendChild(document.createTextNode(b))}}(),function(){jQuery.fn.flashScrollbar=function(){return this.each(function(){var a=$(this).scrollTop();$(this).scrollTop(a+1),$(this).scrollTop(a-1)}),this}}(),function(){goog.provide("P.webPushManager");var a=P.logging.getLogger("WebPushManager");P.WebPushManager=function(){},_.extend(P.WebPushManager.prototype,{sendSubscriptionToServer:function(b){a.debug("Calling: sendSubscriptionToServer"),Cookie.set("cm_sub","allowed",void 0,"/");var c=b.subscriptionId;if(!c){var d=b.endpoint.split("/");c=d[d.length-1]}var e={registration_id:c},f=P.resourceFactory.create("WebPushDeviceResource",{});return f.callGet({showError:!1}).then(function(b){var d=b.resource_response.data;if(!(c in d)){var f=P.resourceFactory.create("WebPushDeviceResource",e);return f.callCreate()}a.debug("subscription id already exists")})},subscribe:function(){return navigator.serviceWorker.ready.then(function(b){b.pushManager.subscribe().then(function(a){return this.sendSubscriptionToServer(a)}.bind(this),function(){"denied"===Notification.permission?(Cookie.set("cm_sub","denied",void 0,"/"),a.debug("subscribe: Notification.permission === denied")):a.debug("subscribe: exception")})}.bind(this))},initializeState:function(){if(!P.currentUser.isAuthenticated())return a.debug("User not authenticated"),void Cookie.set("cm_sub","denied",void 0,"/");if(!("showNotification"in ServiceWorkerRegistration.prototype))return a.debug("Service doesn't support notification"),void Cookie.set("cm_sub","denied",void 0,"/");if("denied"===Notification.permission)return a.debug("User denied notification from Pinterest"),void Cookie.set("cm_sub","denied",void 0,"/");if(!("PushManager"in window))return a.debug("Push messaging is not supported"),void Cookie.set("cm_sub","denied",void 0,"/");var b=P.resourceFactory.create("UserSettingsResource",{});return b.callGet({showError:!1}).then(function(a){var b=a.resource_response.data;if(b.web_push_notification)return navigator.serviceWorker.ready;throw Cookie.set("cm_sub","denied",void 0,"/"),new Error}).then(function(a){return a.pushManager.getSubscription()}).then(function(a){if(!P.experiments.instance.inExperimentGroups("web_push_notification_hold_out",["enabled","employees"]))throw new Error;if(a)return this.sendSubscriptionToServer(a);throw Cookie.set("cm_sub","none",void 0,"/"),new Error}.bind(this),function(b){a.debug("initialiseState: exception: ",b)})}}),P.WebPushManager.instance=function(){return P.WebPushManager._instance||(P.WebPushManager._instance=new P.WebPushManager),P.WebPushManager._instance},window.addEventListener("load",function(){"serviceWorker"in navigator&&window.location.hostname===P.CONST.CANONICAL_MAIN_DOMAIN?navigator.serviceWorker.register("/sw.js").then(function(){P.WebPushManager.instance().initializeState()}):a.debug("service worker is not supported")})}(),function(){goog.provide("P.pushNotifications");var a="web.com.pinterest.www";P.requestPushNotifications=function(){if(P.currentUser.isAuthenticated()&&window.safari&&window.safari.pushNotification){var b=window.safari.pushNotification.permission(a);"default"===b.permission&&window.safari.pushNotification.requestPermission("https://"+window.location.hostname+"/_/_/push",a,{},function(){})}}}(),function(){require("common/lib/external/fastclick.js"),goog.provide("P.main"),goog.require("P.adTracking"),goog.require("P.modules"),goog.require("P.start"),goog.require("P.string"),goog.require("P.clickCapturer");var a=function(b,c){_.each(b,function(b,d){b.prototype?b.prototype.className=c+d:"object"===typeof b&&a(b,c+d+".")})};Pc.IS_TEST_MODE&&$(document).ajaxSend(function(a,b){b.setRequestHeader("X-Pinterest-Test-Mode","1"),b.setRequestHeader("X-Pinterest-No-Experiments","1")});var b=P.DEBUG?P.logging.LOG_LEVEL.INFO:P.logging.LOG_LEVEL.WARN;P.logging.setDefaultLogLevel(b),P.start.ready(function(b){a(P.modules,""),P.CONST.CANONICAL_MAIN_DOMAIN=b.canonicalMainDomain,P.string.initializeCommonStrings(),b.resourceDataCache.forEach(function(a){var b=P.resourceFactory.createFromPlainObject(a.resource);P.resourceCache.instance.ensureModel(b,a.data)});var c=b.tree,d=P.ModuleTree.fromPlainObject(c);P.clickCapturer.stopCapturing(),P.moduleFactory.create(d).then(function(a){P.app=a}).then(P.clickCapturer.replayEvents),P.AdTracking.trackConversions(),b.canDebug&&$(document).on("keypress",function(a){var b=P.getWindowManager();b&&"|"===String.fromCharCode(a.which)&&b.open("/_/_/debug/","debug",800,800)}),b.asyncCssUrls.forEach(function(a){var b=window.document.createElement("link");b.rel="stylesheet",b.href=a,document.body.appendChild(b)})}),$(document).ready(function(){FastClick.attach(document.body)})}();