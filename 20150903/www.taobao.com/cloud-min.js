KISSY.add("tbc/search-suggest/1.4.8/suggest",function(e,t){function r(e){r.superclass.constructor.call(this,e||{})}return r=t.extend({initializer:function(){var e=this;e.on("afterRenderData",function(){e.fire("beforeShow")})},sendRequest:function(e){var t=this,r=t.constructor.superclass.sendRequest;if(t.fire("beforeQueryChange",{query:e})===!1)return!1;t.queryTimer&&clearTimeout(t.queryTimer),t.laterTimer&&clearTimeout(t.laterTimer);var n=arguments;t.queryTimer=setTimeout(function(){t.queryTimer=null,t.laterTimer=setTimeout(function(){t.later=!1},500),r.apply(t,n)},t.later?200:50),t.later=!0},handleKeyDownInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyDownInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},handleKeyEventInternal:function(e){var t=this,r=t.constructor.superclass.handleKeyEventInternal;return t.fire("beforeKeyDown",{event:e})===!1?!1:void r.apply(this,arguments)},setValueInternal:function(e){var t=this,r=t.constructor.superclass.setValueInternal;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},setValueFromAutocomplete:function(e){var t=this,r=t.constructor.superclass.setValueFromAutocomplete;return t.fire("beforeSetInputValue",{event:e})===!1?!1:void r.apply(this,arguments)},renderItems:function(e,t,r){var n,a,u=this,o=u.get("sugConfig").resultFormat,s=u.resultArr||(u.resultArr=[]),i="",l=e;KISSY.each(t,function(e,u){if(!e||!e[0])return void t.splice(u,1);for(n=e[0];n.indexOf(l)<0;)l=l.substr(0,l.length-1);""===l?(i=n,n=""):0===n.indexOf(l)&&(i=l,n=n.replace(l,""));for(var c in s)if(a=s[c],a.textContent===e[0]&&a.unique)return;r=r.replace("{format}",o),s.push({textContent:e[0],content:KISSY.substitute(r,{query:i,text:n,index:u+1,count:e[1]}),list:!0})}),u.resultArr=s},alignInternal:function(e){var t=this,r=t.constructor.superclass.alignInternal;return t.fire("beforeShow",{event:e})===!1?!1:void r.apply(this,arguments)}},{ATTRS:{dataSourceCfg:{value:{xhrCfg:{url:"",dataType:"jsonp",scriptCharset:"utf-8",data:{code:"utf-8"}},allowEmpty:!0,paramName:"q",cache:!0}},mods:{value:{},setter:function(e){return e}}}}),r.RemoteDataSource=t.RemoteDataSource,r.LocalDataSource=t.LocalDataSource,r},{requires:["combobox"]});KISSY.add("tbc/search-suggest/1.4.8/mods/mods",function(){return{"new":{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-xp" data-key="q={$queryUrl}&suggest=new_{$index}&tab=shopping&auction_tag[]=1154"><span class="{prefixCls}menu-xp-tag">æ°å</span><span class="{prefixCls}menu-xp-icon">æ°å</span><span class="{prefixCls}menu-xp">â{$query}âç¸å³{new}æ°å</span></div>'},shop:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-action="//shopsearch.taobao.com/search" data-key="q={$queryUrl}&suggest=shop_{$index}"><span class="{prefixCls}menu-dp">{$query} <b>ç¸å³åºéº</b></span><span class="{prefixCls}menu-dp-icon">åºéº</span></div>'},cat:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$3}&cat={$1}&suggest=cat_{$index}"><span class="{prefixCls}menu-key">{$2}</span><span class="{prefixCls}menu-cate">å¨<b>{$0}</b>åç±»ä¸æç´¢</span></div>'},list:{tmpl:"<div data-index='{index}' class='item-wrapper' data-key='q={textContent}&suggest=0_{index}'><span class='item-text'>{query}<b>{text}</b></span><span class='item-count'>{format}</span></div>"},global:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-key="q={$queryUrl}&promote=2097152&suggest=global_{$index}"><span class="{prefixCls}menu-key">{$query}</span><span class="{prefixCls}menu-cate">å¨å¨çè´­å¸åºä¸­æç´¢</span></div>'},history:{tmpl:'<div class="{prefixCls}menu-extras-history" {attr} data-key="q={historyItemQuery}&suggest={extraParam}_{index}" data-index="_his_{index}" data-value="{historyItemValue}"><span class="{prefixCls}menu-history-key">{historyItemValue}</span><span data-type="{extraParam}" class="{prefixCls}menu-history-delete">å é¤</span></div>'},scene:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-scene" data-action="//fa.taobao.com/search" data-key="q={scene}&suggest=scene_{$index}"><span class="{prefixCls}menu-key">{scene}</span><b>è£ä¿®å®å¸/éè´­ç§ç±</b></div>'},dapei_bottom:{tmpl:'<div class="item-wrapper {prefixCls}menu-extras-dp" data-source-stat="source_click=suggest_kfc&source_pv=suggest_kfc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_bottom}"><span class="{prefixCls}menu-dp">{dapei_bottom}<b>å¨å¥æ­é</b></span></div>'},dapei_top:{tmpl:'<div class="{prefixCls}menu-extras-cate" data-source-stat="source_click=suggest_jqc&source_pv=suggest_jqc#!Content" data-action="//pose.taobao.com/search" data-key="q={dapei_top}"><span class="{prefixCls}menu-key">{dapei_top}</span><span class="{prefixCls}menu-cate">å¨<b>æ­é</b>ä¸æç´¢</span></div>'},tmall:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-mall" data-key="q={tmall}&suggest=tmall_{$index}&tab=mall"><span class="{prefixCls}menu-key">{tmall}</span><b>å¤©ç«ç¸å³</b></div>'},c2c_activity:{tmpl:'<div class="{prefixCls}menu-extras-cate extras-active" data-key="q={c2c_activity_query} {c2c_activity_tag}&suggest=active_{$index}&tab=deal"><span class="{prefixCls}menu-key">{c2c_activity_query}</span><span class="{prefixCls}menu-cate">å¨ <b>{c2c_activity_tag}</b> ä¸­æç´¢</span></div>'},showExtra:!1}});KISSY.add("tbc/search-suggest/1.4.8/mods/bts",function(t,e,u){function n(t){n.superclass.constructor.call(this,t||{})}return KISSY.extend(n,e,{getBucket:function(){var t=this,e=t.getCookieT(),u=t.getTestBucket()||t.retBucket(e,20,-4,4)-0;return u},getTestBucket:function(){var t=location.search,e=t.match(/alg_bts=(\d+)/);return e&&e[1]?e[1]-0:void 0},getCookieT:function(){var t=new u,e=t.getCookie("t");return e},retBucket:function(t,e,u,n){return!t&&"0"||this.countBucket(t,e,u,n)},countBucket:function(t,e,u,n){var r=t.substr(u,n),c=parseInt(r,16),s=c%e+1;return s+""}},{ATTRS:{pluginId:{value:"bts"}}}),n},{requires:["base","./utils"]});KISSY.add("tbc/search-suggest/1.4.8/mods/utils",function(e,t){function n(e){return i?i:(n.superclass.constructor.call(this,e||{}),void(i=this))}var i;return KISSY.extend(n,t,{pluginInitializer:function(e){var t=this;t.set("caller",e)},getCookie:function(e){var t=window;if(t.userCookie&&!KISSY.isUndefined(t.userCookie[e]))return t.userCookie[e];if(t.SRP_COOKIES||(t.SRP_COOKIES={})&&KISSY.isUndefined(SRP_COOKIES[e])){var n=document.cookie.match("(?:^|;)\\s*"+e+"=([^;]*)");SRP_COOKIES[e]=n&&n[1]?decodeURIComponent(n[1]):""}return SRP_COOKIES[e]},fireEvent:function(e,t){var n=document;if(n.createEvent){var i=n.createEvent("MouseEvents");i.initEvent(t,!0,!1),e.dispatchEvent(i)}else n.createEventObject&&e.fireEvent("on"+t)}},{ATTRS:{pluginId:{value:"utils"}}}),n},{requires:["base"]});KISSY.add("tbc/search-suggest/1.4.8/mods/stat",function(t,e,n,a,i){function r(t){r.superclass.constructor.call(this,t||{})}return KISSY.extend(r,e,{pluginInitializer:function(t){var e=this,n=e.get("stat");e.set("caller",t),t.on("beforeSubmit",function(t){var n=t.isInitSearch;e.setStat(n)}),n&&(e.sendTongji(),e.bindSearchTrace())},bindSearchTrace:function(){var t=this;a.delegate("body","click","a",t.initSearchTrace,t)},initSearchTrace:function(t){var e=this,n=t.currentTarget,a=n.getAttribute("trace"),i=n.getAttribute("href");if(a)switch(a){case"relatedSearch":e.saveQuery();break;case"auction":var r=e.stat;r&&-1===i.indexOf("initiative_new")&&n.setAttribute("href",i+"&initiative_new=1")}},sendTongji:function(){var t,e=this,n=e.getStatInst();n.checkFlash({onSuccess:function(){t=n.query("stat")[0],t&&t.value&&(e.stat=t.value,e.send("f_stats_show="+t.value,!0))}})},setStat:function(t,e){var n=this,a=n.get("caller"),i=a.query,r=n.saveQuery(i,t);r&&n.send("lf_aclog=null-null-null-null-0&stats_click="+r,e)},getStatInst:function(){var t=this,e=t.get("caller"),n=e.get("sugConfig"),a=n.tab||"",r=new i({name:"stat",tab:a});return r},saveQuery:function(t,e){var n,a,i=this.getStatInst();return e&&t?(n=encodeURIComponent(t),a="initiative_new:1;q:"+n,i.save("stat",a)):i.deleteItem("stat"),a},send:function(t,e){var n,a;e?(n="/tongji",a="H51884970"):(n="/search",a="H51884969"),(window.goldlog_queue||(window.goldlog_queue=[])).push({action:"goldlog.record",arguments:[n,"",t,a]})},renderPlugin:function(){}},{ATTRS:{pluginId:{value:"stat"}}}),r},{requires:["base","cookie","event","../mods/local-query"]});KISSY.add("tbc/search-suggest/1.4.8/mods/local-query",function(t,e,a,s,n){function i(t){i.superclass.constructor.call(this,t||{}),this.initialize()}var r="localQuery";return KISSY.extend(i,e,{initialize:function(){var t=this,e=t.get("name"),a=t.get("tab"),s=t.get("user");"item"===a&&(a="baobei"),t.storageKey=r+e+a+s,t._getStorage()},checkFlash:function(t){this.storage.read(t)},_setKey:function(t){var e=this,a=t.name||e.get("name"),s=t.tab||e.get("tab"),n=t.user||e.get("user");"item"===s&&(s="baobei"),e.storageKey=r+a+s+n,e.set("tab",s),e.set("name",a),e.set("user",n),this.datalist=null},_save:function(t,e){if(!t.match(/<>'"/)&&!e.match(/<>'"/)){var a=this._getDatalist(),s=encodeURIComponent(t),n={key:s,value:encodeURIComponent(e),time:KISSY.now()};this._deleteItemByValue(a,s),a.unshift(n)}},_deleteItemByValue:function(t,e){for(var a,s=null,n=0;n<t.length;n++)a=t[n].key,a==e&&(s=t.splice(n,1),n--)},_query:function(t){var e,a,s=this._getDatalist(),n=[];return t?(t=encodeURIComponent(t),KISSY.each(s,function(s,i){e=s.key,a=s.value,(0===e.indexOf(t)||0===a.indexOf(t))&&n.push(s)}),this._distinctByValue(n)):this._distinctByValue(s)},_distinctByValue:function(t){for(var e,a=[],s=0,n=t.length;n>s;s++)e=t[s],e.value.match(/%3C|%3E|[<>'"]/g)||!this._hasItemOfValue(a,e.value)&&a.push(e);return a},_hasItemOfValue:function(t,e){for(var a=!1,s=t.length-1;s>=0;s--)t[s].value===e&&(a=!0);return a},_cleanBefore:function(t){for(var e,a=this._getDatalist(),s=0,n=a.length-1;n>=0;n--)if(e=a[n],e.time>t){s=n+1;break}a.length=s},_getDatalist:function(){return this.datalist||(this.datalist=this.storage.read()||[]),this.datalist},_getStorage:function(){var t=this.get("storageType");switch(t){case"flashStorage":this.storage=this._initFlashStorage();break;default:this.storage=!1}},_initFlashStorage:function(){var t=this;return{save:function(){return(new s).save(t.storageKey,a.stringify(t.datalist))},read:function(e){var i=(new s).read(t.storageKey,e);if(i){var r=a.parse(i);return r}return n}}},destructor:function(){this.datalist=null,r=null},save:function(t,e){if(""!=e){var a,s=this.storage.read();s&&(a=s.length);var n=this._save(t,e),i=this.storage.save();return a>300&&(this.datalist=this.datalist.slice(0,a-10),KISSY.log("add_before\n"+i+"\n"+a),i=this.storage.save(),KISSY.log("add_after\n"+i+"\n"+a)),n}},query:function(t){return this._query(t)},deleteItem:function(t){var e=this._getDatalist(),a=e.length;this._deleteItemByValue(e,encodeURIComponent(t));var s=this.storage.save();a>300&&(this.datalist=this.datalist.slice(0,a-10),s=this.storage.save(),KISSY.log("delete\n"+s+"\n"+a))},clearByDay:function(t){var e=KISSY.now()-24*t*3600*1e3;this._cleanBefore(e),this.storage.save()},hasHistory:function(){return this._getDatalist().length>0?!0:!1}},{ATTRS:{name:{value:"default",setter:function(t){return t}},user:{value:"",setter:function(t){return KISSY.fromUnicode(t)}},maxLength:{value:500},storageType:{value:"flashStorage",setter:function(t){return t},getter:function(t){return t}}}}),i},{requires:["base","json","../mods/storage"]});KISSY.add("tbc/search-suggest/1.4.8/mods/menu",function(e,t){var n=t.all,r=function(e){var t=this;t.opts=KISSY.mix(r.defs,e),t.$wrap=n(t.opts.wrap),t.$menu=n(t.opts.menu),t.locs=[],t.rNow=null,t.tOut=null,t.init()};return r.defs={wrap:"",menu:"",rows:"",dealy:300,handler:null,tolerance:0},r.prototype.getOffset=function(){var e=this,t=e.opts,n=e.$menu,r=n.offset();e.menuOffset=r,e.upperRight={x:r.left+n.outerWidth(),y:r.top-t.tolerance},e.lowerRight={x:r.left+n.outerWidth(),y:r.top+n.outerHeight()+t.tolerance}},r.prototype.bindEvent=function(){var e,t,r,o=this,u=o.opts,l=o.locs,a=o.rNow,i=o.tOut,s=null,f=function(i){function f(e,t){return(t.y-e.y)/(t.x-e.x)}var c=!!n(i).one(u.cls);o.getOffset(),e=o.menuOffset,t=o.upperRight,r=o.lowerRight;var p=l[l.length-1],g=l[0];if(!a||!p)return 0;if(g.x<e.left||g.x>r.x||g.y<e.top||g.y>r.y)return 0;if(s&&p.x==s.x&&p.y==s.y)return 0;var h=f(p,t),d=f(p,r),y=f(g,t),m=f(g,r);return c&&y>h&&d>m?(s=p,u.dealy):(s=null,0)},c=function(e){a!=e&&(u.handler.enterHandler(e),a=e)},p=function(e,t){o.isDelay=t?!0:!1;var n=f(t);n?i=setTimeout(function(){p(o.currentTarget,o.currentTarget)},n):(o.isDelay=!1,c(e))},g=function(e){l.push({x:e.pageX,y:e.pageY}),l.length>3&&l.shift()},h=function(){a=null,u.handler.leaveHandler()},d=function(){o.isDelay=!1,a=null,i&&clearTimeout(i)},y=function(e){if(o.currentTarget=e.currentTarget,!o.isDelay){i&&clearTimeout(i);var t=e.relatedTarget,r=n(t).parent(u.rows);p(e.currentTarget,r)}};o.$wrap.on("mousemove",g).on("mouseleave",h),o.$menu.on("mouseleave",d).delegate("mouseenter",u.rows,y)},r.prototype.init=function(){this.getOffset(),this.bindEvent()},r},{requires:["node"]});KISSY.add("tbc/search-suggest/1.4.8/tpl/cloud",function(){return{navi:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-navi-list" '+a.autoAttr+'> <div class="inner-wrap"> <a class="cloud-img-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <img src="//img.alicdn.com/tps/i1/'+a.data.logo+'_70x70.jpg" /> </a> <p>'+a.data.title+'</p> <a class="cloud-btn-wrap" href="//'+a.data.url+"?source=suggest&suggest=navi_"+a.index+'_1" target="_self"> <span class="cloud-link">'+a.data.button+"</span><i>></i> </a> </div></div>";return t},qrcode:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-qrcode" '+a.autoAttr+' > <div class="inner-wrap"> <a href="'+a.data.url+'"><img src="'+a.data.image+'"/></a> </div></div>';return t},spu:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-spu-list" '+a.autoAttr+' > <div class="inner-wrap"> <ul> ',l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-img-wrap cloud-link" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <img src="//img.alicdn.com/tps/i1/'+s.pic+'_50x50.jpg" /> </a> <a class="cloud-title" title="'+s.title+'" href="//'+s.url+"&source=suggest&suggest=spu_"+a.index+"_"+(~~i+1)+'" target="_self"> <span>'+s.title+'</span> </a> <p class="cloud-price '+(0===~~s.price?"cloud-hidden":"")+'">åèä»·:<b class="">ï¿¥'+s.price+'</b><b class="noprice">ææ </b></p> </li> ';return t+=' </ul> <p class="cloud-total '+a.ishidden+'"> <span class="total">å±'+a.count+'æ¬¾äº§å</span> <a class="more" target="_self" href="//'+a.link+"&source=suggest&suggest=spu_"+a.index+'_more">æ¥çå¨é¨>></a> </p> </div></div>'},tag:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li><a target="_self" href="'+a.action+"?q="+a.tagTitle+" "+s+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~i+1)+"&tag="+s+a.param+'" class="cloud-link"><span>'+s+"</span></a></li> ";return t+=" </ul> </div></div>"},tag_group:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="true" class="J_cloud-handle cloud-list type-taggroup" '+a.autoAttr+' > <div class="inner-wrap"><h3>'+a.tagTitle+"</h3> <ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;){s=l[i+=1],t+=' <li  class="tag-group"> <ul> ';var r=s;if(r)for(var u,d=-1,n=r.length-1;n>d;)u=r[d+=1],t+=' <li> <a target="_self" href="'+a.action+"?q="+encodeURIComponent(a.tagTitle+" "+u.title)+"&wq="+a.query+"&source=suggest&suggest=magic_"+a.index+"_"+(~~d+1)+"&tag="+u.title+a.param+'" class="cloud-link '+u.type+'"><span>'+u.title+"</span></a> </li> ";t+=" </ul> </li> "}return t+=" </ul> </div></div>"},topbrand:function(a){var t='<div id="J_CloudList'+a.prefix+'" data-align="false" class="J_cloud-handle cloud-topbrand-list" '+a.autoAttr+' > <div class="inner-wrap"> <h3>â'+a.tagTitle.substr(0,11)+"âç­é¨åç</h3><ul> ",l=a.data;if(l)for(var s,i=-1,e=l.length-1;e>i;)s=l[i+=1],t+=' <li> <a class="cloud-title cloud-link" href="//'+s.url+"&source=suggest&suggest=brandlist_"+a.index+"_"+(~~i+1)+'" target="_self"> <span><i class="cloud-top'+i+'">'+(~~i+1)+"</i>"+s.title+"</span> </a> </li> ";return t+=" </ul> </div></div>"}}});