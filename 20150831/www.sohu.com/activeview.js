/*!2015-06-23 17:00 */KSLITE.declare("tanxssp-activeview",["tanxssp-utils","tanxssp-params","tanxssp-config"],function(a,b){var c=a("tanxssp-utils"),d=a("tanxssp-params").pvid,e=a("tanxssp-config").r.ali,f=document,g={isTobeCheck:function(){return e?!1:!0},viewPortSize:function(){var a=window,b="inner";return"innerWidth"in window||(b="client",a=f.documentElement||f.body),{vw:a[b+"Width"],vh:a[b+"Height"]}},pageSize:function(){var a=f.documentElement,b=f.body;return{pw:Math.max(a.clientWidth,b.clientWidth),ph:Math.max(a.clientHeight,b.clientHeight)}},pageVisibility:function(){var a;return"undefined"!=typeof document.hidden?a="hidden":"undefined"!=typeof document.mozHidden?a="mozHidden":"undefined"!=typeof document.msHidden?a="msHidden":"undefined"!=typeof document.webkitHidden&&(a="webkitHidden"),function(){return a?~~!f[a]:-1}}(),isIframe:function(){return~~(window!=top)},pageOpenTime:parseInt(new Date/1e3,10),adRect:function(a){var b={width:0,height:0,left:0,top:0},d=this.getAdEl(a);return d&&(d.childNodes.length>0||"iframe"==d.tagName.toLowerCase())&&(b=d.getBoundingClientRect(),(void 0===b.height||void 0===b.width)&&(b=c.mix({},b),b.height=d.offsetHeight,b.width=d.offsetWidth)),b.top=Math.round(b.top),b.left=Math.round(b.left),b},adPosInPage:function(a){var b=f.documentElement,c=f.body,d=b.scrollLeft||c.scrollLeft,e=b.scrollTop||c.scrollTop;return{wx:a.left+d,wy:a.top+e}},hashCode:function(a){var b,c=0;if(0===a.length)return c;for(var d=0;d<a.length;d++)b=a.charCodeAt(d),c=(c<<5)-c+b;return(c>>>0).toString(16)},bindEvents:function(){if(this.binded)return!1;var a=this;c.addEvent(window,"scroll",function(){a.walkList()}),this.binded=!0},checkListObj:{},walkListTimer:null,walkList:function(){function a(a){var d=c.viewPortSize(),e=c.adRect(a),f={x:e.left,y:e.top},g={x:e.left+e.width,y:e.top+e.height};(f.x>=0&&f.x<=d.vw&&f.y>=0&&f.y<=d.vh||g.x>=0&&g.x<=d.vw&&g.y>=0&&g.y<=d.vh)&&(new b.checker(a),c.checkListObj[a]=!0)}this.walkListTimer&&clearTimeout(this.walkListTimer);var c=this;this.walkListTimer=setTimeout(function(){for(var b in c.checkListObj)if(c.checkListObj[b]!==!0){var d=c.getAdEl(b);d?a(b):setTimeout(function(){a(b)},100)}},50)},check:function(a){this.isTobeCheck(a)&&(this.bindEvents(),this.firstLog(a),this.isIframe()||(this.checkListObj[a]=!1,this.walkList()))},firstLog:function(a){var b=this.isIframe(),e={ah:0,ai:b,aw:0,gtm:parseInt(new Date/1e3,10),mo:0,pid:a,ta:0,vh:0,vw:0,vx:0,vy:0,wx:0,wy:0,pw:0,ph:0},f="",g=["gtm","aw","ah","vw","vh","wx","wy","vx","vy","mo","ta","ai","pw","ph"],h=[];f+="p="+d,f+="&s=0",f+="&o="+this.pageOpenTime,f+="&i="+a,f+="&f="+g.join(","),f+="&r=",c.each(g,function(a){h.push(e[a])}),f+=h.join(",");var i=this.hashCode(f);f+="&h="+i,this.send(f)},cacheAdEl:{},getAdEl:function(a){if(this.cacheAdEl[a])return this.cacheAdEl[a];for(var b=f.getElementById("tanx-a-"+a),d=b,e=0;d&&"none"==c.css(d,"display")&&(e++,6!==e);)if(d=d.previousSibling)for(;1!==d.nodeType&&(d=d.previousSibling,e++,6!==e););if(d===b||null===d){var g=f.getElementById("tanxssp-outer-con"+a)||f.getElementById("tanx_displayframe_"+a+"_l");if(!g)return null;d=g}return this.cacheAdEl[a]=d,d},canSend:function(a){if(0===a)return 0;if(1==a)return 1;var b=Math.log(a)/Math.log(2);return~~(parseInt(b,10)===b)},buildQuery:function(a){var b="",d=["gtm","aw","ah","vw","vh","wx","wy","vx","vy","mo","ta","ai","pw","ph"];b+="p="+a[0].pvid,b+="&s="+a[0].startTime,b+="&o="+this.pageOpenTime,b+="&i="+a[0].pid,b+="&f="+d.join(","),c.each(a,function(a){b+="&r=";var e=[];c.each(d,function(b){e.push(a[b])}),b+=e.join(",")});var e=this.hashCode(b);return b+="&h="+e},send:function(a){if(!e){var b=window["tanxssp-feedback-cache"]||(window["tanxssp-feedback-cache"]={}),c=new Image,d="av_"+Math.floor(1e4*Math.random()),f="//activeview.tanx.com/t?"+a;b[d]=c,c.onload=c.onerror=function(){c.onload=c.onerror=null,c=null,delete b[d]},c.src=f}}};b.checker=function(a){this.pid=a,this.hasMouseover=!1,this.checkIndex=0,this.maxCheck=33,this.dataStack=[],this.pvid=d,this.timer=null,this.startTime=null;var e=this,f=g.getAdEl(a);return f?(e.mouseListener=function(){e.hasMouseover=!0},c.addEvent(f,"mouseover",e.mouseListener),void e.check()):(setTimeout(function(){new b.checker(a)},250),!1)},b.checker.prototype.check=function(){if(this.checkIndex==this.maxCheck)return clearTimeout(this.timer),!1;var a=this,b=g,e=b.adRect(a.pid),f={pid:a.pid,pvid:d,gtm:parseInt(new Date/1e3,10),aw:e.width,ah:e.height,ai:b.isIframe(),vx:e.left,vy:e.top,ta:b.pageVisibility(),mo:~~a.hasMouseover};this.startTime||(this.startTime=f.gtm),f.startTime=a.startTime,c.mix(f,b.adPosInPage(e)),c.mix(f,b.viewPortSize()),c.mix(f,b.pageSize()),a.dataStack.push(f),a.hasMouseover=!1,b.canSend(a.checkIndex)&&(b.send(b.buildQuery(a.dataStack)),a.dataStack=[]),a.checkIndex++,a.timer=setTimeout(function(){a.check()},1e3)},c.mix(b,g)});