(function(){var e={Cookie:{set:function(e,t,a,i,s){var n="";if(a&&typeof a=="number"){var r=new Date;r.setTime(r.getTime()+a*24*60*60*1e3);n="; expires="+r.toGMTString()}var i=i||"/";var s=s||".youku.com";document.cookie=[e,"=",t,n,";domain=",s,";path=",i].join("")},get:function(e){var t=e+"=",a=document.cookie?document.cookie.split("; "):[];for(var i=0;i<a.length;i++){var s=a[i];while(s.charAt(0)==" ")s=s.substring(1,s.length);if(s.indexOf(t)==0)return s.substring(t.length,s.length)}return null},remove:function(e){this.set(e,"",-1)}},Common:{shichang:function(e){return 30*e*e-20*e},decodeBase64:function(e){if(!e)return"";var t="ABCDEFGHIJKLMNOP"+"QRSTUVWXYZabcdef"+"ghijklmnopqrstuv"+"wxyz0123456789+/"+"=";var a="",i,s,n,r,o,c,l=0,d;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{r=t.indexOf(e.charAt(l++));o=t.indexOf(e.charAt(l++));c=t.indexOf(e.charAt(l++));d=t.indexOf(e.charAt(l++));i=r<<2|o>>4;s=(o&15)<<4|c>>2;n=(c&3)<<6|d;a=a+String.fromCharCode(i);if(c!=64){a=a+String.fromCharCode(s)}if(d!=64){a=a+String.fromCharCode(n)}}while(l<e.length);return this.utf8To16(a)},utf8To16:function(e){var t,a,i;var s,n;var r=[];a=e.length;t=0;while(t<a){i=e.charCodeAt(t++);switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(e.charAt(t-1));break;case 12:case 13:s=e.charCodeAt(t++);r.push(String.fromCharCode((i&31)<<6|s&63));break;case 14:s=e.charCodeAt(t++);n=e.charCodeAt(t++);r.push(String.fromCharCode((i&15)<<12|(s&63)<<6|(n&63)<<0));break}}return r.join("")},cutStr:function(e,t,i){var e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");var s=this._strLen(e);if(s<=t){return e}else{var n=0;var r=0;str_cut=new String;r=e.length;for(var o=0;o<r;o++){n++;a=e.charAt(o);if(escape(a).length>4){n++}if(n>t){if(i){str_cut=str_cut.concat(i)}return str_cut}str_cut=str_cut.concat(a)}}},_strLen:function(e){if(!e){return 0}var t=0;var i=0;i=e.length;for(var s=0;s<i;s++){t++;a=e.charAt(s);if(escape(a).length>4){t++}}return t},serialize:function(e){return JSON.stringify(e)},deserialize:function(e){if(typeof e!="string"){return undefined}try{return JSON.parse(e)}catch(t){return e||undefined}},getBrowser:function(){var e={};var t=navigator.userAgent.toLowerCase();var a;(a=t.match(/rv:([\d.]+)\) like gecko/))?e.ie=a[1]:(a=t.match(/msie ([\d.]+)/))?e.ie=a[1]:(a=t.match(/firefox\/([\d.]+)/))?e.firefox=a[1]:(a=t.match(/chrome\/([\d.]+)/))?e.chrome=a[1]:(a=t.match(/opera.([\d.]+)/))?e.opera=a[1]:(a=t.match(/version\/([\d.]+).*safari/))?e.safari=a[1]:0;return e},bind:function(e,t,a){if(e.attachEvent){e.attachEvent("on"+t,function(){return function(t){window.event.cancelBubble=true;e.attachEvent=[a.apply(e)]}}(e),false)}else if(e.addEventListener){e.addEventListener(t,function(e){e.stopPropagation();a.apply(this)},false)}},Md5:function(e){var t=function(e,t){return e<<t|e>>>32-t};var a=function(e,t){var a,i,s,n,r;s=e&2147483648;n=t&2147483648;a=e&1073741824;i=t&1073741824;r=(e&1073741823)+(t&1073741823);if(a&i)return r^2147483648^s^n;if(a|i){if(r&1073741824)return r^3221225472^s^n;else return r^1073741824^s^n}else{return r^s^n}};var i=function(e,t,a){return e&t|~e&a};var s=function(e,t,a){return e&a|t&~a};var n=function(e,t,a){return e^t^a};var r=function(e,t,a){return t^(e|~a)};var o=function(e,s,n,r,o,c,l){e=a(e,a(a(i(s,n,r),o),l));return a(t(e,c),s)};var c=function(e,i,n,r,o,c,l){e=a(e,a(a(s(i,n,r),o),l));return a(t(e,c),i)};var l=function(e,i,s,r,o,c,l){e=a(e,a(a(n(i,s,r),o),l));return a(t(e,c),i)};var d=function(e,i,s,n,o,c,l){e=a(e,a(a(r(i,s,n),o),l));return a(t(e,c),i)};var u=function(e){var t;var a=e.length;var i=a+8;var s=(i-i%64)/64;var n=(s+1)*16;var r=Array(n-1);var o=0;var c=0;while(c<a){t=(c-c%4)/4;o=c%4*8;r[t]=r[t]|e.charCodeAt(c)<<o;c++}t=(c-c%4)/4;o=c%4*8;r[t]=r[t]|128<<o;r[n-2]=a<<3;r[n-1]=a>>>29;return r};var p=function(e){var t="",a="",i,s;for(s=0;s<=3;s++){i=e>>>s*8&255;a="0"+i.toString(16);t=t+a.substr(a.length-2,2)}return t};var h=function(e){e=e.replace(/\x0d\x0a/g,"\n");var t="";for(var a=0;a<e.length;a++){var i=e.charCodeAt(a);if(i<128){t+=String.fromCharCode(i)}else if(i>127&&i<2048){t+=String.fromCharCode(i>>6|192);t+=String.fromCharCode(i&63|128)}else{t+=String.fromCharCode(i>>12|224);t+=String.fromCharCode(i>>6&63|128);t+=String.fromCharCode(i&63|128)}}return t};var v=Array();var f,g,m,_,y,k,b,C,w;var A=7,U=12,I=17,N=22;var M=5,T=9,x=14,S=20;var D=4,E=11,j=16,H=23;var q=6,L=10,z=15,O=21;e=h(e);v=u(e);k=1732584193;b=4023233417;C=2562383102;w=271733878;for(f=0;f<v.length;f+=16){g=k;m=b;_=C;y=w;k=o(k,b,C,w,v[f+0],A,3614090360);w=o(w,k,b,C,v[f+1],U,3905402710);C=o(C,w,k,b,v[f+2],I,606105819);b=o(b,C,w,k,v[f+3],N,3250441966);k=o(k,b,C,w,v[f+4],A,4118548399);w=o(w,k,b,C,v[f+5],U,1200080426);C=o(C,w,k,b,v[f+6],I,2821735955);b=o(b,C,w,k,v[f+7],N,4249261313);k=o(k,b,C,w,v[f+8],A,1770035416);w=o(w,k,b,C,v[f+9],U,2336552879);C=o(C,w,k,b,v[f+10],I,4294925233);b=o(b,C,w,k,v[f+11],N,2304563134);k=o(k,b,C,w,v[f+12],A,1804603682);w=o(w,k,b,C,v[f+13],U,4254626195);C=o(C,w,k,b,v[f+14],I,2792965006);b=o(b,C,w,k,v[f+15],N,1236535329);k=c(k,b,C,w,v[f+1],M,4129170786);w=c(w,k,b,C,v[f+6],T,3225465664);C=c(C,w,k,b,v[f+11],x,643717713);b=c(b,C,w,k,v[f+0],S,3921069994);k=c(k,b,C,w,v[f+5],M,3593408605);w=c(w,k,b,C,v[f+10],T,38016083);C=c(C,w,k,b,v[f+15],x,3634488961);b=c(b,C,w,k,v[f+4],S,3889429448);k=c(k,b,C,w,v[f+9],M,568446438);w=c(w,k,b,C,v[f+14],T,3275163606);C=c(C,w,k,b,v[f+3],x,4107603335);b=c(b,C,w,k,v[f+8],S,1163531501);k=c(k,b,C,w,v[f+13],M,2850285829);w=c(w,k,b,C,v[f+2],T,4243563512);C=c(C,w,k,b,v[f+7],x,1735328473);b=c(b,C,w,k,v[f+12],S,2368359562);k=l(k,b,C,w,v[f+5],D,4294588738);w=l(w,k,b,C,v[f+8],E,2272392833);C=l(C,w,k,b,v[f+11],j,1839030562);b=l(b,C,w,k,v[f+14],H,4259657740);k=l(k,b,C,w,v[f+1],D,2763975236);w=l(w,k,b,C,v[f+4],E,1272893353);C=l(C,w,k,b,v[f+7],j,4139469664);b=l(b,C,w,k,v[f+10],H,3200236656);k=l(k,b,C,w,v[f+13],D,681279174);w=l(w,k,b,C,v[f+0],E,3936430074);C=l(C,w,k,b,v[f+3],j,3572445317);b=l(b,C,w,k,v[f+6],H,76029189);k=l(k,b,C,w,v[f+9],D,3654602809);w=l(w,k,b,C,v[f+12],E,3873151461);C=l(C,w,k,b,v[f+15],j,530742520);b=l(b,C,w,k,v[f+2],H,3299628645);k=d(k,b,C,w,v[f+0],q,4096336452);w=d(w,k,b,C,v[f+7],L,1126891415);C=d(C,w,k,b,v[f+14],z,2878612391);b=d(b,C,w,k,v[f+5],O,4237533241);k=d(k,b,C,w,v[f+12],q,1700485571);w=d(w,k,b,C,v[f+3],L,2399980690);C=d(C,w,k,b,v[f+10],z,4293915773);b=d(b,C,w,k,v[f+1],O,2240044497);k=d(k,b,C,w,v[f+8],q,1873313359);w=d(w,k,b,C,v[f+15],L,4264355552);C=d(C,w,k,b,v[f+6],z,2734768916);b=d(b,C,w,k,v[f+13],O,1309151649);k=d(k,b,C,w,v[f+4],q,4149444226);w=d(w,k,b,C,v[f+11],L,3174756917);C=d(C,w,k,b,v[f+2],z,718787259);b=d(b,C,w,k,v[f+9],O,3951481745);k=a(k,g);b=a(b,m);C=a(C,_);w=a(w,y)}var R=p(k)+p(b)+p(C)+p(w);return R.toLowerCase()}},User:{getYKToken:function(){return e.Cookie.get("yktk")},getUserName:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1){return a.split(",")[1].split(":")[1]}}return 0},getUID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1){return parseInt(a.split(",")[0].split(":")[1])}}return 0},getYTID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("ytid:")>-1){return parseInt(a.split(",")[3].split(":")[1])}}return 0},getisVIP:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("vip:")>-1){return!!a.split(",")[2].split(":")[1]}}return false},getLoginStatus:function(){return this.getUID()!==0}},Ajax:{getScript:function(e,t,a){if(typeof arguments[0]!="string"){return}var t=typeof arguments[1]=="function"?t:function(){};var a=typeof arguments[2]=="boolean"?a:false;var i=document.getElementsByTagName("HEAD")[0];var s=document.createElement("SCRIPT");s.type="text/javascript";s.src=e;s.onload=s.onreadystatechange=function(){if(!this.readyState||this.readyState=="loaded"||this.readyState=="complete"){t();s.onload=s.onreadystatechange=null;if(a){this.parentNode.removeChild(this)}}};i.appendChild(s)}}};window["CHUDA"]=e})();(function(){if(window.jQuery==undefined){var e=[location.protocol,"//","static.youku.com","/js/jquery.js"].join("");CHUDA.Ajax.getScript(e,function(){window.jQuery=jQuery.noConflict()},true)}Number.prototype.toFixed=function(e){var t=this+"";if(!e)e=0;if(t.indexOf(".")==-1)t+=".";t+=new Array(e+1).join("0");if(new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(e+1)+"})?)\\d*$").test(t)){var t="0"+RegExp.$2,a=RegExp.$1,i=RegExp.$3.length,s=true;if(i==e+2){i=t.match(/\d/g);if(parseInt(i[i.length-1])>4){for(var n=i.length-2;n>=0;n--){i[n]=parseInt(i[n])+1;if(i[n]==10){i[n]=0;s=n!=1}else break}}t=i.join("").replace(new RegExp("(\\d+)(\\d{"+e+"})\\d$"),"$1.$2")}if(s)t=t.substr(1);return(a+t).replace(/\.$/,"")}return this+""};UC_DOMAIN=window.UC_DOMAIN||"i.youku.com";API_DOMAIN_DEF="www.youku.com";API_DOMAIN_Link="http://lv.youku.com/page/grade/task";LINK_GRAGE_ICON="http://cps.youku.com/redirect.html?id=000145df";var t=function(e){return document.getElementById(e)};var a={targetURL:{vip:"http://cps.youku.com/redirect.html?id=000145de",lvip:"http://cps.youku.com/redirect.html?id=000145dd"},curpanel:"",userDefauleIcon:"http://static.youku.com/v1.0.1040/user/img/head/64/999.jpg",panel:{user:"qheader_username_panel",noticelist:"qheader_notice_info"},loading:'<div class="cd-hpanel-loading" id="hpanelloading"><span class="ico-loading-64"></span></div>',initHeaderUser:function(){var e=CHUDA.User.getUID();if(!e)return;window.USERINFO=undefined;var t="http://lv.youku.com/api/grade/get_uinfo?callback=QheaderModule.upUserImg";CHUDA.Ajax.getScript(t,null,true)},upUserImg:function(e){if(!t("qheader_username"))return;var i=null;if(e.errno!=undefined&&e.errno===-300003504){CHUDA.Cookie.remove("yktk");setTimeout(function(){window.location.reload()},500);return}if(e.errno!=undefined&&e.errno===0){i=e.data;if(window.localStorage){window.localStorage.setItem("USERDATA",CHUDA.Common.serialize(i))}}else if(window.localStorage&&window.localStorage.getItem("USERDATA")!=null){i=CHUDA.Common.deserialize(window.localStorage.getItem("USERDATA"))}else{return}t("qheader_userlog").className+=" patch-user-info";var s=!i.user_image?a.userDefauleIcon:i.user_image;var n="";if((i.is_vip||i.is_lvip)&&i["vip_grade"]==0){i["vip_grade"]=1}if(i.is_vip){n='<span class="vip-level-icon level-vip'+i["vip_grade"]+(i["vip_year"]===1?" level-annual":"")+'" title="ä¼é·åè±'+(i["vip_year"]===1?"å¹´è´¹":"")+"é»éä¼åï¼VIP"+i["vip_grade"]+'" id="qheader_crown_icon" data-type="vip"></span>'}else if(i.is_lvip){n='<span class="vip-level-icon level-lvip'+i["vip_grade"]+(i["vip_year"]===1?" level-annual":"")+'" title="ä¼é·åè±'+(i["vip_year"]===1?"å¹´è´¹":"")+"ç½é¶ä¼åï¼VIP"+i["vip_grade"]+'" id="qheader_crown_icon" data-type="lvip"></span>'}else if(i["vip_grade"]>0){n='<span class="vip-level-icon level-expired'+i["vip_grade"]+'" title="æ¨çä¼é·åè±ä¼åå·²è¿æ" id="qheader_crown_icon" data-type="vip"></span>'}var r='<div class="yk-userlog-after-meta"><img class="yk-userlog-after-avatar" src="'+s+'"><span class="yk-userlog-after-name'+(i.is_vip||i.is_lvip?" patch-red-name":"")+'" title="'+i.user_name+'" id="qheaer_user_name">'+CHUDA.Common.cutStr(i.user_name,10,null)+"</span>"+n+'<span class="user-grade-icon user-grade-lv'+i.grade+'" title="ä¼é·ç­çº§ï¼'+i.grade+'" id="qheader_grade_icon"></span><b class="caret yk-userlog-after-caret"></b></div>';t("qheader_username_show").innerHTML=r;window.USERDATA=i;CHUDA.Common.bind(t("qheaer_user_name"),"click",function(){window.location.href="http://"+UC_DOMAIN+"/u/home?type=watch_timeline";return false});var o=this,c=t("qheader_crown_icon");if(c!=undefined){CHUDA.Common.bind(c,"click",function(){window.location.href=o.targetURL[c.getAttribute("data-type")];return false})}CHUDA.Common.bind(t("qheader_grade_icon"),"click",function(){window.location.href=LINK_GRAGE_ICON;return false});this.showUserMsgInit({init:true,userIdEncode:"profile",isverified:false,is_verify_email:1,is_verify_mobile:false})},showUserMsg:function(){a.curpanel="user";var e=t(a.panel.user);if(!e){return false}a.showsign();if(!window.USERZPD)a.showUserZpd();if(window.USERINFO==undefined){var i="http://lvip.youku.com/api/user/get_user_info?uid="+CHUDA.User.getUID()+"&access_token="+encodeURIComponent(CHUDA.User.getYKToken())+"&callback=QheaderModule.showUserMsgCallback";CHUDA.Ajax.getScript(i,null,true)}else{a.showUserMsgInit(window.USERINFO)}},showsign:function(){var e="http://actives.youku.com/task/signv2/issigned?&callback=QheaderModule.showsignCallback";CHUDA.Ajax.getScript(e,null,true)},showsignCallback:function(e){window.SIGNTAG=typeof e.errno!="undefined"&&e.errno===-300003604?1:0;var t=document.getElementById("qheaderSignTag");if(t)t.innerHTML=typeof window.SIGNTAG==="number"&&window.SIGNTAG===1?"å»è¿½å§":"ç­¾å°"},showUserMsgInit:function(e){t(a.panel.user).innerHTML='<div class="cd-hpanel-ico ico-arrow-top-grey"></div>';var i=window.USERDATA;var s=document.createElement("div");s.className="cd-hpanel-user-info";if(CHUDA.User.getLoginStatus()){var n=i.user_image||a.userDefauleIcon;var r='<div class="cd-hpanel-user-avatar">'+'<a href="http://'+UC_DOMAIN+"/u/"+e["userIdEncode"]+'" target="_blank"><img src="'+n+'"></a></div>';var o='<div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name"><a href="http://'+UC_DOMAIN+"/u/"+e["userIdEncode"]+'" target="_blank" title="'+i.user_name+'"'+(i.is_vip||i.is_lvip?' class="patch-red-name"':"")+">"+CHUDA.Common.cutStr(i.user_name,12,"...")+"</a></div>";o+='<div class="cd-hpanel-user-credit">';if(i.is_vip){o+='<a href="'+this.targetURL["vip"]+'" target="_blank"><span class="vip-level-icon level-vip'+i["vip_grade"]+(i["vip_year"]===1?" level-annual":"")+'" title="ä¼é·åè±'+(i["vip_year"]===1?"å¹´è´¹":"")+"é»éä¼åï¼VIP"+i["vip_grade"]+'"></span></a>'}else if(i.is_lvip){o+='<a href="'+this.targetURL["lvip"]+'" target="_blank"><span class="vip-level-icon level-lvip'+i["vip_grade"]+(i["vip_year"]===1?" level-annual":"")+'" title="ä¼é·åè±'+(i["vip_year"]===1?"å¹´è´¹":"")+"ç½é¶ä¼åï¼VIP"+i["vip_grade"]+'"></span></a>'}else if(i["vip_grade"]>0){o+='<a href="'+this.targetURL["vip"]+'" target="_blank"><span class="vip-level-icon level-expired'+i["vip_grade"]+'" title="æ¨çä¼é·åè±ä¼åå·²è¿æ"></span></a>'}o+='<a href="'+LINK_GRAGE_ICON+'" target="_blank"><span class="user-grade-icon user-grade-lv'+i.grade+'" title="ä¼é·ç­çº§ï¼'+i.grade+'"></span></a>';if(e["isverified"]){o+='<a href="http://'+UC_DOMAIN+'/u/rz" target="_blank"><i class="ico-cert" title="è®¤è¯ç¨æ·"></i></a>'}if(e["is_verify_email"]!=0){o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mail.html" target="_blank"></a></div>'}else{o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security.html" target="_blank"></a></div>'}if(e["is_verify_mobile"]!=true){o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone"><a class="cd-hpanel-ico ico-valid-phone" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a>';if(!e["init"]){if(e["is_verify_email"]==0){o+='<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">ç»å®ææº</a></div></div>'}else{o+='<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">å»ç»å®</a></div></div>'}}o+="</div>"}else{o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone-done"><a class="cd-hpanel-ico ico-valid-phone-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a></div>'}o+="</div>";o+='<div class="cd-hpanel-user-vip">';if(i.is_vip){o+='<div class="user-vip-item">é»éä¼åå©ä½<span>'+i["vip_last_day"]+'</span>å¤©</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=00014639" target="_blank" title="ç»­è´¹é»éä¼å"><span>ç»­è´¹</span><i></i></a>';this.cpsStatistics("00014639")}else if(i.is_lvip){o+='<div class="user-vip-item">ç½é¶ä¼åå©ä½<span>'+i["lvip_last_day"]+'</span>å¤©</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463b" target="_blank" title="ç»­è´¹ç½é¶ä¼å"><span>ç»­è´¹</span><i></i></a>';this.cpsStatistics("0001463b")}else{o+='<div class="user-vip-item">å å¥ä¼ååå¹¿å</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463a" target="_blank" title="å¼éä¼é·åè±ä¼å"><span>å¼é</span><i></i></a>';this.cpsStatistics("0001463a")}o+="</div>";o+='<div class="cd-hpanel-user-extend"><a href="http://'+UC_DOMAIN+'/u/setting/base_profile.html" target="_blank">è®¾ç½®</a><span class="cd-hpanel-split">|</span><a href="javascript:;" onclick="setTimeout(function(){logout();},200);return false;">ç»åº</a></div></div>';var c='<div class="cd-hpanel-user-zpd" id="cdhpaneluserzpd"></div>';var l='<div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div><div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';s.innerHTML=r+o+c+l}else{var d='<div class="cd-hpanel-user-avatar"><a><img src="http://static.youku.com/index/img/toolbar/toolbar_avatar.jpg" alt=""></a></div>'+'<div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name">Hi, æ¨å¥½ï½ï½</div>'+'<p>ç»å½å¯ä»¥ææ¶é¿ç©åçº§å¦~</p></div><div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div>'+'<div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';s.innerHTML=d}t(a.panel.user).appendChild(s);if(c){a.showUserZpdInit()}if(CHUDA.User.getLoginStatus()){var u=document.createElement("div");u.className="panel-user-grade";var p=[],h=Math.round(i.score/6)/10,v=Math.round(i.upgrade_score/6)/10;p.push('<div class="panel-user-grade-title"><span>æçç­çº§</span><a class="panel-user-grade-reward-a" href="'+LINK_GRAGE_ICON+'" target="_blank">ç«å³é¢å></a><div class="panel-user-grade-reward">ä¸å±ç¤¼åï¼</div></div>');if(i.grade>=100){var f=99}else{var f=i.grade}p.push('<div class="panel-user-grade-line">');p.push('<a class="panel-user-grade-left-new">'+f+'</a><a class="panel-user-grade-center-new"></a><a class="panel-user-grade-right-new">'+parseInt(f+1)+"</a>");p.push('<div class="panel-user-grade-time-new" id="panelusergradetimenew">');var g=i.today_score>i.today_max_score?i.today_max_score:i.today_score;var m=223,_=Math.ceil((i.score-CHUDA.Common.shichang(f))/(CHUDA.Common.shichang(f+1)-CHUDA.Common.shichang(f))*m);if((i.score/60).toFixed(1)==(CHUDA.Common.shichang(f+1)/60).toFixed(1)){_=223}var y=i.score-CHUDA.Common.shichang(f)<=0?"":i.score-CHUDA.Common.shichang(f)<4?"0.1":((i.score/60).toFixed(1)-(CHUDA.Common.shichang(f)/60).toFixed(1)).toFixed(1);p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-left-new">'+f+"</a>");if(i.score-CHUDA.Common.shichang(f)>0){p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-center-new" id="rank_todayDuraLine">'+y+"å°æ¶</a>");p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-right-new"></a>')}p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-next '+(i.grade>=100?"panel-user-grade-next-top":"")+'">'+parseInt(f+1)+"</a>");p.push('<div class="panel-user-grade-line-hover" id="panelusergradelinehover"><div class="panel-user-grade-line-today"><i></i><em>ä»æ¥å·²æé¿'+(i.today_score/60).toFixed(1)+'å°æ¶</em></div><div class="panel-user-grade-line-todaymore"><i></i><em>æå¤å¯åå¢å '+((i.today_max_score*(i.is_vip?1.2:i.is_lvip?1.1:1)/60).toFixed(1)-(g/60).toFixed(1)).toFixed(1)+"å°æ¶</em></div></div>");p.push("</div>");p.push("</div>");p.push('<div class="panel-user-grade-info-new">');p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nowlv">'+(CHUDA.Common.shichang(f)/60).toFixed(1)+"å°æ¶</a>");p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nextlv '+(i.grade>=100?"panel-grade-icon-nextlv-top":"")+'">'+(CHUDA.Common.shichang(f+1)/60).toFixed(1)+"å°æ¶</a>");p.push("</div>");u.innerHTML=p.join("");t(a.panel.user).appendChild(u);if(!e["init"]&&_>0){jQuery("#rank_todayDuraLine").animate({width:_+"px"},"slow","swing")}var k=document.createElement("div");k.className="cd-hpanel-u-task";var b='<div class="u-task-title"><span>æçä»»å¡</span></div>';k.innerHTML=b;var C=document.createElement("div");C.className="u-task-list";C.setAttribute("id","tasklistsidetool");var w='<div class="sign1" style="overflow:hidden;">';w+='<div class="s-img" style="float:left;width:50px;height:50px;margin-right:5px;"><img src="http://static.youku.com/lvip/img/app/sign/task20151126.png" width="100%" height="100%"></div>';w+='<div class="s-com" style="float:left;width:175px;margin-right:5px;line-height:17px;margin-top:5px;">';w+='<p style="color:#7dd3f7;font-size:12px;">ç­¾å°é¢ç§¯å</p>';w+='<p style="color:#909090;font-size:12px;">ç§¯åæ¢è±ªç¤¼ï¼iPhone 6sééå</p>';w+="</div>";w+='<div class="s-link" style="float:right;margin-top:10px;" id="signLink">';w+='<a href="http://actives.youku.com/task/show/index" target="_blank" id="qheaderSignTag" style="display:block;width:50px;height:28px;text-align:center;font-size:12px;line-height:28px;color:#fff;background:#ff6600;">'+(typeof window.SIGNTAG==="number"&&window.SIGNTAG===1?"å»è¿½å§":"ç­¾å°")+"</a>";w+="</div>";w+="</div>";C.innerHTML=w;k.appendChild(C);t(a.panel.user).appendChild(k);var A=document.createElement("div");A.className="cd-hpanel-userservices";A.innerHTML='<ul class="cd-userservices-list cd-userservices-list-topborder"><li class="u-service-chanel">'+'<a href="http://'+UC_DOMAIN+"/u/"+e["userIdEncode"]+'" target="_blank"><i class="cd-hpanel-ico ico-myspace"></i>æçé¢é</a></li>'+'<li class="u-service-manage"><a href="http://'+UC_DOMAIN+'/u/videos" target="_blank"><i class="cd-hpanel-ico ico-videomanage"></i>'+'åä½ä¸­å¿</a></li><li class="u-service-favor"><a href="http://faxian.youku.com/" target="_blank">'+'<i class="cd-hpanel-ico ico-yourfavor"></i>ç²¾å½©åç°</a></li><li class="u-service-subscribe"><a href="http://'+UC_DOMAIN+'/u/home?type=favorite" target="_blank">'+'<i class="cd-hpanel-ico ico-subscribe"></i>æçæ¶è</a></li></ul>';t(a.panel.user).appendChild(A)}else{var U=document.createElement("div");U.className="cd-hpanel-oauth-login";var I='<button class="btn btn-large" href="jsvascript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">ç«å³ç»å½</button>'+'<a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-qq" title="QQ"><span>qq</span></a>'+'<a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-weibo" title="å¾®å"><span>å¾®å</span></a>'+'<a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-alipay" title="éè¿æ¯ä»å®æ«æå¯ç´æ¥æ³¨åãç»å½ä¼é·äº"><span>æ¯ä»å®</span></a>'+'<span class="extend">æ²¡æè´¦å·? <a href="http://www.youku.com/user/signup" target="_blank">åè´¹æ³¨å</a></span>';U.innerHTML=I;t(a.panel.user).appendChild(U)}setTimeout(function(){a.userMsgShowHover()},500);this.cpsStatistics("0001472a")},showUserMsgCallback:function(e){if(e.errno!=undefined&&e.errno===-300003504){CHUDA.Cookie.remove("yktk");setTimeout(function(){window.location.reload()},500);return}if(e.errno===undefined||e.errno!=0){return}window.USERINFO=e.data;this.showUserMsgInit(window.USERINFO)},makeTasklistHtml:function(e){var t="";if(!e["tasklist"]||e["tasklist"].length<=0){t='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">æ´å¤ç²¾å½© æ¬è¯·æå¾...</p></div>';return t}var a=false;var i="";for(var s=0;s<e["tasklist"].length;s++){var n="u-task-meta";if(e["tasklist"][s]["status"]==2){n="u-task-meta u-task-meta-done"}else if(e["tasklist"][s]["status"]==1){n="u-task-meta"}t+='<div class="'+n+'" id="task_list_'+e["tasklist"][s]["tid"]+'" name="tasklistidetool" tid="'+e["tasklist"][s]["tid"]+'" ttype="'+e["tasklist"][s]["type"]+'">'+'<a class="u-task-m-link"><img src="'+e["tasklist"][s]["icon"]+'"><span class="u-task-link-icon-done"></span></a>'+'<div class="u-task-m-entry"><a class="u-task-m-e-title" title="'+e["tasklist"][s]["name"]+'">'+e["tasklist"][s]["name"]+"</a>"+'<span title="'+e["tasklist"][s]["desc"]+'">'+e["tasklist"][s]["desc"]+"</span>"+'<div class="u-task-m-e-reward"><span>å¥å±ï¼</span>';for(var r=0;r<e["tasklist"][s]["awards"].length;r++){if(e["tasklist"][s]["awards"][r]["type"]==1&&a==false){a=true}if(e["tasklist"][s]["awards"][r]["detail"]){t+='<span class="reward-entry">'+e["tasklist"][s]["awards"][r]["detail"]+"</span>"}}t+="</div></div>";if(e["tasklist"][s]["status"]==2){t+='<span class="u-task-m-status u-task-m-status-done" id="task_receive_'+e["tasklist"][s]["tid"]+'">é¢å¥å±</span>'}else if(e["tasklist"][s]["status"]==1){if(e["tasklist"][s]["type"]!=10){if(e["tasklist"][s]["progress"]&&e["tasklist"][s]["progress"].length>0){if(e["tasklist"][s]["progress"]==="0/1"){t+='<span class="u-task-m-status u-task-m-status-ing">è¿è¡ä¸­â¦</span>'}else{t+='<span class="u-task-m-status u-task-m-status-degree">'+e["tasklist"][s]["progress"]+"</span>"}}else{i="";if(typeof e["tasklist"][s]["toUrl"]==="string"&&e["tasklist"][s]["toUrl"].length>0){i=' data-tourl="'+e["tasklist"][s]["toUrl"]+'"'}t+='<span class="u-task-m-status u-task-m-status-progress" id="toolbar_initiative_task_'+e["tasklist"][s]["tid"]+'"'+i+">é¢ä»»å¡</span>"}}else{if(e["tasklist"][s]["special_task_type"]&&e["tasklist"][s]["special_task_type"]==2){var o=!e["tasklist"][s]["special_task_source"]?"http://www.youku.com":e["tasklist"][s]["special_task_source"];t+='<span class="u-task-m-status u-task-m-status-progress"><a href="'+o+'" target="_blank">åä»»å¡</a></span>'}else{t+='<span class="u-task-m-status u-task-m-status-progress" id="do_task_'+e["tasklist"][s]["tid"]+'">åä»»å¡</span>'}}}t+="</div>"}if(a){var c=window.USERDATA;if(c.is_vip){t+='<div class="u-task-meta-hint"><i class="ico__vipsuper"></i><span>é»éä¼åååç§¯å</span></div>'}else{t+='<div class="u-task-meta-hint u-task-meta-hint-no"><i class="cd-hpanel-ico ico__vipsuper_no"></i><span>é»éä¼åååç§¯å</span></div>'}}return t},userMsgShowHover:function(){if(t("sidetoolqrcodepanelshow")){t("sidetoolqrcodepanelshow").onclick=function(){a.qrcodeShow()}}a.bindTastDivListEvent();var e=t("panelusergradetimenew");if(e){jQuery("#panelusergradetimenew").hover(function(e){if(jQuery(e.target).hasClass("panel-user-grade-next")||jQuery(e.target).hasClass("panel-user-grade-left-new")){}else{jQuery("#panelusergradelinehover").show()}},function(){jQuery("#panelusergradelinehover").hide()})}},bindTastDivListEvent:function(){var e=a._getElementsByName("div","tasklistidetool");if(!e){return}var i=e.length;for(var s=0;s<i;s++){var n=e[s].getAttribute("tid");(function(e){if(t("task_receive_"+e)){t("task_receive_"+e).onclick=function(){var t="http://"+API_DOMAIN_DEF+"/index_QSideToolJSONP?function[]=userReceiveAward&callback[]=QheaderModule.userReceiveAwardCallback&tid="+e;CHUDA.Ajax.getScript(t,null,true)}}if(t("do_task_"+e)){t("do_task_"+e).onclick=function(){taskUpdateUserInfo(e,0)}}if(t("toolbar_initiative_task_"+e)){t("toolbar_initiative_task_"+e).onclick=function(){doInitiativeTask(e,0)}}})(n)}},qrcodeShow:function(){var e=t(a.panel.user).select(".cd-hpanel-code")[0];if(qrcodeLogin.getObj("toolbar")){qrcodeLogin.getObj("toolbar").delInterval()}var i={size:138,loginfrom:"toolbar",stfrom:"toolbar",hParentDom:e,isPageExist:function(){return a.curpanel=="user"?true:false},getQrcodeCallback:function(){a.qrcodeShowAnimation()},callback:function(){window.toolbarQrloginObj.isQrloginSucc=true;window.login_callback();a.initHeaderUser()}};qrcodeLogin.init("toolbar",i);setTimeout(function(){window.toolbarQrloginObj=qrcodeLogin.getObj("toolbar")},500)},qrcodeShowAnimation:function(){setTimeout(function(){a.qrcodePanelShow.call(t("sidetoolqrcodepanelshow"),a);setTimeout(function(){if(t("sidetoolqrcodepanelclose")){t("sidetoolqrcodepanelclose").onclick=function(){a.qrcodePanelClose.call(t("sidetoolqrcodepanelclose"),a);setTimeout(function(){a.qrcodeHide()},600)}}},100)},100)},qrcodeHide:function(){var e=t(a.panel.user).select(".cd-hpanel-code .ykcode-container")[0];if(e){e.remove()}if(qrcodeLogin.getObj("toolbar")){qrcodeLogin.getObj("toolbar").delInterval()}},userReceiveAwardCallback:function(e){if(e&&e["ret"]&&e["ret"]=="OK"&&e["tid"]){if(t("task_list_"+e["tid"])){a.userReceiveAward.call(t("task_list_"+e["tid"]),a)}}},getUserTaskList:function(){if(t("tasklistsidetool")){var e="http://lvip.youku.com/api/user/get_user_task?uid="+CHUDA.User.getUID()+"&callback=QheaderModule.getUserTaskListCallback";CHUDA.Ajax.getScript(e,null,true)}},getUserTaskListCallback:function(e){if(e.errno===undefined||e.errno!=0){return}var e=e.data;if(e["tasklist"]&&e["tasklist"].length>0&&t("tasklistsidetool")){var i=a.makeTasklistHtml(e);var s=jQuery("#tasklistsidetool");s.html(i);a.bindTastDivListEvent()}else if(t("tasklistsidetool")){t("tasklistsidetool").innerHTML='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">æ´å¤ç²¾å½© æ¬è¯·æå¾...</p></div>'}},qrcodePanelShow:function(e){var t=jQuery;var a=e;var i=CHUDA.Common.getBrowser();var s=t(this).parent(),n=s.find(".ykcode-container"),r=s.find(".ykcode-cover"),o=r.find(".ykcode-cover-img");var c=300;t(this).hide();n.css("display","block");if(i.ie&&parseInt(i.ie)<10){s.css({height:"330px",width:"274px",zIndex:"100"});return}r.show();s.on("hover",function(){return false}).css({width:"32px",height:"32px",zIndex:"100",overflow:"hidden"}).animate({width:"330px",height:"274px"},c,function(){o.css({transition:"transform 0.35s","-webkit-transition":"-webkit-transform 0.35s","-moz-transition":"-moz-transform 0.35s","-o-transition":"-o-transform 0.35s","-ms-transition":"-ms-transform 0.35s",transform:"rotate(-55deg)","-webkit-transform":"rotate(-55deg)","-moz-transform":"rotate(-55deg)","-o-transform":"rotate(-55deg)","-ms-transform":"rotate(-55deg)"});r.delay(c+350).hide(1)})},qrcodePanelClose:function(e){var t=jQuery;var a=e;var i=CHUDA.Common.getBrowser();var s=t(this).parent().parent(),n=t(this).parent(),r=s.find(".ykcode-flag"),o=s.find(".ykcode-cover"),c=o.find(".ykcode-cover-img");var l=300;if(i.ie&&parseInt(i.ie)<10){n.hide();r.show();s.css({height:"auto",width:"auto",overflow:""});return}o.show();c.css("display");c.css({transition:"transform 0.25s","-webkit-transition":"-webkit-transform 0.25s","-moz-transition":"-moz-transform 0.25s","-o-transition":"-o-transform 0.25s","-ms-transition":"-ms-transform 0.25s",transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)"});s.delay(230).animate({width:"32px",height:"32px"},l,function(){n.hide();o.hide();r.show()})},userReceiveAward:function(e){var t=jQuery;var a=e;var i=t(this).find("span.reward-entry"),s=t(".cd-integral");var n=t('<div class="u-task-mask"><p>é¢åæå</p></div>');meta=t("<div class='task-reward-meta'></div>");t.each(i,function(e){t(i[e]).appendTo(meta)});var r=t(this).find("div.u-task-mask");if(r.length){r.remove()}t(this).fadeOut("fast",function(){t(this).addClass("u-task-meta-reward");n.append(meta);t(this).append(n);t(this).removeClass("u-task-meta-done");t(this).fadeIn(function(){t(this).delay(1700).slideUp(300,function(){t(this).remove();a.getUserTaskList()})})})},showUserZpd:function(){var e="http://cvip.youku.com/zpd_api/get_medal_list?&callback=QheaderModule.showUserZpdCallback";

CHUDA.Ajax.getScript(e,null,true)},showUserZpdCallback:function(e){if(e.errno!=undefined&&e.errno===-300003504){CHUDA.Cookie.remove("yktk");setTimeout(function(){window.location.reload()},500);return}if(e.errno===undefined||e.errno!=0||e.data.length==0){return}else{parseInt(t("tasklistsidetool").style.height)==106,t("tasklistsidetool").style.height="80px"}e.data=e.data.sort(function(e,t){return t.status?1:-1});window.USERZPD=e.data;this.showUserZpdInit(window.USERZPD)},showUserZpdInit:function(e){var a;if((window.USERZPD||e=="")&&t("cdhpaneluserzpd")){a=window.USERZPD}if(a&&a.length>0){var i=a.length;var s='<div class="cd-hpanel-user-zpd-content"><ul class="cd-hpanel-user-zpd-list" id="cdhpaneluserzpdlist" style="width:'+41*i+'px;left:0px;">';for(var n=j=0;j<i;j++){n=j;s+='<li><a target="_blank" href="'+a[n].info_link+'/zpd" class="'+(a[n].status?"cd-hpanel-user-zpd-follow":"cd-hpanel-user-zpd-unfollow")+'" title="'+a[n].name+'é¢éä¼å"><img src="'+a[n].medal_icon_medium+'"></a></li>'}s+="</ul>";if(i>7){s+='</div><div class="cd-hpanel-user-zpd-nav"><a class="cd-hpanel-user-zpd-prv-none" id="cdhpaneluserzpdprv" title="ä¸ä¸ä¸ª"></a><a class="cd-hpanel-user-zpd-pre" id="cdhpaneluserzpdpre" title="ä¸ä¸ä¸ª"></a></div>'}t("cdhpaneluserzpd").style.height="26px";t("cdhpaneluserzpd").innerHTML=s;if(i>7){t("cdhpaneluserzpdprv").onclick=function(){if(t("cdhpaneluserzpdprv").className.indexOf("cd-hpanel-user-zpd-prv-none")>-1){}else{var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e+41+"px";if(t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)==0){t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre";t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv cd-hpanel-user-zpd-prv-none"}else if(t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)<0){t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre";t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv"}}};t("cdhpaneluserzpdpre").onclick=function(){if(t("cdhpaneluserzpdpre").className.indexOf("cd-hpanel-user-zpd-pre-none")>-1){}else{var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e-41+"px";if(t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)==41*(7-a.length)){t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre cd-hpanel-user-zpd-pre-none";t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv"}else if(parseInt(t("cdhpaneluserzpdlist").style.left)>41*(7-a.length)){t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre";t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv"}}}}}},_getElementsByName:function(e,t){var a=[];var i=document.getElementById("qheader_box");var s=i.getElementsByTagName(e);for(var n=0;n<s.length;n++){if(s[n].getAttribute("name")==t){a[a.length]=s[n]}}return a},MSGCENTER_LINK:"http://msg.youku.com/page/msg/index",MSGCENTER_API:"http://msg.youku.com/api/push/",noticePoll:function(){this.initNoticePannel();this.resetNoticeTypeAndCount();if(this.timer)return;this.updateNoticeNum();var e=this;this.timer=setInterval(function(){e.updateNoticeNum()},6e4)},initNoticePannel:function(){var e=document.getElementById("qheader_notice"),t=document.getElementById("qheader_notice_panel"),a=document.getElementById("qheader_notice_show"),i=document.getElementById("qheader_notice_num");if(!e||!t)return;this.getChudaMessage();if(i)i.className="chuda_qheader_spot";if(a)a.getElementsByTagName("a")[0].href=this.MSGCENTER_LINK;t.innerHTML='<div class="chuda_panel_arrow"></div><div id="qheader_notice_info" class="chuda_notice_box"></div>';this.curNoticeTab="privateMsg"},updateNoticeNum:function(){var e=CHUDA.User.getUID();if(!e)return;CHUDA.Ajax.getScript("http://notify.youku.com/notify/get.json?uid="+e+'&types=["umc_notice","mvip.msg.state"]&callback=QheaderModule.updateNoticeNumCallback',null,true)},subscribeCount:0,resetNoticeTypeAndCount:function(){this.noticeCount={activityMsg:0,privateMsg:0,systemMsg:0};this.noticeType={privateMsg:{notify:"umc_notice",category:3,type:"private_msg",parentCat:"privateMsg",subCats:[6]},comments:{notify:"umc_notice",category:4,type:"comments",parentCat:"privateMsg",subCats:[7,8,9]},act_notice:{notify:"mvip.msg.state",category:2,type:"act_notice",parentCat:"activityMsg",subCats:[2]},renewal:{notify:"mvip.msg.state",category:3,type:"renewal",parentCat:"systemMsg",subCats:[3]},view_coupons:{notify:"mvip.msg.state",category:1e3,type:"view_coupons",parentCat:"systemMsg",subCats:[1e3]},grow_up:{notify:"mvip.msg.state",category:1001,type:"grow_up",parentCat:"systemMsg",subCats:[1001]},video_publish:{notify:"mvip.msg.state",category:1004,type:"video_publish",parentCat:"systemMsg",subCats:[1004]},self_channel:{notify:"mvip.msg.state",category:1002,type:"self_channel",parentCat:"systemMsg",subCats:[1002]}}},updateNoticeNumCallback:function(e){if(e&&e["notify"]){this.resetNoticeTypeAndCount();var t=0;if(e["notify"]["umc_notice"]){var a=e["notify"]["umc_notice"][0];for(var i in this.noticeType){if(this.noticeType[i]["notify"]!="umc_notice")continue;var s=this.noticeType[i]["category"],n=a[s]||0;this.noticeCount[this.noticeType[i]["parentCat"]]+=n}this.commentCountNew=a["4"]||0;t=a["1"]||0}if(e["notify"]["mvip.msg.state"]){var a=e["notify"]["mvip.msg.state"][0];for(var i in this.noticeType){if(this.noticeType[i]["notify"]!="mvip.msg.state")continue;var s=this.noticeType[i]["category"],n=a[s]||0;this.noticeCount[this.noticeType[i]["parentCat"]]+=n}}this.initNoticeSpot();this.subscribeCount=t;this.initSubscribeSpot()}},initSubscribeSpot:function(){var e=document.getElementById("subscribe_lsidetooln_flag"),t=document.getElementById("subscribe_lsidetoolw_flag");if(this.subscribeCount>0){if(e){e.innerHTML=this.subscribeCount>50?"...":this.subscribeCount;e.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num";e.style.display="block"}if(t){t.innerHTML=this.subscribeCount>50?"...":this.subscribeCount;t.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num";t.style.display="block"}}else{if(e)e.style.display="none";if(t)e.style.display="none"}},initNoticeSpot:function(){var e=0;for(var t in this.noticeCount){var a=this.noticeCount[t];var i=document.getElementById("chuda_spot_"+t);if(i)i.style.display=a>0?"block":"none";e+=a}if(document.getElementById("qheader_notice_num"))document.getElementById("qheader_notice_num").style.display=e>0?"block":"none";if(document.getElementById("chuda_notice_clear"))document.getElementById("chuda_notice_clear").style.display=e>0?"block":"none";return e},showNoticeList:function(){this.curpanel="notice";var e=document.getElementById("qheader_notice_info");if(!e)return;e.innerHTML="";if(CHUDA.User.getLoginStatus()){var t=false;if(window.USERDATA!=undefined){t=window.USERDATA["is_vip"]||window.USERDATA["is_lvip"]}else{t=CHUDA.User.getisVIP()}e.parentNode.className="chuda_notice_panel"+(t?" chuda_notice_vip":"");var a=[];a.push('<div class="chuda_notice_hd"><ul><li'+(this.curNoticeTab==="activityMsg"?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="activityMsg">æ´»å¨æ¶æ¯</a><span class="chuda_notice_spot" id="chuda_spot_activityMsg"></span></li><li'+(this.curNoticeTab==="privateMsg"?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="privateMsg">ä¸æç¸å³</a><span class="chuda_notice_spot" id="chuda_spot_privateMsg"></span></li><li'+(this.curNoticeTab==="systemMsg"?' class="notice_current"':"")+'><a href="javascript:void(0)" class="chuda_notice_tab" data-tab="systemMsg">ç³»ç»æ¶æ¯</a><span class="chuda_notice_spot" id="chuda_spot_systemMsg"></span></li></ul></div>');a.push('<div class="chuda_notice_bd">');a.push('<div class="chuda_notice_inner'+(this.curNoticeTab==="activityMsg"?" notice_current":"")+'">'+(this.noticeCount["activityMsg"]===0?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>");a.push('<div class="chuda_notice_inner'+(this.curNoticeTab==="privateMsg"?" notice_current":"")+'">'+(this.noticeCount["privateMsg"]===0?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>");a.push('<div class="chuda_notice_inner'+(this.curNoticeTab==="systemMsg"?" notice_current":"")+'">'+(this.noticeCount["systemMsg"]===0?'<div class="chuda_notice_empty"></div>':'<div class="chuda_notice_loading"></div>')+"</div>");a.push("</div>");a.push('<div class="chuda_notice_ft"><a href="javascript:void(0)" class="chuda_notice_clear" id="chuda_notice_clear">å¨é¨å·²è¯»</a><a class="chuda_notice_rightlink" href="'+this.MSGCENTER_LINK+'" target="_blank">æ¥çå¨é¨æ¶æ¯></a></div>');e.innerHTML=a.join("");this.initNoticeSpot();CHUDA.Ajax.getScript(this.MSGCENTER_API+"getnewmsglist?"+this.getApiSignature()+"&callback=QheaderModule.showNoticeListCallback",null,true);this.bindTabSwitch(e);this.cpsStatistics("0001472b")}else{e.parentNode.className="chuda_notice_panel chuda_notice_notlogin";var i='<div class="chuda_notice_notlogin_hd"><h3 class="chuda_notice_notlogin_title">æçéç¥</h3></div>';i+='<div class="chuda_notice_notlogin_bd"><div class="chuda_notice_notlogin_tips"><span class="chuda_notice_notlogin_icon"></span><p>ç»å½åå¯ä»¥çå°æµ·éä¿¡æ¯</p><p>åä¸ç²¾å½©æ´»å¨ï½</p></div>';i+='<a class="chuda_notice_notlogin_btn" href="javscript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">é©¬ä¸ç»å½</a></div>';e.innerHTML=i}},showNoticeListCallback:function(e){var t=this,a=3,i=6;if(e.errno===undefined||e.errno!=0){jQuery(".chuda_notice_loading").html('<div class="chuda_notice_tips">è·åæ°æ®è¶æ¶ï¼<a href="javascript:void(0)" class="chuda_notice_reload">éæ°å è½½</a></div>');jQuery(".chuda_notice_reload").one("click",function(){t.showNoticeList()});return}var s=e.data,n=jQuery("#qheader_notice_info .chuda_notice_inner"),r={activityMsg:[],privateMsg:[],systemMsg:[]};for(var o in s){var c=s[o];if(!c["sub_type"])continue;for(var l in this.noticeType){if(jQuery.inArray(c["sub_type"],this.noticeType[l]["subCats"])>=0){var d=r[this.noticeType[l]["parentCat"]];if(d.length===i)continue;d.push('<li data-type="'+this.noticeType[l]["type"]+'" data-msgid="'+c["msgid"]+'" data-catid="'+c["sub_type"]+'"><div class="notice_node"><span class="'+(c["isfromvip"]?"chuda_notice_crown":"chuda_notice_spot")+'"></span><span title="'+c["contents"]+'">'+c["contents"]+'</span><a href="javascript:void(0)" title="æ¥çè¯¦æ" target="_blank">æ¥ç></a></div></li>')}}}n.eq(0).html(r["activityMsg"].length?'<ul class="chuda_notice_list">'+r["activityMsg"].join("")+"</ul>":'<div class="chuda_notice_empty"></div>');n.eq(1).html(r["privateMsg"].length?'<ul class="chuda_notice_list">'+r["privateMsg"].join("")+"</ul>":'<div class="chuda_notice_empty"></div>');n.eq(2).html(r["systemMsg"].length?'<ul class="chuda_notice_list">'+r["systemMsg"].join("")+"</ul>":'<div class="chuda_notice_empty"></div>');jQuery(".chuda_notice_list li").hover(function(){jQuery(this).addClass("notice_hover")},function(){jQuery(this).removeClass("notice_hover")}).one("click",function(){jQuery(this).addClass("notice_visited");t.resetNoticeNum(jQuery(this).attr("data-msgid"),jQuery(this).attr("data-catid"));t.noticeCount[t.curNoticeTab]-=1;t.initNoticeSpot();if(jQuery(this).parent().children("li").length===i&&jQuery(this).parent().children("li.notice_visited").length===i){setTimeout(function(){t.showNoticeList()},2e3)}});jQuery(".chuda_notice_list a").each(function(){jQuery(this).attr("href",t.MSGCENTER_LINK+"?type="+jQuery(this).parent().parent().attr("data-type"));jQuery(this).click(function(e){e.stopPropagation()})})},resetNoticeNum:function(e,t){if(CHUDA.User.getUID()&&t){var a=new Image;a.src=this.MSGCENTER_API+"readcomfirm_msg?"+this.getApiSignature()+"&msgid="+e+"&type="+t}},getApiSignature:function(){var e=Math.round((new Date).getTime()/1e3),t=CHUDA.User.getYKToken(),a=CHUDA.User.getUID(),i="1001";return"appid="+i+"&ts="+e+"&uid="+a+"&access_token="+t+"&sig="+CHUDA.Common.Md5([i,e,a,decodeURIComponent(t)].join(""))},bindTabSwitch:function(e){var t=jQuery(e).find(".chuda_notice_inner"),a=this;jQuery(e).find(".chuda_notice_tab").each(function(e){var i=this;jQuery(i).unbind("click").bind("click",function(){if(jQuery(i).parent().hasClass("notice_current"))return;a.curNoticeTab=jQuery(i).attr("data-tab");jQuery(i).parent().addClass("notice_current").siblings().removeClass("notice_current");t.eq(e).addClass("notice_current").siblings().removeClass("notice_current")})});jQuery("#chuda_notice_clear").click(function(){jQuery(".chuda_notice_list li").addClass("notice_visited");a.resetNoticeNum("","2,3,6,7,8,9,1000,1001");a.resetNoticeTypeAndCount();a.initNoticeSpot();setTimeout(function(){a.showNoticeList()},1500)})},getChudaMessage:function(){var e=CHUDA.User.getLoginStatus()?this.MSGCENTER_API+"getpopupmsg?"+this.getApiSignature()+"&page_no=1&callback=QheaderModule.getChudaMessageCallback":"http://static.youku.com/lvip/msg/chuda_message.js";CHUDA.Ajax.getScript(e,null,true)},getChudaMessageCallback:function(e){if(e.errno===undefined||e.errno!=0)return;if(e.data&&e.data.msgs&&e.data.msgs.length>0){var t=Math.round((new Date).getTime()/1e3);for(i=0;i<e.data.msgs.length;i++){var a=e.data.msgs[i];if(this.showChudaMessage(a,true))break}}},initUnloginMessage:function(e){if(e&&e.length>0){var t=Math.round((new Date).getTime()/1e3);for(i=0;i<e.length;i++){if(typeof e[i]["access_time"]!="undefined"&&!isNaN(parseInt(e[i]["access_time"]))&&t<parseInt(e[i]["access_time"]))continue;if(typeof e[i]["expire_time"]!="undefined"&&!isNaN(parseInt(e[i]["expire_time"]))&&t>parseInt(e[i]["expire_time"]))continue;var a="msgid_"+e[i]["msgid"];if(!CHUDA.Cookie.get(a)&&this.showChudaMessage(e[i],false)){CHUDA.Cookie.set(a,e[i]["msgid"],1);break}}}},showChudaMessage:function(e,t){if(typeof e["status"]!="undefined"&&e["status"]!==0)return false;var a=document.getElementById("qheader_msg_panel");if(a)return false;var i=document.getElementById("qheader_notice");if(!i)return false;a=document.createElement("div");a.id="qheader_msg_panel";a.className="chuda_msg_panel";var s='<div class="chuda_panel_arrow"></div><div class="chuda_msg_box" id="qheader_msg_box">';try{if(e["type"]==1007){s+='<div class="chuda_msg_hd chuda_msg_hd_new"><div class="chuda_msg_icon"><img src="'+e["fromuid"]["img"]+'"><span>'+e["fromuid"]["name"]+'</span></div><h3 class="chuda_msg_title_new">'+e["content"]["title"]+"</h3></div>"}else{s+='<div class="chuda_msg_hd"><h3 class="chuda_msg_title">'+e["content"]["title"]+"</h3></div>"}s+='<div class="chuda_msg_bd"><div class="chuda_msg_info">'+e["content"]["ifo"]+"</div>";if(e["content"]["btnname"]){s+='<a class="chuda_msg_btn" href="'+(e["content"]["link"]&&e["content"]["link"].indexOf("http")>=0?e["content"]["link"]+'" target="_blank"':"javascript:void(0)")+'" id="qheader_msg_btn">'+e["content"]["btnname"]+"</a>"}s+='<a class="chuda_msg_close" href="#closeMsgBox" onclick="this.up(2).remove(); return false;">å³é­</a></div>'}catch(n){}s+="</div>";var r=this.MSGCENTER_API+"updatemsgstatus?"+this.getApiSignature()+"&msgid="+e["msgid"]+"&status=";if(t){var o=false;if(window.USERDATA!=undefined){o=window.USERDATA["is_vip"]||window.USERDATA["is_lvip"]}else if(CHUDA.User.getLoginStatus()){o=CHUDA.User.getisVIP()}if(o&&e["type"]!=1007&&e["type"]!=1006)a.className="chuda_msg_panel chuda_msg_vip";var c=new Image;c.src=r+"1"}a.innerHTML=s;i.parentNode.appendChild(a);if(t&&document.getElementById("qheader_msg_btn")){document.getElementById("qheader_msg_btn").onclick=function(){var e=document.getElementById("qheader_msg_panel");if(e)e.remove();var t=new Image;t.src=r+"2"}}if(!isNaN(parseInt(e["fade"]))&&parseInt(e["fade"])>0){setTimeout(function(){var e=document.getElementById("qheader_msg_panel");if(e)e.remove()},parseInt(e["fade"])*1e3)}try{var l="cps.youku.com/redirect.html?id=";if(e["content"]&&e["content"]["link"]&&e["content"]["link"].indexOf(l)>0){var d=e["content"]["link"].substr(e["content"]["link"].indexOf(l)+l.length,8);this.cpsStatistics(d)}}catch(n){}return true},cpsStatistics:function(e){if(!e)return;var t=new Image;t.src="http://p.l.youku.com/vippay?lt=2&uri="+e+"&ext="}};var s="http://static.youku.com/lvip/css/chuda_qheader.css";var n=document.createElement("link");n.setAttribute("rel","stylesheet");n.setAttribute("type","text/css");n.setAttribute("href",s);document.getElementsByTagName("head")[0].appendChild(n);window["QheaderModule"]=a})();