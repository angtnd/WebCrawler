/*
Name: main-single.js
URL: http://qsf.is.quoracdn.net/-20af14984839bd29.js
Generated: 1446517747290540
Files: /main-single.js, /jquery.js, /json2.js, /assert.js, /jquery.securepost.js, /jquery.cookie.js, /cookies.js, /scribe.js, /Class.js, /w2.context.js, /visibility.js, /jquery.dialog.js, /jquery.tooltip.js, /jquery.menu.js, /jquery.topic.js, /jquery.viewport.js, /jquery.ajax.js, /effects.core.js, /effects.shake.js, /effects.highlight.js, /lang/fun.js, /gating.js, /jquery.quora.js, /atexit.js, /tchannel_up.js, /jquery.webnode2.js, /polyfills/requestAnimationFrame.js, /w2.dialog.js, /w2.modal.js, /w2.interaction.js, /frame_busting.js, /siteuri.js, /dialog.js, /sticky.js, /view/embed.js, /mathify.js, /input_validate.js, /view/placepicker.js, /simscroll.js, /app/view/mathjax.js, /app/view/common.js, /app/view/share/connect.js, /app/view/settings.js, /app/view/board/create_box.js, /app/view/board/follow_invite.js, /app/view/signup/google_.js, /qed/sanitize.js, /qed/npd.js, /qed/modifiers.js, /qed/nodestate.js, /qed/rules.js, /qed/selection.js, /qed/snapshot.js, /qed/history.js, /qed/trie.js, /qed/snippets.js, /qed/edit.js, /app/view/post.js, /app/view/funnel.js, /app/view/moderation/flag.js, /linkify.js, /find.js, /swfobject.js, /flash.js, /html.js, /app/view/embed.js, /main-pre1.js, /keystrokes.js, /webnode2.js, /jquery.whenIdle.js, /browser.js, /w2.errors.js, /w2.perf.js, /e2e.js, /window_manager.js, /w2.rpc.js, /w2.livenode.js, /w2.event.js, /w2.quora.js, /init.js, /facebook.js, /oauth.js, /twitter.js, /google_.js, /mathjax.js, /login.js, /network.js, /mobile.js, /view/modal.js, /view/spinner.js, /action_log.js, /view/inline_editor.js, /view/embed_editor.js, /view/pmsg.js, /view/fixable2.js, /view/toggle.js, /app/view/messages.js, /view/paged_list.js, /app/view/question/wanted_answer.js, /app/view/question/cant_answer.js, /app/view/board.js, /app/view/topic/topic_list.js, /app/view/topic/topic_redesign.js, /app/view/topic/location.js, /app/view/topic/merge.js, /qed/util.js, /qed/unload.js, /app/view/share/form.js, /app/view/share/modal.js, /view/hover_menu.js, /view/editable_list.js, /app/view/nux.js, /app/view/nux/dialog.js, /app/view/nux/existing_user.js, /app/view/nux/find_friends.js, /app/view/activation/endorsement.js, /app/view/activation/endorsement/modal.js, /app/view/activation/endorsement/endorse_by_topic.js, /app/view/activation/endorsement/endorse_by_user.js, /app/view/activation/profile_topics.js, /app/view/activation/progress.js, /app/view/activation/topic_bios.js, /app/view/group.js, /email.js, /app/view/user/setup_.js, /view/toggle_list.js, /app/view/reading_list.js, /app/view/write.js, /view/upload.js, /app/view/bug_report.js, /app/view/primary_topic.js, /view/voter_list.js, /app/view/share.js, /app/view/threaded_comments.js, /view/notif.js, /qtext.js, /app/view/thread.js, /app/view/topic/topic_ontology.js, /app/view/topic/leaderboard.js, /app/view/draft.js, /app/view/board/follow.js, /app/view/board/view_tracker.js, /app/view/board/item.js, /view/topic_selector.js, /app/view/pmsg/pmsg.js, /app/view/admin.js, /app/view/suggested_photo.js, /app/view/vc.js, /app/view/widgets.js, /app/view/question/answer_tag.js, /view/photo.js, /app/view/question/add_answer.js, /app/view/question/disclaimer.js, /app/view/question/question_redirect.js, /app/view/components.js, /app/view/link.js, /app/view/static.js, /app/view/answer_wiki.js, /view/suggested_edits.js, /app/view/topic/topic_create.js, /app/view/suggested_sig.js, /app/view/announcement.js, /view/board_selector.js, /view/user.js, /app/view/layout.js, /app/view/comment.js, /view/datetime_.js, /app/view/topic/topic_editor.js, /app/view/oauth.js, /app/view/linkedin_.js, /view/invisibleinfo.js, /app/view/login.js, /app/view/question/suggested_answer.js, /app/view/photo.js, /app/view/thanks.js, /app/view/tumblr.js, /app/view/related.js, /app/view/question/question_alias.js, /app/view/question/topics.js, /app/view/user/profile.js, /app/view/question/not_helpful.js, /view/filterable_list.js, /app/view/board/submission.js, /view/announcement.js, /app/view/board/settings.js, /app/view/zapdos/card.js, /app/view/user_settings/settings.js, /view/reorderable_list.js, /view/scroll_indicator.js, /app/view/topic/faq.js, /app/view/quora_meets_bagel.js, /app/view/moderation/appeal.js, /app/view/question/answer_credibility.js, /view/tooltip.js, /view/fixable_component.js, /app/view/advertising/create_ad.js, /app/view/advertising/create_campaign.js, /app/view/advertising/manage_campaign.js, /view/privacy.js, /app/view/manage.js, /unified_view/modal.js, /unified_view/lazy.js, /main-pre2.js, /log.settings.js, /log.js, /w2.keycombo.js, /ytplayer.js, /interface/helpers.js, /interface/settings.js, /interface/jquery.js, /interface/rpc.js, /debounce.js, /rpc_manager.js, /fastclick.js, /view/captcha.js, /view/reauth.js, /unified_view/insertion_query.js, /unified_view/lazy_load_images.js, /lazy_load_images.js, /view/selector.js, /view/question_selector.js, /app/view/home.js, /interface/component.js, /unified_view/toggle.js, /interface/cookies.js, /unified_view/qtext.js, /views.js, /app/view/feed.js, /app/view/feed/feedback.js, /app/view/tutorial.js, /app/view/question.js, /app/view/question/merge/_merge.js, /app/view/question/merge/selector.js, /app/view/question/merge/modal.js, /app/view/board/blog.js, /app/view/topic.js, /app/view/signup.js, /app/view/contact_importer.js, /app/view/growl.js, /app/view/notifications/base.js, /app/view/notifications.js, /app/view/notifications/header.js, /app/view/navigation.js, /app/view/user.js, /app/view/query/query.js, /app/view/query/selector.js, /view/filter_nav_list.js, /app/view/query/filters.js, /app/view/suggestions.js, /app/view/user_stats.js, /app/view/user/content.js, /app/view/user/subscribe.js, /app/view/site_header/logged_in.js, /app/view/site_header/logged_out.js, /app/view/intro_to_quora.js, /shared_utils.js, /app/view/question/question_add.js, /qtexteditor.js, /app/view/survey/question_page.js, /async_post.js, /typeahead.js, /app/view/topic/edit_topic_modal.js, /app/view/question/lookup_bar.js, /app/view/payment/payable.js, /app/view/ask.js, /third_party/truncate.js, /app/view/quality/base.js, /app/view/quality/answer.js, /app/view/answer/improvement.js, /app/view/advertising/manage_payment.js, /app/view/advertising/ads_home.js, /app/view/signup/conversion_logging.js, /app/view/bounty/writer.js, /app/view/bounty/manage.js, /unified_view/util.js, /unified_view/action_bar/base.js, /unified_view/action_bar/answer.js, /unified_view/action_bar/_action_bar.js, /unified_view/action_bar/shared.js, /unified_view/action_bar/blog.js, /unified_view/action_bar/question.js, /unified_view/action_bar/remove_from_feed.js, /unified_view/action_bar/user.js, /interface/dialog.js, /unified_view/action_bar/overflow_menu/base.js, /unified_view/action_bar/overflow_menu/answer.js, /unified_view/action_bar/overflow_menu/profile.js, /unified_view/privacy.js, /unified_view/action_bar/overflow_menu/question.js, /unified_view/action_bar/overflow_menu/remove_from_feed.js, /unified_view/action_bar/overflow_menu/shared.js, /unified_view/bounty/manage.js, /unified_view/bounty/writer.js, /unified_view/button/abstract.js, /unified_view/button/downvote.js, /unified_view/button/follow.js, /unified_view/button/pin.js, /unified_view/button/reask.js, /unified_view/button/slow_connection.js, /unified_view/button/network.js, /unified_view/button/upvote.js, /unified_view/button/write_answer.js, /unified_view/button/writing_list.js, /unified_view/network/invite.js, /unified_view/network/join.js, /unified_view/payment/money.js, /unified_view/payment/_payment.js, /unified_view/settings/privacy.js, /unified_view/switch.js, /unified_view/mobile_debug.js, /unified_view/translation.js, /qtext2/util.js, /third_party/rangy-core.js, /qtext2/undo.js, /qtext2/parser.js, /qtext2/base.js, /qtext2/ui.js, /unified_view/upload.js, /qtext2/tests/test_util.js, /qtext2/tests/test_base.js, /qtext2/tests/test_parser.js, /qtext2/tests/main.js, /unified_view/qtext2/editor.js, /qtext2.js, /unified_view/qtext2/toolbar.js, /unified_view/character_counter.js, /unified_view/main.js, /unified_view/captcha.js, /app/view/ama.js, /view/wikipedia_demand.js, /app/view/tribes.js, /main.js, /main-loaded.js
*/
require.whenReady("settings",function(){require.install("main-single",function(require,a,b){},{})}),require.whenReady("settings",function(){require.install("jquery",function(require,a,b){(function(a,undefined){function g(a){var b=f[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}function k(a,b,c){if(c===undefined&&a.nodeType===1){var d="data-"+b.replace(j,"-$1").toLowerCase();c=a.getAttribute(d);if(typeof c=="string"){try{c=c==="true"?!0:c==="false"?!1:c==="null"?null:e.isNumeric(c)?parseFloat(c):i.test(c)?e.parseJSON(c):c}catch(f){}e.data(a,b,c)}else c=undefined}return c}function l(a){for(var b in a){if(b==="data"&&e.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function m(a,b,c){var d=b+"defer",f=b+"queue",g=b+"mark",h=e._data(a,d);h&&(c==="queue"||!e._data(a,f))&&(c==="mark"||!e._data(a,g))&&setTimeout(function(){!e._data(a,f)&&!e._data(a,g)&&(e.removeData(a,d,!0),h.fire())},0)}function L(){return!1}function M(){return!0}function U(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function V(a,b,c){b=b||0;if(e.isFunction(b))return e.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return e.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=e.grep(a,function(a){return a.nodeType===1});if(Q.test(b))return e.filter(b,d,!c);b=e.filter(b,d)}return e.grep(a,function(a,d){return e.inArray(a,b)>=0===c})}function W(a){var b=X.split(" "),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function kb(a,b){return e.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function lb(a,b){if(b.nodeType!==1||!e.hasData(a))return;var c,d,f,g=e._data(a),h=e._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,f=i[c].length;d<f;d++)e.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=e.extend({},h.data))}function mb(a,b){var c;if(b.nodeType!==1)return;b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(e.expando)}function nb(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function ob(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function pb(a){var b=(a.nodeName||"").toLowerCase();b==="input"?ob(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&e.grep(a.getElementsByTagName("input"),ob)}function qb(a,b){b.src?e.ajax({url:b.src,async:!1,dataType:"script"}):e.globalEval((b.text||b.textContent||b.innerHTML||"").replace(hb,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function Db(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,f=b==="width"?yb:zb;if(d>0)return c!=="border"&&e.each(f,function(){c||(d-=parseFloat(e.css(a,"padding"+this))||0),c==="margin"?d+=parseFloat(e.css(a,c+this))||0:d-=parseFloat(e.css(a,"border"+this+"Width"))||0}),d+"px";d=Ab(a,b,b);if(d<0||d==null)d=a.style[b]||0;return d=parseFloat(d)||0,c&&e.each(f,function(){d+=parseFloat(e.css(a,"padding"+this))||0,c!=="padding"&&(d+=parseFloat(e.css(a,"border"+this+"Width"))||0),c==="margin"&&(d+=parseFloat(e.css(a,c+this))||0)}),d+"px"}function $b(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(e.isFunction(c)){var d=b.toLowerCase().split(Qb),f=0,g=d.length,h,i,j;for(;f<g;f++)h=d[f],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function _b(a,b,c,d,e,f){e=e||b.dataTypes[0],f=f||{},f[e]=!0;var g=a[e],h=0,i=g?g.length:0,j=a===Ub,k;for(;h<i&&(j||!k);h++)k=g[h](b,c,d),typeof k=="string"&&(!j||f[k]?k=undefined:(b.dataTypes.unshift(k),k=_b(a,b,c,d,k,f)));return(j||!k)&&!f["*"]&&(k=_b(a,b,c,d,"*",f)),k}function ac(a,b){var c,d,f=e.ajaxSettings.flatOptions||{};for(c in b)b[c]!==undefined&&((f[c]?a:d||(d={}))[c]=b[c]);d&&e.extend(!0,a,d)}function bc(a,b,c,d){if(e.isArray(b))e.each(b,function(b,f){c||Fb.test(a)?d(a,f):bc(a+"["+(typeof f=="object"||e.isArray(f)?b:"")+"]",f,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var f in b)bc(a+"["+f+"]",b[f],c,d);else d(a,b)}function cc(a,b,c){var d=a.contents,e=a.dataTypes,f=a.responseFields,g,h,i,j;for(h in f)h in c&&(b[f[h]]=c[h]);while(e[0]==="*")e.shift(),g===undefined&&(g=a.mimeType||b.getResponseHeader("content-type"));if(g)for(h in d)if(d[h]&&d[h].test(g)){e.unshift(h);break}if(e[0]in c)i=e[0];else{for(h in c){if(!e[0]||a.converters[h+" "+e[0]]){i=h;break}j||(j=h)}i=i||j}if(i)return i!==e[0]&&e.unshift(i),c[i]}function dc(a,b){a.dataFilter&&(b=a.dataFilter(b,a.dataType));var c=a.dataTypes,d={},f,g,h=c.length,i,j=c[0],k,l,m,n,o;for(f=1;f<h;f++){if(f===1)for(g in a.converters)typeof g=="string"&&(d[g.toLowerCase()]=a.converters[g]);k=j,j=c[f];if(j==="*")j=k;else if(k!=="*"&&k!==j){l=k+" "+j,m=d[l]||d["* "+j];if(!m){o=undefined;for(n in d){i=n.split(" ");if(i[0]===k||i[0]==="*"){o=d[i[1]+" "+j];if(o){n=d[n],n===!0?m=o:o===!0&&(m=n);break}}}}!m&&!o&&e.error("No conversion from "+l.replace(" "," to ")),m!==!0&&(b=m?m(b):o(n(b)))}}return b}function jc(){try{return new a.XMLHttpRequest}catch(b){}}function kc(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function tc(){return setTimeout(uc,0),sc=e.now()}function uc(){sc=undefined}function vc(a,b){var c={};return e.each(rc.concat.apply([],rc.slice(0,b)),function(){c[this]=a}),c}function wc(a){if(!lc[a]){var c=b.body,d=e("<"+a+">").appendTo(c),f=d.css("display");d.remove();if(f==="none"||f===""){mc||(mc=b.createElement("iframe"),mc.frameBorder=mc.width=mc.height=0),c.appendChild(mc);if(!nc||!mc.createElement)nc=(mc.contentWindow||mc.contentDocument).document,nc.write((b.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),nc.close();d=nc.createElement(a),nc.body.appendChild(d),f=e.css(d,"display"),c.removeChild(mc)}lc[a]=f}return lc[a]}function zc(a){return e.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}var b=a.document,c=a.navigator,d=a.location,e=function(){function J(){if(d.isReady)return;try{b.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}d.ready()}var d=function(a,b){return new d.fn.init(a,b,g)},e=a.jQuery,f=a.$,g,h=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,i=/\S/,j=/^\s+/,k=/\s+$/,l=/\d/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=c.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};return d.fn=d.prototype={constructor:d,init:function(a,c,e){var f,g,i,j;if(!a)return this;if(a.nodeType)return this.context=this[0]=a,this.length=1,this;if(a==="body"&&!c&&b.body)return this.context=b,this[0]=b.body,this.selector=a,this.length=1,this;if(typeof a=="string"){a.charAt(0)==="<"&&a.charAt(a.length-1)===">"&&a.length>=3?f=[null,a,null]:f=h.exec(a);if(f&&(f[1]||!c)){if(f[1])return c=c instanceof d?c[0]:c,j=c?c.ownerDocument||c:b,i=m.exec(a),i?d.isPlainObject(c)?(a=[b.createElement(i[1])],d.fn.attr.call(a,c,!0)):a=[j.createElement(i[1])]:(i=d.buildFragment([f[1]],[j]),a=(i.cacheable?d.clone(i.fragment):i.fragment).childNodes),d.merge(this,a);g=b.getElementById(f[2]);if(g&&g.parentNode){if(g.id!==f[2])return e.find(a);this.length=1,this[0]=g}return this.context=b,this.selector=a,this}return!c||c.jquery?(c||e).find(a):this.constructor(c).find(a)}return d.isFunction(a)?e.ready(a):(a.selector!==undefined&&(this.selector=a.selector,this.context=a.context),d.makeArray(a,this))},selector:"",jquery:"1.7",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var e=this.constructor();return d.isArray(a)?E.apply(e,a):d.merge(e,a),e.prevObject=this,e.context=this.context,b==="find"?e.selector=this.selector+(this.selector?" ":"")+c:b&&(e.selector=this.selector+"."+b+"("+c+")"),e},each:function(a,b){return d.each(this,a,b)},ready:function(a){return d.bindReady(),A.add(a),this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(d.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},d.fn.init.prototype=d.fn,d.extend=d.fn.extend=function(){var a,b,c,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;typeof h=="boolean"&&(k=h,h=arguments[1]||{},i=2),typeof h!="object"&&!d.isFunction(h)&&(h={}),j===i&&(h=this,--i);for(;i<j;i++)if((a=arguments[i])!=null)for(b in a){c=h[b],e=a[b];if(h===e)continue;k&&e&&(d.isPlainObject(e)||(f=d.isArray(e)))?(f?(f=!1,g=c&&d.isArray(c)?c:[]):g=c&&d.isPlainObject(c)?c:{},h[b]=d.extend(k,g,e)):e!==undefined&&(h[b]=e)}return h},d.extend({noConflict:function(b){return a.$===d&&(a.$=f),b&&a.jQuery===d&&(a.jQuery=e),d},isReady:!1,readyWait:1,holdReady:function(a){a?d.readyWait++:d.ready(!0)},ready:function(a){if(a===!0&&!--d.readyWait||a!==!0&&!d.isReady){if(!b.body)return setTimeout(d.ready,1);d.isReady=!0;if(a!==!0&&--d.readyWait>0)return;A.fireWith(b,[d]),d.fn.trigger&&d(b).trigger("ready").unbind("ready")}},bindReady:function(){if(A)return;A=d.Callbacks("once memory");if(b.readyState==="complete")return setTimeout(d.ready,1);if(b.addEventListener)b.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",d.ready,!1);else if(b.attachEvent){b.attachEvent("onreadystatechange",B),a.attachEvent("onload",d.ready);var c=!1;try{c=a.frameElement==null}catch(e){}b.documentElement.doScroll&&c&&J()}},isFunction:function(a){return d.type(a)==="function"},isArray:Array.isArray||function(a){return d.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return a!=null&&l.test(a)&&!isNaN(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||d.type(a)!=="object"||a.nodeType||d.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}var c;for(c in a);return c===undefined||D.call(a,c)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw a},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=d.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();d.error("Invalid JSON: "+b)},parseXML:function(b){var c,e;try{a.DOMParser?(e=new DOMParser,c=e.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(f){c=undefined}return(!c||!c.documentElement||c.getElementsByTagName("parsererror").length)&&d.error("Invalid XML: "+b),c},noop:function(){},globalEval:function(b){b&&i.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,c){var e,f=0,g=a.length,h=g===undefined||d.isFunction(a);if(c){if(h){for(e in a)if(b.apply(a[e],c)===!1)break}else for(;f<g;)if(b.apply(a[f++],c)===!1)break}else if(h){for(e in a)if(b.call(a[e],e,a[e])===!1)break}else for(;f<g;)if(b.call(a[f],f,a[f++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":a.toString().replace(j,"").replace(k,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var e=d.type(a);a.length==null||e==="string"||e==="function"||e==="regexp"||d.isWindow(a)?E.call(c,a):d.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=a.length,d=0;if(typeof b.length=="number")for(var e=b.length;d<e;d++)a[c++]=b[d];else while(b[d]!==undefined)a[c++]=b[d++];return a.length=c,a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,b,c){var e,f,g=[],h=0,i=a.length,j=a instanceof d||i!==undefined&&typeof i=="number"&&(i>0&&a[0]&&a[i-1]||i===0||d.isArray(a));if(j)for(;h<i;h++)e=b(a[h],h,c),e!=null&&(g[g.length]=e);else for(f in a)e=b(a[f],f,c),e!=null&&(g[g.length]=e);return g.concat.apply([],g)},guid:1,proxy:function(a,b){if(typeof b=="string"){var c=a[b];b=a,a=c}if(!d.isFunction(a))return undefined;var e=F.call(arguments,2),f=function(){return a.apply(b,e.concat(F.call(arguments)))};return f.guid=a.guid=a.guid||f.guid||d.guid++,f},access:function(a,b,c,e,f,g){var h=a.length;if(typeof b=="object"){for(var i in b)d.access(a,i,b[i],e,f,c);return a}if(c!==undefined){e=!g&&e&&d.isFunction(c);for(var j=0;j<h;j++)f(a[j],b,e?c.call(a[j],j,f(a[j],b)):c,g);return a}return h?f(a[0],b):undefined},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}d.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(e,f){return f&&f instanceof d&&!(f instanceof a)&&(f=a(f)),d.fn.init.call(this,e,f,c)},a.fn.init.prototype=a.fn;var c=a(b);return a},browser:{}}),d.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=d.uaMatch(y),z.browser&&(d.browser[z.browser]=!0,d.browser.version=z.version),d.browser.webkit&&(d.browser.safari=!0),i.test("Â ")&&(j=/^[\s\xA0]+/,k=/[\s\xA0]+$/),g=d(b),b.addEventListener?B=function(){b.removeEventListener("DOMContentLoaded",B,!1),d.ready()}:b.attachEvent&&(B=function(){b.readyState==="complete"&&(b.detachEvent("onreadystatechange",B),d.ready())}),typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return d}),d}(),f={};e.Callbacks=function(a){a=a?f[a]||g(a):{};var b=[],c=[],d,h,i,j,k,l=function(c){var d,f,g,h,i;for(d=0,f=c.length;d<f;d++)g=c[d],h=e.type(g),h==="array"?l(g):h==="function"&&(!a.unique||!n.has(g))&&b.push(g)},m=function(e,f){f=f||[],d=!a.memory||[e,f],h=!0,k=i||0,i=0,j=b.length;for(;b&&k<j;k++)if(b[k].apply(e,f)===!1&&a.stopOnFalse){d=!0;break}h=!1,b&&(a.once?d===!0?n.disable():b=[]:c&&c.length&&(d=c.shift(),n.fireWith(d[0],d[1])))},n={add:function(){if(b){var a=b.length;l(arguments),h?j=b.length:d&&d!==!0&&(i=a,m(d[0],d[1]))}return this},remove:function(){if(b){var c=arguments,d=0,e=c.length;for(;d<e;d++)for(var f=0;f<b.length;f++)if(c[d]===b[f]){h&&f<=j&&(j--,f<=k&&k--),b.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(b){var c=0,d=b.length;for(;c<d;c++)if(a===b[c])return!0}return!1},empty:function(){return b=[],this},disable:function(){return b=c=d=undefined,this},disabled:function(){return!b},lock:function(){return c=undefined,(!d||d===!0)&&n.disable(),this},locked:function(){return!c},fireWith:function(b,e){return c&&(h?a.once||c.push([b,e]):(!a.once||!d)&&m(b,e)),this},fire:function(){return n.fireWith(this,arguments),this},fired:function(){return!!d}};return n};var h=[].slice;e.extend({Deferred:function(a){var b=e.Callbacks("once memory"),c=e.Callbacks("once memory"),d=e.Callbacks("memory"),f="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return f},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){return i.done(a).fail(b).progress(c),this},always:function(){return i.done.apply(i,arguments).fail.apply(i,arguments)},pipe:function(a,b,c){return e.Deferred(function(d){e.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],f=b[1],g;e.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&e.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[f+"With"](this===i?d:this,[g])}):i[a](d[f])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;return i.done(function(){f="resolved"},c.disable,d.lock).fail(function(){f="rejected"},b.disable,d.lock),a&&a.call(i,i),i},when:function(a){function l(a){return function(c){b[a]=arguments.length>1?h.call(arguments,0):c,--g||j.resolveWith(j,b)}}function m(a){return function(b){f[a]=arguments.length>1?h.call(arguments,0):b,j.notifyWith(k,f)}}var b=h.call(arguments,0),c=0,d=b.length,f=new Array(d),g=d,i=d,j=d<=1&&a&&e.isFunction(a.promise)?a:e.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&e.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),e.support=function(){var a=b.createElement("div"),c=b.documentElement,d,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;a.setAttribute("className","t"),a.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/><nav></nav>",d=a.getElementsByTagName("*"),f=a.getElementsByTagName("a")[0];if(!d||!d.length||!f)return{};g=b.createElement("select"),h=g.appendChild(b.createElement("option")),i=a.getElementsByTagName("input")[0],k={leadingWhitespace:a.firstChild.nodeType===3,tbody:!a.getElementsByTagName("tbody").length,htmlSerialize:!!a.getElementsByTagName("link").length,style:/top/.test(f.getAttribute("style")),hrefNormalized:f.getAttribute("href")==="/a",opacity:/^0.55/.test(f.style.opacity),cssFloat:!!f.style.cssFloat,unknownElems:!!a.getElementsByTagName("nav").length,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:a.className!=="t",enctype:!!b.createElement("form").enctype,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,k.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,k.optDisabled=!h.disabled;try{delete a.test}catch(v){k.deleteExpando=!1}!a.addEventListener&&a.attachEvent&&a.fireEvent&&(a.attachEvent("onclick",function(){k.noCloneEvent=!1}),a.cloneNode(!0).fireEvent("onclick")),i=b.createElement("input"),i.value="t",i.setAttribute("type","radio"),k.radioValue=i.value==="t",i.setAttribute("checked","checked"),a.appendChild(i),l=b.createDocumentFragment(),l.appendChild(a.lastChild),k.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,a.innerHTML="",a.style.width=a.style.paddingLeft="1px",m=b.getElementsByTagName("body")[0],o=b.createElement(m?"div":"body"),p={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},m&&e.extend(p,{position:"absolute",left:"-999px",top:"-999px"});for(t in p)o.style[t]=p[t];o.appendChild(a),n=m||c,n.insertBefore(o,n.firstChild),k.appendChecked=i.checked,k.boxModel=a.offsetWidth===2,"zoom"in a.style&&(a.style.display="inline",a.style.zoom=1,k.inlineBlockNeedsLayout=a.offsetWidth===2,a.style.display="",a.innerHTML="<div style='width:4px;'></div>",k.shrinkWrapBlocks=a.offsetWidth!==2),a.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",q=a.getElementsByTagName("td"),u=q[0].offsetHeight===0,q[0].style.display="",q[1].style.display="none",k.reliableHiddenOffsets=u&&q[0].offsetHeight===0,a.innerHTML="",b.defaultView&&b.defaultView.getComputedStyle&&(j=b.createElement("div"),j.style.width="0",j.style.marginRight="0",a.appendChild(j),k.reliableMarginRight=(parseInt((b.defaultView.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(a.attachEvent)for(t in{submit:1,change:1,focusin:1})s="on"+t,u=s in a,u||(a.setAttribute(s,"return;"),u=typeof a[s]=="function"),k[t+"Bubbles"]=u;return e(function(){var a,c,d,f,g,h,i=1,j="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",l="visibility:hidden;border:0;",n="style='"+j+"border:5px solid #000;padding:0;'",p="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>";m=b.getElementsByTagName("body")[0];if(!m)return;a=b.createElement("div"),a.style.cssText=l+"width:0;height:0;position:static;top:0;margin-top:"+i+"px",m.insertBefore(a,m.firstChild),o=b.createElement("div"),o.style.cssText=j+l,o.innerHTML=p,a.appendChild(o),c=o.firstChild,d=c.firstChild,g=c.nextSibling.firstChild.firstChild,h={doesNotAddBorder:d.offsetTop!==5,doesAddBorderForTableAndCells:g.offsetTop===5},d.style.position="fixed",d.style.top="20px",h.fixedPosition=d.offsetTop===20||d.offsetTop===15,d.style.position=d.style.top="",c.style.overflow="hidden",c.style.position="relative",h.subtractsBorderForOverflowNotVisible=d.offsetTop===-5,h.doesNotIncludeMarginInBodyOffset=m.offsetTop!==i,m.removeChild(a),o=a=null,e.extend(k,h)}),o.innerHTML="",n.removeChild(o),o=l=g=h=m=j=a=i=null,k}(),e.boxModel=e.support.boxModel;var i=/^(?:\{.*\}|\[.*\])$/,j=/([A-Z])/g;e.extend({cache:{},uuid:0,expando:"jQuery"+(e.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){return a=a.nodeType?e.cache[a[e.expando]]:a[e.expando],!!a&&!l(a)},data:function(a,b,c,d){if(!e.acceptData(a))return;var f,g,h,i=e.expando,j=typeof b=="string",k=a.nodeType,l=k?e.cache:a,m=k?a[e.expando]:a[e.expando]&&e.expando,n=b==="events";if((!m||!l[m]||!n&&!d&&!l[m].data)&&j&&c===undefined)return;m||(k?a[e.expando]=m=++e.uuid:m=e.expando),l[m]||(l[m]={},k||(l[m].toJSON=e.noop));if(typeof b=="object"||typeof b=="function")d?l[m]=e.extend(l[m],b):l[m].data=e.extend(l[m].data,b);return f=g=l[m],d||(g.data||(g.data={}),g=g.data),c!==undefined&&(g[e.camelCase(b)]=c),n&&!g[b]?f.events:(j?(h=g[b],h==null&&(h=g[e.camelCase(b)])):h=g,h)},removeData:function(a,b,c){if(!e.acceptData(a))return;var d,f,g,h=e.expando,i=a.nodeType,j=i?e.cache:a,k=i?a[e.expando]:e.expando;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){e.isArray(b)?b=b:b in d?b=[b]:(b=e.camelCase(b),b in d?b=[b]:b=b.split(" "));for(f=0,g=b.length;f<g;f++)delete d[b[f]];if(!(c?l:e.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!l(j[k]))return}e.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(e.support.deleteExpando?delete a[e.expando]:a.removeAttribute?a.removeAttribute(e.expando):a[e.expando]=null)},_data:function(a,b,c){return e.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=e.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),e.fn.extend({data:function(a,b){var c,d,f,g=null;if(typeof a=="undefined"){if(this.length){g=e.data(this[0]);if(this[0].nodeType===1&&!e._data(this[0],"parsedAttrs")){d=this[0].attributes;for(var h=0,i=d.length;h<i;h++)f=d[h].name,f.indexOf("data-")===0&&(f=e.camelCase(f.substring(5)),k(this[0],f,g[f]));e._data(this[0],"parsedAttrs",!0)}}return g}return typeof a=="object"?this.each(function(){e.data(this,a)}):(c=a.split("."),c[1]=c[1]?"."+c[1]:"",b===undefined?(g=this.triggerHandler("getData"+c[1]+"!",[c[0]]),g===undefined&&this.length&&(g=e.data(this[0],a),g=k(this[0],a,g)),g===undefined&&c[1]?this.data(c[0]):g):this.each(function(){var d=e(this),f=[c[0],b];d.triggerHandler("setData"+c[1]+"!",f),e.data(this,a,b),d.triggerHandler("changeData"+c[1]+"!",f)}))},removeData:function(a){return this.each(function(){e.removeData(this,a)})}}),e.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",e._data(a,b,(e._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",f=a?0:(e._data(b,d)||1)-1;f?e._data(b,d,f):(e.removeData(b,d,!0),m(b,c,"mark"))}},queue:function(a,b,c){var d;if(a)return b=(b||"fx")+"queue",d=e._data(a,b),c&&(!d||e.isArray(c)?d=e._data(a,b,e.makeArray(c)):d.push(c)),d||[]},dequeue:function(a,b){b=b||"fx";var c=e.queue(a,b),d=c.shift(),f={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),e._data(a,b+".run",f),d.call(a,function(){e.dequeue(a,b)},f)),c.length||(e.removeData(a,b+"queue "+b+".run",!0),m(a,b,"queue"))}}),e.fn.extend({queue:function(a,b){return typeof a!="string"&&(b=a,a="fx"),b===undefined?e.queue(this[0],a):this.each(function(){var c=e.queue(this,a,b);a==="fx"&&c[0]!=="inprogress"&&e.dequeue(this,a)})},dequeue:function(a){return this.each(function(){e.dequeue(this,a)})},delay:function(a,b){return a=e.fx?e.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){function l(){--g||c.resolveWith(d,[d])}typeof a!="string"&&(b=a,a=undefined),a=a||"fx";var c=e.Deferred(),d=this,f=d.length,g=1,h=a+"defer",i=a+"queue",j=a+"mark",k;while(f--)if(k=e.data(d[f],h,undefined,!0)||(e.data(d[f],i,undefined,!0)||e.data(d[f],j,undefined,!0))&&e.data(d[f],h,e.Callbacks("once memory"),!0))g++,k.add(l);return l(),c.promise()}});var n=/[\n\t\r]/g,o=/\s+/,p=/\r/g,q=/^(?:button|input)$/i,r=/^(?:button|input|object|select|textarea)$/i,s=/^a(?:rea)?$/i,t=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,u=e.support.getSetAttribute,v,w,x;e.fn.extend({attr:function(a,b){return e.access(this,a,b,!0,e.attr)},removeAttr:function(a){return this.each(function(){e.removeAttr(this,a)})},prop:function(a,b){return e.access(this,a,b,!0,e.prop)},removeProp:function(a){return a=e.propFix[a]||a,this.each(function(){try{this[a]=undefined,delete this[a]}catch(b){}})},addClass:function(a){var b,c,d,f,g,h,i;if(e.isFunction(a))return this.each(function(b){e(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(o);for(c=0,d=this.length;c<d;c++){f=this[c];if(f.nodeType===1)if(!f.className&&b.length===1)f.className=a;else{g=" "+f.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");f.className=e.trim(g)}}}return this},removeClass:function(a){var b,c,d,f,g,h,i;if(e.isFunction(a))return this.each(function(b){e(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===undefined){b=(a||"").split(o);for(c=0,d=this.length;c<d;c++){f=this[c];if(f.nodeType===1&&f.className)if(a){g=(" "+f.className+" ").replace(n," ");for(h=0,i=b.length;h<i;h++)g=g.replace(" "+b[h]+" "," ");f.className=e.trim(g)}else f.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";return e.isFunction(a)?this.each(function(c){e(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if(c==="string"){var f,g=0,h=e(this),i=b,j=a.split(o);while(f=j[g++])i=d?i:!h.hasClass(f),h[i?"addClass":"removeClass"](f)}else if(c==="undefined"||c==="boolean")this.className&&e._data(this,"__className__",this.className),this.className=this.className||a===!1?"":e._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(n," ").indexOf(b)>-1)return!0;return!1},val:function(a){var b,c,d,f=this[0];if(!arguments.length)return f?(b=e.valHooks[f.nodeName.toLowerCase()]||e.valHooks[f.type],b&&"get"in b&&(c=b.get(f,"value"))!==undefined?c:(c=f.value,typeof c=="string"?c.replace(p,""):c==null?"":c)):undefined;return d=e.isFunction(a),this.each(function(c){var f=e(this),g;if(this.nodeType!==1)return;d?g=a.call(this,c,f.val()):g=a,g==null?g="":typeof g=="number"?g+="":e.isArray(g)&&(g=e.map(g,function(a){return a==null?"":a+""})),b=e.valHooks[this.nodeName.toLowerCase()]||e.valHooks[this.type];if(!b||!("set"in b)||b.set(this,g,"value")===undefined)this.value=g})}}),e.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,f,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){f=i[c];if(f.selected&&(e.support.optDisabled?!f.disabled:f.getAttribute("disabled")===null)&&(!f.parentNode.disabled||!e.nodeName(f.parentNode,"optgroup"))){b=e(f).val();if(j)return b;h.push(b)}}return j&&!h.length&&i.length?e(i[g]).val():h},set:function(a,b){var c=e.makeArray(b);return e(a).find("option").each(function(){this.selected=e.inArray(e(this).val(),c)>=0}),c.length||(a.selectedIndex=-1),c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,b,c,d){var f,g,h,i=a.nodeType;return!a||i===3||i===8||i===2?undefined:d&&b in e.attrFn?e(a)[b](c):"getAttribute"in a?(h=i!==1||!e.isXMLDoc(a),h&&(b=b.toLowerCase(),g=e.attrHooks[b]||(t.test(b)?w:v)),c!==undefined?c===null?(e.removeAttr(a,b),undefined):g&&"set"in g&&h&&(f=g.set(a,c,b))!==undefined?f:(a.setAttribute(b,""+c),c):g&&"get"in g&&h&&(f=g.get(a,b))!==null?f:(f=a.getAttribute(b),f===null?undefined:f)):e.prop(a,b,c)},removeAttr:function(a,b){var c,d,f,g,h=0;if(a.nodeType===1){d=(b||"").split(o),g=d.length;for(;h<g;h++)f=d[h].toLowerCase(),c=e.propFix[f]||f,e.attr(a,f,""),a.removeAttribute(u?f:c),t.test(f)&&c in a&&(a[c]=!1)}},attrHooks:{type:{set:function(a,b){if(q.test(a.nodeName)&&a.parentNode)e.error("type property can't be changed");else if(!e.support.radioValue&&b==="radio"&&e.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}},value:{get:function(a,b){return v&&e.nodeName(a,"button")?v.get(a,b):b in a?a.value:null},set:function(a,b,c){if(v&&e.nodeName(a,"button"))return v.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,b,c){var d,f,g,h=a.nodeType;return!a||h===3||h===8||h===2?undefined:(g=h!==1||!e.isXMLDoc(a),g&&(b=e.propFix[b]||b,f=e.propHooks[b]),c!==undefined?f&&"set"in f&&(d=f.set(a,c,b))!==undefined?d:a[b]=c:f&&"get"in f&&(d=f.get(a,b))!==null?d:a[b])},propHooks:{tabIndex:{get:function(a){var b=a.getAttributeNode("tabindex");return b&&b.specified?parseInt(b.value,10):r.test(a.nodeName)||s.test(a.nodeName)&&a.href?0:undefined}}}}),e.attrHooks.tabindex=e.propHooks.tabIndex,w={get:function(a,b){var c,d=e.prop(a,b);return d===!0||typeof d!="boolean"&&(c=a.getAttributeNode(b))&&c.nodeValue!==!1?b.toLowerCase():undefined},set:function(a,b,c){var d;return b===!1?e.removeAttr(a,c):(d=e.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase())),c}},u||(x={name:!0,id:!0},v=e.valHooks.button={get:function(a,b){var c;return c=a.getAttributeNode(b),c&&(x[b]?c.nodeValue!=="":c.specified)?c.nodeValue:undefined},set:function(a,c,d){var e=a.getAttributeNode(d);return e||(e=b.createAttribute(d),a.setAttributeNode(e)),e.nodeValue=c+""}},e.attrHooks.tabindex.set=v.set,e.each(["width","height"],function(a,b){e.attrHooks[b]=e.extend(e.attrHooks[b],{set:function(a,c){if(c==="")return a.setAttribute(b,"auto"),c}})}),e.attrHooks.contenteditable={get:v.get,set:function(a,b,c){b===""&&(b="false"),v.set(a,b,c)}}),e.support.hrefNormalized||e.each(["href","src","width","height"],function(a,b){e.attrHooks[b]=e.extend(e.attrHooks[b],{get:function(a){var c=a.getAttribute(b,2);return c===null?undefined:c}})}),e.support.style||(e.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||undefined},set:function(a,b){return a.style.cssText=""+b}}),e.support.optSelected||(e.propHooks.selected=e.extend(e.propHooks.selected,{get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}})),e.support.enctype||(e.propFix.enctype="encoding"),e.support.checkOn||e.each(["radio","checkbox"],function(){e.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),e.each(["radio","checkbox"],function(){e.valHooks[this]=e.extend(e.valHooks[this],{set:function(a,b){if(e.isArray(b))return a.checked=e.inArray(e(a).val(),b)>=0}})});var y=/\.(.*)$/,z=/^(?:textarea|input|select)$/i,A=/\./g,B=/ /g,C=/[^\w\s.|`]/g,D=/^([^\.]*)?(?:\.(.+))?$/,E=/\bhover(\.\S+)?/,F=/^key/,G=/^(?:mouse|contextmenu)|click/
,H=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,I=function(a){var b=H.exec(a);return b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)")),b},J=function(a,b){return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||a.id===b[2])&&(!b[3]||b[3].test(a.className))},K=function(a){return e.event.special.hover?a:a.replace(E,"mouseenter$1 mouseleave$1")};e.event={add:function(a,b,c,d,f){var g,h,i,j,k,l,m,n,o,p,q,r;if(a.nodeType===3||a.nodeType===8||!b||!c||!(g=e._data(a)))return;c.handler&&(o=c,c=o.handler),c.guid||(c.guid=e.guid++),i=g.events,i||(g.events=i={}),h=g.handle,h||(g.handle=h=function(a){return typeof e=="undefined"||!!a&&e.event.triggered===a.type?undefined:e.event.dispatch.apply(h.elem,arguments)},h.elem=a),b=K(b).split(" ");for(j=0;j<b.length;j++){k=D.exec(b[j])||[],l=k[1],m=(k[2]||"").split(".").sort(),r=e.event.special[l]||{},l=(f?r.delegateType:r.bindType)||l,r=e.event.special[l]||{},n=e.extend({type:l,origType:k[1],data:d,handler:c,guid:c.guid,selector:f,namespace:m.join(".")},o),f&&(n.quick=I(f),!n.quick&&e.expr.match.POS.test(f)&&(n.isPositional=!0)),q=i[l];if(!q){q=i[l]=[],q.delegateCount=0;if(!r.setup||r.setup.call(a,d,m,h)===!1)a.addEventListener?a.addEventListener(l,h,!1):a.attachEvent&&a.attachEvent("on"+l,h)}r.add&&(r.add.call(a,n),n.handler.guid||(n.handler.guid=c.guid)),f?q.splice(q.delegateCount++,0,n):q.push(n),e.event.global[l]=!0}a=null},global:{},remove:function(a,b,c,d){var f=e.hasData(a)&&e._data(a),g,h,i,j,k,l,m,n,o,p,q;if(!f||!(m=f.events))return;b=K(b||"").split(" ");for(g=0;g<b.length;g++){h=D.exec(b[g])||[],i=h[1],j=h[2];if(!i){j=j?"."+j:"";for(l in m)e.event.remove(a,l+j,c,d);return}n=e.event.special[i]||{},i=(d?n.delegateType:n.bindType)||i,p=m[i]||[],k=p.length,j=j?new RegExp("(^|\\.)"+j.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;if(c||j||d||n.remove)for(l=0;l<p.length;l++){q=p[l];if(!c||c.guid===q.guid)if(!j||j.test(q.namespace))if(!d||d===q.selector||d==="**"&&q.selector)p.splice(l--,1),q.selector&&p.delegateCount--,n.remove&&n.remove.call(a,q)}else p.length=0;p.length===0&&k!==p.length&&((!n.teardown||n.teardown.call(a,j)===!1)&&e.removeEvent(a,i,f.handle),delete m[i])}e.isEmptyObject(m)&&(o=f.handle,o&&(o.elem=null),e.removeData(a,["events","handle"],!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(b,c,d,f){if(!d||d.nodeType!==3&&d.nodeType!==8){var g=b.type||b,h=[],i,j,k,l,m,n,o,p,q,r;g.indexOf("!")>=0&&(g=g.slice(0,-1),j=!0),g.indexOf(".")>=0&&(h=g.split("."),g=h.shift(),h.sort());if((!d||e.event.customEvent[g])&&!e.event.global[g])return;b=typeof b=="object"?b[e.expando]?b:new e.Event(g,b):new e.Event(g),b.type=g,b.isTrigger=!0,b.exclusive=j,b.namespace=h.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,n=g.indexOf(":")<0?"on"+g:"",(f||!d)&&b.preventDefault();if(!d){i=e.cache;for(k in i)i[k].events&&i[k].events[g]&&e.event.trigger(b,c,i[k].handle.elem,!0);return}b.result=undefined,b.target||(b.target=d),c=c!=null?e.makeArray(c):[],c.unshift(b),o=e.event.special[g]||{};if(o.trigger&&o.trigger.apply(d,c)===!1)return;q=[[d,o.bindType||g]];if(!f&&!o.noBubble&&!e.isWindow(d)){r=o.delegateType||g,m=null;for(l=d.parentNode;l;l=l.parentNode)q.push([l,r]),m=l;m&&m===d.ownerDocument&&q.push([m.defaultView||m.parentWindow||a,r])}for(k=0;k<q.length;k++){l=q[k][0],b.type=q[k][1],p=(e._data(l,"events")||{})[b.type]&&e._data(l,"handle"),p&&p.apply(l,c),p=n&&l[n],p&&e.acceptData(l)&&p.apply(l,c);if(b.isPropagationStopped())break}return b.type=g,b.isDefaultPrevented()||(!o._default||o._default.apply(d.ownerDocument,c)===!1)&&(g!=="click"||!e.nodeName(d,"a"))&&e.acceptData(d)&&n&&d[g]&&(g!=="focus"&&g!=="blur"||b.target.offsetWidth!==0)&&!e.isWindow(d)&&(m=d[n],m&&(d[n]=null),e.event.triggered=g,d[g](),e.event.triggered=undefined,m&&(d[n]=m)),b.result}return},dispatch:function(b){b=e.event.fix(b||a.event);var c=(e._data(this,"events")||{})[b.type]||[],d=c.delegateCount,f=[].slice.call(arguments,0),g=!b.exclusive&&!b.namespace,h=(e.event.special[b.type]||{}).handle,i=[],j,k,l,m,n,o,p,q,r,s,t;f[0]=b,b.delegateTarget=this;if(d&&!b.target.disabled&&(!b.button||b.type!=="click"))for(l=b.target;l!=this;l=l.parentNode||this){n={},p=[];for(j=0;j<d;j++)q=c[j],r=q.selector,s=n[r],q.isPositional?s=(s||(n[r]=e(r))).index(l)>=0:s===undefined&&(s=n[r]=q.quick?J(l,q.quick):e(l).is(r)),s&&p.push(q);p.length&&i.push({elem:l,matches:p})}c.length>d&&i.push({elem:this,matches:c.slice(d)});for(j=0;j<i.length&&!b.isPropagationStopped();j++){o=i[j],b.currentTarget=o.elem;for(k=0;k<o.matches.length&&!b.isImmediatePropagationStopped();k++){q=o.matches[k];if(g||!b.namespace&&!q.namespace||b.namespace_re&&b.namespace_re.test(q.namespace))b.data=q.data,b.handleObj=q,func=h||q.handler,a.log&&a.log.enabled&&a.log("jquery.dispatch","On "+b.type+", invoking",func),m=func.apply(o.elem,f),m!==undefined&&(b.result=m,m===!1&&(b.preventDefault(),b.stopPropagation()))}}return b.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement wheelDelta".split(" "),filter:function(a,c){var d,e,f,g=c.button,h=c.fromElement;return a.pageX==null&&c.clientX!=null&&(d=a.target.ownerDocument||b,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?c.toElement:h),!a.which&&g!==undefined&&(a.which=g&1?1:g&2?3:g&4?2:0),a}},fix:function(a){if(a[e.expando])return a;var c,d,f=a,g=e.event.fixHooks[a.type]||{},h=g.props?this.props.concat(g.props):this.props;a=e.Event(f);for(c=h.length;c;)d=h[--c],a[d]=f[d];return a.target||(a.target=f.srcElement||b),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===undefined&&(a.metaKey=a.ctrlKey),g.filter?g.filter(a,f):a},special:{ready:{setup:e.bindReady},focus:{delegateType:"focusin",noBubble:!0},blur:{delegateType:"focusout",noBubble:!0},beforeunload:{setup:function(a,b,c){e.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var f=e.extend(new e.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?e.event.trigger(f,null,b):e.event.dispatch.call(b,f),f.isDefaultPrevented()&&c.preventDefault()}},e.event.handle=e.event.dispatch,e.removeEvent=b.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},e.Event=function(b,c){if(!(this instanceof e.Event))return new e.Event(b,c);b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||b.returnValue===!1||b.getPreventDefault&&b.getPreventDefault()?M:L):this.type=b,c&&e.extend(this,c),this.timeStamp=b&&b.timeStamp||e.now(),a.log&&a.log.enabled&&a.log("jquery.Event","New event object: "+this.type,this),this[e.expando]=!0},e.Event.prototype={preventDefault:function(){this.isDefaultPrevented=M;var a=this.originalEvent;if(!a)return;a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=M;var a=this.originalEvent;if(!a)return;a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=M,this.stopPropagation()},isDefaultPrevented:L,isPropagationStopped:L,isImmediatePropagationStopped:L},e.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(b,c){e.event.special[b]=e.event.special[c]={delegateType:c,bindType:c,handle:function(b){var c=this,d=b.relatedTarget,f=b.handleObj,g=f.selector,h,i;if(!d||f.origType===b.type||d!==c&&!e.contains(c,d))h=b.type,b.type=f.origType,func=f.handler,a.log&&a.log.enabled&&a.log("jquery.mouse*","On "+b.type+", invoking",func),i=func.apply(this,arguments),b.type=h;return i}}}),e.support.submitBubbles||(e.event.special.submit={setup:function(){if(e.nodeName(this,"form"))return!1;e.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=e.nodeName(b,"input")||e.nodeName(b,"button")?b.form:undefined;c&&!c._submit_attached&&(e.event.add(c,"submit._submit",function(a){this.parentNode&&e.event.simulate("submit",this.parentNode,a,!0)}),c._submit_attached=!0)})},teardown:function(){if(e.nodeName(this,"form"))return!1;e.event.remove(this,"._submit")}}),e.support.changeBubbles||(e.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")e.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),e.event.add(this,"click._change",function(a){this._just_changed&&(this._just_changed=!1,e.event.simulate("change",this,a,!0))});return!1}e.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(e.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&e.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){return e.event.remove(this,"._change"),z.test(this.nodeName)}}),e.support.focusinBubbles||e.each({focus:"focusin",blur:"focusout"},function(a,c){var d=0,f=function(a){e.event.simulate(c,a.target,e.event.fix(a),!0)};e.event.special[c]={setup:function(){d++===0&&b.addEventListener(a,f,!0)},teardown:function(){--d===0&&b.removeEventListener(a,f,!0)}}}),e.fn.extend({on:function(a,b,c,d,f){var g,h;if(typeof a=="object"){typeof b!="string"&&(c=b,b=undefined);for(h in a)this.on(h,b,c,a[h],f);return this}c==null&&d==null?(d=b,c=b=undefined):d==null&&(typeof b=="string"?(d=c,c=undefined):(d=c,c=b,b=undefined));if(d===!1)d=L;else if(!d)return this;return f===1&&(g=d,d=function(a){return e().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=e.guid++)),this.each(function(){e.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,b,c){if(a&&a.preventDefault&&a.handleObj){var d=a.handleObj;return e(a.delegateTarget).off(d.namespace?d.type+"."+d.namespace:d.type,d.selector,d.handler),this}if(typeof a=="object"){for(var f in a)this.off(f,b,a[f]);return this}if(b===!1||typeof b=="function")c=b,b=undefined;return c===!1&&(c=L),this.each(function(){e.event.remove(this,a,c,b)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){return e(this.context).on(a,this.selector,b,c),this},die:function(a,b){return e(this.context).off(a,this.selector||"**",b),this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){e.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return e.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||e.guid++,d=0,f=function(c){var f=(e._data(this,"lastToggle"+a.guid)||0)%d;return e._data(this,"lastToggle"+a.guid,f+1),c.preventDefault(),b[f].apply(this,arguments)||!1};f.guid=c;while(d<b.length)b[d++].guid=c;return this.click(f)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),e.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){e.fn[b]=function(a,c){return c==null&&(c=a,a=null),arguments.length>0?this.bind(b,a,c):this.trigger(b)},e.attrFn&&(e.attrFn[b]=!0),F.test(b)&&(e.event.fixHooks[b]=e.event.keyHooks),G.test(b)&&(e.event.fixHooks[b]=e.event.mouseHooks)}),function(){function v(a,b,d,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[c]===d){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[c]=d,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}function w(a,b,d,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[c]===d){k=e[j.sizset];break}if(j.nodeType===1){g||(j[c]=d,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(l.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,c="sizcache"+(Math.random()+"").replace(".",""),d=0,f=Object.prototype.toString,g=!1,h=!0,i=/\\/g,j=/\r\n/g,k=/\W/;[0,0].sort(function(){return h=!1,0});var l=function(c,d,e,g){e=e||[],d=d||b;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!c||typeof c!="string")return e;var i,j,k,m,p,q,s,t,u=!0,v=l.isXML(d),w=[],y=c;do{a.exec(""),i=a.exec(y);if(i){y=i[3],w.push(i[1]);if(i[2]){m=i[3];break}}}while(i);if(w.length>1&&o.exec(c))if(w.length===2&&n.relative[w[0]])j=x(w[0]+w[1],d,g);else{j=n.relative[w[0]]?[d]:l(w.shift(),d);while(w.length)c=w.shift(),n.relative[c]&&(c+=w.shift()),j=x(c,j,g)}else{!g&&w.length>1&&d.nodeType===9&&!v&&n.match.ID.test(w[0])&&!n.match.ID.test(w[w.length-1])&&(p=l.find(w.shift(),d,v),d=p.expr?l.filter(p.expr,p.set)[0]:p.set[0]);if(d){p=g?{expr:w.pop(),set:r(g)}:l.find(w.pop(),w.length!==1||w[0]!=="~"&&w[0]!=="+"||!d.parentNode?d:d.parentNode,v),j=p.expr?l.filter(p.expr,p.set):p.set,w.length>0?k=r(j):u=!1;while(w.length)q=w.pop(),s=q,n.relative[q]?s=w.pop():q="",s==null&&(s=d),n.relative[q](k,s,v)}else k=w=[]}k||(k=j),k||l.error(q||c);if(f.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&l.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else r(k,e);return m&&(l(m,h,e,g),l.uniqueSort(e)),e};l.uniqueSort=function(a){if(t){g=h,a.sort(t);if(g)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},l.matches=function(a,b){return l(a,null,null,b)},l.matchesSelector=function(a,b){return l(b,null,null,[a]).length>0},l.find=function(a,b,c){var d,e,f,g,h,j;if(!a)return[];for(e=0,f=n.order.length;e<f;e++){h=n.order[e];if(g=n.leftMatch[h].exec(a)){j=g[1],g.splice(1,1);if(j.substr(j.length-1)!=="\\"){g[1]=(g[1]||"").replace(i,""),d=n.find[h](g,b,c);if(d!=null){a=a.replace(n.match[h],"");break}}}}return d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]),{set:d,expr:a}},l.filter=function(a,b,c,d){var e,f,g,h,i,j,k,m,o,p=a,q=[],r=b,s=b&&b[0]&&l.isXML(b[0]);while(a&&b.length){for(g in n.filter)if((e=n.leftMatch[g].exec(a))!=null&&e[2]){j=n.filter[g],k=e[1],f=!1,e.splice(1,1);if(k.substr(k.length-1)==="\\")continue;r===q&&(q=[]);if(n.preFilter[g]){e=n.preFilter[g](e,r,c,q,d,s);if(!e)f=h=!0;else if(e===!0)continue}if(e)for(m=0;(i=r[m])!=null;m++)i&&(h=j(i,e,m,r),o=d^h,c&&h!=null?o?f=!0:r[m]=!1:o&&(q.push(i),f=!0));if(h!==undefined){c||(r=q),a=a.replace(n.match[g],"");if(!f)return[];break}}if(a===p){if(f!=null)break;l.error(a)}p=a}return r},l.error=function(a){throw"Syntax error, unrecognized expression: "+a};var m=l.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(j,"");for(a=a.firstChild;a;a=a.nextSibling)e+=m(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=m(c));return e},n=l.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!k.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&l.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!k.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&l.filter(b,a,!0)}},"":function(a,b,c){var e,f=d++,g=w;typeof b=="string"&&!k.test(b)&&(b=b.toLowerCase(),e=b,g=v),g("parentNode",b,f,a,e,c)},"~":function(a,b,c){var e,f=d++,g=w;typeof b=="string"&&!k.test(b)&&(b=b.toLowerCase(),e=b,g=v),g("previousSibling",b,f,a,e,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(i,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(i,"")},TAG:function(a,b){return a[1].replace(i,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||l.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&l.error(a[0]);return a[0]=d++,a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(i,"");return!f&&n.attrMap[g]&&(a[1]=n.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(i,""),a[2]==="~="&&(a[4]=" "+a[4]+" "),a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not"){if(!((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))){var g=l.filter(b[3],c,d,!0^f);return d||e.push.apply(e,g),!1}b[3]=l(b[3],null,null,c)}else if(n.match.POS.test(b[0])||n.match.CHILD.test(b[0]))return!0;return b},POS:function(a){return a.unshift(!0),a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!l(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=n.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||m([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}l.error(e)},CHILD:function(a,b){var d,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":d=b[2],e=b[3];if(d===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[c]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[c]=f}return j=a.nodeIndex-e,d===0?j===0:j%d===0&&j/d>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=l.attr?l.attr(a,c):n.attrHandle[c]?n.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&l.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=n.setFilters[e];if(f)return f(a,c,b,d)}}},o=n.match.POS,p=function(a,b){return"\\"+(b-0+1)};for(var q in n.match)n.match[q]=new RegExp(n.match[q].source+/(?![^\[]*\])(?![^\(]*\))/.source),n.leftMatch[q]=new RegExp(/(^(?:.|\r|\n)*?)/.source+n.match[q].source.replace(/\\(\d+)/g,p));var r=function(a,b){return a=Array.prototype.slice.call(a,0),b?(b.push.apply(b,a),b):a};try{Array.prototype.slice.call(b.documentElement.childNodes,0)[0].nodeType}catch(s){r=function(a,b){var c=0,d=b||[];if(f.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var t,u;b.documentElement.compareDocumentPosition?t=function(a,b){return a===b?(g=!0,0):!a.compareDocumentPosition||!b.compareDocumentPosition?a.compareDocumentPosition?-1:1:a.compareDocumentPosition(b)&4?-1:1}:(t=function(a,b){if(a===b)return g=!0,0;if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],h=a.parentNode,i=b.parentNode,j=h;if(h===i)return u(a,b);if(!h)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return u(e[k],f[k]);return k===c?u(a,f[k],-1):u(e[k],b,1)},u=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=b.createElement("div"),c="script"+(new Date).getTime(),d=b.documentElement;a.innerHTML="<a name='"+c+"'/>",d.insertBefore(a,d.firstChild),b.getElementById(c)&&(n.find.ID=function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d?d.id===a[1]||typeof d.getAttributeNode!="undefined"&&d.getAttributeNode("id").nodeValue===a[1]?[d]:undefined:[]}},n.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),d.removeChild(a),d=a=null}(),function(){var a=b.createElement("div");a.appendChild(b.createComment("")),a.getElementsByTagName("*").length>0&&(n.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(n.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),b.querySelectorAll&&function(){var a=l,c=b.createElement("div"),d="__sizzle__";c.innerHTML="<p class='TEST'></p>";if(c.querySelectorAll&&c.querySelectorAll(".TEST").length===0)return;l=function(c,e,f,g){e=e||b;if(!g&&!l.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(c);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return r(e.getElementsByTagName(c),f);if(h[2]&&n.find.CLASS&&e.getElementsByClassName)return r(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(c==="body"&&e.body)return r([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return r([],f);if(i.id===h[3])return r([i],f)}try{return r(e.querySelectorAll(c),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,m=e.getAttribute("id"),o=m||d,p=e.parentNode,q=/^\s*[+~]/.test(c);m?o=o.replace(/'/g,"\\$&"):e.setAttribute("id",o),q&&p&&(e=e.parentNode);try{if(!q||p)return r(e.querySelectorAll("[id='"+o+"'] "+c),f)}catch(s){}finally{m||k.removeAttribute("id")}}}return a(c,e,f,g)};for(var e in a)l[e]=a[e];c=null}(),function(){var a=b.documentElement,c=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(c){var d=!c.call(b.createElement("div"),"div"),e=!1;try{c.call(b.documentElement,"[test!='']:sizzle")}catch(f){e=!0}l.matchesSelector=function(a,b){b=b.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!l.isXML(a))try{if(e||!n.match.PSEUDO.test(b)&&!/!=/.test(b)){var f=c.call(a,b);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return l(b,null,null,[a]).length>0}}}(),function(){var a=b.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!a.getElementsByClassName||a.getElementsByClassName("e").length===0)return;a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;n.order.splice(1,0,"CLASS"),n.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}(),b.documentElement.contains?l.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:b.documentElement.compareDocumentPosition?l.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:l.contains=function(){return!1},l.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var x=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=n.match.PSEUDO.exec(a))f+=d[0],a=a.replace(n.match.PSEUDO,"");a=n.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)l(a,g[h],e,c);return l.filter(f,e)};l.attr=e.attr,l.selectors.attrMap={},e.find=l,e.expr=l.selectors,e.expr[":"]=e.expr.filters,e.unique=l.uniqueSort,e.text=l.getText,e.isXMLDoc=l.isXML,e.contains=l.contains}();var N=/Until$/,O=/^(?:parents|prevUntil|prevAll)/,P=/,/,Q=/^.[^:#\[\.,]*$/,R=Array.prototype.slice,S=e.expr.match.POS,T={children:!0,contents:!0,next:!0,prev:!0};e.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return e(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(e.contains(b[c],this))return!0});var f=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=f.length,e.find(a,this[c],f);if(c>0)for(h=g;h<f.length;h++)for(i=0;i<g;i++)if(f[i]===f[h]){f.splice(h--,1);break}}return f},has:function(a){var b=e(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(e.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(V(this,a,!1),"not",a)},filter:function(a){return this.pushStack(V(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?S.test(a)?e(a,this.context).index(this[0])>=0:e.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,f,g=this[0];if(e.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)e(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=S.test(a)||typeof a!="string"?e(a,b||this.context):0;for(d=0,f=this.length;d<f;d++){g=this[d];while(g){if(i?i.index(g)>-1:e.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}return c=c.length>1?e.unique(c):c,this.pushStack(c,"closest",a)},index:function(a){return a?typeof a=="string"?e.inArray(this[0],e(a)):e.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(a,b){var c=typeof a=="string"?e(a,b):e.makeArray(a&&a.nodeType?[a]:a),d=e.merge(this.get(),c);return this.pushStack(U(c[0])||U(d[0])?d:e.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),e.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return e.dir(a,"parentNode")},parentsUntil:function(a,b,c){return e.dir(a,"parentNode",c)},next:function(a){return e.nth(a,2,"nextSibling")},prev:function(a){return e.nth(a,2,"previousSibling")},nextAll:function(a){return e.dir(a,"nextSibling")},prevAll:function(a){return e.dir(a,"previousSibling")},nextUntil:function(a,b,c){return e.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return e.dir(a,"previousSibling",c)},siblings:function(a){return e.sibling(a.parentNode.firstChild,a)},children:function(a){return e.sibling(a.firstChild)},contents:function(a){return e.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:e.makeArray(a.childNodes)}},function(a,b){e.fn[a]=function(c,d){var f=e.map(this,b,c),g=R.call(arguments);return N.test(a)||(d=c),d&&typeof d=="string"&&(f=e.filter(d,f)),f=this.length>1&&!T[a]?e.unique(f):f,(this.length>1||P.test(d))&&O.test(a)&&(f=f.reverse()),this.pushStack(f,a,g.join(","))}}),e.extend({filter:function(a,b,c){return c&&(a=":not("+a+")"),b.length===1?e.find.matchesSelector(b[0],a)?[b[0]]:[]:e.find.matches(a,b)},dir:function(a,b,c){var d=[],f=a[b];while(f&&f.nodeType!==9&&(c===undefined||f.nodeType!==1||!e(f).is(c)))f.nodeType===1&&d.push(f),f=f[b];return d},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var X="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",Y=/ jQuery\d+="(?:\d+|null)"/g,Z=/^\s+/,$=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,_=/<([\w:]+)/,ab=/<tbody/i,bb=/<|&#?\w+;/,cb=/<(?:script|style)/i,db=/<(?:script|object|embed|option|style)/i,eb=new RegExp("<(?:"+X.replace(" ","|")+")","i"),fb=/checked\s*(?:[^=]|=\s*.checked.)/i,gb=/\/(java|ecma)script/i,hb=/^\s*<!(?:\[CDATA\[|\-\-)/,ib={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},jb=W(b);ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td,e.support.htmlSerialize||(ib._default=[1,"div<div>","</div>"]),e.fn.extend({text:function(a){return e.isFunction(a)?this.each(function(b){var c=e(this);c.text(a.call(this,b,c.text()))}):typeof a!="object"&&a!==undefined?this.empty().append((this[0]&&this[0].ownerDocument||b).createTextNode(a)):e.text(this)},wrapAll:function(a){if(e.isFunction(a))return this.each(function(b){e(this).wrapAll(a.call(this,b))});if(this[0]){var b=e(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return e.isFunction(a)?this.each(function(b){e(this).wrapInner(a.call(this,b))}):this.each(function(){var b=e(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){e(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){e.nodeName(this,"body")||e(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode
)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=e(arguments[0]);return a.push.apply(a,this.toArray()),this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);return a.push.apply(a,e(arguments[0]).toArray()),a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||e.filter(a,[d]).length)!b&&d.nodeType===1&&(e.cleanData(d.getElementsByTagName("*")),e.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&e.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){return a=a==null?!1:a,b=b==null?a:b,this.map(function(){return e.clone(this,a,b)})},html:function(a){if(a===undefined)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Y,""):null;if(typeof a=="string"&&!cb.test(a)&&(e.support.leadingWhitespace||!Z.test(a))&&!ib[(_.exec(a)||["",""])[1].toLowerCase()]){a=a.replace($,"<$1></$2>");try{for(var b=0,c=this.length;b<c;b++)this[b].nodeType===1&&(e.cleanData(this[b].getElementsByTagName("*")),this[b].innerHTML=a)}catch(d){this.empty().append(a)}}else e.isFunction(a)?this.each(function(b){var c=e(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){return this[0]&&this[0].parentNode?e.isFunction(a)?this.each(function(b){var c=e(this),d=c.html();c.replaceWith(a.call(this,b,d))}):(typeof a!="string"&&(a=e(a).detach()),this.each(function(){var b=this.nextSibling,c=this.parentNode;e(this).remove(),b?e(b).before(a):e(c).append(a)})):this.length?this.pushStack(e(e.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){var d,f,g,h,i=a[0],j=[];if(!e.support.checkClone&&arguments.length===3&&typeof i=="string"&&fb.test(i))return this.each(function(){e(this).domManip(a,b,c,!0)});if(e.isFunction(i))return this.each(function(d){var f=e(this);a[0]=i.call(this,d,b?f.html():undefined),f.domManip(a,b,c)});if(this[0]){h=i&&i.parentNode,e.support.parentNode&&h&&h.nodeType===11&&h.childNodes.length===this.length?d={fragment:h}:d=e.buildFragment(a,this,j),g=d.fragment,g.childNodes.length===1?f=g=g.firstChild:f=g.firstChild;if(f){b=b&&e.nodeName(f,"tr");for(var k=0,l=this.length,m=l-1;k<l;k++)c.call(b?kb(this[k],f):this[k],d.cacheable||l>1&&k<m?e.clone(g,!0,!0):g)}j.length&&e.each(j,qb)}return this}}),e.buildFragment=function(a,c,d){var f,g,h,i,j=a[0];return c&&c[0]&&(i=c[0].ownerDocument||c[0]),i.createDocumentFragment||(i=b),a.length===1&&typeof j=="string"&&j.length<512&&i===b&&j.charAt(0)==="<"&&!db.test(j)&&(e.support.checkClone||!fb.test(j))&&!e.support.unknownElems&&eb.test(j)&&(g=!0,h=e.fragments[j],h&&h!==1&&(f=h)),f||(f=i.createDocumentFragment(),e.clean(a,i,f,d)),g&&(e.fragments[j]=h?f:1),{fragment:f,cacheable:g}},e.fragments={},e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){e.fn[a]=function(c){var d=[],f=e(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&f.length===1)return f[b](this[0]),this;for(var h=0,i=f.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();e(f[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,f.selector)}}),e.extend({clone:function(a,b,c){var d=a.cloneNode(!0),f,g,h;if((!e.support.noCloneEvent||!e.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!e.isXMLDoc(a)){mb(a,d),f=nb(a),g=nb(d);for(h=0;f[h];++h)g[h]&&mb(f[h],g[h])}if(b){lb(a,d);if(c){f=nb(a),g=nb(d);for(h=0;f[h];++h)lb(f[h],g[h])}}return f=g=null,d},clean:function(a,c,d,f){var g;c=c||b,typeof c.createElement=="undefined"&&(c=c.ownerDocument||c[0]&&c[0].ownerDocument||b);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!bb.test(k))k=c.createTextNode(k);else{k=k.replace($,"<$1></$2>");var l=(_.exec(k)||["",""])[1].toLowerCase(),m=ib[l]||ib._default,n=m[0],o=c.createElement("div");c===b?jb.appendChild(o):W(c).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!e.support.tbody){var p=ab.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)e.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!e.support.leadingWhitespace&&Z.test(k)&&o.insertBefore(c.createTextNode(Z.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!e.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)pb(k[i]);else pb(k);k.nodeType?h.push(k):h=e.merge(h,k)}if(d){g=function(a){return!a.type||gb.test(a.type)};for(j=0;h[j];j++)if(f&&e.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))f.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=e.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=e.cache,f=e.event.special,g=e.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&e.noData[i.nodeName.toLowerCase()])continue;c=i[e.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)f[j]?e.event.remove(i,j):e.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[e.expando]:i.removeAttribute&&i.removeAttribute(e.expando),delete d[c]}}}});var rb=/alpha\([^)]*\)/i,sb=/opacity=([^)]*)/,tb=/([A-Z]|^ms)/g,ub=/^-?\d+(?:px)?$/i,vb=/^-?\d/,wb=/^([\-+])=([\-+.\de]+)/,xb={position:"absolute",visibility:"hidden",display:"block"},yb=["Left","Right"],zb=["Top","Bottom"],Ab,Bb,Cb;e.fn.css=function(a,b){return arguments.length===2&&b===undefined?this:e.access(this,a,b,!0,function(a,b,c){return c!==undefined?e.style(a,b,c):e.css(a,b)})},e.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Ab(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":e.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(!a||a.nodeType===3||a.nodeType===8||!a.style)return;var f,g,h=e.camelCase(b),i=a.style,j=e.cssHooks[h];b=e.cssProps[h]||h;if(c===undefined)return j&&"get"in j&&(f=j.get(a,!1,d))!==undefined?f:i[b];g=typeof c,g==="string"&&(f=wb.exec(c))&&(c=+(f[1]+1)*+f[2]+parseFloat(e.css(a,b)),g="number");if(c==null||g==="number"&&isNaN(c))return;g==="number"&&!e.cssNumber[h]&&(c+="px");if(!j||!("set"in j)||(c=j.set(a,c))!==undefined)try{i[b]=c}catch(k){}},css:function(a,b,c){var d,f;b=e.camelCase(b),f=e.cssHooks[b],b=e.cssProps[b]||b,b==="cssFloat"&&(b="float");if(f&&"get"in f&&(d=f.get(a,!0,c))!==undefined)return d;if(Ab)return Ab(a,b)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),e.curCSS=e.css,e.each(["height","width"],function(a,b){e.cssHooks[b]={get:function(a,c,d){var f;if(c)return a.offsetWidth!==0?Db(a,b,d):(e.swap(a,xb,function(){f=Db(a,b,d)}),f)},set:function(a,b){if(!ub.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),e.support.opacity||(e.cssHooks.opacity={get:function(a,b){return sb.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,f=e.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&e.trim(g.replace(rb,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=rb.test(g)?g.replace(rb,f):g+" "+f}}),e(function(){e.support.reliableMarginRight||(e.cssHooks.marginRight={get:function(a,b){var c;return e.swap(a,{display:"inline-block"},function(){b?c=Ab(a,"margin-right","marginRight"):c=a.style.marginRight}),c}})}),b.defaultView&&b.defaultView.getComputedStyle&&(Bb=function(a,b){var c,d,f;b=b.replace(tb,"-$1").toLowerCase();if(!(d=a.ownerDocument.defaultView))return undefined;if(f=d.getComputedStyle(a,null))c=f.getPropertyValue(b),c===""&&!e.contains(a.ownerDocument.documentElement,a)&&(c=e.style(a,b));return c}),b.documentElement.currentStyle&&(Cb=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;return f===null&&g&&(e=g[b])&&(f=e),!ub.test(f)&&vb.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d)),f===""?"auto":f}),Ab=Bb||Cb,e.expr&&e.expr.filters&&(e.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!e.support.reliableHiddenOffsets&&(a.style&&a.style.display||e.css(a,"display"))==="none"},e.expr.filters.visible=function(a){return!e.expr.filters.hidden(a)});var Eb=/%20/g,Fb=/\[\]$/,Gb=/\r?\n/g,Hb=/#.*$/,Ib=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Jb=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,Kb=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/\?/,Ob=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,Pb=/^(?:select|textarea)/i,Qb=/\s+/,Rb=/([?&])_=[^&]*/,Sb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Tb=e.fn.load,Ub={},Vb={},Wb,Xb,Yb=["*/"]+["*"];try{Wb=d.href}catch(Zb){Wb=b.createElement("a"),Wb.href="",Wb=Wb.href}Xb=Sb.exec(Wb.toLowerCase())||[],e.fn.extend({load:function(a,b,c){if(typeof a!="string"&&Tb)return Tb.apply(this,arguments);if(!this.length)return this;var d=a.indexOf(" ");if(d>=0){var f=a.slice(d,a.length);a=a.slice(0,d)}var g="GET";b&&(e.isFunction(b)?(c=b,b=undefined):typeof b=="object"&&(b=e.param(b,e.ajaxSettings.traditional),g="POST"));var h=this;return e.ajax({url:a,type:g,dataType:"html",data:b,complete:function(a,b,d){d=a.responseText,a.isResolved()&&(a.done(function(a){d=a}),h.html(f?e("<div>").append(d.replace(Ob,"")).find(f):d)),c&&h.each(c,[d,b,a])}}),this},serialize:function(){return e.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?e.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||Pb.test(this.nodeName)||Jb.test(this.type))}).map(function(a,b){var c=e(this).val();return c==null?null:e.isArray(c)?e.map(c,function(a,c){return{name:b.name,value:a.replace(Gb,"\r\n")}}):{name:b.name,value:c.replace(Gb,"\r\n")}}).get()}}),e.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){e.fn[b]=function(a){return this.bind(b,a)}}),e.each(["get","post"],function(a,b){e[b]=function(a,c,d,f){return e.isFunction(c)&&(f=f||d,d=c,c=undefined),e.ajax({type:b,url:a,data:c,success:d,dataType:f})}}),e.extend({getScript:function(a,b){return e.get(a,undefined,b,"script")},getJSON:function(a,b,c){return e.get(a,b,c,"json")},ajaxSetup:function(a,b){return b?ac(a,e.ajaxSettings):(b=a,a=e.ajaxSettings),ac(a,b),a},ajaxSettings:{url:Wb,isLocal:Kb.test(Xb[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Yb},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":e.parseJSON,"text xml":e.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:$b(Ub),ajaxTransport:$b(Vb),ajax:function(a,b){function v(a,b,k,l){if(r===2)return;r=2,p&&clearTimeout(p),o=undefined,m=l||"",u.readyState=a>0?4:0;var n,q,t,v=b,w=k?cc(c,u,k):undefined,x,y;if(a>=200&&a<300||a===304){if(c.ifModified){if(x=u.getResponseHeader("Last-Modified"))e.lastModified[j]=x;if(y=u.getResponseHeader("Etag"))e.etag[j]=y}if(a===304)v="notmodified",n=!0;else try{q=dc(c,w),v="success",n=!0}catch(z){v="parsererror",t=z}}else{t=v;if(!v||a)v="error",a<0&&(a=0)}u.status=a,u.statusText=""+(b||v),n?g.resolveWith(d,[q,v,u]):g.rejectWith(d,[u,v,t]),u.statusCode(i),i=undefined,s&&f.trigger("ajax"+(n?"Success":"Error"),[u,c,n?q:t]),h.fireWith(d,[u,v]),s&&(f.trigger("ajaxComplete",[u,c]),--e.active||e.event.trigger("ajaxStop"))}typeof a=="object"&&(b=a,a=undefined),b=b||{};var c=e.ajaxSetup({},b),d=c.context||c,f=d!==c&&(d.nodeType||d instanceof e)?e(d):e.event,g=e.Deferred(),h=e.Callbacks("once memory"),i=c.statusCode||{},j,k={},l={},m,n,o,p,q,r=0,s,t,u={readyState:0,setRequestHeader:function(a,b){if(!r){var c=a.toLowerCase();a=l[c]=l[c]||a,k[a]=b}return this},getAllResponseHeaders:function(){return r===2?m:null},getResponseHeader:function(a){var b;if(r===2){if(!n){n={};while(b=Ib.exec(m))n[b[1].toLowerCase()]=b[2]}b=n[a.toLowerCase()]}return b===undefined?null:b},overrideMimeType:function(a){return r||(c.mimeType=a),this},abort:function(a){return a=a||"abort",o&&o.abort(a),v(0,a),this}};g.promise(u),u.success=u.done,u.error=u.fail,u.complete=h.add,u.statusCode=function(a){if(a){var b;if(r<2)for(b in a)i[b]=[i[b],a[b]];else b=a[u.status],u.then(b,b)}return this},c.url=((a||c.url)+"").replace(Hb,"").replace(Mb,Xb[1]+"//"),c.dataTypes=e.trim(c.dataType||"*").toLowerCase().split(Qb),c.crossDomain==null&&(q=Sb.exec(c.url.toLowerCase()),c.crossDomain=!(!q||q[1]==Xb[1]&&q[2]==Xb[2]&&(q[3]||(q[1]==="http:"?80:443))==(Xb[3]||(Xb[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=e.param(c.data,c.traditional)),_b(Ub,c,b,u);if(r===2)return!1;s=c.global,c.type=c.type.toUpperCase(),c.hasContent=!Lb.test(c.type),s&&e.active++===0&&e.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(Nb.test(c.url)?"&":"?")+c.data,delete c.data),j=c.url;if(c.cache===!1){var w=e.now(),x=c.url.replace(Rb,"$1_="+w);c.url=x+(x===c.url?(Nb.test(c.url)?"&":"?")+"_="+w:"")}}(c.data&&c.hasContent&&c.contentType!==!1||b.contentType)&&u.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(j=j||c.url,e.lastModified[j]&&u.setRequestHeader("If-Modified-Since",e.lastModified[j]),e.etag[j]&&u.setRequestHeader("If-None-Match",e.etag[j])),u.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Yb+"; q=0.01":""):c.accepts["*"]);for(t in c.headers)u.setRequestHeader(t,c.headers[t]);if(!c.beforeSend||c.beforeSend.call(d,u,c)!==!1&&r!==2){for(t in{success:1,error:1,complete:1})u[t](c[t]);o=_b(Vb,c,b,u);if(!o)v(-1,"No Transport");else{u.readyState=1,s&&f.trigger("ajaxSend",[u,c]),c.async&&c.timeout>0&&(p=setTimeout(function(){u.abort("timeout")},c.timeout));try{r=1,o.send(k,v)}catch(y){r<2?v(-1,y):e.error(y)}}return u}return u.abort(),!1},param:function(a,b){var c=[],d=function(a,b){b=e.isFunction(b)?b():b,c[c.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};b===undefined&&(b=e.ajaxSettings.traditional);if(e.isArray(a)||a.jquery&&!e.isPlainObject(a))e.each(a,function(){d(this.name,this.value)});else for(var f in a)bc(f,a[f],b,d);return c.join("&").replace(Eb,"+")}}),e.extend({active:0,lastModified:{},etag:{}});var ec=e.now(),fc=/(\=)\?(&|$)|\?\?/i;e.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return e.expando+"_"+ec++}}),e.ajaxPrefilter("json jsonp",function(b,c,d){var f=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(fc.test(b.url)||f&&fc.test(b.data))){var g,h=b.jsonpCallback=e.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";return b.jsonp!==!1&&(j=j.replace(fc,l),b.url===j&&(f&&(k=k.replace(fc,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&e.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){return g||e.error(h+" was not called"),g[0]},b.dataTypes[0]="json","script"}}),e.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){return e.globalEval(a),a}}}),e.ajaxPrefilter("script",function(a){a.cache===undefined&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),e.ajaxTransport("script",function(a){if(a.crossDomain){var c,d=b.head||b.getElementsByTagName("head")[0]||b.documentElement;return{send:function(e,f){c=b.createElement("script"),c.async="async",a.scriptCharset&&(c.charset=a.scriptCharset),c.src=a.url,c.onload=c.onreadystatechange=function(a,b){if(b||!c.readyState||/loaded|complete/.test(c.readyState))c.onload=c.onreadystatechange=null,d&&c.parentNode&&d.removeChild(c),c=undefined,b||f(200,"success")},d.insertBefore(c,d.firstChild)},abort:function(){c&&c.onload(0,1)}}}});var gc=a.ActiveXObject?function(){for(var a in ic)ic[a](0,1)}:!1,hc=0,ic;e.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&jc()||kc()}:jc,function(a){e.extend(e.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(e.ajaxSettings.xhr()),e.support.ajax&&e.ajaxTransport(function(b){if(!b.crossDomain||e.support.cors){var c;return{send:function(d,f){var g=b.xhr(),h,i;b.username?g.open(b.type,b.url,b.async,b.username,b.password):g.open(b.type,b.url,b.async);if(b.xhrFields)for(i in b.xhrFields)g[i]=b.xhrFields[i];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),!b.crossDomain&&!d["X-Requested-With"]&&(d["X-Requested-With"]="XMLHttpRequest");try{for(i in d)g.setRequestHeader(i,d[i])}catch(j){}g.send(b.hasContent&&b.data||null),c=function(a,d){var i,j,k,l,m;try{if(c&&(d||g.readyState===4)){c=undefined,h&&(g.onreadystatechange=e.noop,gc&&delete ic[h]);if(d)g.readyState!==4&&g.abort();else{i=g.status,k=g.getAllResponseHeaders(),l={},m=g.responseXML,m&&m.documentElement&&(l.xml=m),l.text=g.responseText;try{j=g.statusText}catch(n){j=""}!i&&b.isLocal&&!b.crossDomain?i=l.text?200:404:i===1223&&(i=204)}}}catch(o){d||f(-1,o)}l&&f(i,j,l,k)},!b.async||g.readyState===4?c():(h=++hc,gc&&(ic||(ic={},e(a).unload(gc)),ic[h]=c),g.onreadystatechange=c)},abort:function(){c&&c(0,1)}}}});var lc={},mc,nc,oc=/^(?:toggle|show|hide)$/,pc=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,qc,rc=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],sc;e.fn.extend({show:function(a,b,c){var d,f;if(a||a===0)return this.animate(vc("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(f=d.style.display,!e._data(d,"olddisplay")&&f==="none"&&(f=d.style.display=""),f===""&&e.css(d,"display")==="none"&&e._data(d,"olddisplay",wc(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){f=d.style.display;if(f===""||f==="none")d.style.display=e._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(vc("hide",3),a,b,c);var d,f,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(f=e.css(d,"display"),f!=="none"&&!e._data(d,"olddisplay")&&e._data(d,"olddisplay",f));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:e.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";return e.isFunction(a)&&e.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:e(this).is(":hidden");e(this)[b?"show":"hide"]()}):this.animate(vc("toggle",3),a,b,c),this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){f.queue===!1&&e._mark(this);var b=e.extend({},f),c=this.nodeType===1,d=c&&e(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=e.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],e.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],e.css(this,"display")==="inline"&&e.css(this,"float")==="none"&&(!e.support.inlineBlockNeedsLayout||wc(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new e.fx(this,b,i),h=a[i],oc.test(h)?(o=e._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(e._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=pc.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(e.cssNumber[i]?"":"px"),n!=="px"&&(e.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,e.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var f=e.speed(b,c,d);return e.isEmptyObject(a)?this.each(f.complete,[!1]):(a=e.extend({},a),f.queue===!1?this.each(g):this.queue(f.queue,g))},stop:function(a,b,c){return typeof a!="string"&&(c=b,b=a,a=undefined),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){function h(a,b,d){var f=b[d];e.removeData(a,d,!0),f.stop(c)}var b,d=!1,f=e.timers,g=e._data(this);c||e._unmark(!0,this);if(a==null)for(b in g)g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=f.length;b--;)f[b].elem===this&&(a==null||f[b].queue===a)&&(c?f[b](!0):f[b].saveState(),d=!0,f.splice(b,1));(!c||!d)&&e.dequeue(this,a)})}}),e.each({slideDown:vc("show",1),slideUp:vc("hide",1),slideToggle:vc("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){e.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),e.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?e.extend({},a):{complete:c||!c&&b||e.isFunction(a)&&a,duration:a,easing:c&&b||b&&!e.isFunction(b)&&b};d.duration=e.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in e.fx.speeds?e.fx.speeds[d.duration]:e.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";return d.old=d.complete,d.complete=function(a){e.isFunction(d.old)&&d.old.call(this),d.queue?e.dequeue(this,d.queue):a!==!1&&e._unmark(this)},d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),e.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(e.fx.step[this.prop]||e.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]==null||!!this.elem.style&&this.elem.style[this.prop]!=null){var a,b=e.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a}return this.elem[this.prop]},custom:function(a,b,c){function g(a){return d.step(a)}var d=this,f=e.fx;this.startTime=sc||tc(),this.end=b,this.now=this.start=a,this.pos=this.state=0,this.unit=c||this.unit||(e.cssNumber[this.prop]?"":"px"),g.queue=this.options.queue,g.elem=this.elem,g.saveState=function(){d.options.hide&&e._data(d.elem,"fxshow"+d.prop)===undefined&&e._data(d.elem,"fxshow"+d.prop,d.start)},g()&&e.timers.push(g)&&!qc&&(qc=setInterval(f.tick,f.interval))},show:function(){var a=e._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||e.style(this.elem,this.prop),this.options.show=!0,a!==undefined?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),e(this.elem).show()},hide:function(){this.options.orig[this.prop]=e._data(this.elem,"fxshow"+this.prop)||e.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,f=sc||tc(),g=!0,h=this.elem,i=this.options;if(a||f>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!e.support.shrinkWrapBlocks&&e.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&e(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)e.style(h,b,i.orig[b]),e.removeData(h,"fxshow"+b,!0),e.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}return i.duration==Infinity?this.now=f:(c=f-this.startTime,this.state=c/i.duration,this.pos=e.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update(),!0}},e.extend(e.fx,{tick:function(){var a,b=e.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||e.fx.stop()},interval:13,stop:function(){clearInterval(qc),qc=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){e.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),e.each(["width","height"],function(a,b){e.fx.step[b]=function(a){e.style(a.elem,b,Math.max(0,a.now))}}),e.expr&&e.expr.filters&&(e.expr.filters.animated=function(a){return e.grep(e.timers,function(b){return a===b.elem}).length});var xc=/^t(?:able|d|h)$/i,yc=/^(?:body|html)$/i;"getBoundingClientRect"in b.documentElement?e.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){e.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return e.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var f=b.ownerDocument,g=f.documentElement;if(!c||!e.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=f.body,i=zc(f),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||e.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||e.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:e.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){e.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return e.offset.bodyOffset(b);var c,d=b.offsetParent,f=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(e.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,e.support.doesNotAddBorder&&(!e.support.doesAddBorderForTableAndCells||!xc.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),f=d,d=b.offsetParent),e.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;return e.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft)),{top:l,left:m}},e.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;return e.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(e.css(a,"marginTop"))||0,c+=parseFloat(e.css(a,"marginLeft"))||0),{top:b,left:c}},setOffset:function(a,b,c){var d=e.css(a,"position");d==="static"&&(a.style.position="relative");var f=e(a),g=f.offset(),h=e.css(a,"top"),i=e.css(a,"left"),j=(d==="absolute"||d==="fixed")&&e.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=f.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),e.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):f.css(k)}},e.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=yc.test(b[0].nodeName)?{top:0,left:0}:b.offset();return c.top-=parseFloat(e.css(a,"marginTop"))||0,c.left-=parseFloat(e.css(a,"marginLeft"))||0,d.top+=parseFloat(e.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(e.css(b[0],"borderLeftWidth"))||0,{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||b.body;while(a&&!yc.test(a.nodeName)&&e.css(a,"position")==="static")a=a.offsetParent;return a})}}),e.each(["Left","Top"],function(a,b){var c="scroll"+b;e.fn[c]=function(b){var d,f;return b===undefined?(d=this[0],d?(f=zc(d),f?"pageXOffset"in f?f[a?"pageYOffset":"pageXOffset"]:e.support.boxModel&&f.document.documentElement[c]||f.document.body[c]:d[c]):null):this.each(function(){f=zc(this),f?f.scrollTo(a?e(f).scrollLeft():b,a?b:e(f).scrollTop()):this[c]=b})}}),e.each(["Height","Width"],function(a,b){var c=b.toLowerCase();e.fn["inner"+b]=function(){var a=this[0];return a?a.style?parseFloat(e.css(a,c,"padding")):this[c]():null},e.fn["outer"+b]=function(a){var b=this[0];return b?b.style?parseFloat(e.css(b,c,a?"margin":"border")):this[c]():null},e.fn[c]=function(a){var d=this[0];if(!d)return a==null?null:this;if(e.isFunction(a))return this.each(function(b){var d=e(this);d[c](a.call(this,b,d[c]()))});if(e.isWindow(d)){var f=d.document.documentElement["client"+b],g=d.document.body;return d.document.compatMode==="CSS1Compat"&&f||g&&g["client"+b]||f}if(d.nodeType===9)return Math.max(d.documentElement["client"+b],d.body["scroll"+b],d.documentElement["scroll"+b],d.body["offset"+b],d.documentElement["offset"+b]);if(a===undefined){var h=e.css(d,c),i=parseFloat(h);return e.isNumeric(i)?i:h}return this.css(c,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=e})(window)},{})}),require.whenReady("settings",function(){require.install("json2",function(require,exports,module){this.JSON||(this.JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)d=rep[c],typeof d=="string"&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},{})}),require.whenReady("settings",function(){require.install("assert",function(require,a,b){function d(){}function e(){debugger}function f(a){if(c.debug)try{e()}finally{throw a}}function g(a){this.message=a.message||this.message,this.actual=a.actual,this.expected=a.expected}function i(a,b){if(a===b)return!0;if(a instanceof Date)return b instanceof Date&&+a===+b;if(typeof a!="object"||typeof b!="object")return a==b;if(a.prototype!==
b.prototype)return!1;var c,d={};for(c in a)d[c]=!0;for(c in b)d[c]=!0;if(a instanceof Array)for(var e=Math.max(a.length,b.length)-1;e>=0;--e){if(e in d)break;d[e]=!0}for(c in d)if(c in a!=c in b||h.call(a,c)!=h.call(b,c)||!i(a[c],b[c]))return!1;return!0}function j(b){return function(c,e,h){(b.call(a,c,e)?d:f)(new g({message:h,actual:c,expected:e}))}}var c=require("settings");g.prototype=new Error("assertion failure"),g.prototype.toString=function(){return this.message+(": got "+this.actual+", expected "+this.expected)};var h={}.hasOwnProperty;a.AssertionError=g,a.equal=j(function(a,b){return a==b}),a.notEqual=j(function(a,b){return a!=b}),a.deepEqual=j(function(a,b){return i(a,b)}),a.notDeepEqual=j(function(a,b){return!i(a,b)}),a.strictEqual=j(function(a,b){return a===b}),a.notStrictEqual=j(function(a,b){return a!==b}),a.throws_error=j(function(a,b){try{return a(),!1}catch(c){return!b||c instanceof b}}),a.ok=window.assert=function(b,c){a.equal(!!b,!0,c)},a.notOk=function(b,c){a.equal(!!b,!1,c)},a.todo=function(b,c){b&&a.equal(!!b,!1,c)},a.greaterThan=j(function(a,b){return a>b}),a.lessThan=j(function(a,b){return a<b}),a.matches=j(function(a,b){return b instanceof RegExp&&b.test(a)})},{settings:!0})}),require.whenReady("settings",function(){require.install("jquery.securepost",function(require,a,b){(function(a){var b=require("settings").formkey;a.securepost=function(c,d,e,f){d=d||{};if(!b)throw new Error("No formkey set; can't securepost");return d.formkey=b,a.post(c,d,e,f)},a.secureData=function(d,e,f,g,h){typeof arguments[0]=="object"?(d=arguments[0],e=arguments[1],f=arguments[2],g=arguments[3],h=arguments[4]):(e=arguments[0],f=arguments[1],g=arguments[2],h=arguments[3],d=arguments[4]||{});if(!b)throw new Error("No formkey set; can't send data securely");d.type=d.type||"POST",d.dataType=d.dataType||"json",d.url=e;var i=d.secureDataError;d.success=function(a){if(a.___ERROR___){var b=a.___ERROR___[0],d=a.___ERROR___[1],f=new c("Got an error from the URL '"+e+"'",b,d);if(i)return i(b,d,f);throw f}if(g)return g(a)},d.error=h;var j=d.data||f;return d.data={formkey:b,data:JSON.stringify(j)},a.ajax(d)};var c=function(a,b,c){this.message=c+": "+a+" <"+JSON.stringify(b)+">"};c.prototype=new Error,c.prototype.constructor=c,a.secureData.SecureDataError=c})(jQuery)},{settings:!0})}),require.whenReady("settings",function(){require.install("jquery.cookie",function(require,a,b){jQuery.cookie=function(a,b,c){c=c||{};var d=c.document||document;assert(d.nodeType===9);if(typeof b=="undefined"){var j=null;if(d.cookie&&d.cookie!=""){var k=d.cookie.split(";");for(var l=0;l<k.length;l++){var m=jQuery.trim(k[l]);if(m.substring(0,a.length+1)==a+"="){j=decodeURIComponent(m.substring(a.length+1));break}}}return j}c=c||{},b===null&&(b="",c=$.extend({},c),c.expires=-1);var e="";if(c.expires&&(typeof c.expires=="number"||c.expires.toUTCString)){var f;typeof c.expires=="number"?(f=new Date,f.setTime(f.getTime()+c.expires*24*60*60*1e3)):f=c.expires,e="; expires="+f.toUTCString()}var g=c.path?"; path="+c.path:"",h=c.domain?"; domain="+c.domain:"",i=c.secure?"; secure":"";d.cookie=[a,"=",encodeURIComponent(b),e,g,h,i].join("")}},{})}),require.whenReady("settings",function(){require.install("cookies",function(require,a,b){function e(a,b,e){return e=e||{},e=$.extend({expires:999999,path:"/",domain:d},e),$.cookie(c.cookiePrefix+"-"+a,b,e)}function f(a,b){var c=document.cookie.length,d=document.cookie.split(";").length;if(c>2400||d>24)return;var f={key:a,args:b},g=Math.floor(Math.random()*4294967296);e("qm-"+g,JSON.stringify(f),{expires:1})}require("jquery.cookie");var c=require("settings"),d=".quora.com";a.cookie=e,a.setMessage=f,a.setSingleUse=function(a,b,c){e("qsu-"+a,b,c)},a.setQfeedLog=function(a,b){var c=a.getDvar("feed_story_hash");if(!c)return;var d=a.getDvar("feed_story_position");d===null&&(d=0);var e=a.getDvar("feed_story_inner_position");e===null&&(e=0);var g=a.getDvar("feed_story_initial");g||(g=!1);var h=a.getDvar("feed_ty");h===null&&(h=0);var i=a.getDvar("feed_page"),j=a.getDvar("page_data"),k=a.getDvar("focus_ty");f("qfl",[8,c,d,g,b,h,i,j,k,e])},a.setQueryLog=function(a,b){var c=a.getDvar("query_id");if(c===null)return;var d=a.getDvar("index");d===null&&(d=0),f("qlch",[c,{type:b,index:d}])},a.setTlog=function(a){var b=c.trail;if(b===null||b===undefined||a===undefined)return;f("tlog",[b,a])},a.setAnon=function(){e("anon",JSON.stringify(!0))},a.setPublic=function(){e("anon",null)},a.setAgeGate=function(){var a=new Date;a.setMinutes(a.getMinutes()+30),e("age_gate",+(new Date),{expires:a})}},{"jquery.cookie":!0,settings:!0})}),require.whenReady("settings",function(){require.install("scribe",function(require,a,b){function k(){e.length>=i?o():l()}function l(){h||(h=setTimeout(o,j))}function m(){d(g),g=!1}function n(){f=[],h=!1,m()}function o(){if(g){l();return}f=f.concat(e),e=[],g=!0,f.length>0&&c.rpc("/ajax/scribe_log_POST").kwargs({messages:f}).success(n).except(m).send()}var c=require("webnode2"),d=require("assert").ok,e=[],f=[],g=!1,h=!1,i=50,j=5e3;a.log=function(a,b){if(b===null||b===undefined)b=1;var c=!1;b&&(d(0<=b&&b<=1),c=Math.random()<=b),c&&(e.push(a),k())}},{webnode2:!0,assert:!0})}),require.whenReady("settings",function(){require.install("Class",function(require,a,b){function f(a,b){function j(){h||(a.call(e),g(f,b,c),h=!0,b=null);if(this===e)return;var d=this.__init__;d&&d.apply(this,arguments)}var c=d.prototype=a.prototype,f=new d,h;return j.prototype=f,j.extend=i,f.constructor=j,j}function g(a,b,c){for(var d in b)b.hasOwnProperty(d)&&(a[d]=c?h(d,b,c):b[d])}function h(a,b,d){var e=b[a],f=d[a];return typeof e=="function"&&typeof f=="function"&&e!==f&&c.test(e)?function(){var b=this._super;this._super=d[a];try{return e.apply(this,arguments)}finally{this._super=b}}:e}function i(a){return f(this,a)}var c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,d=function(){},e={};a.Class=i.call(function(){},{fnbind:function(a){var b=[];return arguments.length>1?(b=[this||null].concat(Array.prototype.slice.call(arguments,1)),a.bind.apply(a,b)):a.bind(this)}}),a.testExtendSpeed=function(b){var c=b=b||1e4,d=+(new Date),e=[];while(b-->0)e.push(a.Class.extend({__init__:function(a){this.val=a},method:function(a){this.val+=a}}).extend({method:function(a){this._super(a),this.val+=a},foo:function(){},bar:function(){this.foo()}}).extend({__init__:function(){this._super.apply(this,arguments)},foo:function(){}}));console.log(c,"class definitions took",new Date-d,"ms"),e.length=0}},{})}),require.whenReady("settings",function(){require.install("w2.context",function(require,a,b){var c=require("assert").ok,d=require("Class").Class,e=d.extend({__init__:function(a){this.value=a,this.handlers={}},bind:function(a,b){this.handlers.hasOwnProperty(b)||(this.handlers[b]=[]),this.handlers[b].push(a)},unbind:function(a){delete this.handlers[a]},trigger:function(){var a=Array.prototype.slice.call(arguments);for(var b in this.handlers)if(this.handlers.hasOwnProperty(b)){var c=this.handlers[b];for(var d=0;d<c.length;d++)c[d].apply(this,a)}},set:function(a){var b=this.value;this.value=a,this.trigger(b,a)},get:function(){return this.value}}),f=a.Context=d.extend({__init__:function(){var a=this.initialProperties();c(a,"Override initialProperties() in yoursubclasses to define a list of properties that this Context shouldlisten to"),this.properties={};for(var b in a)this.properties[b]=new e(a[b])},initialProperties:function(){},on:function(a,b,c){this.assertPropertyName(a),this.properties[a].bind(b,c)},off:function(a){for(var b in this.properties)this.properties[b].unbind(a)},set:function(a,b){this.assertPropertyName(a),this.properties[a].set(b)},get:function(a){return this.assertPropertyName(a),this.properties[a].get()},assertPropertyName:function(a){c(this.properties.hasOwnProperty(a),"Hey, you are trying to access a context property with an invalidproperty name. You can only retrieve property names that are definedin Context initialProperties definition in w2.context.js")}}),g=d.extend({__init__:function(a,b){this._context=a,this._cid=b},on:function(a,b){this._context.on(a,b,this._cid)},off:function(){this._context.off(this._cid)},get:function(a){return this._context.get(a)},set:function(a,b){this._context.set(a,b)}}),h=d.extend({__init__:function(a){this.component=a;var b=this.component.contextConstructor();this._context=b?new b(this.component):null,this._contextProxies=[]},get:function(a){for(var b=0;b<this._contextProxies.length;b++)if(this._contextProxies[b]._context instanceof a)return this._contextProxies[b];var c=null,d=this.component;while(d.cid!="*ROOT*"){var e=d.contextManager._context;if(e instanceof a){c=e;break}var f=d.parent();if(d===f)throw new Error(d+"is its own parent()");d=f}if(!c)return null;var h=new g(c,this.component.cid);return this._contextProxies.push(h),h},unload:function(){for(var a=0;a<this._contextProxies.length;a++)this._contextProxies[a].off()}});a.initComponent=function(a){var b=new h(a);a.contextManager=b,a.getContext=b.get.bind(b)},a.unloadComponent=function(a){a.contextManager&&a.contextManager.unload()},a.ContextDemoInParent=f.extend({initialProperties:function(){return{alpha_state:"none",beta_state:"none"}}}),a.ContextDemoInChild=f.extend({initialProperties:function(){return{delta_state:"none",theta_state:"none"}}}),a.RecentReviewsContext=f.extend({initialProperties:function(){return{label:null,vendor:null,uid:null}}}),a.MobileNuxMain=f.extend({initialProperties:function(){return{stage:null,step:0}}}),a.UserLeaderboardsMain=f.extend({initialProperties:function(){return{is_editing:!1}}}),a.ActionBar=f.extend({initialProperties:function(){return{commentsElem:null,loadComments:!1,showComments:!1,updateSticky:!1,toggleEditor:!1,selectedOverflowItem:null,overflowItems:[],showOverflowMenu:!1,overflowMenuTargetElement:null}}}),a.FeedStoryItem=f.extend({initialProperties:function(){return{showQuestionDownvoteFeedback:!1,showAnswerDownvoteFeedback:!1,feedbackShown:!1,showRemoveFromFeedMenu:null,hideItem:!1}}}),a.AnswerVoteContext=f.extend({initialProperties:function(){return{voteState:"no"}}}),a.UniversalPageFeedContext=f.extend({initialProperties:function(){return{feedStories:[],impressionLogger:null,readingTimeLogger:null}}}),a.QTextEditor=f.extend({initialProperties:function(){return{focusInput:!1}}}),a.EditQuestionOverflow=f.extend({initialProperties:function(){return{showMenu:!1}}}),a.QuestionAnswerVerbose=f.extend({initialProperties:function(){return{expand:!1}}}),a.CaptchaInput=f.extend({initialProperties:function(){return{sync:null,isCaptchaFilled:!0,captchaResponse:"random string"}}}),a.TribeChat=f.extend({initialProperties:function(){return{minimized:!1,messageBoxFocused:!1,unreadMessageCount:0}}}),a.QuestionArea=f.extend({initialProperties:function(){return{showActionBar:!0,editClicked:null,cancelClicked:null,triggerRequest:null,triggerCancel:null}}}),a.Editor=f.extend({initialProperties:function(){return{shareToTwitter:!1,shareToFacebook:!1}}})},{assert:!0,Class:!0})}),require.whenReady("settings",function(){require.install("visibility",function(require,a,b){function c(){try{var a=window.frameElement;return a.getAttribute("className"),a}catch(b){return null}}function d(a,b){return(" "+(a.className||"")+" ").indexOf(" "+b+" ")!=-1}function e(a,b){d(a,b)||(a.className=(a.className||"")+" "+b)}function f(a){var b=/^\s+/,c=/\s+$/;return a.trim?a.trim():a.replace(b,"").replace(c,"")}function g(a,b){a.className=f((" "+(a.className||"")+" ").replace(" "+b+" "," "))}a.getFrameElement=c,a.setVisible=function(a){var b=c();a?(window.focus(),b?e(b,"maximized"):g(document.body,"minimized")):b?g(b,"maximized"):e(document.body,"minimized")},a.isVisible=function(){var a=c();return a?d(a,"maximized"):!d(document.body,"minimized")},a.addClass=e,a.hasClass=d,a.removeClass=g},{})}),require.whenReady("settings",function(){require.install("jquery.dialog",function(require,a,b){(function(a){a.fn.dialog=function(a){return this.each(function(){new c(this,a)})};var b={id:"generic_dialog",title:"Title",contents:"",comment_form:"",mobile:null,buttons:{Ok:null,Cancel:null},class_:"",w:"w4"};a.dialog=function(c,d){var e=this;this.o=a(c),this.opts=a.extend({},b,d||{}),this.mobile=this.opts.mobile!=null?this.opts.mobile:!1;if(a("#"+this.opts.id).length>0){a("#"+this.opts.id).show();return}this.opts.buttons!=null&&(this.opts.buttons.Ok===null&&(this.opts.buttons.Ok=function(){e.btnOk()}),this.opts.buttons.Cancel===null&&(this.opts.buttons.Cancel=function(){e.btnCancel()}));if(this.opts.url){var f=this.opts.id+"_loading",g=this.opts.contents||'<div style="overflow:hidden;"><span class="__wn2_loading"><span class="__wn2_loading_spinner"></span><span class="__wn2_loading_text">Loading...</span></span></div>';this.opts.contents='<div id="'+f+'"><div class="__wn2_loading_wrapper">'+g+"</div></div>";var h=this.opts.urlData||{},i=require("webnode2");h.___W2_scope="__dialog__",h.___W2_windowId=i.windowId,a.get(this.opts.url,h,function(b){var c=document.getElementById(f);i.setContent(c,b),setTimeout(function(){!e.mobile&&a(window).height()<600&&a(".dialog .dialog_wrapper").css("position","static")},10)},"json")}return this.mobile&&(this.opts.w=""),this.render(),this};var c=a.dialog;c.fn=c.prototype={dialog:"0.0.1"},c.fn.extend=c.extend=a.extend,c.fn.extend({btnOk:function(){this.close()},btnCancel:function(){this.close()},close:function(){a("#"+this.opts.id).remove()},hide:function(){a("#"+this.opts.id).hide()},render:function(){var b="";this.opts.title?(b=a("<div/>").addClass("dialog_wrapper").append(a("<h2/>").addClass("dialog_frame").addClass("dialog_header").text(this.opts.title)),this.opts.contents&&b.append(a("<div/>").addClass("dialog_frame").addClass("dialog_contents").html(this.opts.contents)),this.opts.comment_form!=""&&b.append(a("<div/>").addClass("dialog_frame").addClass("dialog_contents").append(this.renderCommentForm(this.opts.comment_form)))):b=a("<div/>").addClass("dialog_component").html(this.opts.contents),this.o.append(a("<div/>").addClass("dialog").addClass(this.opts.w).addClass(this.opts.class_).attr("id",this.opts.id).append(b)),this.opts.buttons!=null&&a(".dialog_wrapper").append(a("<div/>").addClass("dialog_frame").addClass("dialog_buttons").append(a("<div/>").addClass("dialog_buttons_contents").html(this.renderButtons())));if(this.mobile){var c=a(window).width();window.scrollTo(0,1),a(".dialog").css("top","0px"),a(".dialog").css("left","10px"),a(".dialog").css("width",parseInt(c)-25+"px")}else{var d=150,e=a(window).width()/2-a(".dialog").width()/2;a(".dialog").css("top",d+"px"),a(".dialog").css("left",e+"px")}this.opts.comment_form!=""&&a("#dialog_comment").focus();var f=this;return a(document).keydown(function(a){return f.keydown(a)}),!1},keydown:function(b){var c=b||window.event;if(c.keyCode==27)return this.close(),a(document).unbind(),!1},renderCommentForm:function(b){if(!b||b=="")b="Add a Comment";return a("<div/>").append(a("<h3/>").text(b+":")).append(a("<textarea/>").attr("id","dialog_comment"))},renderButtons:function(){var b=this,c=a("<div/>");return a.each(this.opts.buttons,function(d,e){var f="submit_button";d=="Cancel"?f="cancel":d=="Close"&&(f="action_button");var g=a("<a/>").addClass("dialog_button").addClass(f).attr("id",d).html(d).click(e);b.opts.buttons_hide_on_close?g=g.click(function(){b.hide()}):g=g.click(function(){b.close()}),c.append(g)}),c}})})(jQuery)},{webnode2:!0})}),require.whenReady("settings",function(){require.install("jquery.tooltip",function(require,a,b){var c=require("settings");(function(a){a.fn.tooltip=function(a){return this.each(function(){new c(this,a)})};var b={id:"tooltip",contents:"",delay:75,class_:"tooltip",parent_class:"tooltip_parent",direction:"top",prepend:!1,align_center:!0};a.tooltip=function(c,d){if(a("body").hasClass("mobile"))return;var e=this;this.o=a(c),this.opts=a.extend({},b,d||{});var e=this;this.o.hover(function(){e.render()},function(){e.close()})};var c=a.tooltip;c.fn=c.prototype={tooltip:"0.0.1"},c.fn.extend=c.extend=a.extend,c.fn.extend({to:null,btnOk:function(){this.close()},btnCancel:function(){this.close()},close:function(){clearTimeout(this.to),this.to=null,this.tt=null,this.o.removeClass(this.opts.parent_class),a("."+this.opts.class_).remove()},render:function(){var b=this.opts.parent_class;a("."+b).removeClass(b),a("."+this.opts.class_).remove();var c=50,d=this.o.offset().top<c||this.opts.direction=="bottom";d?this.set_tooltip_bottom():this.set_tooltip(),this.o.addClass(b),this.opts.prepend?this.o.prepend(this.tt):this.o.append(this.tt),this.tt.hide();var e=this.tt.height()+5,f=this.o.height()+5;this.tt.css("display","block");var g=this.tt.find(".tooltip_contents").outerWidth();this.tt.css("display","none");var h=this.o.outerWidth();d?this.tt.css("top",f+"px"):this.tt.css("top","-"+e+"px"),this.opts.align_center?this.tt.css("left",(h-g)/2+"px"):this.tt.css("left","-16px");var i=this,j=function(){i.tt.show()};this.to=setTimeout(j,this.opts.delay)},set_tooltip:function(){this.tt=a("<div/>").addClass(this.opts.class_).append(a("<div/>").addClass("tooltip_contents nub_bottom").append(a("<span/>").text(this.opts.contents)))},set_tooltip_bottom:function(){this.tt=a("<div/>").addClass(this.opts.class_).append(a("<div/>").addClass("tooltip_contents nub_top").append(a("<span/>").text(this.opts.contents)))}})})(jQuery)},{settings:!0})}),require.whenReady("settings",function(){require.install("jquery.menu",function(require,a,b){var c=require("settings");(function(a){a.fn.menu=function(b,c){return this.each(function(){new a.menu(this,b,c)})};var b={id:"generic_menu",open:!1,url:null,list_items:{},position_adjust:null,align_right:!1,close_on_click:!0,close_other_menus_on_click:!1};a.menu=function(c,d,e){this.o=a(c),this.handle=d,this.opts=a.extend({},b,e||{}),this.render();var f=this;return a(document).click(function(b){a(b.target).parents(".menu").length===0&&f.close(b)}),this.opts.close_on_click&&a(".menu_list_item a").click(function(a){f.close(a)}),a(".menu_list_item a.close_on_click").click(function(a){f.close(a)}),!1},a.menu.fn=a.menu.prototype={menu:"0.0.1"},a.menu.fn.extend=a.menu.extend=a.extend,a.menu.fn.extend({close:function(b){var c=this;c.o.addClass("animate_out"),setTimeout(function(){c.o.addClass("hidden"),c.o.removeClass("animate_out"),b!==undefined&&(a(b.target).parent().siblings().removeClass("selected"),a(b.target).parent().addClass("selected"))},150)},render:function(){if(a("#"+this.opts.id).length>0)return!1;this.o.hasClass("hidden")||this.close();if(this.opts.close_other_menus_on_click){var b=this.o.attr("id");a(".menu:not(#"+b+")").addClass("hidden")}if(this.opts.url){var c=this;this.o.append(a("<div/>").addClass("menu").attr("id",this.opts.id).setContentFromAJAXComponent(this.opts.url,this.opts.pars))}else this.position(),this.o.removeClass("hidden")},position:function(){var b=this.handle.position();b.top-=1,b.left-=3;var c=this.handle.innerHeight(),d=a(window).height(),e=180,f=this.handle.offset().top-a(window).scrollTop(),g=d-f<e;g&&(b.top-=this.o.height(),b.top-=c*2,b.top+=16),this.opts.position_adjust&&(b.top+=this.opts.position_adjust.top,b.left+=this.opts.position_adjust.left),this.opts.align_right&&(b.left-=this.o.width()-this.handle.innerWidth()),this.o.css("top",b.top+c+"px"),this.o.css("left",b.left+"px")}})})(jQuery)},{settings:!0})}),require.whenReady("settings",function(){require.install("jquery.topic",function(require,a,b){jQuery.addTempTopic=function(a){return this.id=a,this.topic_name=$("#"+a).val(),$(".topic_placeholder").addClass("hidden"),$(".topics_list").append($("<li/>").append($("<a/>").attr("href","#").attr("class","topic_name").text(this.topic_name)).append($("<a/>").attr("href","#").attr("class","topic_remove").text("").click(function(){return $(this).parent().remove(),!1})).attr("class","topic_list_item")),$("#"+a).val(""),!1}},{})}),require.whenReady("settings",function(){require.install("jquery.viewport",function(require,a,b){(function(a){a.belowthefold=function(b,c){var d=a(c.container).height()+a(c.container).scrollTop();return d<=a(b).offset().top-c.threshold},a.abovethetop=function(b,c){var d=a(c.container).scrollTop();return d>=a(b).offset().top+a(b).height()-c.threshold},a.rightofscreen=function(b,c){var d=a(c.container).width()+a(c.container).scrollLeft();return d<=a(b).offset().left-c.threshold},a.leftofscreen=function(b,c){var d=a(c.container).scrollLeft();return d>=a(b).offset().left+a(b).width()-c.threshold},a.inviewport=function(b,c){return!a.rightofscreen(b,c)&&!a.leftofscreen(b,c)&&!a.belowthefold(b,c)&&!a.abovethetop(b,c)},a.extend(a.expr[":"],{"below-the-fold":function(b,c,d){return a.belowthefold(b,{threshold:0,container:window})},"above-the-top":function(b,c,d){return a.abovethetop(b,{threshold:0,container:window})},"left-of-screen":function(b,c,d){return a.leftofscreen(b,{threshold:0,container:window})},"right-of-screen":function(b,c,d){return a.rightofscreen(b,{threshold:0,container:window})},"in-viewport":function(b,c,d){return a.inviewport(b,{threshold:0,container:window})}})})(jQuery)},{})}),require.whenReady("settings",function(){require.install("jquery.ajax",function(require,a,b){(function(a){var b=["async","beforeSend","beforeComplete","beforeSuccess","beforeError","cache","complete","contentType","data","dataFilter","dataType","error","global","ifModified","jsonp","password","processData","scriptCharset","success","timeout","type","url","username","xhr"],c={};a.each(b,function(a,b){c[b]=function(a){return this.__options[b]=a,this},c["_"+b]=function(){return this.__options[b]}}),c._options=function(){var c={},d=this;return a.each(b,function(a,b){c[b]=d["_"+b]()}),c},c.options=function(b){if(b){var c=this;a.each(b,function(a,b){c[a](b)})}return this},c.__init__=function(a){return this.__options={data:null},this.options(a),this},c.send=function(a){return this._send(a)},c._send=function(b){this.options(b);var c=this._options(),d=c.complete,e=c.error,f=c.success;return c.complete=function(){try{c.beforeComplete!=null&&c.beforeComplete.apply(this,arguments)}finally{d!=null&&d.apply(this,arguments)}},c.error=function(){try{c.beforeError!=null&&c.beforeError.apply(this,arguments)}finally{e!=null&&e.apply(this,arguments)}},c.success=function(){try{c.beforeSuccess!=null&&c.beforeSuccess.apply(this,arguments)}finally{f!=null&&f.apply(this,arguments)}},a.ajax(c)},a.Ajax=require("Class").Class.extend(c)})(jQuery)},{Class:!0})}),require.whenReady("settings",function(){require.install("effects.core",function(require,a,b){jQuery.effects||function(a){function b(b,c){var d=b[1]&&b[1].constructor==Object?b[1]:{};c&&(d.mode=c);var e=b[1]&&b[1].constructor!=Object?b[1]:d.duration?d.duration:b[2];e=a.fx.off?0:typeof e=="number"?e:a.fx.speeds[e]||a.fx.speeds._default;var f=d.callback||a.isFunction(b[1])&&b[1]||a.isFunction(b[2])&&b[2]||a.isFunction(b[3])&&b[3];return[b[0],d,e,f]}function c(b){var c;return b&&b.constructor==Array&&b.length==3?b:(c=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(b))?[parseInt(c[1],10),parseInt(c[2],10),parseInt(c[3],10)]:(c=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(b))?[parseFloat(c[1])*2.55,parseFloat(c[2])*2.55,parseFloat(c[3])*2.55]:(c=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(b))?[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(c=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(b))?[parseInt(c[1]+c[1],16),parseInt(c[2]+c[2],16),parseInt(c[3]+c[3],16)]:(c=/rgba\(0, 0, 0, 0\)/.exec(b))?e.transparent:e[a.trim(b).toLowerCase()]}function d(b,d){var e;do{e=a.curCSS(b,d);if(e!=""&&e!="transparent"||a.nodeName(b,"body"))break;d="backgroundColor"}while(b=b.parentNode);return c(e)}a.effects={version:"1.7.2",save:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.data("ec.storage."+b[c],a[0].style[b[c]])},restore:function(a,b){for(var c=0;c<b.length;c++)b[c]!==null&&a.css(b[c],a.data("ec.storage."+b[c]))},setMode:function(a,b){return b=="toggle"&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(a){if(a.parent().is(".ui-effects-wrapper"))return a.parent();var b={width:a.outerWidth(!0),height:a.outerHeight(!0),"float":a.css("float")};a.wrap('<div class="ui-effects-wrapper" style="font-size:100%;background:transparent;border:none;margin:0;padding:0"></div>');var c=a.parent();if(a.css("position")=="static")c.css({position:"relative"}),a.css({position:"relative"});else{var d=a.css("top");isNaN(parseInt(d,10))&&(d="auto");var e=a.css("left");isNaN(parseInt(e,10))&&(e="auto"),c.css({position:a.css("position"),top:d,left:e,zIndex:a.css("z-index")}).show(),a.css({position:"relative",top:0,left:0})}return c.css(b),c},removeWrapper:function(a){return a.parent().is(".ui-effects-wrapper")?a.parent().replaceWith(a):a},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e},animateClass:function(b,c,d,e){var f=typeof d=="function"?d:e?e:null,g=typeof d=="string"?d:null;return this.each(function(){var d={},e=a(this),h=e.attr("style")||"";typeof h=="object"&&(h=h.cssText),b.toggle&&(e.hasClass(b.toggle)?b.remove=b.toggle:b.add=b.toggle);var i=a.extend({},document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle);b.add&&e.addClass(b.add),b.remove&&e.removeClass(b.remove);var j=a.extend({},document.defaultView?document.defaultView.getComputedStyle(this,null):this.currentStyle);b.add&&e.removeClass(b.add),b.remove&&e.addClass(b.remove);for(var k in j)typeof j[k]!="function"&&j[k]&&k.indexOf("Moz")==-1&&k.indexOf("length")==-1&&j[k]!=i[k]&&(k.match(/color/i)||!k.match(/color/i)&&!isNaN(parseInt(j[k],10)))&&(i.position!="static"||i.position=="static"&&!k.match(/left|top|bottom|right/))&&(d[k]=j[k]);e.animate(d,c,g,function(){typeof a(this).attr("style")=="object"?(a(this).attr("style").cssText="",a(this).attr("style").cssText=h):a(this).attr("style",h),b.add&&a(this).addClass(b.add),b.remove&&a(this).removeClass(b.remove),f&&f.apply(this,arguments)})})}},a.fn.extend({_show:a.fn.show,_hide:a.fn.hide,__toggle:a.fn.toggle,_addClass:a.fn.addClass,_removeClass:a.fn.removeClass,_toggleClass:a.fn.toggleClass,effect:function(b,c,d,e){return a.effects[b]?a.effects[b].call(this,{method:b,options:c||{},duration:d,callback:e}):null},show:function(){return!arguments[0]||arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0])?this._show.apply(this,arguments):this.effect.apply(this,b(arguments,"show"))},hide:function(){return!arguments[0]||arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0])?this._hide.apply(this,arguments):this.effect.apply(this,b(arguments,"hide"))},toggle:function(){return!arguments[0]||arguments[0].constructor==Number||/(slow|normal|fast)/.test(arguments[0])||a.isFunction(arguments[0])||typeof arguments[0]=="boolean"?this.__toggle.apply(this,arguments):this.effect.apply(this,b(arguments,"toggle"))},addClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{add:b},c,d,e]):this._addClass(b)},removeClass:function(b,c,d,e){return c?a.effects.animateClass.apply(this,[{remove:b},c,d,e]):this._removeClass(b)},toggleClass:function(b,c,d,e){return typeof c!="boolean"&&c?a.effects.animateClass.apply(this,[{toggle:b},c,d,e]):this._toggleClass(b,c)},morph:function(b,c,d,e,f){return a.effects.animateClass.apply(this,[{add:c,remove:b},d,e,f])},switchClass:function(){return this.morph.apply(this,arguments)},cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}}),a.each(["backgroundColor","borderBottomColor","borderLeftColor","borderRightColor","borderTopColor","color","outlineColor"],function(b,e){a.fx.step[e]=function(a){a.state==0?(a.start=d(a.elem,e),a.end=c(a.end)):(typeof a.start=="number"&&(a.start=[a.start,a.start,a.start]),typeof a.end=="number"&&(a.end=[a.end,a.end,a.end])),a.elem.style[e]="rgb("+[Math.max(Math.min(parseInt(a.pos*(a.end[0]-a.start[0])+a.start[0],10),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[1]-a.start[1])+a.start[1],10),255),0),Math.max(Math.min(parseInt(a.pos*(a.end[2]-a.start[2])+a.start[2],10),255),0)].join(",")+")"}});var e={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0],transparent:[255,255,255]};a.easing.jswing=a.easing.swing,a.extend(a.easing,{def:"easeOutQuad",swing:function(b,c,d,e,f){return a.easing[a.easing.def](b,c,d,e,f)},easeInQuad:function(a,b,c,d,e){return d*(b/=e)*b+c},easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeInOutQuad:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b+c:-d/2*(--b*(b-2)-1)+c},easeInCubic:function(a,b,c,d,e){return d*(b/=e)*b*b+c},easeOutCubic:function(a,b,c,d,e){return d*((b=b/e-1)*b*b+1)+c},easeInOutCubic:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b+c:d/2*((b-=2)*b*b+2)+c},easeInQuart:function(a,b,c,d,e){return d*(b/=e)*b*b*b+c},easeOutQuart:function(a,b,c,d,e){return-d*((b=b/e-1)*b*b*b-1)+c},easeInOutQuart:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b+c:-d/2*((b-=2)*b*b*b-2)+c},easeInQuint:function(a,b,c,d,e){return d*(b/=e)*b*b*b*b+c},easeOutQuint:function(a,b,c,d,e){return d*((b=b/e-1)*b*b*b*b+1)+c},easeInOutQuint:function(a,b,c,d,e){return(b/=e/2)<1?d/2*b*b*b*b*b+c:d/2*((b-=2)*b*b*b*b+2)+c},easeInSine:function(a,b,c,d,e){return-d*Math.cos(b/e*(Math.PI/2))+d+c},easeOutSine:function(a,b,c,d,e){return d*Math.sin(b/e*(Math.PI/2))+c},easeInOutSine:function(a,b,c,d,e){return-d/2*(Math.cos(Math.PI*b/e)-1)+c},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){return b==0?c:b==e?c+d:(b/=e/2)<1?d/2*Math.pow(2,10*(b-1))+c:d/2*(-Math.pow(2,-10*--b)+2)+c},easeInCirc:function(a,b,c,d,e){return-d*(Math.sqrt(1-(b/=e)*b)-1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeInOutCirc:function(a,b,c,d,e){return(b/=e/2)<1?-d/2*(Math.sqrt(1-b*b)-1)+c:d/2*(Math.sqrt(1-(b-=2)*b)+1)+c},easeInElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return-(h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g))+c},easeOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e)==1)return c+d;g||(g=e*.3);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return h*Math.pow(2,-10*b)*Math.sin((b*e-f)*2*Math.PI/g)+d+c},easeInOutElastic:function(a,b,c,d,e){var f=1.70158,g=0,h=d;if(b==0)return c;if((b/=e/2)==2)return c+d;g||(g=e*.3*1.5);if(h<Math.abs(d)){h=d;var f=g/4}else var f=g/(2*Math.PI)*Math.asin(d/h);return b<1?-0.5*h*Math.pow(2,10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)+c:h*Math.pow(2,-10*(b-=1))*Math.sin((b*e-f)*2*Math.PI/g)*.5+d+c},easeInBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*(b/=e)*b*((f+1)*b-f)+c},easeOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeInOutBack:function(a,b,c,d,e,f){return f==undefined&&(f=1.70158),(b/=e/2)<1?d/2*b*b*(((f*=1.525)+1)*b-f)+c:d/2*((b-=2)*b*(((f*=1.525)+1)*b+f)+2)+c},easeInBounce:function(b,c,d,e,f){return e-a.easing.easeOutBounce(b,f-c,0,e,f)+d},easeOutBounce:function(a,b,c,d,e){return(b/=e)<1/2.75?d*7.5625*b*b+c:b<2/2.75?d*(7.5625*(b-=1.5/2.75)*b+.75)+c:b<2.5/2.75?d*(7.5625*(b-=2.25/2.75)*b+.9375)+c:d*(7.5625*(b-=2.625/2.75)*b+.984375)+c},easeInOutBounce:function(b,c,d,e,f){return c<f/2?a.easing.easeInBounce(b,c*2,0,e,f)*.5+d:a.easing.easeOutBounce(b,c*2-f,0,e,f)*.5+e*.5+d}})}(jQuery)},{})}),require.whenReady("settings",function(){require.install("effects.shake",function(require,a,b){(function(a){a.effects.shake=function(b){return this.queue(function(){var c=a(this),d=["position","top"
,"left"],e=a.effects.setMode(c,b.options.mode||"effect"),f=b.options.direction||"left",g=b.options.distance||20,h=b.options.times||3,i=b.duration||b.options.duration||140;a.effects.save(c,d),c.show(),a.effects.createWrapper(c);var j=f=="up"||f=="down"?"top":"left",k=f=="up"||f=="left"?"pos":"neg",l={},m={},n={};l[j]=(k=="pos"?"-=":"+=")+g,m[j]=(k=="pos"?"+=":"-=")+g*2,n[j]=(k=="pos"?"-=":"+=")+g*2,c.animate(l,i,b.options.easing);for(var p=1;p<h;p++)c.animate(m,i,b.options.easing).animate(n,i,b.options.easing);c.animate(m,i,b.options.easing).animate(l,i/2,b.options.easing,function(){a.effects.restore(c,d),a.effects.removeWrapper(c),b.callback&&b.callback.apply(this,arguments)}),c.queue("fx",function(){c.dequeue()}),c.dequeue()})}})(jQuery)},{})}),require.whenReady("settings",function(){require.install("effects.highlight",function(require,a,b){(function(a){a.effects.highlight=function(b){return this.queue(function(){var c=a(this),d=["backgroundImage","backgroundColor","opacity"],e=a.effects.setMode(c,b.options.mode||"show"),f=b.options.color||"#ffff99",g=c.css("backgroundColor");a.effects.save(c,d),c.show(),c.css({backgroundImage:"none",backgroundColor:f});var h={backgroundColor:g};e=="hide"&&(h.opacity=0),c.animate(h,{queue:!1,duration:b.duration,easing:b.options.easing,complete:function(){e=="hide"&&c.hide(),a.effects.restore(c,d),e=="show"&&a.browser.msie&&this.style.removeAttribute("filter"),b.callback&&b.callback.apply(this,arguments),c.dequeue()}})})}})(jQuery)},{})}),require.whenReady("settings",function(){require.install("lang/fun",function(require,exports,module){function wrapDumbFunction(f){return function(){switch(arguments.length){case 0:return f();case 1:return f(arguments[0]);case 2:return f(arguments[0],arguments[1]);case 3:return f(arguments[0],arguments[1],arguments[2]);case 4:return f(arguments[0],arguments[1],arguments[2],arguments[3]);case 5:return f(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])}for(var i=0,args=[];i<arguments.length;i++)args.push("arguments["+i+"]");return eval("(f("+args.join(",")+"))")}}function expect(a,b){function d(a,b){typeof a=="number"&&a>=0&&!(a in c)&&(c[a]=b)}function e(){--a,a===0&&b.apply(this,c)}var c=[];return e.args=function(){var a=this,b=arguments;return function(){d(a.valueOf(),this);for(var c=0,f=b.length;c<f;++c)d(b[c],arguments[c]);e()}},e}var slice=Array.prototype.slice,mustOverrideToString=window.log&&window.log.enabled;exports.bind=function(a,b){var c=slice.call(arguments,2),d=c.length>0?function(){return e.apply(a||this,c.concat(slice.call(arguments,0)))}:function(){return e.apply(a||this,arguments)},e=b;return d.name=b.name,mustOverrideToString&&(d.toString=function(){return"["+b+" bound with "+a+" and with args "+c+" partially applied]"}),typeof b.apply=="undefined"&&(e=wrapDumbFunction(b)),d},exports.expect=expect},{})}),require.whenReady("settings",function(){}),require.whenReady("settings",function(){require.install("jquery.quora",function(require,a,b){(function(a){var b=require("webnode2"),c=require("log").log;require("w2.rpc"),a.serverLog=function(a,d,e,f){try{b.rpc("/ajax/server_log_POST").reportError(!1).kwargs({message:a,level:d,other:e}).error(function(){console.log("Couldn't log error message: '"+a+"' to server.")}).send()}catch(g){}if(f!==!1){var h;switch(d){case"DEBUG":h=c.trace.bind(c);break;case"INFO":h=c.info.bind(c);break;case"WARNING":h=c.warn.bind(c);break;case"ERROR":case"CRITICAL":h=c.error.bind(c);break;default:h=c.log.bind(c)}if(typeof h!="function"){h=c.log.bind(c);if(typeof h!="function")return}try{h("[$.serverLog]",a,e)}catch(g){}}}})(jQuery),function(a,b){a.a1ert=b,a.alert=function(a){var c=new Error;$.serverLog("Raw alert -- could mean a security vulnerability","WARNING",{alertArgValue:a,stack:c.stack},!1),b(a)},a.alert.toString=function(){return""+b}}(this,this.alert)},{webnode2:!0,log:!0,"w2.rpc":!0})}),require.whenReady("settings",function(){require.install("atexit",function(require,a,b){function e(a){var b;while(b=a.pop())try{b()}catch(c){}}function f(){e(c)}var c=[],d=[];a.register=function(a,b){d.length>0?d[b?d.length-1:0].push(a):(c.length||setTimeout(f,10),c.push(a))},a.hook=function(a){return function(){d.push([]);try{return a.apply(this,arguments)}finally{e(d.pop())}}}},{atexit:!0})}),require.whenReady("settings",function(){require.install("tchannel_up",function(require,a,b){function c(a){(new Function(a)).call(window)}var d=!1;a.stop=function(){d=!0},a.start=function(a,b,e,f,g){function s(){return(+(new Date)).toString(16)+Math.random().toString(16).split(".").pop()}function t(a){function h(a,d){return function(f){if(d){window[c]=null;try{delete window[c]}catch(g){}}e!==-1&&(clearTimeout(e),e=-1,a(f),b.parentNode&&b.parentNode.removeChild(b))}}var b=document.createElement("script"),c=a.callback="jsonp"+s(),d=h(w),e=setTimeout(d,7e4),f="onreadystatechange",g=document.body;window[c]=h(v,!0),b.charset="utf-8",b.src=p+$.param(a),b.addEventListener?(b.addEventListener("load",d,!1),b.addEventListener("error",d,!1)):b.attachEvent&&b.attachEvent(f,function(){/loaded|complete/.test(b.readyState)&&d(),b.detachEvent(f,arguments.callee)}),g.insertBefore(b,g.firstChild)}function u(c){clearTimeout(j);var d={min_seq:a,channel:b};l>0&&(d.timeout=l),j=setTimeout(function(){t(d)},c||10)}function v(a){i||(n.reportPageRegainedConnection(),i=!0);try{y(a)}catch(b){n.reportPageNeedsReload("tchannel_error");return}h=500,u()}function w(a){if(k)return;h=Math.min(h*2,3e4),h>=1e4&&i&&(n.reportPageLostConnection(),i=!1),u(h)}function y(b){window.log&&window.log.enabled&&window.log("tchannel_up.newMessages","Response:",b);if(b.error)throw b.error;var c=b.messages;if(!c)return;a=b.min_seq;for(var d=0;d<c.length;++d)x(c[d])}var h=500,i=!0,j,k=!1,l=2e3,m=0,n=require("w2.livenode"),o=require("settings").instart_cchannel_setting,p;if(!g){var q=".tch.";o&&(q=".tch1.");var r="tch"+(Math.floor(Math.random()*1e6)+1)+q+f;p=window.location.protocol+"//"+r+"/up/"+e+"/updates?"}else p=window.location.protocol+"//"+g;var x=function(){function e(){if(d)return;var b=a.next;return b&&(window.log&&window.log.enabled&&window.log("tchannel_up.enqueue","Evaluating:",b.js),c(b.js),delete a.next,delete b.js,a=b),b}function f(){setTimeout(function(){var a=+(new Date);while(e())if(new Date-a>100)return f()},10)}var a={},b=a;return function(c){b=b.next={js:c},a.next===b&&f()}}();$(window).bind("beforeunload",function(){k=!0}),$(window).bind("load",function(){setTimeout(function(){l=0},m),u(20)})}},{"w2.livenode":!0,settings:!0})}),require.whenReady("settings",function(){require.install("jquery.webnode2",function(require,a,b){var c=require("ytplayer"),d=require("browser").browser;(function(a){function f(a){if(!a||!a.parentNode)return!1;var b=a.getAttribute("id"),c;return a.setAttribute("id",e),c=!!document.getElementById(e),b?a.setAttribute("id",b):a.removeAttribute("id"),c}var b=require("lang/fun").bind;a.fn.forgetContents=function(){var a=require("webnode2");return this.find("*").map(function(){var b=a._domidToCid[this.id];if(!b)return;a._ignoreDomids[this.id]=1,a._ignoreCids[b]=1}),this},a.getScrollbarWidth=function(){var a=document.createElement("p");a.style.width="100%",a.style.height="200px";var b=document.createElement("div");b.style.position="absolute",b.style.top="0px",b.style.left="0px",b.style.visibility="hidden",b.style.width="200px",b.style.height="150px",b.style.overflow="hidden",b.appendChild(a),document.body.appendChild(b);var c=a.offsetWidth;b.style.overflow="scroll";var d=a.offsetWidth;return c==d&&(d=b.clientWidth),document.body.removeChild(b),c-d},a.fn.addAnimationClass=function(a,b){function g(){for(var a=0;a<f.length;a++){var b=c.css(f[a]);if(b)return b}}function h(a){if(!a)return!1;var b=a.originalEvent.animationName;return b+e}var c=this;if(d.msie&&d.version<=9)return b(),this;var e="W2_css_animation",f=["-webkit-animation-name","-moz-animation-name","-o-animation-name","-ms-animation-name"];this.addClass(a),this.bind("oanimationend animationend webkitAnimationEnd MSAnimationEnd",function(a){c.trigger(h(a))});var i=g()+e;return this.on(i,function(){c.unbind(i),c.removeClass(a),b()}),this},a.fn.removeEditors=function(){return this.find(".qed_content").remove(),this},a.fn.setContent=function(b){this.removeEditors();var d=c.getYTPlayerStatuses(a(this));return typeof b=="string"?this.html(b):(this.setContentHTML(b),this.setContentJS(b)),c.restoreYTPlayerStatuses(this,d),this},a.fn.setContentHTML=function(a){return this.html(a.html)},a.fn.setContentJS=function(a){window.require.enqueue(new Function("require","var W2 = require('webnode2'),LiveNode = require('w2.livenode');"+a.js))},a.fn.setContentFromAJAXComponent=function(c,d,e,f,g,h,i){var j=require("webnode2");return d=d||{},d.___W2_parentId=e,d.___W2_windowId=j.windowId,d.___parent_domid=j.getLiveParent(e),f=f||'<span class="__wn2_loading"><span class="__wn2_loading_spinner"></span><span class="__wn2_loading_text">Loading...</span></span>',h=h||'<span style="color: red; font-weight: bold;">ERROR</span>',a.securepost(c,d,b(this,function(a){a.___ERROR___&&(this.setContent(h),typeof i=="function"&&i(a,a.___ERROR___)),this.setContent(a),typeof g=="function"&&g(a)}),"json"),this.setContent(f),this};var e=(+(new Date)).toString(16);a.inDom=f;var g=!1;a.fn.anchor=function(b){function i(){var b={},d,e=0,h,i,j=[,-1];while(h=c[e++]){if(!f(h[0]))continue;d=a(h[0]).offset().top-h[1],i=b[d]=(b[d]||0)+1,j[1]<i&&(j=[d,i])}j[1]!=-1&&window.scrollTo(0,Math.round(j[0],0)),g=!1}if(g||this.length<1)return this;g=!0;var c=[],d=a(window).scrollTop();c.length=this.length;for(var e=0,h;h=this[e];++e)c[e]=[h,a(h).offset().top-d];return b?i:(require("atexit").register(i),this)}})(jQuery)},{webnode2:!0,"w2.livenode":!0,"lang/fun":!0,ytplayer:!0,atexit:!0,browser:!0})}),require.whenReady("settings",function(){require.install("polyfills/requestAnimationFrame",function(require,a,b){(function(){var a=0,b=["webkit","moz"];for(var c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})})()},{})}),require.whenReady("settings",function(){require.install("w2.dialog",function(require,a,b){(function(){var a=require("lang/fun").bind,b=require("webnode2"),c=require("Class").Class,d=require("settings").interface_strings;b.Dialog=c.extend({__init__:function(a,c){this.opener&&this.opener(a),b.Dialog._dialogCounter+=1,this._dialogId=b.Dialog._dialogCounter,this._dialogOuter="#__w2_dialog_outer_"+this._dialogId,this._dialogContainerId="#__w2_dialog_container_"+this._dialogId,this._cid="*dialog*_"+this._dialogId,b.Dialog._instance=this,this._title=null,this._buttons=[],this._ok=null,this._cancel=null,this.opts=$.extend({closeOnEscape:!0,closeOnClickOut:!1,sortButtons:!0,focusOK:!1,dialogClass:"",verticalOffset:150,showXButton:!1,hideDialog:!1},c),this._opened=!1,this._containsComponent=!1,this._content=null,this.opts.html&&(this._content=this.opts.html)},opt:function(a,b){return this.opts[a]=b,this},ok:function(a,c){return typeof a=="string"&&(c=a,a=null),this._ok=a,c!==!1&&this.addButton(new b.OKButton(this,c,null)),this},cancel:function(a,c,d){return typeof a=="string"&&(c=a,a=null),this._cancel=a,c!==!1&&(d?this.addButton(new b.CancelActionButton(this,c,null)):this.addButton(new b.CancelButton(this,c,null))),this},button:function(a,c,d){return this.addButton(new b.Button(this,c,a,d))},title:function(a){if(this._opened)throw new Error("Can't set the title for a dialog once it has been opened.");return this._title=a,this},setTitle:function(a){a&&$("#__w2_dialog_title_"+this._dialogId).text(a)},addButton:function(a){if(this._opened)throw new Error("Can't add a button to a dialog once it has been opened");return this._buttons.push(a),this},opener:function(a){return this._opener=a,this},open_:function(){if(this._opened)return this;this._createDOMElements();var c=b._safeGetComponentByCID(this._cid);b._components[this._cid]=c;var d={};d[this._cid]="*ROOT*",b.addParents(d),$(document).bind("keydown.__w2_dialog_"+this._dialogId,a(this,function(a){this.opts.closeOnEscape&&a.keyCode==27&&(this.cancel_(),a.stopPropagation())}));if(this.opts.closeOnClickOut){var e=this._dialogOuter;$(document).on("click",e,a(this,function(a){a.stopPropagation()})),$(document).on("click",":not("+e+","+e+" *)",a(this,function(a){this.cancel_(),a.stopPropagation()}))}return this._opened=!0,typeof this._open=="function"&&this._open.apply(this,arguments),this},cancel_:function(a){var b=!0;typeof this._cancel=="function"&&this._cancel(this._callbackArg(a))===!1&&(b=!1),b&&this.close_()},_callbackArg:function(a){var c={dialog:this,dialogWrapper:b._safeGetComponentByCID(this._cid),button:a};return this._containsComponent&&(c.dialogComponent=b._safeGetComponentByCID(this._cid).lookup("__dialog__")),c},ok_:function(a){var b=!0;return typeof this._ok=="function"&&this._ok(this._callbackArg(a))===!1&&(b=!1),b&&this.close_(),b},close_:function(){if(!this._opened)return this;$(document).unbind(".__w2_dialog_"+this._dialogId),$(this._dialogOuter).forgetContents(),b.unloadComponent(this._cid),$(this._dialogOuter).removeEditors().remove(),this._opened=!1,typeof this._close=="function"&&this._close.apply(this,arguments);var a=this._dialogOuter;return $(document).off("click",a),$(document).off("click",":not("+a+","+a+" *)"),this},open:function(a){return this._open=a,this},close:function(a){return this._close=a,this},html:function(a){return this._content=a,this.open_()},text:function(a){return this.html(a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},_createDOMElements:function(){var b=this.opts.width||470,c="dialog";this.opts.hideDialog&&(c="");var d,e=$("<div />").attr("id","__w2_dialog_outer_"+this._dialogId).addClass(c).addClass("w4").addClass(this.opts.dialogClass);this._title?(d=$("<div />").addClass("dialog_wrapper").append($("<h2 />").attr("id","__w2_dialog_title_"+this._dialogId).addClass("dialog_header").addClass("dialog_frame").text(this._title)),this._content&&d.append($("<div />").addClass("dialog_frame").addClass("dialog_contents").addClass("dialog_body").html(this._content))):d=$("<div />").addClass("dialog_component").addClass("dialog_wrapper").addClass("dialog_body").html(this._content),this.opts.showXButton&&d.append($("<a />").attr("href","#").addClass("remove").click(a(this,this.cancel_)).click(function(){return!1})),this._buttons.length&&d.append($("<div />").addClass("dialog_frame").addClass("dialog_buttons").append(this._buttonsDOM()));var f=$(window).width(),g=$(window).scrollTop(),h=b,i=f-h,j=i/2;g=this.opts.verticalOffset,$(window).height()<600&&(g=$(window).scrollTop(),d.css("position","static")),d.css("width",b-10+"px"),e.append(d).css("top",g+"px").css("left",this.opts.left||j-15+"px").css("width",b+10+"px").appendTo($(document.body));if(this.opts.focusOK)for(var k=this._buttons.length-1;k;k--){var l=this._buttons[k];if(l._type=="submit"){$("#__w2_dialog_button_"+this._dialogId+"_"+k).focus();break}}return},checkDialogPosition:function(){var a=$(this._dialogOuter),b=a.offset().top,c=b+a.outerHeight(!0),d=$(window),e=d.scrollTop()+d.height();if(c>e){var f=this.opts.verticalOffset,g=d.scrollTop()+f+a.outerHeight(!0);g>e&&(f=10),a.css("top",f+"px")}this._checkContentOverflow()},_checkContentOverflow:function(){var a=this,b=$(window),c=b.scrollTop()+b.height(),d=$(a._dialogContainerId),e=d.offset().top,f=d.outerHeight(!0),g=e+f;if(g>c){var h=g-c,i=f-h;d.css({"overflow-y":"scroll",height:i})}},_buttonDOM:function(b,c){b._index=c;var d=$("<a />").addClass("dialog_button").text(b._text).click(a(b,b.click_)).click(function(){return!1}).attr("href","#").attr("id","__w2_dialog_button_"+this._dialogId+"_"+c);switch(b._type){case"submit":d.addClass("submit_button");break;case"link":case"cancel":d.addClass("cancel");break;default:d.addClass("action_button")}return d},_buttonsDOM:function(){var a=$("<div />");this.opts.sortButtons&&this._buttons.sort(function(a,b){return a._priority-b._priority});for(var b=this._buttons.length-1;b>=0;b--){var c=this._buttons[b];a.append(this._buttonDOM(c,b))}return a.addClass("dialog_buttons_contents")},_loadingHTML:function(){return'<div id="__w2_dialog_container_'+this._dialogId+'"></div>'},load:function(c,d){d=$.extend({args:[],kwargs:{},showImmediately:!0,showOnLoad:!0},d),this._content=this._loadingHTML(),this.open_();var e=this._opener.serverCall(c).xargs(d.args).kwargs(d.kwargs).success(a(this,function(a){this._opener.__dialog__=this;var c=b._safeGetComponentByCID(this._cid);c.__opener__=this._opener,c.__dialog__=this,b._knowsAbout[this._cid].__dialog__="__dialog__",b._knowsAbout[this._cid].__dialog_wrapper__=".",b._children[this._cid].__dialog__=b._allChildren[this._cid][0],this._containsComponent=!0,this.checkDialogPosition()})).contentFor($(this._dialogContainerId),{parentCID:this._cid},!0);return this.opts.error&&e.error.apply(this,this.opts.error),this.opts.except&&e.except.apply(this,this.opts.except),e.send(),this}}),b.Dialog.openerFor=function(a){return a.lookup("__dialog_wrapper__").__opener__},b.Dialog.dialogFor=function(a){return a.lookup("__dialog_wrapper__").__dialog__},b.Dialog._dialogCounter||(b.Dialog._dialogCounter=0),b.Dialog._instance||(b.Dialog._instance=null),b.Button=c.extend({__init__:function(a,b,c,d){this._dialog=a,this._text=b,this._callback=c,this._opts=d||{},this._priority=50,this._type="action"},text:function(a){this._text=a},callback:function(a){this._callback=a},click_:function(){var a=!0;typeof this._callback=="function"&&this._callback.call(this._dialog,this._dialog._callbackArg(this))===!1&&(a=!1),a&&this._dialog.close_()}}),b.OKButton=b.Button.extend({__init__:function(b,c,d,e){e=$.extend({style:"ok_button"},e),this._super(b,c||"OK",a(this,function(){var a=!0;return typeof d=="function"&&d.call(this,this._dialog._callbackArg(this))===!1&&(a=!1),a?this._dialog.ok_.call(this._dialog,this):a}),e),this._priority=75,this._type="submit"}}),b.CancelButton=b.Button.extend({__init__:function(b,c,e,f){f=$.extend({style:"cancel_button"},f),this._super(b,c||d.cancel,a(this,function(){var a=!0;typeof e=="function"&&e.call(this,this._dialog._callbackArg(this))===!1&&(a=!1),a&&this._dialog.cancel_.call(this._dialog,this)}),f),this._priority=25,this._type="link"}}),b.CancelActionButton=b.CancelButton.extend({__init__:function(a,b,c,d){this._super(a,b,c,d),this._type="action"}})})()},{webnode2:!0,Class:!0,"lang/fun":!0,settings:!0})}),require.whenReady("settings",function(){require.install("w2.modal",function(require,a,b){(function(){require("jquery.webnode2");var a=require("webnode2"),b=require("Class").Class;a.Modal=b.extend({__init__:function(b,c){this.opts=$.extend({args:[],kwargs:{},closeOnEscape:!0,errorCallback:null,closeOnBackgroundClick:!0},c),this._setOpener&&this._setOpener(b),a.Modal._modalCounter+=1,this._modalId=a.Modal._modalCounter,this.overlay=$("#__w2_modal_overlay_"),this.contentBody=$("#__w2_modal_frame_placeholder_"),this._initCid(),this._tearDownContent()},setLiveSpinnerVisualOptions:function(){a.Loading.setSpinnerColor("#000"),a.Loading.addCSSToWrapper("modal_shown")},revertLiveSpinnerVisualOptions:function(){a.Loading.setDefaultSpinnerColor(),a.Loading.removeCSSFromWrapper("modal_shown")},_initCid:function(){this._cid="*modal*_"+this._modalId},_setOpener:function(a){this._opener=a},close:function(){var a=this;this.overlay.addAnimationClass("closing",function(){a.overlay.hasClass("hidden")||a.overlay.addClass("hidden"),a.revertLiveSpinnerVisualOptions(),a._pageScroll(!0)})},_tearDownContent:function(){if(this._modalId==1)return;this.contentBody.forgetContents();var b="*modal*_"+(this._modalId-1);a.unloadComponent(b),this.contentBody.removeEditors(),this.overlay.off()},_open:function(){this.setLiveSpinnerVisualOptions(),this._pageScroll(!1),this.contentBody.html(""),this.bindKeyboardHotkeys(),this.bindBackgroundClickDismissHandler(),this.overlay.hasClass("hidden")&&this.overlay.removeClass("hidden");var b=a._safeGetComponentByCID(this._cid);a._components[this._cid]=b;var c={};c[this._cid]="*ROOT*",a.addParents(c)},_pageScroll:function(a){var b=$.getScrollbarWidth();a?($("body").removeClass("modal_prevent_scroll"),this._addPaddingForScrollBar(!1,b)):($("body").addClass("modal_prevent_scroll"),this._addPaddingForScrollBar(!0,b))},_addPaddingForScrollBar:function(a,b){if(b===0)return;a?($(".SiteHeader").css("padding-right",b+"px"),$("body").css("padding-right",b+"px")):($(".SiteHeader").css("padding-right","0px"),$("body").css("padding-right","0px"))},_isScrollBarClicked:function(a){var b=$.getScrollbarWidth();return window.innerWidth-a.clientX<b?!0:!1},bindKeyboardHotkeys:function(){var a=this;$(document).bind("keydown.__w2_modal_",function(b){a.opts.closeOnEscape&&b.keyCode==27&&(a.close(),b.stopPropagation())})},bindBackgroundClickDismissHandler:function(){if(!this.opts.closeOnBackgroundClick)return;var a=this;this.overlay.on("mousedown",function(b){b.target==this&&!a._isScrollBarClicked(b)&&a.close()})},load:function(b){this._open();var c=this,d=this._opener.serverCall(b).xargs(c.opts.args).kwargs(c.opts.kwargs).error(function(b){a.unloadComponent(c._cid)}).success(function(b){c._opener.__modal__=c;var d=a._safeGetComponentByCID(c._cid);d.__opener__=c._opener,d.__modal__=c,a._knowsAbout[c._cid].__modal__="__modal__",a._knowsAbout[c._cid].__modal_wrapper__=".",a._children[c._cid].__modal__=a._allChildren[c._cid][0],a.Modal.currentModal=c}).contentFor(this.contentBody,{parentCID:this._cid},!0);return this.opts.errorCallback&&d.error(this.opts.errorCallback),d.send(),this}});var c={_onCloseCallBack:null,_onSubmitCallBack:null,onCloseCallBack:function(a){return this._onCloseCallBack=a,this},executeOnCloseCallBack:function(){this._onCloseCallBack&&this._onCloseCallBack()},onSubmitCallBack:function(a){return this._onSubmitCallBack=a,this},executeOnSubmitCallBack:function(){this._onSubmitCallBack&&this._onSubmitCallBack.apply(null,arguments)}};a.ModalWithCallBacks=a.Modal.extend(c),a.Modal._modalCounter||(a.Modal._modalCounter=0),a.Modal.openerFor=function(a){return a.lookup("__modal_wrapper__").__opener__},a.Modal.modalFor=function(b){var c;try{c=b.lookup("__modal_wrapper__").__modal__}catch(d){c=a.Modal.currentModal}return c}})()},{webnode2:!0,"jquery.webnode2":!0,Class:!0})}),require.whenReady("settings",function(){require.install("w2.interaction",function(require,a,b){var c=require("log").log,d=require("w2.livenode"),e=require("webnode2");a.InteractionModeBanner=e.Component.extend({init:function(){this._super.apply(this,arguments),e.interactionMode=this,this._changedComponents={},this._cidToDomId={},this._otherInteractions={},this._states={OFF:0,PENDING:1,ON:2,BLOCKING:3}},onLoad:function(){c&&c.enabled&&c("w2.interaction.InteractionModeBanner.onLoad","onLoad is called on",this),this.resumeUpdates(),this._state=this._states.OFF,this._lastVal=null,this._lastDOMNode=null,this.bindInteractionMode($(":input,div[contenteditable=true]")),$(document).bind("w2addcomponents",this.fnbind(function(a,b){var d=b.parents;c&&c.enabled&&c("w2.interaction.InteractionModeBanner.onLoad","w2addcomponents is triggered, metadata: ",b),$.each(d,this.fnbind(function(a,b){var c=(new e.VirtualComponent(a)).$("%@interaction");this.bindInteractionMode(c)}))}))},updateStateForLastFocusedDOMElement:function(a){var b;if(!a)return!1;if(this._state==this._states.PENDING)return b=a.getAttribute("w2cid"),this._lastVal==this._val(a)?(this._changedComponents[b]=this._states.OFF,!1):(this._changedComponents[b]=this._states.ON,this._cidToDomId[b]=this._getLiveDOMIdForElement(a),!0);if(this._state==this._states.ON){b=a.getAttribute("w2cid");var c=this._changedComponents[b];return this._lastVal==this._val(a)&&c==this._states.PENDING?(this._changedComponents[b]=this._states.OFF,!1):(this._changedComponents[b]=this._states.ON,this._cidToDomId[b]=this._getLiveDOMIdForElement(a),!0)}return!1},_getLiveDOMIdForElement:function(a){return a.id&&a.id.substr(0,3)=="ld_"?a.id:a.parentNode?this._getLiveDOMIdForElement(a.parentNode):null},isBlocking:function(){return this._state==this._states.BLOCKING},startBlocking:function(){console.log("startBlocking called");var a=[];$.each(this._changedComponents,this.fnbind(function(b,c){if(c==this._states.ON){var d=require("webnode2")._components[b];!!d.meaningfulChangeCallback&&!d.draft_space&&a.push(d)}})),this.showBanner(a),d.addContentPadding(),this._setBlockingState()},_setBlockingState:function(){this._state=this._states.BLOCKING},bindInteractionMode:function(a){a.not(".ignore_interaction").bind("focus.w2interactionmode",this.fnbind(function(a){var b=a.target.getAttribute("w2cid");this._lastVal=this._val(a.target),this._lastDOMNode=a.target;if(d.state.pendingMutationCount===0)if(this._state==this._states.OFF)this._changedComponents[b]=this._states.PENDING,this._state=this._states.PENDING;else{var c=this._changedComponents[b];if(!c||c==this._states.OFF)this._changedComponents[b]=this._states.PENDING}})).bind("blur.w2interactionmode",this.fnbind(function(a){var b=a.target.getAttribute("w2cid");switch(this._state){case this._states.PENDING:this.updateStateForLastFocusedDOMElement(a.target),this._lastVal==this._val(a.target)?this._state=this._states.OFF:this._state=this._states.ON;break;case this._states.ON:this.updateStateForLastFocusedDOMElement(a.target);break;case this._states.OFF:case this._states.BLOCKING:break;default:console.error("Unknown state of InteractionMode at blur time... weird")}}))},_val:function(a){var b=$(a);return b.is(":input")?b.val():b.html()},_setVal:function(a,b){var c=$(a);c.is(":input")?c.val(b):c.html(b)},showBanner:function(a){return $(document).trigger("bannerShown"),a.length>0&&(this.$("#@draftable").removeClass("hidden"),this.$("#@not_draftable").addClass("hidden"),this.$("#@resume").click(this.fnbind(function(b){return $.each(a,this.fnbind(function(a,b){b.meaningfulChangeCallback()})),require("window_manager").reload(),!1}))),this.$("#@banner").show().removeClass("fade_out").addClass("fade_in")},hideBanner:function(){$(document).trigger("bannerHidden");var a=this;a.$("#@banner").removeClass("fade_in").addClass("fade_out"),setTimeout(function(){a.$("#@banner").hide()},150);return},resumeUpdates:function(){this._state=this._states.OFF,this._changedComponents={},this.hideBanner(),d.removeContentPadding();var a=d.state.interactionDelayedLivedepOperations;while(a.length>0&&this._state==this._states.OFF){var b=a.shift();d.onLivedepOperations(b.data,b.textStatus,!0)}}})},{webnode2:!0,"w2.livenode":!0,log:!0,window_manager:!0})}),require.whenReady("settings",function(){require.install("frame_busting",function(require,a,b){a.check=function(){if(require("settings").enableFrameBusting){var a=!1;try{a=!/\.quora\.com$/i.test(window.top.location.host)}catch(b){a=!0}if(a&&""+window.top.location!=""+window.location){window.top.location=window.location;var c=require("log");c&&c.enabled&&c("frame_busting","Updating window.location.")}}}},{log:!0,settings:!0})}),require.whenReady("settings",function(){require.install("siteuri",function(require,a,b){function c(a){this.message=this.errorType+": "+a}function g(a){return a.substring(0,5)=="http:"?"https:"+a.substring(5):a}function h(a){var b=a.match(f);if(!b)return!1;var c=b[1],e=b[2],g=d();if("www."+e!=g){var h=require("settings"),i=h.subdomain_name,j=h.subdomain_suffix,k="http://www."+j+"/";if(c!="www"&&c&&"www."+c+"."+e==g){var l=a.replace("://","://www.").match(f);if(l)return l}return!1}return b}c.prototype=new Error,c.prototype.errorType="SiteURIError",c.prototype.constructor="SiteURIError";var d=function(a,b){var c=require("settings"),d;return b?d="quora.com":d=c.subdomain_suffix||"quora.com",a?a+"."+d:"www."+d};a.netlocForSubdomainName=d;var e=function(a,b){return"http://"+d(a,b)+"/"};a.baseUrlForSubdomainName=e;var f=/https?:\/\/(?:([^.\/]+)\.)?((?:[^.\/]+\.)*quora\.com)(\/.*)?/,i=function(a){return h(a)!==!1};a.isSiteAbsoluteUrl=i;var j=function(a){return i(a)||a[0]=="/"};a.isSiteUrl=j;var k=function(a,b){return new l(a,b)};a.URI=k;var l=require("Class").Class.extend({__init__:function(a,b){a instanceof l&&(a=a.unicode());var d=h(a),e=b&&b.subdomainName||null,f=b&&b.secure||!1,g;if(d){if(e)throw c("subdomain context should not be set for absolute url, url = "+a+", subdomain = "+e);e=d[1],e=="www"&&(e=null),g=d[3]||"",g===""&&(g="/"),a.substring(0,5)=="https"&&(f=!0)}else g=a;if(g[0]!="/")throw c("invalid site uri input "+a);return this.relativeUrl=g,this.subdomainName=e,this.isSecure=f,this},unicode:function(a){if(require("settings").force_use_absolute_links)return this.absolute(a);var b=this.relativeUrl;if(this.subdomainName||require("settings").subdomain_name){var c=this.subdomainName||require("settings").default_uri_subdomain_name;b=e(c,a)+b.substring(1),b.charAt(b.length-1)=="/"&&(b=b.substring(0,b.length-1))}return this.isSecure&&(b=g(b)),b},absolute:function(a){var b=e(this.subdomainName,a),c=b+this.relativeUrl.substring(1);return this.isSecure&&(c=g(c)),c},secure:function(a){return g(this.absolute(a))}});a.SiteURI=l},{Class:!0,settings:!0})}),require.whenReady("settings",function(){require.install("dialog",function(require,a,b){function e(a){return/[^\u0000-\u00ff]/.test(a)}var c=require("w2.quora").Component,d=require("w2.keycombo");a.Dialog=c.extend({onLoad:function(){this.successCallback=null,this.ok2Submit=!0,this.submitted=!1,this.$("#@submit").click(this.fnbind(this.submit)),this.$("#@cancel").click(this.fnbind(function(){return this.close(),!1}))},submit:function(){return this.request(),!1},request:function(){var a=this.getPars();if(this.submitted||!a||!this.ok2Submit)return!1;this.submitted=!0,this.submitServerCall(a)},getPars:function(){return{}},setSetup:function(a){a.each(this.fnbind(function(a,b){this.options[a]=b}))},setSuccessCallback:function(a){this.successCallback=a},setFocusCallback:function(a){this.lookup("editor").setFocusCallback(a)},setBlurCallback:function(a){this.lookup("editor").setBlurCallback(a)},close:function(){$("#generic_dialog").length?$("#generic_dialog").remove():require("webnode2").Dialog.dialogFor(this).close_()},submitServerCall:function(a){this.serverCall("dialog_submit_controller").liveMutate().kwargs(a).success(this.fnbind(function(a){this.successCallback&&this.successCallback(a),this.close()})).send()}}),a.AddCommentDialog=a.Dialog.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("editor").focus()},getPars:function(){return this.comment_required&&this.lookup("editor").isEmpty()?!1:{comment:this.lookup("editor").serialize()}}}),a.BanUserDialog=a.AddCommentDialog.extend({getPars:function(){var a=this._super.apply(this,arguments);return a&&(a.removeMessages=this.$("#@checkbox").attr("checked")=="checked"),a}}),a.DialogLink=c.extend({onLoad:function(){this.tooltip&&this.$("#@link").tooltip({contents:this.tooltip}),this.$("#@link").click(this.fnbind(function(){return this.click(),!1}))},addOption:function(a,b){b&&e(JSON.stringify(b))&&(b=window.unescape(encodeURIComponent(b))),this.options[a]=b},click:function(){var a=encodeURIComponent(JSON.stringify(this.options));$(".content").dialog({title:null,url:"/dialog/ajax_get_dialog_GET?type="+this.type+"&object_id="+this.object_id+"&options="+a,buttons_hide_on_close:this.buttons_hide_on_close,buttons:null})},triggerClick:function(a){$.each(a,this.fnbind(function(a,b){this.addOption(a,b)})),this.click()}}),a.AdminMessageDialog=a.Dialog.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("editor").focus()},getPars:function(){if(this.lookup("editor").isEmpty())return!1;var a=this.lookup("editor").serialize();return{msg:a}}}),a.KeyboardShortcutsDialog=c.extend({onLoad:function(){this.onKeyCombination(document.body,"Shift-/",this.fnbind(this.toggle))},toggle:function(){this._dialog&&this._dialog._opened?this.hideDialog():this.showDialog()},hideDialog:function(){this._dialog.close_()},showDialog:function(){this._dialog=this.dialog({buttons:{},closeOnClickOut:!0,dialogClass:"keyboard_shortcuts_dialog",width:"660",showXButton:!0}).title(this.dialog_title).html(this.renderContents()).close(this.fnbind(function(){this._dialog=null}))},renderContents:function(){var a=function(a){return a.toLowerCase()=="meta"&&(a=d.hasCmdKey?"â":"Ctrl"),'<div class="key">'+a+"</div>"},b=function(b,c){var d='<div class="row">',e=b.split("-");d+='<div class="col shortcut">';for(var f=0;f<e.length;++f)d+=a(e[f]);return d+="</div>",d+='<div class="col shortcut_description">'+c+"</div>",d+="</div>"
,d},c=function(a,c){var d='<div class="category">';d+='<div class="category_name">'+a+"</div>";for(var e in c)d+=b(e,c[e]);return d+="</div>",d},e="";for(var f in this.descriptions)e+=c(f,this.descriptions[f]);return e}}),a.EnableFAQFlagOverflowDialog=a.AddCommentDialog.extend({submitServerCall:function(a){this.serverCall("dialog_submit_controller").kwargs(a).success(this.fnbind(function(a){window.location.href=a,this.close()})).send()}})},{webnode2:!0,"w2.keycombo":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("sticky",function(require,a,b){var c="sticky",d=[],e=!1;a.add=function(a){if(!a.elem||!a.container)return;var b=$(a.elem),f=$(a.container),h=$.extend({top:0,bottom:0},a.offsets),i=b.css("position");b.addClass(c);var j=b.outerHeight(!0);b.removeClass(c);var k=$("<div>").css({height:0,margin:0,padding:0,clear:"both",display:"block"});b.before(k),d.push({elem:b,sentinelElem:k,container:f,origPadding:parseInt(f.css("padding-bottom")),origPos:i,curPos:i,offsets:h,height:j}),e||(e=!0,g())},a.remove=function(a){for(var b=0;b<d.length;++b){var c=d[b];if(c.elem[0]===$(a)[0]){d.splice(b,1),f(c,c.origPos);break}}};var f=function(a,b){b!=a.curPos&&(a.curPos=b,a.elem.css("position",b),b=="fixed"?(a.sentinelElem.css("height",a.elem.outerHeight(!0)),a.elem.addClass(c)):(a.sentinelElem.css("height",0),a.elem.removeClass(c)))},g=function(){var a=$(window),b=a.scrollTop()+a.height();for(var c=0;c<d.length;++c){var e=d[c];if(!e.elem.is(":visible"))continue;var h=e.container.offset().top+e.height+e.offsets.top,i=e.sentinelElem.offset().top+e.height-e.offsets.bottom;b>=h&&b<=i?f(e,"fixed"):f(e,e.origPos)}window.requestAnimationFrame(g)}},{sticky:!0})}),require.whenReady("settings",function(){require.install("view/embed",function(require,a,b){var c=require("w2.quora").Component;a.ExternalEmbed=c.extend({onLoad:function(a){this.$("#@embed_logo").mouseover(this.fnbind(function(){this.$("#@embed_logo").css({"background-position":"0 -20px"}).animate({right:"0px"},80)})),this.$("#@external_embed_wrapper").on("mousedown",'a[href!="#"]',function(a){var b=$(a.currentTarget);b.attr("target","_blank")})}}),a.QuoteEmbed=a.ExternalEmbed.extend({onLoad:function(a){this._super.apply(this,arguments);var b=this.lookup("quote_dialog_content");b&&b.getSize()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("mathify",function(require,a,b){a.iterMaths=function(a,b){return e(a,function(a,c){return c&&b(c,a),""})};var c=function(a,b){return a?"<b>"+a+"</b>":b},d=a.getParts=function(a){var b="\\s\\S",c=new RegExp("\\[math\\](["+b+"]+?)\\[\\/math\\]","g"),d,e,f,g=[],h=0,i,j;while(d=c.exec(a))e=d[0],f=d[1],i=c.lastIndex,j=i-e.length,h!=j&&g.push([a.slice(h,j)]),h=i,g.push([e,f]);return h!=a.length&&g.push([a.substr(h)]),g},e=a.mathify=function(a,b){b=b||c;var e=d(a),f="";for(var g=0;g<e.length;g++)f+=b.apply(window,e[g]);return f||a};a.renderMath=function(a){typeof MathJax!="undefined"&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,a])}},{})}),require.whenReady("settings",function(){require.install("input_validate",function(require,a,b){var c=require("w2.quora").Component;a.InputValidator=c.extend({init:function(){this._super.apply(this,arguments),this.isValid=null},onLoad:function(){var a=this.input(),b;a.bind("change blur",this.fnbind(function(){var c=a.val();c!==b&&(b=c,this.validate())})),this._managerComponent().__validators=this._managerComponent().__validators||[],this._managerComponent().__validators.push(this)},input:function(){return this.parent().$("#"+this.id)},_managerComponent:function(){return this.parent()},validate:function(a){a=a||{};var b=this.input().val();if(!b)this.showErrorOnComponent(".@incomplete"),this.hideAllErrors(),this.isValid=null;else{this.hideAllErrors();var c=setTimeout(this.fnbind(function(){this.$(".@asking_server").show()}),150);this.serverCall("validate").kwargs({value:this.input().val()}).success(this.fnbind(function(b){clearTimeout(c),this.hideAllErrors(),b.valid?(this.isValid=!0,b.message&&(this.setWidth(this.$("#@valid_message")),this.$("#@valid_message").text(b.message)),this.$(".@valid").text()&&this.showErrorOnComponent(".@valid"),this.hideAllErrors(),this.input().removeClass("error"),typeof a.valid=="function"&&a.valid(b.message)):(this.isValid=!1,b.message&&(this.setWidth(this.$("#@invalid_message")),this.$("#@invalid_message").text(b.message),this.invalidMessage=b.message),this.hideAllErrors(),this.showErrorOnComponent(".@invalid"),typeof a.invalid=="function"&&a.invalid(b.message))})).send()}},populate_if_valid:function(a,b){this.serverCall("validate").kwargs({value:a}).success(this.fnbind(function(c){c.valid&&(this.isValid=!0,b.val(a))})).send()},setWidth:function(a){var b=parseInt(this.input().width())-4;b>0&&a.css("width",b+"px")},hideAllErrors:function(){this.$(".@invalid").hide(),this.$(".@valid").hide(),this.$(".@incomplete").hide(),this.$(".@asking_server").hide(),this.input().removeClass("input_validation_error"),this.$("textarea").removeClass("input_validation_error")},showErrorOnComponent:function(a){this.$(a).show(),this.input().addClass("input_validation_error"),this.$("textarea").addClass("input_validation_error")}}),a.InputValidator.validate=function(a,b){b=b||{},a.__validators&&a.__validators.length?a.__validators[0].validate(b):typeof b.valid=="function"&&b.valid()}},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/placepicker",function(require,a,b){function h(a){e?a():f.push(a)}var c=require("w2.quora").Component,d=require("window_manager"),e=!1,f=[],g=require("settings").interface_strings;a.mapsLoaded=function(){e=!0;for(var a=0;a<f.length;++a)f[a].call()},a.PlacePicker=c.extend({onLoad:function(){h(this.fnbind(this.onLoadBase))},onLoadBase:function(){this.address=this.default_location,this.initializeGoogleMaps(),this.mutable===!0&&(this.$("#@edit_map").click(this.fnbind(function(){return this.toggleEditor(),!1})),this.$("#@change_location").click(this.fnbind(function(){if(this.place||this.marker){this.$("#@search_text_field").blur();var a,b;this.map.getBounds().contains(this.marker.getPosition())?(a=this.marker.getPosition().lat(),b=this.marker.getPosition().lng()):(a=this.map.getCenter().lat(),b=this.map.getCenter().lng());if(!this.place){var c=new google.maps.LatLng(a,b),d=new google.maps.Geocoder;d.geocode({location:c},this.fnbind(function(a,b){if(b==google.maps.GeocoderStatus.OK&&a.length){var c=a[0];this.radius=this.computeRadius(c.geometry.viewport),this.setAddress(c.address_components)}}))}var e=$.trim(this.$("#@search_text_field").val());this.serverCall("place_changed").kwargs({radius:this.radius,reference:this.place&&this.place.reference||this.reference,lat:a,lng:b,viewport:{zoom:this.map.getZoom(),mapTypeId:this.map.getMapTypeId(),icon:this.place&&this.place.icon,tilt:this.map.getTilt(),heading:this.map.getHeading()},address:e.length?e:this.address}).success(this.fnbind(function(){this.default_location.hasLocation=!0})).send()}else this.$("#@search_text_field").focus()})),this.$("#@edit").click(this.fnbind(function(){return this.toggleEditor(),!1})),this.$("#@add").click(this.fnbind(function(){return this.reinitializeMap(),!1})),this.$("#@clear").click(this.fnbind(function(){return this.dialog().title(this.dialog_title).cancel(null,g.cancel).ok(this.fnbind(function(){this.serverCall("place_cleared").success(this.fnbind(function(){this.toggleEditor()})).send()}),this.dialog_title).html(this.dialog_message),!1})),this.$("#@close").click(this.fnbind(function(){return this.toggleEditor(),this.initializeGoogleMaps(),this.default_location.hasLocation===!1&&this.$("#@map_wrapper").hide(),!1})),d.getHash().substr(0,13)=="#editlocation"&&this.reinitializeMap())},initializeGoogleMaps:function(){h(this.fnbind(this.initializeGoogleMapsBase))},initializeGoogleMapsBase:function(){this.mapOptions={center:window.google&&google.maps&&new google.maps.LatLng(this.default_location.latitude,this.default_location.longitude),zoom:this.viewport&&this.viewport.zoom||7,mapTypeId:this.viewport&&this.viewport.mapTypeId||window.google&&google.maps&&google.maps.MapTypeId.ROADMAP||"roadmap",tilt:this.viewport&&this.viewport.tilt!==undefined&&this.viewport.zoom>=18?this.viewport.tilt:45,heading:this.viewport&&this.viewport.heading,streetViewControl:!this.mutable};var a=this.viewport&&this.viewport.icon;if(this.static_map===!0){var b="//maps.googleapis.com/maps/api/staticmap?center="+encodeURIComponent(this.default_location.latitude+","+this.default_location.longitude)+"&zoom="+encodeURIComponent(this.mapOptions.zoom)+"&size="+encodeURIComponent(this.size.width+"x"+this.size.height)+"&maptype="+encodeURIComponent(this.mapOptions.mapTypeId)+"&markers="+encodeURIComponent("icon:"+a+"shadow:false|"+this.default_location.latitude+","+this.default_location.longitude)+"&sensor=false",c=$('<img src="'+b+'" />');this.$("#@map_canvas").replaceWith(c);return}this.map=new google.maps.Map(this.$("#@map_canvas").get(0),this.mapOptions),(this.simple_view===!0||this.mutable===!0)&&this.toggleControls(!1),this.default_location.hasLocation!==!1&&this.updateMarker(a,this.mapOptions.center,this.default_text),this.mutable===!0&&this.toggleDraggable(!1);if(this.mutable===!0){var d=this.$("#@search_text_field").get(0),e=new google.maps.places.Autocomplete(d);e.bindTo("bounds",this.map),google.maps.event.addListener(e,"place_changed",this.fnbind(function(){this.infowindow&&this.infowindow.close(),this.place=e.getPlace(),this.place.geometry.viewport?(this.map.fitBounds(this.place.geometry.viewport),this.radius=this.computeRadius(this.place.geometry.viewport)):(this.map.setCenter(this.place.geometry.location),this.map.setZoom(17),this.radius=30),this.setAddress(this.place.address_components),this.updateMarker(this.place.icon,this.place.geometry.location)})),google.maps.event.addListener(this.map,"click",this.fnbind(function(a){if(!this.getControlState())return;var b=a.latLng;this.radius=this.computeRadius(this.map.getBounds()),this.handleMarkerReposition(b),this.updateMarker(null,b)}))}},setAddress:function(a){this.address="";if(a){this.address=[a[0]&&a[0].short_name||"",a[1]&&a[1].short_name||"",a[2]&&a[2].short_name||""],this.address[1]==this.address[2]&&this.address.splice(2,1),this.address[0]==this.address[1]&&this.address.splice(1,1);var b="";$.each(this.address,this.fnbind(function(a,c){b+=c,/^[0-9]+$/.test(c)?b+=" ":a!=this.address.length-1&&(b+=", ")})),this.address=b}},reinitializeMap:function(){this.$("#@map_wrapper").show(0,this.fnbind(function(){this.initializeGoogleMaps(),this.toggleEditor(),this.$("#@search_text_field").focus()}))},toggleEditor:function(){this.$("#@view").toggle(),this.$("#@editor").toggle(),this.$("#@edit_map").toggle(),this.toggleDraggable(),this.toggleControls()},getControlState:function(){return!!this.mapOptions.mapTypeControl},toggleControls:function(a){h(this.fnbind(this.toggleControlsBase,a))},toggleControlsBase:function(a){var b=a!==undefined?a:!this.getControlState();this.mapOptions.mapTypeControl=b,this.mapOptions.panControl=b,this.mapOptions.zoomControl=b,this.mapOptions.scaleControl=b,this.mapOptions.rotateControl=b,this.mapOptions.overviewMapControl=b,this.map.setOptions(this.mapOptions)},toggleDraggable:function(a){h(this.fnbind(this.toggleDraggableBase,a))},toggleDraggableBase:function(a){this.mapOptions.draggable=a!==undefined?a:!this.mapOptions.draggable,this.mapOptions.draggable?(this.mapOptions.minZoom=undefined,this.mapOptions.maxZoom=undefined,this.marker&&this.marker.setDraggable(!0)):(this.mapOptions.minZoom=this.map.getZoom(),this.mapOptions.maxZoom=this.map.getZoom(),this.marker&&this.marker.setDraggable(!1)),this.map.setOptions(this.mapOptions)},updateMarker:function(a,b){h(this.fnbind(this.updateMarkerBase,a,b))},updateMarkerBase:function(a,b){this.marker&&this.marker.setMap(null);var c=new google.maps.MarkerImage(a||"//maps.gstatic.com/mapfiles/place_api/icons/geocode-71.png",new google.maps.Size(40,40),new google.maps.Point(0,0),new google.maps.Point(20,40),new google.maps.Size(40,40));this.marker=new google.maps.Marker({clickable:!0,draggable:this.mapOptions&&this.mapOptions.draggable,icon:c,map:this.map,position:b}),google.maps.event.addListener(this.marker,"dragend",this.fnbind(function(a){var b=a.latLng;this.handleMarkerReposition(b)})),this.updateInfoWindow(b)},handleMarkerReposition:function(a){h(this.fnbind(this.handleMarkerRepositionBase,a))},handleMarkerRepositionBase:function(a){this.place=null,window.setTimeout(this.fnbind(function(){this.map.panTo(a)}),1e4);var b=new google.maps.Geocoder;b.geocode({location:a},this.fnbind(function(b,c){if(c==google.maps.GeocoderStatus.OK&&b.length){var d=b[0];this.radius=this.computeRadius(d.geometry.viewport),this.setAddress(d.address_components),this.updateInfoWindow(a)}}))},updateInfoWindow:function(a){h(this.fnbind(this.updateInfoWindowBase,a))},updateInfoWindowBase:function(a){this.infowindow&&this.infowindow.close(),this.address&&this.address.length&&(this.infowindow=new google.maps.InfoWindow({content:this.address,position:a}),google.maps.event.addListener(this.marker,"click",this.fnbind(function(){this.infowindow.open(this.map,this.marker)})))},computeRadius:function(a){var b=a.getNorthEast(),c=a.getSouthWest(),d=b.lat(),e=c.lat(),f=b.lng(),g=c.lng();return Math.floor(Math.abs(d-e)*111045/2)}})},{settings:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("simscroll",function(require,a,b){function f(a,b,c,d,e){return[a,!!b,!!c,!!d,!!e].join(" ")}function m(a){var b=a.keyCode||a.charCode,m=Math.round(.9*e.clientHeight);switch(f(b,a.shiftKey,a.ctrlKey,a.altKey,a.metaKey)){case g:window.scrollBy(0,-d);break;case h:window.scrollBy(0,d);break;case i:case j:window.scrollBy(0,-m);break;case k:case l:window.scrollBy(0,m);break;default:return!1}return c=!0,!0}var c,d=50,e=document.documentElement,g=f(38),h=f(40),i=f(33),j=f(32,!0),k=f(32),l=f(34);document.addEventListener&&document.addEventListener("keypress",function(a){var b=a.originalTarget;!c&&(b===e||b===document.body)&&m(a)&&(a.preventDefault(),a.stopPropagation()),c=!1},!1),a.maybeSimulateScroll=m,a.cancelSimulatedScroll=function(){c=!0}},{})}),require.whenReady("settings",function(){require.install("app/view/mathjax",function(require,a,b){var c=require("w2.quora").Component,d=require("mathjax");a.MathJaxLoader=c.extend({onLoad:function(){if(typeof MathJax=="undefined"){var a=!1;d.onInit(a)}}})},{mathjax:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/common",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor"),e=d.InlineEditor,f=require("input_validate").InputValidator,g=d.registerEditorCallback,h=d.unregisterEditorCallback,i=d.triggerEditorCallback,j=require("unified_view/qtext").ExpandableContext;a.SuggestedEditSaveButton=c.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(a){return this.serverCall("publish_edit").liveMutate().send(),!1}))}}),a.Content=c.extend({onLoad:function(){this.expandableContext=this.getContext(j),this.$content=this.$("#@content"),this.$editor=this.$("#@editor"),this.suggestion_exists?this.bindContentCallbacks():this.bindEditorCallbacks(),this.editorFetched=this.editor_loaded,this.editorLoaded=this.editor_loaded},toggle:function(a){this.expandableContext&&this.expandableContext.set("forceSwitch",!0),a||this.$content.hasClass("hidden")?this.showContent():this.showEditor()},showContent:function(){this.$content.removeClass("hidden"),this.$editor.addClass("hidden")},showEditor:function(){if(!this.editorLoaded){this.$("#@loading").removeClass("hidden"),this.fetchEditor();return}this.$content.addClass("hidden"),this.$editor.removeClass("hidden")},fetchEditor:function(){if(this.editorFetched)return;this.editorFetched=!0,this.serverCall("editor_component").contentFor(this.$editor.get(0),{parentCID:this.cid}).success(this.fnbind(function(){this.$("#@loading").addClass("hidden"),this.editorLoaded=!0,i("edit",this.content_type,this.oid),this.showEditor()})).send()},bindEditorCallbacks:function(){g("edit",this.content_type,this.oid,this.cid,this.toggle.bind(this)),g("submitted",this.content_type,this.oid,this.cid,this.toggle.bind(this,!0)),g("cancel",this.content_type,this.oid,this.cid,this.toggle.bind(this,!0))},unbindEditorCallbacks:function(){h("edit",this.content_type,this.oid,this.cid),h("cancel",this.content_type,this.oid,this.cid),h("submitted",this.content_type,this.oid,this.cid)},bindContentCallbacks:function(){l(this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindContentCallbacks:function(){m(this.content_type,this.oid,this.cid)},onUnload:function(){this.suggestion_exists?this.unbindContentCallbacks():this.unbindEditorCallbacks()}});var k=function(a,b,c){var d="content_toggle_"+a+"_"+b;return c&&(d+="."+c),d},l=function(a,b,c,d){var e=k(a,b,c);$(document).on(e,function(){return d()})};a.registerContentToggleCallback=l;var m=function(a,b,c){var d=k(a,b,c);$(document).off(d)};a.unregisterContentToggleCallback=m;var n=function(a,b){$(document).trigger(k(a,b))};a.triggerContentToggleCallback=n,a.SuggestedEditsEditor=e.extend({onLoad:function(){this._super.apply(this,arguments),this.disclaimer_update="",this.answer_attribution_update="",this.answer_resistance=!1,this.setToggleCallback(this.fnbind(function(){this.parent()&&(this.parent().toggleButtons&&this.parent().toggleButtons(),this.parent().$("#@disclaimer, #@nfr, #@answer_attribution").toggle()),this.editorShown&&this.editor.fixEditorButtons()}));var a=this;a.lookup("editor").whenOnLoaded(function(){a.original_input=a.get_value(),a.originalReviewData=a.getReviewData()})},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(a){var b={};this.lookup("editor_share",!0)&&(b=this.lookup("editor_share").getValues()),f.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}),a.preventDefault()}))},reviewDataUnchanged:function(){var a=this.getReviewData(),b=this.originalReviewData;return a===b||a!==null&&b!==null&&a.base===b.base},okToSubmitRequest:function(){return!this.editor.hasChanged(this.original_input)&&this.disclaimer_update===""&&this.answer_attribution_update===""&&this.reviewDataUnchanged()?!1:this._super.apply(this,arguments)},_get_kwargs:function(){var a="";this.has_comment&&!this.lookup("comment_editor").isEmpty()&&(a=this.lookup("comment_editor").serialize());var b={};return this.lookup("editor_share",!0)&&(b=this.lookup("editor_share").getValues()),{object_id:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,notif:this.$("#@notif").attr("checked")?1:0,comment:a,disclaimer_update:this.disclaimer_update,answer_attribution_update:this.answer_attribution_update,review_data:this.getReviewData(),should_collapse:this.shouldCollapse(),share_values:b,answer_resistance:this.answer_resistance}},ajax_callback:function(a){if(a&&a.answer_resistance){this.showAnswerResistance(),this.locked=!1;return}return a&&a.show_collapse_modal&&this.showAnswerCollapseModal(a.aid),this._super.apply(this,arguments)},shouldCollapse:function(){return this.$("#@collapse").length>0?this.$("#@collapse").is(":checked"):!1},showAnswerResistance:function(){this.answer_resistance=!0,this.lookup("answer_resistance").show(),this.input_button_obj.removeClass("disabled").text(this.resistance_text),this.focusInput()},showAnswerCollapseModal:function(a){this.modal("show_collapse_modal",{kwargs:{aid:a,is_answer_page:this.is_answer_page}})}}),a.FeedStoryItem=c.extend({onLoad:function(){var a=this;this.$("#@item").hover(function(b){a.$("#@item").addClass("hover")},function(b){a.$("#@item").removeClass("hover")})},getHash:function(){return this.hash}})},{"unified_view/qtext":!0,"view/inline_editor":!0,input_validate:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/share/connect",function(require,a,b){var c=require("w2.quora").Component,d=require("siteuri").URI,e=a.socialConnectorBase={connectLinkedin:function(a){var b=this;$(document).one("linkedin_oauth_approved."+b.cid,function(c,d){b.serverCall("connect_linkedin").kwargs({li_uid:d}).success(function(){b.trigger("linkedin_connected")}).liveMutate().send(),a&&a()});var c=d("/linkedin_/oauth_window"),e=window.open(c.unicode(),"_BLANK","height=365,width=600")},connectTwitter:function(a){var b=this;$(document).one("twitter_oauth_approved."+b.cid,function(c,d){var e=d.accessToken,f=d.userData;b.serverCall("connect_twitter").kwargs({access_token_key:e.key,screen_name:f.twitter_screen_name,tw_uid:f.twitter_uid,"protected":f["protected"]}).liveMutate().send(),a&&a()});var c=d("/twitter/oauth_window"),e=window.open(c.unicode(),"_BLANK","height=558,width=800")},connectTumblr:function(a){var b=this;$(document).one("tumblr_oauth_approved."+b.cid,function(c,d){b.serverCall("connect_tumblr").kwargs({url:d}).liveMutate().success(function(c){c!="OK"?alert(b.tumlbr_failure_message):a&&a()}).send()}),window.open("/tumblr_/oauth_window","_BLANK","height=500,width=600")}};a.SocialConnector=c.extend(e)},{siteuri:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/settings",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor,e=require("app/view/share/connect").SocialConnector,f=require("window_manager"),g=require("webnode2"),h=require("view/modal").Base,i=require("settings").interface_strings;a.CallbackModal=h.extend({onSubmit:function(){this._super.apply(this,arguments),g.Modal.modalFor(this).executeOnSubmitCallBack()}}),a.SettingsAccountEmailOption=c.extend({onLoad:function(){this.$("#@add_another_email_link").click(this.fnbind(function(a){return this.$("#@add_another_email_row").toggleClass("hidden"),this.$("#@add_email_input_row").toggleClass("hidden"),this.$("#@new_email").focus(),!1})),this.$("#@add_another_email").click(this.fnbind(function(){var a=this.$("#@new_email").val();return a?(this.serverCall("add_email").kwargs({email:a}).liveMutate().send(),!1):!1}))}}),a.SettingsAccountPhoneOption=c.extend({onLoad:function(){this.$("#@add_another_phone_number_link").click(this.fnbind(function(a){this.$("#@add_another_phone_number_row").toggleClass("hidden"),this.$("#@add_number_input_row").toggleClass("hidden"),this.$("#@new_number").focus()})),this.$("#@add_another_phone_number").click(this.fnbind(function(){var a=this.$("#@new_number").val();return a?(this.serverCall("add_number").kwargs({number:a}).liveMutate().success(this.fnbind(function(b){b!==null&&this.modal("load_inner_confirm_phone_number",{kwargs:{number:a,code:b}})})).send(),!1):!1}))},showConfirmationDialog:function(a,b){return this.dialog().title(this.confirm_dialog_title).ok(null).html(this.confirm_dialog_text.replace("{phone_number}",a)+' <p class="confirmation_code">'+b+"</p>"),!1}});var j=a.SettingsOption=c.extend({onLoad:function(a){var b=this;this.$("#@view_option_link").click(function(){return b.serverCall("check_reauth").success(function(){b.expandOption()}).send(),!1}),this.auto_open_url_hash&&a&&f.getHash().substr(0,30)=="#"+this.auto_open_url_hash&&(this.expandOption(),this.$("#@option_content").css("background-color","#E0E0E0").effect("highlight",{},1500))},expandOption:function(){this.$("#@view_option").toggleClass("hidden"),this.$("#@option_content").toggleClass("hidden")}});a.AdultSettingsOptionToggle=c.extend({onLoad:function(){this.$("#@no_adult_content").click(this.fnbind(function(){return this.serverCall("no_adult_content").liveMutate().send(),!1})),this.$("#@allow_adult_content").click(this.fnbind(function(){return this.serverCall("allow_adult_content").liveMutate().send(),!1}))}}),a.FeatureSettingsOptionToggle=c.extend({onLoad:function(){this.$("#@disable").click(this.fnbind(function(){return this.serverCall("disable").liveMutate().send(),!1})),this.$("#@enable").click(this.fnbind(function(){return this.serverCall("enable").liveMutate().send(),!1}))}}),a.UserDisclaimerDialogEditor=d.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@inline_editor_cancel").click(this.fnbind(function(){return g.Dialog.dialogFor(this).close_(),!1})),this.$("#@inline_editor_submit").click(this.fnbind(function(){var a=g.Dialog.openerFor(this);return a.attachDisclaimer==="function"&&(g.Dialog.openerFor(this).user_has_set_disclaimer=!0,g.Dialog.openerFor(this).attachDisclaimer()),g.Dialog.dialogFor(this).close_(),!1}))}}),a.ChangePasswordOption=j.extend({onLoad:function(){this._super.apply(this,arguments),this.clear_passwords=function(){this.$("#@new_password").val(""),this.$("#@confirm_password").val("")};var a=this;this.$("#@change_password_submit").click(function(){return a.$("#@new_password").val()!==a.$("#@confirm_password").val()?(a.$("#@password_and_confirmation_mismatch").removeClass("hidden"),a.$("#@password_changed").addClass("hidden"),!1):(a.$("#@password_and_confirmation_mismatch").addClass("hidden"),g.rpc("/settings/reauth_change_password_POST").kwargs({new_password:a.$("#@new_password").val()}).success(function(b){a.clear_passwords(),b[0]?(a.$("#@old_password_no_match").addClass("hidden"),a.$("#@password_changed").removeClass("hidden")):(a.$("#@old_password_no_match").text(b[1]).removeClass("hidden"),a.$("#@password_changed").addClass("hidden"))}).send(),!1)})}}),a.RemoveDisclaimerOption=j.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@remove_disclaimer_submit").click(this.fnbind(function(){return this.serverCall("remove_disclaimer").send(),!1}))}}),a.TumblrBlogList=c.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){return this.$("#@menu_items").menu(this.$("#@menu_link")),!1})),this.$("%@blogs").click(this.fnbind(function(a){return this.connectBlog($(a.target).attr("name")),!1}))},connectBlog:function(a){var b=this;b.serverCall("connect_tumblr").kwargs({url:a}).liveMutate().success(function(a){a!="OK"&&alert(b.failure_message)}).send()}}),a.BlogConnectDialogContents=c.extend({onLoad:function(){this.$("#@url, #@uname, #@pwd").focus(this.fnbind(function(){this.$("#@blog_not_supported").hide()})),this.$("#@url, #@uname, #@pwd").keydown(this.fnbind(function(a){a.keyCode==13&&this.submitForm()})),this.$("#@url").blur(this.fnbind(function(){this.$("#@wordpress_login_help").hide();var a=this.$("#@url").val();a.match("wordpress")&&this.$("#@wordpress_login_help").show()})),this.$("#@close").click(this.fnbind(function(){return g.Dialog.dialogFor(this).close_(),!1})),this.$("#@connect").click(this.fnbind(function(){this.submitForm()}))},submitForm:function(){var a=this.$("#@url").val(),b=this.$("#@uname").val(),c=this.$("#@pwd").val();a&&b&&c&&this.serverCall("validate_blog").kwargs({url:a,name:b,pwd:c}).liveMutate().success(this.fnbind(function(a){var b=a[0],c=a[1];b?($(document).trigger("wordpress_connect_success"),g.Dialog.dialogFor(this).close_()):this.$("#@blog_not_supported").show().text(c)})).send()}}),a.TumblrConnect=require("app/view/share/connect").SocialConnector.extend({events:{"click #@tumblr_connect_button":"connectTumblr","click #@tumblr_disconnect_button":"disconnectTumblr"},disconnectTumblr:function(){return this.serverCall("tumblr_disconnect").liveMutate().send(),!1}}),a.WordpressConnect=c.extend({events:{"click #@wordpress_connect_button":"connectWordpress","click #@wordpress_disconnect_button":"disconnectWordpress"},connectWordpress:function(){this._dialog=this.dialog().title(this.dialog_title).close(null).load("set_dialog_contents")},disconnectWordpress:function(){this.serverCall("wordpress_disconnect").liveMutate().send()}}),a.TwitterConnect=c.extend({onLoad:function(){this.$("#@twitter_disconnect_button").click(this.fnbind(function(){return this.serverCall("twitter_disconnect").liveMutate().send(),!1}))}}),a.LinkedinConnect=c.extend({onLoad:function(){this.$("#@linkedin_disconnect_button").click(this.fnbind(function(){return this.serverCall("disconnect_linkedin").liveMutate().send(),!1}))}}),a.LinkedinConnectButton=e.extend({onLoad:function(){var a=this;a.$("#@linkedin_connect_button").click(a.fnbind(function(){this.connectLinkedin()}))}}),a.LinkedinPublicProfileLink=c.extend({onLoad:function(){this.serverCall("get_profile_info").kwargs({li_uid:this.liUid}).success(this.fnbind(function(a){a===null?this.$("#@linkedin_link").text("").attr("href","#"):this.$("#@linkedin_link").text(a.first_name+" "+a.last_name).attr("href",a.url)})).send()}}),a.ConfirmEmailModal=h.extend({onSubmit:function(){var a=this;a.serverCall("resend_email_confirmation").success(function(){a._closeModal()}).liveMutate().send()}}),a.RemoveEmailModal=h.extend({onSubmit:function(){var a=this;a.serverCall("remove_email").success(function(){a._closeModal()}).liveMutate().send()}}),a.EmailAddressRow=c.extend({onLoad:function(){var a=this;this.$("#@confirm_email").click(this.fnbind(function(){var a=this;return a.modal("load_inner_confirm_email"),!1})),this.$("#@make_primary").click(function(){return a._serverCallHelper("set_primary_email")}),this.$("#@delete_email_icon").click(this.fnbind(function(){var a=this;return a.modal("load_inner_remove_email"),!1}))},_serverCallHelper:function(a){return this.serverCall(a).kwargs({email:this.email}).liveMutate().send(),!1}}),a.ConfirmPhoneNumberModal=h.extend({onSubmit:function(){this._closeModal()}}),a.RemovePhoneNumberModal=h.extend({onSubmit:function(){var a=this;a.serverCall("remove_number").success(function(){a._closeModal()}).liveMutate().send()}}),a.PhoneNumberRow=c.extend({onLoad:function(){var a=this;this.$("#@confirm_number").click(this.fnbind(function(a){this.modal("load_inner_confirm_phone_number"),a.preventDefault()})),this.$("#@make_primary").click(function(){return a._serverCallHelper("set_primary_number")}),this.$("#@delete_number").click(this.fnbind(function(a){this.modal("load_inner_remove_phone_number"),a.preventDefault()}))},_serverCallHelper:function(a){return this.serverCall(a).kwargs({number:this.number}).liveMutate().send(),!1}}),a.ResetPassword=c.extend({onLoad:function(){this.$("#@reset_email_submit").click(this.fnbind(function(a){var b=this.$("#@email_input").val();return b?(this.emailRequest("/settings/send_reset_password_email_POST",b),!1):!1})),this.$("#@reset_password_form_tag").submit(this.fnbind(function(a){var b=this.$("#@reset_password_code").val(),c=this.$("#@new_password").val(),d=this.$("#@confirm_password").val(),e=this.$("#@password_confirmation_mismatch");return c!==d?(e.removeClass("hidden"),!1):(e.addClass("hidden"),c?(this.passwordRequest("/settings/reset_password_POST",b,c),!1):!1)}))},emailRequest:function(a,b){return g.rpc(a).kwargs({email:b}).success(this.fnbind(function(a){this.$("#@email_input").val(""),this.$("#@reset_email_conf").removeClass("hidden"),this.$("#@reset_email_form").addClass("hidden")})).send(),!1},passwordRequest:function(a,b,c){return g.rpc(a).kwargs({code:b,new_password:c}).success(this.fnbind(function(a){a?f.navigateTo("/?__pmsg__=password_changed"):f.navigateTo("/settings/reset_password?__pmsg__=password_change_error")})).send(),!1}});var k={};a.onTwitterConnect=function(){$(k).trigger("connect")},a.TwitterConnectButton=e.extend({onLoad:function(){this.$("#@twitter_connect_button").click(this.fnbind(function(){this.connectTwitter()})),$(k).bind("connect",this.fnbind(function(){this.connectTwitter()}))}}),a.MutedRowToggle=c.extend({onLoad:function(){this.$("#@unmute").click(this.fnbind(function(){this.serverCall("unmute").kwargs({oid:this.oid}).liveMutate().send()})),this.$("#@mute").click(this.fnbind(function(){this.serverCall("mute").kwargs({oid:this.oid}).liveMutate().send()}))}}),a.SettingsToggleEditor=c.extend({onLoad:function(){this.$("#@edit_toggle").click(this.fnbind(function(){this.$("#@current_view").addClass("hidden"),this.$("#@editor_view").removeClass("hidden").find(this.editor).focus()}))}})},{"app/view/share/connect":!0,window_manager:!0,settings:!0,webnode2:!0,"view/modal":!0,"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/create_box",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("view/inline_editor").InlineEditor,f=require("input_validate").InputValidator,g=require("w2.context");a.BoardCreatePostBox=c.extend({onLoad:function(){this.$("#@twitter_label")&&this.$("#@twitter_label").tooltip({contents:this.twitter_share_text}),this.$("#@add_topics").click(this.fnbind(function(){return this.$("#@edit_topics").show(),this.$("#@add_topics").hide(),this.lookup("topic_selector")&&this.lookup("topic_selector").focus(!0),!1})),this.$("#@twitter_icon").click(this.fnbind(function(){return this.$("#@twitter").is(":checked")?this.uncheckTwitter():this.checkTwitter(),!1}));if(this.set_tabindex){var a=this.lookup("title_box",!0);a&&this.cQuery(":title_box.title_editor").$("#@editor"
).attr("tabindex",2),this.cQuery(":editor.editor").$("#@editor").attr("tabindex",3),this.lookup("topic_selector")&&this.lookup("topic_selector").$("#@input").attr("tabindex",4)}},hideDistroOptions:function(){this.uncheckTwitter(),this.$("#@distro_options").hide(),this.$("#@add_topics_link").hide()},showDistroOptions:function(){this.$("#@distro_options").show(),this.$("#@add_topics_link").show()},reset:function(){this.uncheckTwitter(),this.$("#@edit_topics").hide(),this.$("#@add_topics").show(),this.lookup("topic_selector")&&this.lookup("topic_selector").reset()},uncheckTwitter:function(){this.$("#@twitter").attr("checked",!1)},checkTwitter:function(){this.$("#@twitter").attr("checked",!0)}}),a.BoardCreatePostTitleBox=c.extend({onLoad:function(){this.$("#@fake_editor").click(this.fnbind(function(){return this.toggle_editor(),!1})),this.lookup("title_editor").focus()},toggle_editor:function(){this.$("#@fake_editor_row").hide(),this.$("#@editor_row").show(),this.$("#@editor_row .qtext_editor_content").focus()},titleRequired:function(){this.$("#@title_required").show()},titleRequiredReset:function(){this.$("#@title_required").hide()}}),a.CreateBoardPostEditor=e.extend({contextConstructor:function(){return g.Editor},onLoad:function(){this._super.apply(this,arguments),this.editorContext=this.getContext(g.Editor),this.$("#@remove_via").click(this.fnbind(function(){return this.$("#@via_text").hide(),this.$("#@via").remove(),!1})),this.fetchingUrl=!1,this.seenUrls={},this.link_editor_location=":link_editor.preview";var a=this,b=a.lookup("editor");this.boardSelectorObj=null,this.bid||(this.boardSelectorObj=this.parent().cQuery(":selector.selector"),this.boardSelectorObj.setCallback(function(){b.reportMeaningfulChange()})),b.fixEditorButtons(),this.$("#@fake_editor").click(this.fnbind(function(){this.showEditor()}));var c=this.lookup("title_box",!0);if(c){var d=c.child("title_editor");d.setMeaningfulChangeCallback(this.fnbind(function(){this.save_draft(!1)})),this.saved_title&&(d.setHtml(this.saved_title,this.saved_title_qlink_data),d.html(!1),c.toggle_editor())}if(this.saved_seen_urls)for(var e=0;e<this.saved_seen_urls.length;e++)this.seenUrls[this.saved_seen_urls[e]]=!0;if(this.saved_topics){var f=this.cQuery(":topic_suggestions_selector.topic_add");f.whenOnLoaded(function(){for(var b=0;b<a.saved_topics.length;b++)f.saveTempTopic(a.saved_topics[b])})}},showEditor:function(){this.$("#@fake_editor_wrapper").hide(),this.$("#@content").show(),this.lookup("editor").focus()},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){if(!this.lookup("editor").isEmpty()||this.preview!==null||this.id){if(this.parent().lookup("title_box",!0)){this.parent().cQuery(":title_box").titleRequiredReset();if(this.parent().cQuery(":title_box.title_editor").isEmpty())return this.parent().cQuery(":title_box").toggle_editor(),this.parent().cQuery(":title_box").titleRequired(),!1;this.parent().cQuery(":title_box.title_editor").$("#@editor").addClass("qtext_editor_content_disabled")}this.lookup("editor").$("#@editor").addClass("qtext_editor_content_disabled"),this.$("#@preview_url").addClass("qtext_editor_content_disabled"),f.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}})}return!1}))},removeUrl:function(){this.$("#@preview_url").html(""),this.$("#@preview_url_section, #@link_editor_buttons").hide(),this.$("#@remove_url").hide(),this.preview=null,this.lookup("editor").focus()},reset:function(){var a;this.parent().lookup("title_box",!0)&&(a=this.cQuery(":title_box.title_editor"),a.$("#@editor").removeClass("qtext_editor_content_disabled"),a.clear(!1));var b=this.lookup("editor");b.$("#@editor").removeClass("qtext_editor_content_disabled"),b.clear(!0),this.$("#@preview_url").removeClass("qtext_editor_content_disabled").hide(),this.$("#@preview_url_section, #@link_editor_buttons").hide(),this.$("#@remove_url").hide(),this.seenUrls={},this.removeUrl(),this.draft_space&&(this.draft_space.draft_id=null,b.resetMeaningfulChange(),a&&a.resetMeaningfulChange()),this.is_submission||this.parent().reset(),this.bid||this.boardSelectorObj.resetFakeInput()},cancelEditor:function(){this.canSaveDraft()&&this.draft_space.draft_id!==null&&this.save_draft(!1),this.closeDialog()},reportSuccess:function(){},ajax_callback:function(a){if(this.redirect_on_post&&a)document.location=a;else{if(this.is_dialog){this.reportSuccess(),this.closeDialog();return}this.reset()}},closeDialog:function(){d.Dialog.dialogFor(this).close_()},getBid:function(){return this.bid?this.bid:this.boardSelectorObj.getBid()||null},getBoardName:function(){return this.bid?null:this.boardSelectorObj.getText()},getVia:function(){return this.$("#@via")?this.$("#@via").val():null},getIsSubmission:function(){return this.is_submission},setIsSubmission:function(a){this.is_submission=a},getLinkURL:function(){var a=this.getLinkPreview();return a?a.url:null},getLinkPreview:function(){return this.preview?this.cQuery(this.link_editor_location).getLinkInfo():null},getTopics:function(){return this.lookup("topic_suggestions_selector",!0)?this.cQuery(":topic_suggestions_selector.topic_add").getTempTopicNamesAsArray():null},getTitle:function(){return this.parent().lookup("title_box",!0)?this.parent().cQuery(":title_box.title_editor").serialize():null},getSeenUrlsAsArray:function(){var a=[];for(var b in this.seenUrls)a.push(b);return a},getFacebookCheckbox:function(){return this.editorContext.get("shareToFacebook")},getTwitterCheckbox:function(){return this.editorContext.get("shareToTwitter")},getLoggedAction:function(){return"PostAdd"},invokeEditServerCall:function(a){if(this.getFacebookCheckbox()&&!require("facebook").hasPermission("publish_actions")){var b=arguments,c=this._super;require("facebook").requestPermissions("publish_stream",this.fnbind(function(a){c.apply(this,b)}))}else this._super.apply(this,arguments)},canSaveDraft:function(){return this.draft_space&&!this.save_draft_disabled},enableSaveDraft:function(){this.save_draft_disabled=!1},disableSaveDraft:function(){this.save_draft_disabled=!0},onClearDraft:function(){this.reset()},save_draft:function(a){if(!this.canSaveDraft())return;this.disableSaveDraft();var b=a?"save_draft":"save_draft_auto",c=this.serverCall(b).kwargs({window_id:d.windowId,draft_space:this.draft_space,bid:this.getBid(),name:this.getBoardName(),description:this.get_value(),title:this.getTitle(),target:this.target,url:this.url,link_url:this.getLinkURL(),preview:this.getLinkPreview(),via:this.getVia(),tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),topics:this.getTopics(),seen_urls:this.getSeenUrlsAsArray(),is_submission:this.getIsSubmission()}).success(this.fnbind(function(a){this.enableSaveDraft();if(this.draft_space&&this.draft_space.draft_id!=a){this.draft_space.draft_id=a;var b=this.child("draft_status");b&&b.updateWithDraftId(a)}})).error(this.fnbind(function(){this.enableSaveDraft()}));a&&c.liveMutate(),c.send()},_get_kwargs:function(){return{draft_space:this.draft_space,bid:this.getBid(),object_id:this.id,name:this.getBoardName(),description:this.get_value(),title:this.getTitle(),link_url:this.getLinkURL(),preview:this.getLinkPreview(),via:this.getVia(),tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),topics:this.getTopics(),is_submission:this.getIsSubmission(),fb_uid:require("facebook").getFbUid(),fb_access_token:require("facebook").getAccessToken(),fb_expires:require("facebook").getExpiresIn()}}})},{"w2.context":!0,webnode2:!0,input_validate:!0,facebook:!0,"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/follow_invite",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings,e=c.extend({setEmailTo:function(a){this._dialog=this.dialog().title(null).cancel(null,d.cancel).ok(this.fnbind(function(){var b=arguments[0].dialogComponent,c=b.lookup("msg").serialize(),d=b.lookup("subject").serialize(),e=b.name;this.serverCall("invite_to_follow").kwargs({name:e,email:a,msg:c,subject:d}).liveMutate().success(this.fnbind(function(){this._dialog.close_(),this.lookup("selector").clear()})).send()}),this.invite_text).load("invite_dialog",{kwargs:{email:a}})}});a.FollowInviteSection=e.extend({setTo:function(a){this.setEmailTo(a)},setUserTo:function(a){}}),a.FollowInviteEmailButton=e.extend({onLoad:function(){this.$("#@invite").click(this.fnbind(function(){return this.setEmailTo(this.email),!1}))}}),a.FollowInviteTwitterButton=c.extend({onLoad:function(){this.$("#@invite").click(this.fnbind(function(){return this._dialog=this.dialog().title(null).cancel(null,d.cancel).ok(this.fnbind(function(){}),this.invite_text).load("invite_twitter_dialog",{kwargs:{tw_uid:this.tw_uid}}),!1}))}}),a.InviteToFollowDialogContents=c.extend({onLoad:function(){this.lookup("msg").focus()}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/signup/google_",function(require,a,b){var c=require("settings"),d=require("w2.quora").Component,e=require("google_");window.loginInProgress=!1,a.SignupGoogleConnectButton=d.extend({events:{"click #@google_connect_button":"onClick"},onClick:function(){var a=this,b={callback:this.fnbind(this.signInCallback),clientid:c.googleClientId,cookiepolicy:c.googleCookiePolicy,scope:this.scopes};return this.prompt_ota_install&&(b.apppackagename=c.androidAppPackageName),e.onInit(function(){window.gapi.auth.setToken(null),window.gapi.auth.signIn(b),a.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_google"}).send()}),!1},signInCallback:function(a){a&&a.error===undefined?a.status.method==="AUTO"&&a.num_sessions===1?this.onLogin(a):a.status.method==="PROMPT"?this.onLogin(a):this.onLoginFailed():this.onLoginFailed()},onLogin:function(a){this.serverCall("on_google_connected").send(),this.queryGoogleProfile(a)},queryGoogleProfile:function(a){var b=this;e.getUserProfile(a,function(c){b.serverCall("record_signup_step").kwargs({signup_action:"fetched_user_google_profile"}).send(),b.trigger("goog_login",a.access_token,c)})},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_google_connect_failed"}).send(),this.trigger("goog_login_failed")}}),a.GoogleAutoLogin=d.extend({onLoad:function(){var a=this;a.viewer||e.onInit(function(){window.gapi.auth.authorize({immediate:!0,client_id:c.googleClientId,cookiepolicy:c.googleCookiePolicy,scope:a.scopes},a.fnbind(a.signInCallback))})},signInCallback:function(a){a&&a.error===undefined&&this.onLogin(a)},onLogin:function(a){if(window.loginInProgress===!0)return;window.loginInProgress=!0,this.serverCall("try_auto_login").kwargs({access_token:a.access_token}).success(function(a){a&&c.pageMode==="post_reload"&&require("window_manager").reload(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).except(function(){window.loginInProgress=!1}).send()}})},{"w2.quora":!0,google_:!0,window_manager:!0,settings:!0})}),require.whenReady("settings",function(){require.install("qed/sanitize",function(require,a,b){function j(a){while(!c.ok(a))a=a.parentNode;for(var b=d.getDocument(a).documentElement,e;a&&a!==b&&!e;a=a.parentNode)e=c.get(a,i),!e&&c.get(a,"isEditorRoot")&&(e=c.fix(a,i,new k(a,c.get(a,"editorRuleset"))));return e}function k(a,b){function k(a){var b=a[j];if(typeof b!="number"||i[b]!==a)try{a[j]=i.push(a)-1}catch(c){}}e(b instanceof h);var f={},i=[],j="qedSanitizerPos"+g++;this.add=function(a){a&&a.nodeType===3&&(a=a.parentNode),a&&(c.ok(a)?f[c.key(a)]=a:k(a))},this.flush=function(){var c,g=f;f={};for(c in g){a.normalize(!0);break}d.remove.apply(d,i),i.length=0;for(c in g)try{var h=g[c],j=h.parentNode;h=b.apply(h),h?l(h):j&&l(j)}catch(k){e(!1)}}}function l(a){for(var b=a.firstChild,c,d;b;b=d){d=b.nextSibling;if(b.nodeType===3){var e=b.nodeValue;c?(e.length>0&&(c.nodeValue+=e),a.removeChild(b)):e.length>0?c=b:a.removeChild(b)}else c&&(f(c),c=null)}c&&f(c)}var c=require("qed/npd"),d=require("qed/util"),e=d.assert,f=d.cleanTextNode,g=0,h=require("qed/rules").Ruleset,i="sanitizer";a.add=function(a){var b=j(a);b&&b.add(a)},a.flush=function(a){var b=j(a);b?b.flush():e(!1)},a.normalize=l},{"qed/util":!0,"qed/npd":!0,"qed/rules":!0})}),require.whenReady("settings",function(){require.install("qed/npd",function(require,a,b){function i(a){return!!a&&a.nodeType!==3&&!!a.getAttribute}function j(a,b){return m(a)&&b in n(a).data}function k(a,b,c){return j(a,b)?n(a).data[b]:c}function l(a,b,c){var d=n(a),e=d.data;return d.fixed[b]||(e[b]=c),e[b]}function m(a){if(a.getAttribute){var b=a.getAttribute(h);if(b in f)return f[b].node===a}return!1}function n(a){var b;d(i(a));if(a.getAttribute){var c=a.getAttribute(h);b=c&&f[c],d(b!==g);if(b&&b.node===a)return b;a.setAttribute(h,c=e()),b=f[c]={node:a,key:c,fixed:{},data:{}}}return require("qed/sanitize").add(a),b}function o(a){d(i(a));if(m(a)){var b=a.getAttribute(h);f[b]=g}}function p(a,b){if(a.nodeType==3)return;if(a.removeAttribute){b&&o(a),a.removeAttribute(h);for(var c=a.firstChild;c;c=c.nextSibling)p(c)}return a}var c=require("qed/util"),d=c.assert,e=c.guid,f={},g={},h="npdkey";a.ok=i,a.has=j,a.get=k,a.set=l,a.fix=function(a,b,c){var d=n(a),e=d.fixed,f=d.data;return arguments.length>2&&!e[b]&&(f[b]=c),e[b]=!0,f[b]},a.setdefault=function(a,b,c){return j(a,b)?k(a,b):l(a,b,c)},a.del=function(a,b,c){if(j(a,b)){var d=n(a),e=d.data;c=e[b],d.fixed||delete e[b]}return c},a.key=function(a){return n(a).key},a.clean=function(a){return p(a,!0)},a.cleanInnerHTML=function(a){return p(a.cloneNode(!0)).innerHTML.replace(/\ufeff/gm,"")}},{"qed/util":!0,"qed/sanitize":!0})}),require.whenReady("settings",function(){require.install("qed/modifiers",function(require,a,b){function e(a,b,d){return b=b.toLowerCase(),function(e,f){var g={},h=c.getDocument(e).documentElement,i=e;g[a]=b;while(i&&i!==h){i=c.convertToStyleSpan(i);var j=i.style[a].toLowerCase();if(j===b){g[a]=d;break}if(j===d){g[a]=b;break}i=i.parentNode}c.applyStyle(e,f,g)}}function f(a){c.hasTag(a.nextSibling,"br")&&c.remove(a.nextSibling)}function h(a){for(var b=0;b<a.length;b++)c.replaceWithChildren(a[b])}function i(a,b){var d=c.getEditorRoot(a),e=c.getDocument(d),h=a;while(h){var i=c.findPrevLine(h),j=c.findNextLine(h),k=c.nextLeaf(j);c.makeSiblings(i,j),f(i);var l=c.extractSiblings(e.createElement(g),i.nextSibling,j);c.insertBefore(i.parentNode,l,j);var m=c.nextLeaf(i),n;while(m&&m!==j){if(m===b||c.contains(m,b)){n=!0;break}m=c.nextLeaf(m)}c.remove(i,j);var o=l.parentNode;o!==d&&c.hasTag(o,"div")&&o.childNodes.length===1&&c.replaceWithChildren(o);if(n){f(l);break}h=k}if(c.isWebKit&&!a.previousSibling&&a.nextSibling==b&&!b.nextSibling){var p=e.createElement("br");c.insertBefore(a.parentNode,p,a)}}function j(a){var b=c.getEditorRoot(a),d=0;while(a&&a!==b){if(a.nodeType!==3){var e=a.nodeName.toLowerCase();(e==="ol"||e==="ul")&&d++}a=a.parentNode}return d}function k(a,b,e){var f=j(a);if(f>=10)return;var g=e?"ol":"ul",h=c.formatBlock(a,b,g),i=function(d){if(c.hasTag(d,"li")&&d.childNodes.length===1){var e=d.childNodes[0];if(c.hasTag(e,"span")){var f=e.childNodes;(f.length===0||f.length===2&&f[0]===a&&f[1]===b)&&e.appendChild(document.createElement("br"))}}return d},k=c.wrapLines(h,"li",i);return d(c.contains(k,a)),d(c.contains(k,b)),k}function m(a){return l.test(a.nodeName)}function o(a){return a.nodeType===3?/\S/.test(a.nodeValue):n.test(a.nodeName)?!1:!0}function p(a,b){var e=c.findAncestor(a,m);if(e){var f=b?c.findNextLine(a):c.findPrevLine(a),g=function(a){return c.remove(f),a};if(!c.contains(e,f))return g(!1);for(var h=b?c.prevLeaf:c.nextLeaf,i=f;i;i=h(i,e))if(o(i))return g(!1);while(f.parentNode!==e)c.splitParent(f);c.splitParent(f);var j=c.replaceWithChildren(b?f.previousSibling:f.nextSibling);return d(j.nodeName===e.nodeName),g(!0)}}function q(a,b){return c.isWebKit?r(a,b):c.isIE?s(a,b):!1}function r(a,b){var d=c.getDocument(a),e,f,g=c.findHeadingInLi(a),h=c.findHeadingInLi(b);if(!g&&!h)return!1;var i=a.parentNode===b.parentNode;c.removeEmptyTextNodes(a,!1),c.removeEmptyTextNodes(b,!0),c.firstLeaf(g)===a&&(c.insertBefore(g,a,g.firstChild),e=d.createElement("br"),c.insertBefore(a.parentNode,e,a)),!b.nextSibling&&h&&h.appendChild(b),f=d.createElement("br"),c.insertBefore(b.parentNode,f,b.nextSibling),c.makeSiblings(a,b);var j,k=a.nextSibling;while(k&&k!==b)j=k.nextSibling,c.remove(k),k=j;return i&&c.splitParentsUntil(a,b,g.parentNode),f&&(c.insertBefore(f.parentNode,a,f.nextSibling),c.insertBefore(f.parentNode,b,f.nextSibling)),c.remove(e),c.remove(f),!0}function s(a,b){var d=c.findHeadingInLi(b);if(!d)return;var e=b.nextSibling;while(e&&e.nodeType===3)c.cleanTextNode(e),e=e.nextSibling;c.removeEmptyTextNodes(b,!0);if(!b.nextSibling){var f=document.createTextNode("ï»¿");c.insertBefore(b.parentNode,f,b.nextSibling)}return!1}var c=require("qed/util"),d=require("assert").ok;a.bold=e("fontWeight","bold","inherit"),a.italic=e("fontStyle","italic","normal"),a.underline=e("textDecoration","underline","none"),a.blockquote=function(a,b){return c.formatBlock(a,b,"blockquote")};var g="h1";a.heading=function(a,b){function f(a){c.hasTag(a,g)&&e.push(a)}function j(a){a=a.parentNode;while(a&&a!==d)f(a),a=a.parentNode}var d=c.getEditorRoot(a);if(!d)return;var e=[];a.nextSibling===b?j(a):(c.traverseAllNodesBetween(a,b,d,function(a){f(a)}),a.parent===b.parent&&e.length===0&&j(a)),e.length>0?h(e):i(a,b)},a.orderedList=function(a,b){return k(a,b,!0)},a.unorderedList=function(a,b){return k(a,b,!1)},a.insertHR=function(a,b,d){var e=c.getEditorRoot(a),f=document.createElement("img"),g=document.createElement("div");f.setAttribute("class","hr_img"),f.setAttribute("type","hr"),f.setAttribute("src",d),g.appendChild(f);var h=c.findAncestor(a,c.causesLineBreak);if(h&&e!==h)if(c.isHeading(h)||c.hasTag(h,"div")){while(a.parentNode!==h)c.splitParent(a);c.splitParent(a)}c.insertBefore(a.parentNode,g,a);if(c.isGecko){var i=document.createElement("br");c.insertBefore(a.parentNode,b,g.nextSibling),c.insertBefore(a.parentNode,a,b),c.insertBefore(a.parentNode,i,a)}return f};var l=/^blockquote|address$/i,n=/^br|span|b|i|u|em|strong|h\d$/i;a.maybeEscape=function(a,b){return a.nextSibling===b&&(p(a,!1)||p(b,!0))},a.sanitizeBeforeRepair=function(a,b){var c=require("qed/sanitize");a.nextSibling===b&&c.flush(a),c.add(a.parentNode),c.add(b.parentNode)},a.handleEnterForHeadingInList=q},{assert:!0,"qed/util":!0,"qed/sanitize":!0})}),require.whenReady("settings",function(){require.install("qed/nodestate",function(require,a,b){function i(a,b,c){d(a&&b&&c),this.restore=function(){p(a,b),t(a,c)},this.diffAttrs=function(c){return d(c===a),o(a,b)},this.diffChildren=function(b){return d(b===a),s(a,c)}}function j(a,b){d(typeof b=="string");var c=a.createElement(b||"span"),e=f.key(c);return h[e]=!0,c}function k(a){return a?typeof a=="string"?/[^\ufeff]/.test(a):f.ok(a)?!h[f.key(a)]:!1:!1}function l(a,b){var c=b?b.diffAttrs(a):o(a),e=b?b.diffChildren(a):s(a),f={meaningful:c.meaningful||e.meaningful,identical:c.identical&&e.identical};return d(!f.meaningful||!f.identical),b?c.identical&&e.identical?(d(!c.meaningful&&!e.meaningful),f.state=b):(d(c.attrs||e.children),f.state=new i(a,c.attrs,e.children)):(d(c.meaningful&&!c.identical),d(e.meaningful&&!e.identical),f.state=new i(a,c.attrs,e.children)),k(a)||(f.meaningful=!1),f}function m(a,b){return a.name===b.name&&a.value===b.value}function n(a,b){var c=0,d={},f=[],h,i;if(a.getAttribute){for(i in g)(h=a.getAttribute(i))!==null&&(d[f[f.length]=i]=h);f.sort();for(c=0;c<f.length;++c)i=f[c],f[c]={name:i,value:d[i]}}if(!e(f,b,m))return f}function o(a,b){var c=n(a,b);return{meaningful:!!c,identical:!c,attrs:c||b}}function p(a,b){if(a.setAttribute){for(var c in g)a.removeAttribute(c);for(var e=0,f;e<b.length;++e)f=b[e],a.setAttribute(f.name,f.value)}else d(b.length<1)}function q(a,b){for(var c,d=[],f=a.firstChild;f;f=f.nextSibling)d.push(c=f.nodeType==3?typeof c=="string"?d.pop()+f.nodeValue:f.nodeValue:f);if(!e(d,b))return d}function r(a){for(var b,c=[],d,e=0;e<a.length;++e)k(d=a[e])&&(b=typeof d=="string"&&typeof b=="string"?c.pop()+d:d,typeof b=="string"&&(b=b.replace("ï»¿","")),c.push(b));return c}function s(a,b){var c=q(a,b),f;return c?b?f=!e(r(c),r(b)):f=!0:(d(b),f=!1),{meaningful:f,identical:!c,children:c||b}}function t(a,b){a.normalize();for(var e=0,f=b.length,g=a.firstChild;g&&e<f;g=g.nextSibling,++e)if(b[e]!==(g.nodeType===3?g.nodeValue:g))break;if(g){while(a.lastChild!==g)a.removeChild(a.lastChild);a.removeChild(g)}for(var h,i=c.getDocument(a);e<f;++e)h=b[e],a.appendChild(typeof h=="string"?i.createTextNode(h):h);d(a.childNodes.length===b.length)}var c=require("qed/util"),d=c.assert,e=c.arraysEqual,f=require("qed/npd"),g={"class":!0,style:!0},h={};a.createMeaninglessElement=j,a.isMeaningful=k,a.diff=l},{"qed/util":!0,"qed/npd":!0})}),require.whenReady("settings",function(){require.install("qed/rules",function(require,a,b){function j(){d(this instanceof j);var a=new k,b=this;b.addOkTag=function(c,d){return a.addOkTag(c,d),b},b.addOkStyle=function(c,d){return a.addOkStyle(c,d),b},b.addKeyHandler=function(c,d){return a.addKeyHandler(c,d),b},b.getKeyHandler=function(b){return a.keyHandlers[b.keyCode||b.charCode]},b.apply=function(b){return a.apply(b)}}function k(){var a=this,b={};d(a instanceof k),a.rules={br:"br",div:"div"},a.okStyles={},a.keyHandlers=b,b[8]=n,b[13]=m,b[37]=o,b[39]=p}function l(a){return(a||"").replace(i,"").toLowerCase()}function m(a,b,c){if(!c.shiftKey){if(f.maybeEscape(a,b))return!1;if(f.handleEnterForHeadingInList(a,b))return!1}}function n(a,b){a.nextSibling===b&&e(a,!0)}function o(a,b){a.nextSibling===b&&e(a,!0)}function p(a,b){a.nextSibling===b&&e(b,!1)}var c=require("qed/util"),d=c.assert,e=c.cleanFEFFs,f=require("qed/modifiers"),g=require("qed/npd"),h=require("qed/nodestate").isMeaningful,i=/^\s+|\s+$/g;a.Ruleset=j;var q=k.prototype;q.addOkTag=function(a,b){a=a.toLowerCase();if(b){var c=typeof b;c==="string"?b=b.toLowerCase():c!="function"&&d(!1)}else b=a;this.rules[a]=b},q.getSynonym=function(a){var b=a.nodeName.toLowerCase(),c=this.rules[b];return typeof c=="function"&&(c=c(a)),c},q.addOkStyle=function(a,b){a=l(a);var c=this.okStyles;(c.hasOwnProperty(a)?c[a]:c[a]={})[l(b)]=!0},q.isOkStyle=function(a,b){var c=this.okStyles[l(a)];return c&&c.hasOwnProperty(l(b))},q.addKeyHandler=function(a,b){this.keyHandlers[a]=b},q.apply=function(a){if(!g.ok(a)||g.get(a,"isEditorRoot")||!h(a))return a;var b=a.nodeName.toLowerCase(),d=a,e=this.getSynonym(a);if(e)return e!==b&&(d=c.getDocument(a).createElement(e),c.replaceNode(d,a)),this.copySafeStyles(a,d);c.replaceWithChildren(a)},q.copySafeStyles=function(a,b){var c=a.getAttribute("style");b=b||a;if(c){for(var d=[],e=!1,f=c.split(";"),g=0,h=f.length;g<h;g+=1){var i=f[g],j=i.split(":");j.length===2&&(this.isOkStyle(j[0],j[1])?d.push(i):e=!0)}d.length<1?b.removeAttribute("style"):b.setAttribute("style",e?d.join(";"):c)}else b.removeAttribute("style");return b}},{"qed/modifiers":!0,"qed/util":!0,"qed/npd":!0,"qed/nodestate":!0})}),require.whenReady("settings",function(){require.install("qed/selection",function(require,a,b){function h(a,b,c,d){var f=this,h=f.doc=g(b),i=f.isW3C=!!a.getSelection&&!!a.getSelection().extend;e(a.document===h),e(c.nodeType===1),e(d.nodeType===1),f.scope=b,f.start=c,f.end=d,f.getNativeSelection=i?function(){return a.getSelection()}:function(){return h.selection}}var c=require("log").log,d=require("qed/util"),e=d.assert,f=d.insertBefore,g=d.getDocument;h.prototype={createRange:function(){var a=this.doc;return this.isW3C?a.createRange():a.body.createTextRange()},getSelection:function(){var a=this,b=a.getNativeSelection(),c;if(a.isW3C){if(b&&b.rangeCount>0&&(c=b.getRangeAt(0))&&a.isRangeInScope(c))return{rng:c,rev:this.isSelectionReversed(b,c)}}else if(b&&(c=b.createRange())&&a.isRangeInScope(c))return{rng:c,rev:!1}},isRangeInScope:function(a){var b=this,c=b.scope,d=b.createRange();try{return b.isW3C?(d.selectNode(c),d.compareBoundaryPoints(a.START_TO_START,a)<1&&a.compareBoundaryPoints(a.END_TO_END,d)<1):(d.moveToElementText(c),d.compareEndPoints("StartToStart",a)<1&&a.compareEndPoints("EndToEnd",d)<1)}catch(e){return!1}},getDefaultSelection:function(){var a=this,b=a.createRange();return a.isW3C?b.selectNodeContents(a.scope):b.moveToElementText(a.scope),b.collapse(!0),a.isW3C||(b.move("Character",1),b.move("Character",-1)),{rng:b,rev:!1}},isSelectionReversed:function(a,b){if(this.isW3C&&(b=b||a.rangeCount>0&&a.getRangeAt(0))){var c=b.startContainer,d=b.startOffset;return(a.anchorNode!==c||a.anchorOffset!==d)&&a.focusNode===c&&a.focusOffset===d}return!1},copyAndCollapse:function(a,b){var c;return this.isW3C?(c=this.createRange(),c.setStart(a.startContainer,a.startOffset),c.setEnd(a.endContainer,a.endOffset)):c=a.duplicate(),c.collapse(!!b),c},replaceWith:function(a,b){if(this.isW3C)a.collapsed||a.deleteContents(),a.insertNode(b);else{var c="rangespan"+Math.random().toString(36);a.pasteHTML("<span id='"+c+"'></span>");var d=this.doc.getElementById(c);d.parentNode.replaceChild(b,d)}return b},replaceCollapsedCopyWith:function(a,b,c){this.replaceWith(this.copyAndCollapse(a,b),c)},insertDelimiters:function(a){var b=this;b.isRangeInScope(a)||(a=b.getDefaultSelection().rng),(a.compareEndPoints?a.compareEndPoints("StartToEnd",a)===0:a.collapsed)?(b.isW3C?b.replaceWith(a,b.end):b.replaceCollapsedCopyWith(a,!1,b.end),f(b.end.parentNode,b.start,b.end)):(b.replaceCollapsedCopyWith(a,!1,b.end),b.replaceCollapsedCopyWith(a,!0,b.start))},removeDelimiters:function(a){var b=this,c=b.createRange(),e,f=b.start,g=b.end;typeof a=="function"&&a(f,g);var h=f.parentNode,i=g.parentNode,j=d.addExtraSupport(f,g);return b.isW3C?(c.setStart(f,0),c.setEnd(g,0)):(c.moveToElementText(f),e=b.createRange(),e.moveToElementText(g),c.setEndPoint("EndToStart",e)),h.removeChild(f),i.removeChild(g),j(),c},_maxSelectRangeTime:20,selectRange:function(a,b){var d=this,e=d.getNativeSelection(),f=window.console&&+(new Date),g,h;d.isRangeInScope(a)||(a=d.getDefaultSelection().rng);if(d.isW3C)if(a.collapsed){var i=a.endContainer,j=a.endOffset;e.collapse(i,j)}else b?(e.collapse(a.endContainer,a.endOffset),e.extend(a.startContainer,a.startOffset)):(e.collapse(a.startContainer,a.startOffset),e.extend(a.endContainer,a.endOffset));else{h=!0;if(e&&e.createRange){g=e.createRange();try{g&&g.compareEndPoints("StartToStart",a)===0&&g.compareEndPoints("EndToEnd",a)===0&&(h=!1)}catch(k){}h&&a.select()}}if(f){var l=new Date-f;l>d._maxSelectRangeTime&&c.enabled&&c.warning("selection.SelImpl.selectRange","selectRange took too long:",l,"ms")}}},a.Selection=function(a,b,c,d){function n(){e(!m);if(!j){var a=g.getSelection();return k=a||k,!!a}}function o(a){j||(j=!0,g.insertDelimiters(k.rng));var b=++m;try{return a(g.start,g.end)}finally{e(j),e(b===m),--m||p()}}function p(){e(!m),j&&(j=!1,k.rng=g.removeDelimiters(l))}function q(){e(!m),j&&p(),g.selectRange(k.rng,k.rev)}function r(){if(n()){var a=g.getNativeSelection();a.removeAllRanges?a.removeAllRanges():a.empty()}}var f=a.document,g=new h(a,b,c||f.createElement("span"),d||f.createElement("span")),i=this,j,k=g.getDefaultSelection(),l,m=0;i.record=n,i.modify=o,i.modifying=function(){return m>0},i.select=q,i.remove=r,i.onBeforeRepair=function(a){e(typeof a=="function"),l=a}}},{"qed/util":!0,log:!0})}),require.whenReady("settings",function(){require.install("qed/snapshot",function(require,a,b){function g(a,b){c(a),this.lookup=function(c){if(e.ok(c)){var d=e.key(c);return d in a?a[d]:(a[d]=b,b?b.lookup(c):b)}}}function h(a,b){var c=a?[a]:[];while(c.length){b(a=c.pop());for(var d=a.firstChild;d;d=d.nextSibling)e.ok(d)&&c.push(d)}}var c=require("qed/util").assert,d=require("qed/sanitize"),e=require("qed/npd"),f=require("qed/nodestate");g.prototype.restore=function(a){var b=this;h(a,function(a){var c=b.lookup(a);c&&c.restore(),d.add(a)}),d.flush(a)},a.diff=function(a,b){var c={},d=!1,i=!0;return h(a,function(a){var g=b&&b.lookup(a),h=f.diff(a,g);d=d||h.meaningful,i=i&&h.identical,c[e.key(a)]=h.state}),{meaningful:d,identical:i,snapshot:i?b:new g(c,b)}},a.test=function(){}},{"qed/util":!0,"qed/npd":!0,"qed/sanitize":!0,"qed/nodestate":!0})}),require.whenReady("settings",function(){require.install("qed/history",function(require,a,b){function f(a){for(var b;a&&a.type!="end";a=a.prev){if(a.type=="redo")return a.prev;b=b||a.changed}if(b)return a;for(var c={count:0};a;a=a.prev){if(a.type=="redo")return a.prev;if(a.type=="end")c[a.key]=!0,++c.count;else if(c[a.key]){e(a.type=="begin"),delete c[a.key];if(--c.count===0)return b?a:f(a)}b=b||a.changed}}var c=require("qed/snapshot"),d=require("qed/util"),e=d.assert;a.observe=function(a){function h(d,f,h){e(d==="begin"||d==="end"||d==="redo");var i=(h||0).scope||a,j=c.diff(i,g&&g.snapshot),k={type:d,key:f,data:h,snapshot:j.snapshot,prev:g};if(k.changed=j.meaningful)b.length=0;return k}var b=[],d={},g;return{beginOperation:function(a,b){d[a]=!0,g=h("begin",a,b)},endOperation:function(a,b){a in d&&(delete d[a],g=h("end",a,b))},undo:function(){var c=h("redo","redo",g&&g.data),e=f(g);if(e)return b.push(c),d={},g=c.prev=e,g.snapshot.restore(a),g.data},redo:function(){if(b.length>0)return g=b.pop(),g.snapshot.restore(a),g.data}}}},{"qed/snapshot":!0,"qed/util":!0})}),require.whenReady("settings",function(){require.install("qed/trie",function(require,a,b){function c(){function f(a,b){var e=d(c,a);return e&&"val"in e&&(b=e.val),b}function g(a,c){if(!a)return!1;var d=a.c,e=c.charAt(0);if(e){g(d[e],c.slice(1))||delete d[e];if("val"in a)return!0}else"val"in a&&(b-=1,delete a.val);for(e in d)return!0}var a=this,b=0,c={c:{}};a.size=function(){return b},a.get=f,a.has=function(a){return f(a,c)!==c},a.prefix=function(a){return!!e(c,a)},a.put=function(a,e){var f=d(c,a,!0);return b+="val"in f?0:1,f.val=e,e},a.clear=function(){b=0,c={c:{}}},a.del=function(a){g(c,a)}}function d(a,b,c){if(a){if(!b)return a;var e=a.c,f=b.charAt(0);if(f in e||c&&(e[f]={c:{}}))return d(e[f],b.slice(1),c)}}function e(a,b){var c=d(a,b);if(c){if("val"in c)return!0;for(var e in c.c)return!0}}a.makeTrieMap=function(){return new c}},{})}),require.whenReady("settings",function(){require.install("qed/snippets",function(require,a,b){function k(a,b){var c=m(a);if(c){l(c.leaf,c.pos,a);var d=h.getDocument(a).createElement("div"),e=h.getEditorRoot(a),f,g=o(a);while(g.length>0)(f=g.pop())&&h.replaceWithChildren(f);d.innerHTML=c.tmpl,p(d,g);while(d.firstChild)h.insertBefore(a.parentNode,d.firstChild,a);return!0}}function l(a,b,c){i(a.nodeType===3);var d=h.insertBefore(a.parentNode,h.getDocument(a).createElement("span"),a.nextSibling),e=a.nodeValue.slice(0,b);e?a.nodeValue=e:h.remove(a);var f=h.makeSiblings(d,c);while(d.nextSibling!==c)f.removeChild(d.nextSibling);f.removeChild(d)}function m(a){var b=h.findPrevLine(a);try{return n(a)}finally{h.remove(b)}}function n(a){for(var b,d="",e=h.prevLeaf(a);e&&e.nodeType===3;e=h.prevLeaf(e))for(var f=e.nodeValue,g=f.length;g>=0;g-=1){d+=f.charAt(g);if(!c.prefix(d))return b;c.has(d)&&(b={leaf:e,pos:g,tmpl:c.get(d)})}return b}function o(a){var b=h.getEditorRoot(a),c=f.get(b,g);return c||(c=f.fix(b,g,{})),c.stops||(c.stops=[])}function p(a,b){var c=0,d=[],e,f=h.getDocument(a);r(f,a,d),b.length=0;while(c<d.length)(e=d[c++])&&b.push(e);e=b[b.length-1];if(!e||h.nextLeaf(e,a))e=f.createElement("span"),e.appendChild(f.createTextNode("ï»¿")),a.appendChild(e),b.push(e)}function q(a,b,c){var f=a.split(d);if(f.length>1)for(var g=1,h,j;g<f.length;g+=2){h=f[g-1],j=f[g];if(e.test(h))b(h+"$"+j);else{h&&b(h);if(j.charAt(0)==="{"){var k=j.length,l=j.slice(1,k-1).split(":");i(j.charAt(k-1)==="}"),c(+l[0],l[1]||"ï»¿")}else c(+j,"ï»¿")}}b(f.pop(),!0)}function r(a,b,c){if(b.nodeType===3)q(b.nodeValue,function(c,d){d?c?b.nodeValue=c:h.remove(b):h.insertBefore(b.parentNode,a.createTextNode(c),b)},function(d,e){i(typeof d=="number"),i(!isNaN(d));var f=a.createElement("span");f.appendChild(a.createTextNode(e)),h.insertBefore(b.parentNode,c[d]=f,b)});else for(var d=b.firstChild,e;d;d=e)e=d.nextSibling,r(a,d,c)}function s(a,b){for(var c,d=o(a),e=0;d&&e<d.length;++e){c=d[e],delete d[e];if(c){c.innerHTML==="ï»¿"?(c.appendChild(a),c.appendChild(b)):(h.insertBefore(c,a,c.firstChild),c.appendChild(b)),h.replaceWithChildren(c);break}}}var c,d=/\$(\d+|\{\d+:[^}]+\})/gm,e=/\\$/gm,f=require("qed/npd"),g="tabStopInfo",h=require("qed/util"),i=require("assert").ok;a.enabled=function(){return!!(c&&c.size()>0)},"".reverse||(String.prototype.reverse=function(){for(var a=this.length,b=new Array(a),c=a-1;c>=0;--c)b[b.length]=this.charAt(c);return b.join("")});var j=document.createElement("div");a.addTabTrigger=function(a,b){j.innerHTML=b,b=j.innerHTML,c||(c=require("qed/trie").makeTrieMap()),c.put(a.reverse(),b)},a.removeTabTrigger=function(a){c&&c.del(a.reverse())},a.clear=function(){c&&c.clear()},a.check=function(a,b){if(c){var d=k(a,b);return s(a,b),d}}},{assert
:!0,"qed/util":!0,"qed/npd":!0,"qed/trie":!0})}),require.whenReady("settings",function(){require.install("qed/edit",function(require,a,b){function t(a,b){if(p.enabled())return p.check(a,b),!1}function u(a){return function(b,c,d){if(g(d))return a(b,c),!1}}var c=require("qed/util"),d=c.assert,e=c.addClass,f=c.getDocument,g=c.hasCtrlOrCmd,h=c.getText,i=c.isVisible,j=require("event").add,k=require("qed/unload"),l=new(require("qed/rules").Ruleset),m=require("qed/selection").Selection,n=require("qed/history").observe,o=require("qed/modifiers"),p=require("qed/snippets"),q=require("qed/nodestate").createMeaninglessElement,r=require("qed/npd"),s=require("settings").interface_strings;a.edit=function(a,b){function G(b){return c.isIE11&&h(a).indexOf("-")>-1?!0:c.isIE&&b in C}function H(a){var b=a.keyCode||a.charCode,d=16,e=13;if(!c.isChrome)return!1;var f=a.type=="keyup",g=a.type=="keydown",h=b==d,i=a.shiftKey&&b==e,j=h||i;return h&&(f?D=!1:g&&(D=!0)),i&&(f?E=!1:g&&(E=!0)),j?F=!0:(F&&(j=!0),!D&&!E&&(F=!1)),j}function I(){z=!1,p.body.removeAttribute("spellcheck")}function J(a){z||(z=!0,p.body.setAttribute("spellcheck","false")),clearTimeout(A),A=setTimeout(I,a||1e3)}function L(){if(K)return;K=!0;try{B&&p.activeElement!==a&&a.focus(),t.select(),p.activeElement!==a&&a.focus()}finally{d(K),K=!1}d(p.activeElement===a)}function M(){p.activeElement===a&&t.record()}function N(b){if(p.activeElement!==a)return!1}function O(){if(i(a)&&h(a)!==w)return s.in_progress_warning}if(!a||/^textarea|input$/i.test(a.nodeName)||a.isContentEditable)return;e(a,"qed_content"),a.setAttribute("contentEditable","true"),r.fix(a,"isEditorRoot",!0),b=b||l,r.fix(a,"editorRuleset",b);var p=f(a),t=new m(window,a,q(p,"span"),q(p,"span")),u=!1,v=n(a),w=h(a),x=0,y=c,z,A,B=c.isGecko,C={38:"up arrow",40:"down arrow"},D=!1,E=!1,F=!1;t.onBeforeRepair(o.sanitizeBeforeRepair),j(a,"keydown",function(a){if(H(a))return;B&&J(1e3);try{t.record();var c=a.keyCode||a.charCode;if(G(c))return;return t.modify(function(d,e){if(c==90&&g(a))return a.shiftKey?v.redo():v.undo(),!1;v.beginOperation("key"+c);var f=b.getKeyHandler(a);if(f)return f.call(y,d,e,a)})}finally{L()}});var K;return j(a,"keyup",function(a){if(H(a))return;try{t.record();var b=a.keyCode||a.charCode;if(G(b))return;t.modify(function(a,c){v.endOperation("key"+b)})}finally{L()}}),j(a,"keypress",M),j(a,"mouseup",M),j(a,"mouseout",M),j(a,"focus",L),j(a,"blur",t.remove),j(a,"keydown",N),j(a,"keypress",N),j(a,"keyup",N),k.checkBeforeUnload(O),{modify:function(a,b){var c="modify"+x++;try{return t.modify(function(b,d){v.beginOperation(c);try{return a.call(y,b,d)}finally{v.endOperation(c)}})}finally{(b||u)&&!(u=t.modifying())&&L()}},clear:function(a){this.modify(function(a,b){var d=c.getEditorRoot(a),e=f(d).createElement("br");c.removeAllChildren(d),d.appendChild(e),c.insertBefore(d,a,e),c.insertBefore(d,b,e)},a),this.html(!0)},focus:L,select:L,html:function(b){return b&&(w=h(a)),r.cleanInnerHTML(a)},text:function(b){return h(a,b)},stop:function(){r.clean(a),k.removeCheck(O)}}},l.addOkTag("div").addOkTag("p","div").addOkTag("br").addOkTag("img").addOkTag("ol").addOkTag("ul").addOkTag("li").addOkTag("blockquote").addOkTag("address","blockquote").addOkTag("b").addOkTag("strong","b").addOkTag("i").addOkTag("em","i").addOkTag("u").addOkTag("span").addOkTag("a").addOkTag("h1").addOkStyle("font-weight","bold").addOkStyle("font-weight","normal").addOkStyle("font-style","italic").addOkStyle("font-style","normal").addOkStyle("text-decoration","underline").addOkStyle("text-decoration","none").addKeyHandler(9,t).addKeyHandler(65,c.handleSelectAll).addKeyHandler(66,u(o.bold)).addKeyHandler(73,u(o.italic)).addKeyHandler(85,u(o.underline))},{"qed/nodestate":!0,"qed/unload":!0,settings:!0,"qed/history":!0,"qed/modifiers":!0,"qed/npd":!0,"qed/rules":!0,"qed/snippets":!0,"qed/util":!0,"qed/selection":!0,event:!0})}),require.whenReady("settings",function(){require.install("app/view/post",function(require,a,b){var c=require("w2.quora").Component;a.PostSuggestedEditDiscardButtonInline=c.extend({onLoad:function(){var a=this;this.$("#@submit").click(function(b){a.serverCall("discard_suggested_edit").kwargs({pid:a.pid}).liveMutate().send(),b.preventDefault()})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/funnel",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies").cookie,e=require("keystrokes"),f;a.FunnelState=c.extend({onLoad:function(){var a=this;a.$("#@show_unstarted").click(function(){a.$("#@unstarted").show(),a.$("#@show_unstarted").hide()}),a.$("#@refresh").click(function(){location.reload()})}}),a.ResetFunnelLink=c.extend({onLoad:function(){var a=this;a.$("#@reset").click(function(){a.serverCall("reset_funnel").success(function(){location.reload()}).send()})}}),a.ActivateFunnelLink=c.extend({onLoad:function(){var a=this;a.$("#@activate").click(function(){a.serverCall("activate_funnel").liveMutate().send()})}}),e.on([70,48,70,48],function(){f&&f.toggle()}),a.FunnelRideAlong=c.extend({onLoad:function(){var a=this,b;f=a,a.$("#@wrapper").hover(function(){b=clearTimeout(b),a.hovering=!0,a.slideIn()},function(){b=setTimeout(function(){a.hovering=!1,a.slideOut()},500)})},toggle:function(){this.$("#@wrapper").hasClass("hidden")?this.turnOn():this.turnOff()},turnOn:function(){this.$("#@wrapper").removeClass("hidden"),d("funnelRideAlongOnByDefault","1")},turnOff:function(){this.$("#@wrapper").addClass("hidden"),d("funnelRideAlongOnByDefault",null)},slideOut:function(){if(!this.hovering){var a=this.$("#@wrapper"),b=parseInt(a.css("padding"));a.animate({right:b-a.width()+50+"px"})}},slideIn:function(){this.$("#@wrapper").animate({right:"0px"})}})},{cookies:!0,keystrokes:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/moderation/flag",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.AddFlag=c.extend({onLoad:function(){this.$("#@show_flag_dialog").click(this.fnbind(function(a){return this.showFlagDialog(),!1}))},showFlagDialog:function(){this.modal("flag_modal")}}),a.AddFlagModal=d.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@show_more_reasons a").click(this.fnbind(function(){return this.$("#@show_more_reasons, #@more_reasons").toggleClass("hidden"),!1})),this.$("%@flag_input").click(this.fnbind(function(a){this.$("#@report").removeAttr("disabled").removeClass("submit_button_disabled"),this.$("#@comment").show(),this.lookup("comment").focus(),this.$("#@required_comment_warning").hide(),this.$("#@required_report_reason_warning").hide();var b=parseInt($(a.target).eq(0).val(),10),c=parseInt(this.other_reason_id,10),d=parseInt(this.factually_incorrect_reason_id,10);b==c||b==d?this.$("#@optional_label").hide():this.$("#@optional_label").show()}))},onSubmit:function(){this.report()},report:function(){var a=this.$("#@block_option").attr("checked")=="checked",b={flag_reason:this.getFlagReason(),comment:this.child("comment").serialize()};a&&(b.block_uid=this.block_uid);var c=b.flag_reason==this.other_reason_id||b.flag_reason==this.factually_incorrect_reason_id;b.flag_reason?c&&this.child("comment").isEmpty()?this.$("#@required_comment_warning").show():b.flag_reason!==null&&this.serverCall("flag_object").kwargs(b).liveMutate().success(this.fnbind(function(a){this._closeModal(),a&&a[0]=="/"&&(window.location=a)})).send():this.$("#@required_report_reason_warning").show()},getFlagReason:function(){return this.$("%@flag_input").filter(":checked").val()}}),a.AggregatedFlagItem=c.extend({onLoad:function(){this.$("#@summary, #@more").click(this.fnbind(function(a){return this.$("#@all_flags").toggleClass("hidden"),!1}))}}),a.NeedsImprovementMenu=c.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){return this.$("#@menu_items").menu(this.$("#@menu_link")),!1}))},addTopic:function(a){if(!a)return;this.serverCall("add_topic").kwargs({qid:this.qid,tid:a}).liveMutate().send()}}),a.NeedsImprovementMenuItem=c.extend({onLoad:function(){this.$("#@ni_topic").click(this.fnbind(function(){return this.parent().addTopic(this.tid),!1}))}}),a.BoardActionMenu=c.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(){return this.$("#@menu_items").menu(this.$("#@menu_link")),!1}))}}),a.DismissLink=c.extend({onLoad:function(){this.$("#@dismiss").click(this.fnbind(function(a){return this.dismiss(),!1}))},dismiss:function(){this.serverCall("dismiss").liveMutate().send()}}),a.TargetAndReports=c.extend({onLoad:function(){this.$("#@toggle").click(this.fnbind(function(a){return this.toggleComments(),!1}))},toggleComments:function(){this.$("#@reports").toggleClass("hidden")}}),a.LockLink=c.extend({onLoad:function(){var a=this;a.$("#@lock_link").click(function(b){return b.preventDefault(),$(this).hasClass("unlocked")?(a.serverCall("lock_answer").liveMutate().send(),$(this).removeClass("unlocked")):(a.serverCall("unlock_answer").liveMutate().send(),$(this).addClass("unlocked")),!1})}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("linkify",function(require,a,b){a.iterLinks=function(a,b){c(a,{callback:function(a,c){return c&&b(c,a),""}})};var c=a.linkify=function(){var a="[a-z\\d.-]+://",b="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",c="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",d="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",e="(?:"+c+d+")",f="(?:[;/][^#?<>\\s\\[\\]]*)?",g="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",h="\\b"+a+"[^<>\\s]+",i="\\b"+e+f+g+"(?!\\w)",j="mailto:",k="(?:"+j+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+e+g+"(?!\\w)",l=new RegExp("(?:"+h+"|"+i+"|"+k+")","ig"),m=new RegExp("^"+a,"i"),n={"'":"`",">":"<",")":"(","]":"[","}":"{","Â»":"Â«","âº":"â¹"},o={callback:function(a,b){return b?'<a href="'+b+'" title="'+b+'">'+a+"</a>":a},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(a,b){b=b||{};var c,d,e,f,g="",h=[],i,k,p,q,r,s,t,u;for(d in o)b[d]===undefined&&(b[d]=o[d]);while(c=l.exec(a)){e=c[0],k=l.lastIndex,p=k-e.length;if(/[\/:]/.test(a.charAt(p-1)))continue;do q=e,u=e.substr(-1),t=n[u],t&&(r=e.match(new RegExp("\\"+t+"(?!$)","g")),s=e.match(new RegExp("\\"+u,"g")),(r?r.length:0)<(s?s.length:0)&&(e=e.substr(0,e.length-1),k--)),b.punct_regexp&&(e=e.replace(b.punct_regexp,function(a){return k-=a.length,""}));while(e.length&&e!==q);f=e,m.test(f)||(f=(f.indexOf("@")!==-1?f.indexOf(j)?j:"":f.indexOf("irc.")?f.indexOf("ftp.")?"http://":"ftp://":"irc://")+f),i!=p&&(h.push([a.slice(i,p)]),i=k),h.push([e,f])}h.push([a.substr(i)]);for(d=0;d<h.length;d++)g+=b.callback.apply(window,h[d]);return g||a}}()},{})}),require.whenReady("settings",function(){require.install("find",function(require,a,b){function g(a,b){if(a.nodeType===3)return b(a);for(var c=a.firstChild,d;c;c=d){d=c.nextSibling;if(g(c,b))return!0}}function h(a,b,g,h){f(a.nodeType===3);var i=a.nodeValue,j=a.parentNode,k=e(a),l=i.slice(0,b),m=i.slice(b,g),n=a.nodeValue=i.slice(g),o=k.createElement("span"),p=o.cloneNode(!1);l&&d(j,k.createTextNode(l),a),d(j,o,a),m&&d(j,k.createTextNode(m),a),d(j,p,a);try{return h(o,p)}finally{c.remove(o,p,!n&&a)}}function i(a,b,c){return b&&g(a,function(a){for(;;){var d=a.nodeValue.indexOf(b);if(d<0)return;var e=h(a,d,d+b.length,c);if(e)return e}})}function j(a,b,c){return b&&g(a,function(a){for(;;){b.lastIndex=0;var d=b.exec(a.nodeValue);if(d===null)return;var e=h(a,d.index,d.index+d[0].length,c);if(e)return e}})}var c=require("qed/util"),d=c.insertBefore,e=c.getDocument,f=require("assert").ok;a.findText=i,a.findExp=j,a.find=function(a,b,c){if(typeof b=="string")return i(a,b,c);if(b instanceof RegExp)return j(a,b,c)}},{assert:!0,"qed/util":!0})}),require.whenReady("settings",function(){require.install("swfobject",function(require,a,b){var c=null,d=function(){c==null&&(c=function(){function B(){if(u)return;try{var a=j.getElementsByTagName("body")[0].appendChild(R("span"));a.parentNode.removeChild(a)}catch(b){return}u=!0;var c=m.length;for(var d=0;d<c;d++)m[d]()}function C(a){u?a():m[m.length]=a}function D(b){if(typeof i.addEventListener!=a)i.addEventListener("load",b,!1);else if(typeof j.addEventListener!=a)j.addEventListener("load",b,!1);else if(typeof i.attachEvent!=a)S(i,"onload",b);else if(typeof i.onload=="function"){var c=i.onload;i.onload=function(){c(),b()}}else i.onload=b}function E(){l?F():G()}function F(){var c=j.getElementsByTagName("body")[0],d=R(b);d.setAttribute("type",f);var e=c.appendChild(d);if(e){var g=0;(function(){if(typeof e.GetVariable!=a){var b=e.GetVariable("$version");b&&(b=b.split(" ")[1].split(","),z.pv=[parseInt(b[0],10),parseInt(b[1],10),parseInt(b[2],10)])}else if(g<10){g++,setTimeout(arguments.callee,10);return}c.removeChild(d),e=null,G()})()}else G()}function G(){var b=n.length;if(b>0)for(var c=0;c<b;c++){var d=n[c].id,e=n[c].callbackFn,f={success:!1,id:d};if(z.pv[0]>0){var g=Q(d);if(g)if(T(n[c].swfVersion)&&!(z.wk&&z.wk<312))V(d,!0),e&&(f.success=!0,f.ref=H(d),e(f));else if(n[c].expressInstall&&I()){var h={};h.data=n[c].expressInstall,h.width=g.getAttribute("width")||"0",h.height=g.getAttribute("height")||"0",g.getAttribute("class")&&(h.styleclass=g.getAttribute("class")),g.getAttribute("align")&&(h.align=g.getAttribute("align"));var i={},j=g.getElementsByTagName("param"),k=j.length;for(var l=0;l<k;l++)j[l].getAttribute("name").toLowerCase()!="movie"&&(i[j[l].getAttribute("name")]=j[l].getAttribute("value"));J(h,i,d,e)}else K(g),e&&e(f)}else{V(d,!0);if(e){var m=H(d);m&&typeof m.SetVariable!=a&&(f.success=!0,f.ref=m),e(f)}}}}function H(c){var d=null,e=Q(c);if(e&&e.nodeName=="OBJECT")if(typeof e.SetVariable!=a)d=e;else{var f=e.getElementsByTagName(b)[0];f&&(d=f)}return d}function I(){return!v&&T("6.0.65")&&(z.win||z.mac)&&!(z.wk&&z.wk<312)}function J(b,c,d,e){v=!0,s=e||null,t={success:!1,id:d};var f=Q(d);if(f){f.nodeName=="OBJECT"?(q=L(f),r=null):(q=f,r=d),b.id=g;if(typeof b.width==a||!/%$/.test(b.width)&&parseInt(b.width,10)<310)b.width="310";if(typeof b.height==a||!/%$/.test(b.height)&&parseInt(b.height,10)<137)b.height="137";j.title=j.title.slice(0,47)+" - Flash Player Installation";var h=z.ie&&z.win?"ActiveX":"PlugIn",k="MMredirectURL="+i.location.toString().replace(/&/g,"%26")+"&MMplayerType="+h+"&MMdoctitle="+j.title;typeof c.flashvars!=a?c.flashvars+="&"+k:c.flashvars=k;if(z.ie&&z.win&&f.readyState!=4){var l=R("div");d+="SWFObjectNew",l.setAttribute("id",d),f.parentNode.insertBefore(l,f),f.style.display="none",function(){f.readyState==4?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}()}M(b,c,d)}}function K(a){if(z.ie&&z.win&&a.readyState!=4){var b=R("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(L(a),b),a.style.display="none",function(){a.readyState==4?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(L(a),a)}function L(a){var c=R("div");if(z.win&&z.ie)c.innerHTML=a.innerHTML;else{var d=a.getElementsByTagName(b)[0];if(d){var e=d.childNodes;if(e){var f=e.length;for(var g=0;g<f;g++)(e[g].nodeType!=1||e[g].nodeName!="PARAM")&&e[g].nodeType!=8&&c.appendChild(e[g].cloneNode(!0))}}}return c}function M(c,d,e){var g,h=Q(e);if(z.wk&&z.wk<312)return g;if(h){typeof c.id==a&&(c.id=e);if(z.ie&&z.win){var i="";for(var j in c)c[j]!=Object.prototype[j]&&(j.toLowerCase()=="data"?d.movie=c[j]:j.toLowerCase()=="styleclass"?i+=' class="'+c[j]+'"':j.toLowerCase()!="classid"&&(i+=" "+j+'="'+c[j]+'"'));var k="";for(var l in d)d[l]!=Object.prototype[l]&&(k+='<param name="'+l+'" value="'+d[l]+'" />');h.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+k+"</object>",o[o.length]=c.id,g=Q(c.id)}else{var m=R(b);m.setAttribute("type",f);for(var n in c)c[n]!=Object.prototype[n]&&(n.toLowerCase()=="styleclass"?m.setAttribute("class",c[n]):n.toLowerCase()!="classid"&&m.setAttribute(n,c[n]));for(var p in d)d[p]!=Object.prototype[p]&&p.toLowerCase()!="movie"&&N(m,p,d[p]);h.parentNode.replaceChild(m,h),g=m}}return g}function N(a,b,c){var d=R("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function O(a){var b=Q(a);b&&b.nodeName=="OBJECT"&&(z.ie&&z.win?(b.style.display="none",function(){b.readyState==4?P(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function P(a){var b=Q(a);if(b){for(var c in b)typeof b[c]=="function"&&(b[c]=null);b.parentNode.removeChild(b)}}function Q(a){var b=null;try{b=j.getElementById(a)}catch(c){}return b}function R(a){return j.createElement(a)}function S(a,b,c){a.attachEvent(b,c),p[p.length]=[a,b,c]}function T(a){var b=z.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function U(c,d,e,f){if(z.ie&&z.mac)return;var g=j.getElementsByTagName("head")[0];if(!g)return;var h=e&&typeof e=="string"?e:"screen";f&&(w=null,x=null);if(!w||x!=h){var i=R("style");i.setAttribute("type","text/css"),i.setAttribute("media",h),w=g.appendChild(i),z.ie&&z.win&&typeof j.styleSheets!=a&&j.styleSheets.length>0&&(w=j.styleSheets[j.styleSheets.length-1]),x=h}z.ie&&z.win?w&&typeof w.addRule==b&&w.addRule(c,d):w&&typeof j.createTextNode!=a&&w.appendChild(j.createTextNode(c+" {"+d+"}"))}function V(a,b){if(!y)return;var c=b?"visible":"hidden";u&&Q(a)?Q(a).style.visibility=c:U("#"+a,"visibility:"+c)}function W(b){var c=/[\\\"<>\.;]/,d=c.exec(b)!=null;return d&&typeof encodeURIComponent!=a?encodeURIComponent(b):b}var a="undefined",b="object",d="Shockwave Flash",e="ShockwaveFlash.ShockwaveFlash",f="application/x-shockwave-flash",g="SWFObjectExprInst",h="onreadystatechange",i=window,j=document,k=navigator,l=!1,m=[E],n=[],o=[],p=[],q,r,s,t,u=!1,v=!1,w,x,y=!0,z=function(){var c=typeof j.getElementById!=a&&typeof j.getElementsByTagName!=a&&typeof j.createElement!=a,g=k.userAgent.toLowerCase(),h=k.platform.toLowerCase(),m=h?/win/.test(h):/win/.test(g),n=h?/mac/.test(h):/mac/.test(g),o=/webkit/.test(g)?parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,p=!1,q=[0,0,0],r=null;if(typeof k.plugins!=a&&typeof k.plugins[d]==b)r=k.plugins[d].description,r&&(typeof k.mimeTypes==a||!k.mimeTypes[f]||!!k.mimeTypes[f].enabledPlugin)&&(l=!0,p=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),q[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),q[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),q[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof i.ActiveXObject!=a)try{var s=new ActiveXObject(e);s&&(r=s.GetVariable("$version"),r&&(p=!0,r=r.split(" ")[1].split(","),q=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(t){}return{w3:c,pv:q,wk:o,ie:p,win:m,mac:n}}(),A=function(){if(!z.w3)return;(typeof j.readyState!=a&&j.readyState=="complete"||typeof j.readyState==a&&(j.getElementsByTagName("body")[0]||j.body))&&B(),u||(typeof j.addEventListener!=a&&j.addEventListener("DOMContentLoaded",B,!1),z.ie&&z.win&&(j.attachEvent(h,function(){j.readyState=="complete"&&(j.detachEvent(h,arguments.callee),B())}),i==top&&function(){if(u)return;try{j.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}B()}()),z.wk&&function(){if(u)return;if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);return}B()}(),D(B))}(),X=function(){z.ie&&z.win&&window.attachEvent("onunload",function(){var a=p.length;for(var b=0;b<a;b++)p[b][0].detachEvent(p[b][1],p[b][2]);var d=o.length;for(var e=0;e<d;e++)O(o[e]);for(var f in z)z[f]=null;z=null;for(var g in c)c[g]=null;c=null})}();return{registerObject:function(a,b,c,d){if(z.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,n[n.length]=e,V(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(z.w3)return H(a)},embedSWF:function(c,d,e,f,g,h,i,j,k,l){var m={success:!1,id:d};z.w3&&!(z.wk&&z.wk<312)&&c&&d&&e&&f&&g?(V(d,!1),C(function(){e+="",f+="";var n={};if(k&&typeof k===b)for(var o in k)n[o]=k[o];n.data=c,n.width=e,n.height=f;var p={};if(j&&typeof j===b)for(var q in j)p[q]=j[q];if(i&&typeof i===b)for(var r in i)typeof p.flashvars!=a?p.flashvars+="&"+r+"="+i[r]:p.flashvars=r+"="+i[r];if(T(g)){var s=M(n,p,d);n.id==d&&V(d,!0),m.success=!0,m.ref=s}else{if(h&&I()){n.data=h,J(n,p,d,l);return}V(d,!0)}l&&l(m)})):l&&l(m)},switchOffAutoHideShow:function(){y=!1},ua:z,getFlashPlayerVersion:function(){return{major:z.pv[0],minor:z.pv[1],release:z.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(a,b,c){return z.w3?M(a,b,c):undefined},showExpressInstall:function(a,b,c,d){z.w3&&I()&&J(a,b,c,d)},removeSWF:function(a){z.w3&&O(a)},createCSS:function(a,b,c,d){z.w3&&U(a,b,c,d)},addDomLoadEvent:C,addLoadEvent:D,getQueryParamValue:function(a){var b=j.location.search||j.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(a==null)return W(b);var c=b.split("&");for(var d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return W(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(v){var a=Q(g);a&&q&&(a.parentNode.replaceChild(q,a),r&&(V(r,!0),z.ie&&z.win&&(q.style.display="block")),s&&s(t)),v=!1}}}}())};require("jquery.whenIdle");var e=require("settings"),f=function(a,b){return d(),c[a].apply(c,b)};a.embedSWF=function(){var a=arguments;$.whenIdle(350,function(){f("embedSWF",a)},"load swfobject (from embedSWF)")},a.removeSWF=function(){return f("removeSWF",arguments)},$.whenIdle(350,d,"load swfobject (by timeout)")},{"jquery.whenIdle":!0,settings:!0})}),require.whenReady("settings",function(){require.install("flash",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2").FlashClient={};a.FlashClient=c.extend({onLoad:function(a){if(a){d.onInit=this.delayedFn(this.onFlashInit),d.onComplete=this.fnbind(this.onComplete);try{require("swfobject").embedSWF(this.swf_url,this.$("#@flash").attr("id"),"1","1","10.0.0",null,this.flash_vars,{allowScriptAccess:"always"},{allowscriptaccess:"always"})}catch(b){$.serverLog("error in swfobject library: "+b)}}},delayedFn:function(a){return this.fnbind(function(){var b=arguments;setTimeout(this.fnbind(function(){a.apply(this,b)}),1)})},onFlashInit:function(){try{this.getSwf().init(this.so,this.cp,this.fc)}catch(a){$.serverLog("Unable to call onFlashInit(): "+a)}},onComplete:function(){},getSwf:function(){return this.$("#@flash").get(0)}})},{webnode2:!0,swfobject:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("html",function(require,a,b){var c=document.createElement("div");a.encode=function(a){return c.innerText=a,c.innerHTML},a.decode=function(a){return c.innerHTML=a,c.innerText}},{})}),require.whenReady("settings",function(){require.install("app/view/embed",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base,e=require("views").viewsLogger,f=require("third_party/truncate");a.EmbedModalLink=c.extend({onLoad:function(){var a=this;this.$("#@modal_link").on("click",function(b){a.modal("load_inner"),b.preventDefault()}),this.$("#@embed_disabled").tooltip({contents:a.embed_disabled_text})}}),a.EmbedModal=d.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.selectAllOnFocus(a.$("#@code_area")),a.$("#@full_answer_checkbox").click(a.fnbind(a.toggleFullAnswer))},selectAllOnFocus:function(a){a.focus(function(){var a=$(this);a.select(),window.setTimeout(function(){a.select()},1),a.mouseup(function(){return a.unbind("mouseup"),!1})})},hideFullAnswerCheckbox:function(){this.$("#@full_answer_checkbox").addClass("hidden")},toggleFullAnswer:function(){var a=this;a.$("#@full_answer").is(":checked")?(a.$("#@truncated_preview").addClass("hidden"),a.$("#@full_preview").removeClass("hidden"),a.$("#@code_area").val(a.full_answer_code)):(a.$("#@truncated_preview").removeClass("hidden"),a.$("#@full_preview").addClass("hidden"),a.$("#@code_area").val(a.truncated_answer_code))}}),a.AnswerEmbedAnswer=c.extend({onLoad:function(){var a=this;a.is_short_answer&&a.lookup("modal").hideFullAnswerCheckbox(),e.addComponentToTrack(this),e.logViews(),a.embedly&&(a.$("#@question_text").truncate({lineHeight:"24",lines:3}),a.$("#@answer_header").truncate({lines:1}))}})},{"third_party/truncate":!0,views:!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require("jquery"),!0,window.log&&window.log.enabled&&window.log("main","main-pre1 is loaded."),require("w2.timing").logTime("mainPre1ScriptEnd")}),require.whenReady("settings",function(){require.install("keystrokes",function(require,a,b){function d(a,b){for(var d=0,e=c.length;d<e;++d)c[d].trigger(a,b)}var c=[];require("event").add(document,"keydown",function(a){a.target&&!a.target.getAttribute("contenteditable")&&a.target.nodeName!=="INPUT"&&d(a.keyCode||a.charCode,a)});var e=function(a,b){this.codes=a,this.matchHandler=b,this.position=0};e.prototype.trigger=function(a,b){a===this.codes[this.position]?this.position+=1:this.position=0,this.position===this.codes.length&&(this.matchHandler(b),this.position=0)},a.on=function(a,b){typeof a=="number"?a=[a]:a=a.slice(0),c.push(new e(a,b))}},{event:!0})}),require.whenReady("settings",function(){require.install("webnode2",function(require,exports,module){(function(){function addParents(a){var b,c,d=Object.keys(a),e=d.length;for(var f=0;f<e;++f)b=d[f],c=a[b],W2._parents[b]=c,typeof W2._allChildren[c]=="undefined"&&(W2._allChildren[c]=[]),W2._allChildren[c].push(b),typeof W2._children[b]=="undefined"&&(W2._children[b]={}),typeof W2._knowsAbout[b]=="undefined"&&(W2._knowsAbout[b]={})}function addHmacs(a){var b=Object.keys(a),c=b.length;for(var d=0;d<c;++d){var e=b[d];W2._hmacs[e]=a[e]}}function addGroups(a){var b,c,d,e,f,g=Object.keys(a),h=g.length;for(var i=0;i<h;++i){d=g[i],b=a[d],f=b.length;for(e=0;e<f;e++)c=b[e],W2._groups[d]||(W2._groups[d]=[]),W2._groups[d].push(c),W2._componentGroups[c]||(W2._componentGroups[c]=[]),W2._componentGroups[c].push(d)}}function addChildren(a){var b,c=Object.keys(a),d=c.length;for(var e=0;e<d;++e)b=c[e],jQuery.extend(W2._children[b],a[b])}function addLookups(a){var b,c=Object.keys(a),d=c.length;for(var e=0;e<d;++e)b=c[e],jQuery.extend(W2._knowsAbout[b],a[b])}function addDomids(a){var b,c,d=Object.keys(a),e=d.length;for(var f=0;f<e;++f)b=d[f],W2._domidToCid[W2._domids[b]=a[b]]=b}function addDebugInfo(a){var b,c=require("w2.timing").timing,d=Object.keys(a),e=d.length;for(var f=0;f<e;++f)b=d[f],W2._debugInfo[b]=a[b],c._components&&(c._components[b]||(c._components[b]={}),c._components[b].addDebugInfo=+(new Date))}function addComponentMetadata(a){var b=a.parents,c=a.children,d=a.knowsAbout,e=a.groups,f=a.debugInfo,g=a.domids,h=a.hmacs;W2.addParents(b),W2.addChildren(c),W2.addLookups(d),W2.addGroups(e),W2.addDomids(g),W2.addHmacs(h),f&&W2.addDebugInfo(f),$(document).trigger("w2addcomponents",a),$(document).trigger("webnode_add_component_metadata",a)}function addLiveDepInfo(a,b){var c=Object.keys(a),d=c.length;for(var e=0;e<d;++e){var f=c[e];W2._liveDepInfo[f]=a[f]}c=Object.keys(b),d=c.length;for(e=0;e<d;++e){var g=c[e];W2._depKeysBreakpointTokens[g]=b[g]}}function _removeComponentMetadata(a){log.enabled&&log("webnode2._removeComponentMetadata","Removing",a);var b,c,d,e,f,g,h;$(document).trigger("webnode_before_remove_component_metadata",a),b=W2._parents[a],e=W2._components[a];if(e){f=e.cname;if(f){var i=W2._children[b];i&&i[f]==a&&delete i[f]}removeEntry(e)}c=W2._componentGroups[a];if(c)for(g=0;g<c.length;g++){d=c[g];for(h=0;h<W2._groups[d];h++)if(W2._groups[d][h]==a){W2._groups[d].splice(h,1);break}}delete W2._componentGroups[a],delete W2._components[a],delete W2._parents[a],delete W2._allChildren[a],delete W2._children[a],delete W2._knowsAbout[a],delete W2._domidToCid[W2._domids[a]],delete W2._domids[a],delete W2._debugInfo[a],delete W2._onVisibleComponents[a],delete onLoadStatus[a],delete onLoadCallbacks[a],$(document).trigger("webnode_after_remove_component_metadata",a)}function getLiveDomId(a){return W2._domids[a]}function getLiveDomElement(a){return document.getElementById(getLiveDomId(a))}function getComponentFromElement(a){while(a&&!(a.id in W2._domidToCid))a=a.parentNode;return a&&W2._components[W2._domidToCid[a.id]]}function getLiveParent(a){return W2._domids[a]?W2._domids[a]:W2._parents[a]?getLiveParent(W2._parents[a]):""}function getLiveChildren(a){var b=W2._allChildren[a],c=[];if(b)for(var d=0;d<b.length;++d)b[d]in W2._domids&&c.push(W2._domids[b[d]]);return c}function registerComponents(a){var b=[],c,d,e=require("w2.timing").timing;for(c=0;c<a.length;c++)d=a[c],log.enabled&&log("webnode2.registerComponents","Registering",d.cid),W2._components[d.cid]=d,d.onVisible&&(W2._onVisibleComponents[d.cid]=d,b.push(d));if(require("visibility").isVisible())for(c=0;c<b.length;c++){d=b[c];var f=+(new Date);try{d.onVisible()}catch(g){assert(!1)}e.components&&(e.components[d.cid]||(e.components[d.cid]={}),e.components[d.cid].v=+(new Date)-f)}return a}function hasEntry(a){return a.__js_key in stateEntries}function getEntry(a){var b=a.__js_key;return stateEntries[b]||(stateEntries[b]={ownerCid:a.cid,state:{}})}function removeEntry(a){var b=a.cid;if(!a.__js_key||a.__js_key===b){var c=stateEntries[b];c&&c.ownerCid===b&&delete stateEntries[b]}}function flushOnLoadCallbacks(a){var b,c=a.cid,d=onLoadCallbacks[c];if(d){d.reverse();while(b=d.pop())b()}}function cidFromMyId(a){var b=_my_exp.exec(a),c=b&&b[1];return assert(!c||c in W2._components),c}function onLoad(a,b){var c,d,e,f=[],g=require("w2.timing").timing;rec("webnode2","onLoad","start");for(c=0;c<a.length;c++)context.initComponent(a[c]);for(c=0;c<a.length;c++){e=a[c],onLoadStatus[e.cid]=ONLOAD_BEGUN;var h=+(new Date);try{e.bindEvents&&e.bindEvents(),e.onLoad(b),onLoadStatus[e.cid]=ONLOAD_DONE,flushOnLoadCallbacks(e)}catch(i){f.push({component:e,exception:i})}g.components&&(g.components[e.cid]||(g.components[e.cid]={}),g.components[e.cid].l=+(new Date)-h)}window.clearHandlers&&window.clearHandlers(),rec("webnode2","onLoad","finish");if(f.length){var j=[];for(c=0;c<f.length;++c){var k=f[c].exception;d=f[c].component.__vcon+" : "+(k.stack?k.stack:k),j.push(d),log.error("webnode2.loadComponent",k)}throw $.serverLog(f.length+" component(s) threw during onLoad","ERROR",j.join("\n\n")),f[0].exception}return a}function onVisible(){var a,b,c=[],d,e=require("w2.timing").timing;for(a in W2._onVisibleComponents){b=W2._onVisibleComponents[a];if(b!=W2._components[a])continue;var f=+(new Date);try{b.onVisible()}catch(g){c.push({component:b,exception:g})}e.components&&(e.components[a]||(e.components[a]={}),e.components[a].v=+(new Date)-f)}if(d=c.length)throw $.serverLog(d+" component(s) threw during onVisible","ERROR",c),c}function _CIDLookup(a,b){var c;return a&&a!="*ROOT*"?(require("assert").ok(W2._knowsAbout[a]),c=W2._knowsAbout[a][b],typeof c!="undefined"?_cQueryByCID(a,c):_CIDLookup(W2._parents[a],b)):null}function _safeGetComponentByCID(a){var b;return a?(b=W2._components[a],b?b:new VirtualComponent(a)):null}function _cQueryByCID(a,b){var c,d,e,f,g,h,i,j,k,l;if(b==".")return a;c=[],d="",e="first";for(f=0;f<b.length;f++)g=b.charAt(f),g=="."?(c.push([e,d]),d="",e="child"):g==":"?(c.push([e,d]),d="",e="lookup"):g=="<"?(c.push([e,d]),d="",e="parent"):d+=g;c.push([e,d]),h=a;for(f=0;f<c.length;f++){j=c[f],i=j[0],k=j[1];if(i=="first"){if(k){l=W2._children[h];if(!l)return null;h=l[k];if(!h)throw new W2Error("Couldn't find child '"+k+"' in cQuery '"+b+"'",a)}if(!h)throw new W2Error("Started from an invalid node '"+h+"' in cQuery '"+b+"'",a)}else if(i=="child"){l=W2._children[h];if(!l)return null;h=l[k];if(!h)throw new W2Error("Couldn't find child '"+k+"' in cQuery '"+b+"'",a)}else if(i=="lookup"){h=_CIDLookup(h,k);if(!h)throw new W2Error("Lookup failed for '"+k+"' in cQuery '"+b+"'",a)}else{if(i!="parent")throw new W2Error("Bad token in Component query. '"+i+"'",a);h=W2._parents[h];if(!h||h=="*ROOT*")throw new 
W2Error("No parent found in cQuery '"+b+"'",a)}if(!h)throw new W2Error("Unknown Error in cQuery: '"+b+"'",a)}return h}function W2Error(a,b){this.message=this.errorType+": "+a,b&&(this.message+=" <cid="+b+">")}function _assertIDs(a,b){if(a.nodeType!=3){a.id&&(a.id in b&&assert(a===b[a.id]),b[a.id]=a);for(var c=a.firstChild;c;c=c.nextSibling)_assertIDs(c,b)}return b}var W2=exports,log=require("log").log,settings=require("settings"),keycombo=require("w2.keycombo"),context=require("w2.context"),Component,VirtualComponent,setContent,setContentHTML,setContentJS;W2._parents={},W2._components={},W2._onVisibleComponents={},W2._children={},W2._knowsAbout={},W2._allChildren={},W2._domids={},W2._domidToCid={},W2._debugInfo={},W2._liveDepInfo={},W2._depKeysBreakpointTokens={},W2._ignoreDomids={},W2._ignoreCids={},W2._groups={},W2._componentGroups={},W2._GROUP_RE=/%([0-9a-zA-Z_]+)/,W2._keyComboHandlers={},W2._unloaded={},W2._hmacs={};var stateEntries={};Component=require("Class").Class.extend({__init__:function(a,b,c,d){this.cid=a,this.cname=b;var e=W2._hmacs[this.cid];e?this.__vcon=e.split(":"):this.__vcon=null,this.__js_init=c,this.__js_key=d.js_key||a;if(b!==null&&hasEntry(this)){var f=getEntry(this);assert(f.ownerCid!==this.cid),f.ownerCid=this.cid}return this.init(c),this},contextConstructor:function(){},init:function(a){var b;if(typeof a=="object")for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);return this},whenOnLoaded:function(a){var b=this.cid;if(onLoadStatus[b]===ONLOAD_DONE)a();else{var c=onLoadCallbacks[b]||[];c.push(a),onLoadCallbacks[b]=c}},state:function(a,b){var c=getEntry(this),d=c.state,e=W2._components[c.ownerCid]||this,f=e.stateHandlers[a],g;return f?g=d[a]=f.call(e):g=d[a],arguments.length>1&&(d[a]=b,f&&f.call(e,b)),g},stateHandlers:{},initState:function(a,b){var c=getEntry(this),d=c.state,e=W2._components[c.ownerCid]||this;return e.state(a,a in d?d[a]:b)},child:function(a){var b,c;return c=W2._children[this.cid],c&&(b=c[a]),_safeGetComponentByCID(b)},children:function(){var a=W2._allChildren[this.cid],b=[],c;if(!a)return b;for(c=0;c<a.length;c++)b.push(_safeGetComponentByCID(a[c]));return b},parent:function(){var a;return a=W2._parents[this.cid],_safeGetComponentByCID(a)},getJQueryObject:function(){return $("#"+W2.getLiveParent(this.cid))},installScrollHandlers:function(a){this._scrollHandler=this.fnbind(a),$(window).scroll(this._scrollHandler)},uninstallScrollHandlers:function(){this._scrollHandler&&$(window).unbind("scroll",this._scrollHandler)},clickHandlers:{},mouseDownHandlers:{},mouseUpHandlers:{},mouseOverHandlers:{},mouseOutHandlers:{},installMouseHandlers:function(){var a=this,b={clickHandlers:"click",mouseDownHandlers:"mousedown",mouseUpHandlers:"mouseup",mouseOverHandlers:"mouseover",mouseOutHandlers:"mouseout"},c=function(b){var c=f[b];a.$("#@"+b).bind(e,function(b){return b.preventDefault(),c.call(a,b)})};for(var d in b){var e=b[d],f=this[d];for(var g in f)c(g)}},onKeyCombination:function(a,b,c,d,e){if(!settings.keyboardShortcuts||!$(a).length)return;if(!d){var f=$(a);while(f.length&&!f.hasClass("kbfocusable"))f=f.parent();d=f.get(0)||document.body}keycombo.bindKeyComboHandler(d,b,c,e)?(W2._keyComboHandlers[this.cid]=W2._keyComboHandlers[this.cid]||[],W2._keyComboHandlers[this.cid].push([b,d])):log.enabled&&log.trace("webnode2.onKeyCombination","Duplicate handler ignored",this.cid,b,d)},uninstallKeyComboHandlers:function(){var a=W2._keyComboHandlers[this.cid]||[];for(var b=a.pop();b;b=a.pop())keycombo.unbindKeyComboHandler(b[0],b[1])},lookup:function(a,b){try{var c=_CIDLookup(this.cid,a);return _safeGetComponentByCID(c)}catch(d){if(!b)throw d}},cQuery:function(a){var b;return b=_cQueryByCID(this.cid,a),_safeGetComponentByCID(b)},$:function(a){var b=this._my();if(typeof a=="string"){a=a.replace(/@/g,b);while(a.indexOf("%")!=-1){var c=W2._GROUP_RE.exec(a);if(c){var d=W2._groups[c[1]];if(typeof d=="undefined")return $([]);a=a.replace(c[0],"#"+d.join(",#"))}}}return $(a)},_my:function(){return"__w2_"+this.cid+"_"},__children:function(){return W2._children[this.cid]},__allChildren:function(){return W2._allChildren[this.cid]},__parent:function(){return W2._parents[this.cid]},__knowsAbout:function(){return W2._knowsAbout[this.cid]},ge:function(a){return document.getElementById(a.replace("@",this._my()))},onLoad:function(a){},bindEvents:function(){var a=this.events;if(!a)return;for(var b in a){var c=b.indexOf(" ");c>-1&&this.bindEvent(b.slice(0,c),b.slice(c+1),a[b])}},bindEvent:function(a,b,c){var d=this;typeof c=="string"&&(c=d[c]),assert(typeof a=="string"),assert(typeof b=="string"),assert(typeof c=="function"),d.$(b)[a](function(){return log.enabled&&log("webnode2.Component.bindEvent","On "+a+", invoking",c),c.apply(d,arguments)})},onUnload:function(){},onInsertNode:function(a,b){return!0},onDeleteNode:function(a,b){return!0},onUpdate:function(a){return!0},serverCall:function(a){if(!this.__vcon)throw new W2Error("No vcon info for Component <cid="+this.cid+">");log.enabled&&log.trace("webnode2.Component.serverCall",a,this.__vcon);if(this.__vcon.length===1)return new W2._ServerCall(this.__vcon,a,this);switch(this.__vcon[0]){case"cls":return new W2._ServerCall(this.__vcon,a,this);case"live":return new W2._ServerCall(this.__vcon.slice(2),a,this);case"hmac":return new W2._ServerCall(this.__vcon,a,this);default:throw new W2Error("Unknown vcon type '"+this.__vcon[0]+"'")}},bind:function(a,b){if("length"in this)throw new W2Error("Cannot bind an event for Component with length property",this);$(this).bind(a,b)},trigger:function(a){$(this).trigger(a,Array.prototype.slice.call(arguments,1))}});var onLoadStatus={},ONLOAD_BEGUN=1,ONLOAD_DONE=2,onLoadCallbacks={},_my_exp=/^__w2_((?:[^_]+_)?[^_]+)/;VirtualComponent=Component.extend({__init__:function(a){this._super(a,null,{},{}),this.isVirtual=!0,context.initComponent(this)}}),W2Error.prototype=new Error,W2Error.prototype.errorType="W2Error",W2Error.prototype.contstructor=W2Error,setContent=function(a,b){return setContentHTML(a,b),setContentJS(a,b),a},setContentHTML=function(a,b){return a.innerHTML=b.html,a},setContentJS=function(node,content){return eval(content.js),node};var unloadComponent=function(a){log.enabled&&log("webnode2.unloadComponent","Unloading:",a);var b;try{var c=W2._components[a];if(c!==undefined)try{c.onUnload(),context.unloadComponent(c),c.uninstallKeyComboHandlers&&c.uninstallKeyComboHandlers()}catch(d){b===undefined&&(b=d)}var e=W2._allChildren[a];while(e!==undefined&&e.length!==0){var f=e.pop();try{W2.unloadComponent(f)}catch(d){b===undefined&&(b=d)}}_removeComponentMetadata(a)}finally{W2._unloaded[a]=!0,log.enabled&&(log("webnode2.unloadComponent","Unloaded:",a),validateUnload(a));if(b!==undefined)throw b}};W2.assertUnloaded=function(a){assert(a in W2._unloaded)};var validateUnload=function(a){var b=a in W2._componentGroups||a in W2._components||a in W2._parents||a in W2._allChildren||a in W2._children||a in W2._knowsAbout||a in W2._domids||a in W2._debugInfo||a in W2._onVisibleComponents||a in onLoadStatus||a in onLoadCallbacks;b&&log.enabled&&log.error("webnode2.unloadComponent","Component unload checker has detected an error:",a,"wasn't cleaned up properly.")},newComponent=function(a,b,c,d,e,f,g){if(!a)throw Error("JS class specified by js_init not found: "+b);return new a(c,d,e,f,g)};W2.addParents=addParents,W2.addChildren=addChildren,W2.addLookups=addLookups,W2.addDebugInfo=addDebugInfo,W2.addLiveDepInfo=addLiveDepInfo,W2.addGroups=addGroups,W2.addDomids=addDomids,W2.addHmacs=addHmacs,W2.registerComponents=registerComponents,W2.getComponentFromElement=getComponentFromElement,W2.getLiveDomId=getLiveDomId,W2.getLiveDomElement=getLiveDomElement,W2.getLiveParent=getLiveParent,W2.getLiveChildren=getLiveChildren,W2.Component=Component,W2.VirtualComponent=VirtualComponent,W2.onLoad=onLoad,W2.onVisible=onVisible,W2.addComponentMetadata=addComponentMetadata,W2._safeGetComponentByCID=_safeGetComponentByCID,W2.W2Error=W2Error,W2.setContent=setContent,W2.setContentHTML=setContentHTML,W2.setContentJS=setContentJS,W2._removeComponentMetadata=_removeComponentMetadata,W2.unloadComponent=unloadComponent,W2.newComponent=newComponent,W2.C=W2._components,W2._stateEntries=stateEntries,W2._onLoadStatus=onLoadStatus,W2._onLoadCallbacks=onLoadCallbacks,W2.assertAllIDsUnique=function(a){return _assertIDs(a||document.body,{})}})(),exports.__W2_ExampleJSComponent=exports.Component.extend({init:function(a){this.dataFromPython=a},onLoad:function(){a1ert("Hello webnode2!")}})},{"w2.context":!0,log:!0,settings:!0,"w2.timing":!0,visibility:!0,assert:!0,"w2.keycombo":!0,Class:!0})}),require.whenReady("settings",function(){require.install("jquery.whenIdle",function(require,a,b){(function(a,b,undefined){var c=a.log,d=2e3,e=!1,f=!1,g=!1,h=[],i=[],j=function(a){for(var b=0;b<a.length;b++)setTimeout(a[b],0);a.length=0};b(document).ready(function(){c&&c.enabled&&c("jquery.whenIdle","Ready event fired."),e=!0,setTimeout(function(){c&&c.enabled&&c("jquery.whenIdle","Idle event fired, flushing queue."),f=!0,j(h)},d)}),document.readyState=="complete"?setTimeout(function(){c&&c.enabled&&c("jquery.whenIdle","Load event has already fired, flushing queue."),g=!0,j(h),j(i)},0):b(window).load(function(){c&&c.enabled&&c("jquery.whenIdle","Load event fired, flushing queue."),g=!0,j(h),j(i)}),b.whenIdle=function(a,d,i,j){if(a==null||a<0)a=0;b.isFunction(d)&&(j=i,i=d,d=null);if(d!=null&&a>d)throw"minDelay > maxDelay.";c&&c.enabled&&j&&c("jquery.whenIdle.whenIdle","Scheduling",j,"; delays: min =",a,"max =",d);var k=!1,l=function(){if(k)return;k=!0,c&&c.enabled&&j&&c("jquery.whenIdle.whenIdle","Executing",j),i()};if(f||g){setTimeout(l,0);return}if(e){setTimeout(l,a);return}h.push(l),b(document).ready(function(){setTimeout(l,a)}),d!=null&&setTimeout(l,d)},b.whenLoaded=function(a,d,e,f){if(a==null||a<0)a=0;b.isFunction(d)&&(f=e,e=d,d=null);if(d!=null&&a>d)throw"minDelay > maxDelay.";c&&c.enabled&&f&&c("jquery.whenIdle.whenLoaded","Scheduling",f,"; delays: min =",a,"max =",d);var h=!1,j=function(){if(h)return;h=!0,c&&c.enabled&&f&&c("jquery.whenIdle.whenLoaded","Executing",f),e()};if(g){setTimeout(j,0);return}i.push(j),b(window).load(function(){setTimeout(j,a)}),d!=null&&setTimeout(j,d)}})(this,jQuery)},{})}),require.whenReady("settings",function(){require.install("browser",function(require,a,b){(function(a,c){typeof b!="undefined"&&b.exports&&(b.exports.browser=c())})("bowser",function(){function b(b){function c(a){var c=b.match(a);return c&&c.length>1&&c[1]||""}var d=c(/(ipod|iphone|ipad)/i).toLowerCase(),e=/like android/i.test(b),f=!e&&/android/i.test(b),g=c(/version\/(\d+(\.\d+)?)/i),h=/tablet/i.test(b),i=!h&&/[^-]mobi/i.test(b),j;/opera|opr/i.test(b)?j={name:"Opera",opera:a,version:g||c(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/windows phone/i.test(b)?j={name:"Windows Phone",windowsphone:a,msie:a,version:c(/iemobile\/(\d+(\.\d+)?)/i)}:/msie|trident/i.test(b)?j={name:"Internet Explorer",msie:a,version:c(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome|crios|crmo/i.test(b)?j={name:"Chrome",chrome:a,version:c(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:d?(j={name:d=="iphone"?"iPhone":d=="ipad"?"iPad":"iPod"},g&&(j.version=g)):/sailfish/i.test(b)?j={name:"Sailfish",sailfish:a,version:c(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(b)?j={name:"SeaMonkey",seamonkey:a,version:c(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(b)?(j={name:"Firefox",firefox:a,version:c(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(b)&&(j.firefoxos=a)):/silk/i.test(b)?j={name:"Amazon Silk",silk:a,version:c(/silk\/(\d+(\.\d+)?)/i)}:f?j={name:"Android",version:g}:/phantom/i.test(b)?j={name:"PhantomJS",phantom:a,version:c(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(b)||/rim\stablet/i.test(b)?j={name:"BlackBerry",blackberry:a,version:g||c(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(b)?(j={name:"WebOS",webos:a,version:g||c(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(b)&&(j.touchpad=a)):/bada/i.test(b)?j={name:"Bada",bada:a,version:c(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(b)?j={name:"Tizen",tizen:a,version:c(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/safari/i.test(b)?j={name:"Safari",safari:a,version:g}:j={},/(apple)?webkit/i.test(b)?(j.name=j.name||"Webkit",j.webkit=a,!j.version&&g&&(j.version=g)):!j.opera&&/gecko\//i.test(b)&&(j.name=j.name||"Gecko",j.gecko=a,j.version=j.version||c(/gecko\/(\d+(\.\d+)?)/i)),f||j.silk?j.android=a:d&&(j[d]=a,j.ios=a);var k="";d?(k=c(/os (\d+([_\s]\d+)*) like mac os x/i),k=k.replace(/[_\s]/g,".")):f?k=c(/android[ \/-](\d+(\.\d+)*)/i):j.windowsphone?k=c(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):j.webos?k=c(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):j.blackberry?k=c(/rim\stablet\sos\s(\d+(\.\d+)*)/i):j.bada?k=c(/bada\/(\d+(\.\d+)*)/i):j.tizen&&(k=c(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(j.osversion=k);var l=k.split(".")[0];if(h||d=="ipad"||f&&(l==3||l==4&&!i)||j.silk)j.tablet=a;else if(i||d=="iphone"||d=="ipod"||f||j.blackberry||j.webos||j.bada)j.mobile=a;return j.msie&&j.version>=10||j.chrome&&j.version>=20||j.firefox&&j.version>=20||j.safari&&j.version>=6||j.opera&&j.version>=10||j.ios&&j.osversion&&j.osversion.split(".")[0]>=6||j.blackberry&&j.version>=10.1?j.a=a:j.msie&&j.version<10||j.chrome&&j.version<20||j.firefox&&j.version<20||j.safari&&j.version<6||j.opera&&j.version<10||j.ios&&j.osversion&&j.osversion.split(".")[0]<6?j.c=a:j.x=a,j.version=parseFloat(j.version),j}var a=!0,c=b(typeof navigator!="undefined"?navigator.userAgent:"");return c._detect=b,c})},{browser:!0})}),require.whenReady("settings",function(){require.install("w2.errors",function(require,a,b){(function(b,undefined){function m(a,b,d,f,h){var k=a.status===0;if(k){setTimeout(function(){p()||n("Internet connection problem. ")},1e3);return}g.enabled&&g("w2.errors.reportAjaxError","Error:",a.status,d,", XHR: ",a);if(Math.random()*100<i.client_side_server_call_error_logging_percentage&&new Date-j>=c){j=new Date,g.enabled&&g("w2.errors.reportAjaxError","Forwarding error log entry to server.");var l=a.responseText||"";l.length>2048&&(l=l.substr(0,2048)+"... (TRUNCATED)"),$.serverLog("AJAX request failed: "+a.status.toString()+", "+d+"; response: "+l)}if(h!==undefined){var m=(new Date).getTime()-h;m>e&&(f=!1)}f&&n()}function n(a){if(!h.Error)return;h.Error.show(a)}function o(a){k++,setTimeout(function(){k--},a)}function p(){return k!==0}function q(a){l++,setTimeout(function(){l--},a)}function r(){return l!==0}var c=6e5,d=2e3,e=50,f=5e3,g=require("log").log,h=require("webnode2"),i=require("settings"),j=new Date(0),k=0,l=0;$(window).on("unload.w2errors beforeunload.w2errors",function(){g.enabled&&g("w2.errors.unload","window.beforeunload event is raised."),o(d)}),$(document).on("mouseup.w2errors mousedown.w2errors keyup.w2errors keydown.w2errors keypress.w2errors",function(){q(e)}),a.reportAjaxError=m,a.showError=n,a.canBeRelatedToUserAction=r,a.canBeRelatedToPageUnload=p,a.beginCanBeRelatedToUserActionBlock=q})(this)},{webnode2:!0,log:!0,settings:!0})}),require.whenReady("settings",function(){require.install("w2.perf",function(require,a,b){(function(b,undefined){function h(a){if(Math.random()>d.e2e_sample_rate)return;d.instart_cchannel_setting&&(a.instart_cchannel_setting=!0),$.whenLoaded(500,function(){c.rpc("/e2e/perf_POST").args(a).send()},"w2.perf_post.report")}function i(){var a=(new Date).getTime();for(var b in e){var c=e[b];a-c.startTime>=g&&(delete e[b],c.endTime=a,c.timeout=!0,h(c))}}var c=require("webnode2"),d=require("settings"),e={},f=5e3,g=3e4;a.startPOST=function(a){if(a===null||typeof a=="undefined")throw"This method expects an object describing the action.";return a.startTime=(new Date).getTime(),e[a.id]=a,a},a.finishPOST=function(a){var b=e[a];return b===undefined?null:(b.endTime=(new Date).getTime(),delete e[a],h(b),b)},setInterval(i,f)})(window)},{webnode2:!0,settings:!0})}),require.whenReady("settings",function(){require.install("e2e",function(require,a,b){(function(b,undefined){function g(a,b,c){a=a||rec.dump();for(var d=0,e=a.length;d<e;++d)if(b.call(c,a[d],d)==="break")return}function h(a,b){return function(c){var d={},e={};return g(c,function(c){var f=c.tags,g=f[0],h=f[1],i=f[2];if(g==="window.performance"&&h==="loadEventEnd")return"break";g===a&&(!b||h===b)&&(i==="start"?d[h]=c.time:i==="finish"&&(e[h]=(e[h]||0)+c.time-d[h]))}),e}}function p(){m>=n&&(q(),m=0)}function q(){c.enabled&&c("e2e.gc","GC started.");var a=(new Date).getTime(),b=[];for(var d in l){var e=l[d];a-e.startTime>o&&(b.push(e),delete l[d])}c.enabled&&c("e2e.gc","Collected actions:",b)}function r(a){if(!a.mustReport)return;delete a.mustReport,e.instart_cchannel_setting&&(a.instart_cchannel_setting=!0),$.whenLoaded(500,function(){if(c.enabled){var b=a.endTime-a.startTime,e=a.serverTime/1e3;c("e2e.reportActionData","Metric:",b,"Server time:",e,"Details:",a)}d.rpc("/e2e/action_data_POST").args(a).send()},"e2e.reportActionData")}require("jquery.whenIdle");var c=require("log").log,d=require("webnode2"),e=require("settings"),f=require;a.SAMPLE_RATE=e.e2e_sample_rate;var i=h("package"),j=h("webnode2","onLoad"),k=h("loader","flushQueue");a.reportPageData=function(a,b){function m(){if(h&&h.timing){var a=h.timing;if(a.loadEventEnd===0){setTimeout(m,250);return}var b=l.win_perf.timing={};for(var n in a){var o=a[n];typeof o=="number"&&(b[n]=o)}}var p=rec.dump();l.win_perf.quora={packages:i(p),onLoads:j(p).onLoad,flushQueues:k(p).flushQueue,referrer:document.referrer};if(g._component_inspector_enabled){var q=f("w2.inspector");q.isRequestTimeSlowerThanStandard()&&(l.slow_load={platform:"desktop",user_agent:navigator.userAgent,path:location.pathname,controller:require("settings").controller,action:require("settings").action,window_id:g.window_id,page_time:g.page,request_time:g.request,load_time:h.timing.loadEventStart-h.timing.navigationStart})}e.stop(),$.whenIdle(100,function(){if(c.enabled){var a=l.win_perf.timing,b=a.loadEventStart-a.navigationStart,e=l.win_perf.server_time;c("e2e.reportPageData","Metric:",b,"Server time:",e,"Details:",l)}d.rpc("/e2e/page_data_POST").args(l).send()},"e2e.reportPageData"),g._component_inspector_enabled||(delete g.components,delete g._components)}if(a===null)return;if(!a.mustReport)return;delete a.mustReport;var e=require("w2.timing"),g=e.timing,h=window.performance,l=$.extend(a,{win_perf:{path:location.pathname,revision:require("settings").revision,controller:require("settings").controller,action:require("settings").action,server_time:g.server_time,window_id:g.window_id},w2_timing:g});h&&h.timing&&h.timing.responseStart&&(l.win_perf.timing=h.timing),m()};var l={},m=0,n=100,o=6e5;a.startAction=function(a){if(a===null||typeof a=="undefined")throw"This method expects an object describing the action.";return a.startTime=(new Date).getTime(),a.id=(a.startTime*1e3+Math.floor(Math.random()*1e3)).toString(36),l[a.id]=a,c.enabled&&c("e2e.startAction",a),m++,p(),a},a.startOrUpdateAction=function(b,c){return!b||!l[b]?a.startAction(c):a.updateAction(b,c)},a.getAction=function(a){return l[a]},a.updateAction=function(a,b){if(b===undefined)throw"This method expects an object describing the update.";var c=l[a];return c===undefined?null:$.extend(c,b)},a.finishAction=function(a,b){var d=l[a];return d===undefined?null:(b&&$.extend(d,b),d.endTime=(new Date).getTime(),delete l[a],c.enabled&&c("e2e.finishAction",d),r(d),d)}})(window)},{webnode2:!0,"w2.timing":!0,settings:!0,"jquery.whenIdle":!0,log:!0})}),require.whenReady("settings",function(){require.install("window_manager",function(require,a,b){a.catchRedirectCallback=null;var c=function(a){return/https?:\/\/[a-z.0-9_\.\-]*quora\.com/i.test(a)},d=a.getDomain=function(){return window.location.protocol+"//"+window.location.host+"/"};a.getPathName=function(){return decodeURI(window.location.pathname)};var e=a.getURL=function(){return decodeURI(window.location.href)},f=a.getHash=function(){return window.location.hash},g=a.replaceURL=function(a){window.history&&history.replaceState&&history.replaceState(history.state,null,a)};a.parseHashParams=function(a){var b=f(),c={};a=a||";";if(b.substr(0,1)=="#"){var d=b.substring(1).split(a);for(var e=0;e<d.length;e++){var g=d[e].split("=");c[g[0]]=g[1]}}return c},a.isInHash=function(a){var b=f();if(b.substr(0,1)=="#"){b=b.replace("%23","-");var c=b.substring(1).split("-");for(var d=0;d<c.length;d++)if(c[d]==a)return!0}return!1};var h=function(a){var b={},c=a.split("&");for(var d in c){var e=c[d],f=e.split("=");b[f[0]]=decodeURIComponent(f[1])}return b},i=a.parseURLParams=function(a){return a||(a=location.search.substring(1)),a.length===0?{}:h(a)};a.parseParams=function(a){var b={};if(a){var c=a.split("?");c.length==2&&(b=h(c[1]))}return b},a.isParamInURL=function(a,b){return b in i()},a.addParamToURL=function(a,b,c){var d=encodeURIComponent(b)+"="+encodeURIComponent(c);a.indexOf("?")==-1?d="?"+d:d="&"+d;var e=a.indexOf("#");return e==-1?a+d:a.substring(0,e)+d+a.substring(e)},a.getURLParam=function(a){return i()[a]};var j=a.makeURL=function(a,b,c,d){var e=[];if(c)for(var f in c)c.hasOwnProperty(f)&&c[f]!==null&&e.push(f+"="+encodeURIComponent(c[f]));var g=e.join("&"),h=a+b;return g.length>0&&(h+="?"+g),h+=d,h};a.updateURLParams=function(a){var b=i();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);var d=j(location.origin,location.pathname,b,location.hash);return g(d),d},a.removeURLParam=function(b){var c=i();return c[b]=null,a.updateURLParams(c)},a.getTitle=function(){return document.title},a.setTitle=function(a){document.title=a},a.reload=function(){window.location.reload()};var k=function(a){return a.indexOf("quora://")!==-1};a.handleClick=function(a,b){b.which==2||b.metaKey?window.open(a):l(a)},a.sameDomainURL=function(a){return a&&(a.charAt(0)=="/"||(new RegExp("^https?://"+window.location.hostname+"/","i")).test(d(a)))};var l=a.navigateTo=function(b){if(b==e()+"#")return;b.indexOf("/")===0&&(b=d()+b.substring(1));if(b===""||b==="#")return;if(!c(b)&&!k(b))window.open(b);else{var f=!0;a.catchRedirectCallback&&(f=a.catchRedirectCallback(b)),f&&(window.location=b)}};a.openCenteredPopupWindow=function(a,b,c){var d=window.screenX+window.innerWidth/2-b/2,e=window.screenY+window.innerHeight/2-c/2;window.open(a,"_blank","width="+b+",height="+c+",left="+d+",top="+e)},a.headerOffset=45,a.actionBarHeight=52,a.scrollContext=60,a.scrollAndFocus=function(b,c){b-=a.headerOffset,b=Math.max(0,Math.min($(document).height()-$(window).height(),b));var d=Math.min(500,Math.abs(b-$(document).scrollTop())*.5),e=!1;$("html,body").animate({scrollTop:b},d,"swing",function(){if(!e&&$(c).length){var a=window.scrollX,b=window.scrollY;$(c).focus(),window.scrollTo(a,b),e=!0}})},a.scrollIntoView=function(b){var c=$(b).offset().top,d=c-$(document).scrollTop();(d<a.headerOffset||d>$(window).height())&&a.scrollAndFocus(c)}},{})}),require.whenReady("settings",function(){require.install("w2.rpc",function(require,a,b){(function(){var a=require("webnode2"),b=require("w2.errors"),c=require("w2.perf"),d=require("settings"),e=d.formkey,f=d.postkey,g=require("w2.timing"),h=require("e2e"),i=0,j=require("spin"),k=require("scribe"),l=require("assert").ok;require("jquery.ajax"),a.postPerfInfoCallback=null,a.atLeastOneServerCallIsSent=!1,a.RPC=$.Ajax.extend({__init__:function(c){this._super(a.RPC.defaults),this.options(c),this.__data={args:[],kwargs:{}},this.__success=null,this.beforeComplete(this.fnbind(this._implicitCompleteHandler)),this.beforeError(this.fnbind(this._implicitErrorHandler)),this.error(this.fnbind(this._defaultErrorHandler)),this.__exceptionPatterns={state_expired:function(a){require("w2.livenode").reportPageNeedsReload("state_expired")}},this.__exceptionCatchAll=null,this.__liveMutation=!1,this.__contentFor=!1,this.__persistMutation=!1,this.__creationTime=(new Date).getTime(),this.__isRelatedToUserAction=b.canBeRelatedToUserAction(),this.__reportError=!0},name:function(a){return a===undefined?this.__name:(this.__name=a,this)},relatedToUserAction:function(a){return this.__isRelatedToUserAction=a,this},reportError:function(a){return this.__reportError=a,this},persistMutation:function(){return this.__persistMutation=!0,this},finishMutation:function(){if(this.__persistMutation){if(this.__persistMutationInfo){var a=this.__persistMutationInfo.transactionId;require("w2.livenode").mutationDoneAfterVersion(a,0)}this.__persistMutation=!1}},discardMutation:function(){if(this.__liveMutation){if(this.__liveMutationInfo){var a=this.__liveMutationInfo.transactionId;a&&require("w2.livenode").mutationDoneAfterVersion(a,0)}this.__liveMutation=!1}this.finishMutation()},liveMutate:function(){return this.__liveMutation=!0,this},contentFor:function(a,b,c){a.jquery&&(a=a.get(0)),this.__contentFor=!0;var d=$.extend(b,{domNode:a});!d.useLoadingSpinner&&d.useLoadingSpinner!==!1&&(d.useLoadingSpinner=!0);if(!d.parentCID)throw new Error("must explicitly specify parentCID.");return d.domNode=a,d.dont_check_for_live_parent=c,this.__contentForOpts=d,this},_send:function(){return this.__liveMutation&&(this.__liveMutationInfo=require("w2.livenode").startMutation()),this.__contentFor&&this._contentForStartLoading(),this.__persistMutation&&(this.__persistMutationInfo=require("w2.livenode").startMutation()),this.__startTime=g.getTime(),this.name()===undefined&&this.name(this.__options.url),this._super()},send:function(a){var b=a&&a.batched;if(!require("gating").batched_server_calls||!b)return this._super();require("rpc_manager").enqueueRequest(this)},_contentForStartLoading:function(){this.__contentForOpts.useLoadingSpinner&&(this.__contentForLoadingTimeout=setTimeout(this.fnbind(function(){$(this.__contentForOpts.domNode).forgetContents();var a=$("<div class='__contentfor_loading_spinner'/>");$(this.__contentForOpts.domNode).append(a),this.spinner=j.createSpinnerElement(),a.append(this.spinner.el)}),150))},_contentForDoneLoading:function(){this.spinner&&(this.spinner.stop(),this.spinner=null),clearTimeout(this.__contentForLoadingTimeout)},_implicitCompleteHandler:function(a,b){g.logRequestTime(this.name(),this.__startTime)},_implicitErrorHandler:function(a,c,d){this.discardMutation(),this.__reportError&&b.reportAjaxError(a,c,d,this.__isRelatedToUserAction,this.__creationTime)},_defaultErrorHandler:function(){this.discardMutation();var a="Unhandled error response from server: "+JSON.stringify(arguments),b=this.name();b===undefined&&(b=this.__options.url),a+="; Function name: "+b,this._throwError(a)},except:function(a,b){switch(arguments.length){case 1:this.__exceptionCatchAll=a;break;case 2:typeof a=="string"?this.__exceptionPatterns[a]=b:$.each(a,this.fnbind(function(a,c){this.__exceptionPatterns[c]=b}));break;default:this._throwError("The except method takes either (<pattern>, <callback>) or (<default-callback>) as arguments.")}return this},args:function(){var a=[],b;for(b=0;b<arguments.length;b++)a.push(arguments[b]);return this.__data.args=a,this},xargs:function(a){return this.__data.args=a,this},kwargs:function(a){return this.__data.kwargs=a,this},data:function(){throw new Error("Don't use the .data() method with RPC; use .kwargs() or .args() instead.")},_data:function(){if(!e)throw new Error("require('settings').formkey not set -- can't send request securely.");if(!f)throw new Error("require('settings').postkey not set -- can't send request securely.");!a.windowId&&d.serverCallUrl.indexOf(this.__name)===0&&console&&console.warn&&console.warn("No W2.windowId set; any content coming back from the server may not be live updated correctly");var b;try{b=JSON.stringify(this.__data)}catch(c){console.log("W2.RPC Error: Can't encode an object with circular references",c,this.__data),l(!1),b=JSON.stringify({error:"Can't encode an object with circular references"})}var g={json:b,formkey:e,postkey:f,window_id:a.windowId,referring_controller:d.controller,referring_action:d.action};this.__liveMutation&&$.extend(g,this.__liveMutationInfo.data);if(this.__contentFor){g.parent_cid=this.__contentForOpts.parentCID,g.parent_domid=a.getLiveParent(g.parent_cid);var h=this.__contentForOpts.domNode,i=a.getLiveChildren(g.parent_cid),j=i.filter(function(a){return h.contains(document.getElementById(a))});!this.__contentForOpts.dont_check_for_live_parent&&!a.getLiveDomId(g.parent_cid)&&(g.non_live_parent=!0),g.domids_to_remove=JSON.stringify(j)}return g},success:function(a){return this.__success=a,this},_successWrapper:function(b){this.finishMutation(),b.pmsg&&(a.pmsgContainer?a.pmsgContainer.setContent(b.pmsg,!0):console&&console.warn&&console.warn("Received a piggybacking pmsg but there's no pmsgContainer present on this page; dropping the pmsg.")),this.__contentFor&&this._contentForDoneLoading(),this.__actionId&&c.finishPOST(this.__actionId);if(b.exception)return this._handleException(b);this.__contentFor&&(this.__contentForOpts.parentCID in a._unloaded&&($.serverLog("component_content: parent component already unloaded."),k.log({category:"component_content2",http_referer:require("window_manager").getDomain(),url:this._url(),window_id:a.windowId,parent_cid:this.__contentForOpts.parentCID,cid:this._component.cid,vcon:JSON.stringify(this.__vcon),method:this.__vcon_method,msg:"parent component already unloaded"})),$(this.__contentForOpts.domNode).forgetContents(),$(this.__contentForOpts.domNode).removeEditors().setContent(b.value),$(document).trigger("rpc_content_for_done",{opts:this.__contentForOpts,value:b.value}));var d;return typeof this.__success=="function"&&(d=this.__success(b.value)),this.__liveMutation&&require("settings").pageMode=="post_reload"?i>0?i-=1:require("window_manager").reload():b.post_perf_html&&a.postPerfInfoCallback&&a.postPerfInfoCallback(b.post_perf_html),d},disableNextPostReload:function(){return++i,this},_success:function(a){return this.fnbind(this._successWrapper)},_throwError:function(a){throw console&&console.error&&console.error(a),new Error(a)},_handleException:function(a){this.discardMutation();var b=this.__exceptionPatterns[a.exception.type],c=!0;b?c=this._invokeExceptionCallback(b,a):this.__exceptionCatchAll&&(c=this._invokeExceptionCallback(this.__exceptionCatchAll,a));if(c){var d={response:a,rpc:this};$(document).trigger("w2rpcexception-"+a.exception.type,d),$(document).trigger("w2rpcexception",d)}},_invokeExceptionCallback:function(a,b){return a(b.exception,b,this)}}),a.RPC.defaults={type:"POST",dataType:"json"},a.rpc=function(b){return(new a.RPC).url(b)},a._Controller=a.RPC.extend({__init__:function(a,b){this._super(),this.__vcon=a,this.__vcon_method=b,this.__first_server_call=!1;var c=require("settings").serverCallUrl;if(!c)throw new Error("require('settings').serverCallUrl not set");this.url(c)},_data:function(){var a=this._super();if(!this.__vcon)throw new Error("vcon not set; can't call a view controller.");a.__vcon_json=JSON.stringify(this.__vcon),a.__vcon_method=this.__vcon_method;var b=h.startOrUpdateAction(a.__e2e_action_id,{url:this.__options.url,vcon:this.__vcon,method:this.__vcon_method,args:a.args,kwargs:a.kwargs});a.__e2e_action_id=b.id;var d=c.startPOST({vcon:this.__vcon,method:this.__vcon_method,id:a.__e2e_action_id});return this.__actionId=a.__e2e_action_id,this.__first_server_call&&(a.__first_server_call=!0),a},_send:function(){return a.atLeastOneServerCallIsSent||(this.__first_server_call=!0,a.atLeastOneServerCallIsSent=!0),this.name()===undefined&&this.name(this.__vcon+"."+this.__vcon_method),this._super()}}),a._ServerCall=a._Controller.extend({__init__:function(a,b,c){this._super(a,b),this._component=c,this._makeOnlyOnce=!1,this._sendJSInitArgs=!0},dontSendJSInitArgs:function(a){return a===!1?this._sendJSInitArgs=!0:this._sendJSInitArgs=!1,this},_data:function(){var a=this._super();return this._sendJSInitArgs&&(a.js_init=JSON.stringify(this._component.__js_init)),a},onlyOnce:function(){return this._component.activeServerCalls||(this._component.activeServerCalls={}),this._onlyOnce=!0,this},_send:function(){if(this._onlyOnce){if(this._isSimilarServerCallActive())return this;this._component.activeServerCalls[this.__vcon_method]=1}return this._super.apply(this,arguments)},sendOnlyOnce:function(){return this.onlyOnce(),this.send()},_implicitCompleteHandler:function(a,b){return this._onlyOnce&&this._markServerCallInactive(),this._super.apply(this,arguments)},_isSimilarServerCallActive:function(){return this._component.activeServerCalls?this.__vcon_method in this._component.activeServerCalls:!1},_markServerCallInactive:function(){this._isSimilarServerCallActive()&&delete this._component.activeServerCalls[this.__vcon_method]}}),a.fallbackToPostReloadMode=function(){require("settings").pageMode="post_reload"}})()},{"w2.timing":!0,window_manager:!0,settings:!0,webnode2:!0,scribe:!0,"w2.livenode":!0,rpc_manager:!0,assert:!0,"w2.perf":!0,e2e:!0,gating:!0,"jquery.ajax":!0,spin:!0,"w2.errors":!0})}),require.whenReady("settings",function(
){require.install("w2.livenode",function(require,a,b){function o(a,b,c){if(b in a&&!(c in a))return a[c]=a[b],delete a[b],!0}function p(a){var b={},c;return $("#"+a+" [w2cid]").each(function(a,d){c=d.getAttribute("w2cid"),b[c]=d}),b}function q(a,b){var c=$("#"+a)[0],d=b;while(d&&d.parentNode!==c)d=d.parentNode;for(var e=0;e<c.childNodes.length;e++)if(c.childNodes[e]===d)return e}function r(a){var b={};return $.each(a,function(a,c){if(c.domid in b)return;var d=p(c.domid);b[c.domid]=d}),b}function s(a){var b=c.interactionMode._changedComponents[a];return b&&b!=c.interactionMode._states.OFF}function t(a){var b={};for(var c in a){var d=a[c];for(var e in d)s(e)&&(b[c]||(b[c]={}),b[c][e]=d[e])}return b}function u(a,b){var c=t(b);for(var d=0;d<a.length;d++){var e=a[d],f=c[e.domid];if(!f)continue;if(e.type==="set_node")return!1}return!0}function v(a,b,d){var e=r(a);if(!b&&u(a,e))return!0;try{$.each(a,function(a,c){o(c,"ty","type"),o(c,"animation","transition")&&o(c.transition,"ty","type"),o(c,"parentCid","parent_cid"),o(c,"childCid","child_cid"),o(c,"childDomid","child_domid");var d,f=e[c.domid];$.each(f,function(a,d){if(s(a)){if(!b)throw console.log("throwing blocking_interaction_mode cid="+a+" on optype = "+c.type),console.log("affected node:"),console.log(f[a]),"blocking_interaction_mode";console.log("forcing override on live update conflict with cid="+a+" on optype = "+c.type)}})})}catch(f){if(typeof f=="string"&&f=="blocking_interaction_mode")return console.log("Calling startBlocking from checkForConflicts"),c.interactionMode.startBlocking(),k.interactionDelayedLivedepOperations.push({data:a,textStatus:d}),!1;throw f}return!0}function x(a,b,c){$.serverLog("on check livedep error: "+a+" / status: "+b+" / error: "+c),l<32e3?(j=setTimeout(y,l),l*=2):(clearTimeout(j),j=null,I("failed to sync livedeps"))}function y(){j&&(clearTimeout(j),j=null);var a=require("webnode2");(new $.Ajax).url(window.location.protocol+"//"+location.hostname+"/check_livedeps/index?window_id="+a.windowId+"&random="+Math.random()).type("GET").error(x).send()}function z(a){k.lazyComplete=a}function A(){return k.lazyComplete}function C(){var a=require("webnode2");a.interactionMode.resumeUpdates();var b=Math.random(),c={};return c._lm_transaction_id=b,c._lm_window_id=a.windowId,B[b]=1,F(),{transactionId:b,data:c}}function D(a,b){delete B[a],k.requiredVersion=Math.max(b,k.requiredVersion),F()}function E(a){k.currentVersion=a,H()}function F(){var a=0,b;for(b in B)a++;k.pendingMutationCount=a,H()}function G(){require("tchannel_up").stop()}function H(){window.log&&d.enabled&&d("w2.livenode.checkLoadingStatus","Pending mutation count:",k.pendingMutationCount,", current version",k.currentVersion,", required version",k.requiredVersion);var a=require("webnode2");k.pendingMutationCount>0||k.currentVersion<k.requiredVersion?a.Loading.show():a.Loading&&a.Loading.hide()}function I(a){n=!0,console.log("Page requires reload "+a),m||($.serverLog("reportPageNeedsReload: "+a),m=!0);if(!g.uid)return;var b=require("webnode2");b.Error&&b.Error.hide(),b.fallbackToPostReloadMode(a),b.interactionMode.$("#@message").html("<a href='javascript:window.location.reload();'>"+i.please_refresh+"</a>"),console.log("Calling startBlocking from reportPageNeedsReload"),b.interactionMode.startBlocking()}function J(){require("webnode2").Error.hide()}function K(){n=!0,require("webnode2").Error.show(i.trying_to_regain)}window.console||(window.console={}),window.console.log||(window.console.log=function(){}),require("jquery"),require("jquery.quora");var c=require("webnode2"),d=require("log").log,e=require("spin"),f=require("browser").browser,g=require("settings"),h=require("assert").ok,i=g.interface_strings,j=null,k={interactionDelayedLivedepOperations:[],pendingMutationCount:0,currentVersion:0,requiredVersion:0,lazyComplete:!1},l=1e3,m=!1,n=!1,w=require("atexit").hook(function(a,b,e){e=e||!1;if(a=="error"){console.log("LiveNode error"),I("error_response2");return}if(!c.interactionMode||c.interactionMode.isBlocking())return k.interactionDelayedLivedepOperations.push({data:a,textStatus:b}),!1;if(!v(a,e,b))return!1;var g=!f.msie&&$(window).scrollTop()>0;g&&$("div.feed_item_inner:in-viewport").anchor(),$.each(a,function(a,b){var e,f,i;window.log&&d.enabled&&d("w2.livenode.onLivedepOperations","Applying",b),$(document).trigger("livenode_op_start",b);switch(b.type){case"set_node":if(b.domid in c._ignoreDomids)break;var j=$("#"+b.domid);if(!j.length){I("set_node_missing, op.domid = "+b.domid+", op.cid = "+b.cid);return}var k=b.transition;i=c.getComponentFromElement(j.get(0)),i&&i.force_transition&&(k=i.force_transition),h("cid"in b),c.unloadComponent(b.cid),j.setContent(b.content);switch(k.type){case"none":break;case"fade_in":j.effect("fade",{},2e3);break;case"highlight":j.effect("highlight",{},2e3);break;default:}break;case"insert_node":if(b.domid in c._ignoreDomids)break;e=document.getElementById(b.domid);if(!e){I("insert_node_missing, op.domid = "+b.domid+", op.parent_cid = "+b.parent_cid);return}var l=document.createElement("DIV");c.setContentHTML(l,b.content);if(l.childNodes.length!=1){console.log("error: append must give a single node"),I("append");return}var m=l.childNodes[0],n=m.id;m.style.display="none",e.childNodes.length==b.position?e.appendChild(m):e.insertBefore(m,e.childNodes[b.position]),c.setContentJS(m,b.content),f=c._components[b.parent_cid],f&&f.onInsertNode(b,n);if(b.transition.type=="none")break;if(b.transition.type=="scroll"){m.style.display="",m.scrollIntoView(!1);break}if(g||b.transition.type=="fade_in"){$("#"+n).fadeIn(500);break}m.style.display="none",$("#"+n).fadeIn(1e3);break;case"delete_node":if(b.domid in c._ignoreDomids)break;e=document.getElementById(b.domid);if(!e){I("delete_node_missing, op.domid = "+b.domid+", op.parent_cid = "+b.parent_cid);return}if(!c._parents[b.parent_cid]){I("delete_node_missing_component "+b.parent_cid);return}var o=e.childNodes[b.position];if(o.id!=b.child_domid){I("delete_node_wrong_child, node.id = "+o.id+", op.child_domid = "+b.child_domid);return}f=c._components[b.parent_cid],f&&f.onDeleteNode(b,o.id),c.unloadComponent(b.child_cid),$("#"+o.id).removeEditors().remove();break;case"update_data":if(b.cid in c._ignoreCids)break;if(!c._parents[b.cid]){I("update_data_missing_component, op.cid = "+b.cid+", op.parent_cid = "+b.parent_cid);return}i=c._components[b.cid],i&&i.onUpdate(b.data);break;case"error":console.log("livedep error: "+b.error),I("error_response");return;default:console.log("bad op type: "+b.type),I("bad_type")}}),$(document).trigger("livenode_finish_operations")}),B={};a.isConnectionLostLogged=function(){return n};var c=require("webnode2"),L=c.Component;a.LiveSpinner=L.extend({init:function(){this._super.apply(this,arguments),c.Loading=this,this.t=null,this.showing=!1,this.setDefaultSpinnerColor()},setSpinnerColor:function(a){this._spinnerColor=a},setDefaultSpinnerColor:function(){this.setSpinnerColor("#fff")},addCSSToWrapper:function(a){this.$("#@loading").addClass(a)},removeCSSFromWrapper:function(a){this.$("#@loading").removeClass(a)},show:function(){if(this.showing)return;this.showing=!0;var a=this.fnbind(function(){this.spinner||(this.spinner=e.createSpinnerElement({color:this._spinnerColor}),this.$("#@spinner").append(this.spinner.el)),this.$("#@loading").removeClass("fade_out").removeClass("hidden")});this.t=setTimeout(a,250)},hide:function(){if(!this.showing)return;this.showing=!1,clearTimeout(this.t),this.t=null,this.$("#@loading").addClass("fade_out"),setTimeout(this.fnbind(function(){this.$("#@loading").hasClass("fade_out")&&(this.$("#@loading").removeClass("fade_out").addClass("hidden"),this.spinner&&(this.spinner.stop(),this.spinner=null))}),150)}}),a.LoadingBanner=L.extend({init:function(){this._super.apply(this,arguments),c.Loading=this,this.t=null,this.showing=!1},show:function(){if(this.showing)return;this.showing=!0;var a=this.fnbind(function(){var a=$(".main_content").first();if(a.length===0)return;var b=a.offset().left;this.$("#@loading").css("left",b+"px").show()});this.t=setTimeout(a,750)},hide:function(){if(!this.showing)return;this.showing=!1,clearTimeout(this.t),this.t=null,this.$("#@loading").hide()}}),a.ErrorBanner=L.extend({init:function(){this._super.apply(this,arguments),require("webnode2").Error=this,this.shown=!1,this.$("#@hide").click(this.fnbind(function(){return this.hide(),!1}))},show:function(a){a=a||this.default_text,this.$("#@text").text(a);if(this.shown)return;this.shown=!0,$(document).trigger("bannerShown"),this.$("#@banner").show().addClass("fade_in"),M()},hide:function(){if(!this.shown)return;this.shown=!1,$(document).trigger("bannerHidden");var a=this;a.$("#@banner").removeClass("fade_in").addClass("fade_out"),setTimeout(function(){a.$("#@banner").hide()},150),N()}});var M=function(){$(".ContentWrapper").addClass("extra_padding"),$(".NotifHeaderBar").addClass("extra_padding")},N=function(){$(".ContentWrapper").removeClass("extra_padding"),$(".NotifHeaderBar").removeClass("extra_padding")};$.fn.aboveViewport=function(a){return $(window).scrollTop()>=this.offset().top+this.height()-(a||0)},a.syncLivedeps=y,a.startMutation=C,a.onLivedepOperations=w,a.reportPageNeedsReload=I,a.reportPageRegainedConnection=J,a.reportPageLostConnection=K,a.setCurrentVersion=E,a.mutationDoneAfterVersion=D,a.checkLazyComplete=A,a.setLazyComplete=z,a.stopLiveUpdates=G,a.addContentPadding=M,a.removeContentPadding=N,a.state=k},{jquery:!0,tchannel_up:!0,log:!0,settings:!0,webnode2:!0,assert:!0,atexit:!0,spin:!0,"jquery.quora":!0,browser:!0})}),require.whenReady("settings",function(){require.install("w2.event",function(require,a,b){function d(a){this.owner=a===null?this:a,this.handers=[],this.onceHanders=[]}var c=require("webnode2");c.Event=d,d.prototype.bind=function(a){this.handers.push(a)},d.prototype.bindOnce=function(a){this.onceHanders.push(a)},d.prototype.unbind=function(a){var b=this.handlers.indexOf(a);b>=0&&this.handlers.splice(b,1)},d.prototype.trigger=function(){var a=Array.prototype.slice.call(arguments),b=this.onceHanders.concat(this.handers);this.onceHanders=[];for(var c in b)b[c].apply(this.owner,a)}},{webnode2:!0})}),require.whenReady("settings",function(){require.install("w2.quora",function(require,a,b){require("w2.dialog"),require("jquery.quora"),require("w2.modal");var c=require("webnode2"),d=c.Dialog.extend(),e=c.ModalWithCallBacks;a.Component=c.Component.extend({dialog:function(a){return new d(this,a)},modal:function(a,b){var c=new e(this,b||{});return c.load(a),c},setDvar:function(a,b){this.__dvars__===undefined&&(this.__dvars__={}),this.__dvars__[a]=b},getDvar:function(a){if(this.__dvars__!==undefined&&this.__dvars__[a]!==undefined)return this.__dvars__[a];var b=this.cid;while(b){b=c._parents[b];var d=c._components[b];if(d&&d.getDvar)return d.getDvar(a)}return null}}),require("errors").setCallback(function(a){$.serverLog((a.message||"").slice(0,1e3),"ERROR",a.stack||null,!1)})},{"w2.modal":!0,webnode2:!0,errors:!0,"jquery.quora":!0,"w2.dialog":!0})}),require.whenReady("settings",function(){require.install("init",function(require,a,b){function e(){var a=require("visibility").getFrameElement();if(a&&a.getAttribute("autoresize")==="true"){var b=$(document),c=b.width(),d=b.height();$(a).width(c).height(d)}}(function(){var a="1.02"})(),require("frame_busting").check();var c=require("event").add,d=require("log").log;window.console=window.console||d.console,c(window,"resize",e),$(document).ready(e)},{frame_busting:!0,event:!0,visibility:!0,log:!0})}),require.whenReady("settings",function(){require.install("facebook",function(require,a,b){function j(a){a===undefined&&(a=0);var b=function(){if(!i){i=!0;var a=document,b=a.createElement("div"),c=a.createElement("script");b.setAttribute("id","fb-root"),c.async=!0,c.src="//connect.facebook.net/en_US/all.js",b.appendChild(c),a.body.appendChild(b)}};$.whenIdle(a,b,"facebook.requestAllJs")}function k(a,b){for(var c=0;c<a.length;c++)if(a[c].permission==b)return a[c].status=="granted";return!1}function m(a){f?a():(j(350),$(g).bind("initialized",a))}function n(a){m(function(){FB.getLoginStatus(function(b){a(b)})})}function o(a){(h===null||a)&&n(function(a){a.status=="connected"&&p()})}function p(a){FB.api("/me/permissions",function(b){b.data&&b.data.length>0?(h=b.data,a&&a(!0,h)):(h=null,a&&a(!1))})}function q(a){return h&&h[a]==1}function r(a,b){for(var c=0;c<a.length;++c)if(!b(a[c]))return!1;return!0}function s(a,b,c){if(!f)return o(),!1;var d=null;return FB.getAuthResponse()&&(d=FB.getAuthResponse().userID),d&&a?d==a?q("publish_stream")?b():t(a,b):c(d):t(a,b,c),!1}function t(a,b,c){FB.login(function(d){if(d.status=="connected"){var e=d.authResponse;!a||e.userID==a?b(e.userID,e.accessToken,e.expiresIn):c(e.userID)}},{scope:"publish_stream"})}function w(a,b,c){m(function(){FB.ui({method:"apprequests",message:a,to:b.join(",")},c)})}function x(a,b){m(function(){FB.ui({method:"apprequests",message:a},b)})}function y(a,b){m(function(){FB.api(a,"delete",b)})}function z(a,b){m(function(){a.method="send",FB.ui(a,b)})}require("jquery.whenIdle");var c=require("settings"),d=require("w2.quora").Component,e=require("cookies"),f=!1,g={},h=null;window.loginInProgress=!1,window.fbAsyncInit=function(){var a=require("settings").fbAppId;FB.init({appId:a,oauth:!0,version:"v2.1"}),FB.getLoginStatus(function(b){f=!!a,$(g).trigger("initialized")})};var i=!1;a.hasSpecificPermission=k;var l=d.extend({init:function(){this._super.apply(this,arguments),j(350)}});a.isInitialized=function(){return f},a.onInit=m,a.getLoginStatus=n,a.getAuthResponse=function(){return f?FB.getAuthResponse():null},a.getAccessToken=function(){var b=a.getAuthResponse();return b?b.accessToken:null},a.getExpiresIn=function(){var b=a.getAuthResponse();return b?b.expiresIn:null},a.getFbUid=function(){var b=a.getAuthResponse();return b?b.userID:null},a.FacebookAccessTokenRefresher=d.extend({onLoad:function(){var a=this;n(function(b){if(b.status=="connected"){if(window.loginInProgress===!0)return;window.loginInProgress=!0;var c=b.authResponse;a.serverCall("update_access_token").kwargs({fb_uid:c.userID,access_token:c.accessToken,expires:c.expiresIn}).success(function(a){a&&require("settings").pageMode=="post_reload"&&require("window_manager").reload(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).except(function(){window.loginInProgress=!1}).send()}})}}),a.asyncUpdatePermissions=o,a.updatePermissions=p,a.hasPermission=q,a.requestPermissions=function(a,b){r(a.split(","),q)?b(!0):FB.login(function(c){c.status==="connected"?p(function(c,d){b(c&&r(a.split(","),q))}):b(!1)},{scope:a})},a.FacebookConnectedToDifferentAccount=l.extend({show:function(){FB.api("/me",this.fnbind(function(a){a.name&&(this.$("#@fb_unknown_login").hide(),this.$("#@fb_logged_in_name").text(a.name),this.$("#@fb_logged_in_link").show(),this.$("#@fb_logged_in_link").attr("href",a.link))})),this.$("#@fb_different_account").show()},events:{"click #@fb_logout":"onClickFbLogout","click #@settings":"onClickSettings"},onClickFbLogout:function(){return FB.logout(this.fnbind(function(a){this.$("#@fb_different_account").hide(),this.trigger("hide")})),!1},onClickSettings:function(){this.trigger("hide"),this.$("#@fb_different_account").hide()}}),a.maybePromptToPublish=s,a._disconnect=function(){FB.getLoginStatus(function(a){a.authReponse?FB.api({method:"auth.revokeAuthorization"},function(a){a?console.log("Successfully disconnected"):console.error("Disconnection failed")},console.error):console.warn("Already not connected")})},a.FacebookNetworkShare=l.extend({events:{"click #@share":"onClick"},onClick:function(){var a=this;return a.is_debugging_mode&&(console.log(a.share_url),console.log(a.target)),FB.ui({method:"share",display:"popup",href:a.share_url},function(b){b.error_code||(e.setQfeedLog(a,"ShareFacebook"),e.setTlog({type:"ShareFacebook"}),a.serverCall("record_facebook_share").send())}),!1}});var u=a.FacebookConnectButtonBase=l.extend({connect:function(){FB.login(this.fnbind(function(a){a&&a.status=="connected"?(this.onLogin(a.authResponse),this.trigger("fb_login",a.authResponse)):(this.onLoginFailed(),this.trigger("fb_login_failed"))}),{scope:this.perms})},onClick:function(){},onLogin:function(a){},onLoginFailed:function(){},events:{"click #@facebook_connect_button":"onClickFacebookConnectButton"},onClickFacebookConnectButton:function(){return f&&(this.connect(),this.onClick(),this.trigger("click")),!1}});a.FacebookConnectButton=u.extend({onLogin:function(a){this._onLogin(a)},_onLogin:function(a){var b=a.accessToken,c=this.serverCall("connect_facebook").kwargs({fb_access_token:a.accessToken,fb_uid:a.userID,expires:a.expiresIn}).success(this.fnbind(function(){this.trigger("fb_connected")}));this.live_mutate?c.liveMutate().send():c.send()}}),a.FacebookConnectAddToTimelineButton=a.FacebookConnectButton.extend({onLogin:function(a){p(this.fnbind(function(b,c){b&&k(c,"publish_actions")?this._onLogin(a):this.onLoginFailed()}))}}),a.FacebookAccountConnectedTo=l.extend({events:{"click #@facebook_disconnect_button":"onClickFacebookDisconnectButton"},onClickFacebookDisconnectButton:function(){return this.serverCall("disconnect_facebook").liveMutate().success(function(){FB.getLoginStatus(function(){},!0)}).send(),!1}}),a.FacebookOptionLink=l.extend({onLoad:function(){this.bindOptionEnable(),this.bindOptionDisable(),this.bindHideClick()},bindOptionEnable:function(){},bindOptionDisable:function(){},bindHideClick:function(){},events:{"click #@enable":"onClickEnable","click #@disable":"onClickDisable","click #@hide":"onClickHide"},onClickEnable:function(){return this.serverCall("toggle_option").kwargs({enabled:!0}).liveMutate().send(),!1},onClickDisable:function(){return this.serverCall("toggle_option").kwargs({enabled:!1}).liveMutate().send(),!1},onClickHide:function(){return this.serverCall("hide").liveMutate().send(),!1}}),a.FacebookToggleTimelineLink=l.extend({onEnable:function(a){this.serverCall("enable_timeline").kwargs({fb_access_token:a.accessToken,fb_uid:a.userID,expires:a.expiresIn}).liveMutate().send()},onDisable:function(){this.serverCall("disable_timeline").liveMutate().send()},onLoginFailed:function(){this.$("#@option").attr("checked",!1)},events:{"click #@enable":"onClickEnable","click #@disable":"onClickDisable"},onClickEnable:function(){return FB.login(this.fnbind(function(a){if(a&&a.status=="connected"){var b=a.authResponse;this.trigger("fb_login",a.authResponse),p(this.fnbind(function(a,c){a&&k(c,"publish_actions")?this.onEnable(b):this.onLoginFailed()}))}else this.onLoginFailed(),this.trigger("fb_login_failed")}),{scope:"publish_actions"}),!1},onClickDisable:function(){return this.onDisable(),!1}});var v=a.SignupFacebookConnectButtonBase=u.extend({onClick:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_facebook"}).send()},onLogin:function(a){this.serverCall("on_facebook_connected").kwargs({fb_uid:a.userID,access_token:a.accessToken,expires:a.expiresIn}).send(),this._onLogin(a)},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_connect_failed"}).send()},_onLogin:function(a){}});a.SignupFacebookConnectButton=a.SignupFacebookConnectButtonBase.extend({_onLogin:function(a){this.queryFacebookProfile(a)},queryFacebookProfile:function(a){FB.api({method:"fql.query",query:"SELECT name, pic_big, contact_email FROM user WHERE uid = "+a.userID},this.fnbind(function(b){this.trigger("fb_connected",a,b),b&&b[0]&&this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_connected"}).send()}))}}),a.SignupFacebookConnectButtonWithoutLoginHandler=a.SignupFacebookConnectButtonBase,a.SignupFacebookConnectButtonLoggedinWall=v.extend({onClick:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_facebook"}).send(),this.serverCall("fb_connect_click").send()}}),a.InviteViaFacebookMessageButton=l.extend({onLoad:function(){this.auto_click&&this.$("#@invite_button").click()},invite:function(){var b=a.getFbUid();this.from_fb_uid!=b&&b?this.serverCall("facebook_connected_to_different_account").send():this.sendMessage()},sendMessage:function(){var a={to:this.to_fb_uid,link:this.link_url,name:this.link_title,description:this.description,picture:this.picture,display:"popup"};z(a,this.fnbind(function(a){a&&!("error_code"in a)&&this.serverCall("record_facebook_invite_message").kwargs({uid:this.uid,to_fb_uid:this.to_fb_uid,code:this.code,location:this.location}).send()}))},events:{"click #@invite_button":"onClickInviteButton"},onClickInviteButton:function(){return this.serverCall("record_facebook_invite_click").kwargs({uid:this.uid,to_fb_uid:this.to_fb_uid,code:this.code,location:this.location}).send(),this.invite(),!1}}),require("win.load").add(function(){$(document).bind("fire_facebook_conversion_pixel",function(a,b){var c=new Image(1,1);c.src="https://www.facebook.com/offsite_event.php?id="+b+"&amp;value=0.01&amp;currency=USD"})})},{cookies:!0,window_manager:!0,settings:!0,"jquery.whenIdle":!0,"win.load":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("oauth",function(require,a,b){a.generateOAuthConnectFunction=function(b,c,d,e){return d=d||400,e=e||800,function(a,f){var g=null;$(document).one(b+"."+Math.random(),function(b,c){var d=c.accessToken,e=c.userData;g&&(clearInterval(g),g=null),a(d,e)});var h=screen.width/2-e/2,i=screen.height/2-d/2,j="width="+e+", height="+d+"location=no,toolbar=no,status=no,top="+i+",left="+h,k=window.open(c,"_BLANK",j);f&&(g=setInterval(function(){g&&k.closed&&(clearInterval(g),f())},200))}}},{})}),require.whenReady("settings",function(){require.install("twitter",function(require,a,b){function h(a){f?a():$(g).bind("initialized",a)}var c=require("w2.quora").Component,d=require("oauth").generateOAuthConnectFunction,e=require("cookies"),f=!1,g={};a.asyncInit=function(){require("win.load").add(function(){if(window.twttr)return;var a=document.createElement("script"),b={_e:[],ready:function(a){b._e.push(a)}};window.twttr=b,a.async=!0,a.src="//platform.twitter.com/widgets.js",document.getElementById("tw-root").appendChild(a),window.twttr.ready(function(a){f=!0,$(g).trigger("initialized")})})};var i=d("twitter_oauth_approved","/twitter/oauth_window",400,800);a.connectToTwitter=i;var j=a.TwitterConnectButton=c.extend({oauthWindowOpen:!1,loginInterval:null,connect:function(){var a=this;if(a.oauthWindowOpen)return;a.oauthWindowOpen=!0,typeof localStorage!="undefined"&&(this.loginInterval=setInterval(function(){var b=localStorage.getItem("twloginresult");b!==null&&(b=JSON.parse(b),clearInterval(a.loginInterval),localStorage.removeItem("twloginresult"),a.oauthWindowOpen=!1,a.onLogin(b.accessToken,b.userData),a.trigger("tw_login",b.accessToken,b.userData))},300)),i(function(b,c){a.oauthWindowOpen=!1,clearInterval(a.loginInterval),a.onLogin(b,c),a.trigger("tw_login",b,c)},function(){a.oauthWindowOpen=!1,clearInterval(a.loginInterval),a.onLoginFailed(),a.trigger("tw_login_failed")})},onLogin:function(a,b){},onLoginFailed:function(){}});a.SignupTwitterConnectButton=j.extend({events:{"click #@twitter_connect_button":"onClick"},onClick:function(){return this.connect(),this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_twitter"}).send(),!1},onLogin:function(a,b){this.serverCall("on_twitter_connected").kwargs({tw_uid:b.twitter_uid,access_token:a.key,screen_name:b.twitter_screen_name,"protected":b["protected"]}).send()},onLoginFailed:function(){this.serverCall("record_signup_step").kwargs({signup_action:"signup_twitter_connect_failed"}).send()}});var k=a.TwitterEventComponent=c.extend({isTweeted:function(a){var b=this,c=String(a.target.id),d=String(b.cid);return c.indexOf(d)>-1}}),l=a.TwitterNetworkShare=k.extend({events:{"click #@share":"onClick"},onClick:function(){return!0},onLoad:function(){var a=this;h(function(){window.twttr.events.bind("tweet",function(b){a.isTweeted(b)&&(e.setQfeedLog(a,"ShareTwitter"),e.setTlog({type:"ShareTwitter"}),a.serverCall("record_tweet").send())})})}});a.TwitterConnectCallbackPage=c.extend({onLoad:function(){e.cookie("twitter_oauth_access_key",this.access_token.key,{path:"/twitter/"}),window.opener&&window.opener.document?(window.opener.$(window.opener.document).trigger("twitter_oauth_approved",{accessToken:this.access_token,userData:this.user_data}),window.close()):(typeof localStorage!="undefined"&&localStorage.setItem("twloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data})),window.close())}})},{oauth:!0,cookies:!0,"win.load":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("google_",function(require,a,b){function h(a){a===null&&(a=0);var b=function(){if(!g){g=!0;var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="//apis.google.com/js/client:plusone.js?onload=gapiAsyncInit";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}};$.whenIdle(a,b,"google_.requestGapiJs")}require("jquery.whenIdle");var c=require("settings"),d=require("w2.quora").Component,e=!1,f={};a.GoogleConnectCallbackPage=d.extend({onLoad:function(){window.opener&&window.opener.document?(this.access_token&&this.user_data&&window.opener.$(window.opener.document).trigger("google_oauth_approved",{accessToken:this.access_token,userData:this.user_data}),window.close()):(typeof localStorage!="undefined"&&localStorage.setItem("googloginresult",JSON.stringify({accessToken:this.access_token,userData:this.user_data})),window.close())}}),a.GooglePlusNetworkShare=d.extend({events:{"click #@share":"onClick"},onClick:function(){return window.open(this.share_url,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600"),!1}});var g=!!c.google_api_html_5_async_loading;window.gapiAsyncInit=function(){$(f).trigger("initialized")},a.getUserProfile=function(a,b){var c=function(a){var c=a.emails.filter(function(a){return a.type==="account"})[0].value,d={name:a.displayName,email:c,verfied_email:a.verified,photo_url:a.image.url};b(d)};window.gapi.client.load("plus","v1",function(){window.gapi.auth.setToken(a);var b=window.gapi.client.plus.people.get({userId:"me"});b.execute(c)})},a.onInit=function(a){g||require("win.load").add(function(){h()}),typeof gapi!="undefined"?a():$(f).bind("initialized",a)}},{"w2.quora":!0,"win.load":!0,"jquery.whenIdle":!0,settings:!0})}),require.whenReady("settings",function(){require.install("mathjax",function(require,a,b){function d(a){var b=function(){this.processClass="render_latex";var a="https://cdn.mathjax.org/mathjax/2.5-latest/MathJax.js?config=TeX-AMS_HTML.js";if("shouldShowSlowConnectionMode"in c&&c.shouldShowSlowConnectionMode&&!document.getElementsByClassName(this.processClass).length)return;var b=d(),e=document.createElement("script");e.type="text/x-mathjax-config",e.src=a,e.appendChild(document.createTextNode(b));var f=document.createElement("script");f.type="text/javascript",f.async=!0,f.src=a;var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(e,g),g.parentNode.insertBefore(f,g)},d=function(){var a={showMathMenu:!1,messageStyle:"none",errorSettings:e(),"HTML-CSS":f(),tex2jax:g(),TeX:h()};return"MathJax.Hub.Config("+JSON.stringify(a)+");"},e=function(){return{style:{color:"#000000","font-style":"normal"}}},f=function(){return{linebreaks:{automatic:!0,width:"container"},EqnChunk:a?10:150,EqnChunkDelay:a?100:20}},g=function(){return{inlineMath:[["[math]","[/math]"]],displayMath:[],ignoreClass:"edit_latex|qtext_editor_content",processClass:this.processClass}},h=function(){return{noUndefined:{attributes:{mathcolor:"red"}},Macros:{C:"{\\mathbb{C}}",N:"{\\mathbb{N}}",O:"{\\emptyset}",Q:"{\\mathbb{Q}}",R:"{\\mathbb{R}}",Z:"{\\mathbb{Z}}"}}};b()}var c=require("settings");a.onInit=function(a){require("win.load").add(function(){d(a)})}},{"win.load":!0,settings:!0})}),require.whenReady("settings",function(){require.install("login",function(require,a,b){function j(){window.opener&&window.opener.showFollowingButton&&window.opener.showFollowingButton()}function k(){setTimeout(function(){window.close()},1e3)}require("jquery");var c=require("w2.quora").Component,d=require("window_manager"),e=require("siteuri").URI,f,g;$(document).bind("w2rpcexception-login_required.default",function(a,b){b.rpc.__liveMutation&&require("w2.livenode").mutationDoneAfterVersion(b.rpc.__liveMutationInfo.transactionId,0),f.login(function(){var a=b.rpc.__success;b.rpc.__success=function(){typeof a=="function"&&a.apply(this,arguments),d.reload()},b.rpc.send()},function(){$(document).trigger("login_cancelled")},{qid:b.rpc._component.__js_init.qid,aid:b.rpc._component.__js_init.aid,page_type:b.rpc._component.__js_init.vote_source})}),$(document).bind("w2rpcexception-logged_out_writing_exp.default",function(a,b){b.rpc.__liveMutation&&require("w2.livenode").mutationDoneAfterVersion(b.rpc.__liveMutationInfo.transactionId,0),g.login(function(){var a=b.rpc.__success;b.rpc.__success=function(){typeof a=="function"&&a.apply(this,arguments),d.reload()},b.rpc.send()},function(){$(document).trigger("login_cancelled")})}),$(document).bind("quora_logout",function(a){d.reload()}),a.LiveLogin=c.extend({init:function(){this._super.apply(this,arguments),this._dialog=null,f=this},login:function(a,b,c){var d=this;d._dialog=d._dialog||d.dialog({closeOnClickOut:!0,hideDialog:!0}).cancel(b,!1).open(function(){d._loginListener=d.$(document).bind("quora_login",function(b){d._dialog.ok_(),typeof a=="function"&&a()})}).close(function(){d._dialog=null}).load("login_signup_combo_dialog",{kwargs:$.extend({default_tab:"signup"},c)})},_logout:function(){this.serverCall("_logout").send()}}),a.LiveLoginWritingExp=c.extend({init:function(){this._super.apply(this,arguments),this._dialog=null,g=this},login:function(a,b){var c=this;c._dialog=c._dialog||c.dialog({closeOnClickOut:!0,hideDialog:!0}).cancel(b).open(function(){c._loginListener=c.$(document).bind("quora_login",function(b){c._dialog.ok_(),typeof a=="function"&&a()})}).close(function(){c._dialog=null}).load("login_signup_combo_dialog",{kwargs:{default_tab:"signup",source:"logged_out_writing"}})}}),a.LiveLoginDialog=c.extend({onLoad:function(){var a=this;a.$("#@view").click(function(){return a.$("#view_live_login_dialog_login").addClass("hidden"),a.$("#live_login_dialog_login").removeClass("hidden"),!1}),a.$("#@show_login_link").click(function(){return a.$("#@inline_login").removeClass("hidden"),a.$("#@show_login_link").hide(),!1}),a.$("%@tabs").click(function(b){return a.select($(this).attr("show")),!1}),this.select(this.default_tab)},select:function(a){this.$("%@contents").hide(),this.$("#@"+a).show(),this.$("%@tabs").removeClass("selected"),this.$("#@"+a+"_select").addClass("selected")}}),a.LoginButton=c.extend({onLoad:function(){this.$("#@login_link").click(function(a){var b=e("/?next="+encodeURIComponent(d.getURL()));return d.navigateTo(b.unicode()),!1})}});var h=a.InlineLogin=c.extend({onLoad:function(){var a=this,b=function(b){var c=b.keyCode||b.which;c==13&&a.$("#@submit_button").click()},c=a.fnbind(b);a.$("#@password").keydown(c),a.$("#@email").keydown(c),a.$("#@resend_confirmation").click(function(b){return a.serverCall("resend_confirmation_link").kwargs({email:a._email()}).success(function(){a.hideAllErrors()}).send(),!1}),a.$("#@reset_password_link").click(this.fnbind(a.resetPasswordHandler)),a.$("#@email").blur(function(){setTimeout(function(){a.updatePreview()},10)}),a.$("#@submit_button").click(function(){return a.checkPassword(),!1}),a.$("#@submit_button").bind("touchend",function(){return a.checkPassword(),!1}),a.$("#@login_link").click(function(){return a.$("#@associated").addClass("hidden"),a.$("#@alt_login_row").addClass("hidden"),a.$("#@login_form").removeClass("hidden"),a.$("#@email").focus(),!1}),$(document).ready(function(){a.updatePreview()})},resetPasswordHandler:function(){var a=this;return a.serverCall("reset_password").kwargs({email:a._email()}).success(function(){a.hideAllErrors()}).send(),!1},updatePreview:function(){this._updatePreviewMemCache=this._updatePreviewMemCache||{};var a=this,b=a._email(),c=a._updatePreviewMemCache,d=function(d){c[b]=d;if(a.customSuccessUpdatePreviewCallback)a.customSuccessUpdatePreviewCallback(d),a.removeButtonDisabled();else{a.$(".usercard_big").fadeTo(1,1),a.$("#@preview").hide();var e=!1,f=d.name.split(" ")[0];a.$("%passwordless_users").find(".name_span:visible").each(function(a){$(this).text()!=f?$(this).parents(".usercard_big").fadeTo(1,.3):e=!0}),e||(a.$("#@associated").addClass("hidden"),a.$("#@alt_login_row").addClass("hidden"),a.$("#@login_form").removeClass("hidden"),a.$("#@password").focus(),a.$("#@name").text(d.name),a.$("#@pic").attr("src",d.photo_url),a.$("#@preview").show(),a.removeButtonDisabled()),a.hideAllErrors()}};if(c[b]){d(c[
b]);return}a.serverCall("preview_info").kwargs({email:b}).success(d).except("email_not_found",function(b){return a.hideAllErrors(),a.showErrorOnComponent("#@email_not_found_error","#@email"),a.$("#@preview").hide(),a.addButtonDisabled(),!1}).except("no_email",function(b){a.hideAllErrors(),a.$("#@preview").hide(),a.addButtonDisabled()}).except("email_unconfirmed",function(b){a.$("#@preview").hide(),a.hideAllErrors(),a.showErrorOnComponent("#@email_not_confirmed_error","#@email"),a.removeButtonDisabled()}).except("refused",function(b){a.hideAllErrors(),a.$("#@preview").hide(),a.removeButtonDisabled()}).send()},removeButtonDisabled:function(){this.$("#@submit_button").removeClass("submit_button_disabled")},addButtonDisabled:function(){this.$("#@submit_button").addClass("submit_button_disabled")},loginKwargs:function(){var a=this.$("#@email").val(),b=this.$("#@password").val(),c=+this.$("#@allow_passwordless").is(":checked");return{email:a,password:b,passwordless:c}},loginSuccessCallback:function(a){if(this.customSuccessLoginCallback)this.customSuccessLoginCallback(a);else{var b=a;this.hideAllErrors(),(require("settings").uid==b||require("settings").pageMode=="post_reload")&&$(document).trigger("quora_login")}},checkPassword:function(){this.hideAllErrors();var a=this;a.serverCall("do_login").kwargs(a.loginKwargs()).success(a.fnbind(a.loginSuccessCallback)).except("email_not_found",function(){a.hideAllErrors(),a.showErrorOnComponent("#@email_not_found_error","#@email")}).except("incorrect_password",function(){a.hideAllErrors(),a.showErrorOnComponent("#@incorrect_password_error","#@password")}).except("email_unconfirmed",function(){a.hideAllErrors(),a.showErrorOnComponent("#@email_not_confirmed_error","#@email")}).except("banned_user",function(){a.hideAllErrors(),a.serverCall("login_user_is_banned").kwargs(a.loginKwargs()).send()}).except("too_many_attempts",function(){a.hideAllErrors(),a.serverCall("login_user_rate_limited").kwargs(a.loginKwargs()).send()}).liveMutate().send()},_email:function(){return this.$("#@email").val()},hideAllErrors:function(){this.$("#@email_not_found_error").hide(),this.$("#@email_not_confirmed_error").hide(),this.$("#@incorrect_password_error").hide(),this.$("#@email_menu","#@password_menu").hide(),this.$("#@email, #@password").removeClass("input_validation_error")},showErrorOnComponent:function(a,b){this.$(a).show(),this.$(b+"_menu").show(),this.$(b).addClass("input_validation_error")}});a.FacebookConnectInlineLogin=h.extend({loginKwargs:function(){var a=this._super.apply(this,arguments),b=require("facebook");return a.fb_uid=b.getFbUid(),a.fb_access_token=b.getAccessToken(),a.fb_expires=b.getExpiresIn(),a},loginSuccessCallback:function(a){var b=a[0],c=a[1];this.hideAllErrors();if(require("settings").uid==b||require("settings").pageMode=="post_reload")c?$(document).trigger("quora_login",{__pmsg__:c}):$(document).trigger("quora_login")}});var i=a.InlineLoginProfile=c.extend({loginKwargs:function(){return{}},loginSuccessCallback:function(a){require("settings").pageMode=="post_reload"&&$(document).trigger("quora_login")},onLoad:function(){var a=this;a.$("#@container").click(function(){if(require("settings").uid==a.uid)return $(document).trigger("quora_login"),!1;if(a.passwordless)a.serverCall("do_login").kwargs(a.loginKwargs()).success(a.fnbind(a.loginSuccessCallback)).liveMutate().send();else{var b=a.lookup("inline_login");b.$("#@email").val(a.email),b.$("#@allow_passwordless").removeAttr("checked"),b.updatePreview(),b.$("#@password").focus()}return!1}),a.$("#@x_person").click(function(){return a.serverCall("x_person").liveMutate().send(),!1})}});a.FacebookConnectInlineLoginProfile=i.extend({loginKwargs:function(){var a=require("facebook");return{fb_uid:a.getFbUid(),fb_access_token:a.getAccessToken(),fb_expires:a.getExpiresIn()}},loginSuccessCallback:function(a){var b=a[0],c=a[1];require("settings").pageMode=="post_reload"&&(c?$(document).trigger("quora_login",{__pmsg__:c}):$(document).trigger("quora_login"))}}),a.LoginSignal=c.extend({onLoad:function(a){if(!a){var b=this.uid,c=require("settings");c.uid==b&&$.serverLog("Strange... got a login signal for uid="+b+" but that uid was already logged in"),c.uid=b,$(document).trigger(b?"quora_login":"quora_logout")}}}),a.LoggedOutHomeHeaderInlineLogin=h.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@associated").find(".inline_login_profile_box").is(":visible")&&this.showTOS(),this.$("#@email").focus(),this.$("#@forgot_password_link").click(this.fnbind(this.resetPasswordHandler)),this.$("#@password").focus(this.fnbind(function(){this.$("#@remember_me_option").removeClass("hidden")})),this.$("#@password").keyup(this.fnbind(function(){this.showTOS()}))},hideAllErrors:function(){this._super.apply(this,arguments),this.$("%@login_options").show()},showTOS:function(){this.$("#@login_tos").removeClass("hidden"),this.$("#@logged_out_header_login").removeClass("top_10")},showErrorOnComponent:function(a,b){this._super.apply(this,arguments),this.$("%@login_options").hide()},toggleLoginOptions:function(){return this.$("#@connect_options").is(":visible")?(this.$("#@connect_options").hide(),this.$("#@login_form").show()):(this.$("#@connect_options").show(),this.$("#@login_form").hide()),!0},events:{"click #@cancel_link":"toggleLoginOptions"}}),a.LoginPageLoginListener=c.extend({init:function(){this._super.apply(this,arguments),this._enabled=!0},onLoad:function(){var a=this;a.$(document).bind("quora_login.LoginPageLoginListener",function(b,c){if(a._enabled){var e=a.next,f=[],g;for(g in c)f.push(g+"="+encodeURIComponent(c[g]));f.length>0&&(e+=e.indexOf("?")==-1?"?":"&",e+=f.join("&")),d.navigateTo(e)}})}})},{jquery:!0,window_manager:!0,siteuri:!0,settings:!0,"w2.livenode":!0,facebook:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("network",function(require,a,b){require("jquery"),$(document).bind("w2rpcexception-network_membership_required.default",function(a,b){console.log("in membership_required"),window.location="/join"})},{jquery:!0})}),require.whenReady("settings",function(){require.install("mobile",function(require,a,b){var c=a.isAndroid=function(){return navigator.userAgent.match(/Android/i)},d=a.isIOS=function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)};$.ready(function(){(c()||d())&&require("fastclick")(document.body)})},{fastclick:!0})}),require.whenReady("settings",function(){require.install("view/modal",function(require,a,b){var c=require("w2.quora").Component,d=require("assert").ok,e=require("webnode2"),f=a.Base=c.extend({onLoad:function(){var a=this;a.close_button=this.$("#@close_button"),a.cancel_button=this.$("#@cancel_button"),a.submit_button=this.$("#@submit_button"),a.close_button.on("click",function(b){a.onClose(),b.preventDefault()}),a.cancel_button.on("click",function(b){a.onCancel(),b.preventDefault()}),a.submit_button.on("click",function(b){a.onSubmit(),b.preventDefault()})},_closeModal:function(){e.Modal.modalFor(this).close()},onClose:function(){this._closeModal()},onCancel:function(){this._closeModal()},onSubmit:function(){if(this.submitDisabled)return;this._closeModal()},disableSubmit:function(){this.submitDisabled=!0,this.submit_button.addClass("action_disabled")},enableSubmit:function(){this.submitDisabled=!1,this.submit_button.removeClass("action_disabled")}});a.MultiStep=f.extend({onLoad:function(){this.stepCallbacks=this.getCallBacks(),this.onLoadInit(),this._super.apply(this,arguments),this._bindEventHandlers(),d(this.key,"Please set a data key in python js_init. Perhaps you have overridden some values in js_init that is causing this error?"),d(this.stepCallbacks,"Sub classes should override getCallBacks() and have it return a list of methods supported by each modal steps"),d(this.data_cache,"Please define a data storage variable in python js_init. Perhaps you have overridden some values in js_init that is causing this error?")},onLoadInit:function(){var a=this.m("init");typeof a=="function"&&a()},getCallBacks:function(){},_bindEventHandlers:function(){var a=this.m("eventHandlers");typeof a=="function"&&a();var b=this;this.$("#@back_button").on("click",function(){b.onBack()})},m:function(a){return this.stepCallbacks[this.key][a]},onSubmit:function(){var a=this.m("onSubmit");if(typeof a=="function"){a();return}if(this.submitDisabled)return;this._loadNext()},onBack:function(){var a=this.m("onBack");if(typeof a=="function"){a();return}this.loadPrev()},isLastStep:function(){var a=this.m("isLastStep");return a?a:!1},_loadNext:function(){var a=this;a.isLastStep()?a.serverCall("last_step").kwargs({data_set:{data_cache:this.persistData()}}).success(function(b){a._closeModal()}).send():a.modal("load_next_modal",{kwargs:{data_set:{data_cache:this.persistData()}}})},loadPrev:function(){this.modal("load_previous_modal",{kwargs:{data_set:{data_cache:this.persistData()}}})},_getStepData:function(){var a=this.m("getStepData");if(typeof a=="function"){var b=a();d(b,"Hey! we noticed that you defined a getStepData() method in your code, but its not returning any value that is to be persisted for this modal step: "+this.key+"To fix this error, either delete getStepData() definition, "+"or return a data that you want to be persisted for "+this.key);var c=this.data_cache[this.key];return $.extend(c,b)}return null},persistData:function(){return this.data_cache[this.key]=this._getStepData(),this.data_cache}})},{assert:!0,webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/spinner",function(require,a,b){var c=require("w2.quora").Component,d=require("spin");a.Spinner=c.extend({onLoad:function(){this.spinner=d.createSpinnerDom({},"__w2_Spinner_Component");var a=this.$("#@display_area");a.append(this.spinner)}})},{spin:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("action_log",function(require,a,b){function r(){n&&clearTimeout(n),n=setTimeout(s,o)}function s(){if(m.length===0)return;if(p){r();return}p=!0,q=m,m=[],d.rpc("/ajax/action_log_POST").kwargs({messages:q}).success(t).error(u).send()}function t(){q.length=0,p=!1}function u(){m=m.concat(q),q.length=0,p=!1}function v(a){m.push(a),r()}function w(a){if(!h[a.cid])return;a.impression_target&&v(a.impression_target),delete h[a.cid]}function x(a,b,c,d){e.setMessage("alog",[a,b,c,d])}function y(a,b){b||(b=null),x(a,b,null,null)}function z(a,b){var c=f.actionTrail;x(a,null,b,c)}function A(a){h[a.cid]=a,l||(g(document,"scroll",D),l=!0),C()}function B(a){delete h[a.cid]}function C(){k&&clearTimeout(k),k=setTimeout(D,i)}function D(){var a=+(new Date);if(a<j+i)return;j=a;for(var b in h){var c=h[b];c.$("#@actionable").is(":in-viewport")&&w(c)}}function E(a,b){if(!a)return;z(a,b)}var c=require("w2.quora").Component,d=require("webnode2"),e=require("cookies"),f=require("settings"),g=require("event").add,h={},i=500,j=0,k=null,l=!1,m=[],n=null,o=500,p=!1,q=[];a.logPrimaryAction=y,a.logSecondaryAction=z,a.ActionableComponent=c.extend({onLoad:function(){this._super.apply(this,arguments),A(this);var a=this;this.$("#@actionable").on("mousedown","[action_mousedown]",function(b){a.processAction($(b.currentTarget).attr("action_mousedown"),$(b.currentTarget).attr("action_target"))}),this.$("#@actionable").on("click","[action_click]",function(b){a.processAction($(b.currentTarget).attr("action_click"),$(b.currentTarget).attr("action_target"))})},sendActions:function(){this.serverCall("send_actions").send()},processAction:function(a,b){if(!a)return;w(this),y(a,this.impression_target),this.actionCallback(a)},actionCallback:function(a){},onUnload:function(){B(this)}}),$(document).on("mousedown","[action_mousedown]",function(a){E($(a.currentTarget).attr("action_mousedown"),$(a.currentTarget).attr("action_target"))}),$(document).on("click","[action_click]",function(a){E($(a.currentTarget).attr("action_click"),$(a.currentTarget).attr("action_target"))})},{webnode2:!0,cookies:!0,settings:!0,event:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/inline_editor",function(require,a,b){function p(a,b){var c=a+"_"+b;return o[c]}var c=require("w2.quora").Component,d=require("webnode2"),e=require("cookies"),f=require("settings"),g=require("view/modal").Base,h=require("mathify").renderMath,i=require("input_validate").InputValidator,j=f.interface_strings;a.InlineEditor=c.extend({onLoad:function(){var a=this;a.editor=a.lookup("editor"),a.input_obj=a.$("#@"+a.input),a.input_button="inline_editor_submit",a.input_button_obj=a.$("#@"+a.input_button),a.save_logged_out_answer_method="save_logged_out_answer",a.editorShown=a.show_editor,a.draft_space&&(a.draft_button="inline_editor_save_draft",a.draft_button_obj=a.$("#@"+a.draft_button)),a.toggle_callback=null,a.locked=!1,a.$("#@inline_editor_link").click(function(){return a.onEditLinkClick(),!1}),a.$("#@inline_editor_cancel").click(function(){return a.content_type?n("cancel",a.content_type,a.id):a.cancelEditor(),!1}),a.registerEditorCallbacks(),a.$("#@inline_editor_create_link").click(function(){return a.content_type?n("edit",a.content_type,a.id):a.toggle_editor(),!1}),a.submitHandler(),a.initDraftHandlers(),a.focus_onload&&a.focusInput(),a.typing_area&&a.editor.setTypingStateCallback(function(b){a.serverCall("typing").kwargs({area:a.typing_area,state:b}).send(),a.input_button_obj.text(a.submit_text)}),a.input_obj.is("[maxlength]")&&a.input_obj.on("keyup",function(){var a=$(this).attr("maxlength"),b=$(this).val();b.length>a&&$(this).val(b.slice(0,a))}),h("@inline_editor_content"),a.content_type&&a.whenOnLoaded(function(){n("load",a.content_type,a.id)})},onUnload:function(){this.unregisterEditorCallbacks()},registerEditorCallbacks:function(){var a=this;a.registerEditorCallback("cancel",a.cid,function(){return a.cancelEditor(),!1}),a.registerEditorCallback("edit",a.cid,function(){return a.onEditLinkClick(),!1})},unregisterEditorCallbacks:function(){if(!this.content_type)return;m("cancel",this.content_type,this.id,this.cid),m("edit",this.content_type,this.id,this.cid)},onEditLinkClick:function(){this.editorShown||this.toggle_editor()},initDraftHandlers:function(){this.draft_space&&(this.initEditorFocusCallback(),this.initDraftButtonClickCallback(),this.initMeaningfulChangeCallback())},initEditorFocusCallback:function(){this.editor.setFocusCallback(this.fnbind(function(){this.$("#@inline_editor_save_draft").removeClass("hidden")}))},initDraftButtonClickCallback:function(){this.draft_button_obj.click(this.fnbind(function(a){return this.save_draft(!0),!1}))},initMeaningfulChangeCallback:function(){this.editor.setMeaningfulChangeCallback(this.fnbind(function(){this.save_draft(!1)}))},cancelEditor:function(){this.toggle_editor();var a=this.lookup("name_validator");a&&a.hideAllErrors()},isEditorEmpty:function(){var a=this.getEditor();return a?a.isEmpty():!1},getEditor:function(){return this.editor},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){return i.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}),!1}))},get_value:function(){return this.is_qtext?this.editor.serialize():this.input_obj.val()},saveLoggedOutAnswer:function(){var a=this.save_logged_out_answer_method,b=this.serverCall(a).kwargs(this.getSaveLoggedOutAnswerKwargs());b.send()},save_draft:function(a){var b=this.getSaveDraftMethod(a),c=this.serverCall(b).kwargs(this.getSaveDraftKwargs());a&&(c.liveMutate(),d.interactionMode.isBlocking()&&d.fallbackToPostReloadMode("interaction")),this.logSaveDraft(),c.send()},logSaveDraft:function(){return},getSaveDraftMethod:function(a){return a?"save_draft":"save_draft_auto"},getSaveDraftKwargs:function(){return{content:this.get_value(),window_id:d.windowId,draft_space:this.draft_space}},getSaveLoggedOutAnswerKwargs:function(){return{qid:this.id,content:this.get_value()}},server_call_method:"edit",_get_kwargs:function(){return{id:this.id,input:this.get_value()}},trigger_request:function(){this.typing_area&&this.editor.stopTyping();if(this.locked)return!1;this.locked=!0,this.require_comment?this.showConfirmationDialog():(this.logged_out_writing&&this.saveLoggedOutAnswer(),this.okToSubmitRequest()?this.invokeEditServerCall(this._get_kwargs()):(this.editor.focus(),this.locked=!1))},trigger_cancel:function(){this.$("#@inline_editor_cancel").click()},okToSubmitRequest:function(){return!this.require_value||this.require_value&&!this.editor.isEmpty()},invokeEditServerCall:function(a){var b=this,c=function(){b.locked=!1};$(document).bind("login_cancelled",c),b.triggerCallback("submit"),e.setTlog(b.tlog_data());var d=b.getLoggedAction();d&&require("action_log").logSecondaryAction(d,null),b.input_button_obj.addClass("disabled");var f=b.serverCall(b.server_call_method).kwargs(a).success(function(a){$(document).unbind("login_cancelled",c),b.ajax_callback(a),b.locked=!1,b.input_button_obj.removeClass("disabled")}).error(function(){b.input_button_obj.removeClass("disabled"),$(document).unbind("login_cancelled",c)}).liveMutate();b.edit_call_should_persist&&f.persistMutation(),f.send()},tlog_data:function(){return null},getLoggedAction:function(){return null},ajax_callback:function(a){this.triggerCallback("submitted"),this.toggle_editor()},focusInput:function(){this.is_qtext?$(".qtext_editor_content").focus():this.input_obj.focus()},setToggleCallback:function(a){if(!this.toggle_callback)this.toggle_callback=a;else{var b=this.toggle_callback;this.toggle_callback=function(){b(),a()}}},toggle_editor:function(){this.editorShown=!this.editorShown,this.$("#@inline_editor_content").find(".qtext_embed").each(function(a,b){$(b).addClass("thumbnail").empty()}),this.$("#@inline_editor_content").toggleClass("hidden"),this.$("#@inline_editor_form").toggleClass("hidden");if(this.is_qtext&&this.$("#@inline_editor_form").is(":visible"))try{this.cQuery(":editor").focus()}catch(a){}this.toggle_callback&&this.toggle_callback()},showConfirmationDialog:function(){var a=this.input_button_obj.text();this._dialog=this.dialog().title(this.confirm_text).cancel(this.fnbind(function(){this.locked=!1}),j.cancel).ok(this.fnbind(function(){var a=arguments[0].dialogComponent,b=a.lookup("editor");if(!!b.isEmpty())return!1;var c=this._get_kwargs();c.comment=b.serialize(),this.invokeEditServerCall(c),this._dialog.close_()}),a).load("comment_dialog")},getReviewData:function(){var a=this.editor.child("review_rating");if(a){var b=a.$("#@ratings").attr("class").slice(-1);if(b)return{base:b}}return null},registerEditorCallback:function(a,b,c){if(!this.content_type)return;l(a,this.content_type,this.id,b,c)},triggerCallback:function(a){if(!this.content_type)return;n(a,this.content_type,this.id)}}),a.InlineEditCommentDialog=c.extend({onLoad:function(){this.lookup("editor").focus()}}),a.DraftStatus=c.extend({onLoad:function(){var a=this;a.$("#@draft_status_clear").click(function(){return a.modal("load_clear_draft_confirmation").onSubmitCallBack(function(){a.getClearDraftCallback()}),!1})},getClearDraftCallback:function(){return function(){}}}),a.ClearDraftConfirmationModal=g.extend({onSubmit:function(){var a=this;d.rpc("/ajax/ajax_clear_draft_POST").kwargs({draft_space:a.draft_space}).liveMutate().success(function(){d.Modal.modalFor(a).executeOnSubmitCallBack(),a._closeModal()}).send()}}),a.BoardDraftStatus=a.DraftStatus.extend({onLoad:function(){this._super.apply(this,arguments)},updateWithDraftId:function(a){this.child("toggled").toggle(!1,a)},getClearDraftCallback:function(){var a=this.parent();return function(){a.onClearDraft(),window.location.reload()}}}),a.MessageDraftStatus=a.DraftStatus.extend({getClearDraftCallback:function(){this.cQuery(":message_inline_editor.editor").resetThreadDetailHeight()}});var k=function(a,b,c,d){var e="editor_"+a+"_"+b+"_"+c;return d&&(e+="."+d),e},l=function(a,b,c,d,e){var f=k(a,b,c,d);$(document).on(f,function(){return e()})};a.registerEditorCallback=l;var m=function(a,b,c,d){var e=k(a,b,c,d);$(document).off(e)};a.unregisterEditorCallback=m;var n=function(a,b,c){var d=k(a,b,c);$(document).trigger(d);var e=b+"_"+c;o[e]||(o[e]=[]),o[e].push(a)};a.triggerEditorCallback=n;var o={},q=function(a,b){var c=p(a,b);if(c){var d=c.length;if(c[d-1]=="edit")return!0;if(d>1&&c[d-2]=="edit"&&c[d-1]=="load")return!0}return!1};a.isInEditMode=q},{cookies:!0,"view/modal":!0,settings:!0,webnode2:!0,mathify:!0,input_validate:!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/embed_editor",function(require,a,b){var c=require("view/inline_editor").InlineEditor,d=require("input_validate").InputValidator;a.EmbedInlineEditor=c.extend({onLoad:function(){this._super.apply(this,arguments),this.initial_positioning=!1;var a=this.editor=this.lookup("editor");this.setToggleCallback(this.fnbind(function(){this.initial_positioning||(this.initial_positioning=!0,a.updateEmbedComponentPositions(),a.getEmbedComponents(function(b,c){a.updatePlaceholderImageSize(b)}),a.updateEmbedComponentPositions())}))},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(){return this.editor.notifySubmit(),d.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}),!1}))}})},{"view/inline_editor":!0,input_validate:!0})}),require.whenReady("settings",function(){require.install("view/pmsg",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2");a.PMsg=c.extend({onLoad:function(){this.$("#@x").click(this.fnbind(function(){return this.close(),!1}))},close:function(){this.$("#@container").hide(),$(".pmsg_container").hide()}}),a.PMsgContainer=c.extend({onLoad:function(a){d.pmsgContainer=this;var b=$("#layout_header");b.length!==0&&(this.headerHeight=b.outerHeight(),this.mobile||this.$("#@pmsg_container").css("top",this.headerHeight+10)),this.$("#@pmsg_container").html()&&!this.mobile&&(this.$("#@pmsg_container").fadeIn(350),this.setFadeTimeout(5e3))},setFadeTimeout:function(a){var b=this;this.t=setTimeout(function(){b.$("#@pmsg_container").fadeOut(350)},a)},setContent:function(a,b){var c=this;c.$("#@pmsg_container").hover(function(){clearTimeout(c.t),c.$("#@pmsg_container").stop(),c.$("#@pmsg_container").css("opacity",100)},function(){c.setFadeTimeout(1e3)});var d=function(a){c.$("#@pmsg_container").setContent(a),c.$("#@pmsg_container").fadeIn(350),c.setFadeTimeout(5e3)};return this.$("#@pmsg_container").is(":visible")?(clearTimeout(this.t),this.$("#@pmsg_container").fadeOut(350,this.fnbind(function(){d(a)}))):d(a),this}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/fixable2",function(require,a,b){function d(){return c.mobile||c.tablet}function o(a,b){if(typeof b!="object"||b===null)b={};if(d()&&!b.enable_mobile)return;var c=z(b.header)||document.querySelector(".SiteHeader"),g=z(b.footer)||null,h=c&&c.offsetHeight||0,i=c&&E(c).top||0,j={winHeight:f.innerHeight,winWidth:f.innerWidth,winScroll:document.body.scrollTop,scrollingDown:!0,elPosition:getComputedStyle(a).position,elTop:parseInt(getComputedStyle(a).top),elWidth:a.offsetWidth,topSpacing:0};b=D({scroll_dep:!1,height_dep:!0,width_dep:!0,header:c,footer:g,extra_top_spacing:b.extra_top_spacing||0,extra_bottom_spacing:b.extra_bottom_spacing||0,min_scroll:q(a,c,j.winScroll),max_scroll:r(a,c,g,j.winScroll),min_height:a.offsetHeight+h+i-j.winScroll,min_width:j.elWidth,sticky_release:!0,custom_trigger:null,enable_mobile:!1,min_scroll_callback:null,max_scroll_callback:null},b),b.min_scroll-=b.extra_top_spacing,b.max_scroll-=b.extra_top_spacing+b.extra_bottom_spacing,j.topSpacing=E(a).top-b.min_scroll-parseInt(getComputedStyle(a)["margin-top"]),u(a,b,j),e.push(new p(a,b,j))}function p(a,b,c){this.el=a||null,this.options=b||{},this.state=c||{}}function q(a,b,c){var d=E(a).top,e=b&&b.offsetHeight||0,f=(b&&E(b).top||0)-c,g=parseInt(getComputedStyle(a)["margin-top"]);return d-e-f-g}function r(a,b,c,d){var e=c&&E(c).top||0,f=E(a).top,g=a.offsetHeight,h=parseInt(getComputedStyle(a)["margin-bottom"]);return q(a,b,d)+e-f-g-h}function s(a){var b={scrollTop:document.body.scrollTop,height:f.innerHeight,width:f.innerWidth};i||requestAnimationFrame(t.bind(null,a,b)),i=!0}function t(a,b){var c=a.type;e.filter(function(a){return c==="w2.fixable.trigger"?a.getDependencies().custom:a.getDependencies()[c]}).forEach(function(c){var d=c.state.winScroll;D(c.state,{winScroll:b.scrollTop,winHeight:b.height,winWidth:b.width,customTop:a.top||c.state.customTop||null}),c.state.scrollingDown=c.state.winScroll>d,u(c.el,c.options,c.state)}),i=!1}function u(a,b,c){v(a,b,c)?w(a,b,c):x(a,b,c)}function v(a,b,c){if(getComputedStyle(a).display==="none")return!1;var d=!0;return b.custom_trigger!==null?d=b.custom_trigger(b,c):b.scroll_dep&&(d=j.scroll(b,c)),d&&(b.height_dep&&(d=j.height(b,c)),b.width_dep&&(d=d&&j.width(b,c))),d}function w(a,b,c){if(!a.classList.contains("fixable_fixed")){var d=c.topSpacing,e;c.elWidth=a.offsetWidth,B(a),b.custom_trigger!==null&&c.customTop!==null?(d=c.customTop,c.customTop=null):b.scroll_dep||(d=E(a).top+parseInt(getComputedStyle(a)["margin-top"])),a.style.top=d+"px",a.style.position="fixed",a.style.width=c.elWidth+"px",a.classList.add("fixable_fixed");try{e=new Event("w2.fixable.fixed")}catch(f){e=document.createEvent("Event"),e.initEvent("w2.fixable.fixed",!0,!0)}a.dispatchEvent(e)}}function x(a,b,c){var d;if(a.classList.contains("fixable_fixed")){b.custom_trigger!==null&&(c.customTop=parseInt(getComputedStyle(a).top)),c.scrollingDown&&b.custom_trigger===null&&b.sticky_release?(a.style.top=b.max_scroll-b.min_scroll+"px",a.style.position="relative"):(a.style.top=c.elTop+"px",a.style.position=c.elPosition,C(a)),a.classList.remove("fixable_fixed");try{d=new Event("w2.fixable.unfixed")}catch(e){d=document.createEvent("Event"),d.initEvent("w2.fixable.unfixed",!0,!0)}a.dispatchEvent(d)}}function y(a){for(var b=0,c=e.length;b<c;b++)if(a===e[b].el)return b;return-1}function z(a){if(jQuery&&a instanceof jQuery){if(a.length>=2)throw"Error in makeFixable(): getDomNode must only have a single element. (check the fixable element, header, and footer, are not collections)";return a[0]}return a}function A(a){var b=document.createElement("div"),c=getComputedStyle(a);return b.classList.add("fixable_clone"),b.style.height=a.offsetHeight+"px",b.style.width=a.offsetWidth+"px",b.style["margin-top"]=c["margin-top"],b.style["margin-right"]=c["margin-right"],b.style["margin-bottom"]=c["margin-bottom"],b.style["margin-left"]=c["margin-left"],b}function B(a){var b=A(a),c=a.parentNode;return c.replaceChild(b,a),b.appendChild(a),b}function C(a){var b=a.parentNode.parentNode;return b.replaceChild(a,a.parentNode),a}function D(a,b){a=a||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function E(a){var b=a.getBoundingClientRect();return{top:b.top+document.body.scrollTop,left:b.left+document.body.scrollLeft}}var c=require("browser"),e=[],f=window,g=document,h=["resize","scroll","w2.fixable.trigger"],i=!1,j={height:function(a,b){return b.winHeight>=a.min_height},width:function(a,b){return b.winWidth>=a.min_width},scroll:function(a,b){if(a.min_scroll>=0&&(a.min_scroll_callback||a.max_scroll_callback)){var c=a.min_scroll;a.min_scroll_callback&&(c=a.min_scroll_callback());var d=a.max_scroll;return a.max_scroll_callback&&(d=a.max_scroll_callback()),b.winScroll<=d&&c<=b.winScroll}return a.min_scroll>=0&&a.max_scroll>=0?a.min_scroll<=b.winScroll&&b.winScroll<=a.max_scroll:a.min_scroll>=0?b.winScroll>=a.min_scroll:a.max_scroll>=0?b.winScroll<=a.max_scroll:!1}},k=function(a,b){a=z(a);if(!a)throw"No element given for makeFixable";if(y(a)!==-1)return;return o(a,b),h.forEach(function(a){a==="resize"&&(f.removeEventListener(a,s),f.addEventListener(a,s)),g.removeEventListener(a,s),g.addEventListener(a,s)}),a},l=function(a){a=z(a);if(!a)throw"No element given for removeFixable";var b=y(a),c;return b>-1&&(c=e.splice(b,1)[0],c.el.style.top=c.state.elTop+"px",c.el.style.position=c.state.elPosition,c.el.classList.remove("fixable_fixed")),e.length<=0&&h.forEach(function(a){g.removeEventListener(a,s),f.removeEventListener(a,s)}),a},m=function(a,b,c){function d(){if(!a||!b)return!1;var d=a.offsetHeight,e=document.body.scrollTop+window.innerHeight,f=E(b).top+d+c.top,g=a.parentNode,h;return g.classList.contains("fixable_clone")?h=E(g).top+d-c.bottom:h=E(a).top+d-c.bottom,e>=f&&e<=h}a=z(a),b=z(b),c=c||{},c.top=c.top||0,c.bottom=c.bottom||0,k(a,{scroll_dep:!0,custom_trigger:d}),a.addEventListener("w2.fixable.fixed",function(){this.style.top="auto",this.style.bottom=0})},n=function(a,b){var c=a.length,d;for(d=0;d<c-1;d++)k(a[d],D(b,{scroll_dep:!0,footer:a[d+1]}));k(a[d],D(b,{scroll_dep:!0,footer:b&&b.footer||null}))};p.prototype.getDependencies=function(){return{resize:this.options.height_dep||this.options.width_dep,scroll:this.options.scroll_dep,custom:this.options.custom_trigger!==null}},a.makeFixable=k,a.removeFixable=l,a.makeBottomFixable=m,a.makeStackedFixables=n},{browser:!0})}),require.whenReady("settings",function(){require.install("view/toggle",function(require,a,b){var c=require("log").log,d=require("w2.quora").Component,e={},f=require("browser").browser,g=!0,h=window&&window.navigator.appName=="Microsoft Internet Explorer";h&&f.msie&&f.version<=9&&(g=!1),a.ToggledComponent=d.extend({onLoad:function(){this._super.apply(this,arguments),this.toggleCallback||(this.toggleCallback=null)},onUnload:function(){delete this.toggleCallback,delete this.errorCallback,delete this.toggleIndicator,delete this.toggleSpinner},setCallback:function(a){if(!this.toggleCallback)this.toggleCallback=a;else{var b=this.toggleCallback;this.toggleCallback=function(){b(),a()}}},setErrorCallback:function(a){if(!this.errorCallback)this.errorCallback=a;else{var b=this.errorCallback;this.errorCallback=function(){b(),a()}}},setIndicator:function(a){this.toggleIndicator=a},setSpinner:function(a){this.toggleSpinner=a},toggle:function(a,b){c.enabled&&c("toggle.ToggleComponent.toggle","Key:",this.toggle_key,"prev. toggled:",this.toggled,"toggle_state:",b);if(this.toggled)return;this.toggled=!0;var d,e;this.toggleIndicator&&(d=this.toggleIndicator.$("#@toggle_indicator"),d.removeClass("hidden")),this.toggleSpinner&&(e=this.toggleSpinner,e.preload_spinner||setTimeout(function(){e.loadSpinner()},150)),this.force_transition={type:"none"};var f={toggle_key:this.toggle_key};b!==undefined&&(f.toggle_state=b),this.serverCall("toggle").kwargs(f).success(this.toggleCallback).send()}}),a.ToggledIndicator=d.extend({onLoad:function(){this.lookup("toggled").setIndicator(this)}}),a.ToggledSpinner=d.extend({onLoad:function(){this.lookup("toggled").setSpinner(this),this.preload_spinner&&this.loadSpinner()},loadSpinner:function(){this.clearSpinner();var a=require("spin").createSpinnerElement({color:"#000"});this.$("#@toggle_spinner").append(a.el)},clearSpinner:function(){this.$("#@toggle_spinner").html("")}}),a.TogglerComponent=d.extend({toggle:function(){this.toggle_link&&this.toggle_link_hide&&this.$("#@toggle_link").hide(),this.toggled&&this.toggled.toggle(this.toggle_active,this.toggle_state)},onLoad:function(){this.toggled=this.lookup("toggled",!0),this.toggle_link&&this.toggle_link_hide&&this.toggled.setErrorCallback(this.fnbind(function(){this.$("#@toggle_link").show()}));if(this.toggle_trigger==="click"&&this.toggle_link)this.$("#@toggle_link").click(this.fnbind(function(a){return this.toggle(),!1}));else if(this.toggle_trigger==="mouseover"&&this.toggle_link){var a=this.fnbind(function(a){this.mouseover_toggled||(this.mouseover_toggled=!0,this.toggle())});g?this.$("#@toggle_link").mouseover(a):this.$("#@toggle_link").bind("mousedown keydown",a),this.toggled&&this.toggled.setErrorCallback(this.fnbind(function(){this.mouseover_toggled=!1}))}else if(this.toggle_trigger==="load")this.toggle();else if(this.toggle_trigger==="timeout")this.timeout=setTimeout(this.fnbind(this.toggle),this.toggle_timeout);else if(this.toggle_trigger==="viewport"){var b=this.$("#@toggle_link")[0],c=this.$(b).offset().top-this.toggle_offset;if(window.innerHeight>this.ypos)this.toggle();else{var d=function(){var a=this.$(window).scrollTop()+window.innerHeight;a>c?this.toggle():requestAnimationFrame(this.fnbind(d))};requestAnimationFrame(this.fnbind(d))}}},onUnload:function(){this.timeout&&clearTimeout(this.timeout)}})},{browser:!0,spin:!0,log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/messages",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.MessagesMain=c.extend({onLoad:function(){this.resizeMessages(),$(window).resize(this.fnbind(function(){this.resizeMessages()})),this.$("#@admin_menu_link").click(this.fnbind(function(){return this.$("#@admin_menu_items").menu(this.$("#@admin_menu_link")),!1}))},resizeMessages:function(){var a=$(window).height()-$(".SiteHeader").height();this.$(".MessagesMain").height(a-25),this.$(".MessagesMain"
).show()}}),a.MessagesThreadDetail=a.MessagesMain.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.scrollMessageThread(),a.isShowingMoreMessages=!1,a.$("#@show").click(function(){a.showMoreClicked()})},showMoreClicked:function(){this.isShowingMoreMessages=!0,this.serverCall("get_message_count").kwargs({thread_id:this.threadId}).success(this.fnbind(function(a){this.messageCount=a,this.showMoreMessages()})).send()},showMoreMessages:function(){var a=this.$("#@thread")[0].scrollHeight,b=45;this.shownCount*=2,this.shownCount>this.messageCount&&(this.reachedLastMessage=!0,this.shownCount=this.messageCount),this.serverCall("show_messages").kwargs({thread_id:this.threadId,count:this.shownCount}).contentFor(this.$("#@thread"),{parentCID:this.cid}).success(this.fnbind(function(){this.reachedLastMessage&&(this.$("#@more").hide(),a+=b),this.scrollMessageThreadToHeight(a),this.isShowingMoreMessages=!1})).send()},scrollMessageThread:function(){var a=this.$(".thread_list")[0].scrollHeight;this.$(".thread_list").scrollTop(a),this.$(".thread_list").addClass("is_shown")},scrollMessageThreadToHeight:function(a){var b=this.$("#@thread")[0].scrollHeight-a;this.$(".thread_list").scrollTop(b)}}),a.ComposeMessageModalLink=c.extend({onLoad:function(){var a=this;this.$("#@create_modal_link").on("click",function(b){a.modal("load_inner",{closeOnBackgroundClick:!1}),b.preventDefault()})}}),a.ComposeMessageModal=d.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@change_person").click(this.fnbind(function(a){this.change(),a.preventDefault()})),this.lookup("people_selector").inputFocus(),this.load()},load:function(){this.object_id&&this.setTo(this.object_id)},getData:function(){return this.$("#@compose_message_to_uid").val()&&(this.object_id=this.$("#@compose_message_to_uid").val()),!this.object_id||this.lookup("editor").isEmpty()?!1:{to_uid:this.object_id,msg:this.lookup("editor").serialize()}},onSubmit:function(){if(this.submitDisabled)return;var a=this,b=a.getData();if(b===!1)return;this.serverCall("submit_message").kwargs(b).success(function(){a._closeModal()}).send()},change:function(){this.lookup("people_selector").reset(),this.$("#@pick_people").removeClass("hidden"),this.$("#@picked_person").addClass("hidden"),this.$("#@to_name").html(""),this.lookup("people_selector").focus(),this.disableSubmit()},setTo:function(a){if(isNaN(parseInt(a)))return;this.lookup("people_selector").reset(),this.$("#@pick_people").addClass("hidden"),this.$("#@picked_person").removeClass("hidden"),this.$("#@compose_message_to_uid").val(a),this.getName(a),this.enableSubmit()},getName:function(a){this.serverCall("get_name").kwargs({to_uid:a}).contentFor(this.$("#@to_name"),{parentCID:this.cid}).success(this.fnbind(function(){this.lookup("editor").focus()})).send()}}),a.HideMessagesModalLink=c.extend({onLoad:function(){var a=this;this.$("#@create_dialog_link").on("click",function(b){a.modal("load_inner"),b.preventDefault()})}}),a.HideMessagesModal=d.extend({onSubmit:function(){if(this.submitDisabled)return;var a=this;this.serverCall("hide_thread").liveMutate().success(function(){a._closeModal(),window.location="/messages"}).send()}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/paged_list",function(require,a,b){require("jquery.whenIdle");var c=require("log").log,d=require("w2.quora").Component,e=require("webnode2"),f=require("w2.errors"),g=require("event"),h=g.add,i=g.remove,j=require("window_manager"),k=".pagedlist_item:not(.pagedlist_hidden):not(.pagedlist_invisible)",l=require("spin"),m=function(a){return a.is(":visible")&&!a.hasClass("pagedlist_invisible")&&a.height()!==0};a.PagedList=d.extend({init:function(a){this._super.apply(this,arguments),this.model_count=a.initial_count,this.container=window,this.first_hidden_index=0,this.visible_count=0,this.invisible_count=0,this.total_count=0,this.initializeCounts(),this.max_should_show=this.buffer_count,this.hidden_count=0,this.currently_fetching=!1,this.waiting_for_updates=!1,this.waiting_for_updates_from_preload=!1,this.show_hidden_when_done_updating=!1,this.lastGetMoreSucceeded=!0,this.onShowHidden=new e.Event(this),this.onGetMoreDone=new e.Event(this),this.onGetMoreDone.bind(this.maybeUpdateOptimizedPaged),this.retarget_links&&this.retarget()},onLoad:function(){var a=this,b=$(e.getLiveDomElement(this.cid)),c=this.capture_global_keyevents?document.body:b;this.onKeyCombination(b,"j",a.focusNextItem.bind(a,!1),c),this.onKeyCombination(b,"k",a.focusNextItem.bind(a,!0),c)},getFocusedItem:function(){var a=e.getLiveDomId(this.cid),b=$("#"+a+" .pagedlist_item:focus").first();return b.length?b:null},maybeScrollToItem:function(a,b,c){var d=a.height(),e=a.position().top,f=e+d,g=$(document).scrollTop()+j.headerOffset,h=Math.max(0,$(window).height()-(j.headerOffset+j.actionBarHeight+j.scrollContext)),i=g+h;if(!b.length){if(c&&e>=g){j.scrollAndFocus(0);return}if(!c&&f<=i){j.scrollAndFocus($(document).height());return}b=a}if(f<g||e>i){j.scrollAndFocus(e);return}var k=c&&e>=g-5||!c&&f<=i+5;k&&(d=b.height(),e=b.position().top,f=e+d);var l=g;if(c)k&&d>h?l=f-h:e<g&&(l=e);else{var m=$(window).height()*.25;e>g+m?l=e-m+5:k||(l=g+h)}l=g+Math.max(Math.min(l-g,h),-h),j.scrollAndFocus(l,k&&b)},focusNextItem:function(a){$("html,body").stop(!0,!0);var b=this.getFocusedItem();if(b){var c=b;do c=a?c.prev():c.next();while(c.length&&!m(c));this.maybeScrollToItem(b,c,a)}else{var d=e.getLiveDomId(this.cid),f=$(document).scrollTop()+j.headerOffset,g=$("#"+d+" "+k);g.each(function(a,b){if($(b).offset().top>f)return $(b).focus(),!1})}},onMoreButtonClick:function(a){a||f.beginCanBeRelatedToUserActionBlock(100),c&&c.enabled&&c("paged_list.PagedList.onMoreButtonClick",this.cid,"'More...' button clicked",a?"(auto)":"");var b=this.showHiddenAndMaybeGetMore();return b||(this.show_hidden_when_done_updating=!0),this.currently_fetching&&this.showLoading(),!1},loadMoreButton:function(){this.child("more_button").$("#@more").click(this.fnbind(function(){return this.onMoreButtonClick()})),!this.crawler&&this.has_more&&$.whenIdle(500,2e3,this.fnbind(function(){setTimeout(this.fnbind(function(){this.maybeGetMore()}),50)}))},initializeCounts:function(){var a=e.getLiveDomId(this.cid);if(!a)return;var b=document.getElementById(a);if(!b)return;var c=b.childNodes;for(var d=0;d<c.length;d++){var f=$(c[d]),g=f.attr("id");g&&f.hasClass("pagedlist_item")&&(this.first_hidden_index+=1,this.total_count+=1,f.hasClass("pagedlist_invisible")?this.invisible_count+=1:this.visible_count+=1)}},showHiddenAndMaybeGetMore:function(){return this.showHidden(this.buffer_count),this.maybeGetMore()},showHidden:function(a){var b=0,c=0,d=e.getLiveDomElement(this.cid);if(!d)return;var f=d.childNodes,g=!1;for(var h=0;h<f.length;h++){var i=$(f[h]);if(i.hasClass("pagedlist_item")&&i.hasClass("pagedlist_hidden")){i.hasClass("pagedlist_invisible")||(b+=1),g||(g=!0),i.removeClass("pagedlist_hidden"),f[h].style.display="",c+=1;if(b>=a)break}}this.visible_count+=b,this.hidden_count-=b,this.first_hidden_index+=c,this.visible_count>this.max_should_show&&(this.max_should_show=this.visible_count),this.onShowHidden.trigger()},hideLoading:function(){c&&c.enabled&&c("paged_list.PagedList.hideLoading","Hide loading...");var a=this.child("more_button");a.$("#@loading").hide(),this.lastGetMoreSucceeded?a.updateAutoClickCapable():a.auto_click_capable=!1,a.maybeEnableOrDisableAutoClick()},showLoading:function(){c&&c.enabled&&c("paged_list.PagedList.showLoading","Show loading...");if(this.auto_paged&&!this.crawler){this.spinner||(this.spinner=l.createSpinnerDom({},"__contentfor_paged_list_loading_spinner"));var a=this.child("more_button").$("#@loading");a.append(this.spinner),a.show()}else this.child("more_button").$("#@loading").show()},hideMoreButton:function(){var a=this.child("more_button");a.isVirtual||a.maybeHideButton()},showMoreButton:function(){var a=this.child("more_button");a.isVirtual||a.maybeShowButton()},maybeGetMore:function(a){return this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload?a!==undefined&&this.total_count<a?(this.onGetMoreDone.bindOnce(function(){this.maybeGetMore(a)}),!0):!1:(a!==undefined&&this.total_count<a?this.getMore(a):this.visible_count+this.hidden_count>=this.model_count&&this.hidden_count<=this.buffer_count/4?this.getMore():this.hidden_count<=0&&this.hideMoreButton(),!0)},maybeUpdateOptimizedPaged:function(){if(!this.optimize_for_seo)return;this.model_count>this.offset_count&&(this.model_count-=this.offset_count),this.child("html_nav")&&(this.html_nav_item=e.getLiveDomElement(this.child("html_nav").cid),this.html_nav_item.style.display="block")},getMore:function(a){return this.currently_fetching=!0,this.waiting_for_updates=!0,this.serverCall("increase_count").kwargs({cid:this.cid,num:a!==undefined?a-this.total_count:this.buffer_count,current:this.model_count}).success(this.fnbind(this._onGetMoreSuccess)).error(this.fnbind(this._onGetMoreError)).send(),!1},_onGetMoreSuccess:function(){this.lastGetMoreSucceeded=!0,this.currently_fetching=!1,this.waiting_for_updates||(this.hideLoading(),this.show_hidden_when_done_updating&&(this.show_hidden_when_done_updating=!1,this.showHiddenAndMaybeGetMore())),this.onGetMoreDone.trigger()},_onGetMoreError:function(){this.lastGetMoreSucceeded=!1,this.currently_fetching=!1,setTimeout(this.fnbind(function(){this.waiting_for_updates=!1,this.hideLoading()}),2e3)},getDebugStr:function(a,b){var c="hidden_count: "+this.hidden_count;return c+=" visible_count: "+this.visible_count,c+=" model_count: "+this.model_count,c+=" buffer_count: "+this.buffer_count,c+=" first hidden index: "+this.first_hidden_index,c+=" op position: "+a.position,c+=" invisible_count: "+this.invisible_count,c+=" total_count: "+this.total_count,c+=" hidden per JS?: "+b,c},checkState:function(a){var b=e._domids[this.cid],c=document.getElementById(b),d=c.childNodes,f=0,g=0,h=0,i=0;for(var j=0;j<d.length;j++){var k=$(d[j]);k.hasClass("pagedlist_item")&&(f+=1,k.hasClass("pagedlist_hidden")?h+=1:k.hasClass("pagedlist_invisible")?i+=1:g+=1)}var l="total_count: "+this.total_count;l+=", dom_total_count: "+f,l+=" || visible_count: "+this.visible_count,l+=", dom_visible_count: "+g,l+=" || hidden_count: "+this.hidden_count,l+=", dom_hidden_count: "+h,l+=" || invisible_count: "+this.invisible_count,l+=", dom_invisible_count: "+i,l+=" || model_count: "+this.model_count,l+=" || first hidden index: "+this.first_hidden_index,(this.total_count!=f||this.visible_count!=g||this.hidden_count!=h||this.invisible_count!=i)&&$.serverLog("qfeed_check_state_fail: "+a+" "+l,"DEBUG")},onInsertNode:function(a,b){var c=this.$("#"+b);if(!c.hasClass("pagedlist_item"))return;this.retarget_links&&c.find("a:not([href^=#])").attr("target","_blank");var d=c.hasClass("pagedlist_invisible");this.total_count+=1;if(a.position>0&&a.position>=this.first_hidden_index)c.addClass("pagedlist_hidden"),a.transition.type="none",d||(this.hidden_count+=1,this.fixed_size_paged_list&&this.first_hidden_index<this.max_should_show?this.showHidden(1):this.showMoreButton());else{c.removeClass("pagedlist_hidden"),c[0].style.display="";var f=!0;if(!d){this.visible_count+=1;if(this.fixed_size_paged_list&&this.visible_count>=this.first_hidden_index&&this.first_hidden_index>=this.max_should_show){f=!0;var g=e._domids[this.cid],h=document.getElementById(g),i=h.childNodes,j=0;for(var k=0;k<i.length;k++){var l=$(i[k]);if(l.hasClass("pagedlist_item")&&!l.hasClass("pagedlist_hidden")&&!l.hasClass("pagedlist_invisible")){j+=1;if(j>this.first_hidden_index){l.addClass("pagedlist_hidden"),i[k].style.display="none",this.hidden_count+=1,this.visible_count-=1,this.showMoreButton();break}}}}}else this.invisible_count+=1;if(!this.fixed_size_paged_list||!f)this.first_hidden_index+=1}},onDeleteNode:function(a,b){var c=this.$("#"+b);if(!c.hasClass("pagedlist_item"))return;var d=c.hasClass("pagedlist_invisible"),e=c.hasClass("pagedlist_hidden");this.total_count-=1,a.position>=this.first_hidden_index?d||(this.hidden_count-=1,(this.hidden_count<0||!e)&&$.serverLog("qfeed_hidden_count_broken delete hidden: "+this.getDebugStr(a,e),"DEBUG")):(this.first_hidden_index-=1,d?this.invisible_count-=1:(this.visible_count-=1,this.fixed_size_paged_list&&this.showHidden(1)),e&&$.serverLog("qfeed_hidden_count_broken delete shown: "+this.getDebugStr(a,e),"DEBUG"))},onUpdate:function(a){this.model_count=a.count;var b=this.child("more_button");b.isVirtual||(b.maybeEnableOrDisableAutoClick(),this.hidden_count<=0?this.hideMoreButton():this.showMoreButton()),this.waiting_for_updates=!1,this.waiting_for_updates_from_preload=!1,this.visible_count<this.buffer_count&&this.hidden_count>0&&(this.show_hidden_when_done_updating=!0);var c=!0;this.currently_fetching||(this.hideLoading(),this.show_hidden_when_done_updating&&(this.show_hidden_when_done_updating=!1,this.showHiddenAndMaybeGetMore(),c=!1)),this.onGetMoreDone.trigger(),c&&this.maybeGetMore()},orderedVisibleChildren:function(){var a=e.getLiveDomElement(this.cid),b=a.childNodes,c=[],d;for(d=0;d<b.length;d++){var f=$(b[d]),g=f.attr("id");g&&f.hasClass("pagedlist_item")&&!f.hasClass("pagedlist_invisible")&&c.push(g)}return c},allOrderedChildren:function(){var a=e.getLiveDomElement(this.cid),b=a.childNodes,c=!1,d=[];for(var f=0;f<b.length;f++){var g=$(b[f]),h=g.attr("id");h&&g.hasClass("pagedlist_item")&&(c||!g.hasClass("pagedlist_invisible"))&&(c=!0,d.push(h))}return d},retarget:function(){this.$("#"+e.getLiveDomId(this.cid)+" .pagedlist_item").find('a:not([href^="#"])').attr("target","_blank")}}),a.PagedListMoreButton=d.extend({init:function(){this._super.apply(this,arguments),this.last_check_time=0,this.rate_limiter_ms=245,this.auto_click_enabled=!1,this.updateAutoClickCapable()},updateAutoClickCapable:function(){this.auto_click_capable=this.auto_click_period!==null&&this.auto_click_period>0},checkButtonPosition:function(a){if(!this.auto_click_capable)return;if(!this.parent())return;var b=+(new Date);if(!a&&b<this.last_check_time+this.rate_limiter_ms)return;var c=this.parent().model_count;this.parent().waiting_for_updates&&(c+=this.parent().buffer_count);var d=this.shouldEnableAutoClickFromModelCount(c);this.last_check_time=b;var e=this.$("#@more");if(e.length===0)return;var f=this.$("#@sentinel"),g=this.parent().container,h=Math.ceil($(g).height()),i=!1;f.is(":in-viewport")?i=!0:$.belowthefold(f,{threshold:h,container:g})||(i=!0);if(!i)return;if(this.parent().currently_fetching||this.parent().waiting_for_updates){this.parent().showLoading(),d&&(this.parent().show_hidden_when_done_updating=!0);return}if(!d)return;this.parent().onMoreButtonClick()},onLoad:function(){this.parent().loadMoreButton(),this.parent().onShowHidden.bind(this.fnbind(function(){if(!this.auto_click_capable)return;!this.auto_click_enabled&&this.shouldEnableAutoClickFromModelCount(this.parent().model_count+this.parent().buffer_count)&&this.$("#@more").is(":visible")&&this.maybeHideButton()}));if(this.auto_click_capable){var a=this.fnbind(function(){setTimeout(this.fnbind(this.checkButtonPosition,!1),125)});this._mousemove_handler=h(document,"mousemove",a),this._keypress_handler=h(document,"keypress",a),this._scroll_handler=h(document,"scroll",a)}this.maybeEnableOrDisableAutoClick(),this.auto_click_enabled&&$.whenIdle(500,2e3,this.fnbind(function(){setTimeout(this.fnbind(function(){this.checkButtonPosition(!0)}),125)}))},onUnload:function(){this._mousemove_handler!==undefined&&i(document,"mousemove",this._mousemove_handler),this._keypress_handler!==undefined&&i(document,"keypress",this._keypress_handler),this._scroll_handler!==undefined&&i(document,"scroll",this._scroll_handler)},maybeShowButton:function(){this.auto_click_enabled||this.$("#@more").show()},maybeHideButton:function(){this.$("#@more").hide()},shouldEnableAutoClickFromModelCount:function(a){return a%this.auto_click_period!==0},maybeEnableOrDisableAutoClick:function(){if(!this.auto_click_capable){this.auto_click_enabled=!1;return}var a=this.shouldEnableAutoClickFromModelCount(this.parent().model_count);a&&!this.auto_click_enabled?(this.auto_click_enabled=!0,this.parent().hideMoreButton()):!a&&this.auto_click_enabled&&(this.auto_click_enabled=!1)},counterStr:function(){return"PagedList counters: total_count "+this.total_count+", visible_count "+this.visible_count+", invisible_count "+this.invisible_count+", hidden_count "+this.hidden_count+", first_hidden_index "+this.first_hidden_index}})},{log:!0,window_manager:!0,webnode2:!0,"jquery.whenIdle":!0,"w2.quora":!0,spin:!0,event:!0,"w2.errors":!0})}),require.whenReady("settings",function(){require.install("app/view/question/wanted_answer",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base,e=require("cookies");a.AskToAnswerButton=c.extend({onLoad:function(){this.$("#@spend").click(this.fnbind(function(){return e.setQfeedLog(this,"AskToAnswer"),e.setTlog({type:"AskToAnswer",qid:this.qid}),this.serverCall("spend").liveMutate().send(),require("action_log").logPrimaryAction("AskToAnswer",{type:this.impression_type,hash:this.impression_hash}),!1})),this.$("#@undo").click(this.fnbind(function(){return this.serverCall("undo").liveMutate().send(),require("action_log").logPrimaryAction("UndoAskToAnswer",{type:this.impression_type,hash:this.impression_hash}),!1}))}}),a.WantedAnswerDecline=c.extend({onLoad:function(){this.$("#@ignore").click(this.fnbind(function(){return this.allow_reason?this.showIgnoreReasonDialog():this.serverCall("decline").liveMutate().send(),!1}))},showIgnoreReasonDialog:function(){this._dialog=this.dialog().title("Decline Request").load("decline_dialog")}}),a.DeclineRequestDialog=c.extend({onLoad:function(){this.lookup("editor").focus(),this.$("#@give").click(this.fnbind(function(){var a="";return this.lookup("editor").isEmpty()||(a=this.lookup("editor").serialize()),this.serverCall("decline").kwargs({reason:a}).liveMutate().success(this.fnbind(function(){require("webnode2").Dialog.dialogFor(this).close_()})).send(),!1})),this.$("#@close").click(this.fnbind(function(){return require("webnode2").Dialog.dialogFor(this).close_(),!1}))}}),a.QuestionPageA2APreview=c.extend({onLoad:function(){var a=this,b=a.$("#@a2a_facepile");a.serverCall("facepile").kwargs({}).contentFor(b,{parentCID:a.cid}).send()}}),a.A2AFiltersListContentItem=c.extend({onLoad:function(){var a=this;a.$("#@filter_item").click(function(b){var c=b.currentTarget;a.parent().$(".A2AFiltersListContentItem").removeClass("nav_item_selected"),$(c).addClass("nav_item_selected");var d=a.parent().parent().parent().ge("@suggestions_list"),e=a.parent().parent();if(e.is_editing)return;$(d).addClass("working"),a.serverCall("filtered_list").kwargs({tid:a.tid}).contentFor($(d),{parentCID:a.cid}).success(function(){$(d).removeClass("working")}).send()})}}),a.WantedAnswerSuggestions=c.extend({onLoad:function(){this.$("#@search_link").click(this.fnbind(function(a){return this.showSearch(),!1}))},showSearch:function(){this.$("#@search_link_container, #@people_selector").toggle(),this.lookup("selector").focus(!0)},setTo:function(a,b){var c=this;e.setQfeedLog(this,"AskToAnswer"),e.setTlog({type:"AskToAnswer",qid:this.qid}),this.serverCall("ask_to_answer").liveMutate().kwargs({to_uid:a}).success(function(a){c.show_outstanding_requests_after_request_made&&c.lookup("header").countClicked(),a.result==="error"&&c.revertSelectedRow(b)}).error(function(){c.revertSelectedRow(b)}).send()},revertSelectedRow:function(a){a.children(".text_col.hidden").removeClass("hidden"),a.children(".text_col.asked").addClass("hidden"),a.children(".ask_button_column").removeClass("hidden")},a2aHeaderCountClicked:function(){this.$("#@a2a_suggestions").hide(),this.$("#@outstanding_requests").show()},a2aHeaderTitleClicked:function(){this.$("#@a2a_suggestions").show(),this.$("#@outstanding_requests").hide()}}),a.AskToAnswerModal=d.extend({a2aHeaderCountClicked:function(){var a=this.child("wanted_answer_suggestions");a.$("#@a2a_suggestions").hide(),a.$("#@outstanding_requests").show()},a2aHeaderTitleClicked:function(){var a=this.child("wanted_answer_suggestions");a.$("#@a2a_suggestions").show(),a.$("#@outstanding_requests").hide()}}),a.AskToAnswerHeader=c.extend({onLoad:function(){this.$("#@title_link").click(this.fnbind(function(a){return this.titleClicked(),!1})),this.$("#@count_link").click(this.fnbind(function(a){return this.countClicked(),!1}))},countClicked:function(){this.$("#@count, #@count_link, #@title, #@title_link").toggle(),this.parent().a2aHeaderCountClicked()},titleClicked:function(){this.$("#@count, #@count_link, #@title, #@title_link").toggle(),this.parent().a2aHeaderTitleClicked()}}),a.AskToAnswerModalLink=c.extend({onLoad:function(){var a=this;this.$("#@create_modal_link").click(this.fnbind(function(){return a.modal("load_inner"),!1}))}}),a.AskedBy=c.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.$("#@modal_link").click(this.fnbind(function(){return a.modal("load_inner"),!1}))}}),a.WantedAnswersSuggestionsPagedList=require("view/paged_list").PagedList.extend({onLoad:function(){this._super.apply(this,arguments),this.container=$(".modal_wrapper")}})},{cookies:!0,webnode2:!0,"view/modal":!0,"view/paged_list":!0,"w2.quora":!0,action_log:!0})}),require.whenReady("settings",function(){require.install("app/view/question/cant_answer",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies");a.CantAnswerLink=c.extend({onLoad:function(){var a=this,b,c,e=!1;this.lookup("item")&&(e=!0,b=this.lookup("item"),c=b.$("#@item")),this.$("#@cant_answer").on("click",function(){if(e){var b=c.find($(".WantedAnswerWithCreditQuestionListItem")).length;b||d.setQfeedLog(a,"QuestionPass");var f;b?f=".PagedListItem":f=".feed_item_inner";var g=c.find($(f)),h=g.children(".ShowOnPass"),i;b?i=g.find(".question_link").parent().parent():require("gating").feed_edit_question?i=g.find(".ActionableWrapperQuestionText").parent().parent():i=g.find(".ActionableWrapperQuestionText").parent();var j=$.merge(h,i),k=g.find(".question_details"),l=$.merge(g.children().not(j),k);c.find(".reason_detail").animate({height:0,opacity:0}),c.addClass("cant_answer"),l.animate({opacity:0});var m=c.find(".MarkedAsCantAnswerMessage").height(),n=c.find(".question_link").height(),o=c.find(".CantAnswerActionBar").height(),p=m+n+o;c.animate({height:p}),l.promise().done(function(){l.addClass("hidden")})}return a.cantAnswer(),!1})},cantAnswer:function(){return this.serverCall("mark_as_cant_answer").liveMutate().send(),!1}}),a.AMACantAnswerLink=a.CantAnswerLink.extend({onLoad:function(){var a=this;this.$("#@cant_answer").on("click",function(){return a.cantAnswer(),!1})}}),a.A2ACantAnswerLink=c.extend({onLoad:function(){var a=this,b,c,d=!1;this.lookup("item")&&(d=!0,b=this.lookup("item"),c=b.$("#@item")),this.$("#@cant_answer").on("click",function(){if(d){var b=c.find($(".PagedListItem")),e=b.children(".ShowOnPass"),f=b.find(".question_link").parent().parent(),g=$.merge(e,f),h=b.children().not(g);c.find(".reason_detail").animate({height:0,opacity:0}),c.addClass("cant_answer"),h.animate({opacity:0});var i=c.find(".MarkedAsCantAnswerMessage").height(),j=c.find(".question_link").height(),k=c.find(".CantAnswerActionBar").height(),l=i+j+k;c.animate({height:l}),h.promise().done(function(){h.addClass("hidden")})}return a.decline(),!1})},decline:function(){return this.serverCall("decline").liveMutate().send(),!1}}),a.A2ACantAnswerReasonLink=c.extend({onLoad:function(){var a=this;this.$("#@a2a_cant_answer").click(function(){return a.allow_reason&&a.showIgnoreReasonDialog(),!1})},showIgnoreReasonDialog:function(){this._dialog=this.dialog().title(this.pass_text).load("decline_dialog")}}),a.A2ACantAnswerReasonDialog=c.extend({onLoad:function(){this.lookup("editor").focus();var a=this;this.$("#@give").click(function(){var b="";return a.lookup("editor").isEmpty()||(b=a.lookup("editor").serialize()),a.serverCall("attach_decline_reason").kwargs({reason:b}).liveMutate().success(function(){require("webnode2").Dialog.dialogFor(a).close_()}).send(),!1}),this.$("#@close").click(function(){return require("webnode2").Dialog.dialogFor(a).close_(),!1})}}),a.UndoCantAnswerLink=c.extend({onLoad:function(){var a=this,b,c,d=!1;this.lookup("item")&&(d=!0,b=this.lookup("item"),c=b.$("#@item")),this.$("#@undo_cant_answer").on("click",function(){if(d){var b=c.find($(".WantedAnswerWithCreditQuestionListItem")).length,e;b?e=".PagedListItem":e=".feed_item_inner",c.removeClass("cant_answer");var f=c.find($(e)),g=f.children(".ShowOnPass, .edit_area"),h;b?h=f.find(".question_link").parent().parent():h=f.find(".ActionableWrapperQuestionText").parent();var i=f.find(".question_details"),j=$.merge(f.children().not(g),i);c.find(".EventHeader, .reason_detail").height("auto"),c.height("auto"),j.removeClass("hidden"),c.find(".EventHeader, .reason_detail, .edit_area").animate({opacity:100}),j.animate({opacity:100})}return a.undoCantAnswer(),!1})},undoCantAnswer:function(){return this.serverCall("undo_mark_as_cant_answer").liveMutate().send(),!1}})},{webnode2:!0,cookies:!0,gating:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies");a.BoardMuteLink=c.extend({onLoad:function(){this.$("#@board_mute_link").click(this.fnbind(function(){this.serverCall("mute").kwargs({bid:this.bid}).liveMutate().send()}))}}),a.BoardUnmuteLink=c.extend({onLoad:function(){this.$("#@board_unmute_link").click(this.fnbind(function(){this.serverCall("unmute").kwargs({bid:this.bid}).liveMutate().send()}))}}),a.BoardNameLink=c.extend({onLoad:function(a){this.$("#@link").mousedown(this.fnbind(function(){d.setQfeedLog(this,"BoardClickthrough"),d.setQueryLog(this,"BoardClickthrough")}))}}),a.BoardSelectorWrapper=c.extend({onLoad:function(){this.cQuery(":selector").$("#@input").bind("focus",this.fnbind(function(a){this.removeBoardMissingError()}))},addMissingBoardError:function(){this.cQuery(":selector").$("#@input").addClass("input_validation_error"),this.$("#@no_board_error").show()},removeBoardMissingError:function(){this.cQuery(":selector").$("#@input").removeClass("input_validation_error"),this.$("#@no_board_error").hide()}})},{cookies:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/topic_list",function(require,a,b){var c=require("w2.quora").Component;a.TopicListItems=c.extend({onLoad:function(){this.$("#@view_more_link a").click(this.fnbind(function(){return this.$("#@view_more_link, #@additional_topics").toggleClass("hidden"),!1}))}}),a.TopicListItem=c.extend({onLoad:function(){this.$("#@remove_topic").tooltip({contents:this.remove_tooltip_text}).click(this.fnbind(function(a){return this.serverCall("remove_topic").liveMutate().send(),!1})),this.$("#@make_primary").click(this.fnbind(function(a){return this.serverCall("make_primary").liveMutate().send(),!1})),this.$("#@clear_primary").click(this.fnbind(function(a){return this.serverCall("clear_primary").liveMutate().send(),!1})),this.$("#@remove_topic").hover(this.fnbind(function(a){this.$("#@topic_list_item").addClass("hover")}),this.fnbind(function(a){this.$("#@topic_list_item").removeClass("hover")}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/topic_redesign",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.TopicPhotoCard=c.extend({onLoad:function(){var a=this;a.$("#@card").click(a.fnbind(function(b){return a.onCardClick(),!1}))},onCardClick:function(){this.isSelected=!this.isSelected,this.isSelected?this.select():this.deselect()},select:function(){this.$("#@card").addClass(this.selectClass),this.lookup("dynamic_topic_grid").addTopic(this.tid)},deselect:function(){this.$("#@card").removeClass(this.selectClass),this.lookup("dynamic_topic_grid").removeTopic(this.tid)}}),a.TopicTopFaqQuestionsMain=c.extend({onLoad:function(){var a=this;a.$("#@checkbox_demand").change(function(){this.checked?a.updateDataAndReloadList("use_demand","True"):a.updateDataAndReloadList("use_demand","")}),a.$("#@checkbox_reask").change(function(){this.checked?a.updateDataAndReloadList("use_reask","True"):a.updateDataAndReloadList("use_reask","")}),a.$("#@checkbox_duplicates").change(function(){this.checked?a.updateDataAndReloadList("use_duplicates","True"):a.updateDataAndReloadList("use_duplicates","")})},updateDataAndReloadList:function(a,b){var c=d.parseURLParams();c[a]=b;for(var e in c)(c[e]==="all"||c[e]==="")&&delete c[e];var f=decodeURIComponent($.param(c));window.location=window.location.pathname+"?"+f}})},{window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/location",function(require,a,b){var c=require("w2.quora").Component;a.TopicLocationPreview=c.extend({onLoad:function(){var a=this;this.$("#@enlarge_map").click(this.fnbind(function(){return this.$("#@enlarge_map").hide(),this.$("#@wrapper").css("height","auto"),this.$("#@wrapper").css("width","auto"),this.$("#@wrapper").removeClass("mask"),this.$("#@content").removeClass("mask_content"),this.$("#@content").css("top","0px"),this.lookup("picker").toggleControls(!0),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/merge",function(require,a,b){var c=require("w2.quora").Component;a.TopicMergeUnmerge=c.extend({onLoad:function(){this.$("#@show_merge").click(this.fnbind(function(){return this.$("#@merge").removeClass("hidden"),this.$("#@show_merge").addClass("hidden"),this.cQuery(":standalone.selector").focus(),!1}))}}),a.TopicUnmergeLink=c.extend({onLoad:function(){var a=this;this.$("#@unmerge").click(function(){return a.serverCall("unmerge_topic").kwargs({tid:a.tid}).liveMutate().send(),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("qed/util",function(require,a,b){function d(a,b,d){return c(a),b.parentNode===a&&a.removeChild(b),d?a.insertBefore(b,d):a.appendChild(b)}function e(a,b){var d=a.parentNode,e=a,f=0;c(d);if(typeof b=="number"&&d.childNodes[b]===a)return b;while(e=e.previousSibling)++f;return c(d.childNodes[f]===a),f}function f(a){while(a&&a.firstChild)a=a.firstChild;return a}function g(a){while(a&&a.lastChild)a=a.lastChild;return a}function h(a){return a.ownerDocument||a}function i(a){a.nodeType===3&&(a=a.parentNode);for(var b=h(a).documentElement;a&&a!==b;a=a.parentNode)if(x.get(a,"isEditorRoot"))return a}function j(a,b){return b=b||i(a),a&&a!==b&&f(a.nextSibling||j(a.parentNode,b))}function k(a,b){return b=b||i(a),a&&a!==b&&g(a.previousSibling||k(a.parentNode,b))}function l(a,b){a.nodeType==3&&(a=a.parentNode);var c=h(a),d=c.defaultView,e=a.style[b],f;if(!e||e==="auto")d&&d.getComputedStyle?f=d.getComputedStyle(a,null):f=a.currentStyle,e=f&&f[b];return e==="auto"?null:e}function n(a){return m?!!a.metaKey:!!a.ctrlKey}function o(a){return!!a.shiftKey}function u(){var a=p.toLowerCase();return a.indexOf("rv:11.")>-1||a.indexOf("trident/7")>-1}function v(a,b){for(var c=h(b).documentElement;b&&b!==c;b=b.parentNode)if(b===a)return!0;return!1}function w(a){var b=a.parentNode,e=b&&b.parentNode;c(!x.get(b,"isEditorRoot")),c(e);if(!a.nextSibling)d(e,a,b.nextSibling);else if(!a.previousSibling)d(e,a,b);else{var f=X(b.cloneNode(!1),a.nextSibling);d(e,f,b.nextSibling),d(e,a,f),c(b.nextSibling===a)}return c(a.previousSibling===b||a.nextSibling===b),!0}function y(a,b){var c={},d;if(a===b)return a;a.nodeType===3&&(a=a.parentNode),b.nodeType===3&&(b=b.parentNode);while(a||b){if(a){d=x.key(a);if(d in c)return a;c[d]=a,a=a.parentNode}if(b){d=x.key(b);if(d in c)return b;c[d]=b,b=b.parentNode}}}function z(a,b){var c=y(a,b);return A(a,b,c)}function A(a,b,d){c(d),c(a!==d),c(b!==d),c(i(d));while(a.parentNode!==d)w(a);while(b.parentNode!==d)w(b);return d}function B(a){var b=a.parentNode;if(b){while(a.firstChild)b.insertBefore(a.firstChild,a);b.removeChild(a)}return a}function C(a){var b=0,c,d,e=[],f;while(d=a[b++])d.parentNode===c?f.push(d):(c=d.parentNode,e.push(f=[d]));return e}function D(a,b){var c=b.parentNode;c&&c.replaceChild(a,b);while(b.firstChild)a.appendChild(b.firstChild);return a}function E(a,b){var e=0,f=b[0],g=f&&f.parentNode;g&&g.nodeType===1?d(g,a,f):g=null;while(f=b[e++])g&&c(f.parentNode===g),a.appendChild(f);return a}function F(a){var b=a.cloneNode(!1);return x.set(b,"isStyleSpan",!0),b}function G(a){var b={},c=a.nodeName.toLowerCase();c==="b"||c==="strong"?b.fontWeight="bold":c==="i"||c==="em"?b.fontStyle="italic":c==="u"?b.textDecoration="underline":b=null;if(b){var d=h(a).createElement("span");x.set(d,"isStyleSpan",!0);for(var e in b)d.style[e]=b[e];return D(d,a)}var f=a.style;return!x.get(a,"isStyleSpan")&&f&&(f.fontWeight||f.fontStyle||f.textDecoration)&&x.set(a,"isStyleSpan",!0),a}function H
(a){function i(c){c.parentNode!==a&&(b=!0),h.push(c)}function o(b){var c=b[0].parentNode;n?E(F(a),b):(n=!0,E(a,b))}c(x.get(a,"isStyleSpan"));if(!a.firstChild){a.parentNode.removeChild(a);return}var b,d=f(a),e=g(a),h=[];while(d&&d!==e)i(d),d=j(d);i(e);if(!b)return;B(a);var k=0,l,m=C(h),n;while(l=m[k++])o(l)}function I(a,b){return d(a.parentNode,b,a.nextSibling)}function J(a,b){return d(a.parentNode,b,a)}function K(a,b){for(var c=a,d=[];c&&c!==b;c=j(c))d.push(c);b&&d.push(b);var e=h(a).documentElement,f=0;while(c=d[f++])for(var g=c.parentNode;g&&g!==e;g=g.parentNode){g=G(g);if(x.get(g,"isStyleSpan")){H(g);break}}return d}function L(a){return a.createTextNode("ï»¿")}function M(){}function N(a,b){var c=a.previousSibling,e;return!c||c.nodeType!==3?(e=d(a.parentNode,L(h(a)),a),function(){Y(e)}):M}function P(a,b,c,d){return b+(new Array(c.length)).join("Â ")+" "+d}function Q(a,b){c(a.nodeType===3);var d=a.nodeValue,e;if(d==="ï»¿"&&!b)return;e=d.replace(/\ufeff/g,""),e=e.replace(O,P);if(e!==d)return e===""?a.parentNode.removeChild(a):a.nodeValue=e,!0}function R(a){return a.nodeType===3&&a.nodeValue===""}function S(a,b){var c=b?"nextSibling":"previousSibling",d=a[c],e;while(d&&R(d))e=d[c],Y(d),d=e}function T(a){if(a.nodeType===3)return!1;var b=a.nodeName.toLowerCase();if(b=="img"&&a.className&&a.className.indexOf("hr_img")>-1)return!0;switch(b){case"div":case"p":case"br":case"ol":case"ul":case"li":case"blockquote":case"address":case"h1":return!0;default:return!1}}function U(a,b,c,d,e,f){var g=h(a),i,j;b=b||g.documentElement;while(a&&a!==b){i=a[c];if(i){a=i;if(T(a))return e(a,g.createElement("span"));while(j=a[d]){a=j;if(T(a))return e(a,g.createElement("span"))}}else{a=a.parentNode;if(a&&T(a))return f(a,g.createElement("span"))}}}function V(a,b){return U(a,b,"nextSibling","firstChild",J,function(a,b){return a.appendChild(b)})}function W(a,b){return U(a,b,"previousSibling","lastChild",I,function(a,b){return d(a,b,a.firstChild)})}function X(a,b,c){while(b&&b!==c){var d=b.nextSibling;a.appendChild(b),b=d}return a}function Y(a){for(var b,c=0,d=arguments.length;c<d;c+=1)(a=arguments[c])&&(b=a.parentNode)&&b.removeChild(a)}function Z(a){return cb(a,"ul")||cb(a,"ol")}function _(a){return cb(a,"li")}function ab(a){var b=a&&a.nodeName;return/h\d/i.test(b)}function bb(a,b,c){return a&&a.firstChild==b&&a.lastChild==c}function cb(a,b){return!a||a.nodeType===3?!1:a.nodeName.toLowerCase()===b}function db(a,b,c){if(ab(a)){var d=c.nextSibling;if(bb(a,b,c))return!0;if(d&&cb(d,"br")&&bb(a,b,d))return!0}return!1}function eb(a){a.innerHTML="";while(a.firstChild)a.removeChild(a.firstChild);return a}function fb(a,b,d){c(T(a));var e=h(a),i=f(a),k=[];K(i,g(a));while(i){c(v(a,i));var l=W(i),m=V(i),n=j(m,a),o=e.createElement(b);c(v(a,l)),c(v(a,m)),z(l,m);var p=l.parentNode;db(p,l,m)?o.appendChild(p):X(o,l.nextSibling,m),d&&(o=d(o)),k.push(o),Y(l,m),i=n;while(i&&T(i))i=j(i,a)}return E(eb(a),k)}function gb(a,b,c){return n(c)?hb(a,b):!0}function hb(a,b){var c=i(a);if(!c)return!0;var e=c.firstChild;return e&&cb(e,"a")&&(d(c,a,c.firstChild),c.appendChild(b),N(a,b)),!0}function ib(a,b){b=b||a.ownerDocument.documentElement;for(var c;a;a=a.parentNode){c={node:a,next:c};if(a===b)break}return c}function jb(a,b,c){for(var d=ib(a,c),e=ib(b,c),f;d&&e&&d.node===e.node;d=d.next,e=e.next)f=d.node;if(d&&e){a=d.node,b=e.node;while(a&&a!==b)a=a.nextSibling;if(!a){var g=d;d=e,e=g}}return[f,d,e]}function kb(a,b,c,d){var e=jb(a,b,c),f=e[0],g=e[1],h=e[2],i=[];return g&&h&&lb(f,g,h,d),i}function lb(a,b,c,d){if(d(a))return!0;if(b&&b.next&&lb(b.node,b.next,null,d))return!0;for(var e=b?b.node.nextSibling:a.firstChild,f=c?c.node:null;e&&e!==f;e=e.nextSibling)if(mb(e,d))return!0;if(c&&c.next&&lb(c.node,null,c.next,d))return!0}function mb(a,b){if(b(a))return!0;var c=a.firstChild;for(;c;c=c.nextSibling)if(mb(c,b))return!0}function nb(a,b){for(var c=h(a).documentElement;a&&a!==c;a=a.parentNode)if(b(a))return a}function ob(a){var b=nb(a,ab);return b&&nb(b,_)}function pb(a){S(a,!1);var b=a.previousSibling;return b?T(b)?!0:!1:!0}var c=a.assert=require("assert").ok;a.guid=function(){return((+(new Date)).toString(36)+Math.random().toString(36)).toLowerCase()},a.insertBefore=d,a.indexOfChild=e,a.firstLeaf=f,a.lastLeaf=g,a.getDocument=h,a.getEditorRoot=i,a.nextLeaf=j,a.prevLeaf=k,a.cloneObject=function(a,b){var c=function(){for(var a in b)this[a]=b[a]};return c.prototype=a,new c},a.getStyle=l,a.isVisible=function(a){return require("jquery"),$(a).is(":visible")};var m=navigator.platform.match("Mac");a.hasCtrlOrCmd=n,a.hasShift=o;var p=window&&window.navigator&&window.navigator.userAgent||"",q=p.indexOf("AppleWebKit/")>-1,r=p.indexOf("MSIE")>-1,s=p.indexOf("Chrome")>-1,t=p.indexOf("Gecko/")>-1&&p.indexOf("Chrome")<0;a.isIE=r,a.isIE11=u(),a.isWebKit=q,a.isChrome=s,a.isGecko=t,a.addClass=function(a,b){for(var c=0,d=(a.getAttribute("class")||"").split(" ");c<d.length;++c)if(d[c]===b)break;c==d.length&&(d.push(b),a.setAttribute("class",d.join(" ")))},a.arraysEqual=function(a,b,c){if(a&&b){var d,e=a.length;if(e!=b.length)return!1;for(d=0;d<e;++d)if(c?!c(a[d],b[d]):a[d]!==b[d])return!1;return!0}return a||b?!1:!0},a.contains=v,a.splitParent=w;var x=require("qed/npd");a.nearestCommonAncestor=y,a.makeSiblings=z,a.splitParentsUntil=A,a.deleteContents=function(a,b){z(a,b);while(a.nextSibling!==b)a.parentNode.removeChild(a.nextSibling)},a.replaceWithChildren=B,a.replaceNode=D,a.wrapChildren=E,a.convertToStyleSpan=G,a.hugLeavesBetween=K,a.applyStyle=function(a,b,d){var e=h(a),f,g=C(K(a,b)),i=0;while(f=g[i++])x.get(f[0].parentNode,"isStyleSpan")||x.set(E(e.createElement("span"),f),"isStyleSpan",!0);var j=a.parentNode,k=b.parentNode;c(x.get(j,"isStyleSpan")),c(x.get(k,"isStyleSpan")),a.previousSibling&&J(j,X(F(j),j.firstChild,a)),b.nextSibling&&I(k,X(F(k),b.nextSibling)),N(a,b),i=0;while(f=g[i++]){var l=f[0].parentNode;c(x.get(l,"isStyleSpan"));for(var m in d)l.style[m]=d[m]}},a.addExtraSupport=N;var O=/(\S)(\u00a0+)(\S)/g;a.cleanTextNode=Q,a.cleanFEFFs=function(a,b){for(var c=b?k:j,d=i(a),e=c(a,d);e;e=c(e,d))if(e.nodeType===3&&Q(e,!0))break},a.getText=function(a,b){var c=a.innerText;return c||(c=a.innerHTML.replace(/<[^>]*>/g," "),c=c.replace(/&amp;/g,"&")),c&&(c=c.replace(/\ufeff/g,""),b||(c=c.replace(/^\s+|\s+$/g,""))),c},a.removeEmptyTextNodes=S,a.causesLineBreak=T,a.findNextLine=V,a.findPrevLine=W,a.extractSiblings=X,a.remove=Y,a.isList=Z,a.isListItem=_,a.isHeading=ab,a.spansChildren=bb,a.hasTag=cb,a.formatBlock=function(a,b,c){K(a,b);var e=h(a),f=e.createElement(c),g=W(a),i=V(b);z(g,i);var j=g.parentNode,k=f,l=f;if(j&&Z(j)&&!_(f)){var m=e.createElement("li");m.appendChild(f),k=m;if(_(g.nextSibling)&&!Z(f)){var n=e.createElement(j.nodeName);f.appendChild(n),l=n}}return db(j,g,i)?(d(j.parentNode,f,j),f.appendChild(j),Y(g,i),f):(d(g.parentNode,k,g),X(l,g,i),Y(g,i),f)},a.removeAllChildren=eb,a.wrapLines=fb,a.handleSelectAll=gb,a.fixSelectAll=hb,a.getAncestors=ib,a.getPathsFromNCA=jb,a.traverseAllNodesBetween=kb,a.findAncestor=nb,a.findHeadingInLi=ob,a.checkBeginningOfLine=pb},{assert:!0,jquery:!0,"qed/npd":!0})}),require.whenReady("settings",function(){require.install("qed/unload",function(require,a,b){function g(){var a=f.onbeforeunload;if(a===e)return;e=f.onbeforeunload=function(){var b,e=0,f;if(!d)while(b=c[e++])if(f=b())return f;if(a)try{return++d,a.apply(this,arguments)}finally{--d}}}var c=[],d=0,e,f=window;a.checkBeforeUnload=function(a){g(),a&&c.push(a)},a.removeCheck=function(a){var b;for(b=0;b<c.length;b++)if(c[b]===a){c.splice(b,1);break}}},{})}),require.whenReady("settings",function(){require.install("app/view/share/form",function(require,a,b){var c=require("w2.quora").Component,d=require("app/view/share/connect").SocialConnector,e=require("w2.context"),f=a.ShareCheckboxBase=d.extend({contextProperty:null,onLoad:function(){this.list_item=this.$("#@share_checkbox_list_item"),this.checkbox=this.$("#@checkbox"),this.action_link=this.$("#@action_link"),this.message_preview=this.$("#@message_preview"),this.message_preview_text=this.$("#@message_preview_text"),this.label_clickable=this.$("#@label_clickable"),this.editorContext=this.getContext(e.Editor);if(this.isStateModified()&&!this.is_disabled){var a=this.state("checked");a?(this.checkbox.attr("checked","checked"),this.list_item.removeClass("is_not_checked")):(this.checkbox.removeAttr("checked"),this.list_item.addClass("is_not_checked"))}this.maybeSetContext(),this.checkbox.change(this.fnbind(function(){var a=this.isChecked();if(a&&this.needs_action){this.remedyDisabled(),this.checkbox.removeAttr("checked");return}this.maybeSetContext(),this.logCheckboxChangedJS(a),this.state("checked",a),a?this.list_item.removeClass("is_not_checked"):this.list_item.addClass("is_not_checked")})),this.label_clickable.click(this.fnbind(function(){this.checkbox.click()})),this.action_link.click(this.fnbind(function(){return this.is_disabled?this.remedyDisabled():this.editText(),!1}))},maybeSetContext:function(){this.editorContext&&this.editorContext.set(this.contextProperty,this.isChecked())},logCheckboxChangedJS:function(a){this.serverCall("log_checkbox_changed_js").kwargs({is_checked:a,share_info:this.share_info}).send()},isStateModified:function(){var a=this.state("checked");return typeof a!="undefined"},isChecked:function(){return this.checkbox.attr("checked")==="checked"},remedyDisabled:function(){},beginEditingText:function(){}});a.ShareCheckboxTwitter=f.extend({contextProperty:"shareToTwitter",remedyDisabled:function(){this.connectTwitter()}}),a.ShareCheckboxTwitterCompact=a.ShareCheckboxTwitter.extend({onLoad:function(){this._super.apply(this,arguments),this.list_item.tooltip({contents:this.default_text})},remedyDisabled:function(){this.connectTwitter(this.fnbind(function(){this.checkbox.attr("checked","checked")}))}}),a.ShareCheckboxFacebook=f.extend({contextProperty:"shareToFacebook",remedyDisabled:function(){var a=this;require("facebook").maybePromptToPublish(a.fbUid,function(b,c,d){a.serverCall("connect_facebook").kwargs({fb_uid:b,access_token:c,expires_secs:d}).liveMutate().send()},function(){a.child("fb_different_account").show()})}}),a.ShareCheckboxFacebookCompact=a.ShareCheckboxFacebook.extend({}),a.ShareForm=c.extend({getValues:function(){var a={};return this.lookup("checkbox_fb",!0)&&(a.fb=this.lookup("checkbox_fb").isChecked()),this.lookup("checkbox_tw",!0)&&(a.tw=this.lookup("checkbox_tw").isChecked()),a}});var g=require("qed/rules").Ruleset,h=new g,i=/\bshare_editor_link\b/;h.addOkTag("a",function(a){if(i.test(a.className))return"a"}),h.addKeyHandler(65,require("qed/util").handleSelectAll),a.ShareFormMessageEditor=c.extend({onLoad:function(){this.editor=this.$("#@editor").get(0),this.anchor=this.$("#@editor a.share_editor_link").get(0),$("a",this.editor).addClass("share_editor_link").after("ï»¿").before("ï»¿"),this._qed=require("qed/edit").edit(this.editor,h),this._qed.modify(function(a,b){})},focus:function(){var a=this;a.whenOnLoaded(function(){a._qed.focus()})},appendAnchor:function(){var a=this;a.whenOnLoaded(function(){a._qed.modify(function(){a.$("#@editor").prepend(a.anchor)})})},removeAnchor:function(){var a=this;a.whenOnLoaded(function(){a._qed.modify(function(){$(a.anchor).remove()})})},isEmpty:function(){var a=this,b=a._qed.text(!0);return b==="\n"||b===""},getText:function(){var a=this;return a._qed.text()},serialize:function(){var a=this._qed.html(!0),b=document.createElement("div");return b.innerHTML=a,$("a",b).remove(),{html:a,data:this.qlink_data||{},no_anchors:$(b).html()}}})},{"qed/edit":!0,"app/view/share/connect":!0,"w2.context":!0,"qed/rules":!0,facebook:!0,"qed/util":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/share/modal",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("app/view/share/connect").socialConnectorBase,f=require("view/modal").Base,g=require("window_manager"),h=require("cookies");a.ShareFormModal=f.extend($.extend({},e,{onLoad:function(){function b(){a.showHidePlaceholder()}function c(){setTimeout(b,10)}function d(){a.child("message_editor").focus()}var a=this;a.results=[],a.shortURLCopyField=a.$("#@short_url_copy_field"),a.editor=a.child("message_editor").$("#@editor"),a.editorPlaceholder=a.child("message_editor").$("#@editor_placeholder"),a.linkedinCheckbox=a.$("#@linkedin_checkbox"),a.linkedinConnectLink=a.$("#@linkedin_connect_link"),a.wordpressCheckbox=a.$("#@wordpress_checkbox"),a.wordpressConnectLink=a.$("#@wordpress_connect_link"),a.tumblrCheckbox=a.$("#@tumblr_checkbox"),a.tumblrConnectLink=a.$("#@tumblr_connect_link"),a.boardCheckbox=a.$("#@board_checkbox"),a.boardSelectorContainer=a.$("#@board_selector_container"),a.boardSelectorWrapper=a.child("selector_wrapper"),a.boardSelectorWrapper&&(a.boardSelector=a.boardSelectorWrapper.child("selector")),a.sendCheckbox=a.$("#@send_checkbox"),a.multiSelectorContainer=a.$("#@multi_selector_container"),a.typeahead=a.child("typeahead"),typeof window.history.pushState=="function"&&(g.isParamInURL(""+window.location,"share")||window.history.pushState(null,"",g.addParamToURL(""+window.location,"share","1"))),a.child("message_editor").whenOnLoaded(function(){a.updateShareEditorLinkDisplay()}),a.isChecked(a.boardCheckbox)&&a.boardSelectorContainer.show(),a.isChecked(a.sendCheckbox)&&a.multiSelectorContainer.show(),a.editor.bind("keyup",c).bind("keydown",c),a.editorPlaceholder.bind("click",d),a.linkedinCheckbox.click(function(){a.updateShareEditorLinkDisplay();if(!a.isChecked(a.linkedinCheckbox)){a.disableSubmitIfNecessary();return}if(a.liUid){a.enableSubmit();return}return a.connectLinkedin(a.fnbind(a.checkLinkedin)),!1}),a.linkedinConnectLink.click(function(){return a.connectLinkedin(a.fnbind(a.checkLinkedin)),!1}),a.wordpressCheckbox.click(function(){a.updateShareEditorLinkDisplay();if(!a.isChecked(a.wordpressCheckbox)){a.disableSubmitIfNecessary();return}if(a.wordpressConnected){a.enableSubmit();return}a.connectWordpress()}),a.wordpressConnectLink.click(function(){return a.connectWordpress(),!1}),$(document).bind("wordpress_connect_success",function(){a.checkWordpress()}),a.tumblrCheckbox.click(function(){a.updateShareEditorLinkDisplay();if(!a.isChecked(a.tumblrCheckbox)){a.disableSubmitIfNecessary();return}if(a.tumblrConnected){a.enableSubmit();return}a.connectTumblr(function(){a.checkTumblr()})}),a.tumblrConnectLink.click(function(){return a.connectTumblr(function(){a.checkTumblr()}),!1}),a.boardCheckbox.click(function(){a.updateShareEditorLinkDisplay();if(!a.isChecked(a.boardCheckbox)){a.boardSelectorContainer.hide(),a.disableSubmitIfNecessary();return}a.boardSelectorContainer.show(),a.enableSubmit()}),a.sendCheckbox.click(function(){a.updateShareEditorLinkDisplay();if(!a.isChecked(a.sendCheckbox)){a.typeahead.clear(),a.multiSelectorContainer.hide(),a.disableSubmitIfNecessary();return}a.multiSelectorContainer.show(),a.typeahead.$("#@input").focus()}),a.shortURLCopyField.click(function(){$(this).select()}),this._super.apply(this,arguments),a.disableSubmitIfNecessary()},onClose:function(){return this._closeModal(),this.originalUrl&&typeof window.history.pushState=="function"&&window.history.pushState(null,"",this.originalUrl),!1},onSubmit:function(){var a=this,b=a.checkboxValues();b.send=a.isChecked(a.sendCheckbox);if(a.boardSelector){var c=a.boardSelector.getBid(),e=a.boardSelector.getText();a.boardInfo.bid=c,a.boardInfo.name=c?null:e,a.boardInfo.is_submission=a.isSubmission}if(!a.atLeastOneChecked(b))return a.disableSubmit(),!1;var f=d.Modal.openerFor(a);for(var g in b)if(b[g]===!0){var i="Share"+g[0].toUpperCase()+g.slice(1);h.setQfeedLog(f,i),h.setTlog({type:i})}h.setQueryLog(f,"BoardPost"),require("action_log").logSecondaryAction("Share",a.share_target),a.disableSubmit(),a.serverCall("dialog_submit_controller").kwargs({checkboxes:b,message:a.lookup("message_editor").serialize(),board_info:a.boardInfo,send_recipients:a.results}).success(function(b){a._closeModal()}).error(function(){a._closeModal()}).liveMutate().send()},regexUrl:/((?:https?:\/\/)?[a-zA-Z0-9](?:[-a-zA-Z0-9]*\.)+[a-zA-Z]{2,}(?:\/[^\/\s]+)*\/?)(?:\s|$)/gi,showHidePlaceholder:function(){this.child("message_editor").isEmpty()?this.editorPlaceholder.removeClass("hidden"):this.editorPlaceholder.addClass("hidden")},tweetLength:function(a){if(!a)return 0;var b=a.length,c=[];return a.replace(this.regexUrl,function(a,b){c.push(b)}),b-=c.join("").length,$.each(c,function(a,c){b+=c.match(/https:/)?23:22}),b+=23,b},updateShareEditorLinkDisplay:function(){var a=this.child("message_editor");a.removeAnchor(),this.isChecked(this.linkedinCheckbox)||this.isChecked(this.wordpressCheckbox)||this.isChecked(this.tumblrCheckbox)||this.isChecked(this.boardCheckbox)||this.isChecked(this.sendCheckbox)?this.editor.addClass("highlight-link"):this.editor.removeClass("highlight-link"),this.showHidePlaceholder()},checkboxValues:function(){var a=this,b={};return $.each(a.shareChannels,function(){b[this]=a.isChecked(a.$("#@"+this+"_checkbox"))}),b},atLeastOneChecked:function(a){var b=!1;return $.each(a,function(a,c){b=b||c}),b},uncheckAll:function(){var a=this;$.each(a.shareChannels,function(){a.$("#@"+this+"_checkbox").attr("checked",!1)}),a.disableSubmit()},disableSubmitIfNecessary:function(){var a=this.checkboxValues();!this.atLeastOneChecked(a)&&this.results.length===0&&this.disableSubmit()},connectWordpress:function(){var a=this;a._dialog=a.dialog().title(a.wordpress_connect_title).close().load("connect_wordpress")},checkWordpress:function(){this.wordpressCheckbox.attr("checked",!0),this.wordpressCheckbox.attr("disabled",!1),this.wordpressConnectLink.hide(),this.wordpressConnected=!0,this.updateShareEditorLinkDisplay(),this.enableSubmit()},checkTumblr:function(){this.tumblrCheckbox.attr("checked",!0),this.tumblrCheckbox.attr("disabled",!1),this.tumblrConnectLink.hide(),this.tumblrConnected=!0,this.updateShareEditorLinkDisplay(),this.enableSubmit()},checkLinkedin:function(){var a=this;a.linkedinCheckbox.attr("checked",!0),a.linkedinCheckbox.attr("disabled",!1),a.linkedinConnectLink.hide(),a.liUid=!0,a.updateShareEditorLinkDisplay(),a.enableSubmit()},updateResults:function(a){this.results=a,this.results.length>0||this.atLeastOneChecked(this.checkboxValues())?this.enableSubmit():this.disableSubmit()},setIsSubmission:function(a){this.isSubmission=a},hideDistroOptions:function(){},showDistroOptions:function(){},isChecked:function(a){return a.attr("checked")==="checked"}}))},{"app/view/share/connect":!0,window_manager:!0,webnode2:!0,"view/modal":!0,cookies:!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/hover_menu",function(require,a,b){require("jquery.whenIdle");var c=require("w2.quora").Component,d=require("Class").Class,e=require("log").log;a.HoverMenu=c.extend({onLoad:function(a){this.on=this.on||350,this.off=this.off||350,this.st=null,this.ht=null,this.loaded=this.loaded||this.should_preload_menu,this.loading=!1,this.shown=!1,this.cancelHover=!1,this.load_on_pageload&&a&&this.loadMenu(!0),this.registerClickHandlers(),this.maybeRegisterHoverHandlers()},registerClickHandlers:function(){if(this.click_open){var a=this;this.$("#@link").click(function(b){a.shown?(a.cancelHover=!0,a.doHide()):(a.cancelHover=!1,a.loadMenu(),a.doShow()),b.preventDefault()}),$(document).click(function(b){var c=a.isInvalidCloseTarget($(b.target));a.shown&&!c&&(a.cancelHover=!0,a.doHide())})}else this.$("#@link").click(this.fnbind(function(){this.cancelHover=!0,this.doHide()}))},isInvalidCloseTarget:function(a){var b=this.$("#@link");return a.is(b)||a.parents(b).is(b)?!0:!1},maybeRegisterHoverHandlers:function(){this.show_menu&&!this.click_open&&(this.$("#@link").hover(this.fnbind(function(){this.show()}),this.fnbind(function(){this.hide(),this.cancelHover=!1,this.$("#@link").removeClass("hover")})),this.$("#@menu").hover(this.fnbind(function(){this.show()}),this.fnbind(function(){this.hide()})))},setPosition:function(){if(!this.css_positioning){var a=this.$("#@link").outerHeight(),b=this.$("#@link").offset(),c=b,d=$(window).height(),e=275,f=c.top-$(window).scrollTop(),g=d-f<e,h=this.menu_offset_px?this.menu_offset_px:0;this.$("#@menu").removeAttr("style"),g?(this.attach_to_body?this.$("#@menu").css("bottom",d-b.top+h+"px"):this.$("#@menu").css("bottom",a+"px"),this.$("#@menu").addClass("hover_menu_above")):(this.attach_to_body?this.$("#@menu").css("top",b.top+a+1+h+"px"):this.$("#@menu").css("top",a+"px"),this.$("#@menu").removeClass("hover_menu_above"));if(this.attach_to_body){var i=$(window).width(),j=this.$("#@menu").outerWidth(),k=j+c.left,l=c.left,m=this.$("#@link").outerWidth();if(i<k){var n=k-i;this.alignment=="left"&&(l-=n+10)}this.alignment=="right"?this.$("#@menu").css("left",l-j+m+"px"):this.alignment=="center"?this.$("#@menu").css("left",l-j/2+m/2+"px"):this.$("#@menu").css("left",l+"px")}}},hide:function(){clearTimeout(this.st),this.ht=setTimeout(this.fnbind(this.doHide),this.off)},doHide:function(){if(!this.shown)return;this.shown=!1,this.$("#@link").removeClass("hover"),this.$("#@menu").addClass("animate_out"),setTimeout(this.fnbind(function(){this.shown||(this.$("#@menu").removeClass("animate_out"),this.$("#@menu").addClass("hidden"))}),150)},getKwargs:function(){return this.kwargs?this.kwargs:{}},okToShowHoverMenu:function(){return this.should_show_hover_menu&&this.$("#@menu").parents(".hover_menu_contents").length===0},show:function(){this.okToShowHoverMenu()&&this.showInner()},showInner:function(){clearTimeout(this.ht),this.st=setTimeout(this.fnbind(this.doShow),this.on),this.loadMenu(),this.$("#@menu").removeClass("animate_out"),this.$("#@link").addClass("hover")},doShow:function(){if(this.shown||this.cancelHover)return;this.shown=!0,!this.css_positioning&&!this.movedToBody&&this.attach_to_body&&(this.$("#@menu").detach().prependTo($("body")),this.movedToBody=!0),$(".GrowlNotification").hide(),this.$("#@menu").removeClass("hidden").show(),this.$("#@link").addClass("hover"),this.setPosition()},loadMenu:function(a){a===undefined&&(a=!1);var b=this.fnbind(function(){if(this.loaded||this.loading)return;e&&e.enabled&&e("Quora.HoverMenu.loadMenu",this.cid,"is loading, preload =",a),this.loading=!0,this.serverCall("load_menu").kwargs(this.getKwargs()).contentFor(this.$("#@menu_contents"),{parentCID:this.cid}).success(this.fnbind(function(b){e&&e.enabled&&e("Quora.HoverMenu.loadMenu",this.cid,"is loaded, preload =",a),this.loaded=!0,this.loading=!1})).except(this.fnbind(function(b){e&&e.enabled&&e("Quora.HoverMenu.loadMenu",this.cid,"is failed to load, preload =",a),this.loading=!1})).send()});a?$.whenIdle(1,1e3,b,"Quora.HoverMenu.loadMenu"):b()}}),a.ToggleableMenu=d.extend({__init__:function(a){this.$linkElem=a.$linkElem,this.$menuElem=a.$menuElem,this.loadFunction=a.loadFunction;if(!(this.$linkElem&&this.$menuElem&&this.loadFunction))throw new Error("Invalid kwargs given: "+a);this.useCssPositioning=a.useCssPositioning||!1,this.shouldAttachToBody=a.shouldAttachToBody||!0,this.menuOffsetPx=a.menuOffsetPx||0,this.alignment=a.alignment||"left",this.clickOpen=a.clickOpen||!1,this.showDelayMs=a.showDelayMs||350,this.hideDelayMs=a.hideDelayMs||350,this.shown=!1,this.movedToBody=!1,this.cancelHover=!1,this.hideTimeout=null,this.showTimeout=null,this.registerHoverHandlers(),this.registerClickHandlers()},registerHoverHandlers:function(){if(this.clickOpen)return;this.$linkElem.hover(this.showMenuSlow.bind(this),function(){this.hideMenuSlow(),this.cancelHover=!1,this.$linkElem.removeClass("hover")}.bind(this)),this.$menuElem.hover(this.showMenuSlow.bind(this),this.hideMenuSlow.bind(this))},registerClickHandlers:function(){this.clickOpen?(this.$linkElem.click(this.toggleMenu.bind(this)),$(document).on("click",this.maybeHideMenu.bind(this))):this.$linkElem.click(this.hideMenu.bind(this))},toggleMenu:function(a){a.preventDefault(),this.shown?(this.cancelHover=!0,this.hideMenu()):(this.cancelHover=!1,this.loadFunction(),this.showMenu())},maybeHideMenu:function(a){var b=a.target,c=this.$linkElem.get(0);if(b==c||b.parentNode==c)return;this.hideMenu()},hideMenuSlow:function(){clearTimeout(this.showTimeout),this.hideTimeout=setTimeout(this.hideMenu.bind(this),this.hideDelayMs)},hideMenu:function(){if(!this.shown)return;this.cancelHover=!0,this.shown=!1,this.$linkElem.removeClass("hover"),this.$menuElem.addClass("animate_out"),setTimeout(function(){if(this.shown)return;this.$menuElem.removeClass("animate_out"),this.$menuElem.addClass("hidden")}.bind(this),150)},shouldShowMenu:function(){return this.$menuElem.parents(".hover_menu_contents").length===0},showMenuSlow:function(){if(!this.shouldShowMenu())return;clearTimeout(this.hideTimeout),this.showTimeout=setTimeout(this.showMenu.bind(this),this.showDelayMs),this.loadFunction(),this.$menuElem.removeClass("animate_out"),this.$linkElem.addClass("hover")},showMenu:function(){if(this.shown||this.cancelHover)return;this.shown=!0,this.moveMenuToBody(),$(".GrowlNotification").hide(),this.$menuElem.removeClass("hidden").show(),this.$linkElem.addClass("hover"),this.setPosition()},moveMenuToBody:function(){if(this.useCssPositioning||this.movedToBody||!this.shouldAttachToBody)return;this.movedToBody=!0,this.$menuElem.detach().prependTo($("body"))},setPosition:function(){if(!this.useCssPositioning){var a=$(window),b=this.$linkElem.outerHeight(),c=this.$linkElem.offset(),d=c,e=a.height(),f=275,g=d.top-a.scrollTop(),h=e-g<f;this.$menuElem.removeAttr("style"),h?(this.shouldAttachToBody?this.$menuElem.css("bottom",e-c.top+this.menuOffsetPx+"px"):this.$menuElem.css("bottom",b+"px"),this.$menuElem.addClass("hover_menu_above")):(this.shouldAttachToBody?this.$menuElem.css("top",c.top+b+1+this.menuOffsetPx+"px"):this.$menuElem.css("top",b+"px"),this.$menuElem.removeClass("hover_menu_above"));if(this.shouldAttachToBody){var i=a.width(),j=this.$menuElem.outerWidth(),k=j+d.left,l=d.left,m=this.$linkElem.outerWidth();if(i<k){var n=k-i;this.alignment=="left"&&(l-=n+10)}this.alignment=="right"?this.$menuElem.css("left",l-j+m+"px"):this.alignment=="center"?this.$menuElem.css("left",l-j/2+m/2+"px"):this.$menuElem.css("left",l+"px")}}}})},{log:!0,Class:!0,"jquery.whenIdle":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/editable_list",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings;a.EditableList=c.extend({onLoad:function(){var a=this;a.setEditLink(),setTimeout(function(){a.update()},1),a.initState(),a.bindClickHandler()},setEditLink:function(){this.editLink=this.$("#@edit")},initState:function(){this.editLink.removeClass("hidden")},bindClickHandler:function(){this.editLink.click(this.fnbind(function(a){a.preventDefault(),this.toggleEdit()}))},toggleEdit:function(){this.is_editing=!this.is_editing,this.update()},update:function(){this.is_editing?(this.$("#@wrapper").addClass("is_editing"),this.editLink.text(d.done)):(this.$("#@wrapper").removeClass("is_editing"),this.editLink.text(this.edit_text))}}),a.EditableListItem=c.extend({onLoad:function(){this.$("#@remove").click(this.fnbind(function(a){this.serverCall("remove").liveMutate().send()}))}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/nux",function(require,a,b){var c=require("w2.quora").Component;a.ProgressBar=c.extend({onLoad:function(){this.$("#@progress_bar").css({width:this.getWidth()})},getWidth:function(){var a=parseInt(this.$("#@progress_bar_wrapper").css("min-width"),10),b=parseInt(this.$("#@progress_bar_wrapper").css("max-width"),10),c=this.curr/this.total*b;return Math.min(b,Math.max(c,a))},update:function(a){this.curr=a,this.$("#@progress_bar").animate({width:this.getWidth()})}}),a.ProgressBarBeacon=c.extend({onLoad:function(){this.lookup("progress_bar").update(this.curr)}}),a.HeaderProgressBarBeacon=c.extend({onLoad:function(){this.cQuery(":dialog.header_progress_bar").update(this.curr)}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/nux/dialog",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2");a.SetPasswordForm=c.extend({onLoad:function(){this.$("#@password").focus(),this.$("#@form").submit(this.fnbind(this.onSubmit)),this.validPassword=!1,this.$("#@password").keyup(this.fnbind(this.onKeyup))},onKeyup:function(){var a=this,b=a.$("#@password").val().length;b<=2?(a.$("#@form").find(".error, .success").addClass("hidden"),a.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")):b<5?(a.$("#@form").find(".error").removeClass("hidden"),a.$("#@form").find(".success").addClass("hidden"),a.validPassword=!1,a.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")):b>75?(a.$("#@form").find(".error").removeClass("hidden"),a.$("#@form").find(".success").addClass("hidden"),a.validPassword=!1,a.$("#@submit").attr("disabled","disabled").addClass("submit_button_disabled")):(a.$("#@form").find(".error").addClass("hidden"),a.$("#@form").find(".success").removeClass("hidden"),a.validPassword=!0,a.$("#@submit").removeAttr("disabled").removeClass("submit_button_disabled"))},validate:function(){var a=this.$("#@password").val().length;return a<5||a>75?!1:(this.child("password_validator").validate(),!0)},onSubmit:function(){var a=this;return a.validPassword?(a.$("#@spinner").show(),a.$("#@form").find(".password_state").addClass("hidden"),a.serverCall("set_password").kwargs({password:a.$("#@password").val()}).success(function(){a.parent().onPasswordSet(!0)}).error(function(){a.parent().onPasswordSet(!1)}).send(),!1):!1}}),a.ModalNuxDialogCloseIndicator=c.extend({onLoad:function(){$(document).trigger("nux_dialog_close");var a=this.lookup("paged_feed",!0);a&&(a.dontLogImpressions=!1)}}),a.ModalNuxDialog=c.extend({onLoad:function(a){this.lastStep=null;var b=this.lookup("paged_feed",!0);b&&(b.dontLogImpressions=!0),a&&this.serverCall("log_impression").send(),$(window).height()<600&&$(".dialog .dialog_wrapper").css("position","static")},hide:function(){this.$("#@modal_nux_wrapper").hide()}}),a.InternalModalNuxDialogRenderer=a.ModalNuxDialog.extend({onLoad:function(a){var b=this;this.curr_step=this.step_num,$("body").keydown(this.fnbind(function(a){a.keyCode==37&&b.curr_step>0?b.changeStep(b.curr_step,--b.curr_step):a.keyCode==39&&b.curr_step<b.num_steps-1&&b.changeStep(b.curr_step,++b.curr_step)})),this.$("#@modal_nux_wrapper .step_name").click(function(){if(!$(this).hasClass("curr_step")){var a=parseInt($(this).attr("id"));b.changeStep(b.curr_step,a),b.curr_step=a}})},changeStep:function(a,b){this.$("#@modal_nux_wrapper .dialog_wrapper.step_"+a).parent().addClass("hidden"),this.$("#@modal_nux_wrapper .step_name.step_name_"+a).removeClass("curr_step"),this.$("#@modal_nux_wrapper .dialog_wrapper.step_"+b).parent().removeClass("hidden"),this.$("#@modal_nux_wrapper .step_name.step_name_"+b).addClass("curr_step")}}),a.NuxDialogStep=c.extend({onLoad:function(){this.serverCall("record_step").kwargs({step_name:this.step_name+"_impr"}).send()},gotoStep:function(a){this.cQuery(":dialog.header_progress_bar").update(a),this.serverCall("goto_step").kwargs({step_num:a}).liveMutate().send()},closeDialogAndGoToStep:function(a){this.dialog_close=!1;if(a>this.num_steps){var b=this.lookup("dialog",!0);b&&b.hide(),$(document).trigger("nux_dialog_close"),this.dialog_close=!0}this.gotoStep(a)},gotoNextStep:function(){this.closeDialogAndGoToStep(this.step_num+1)},skipNextStep:function(){var a=this.step_num+2;this.dialog_close=!1,a<=this.num_steps?this.cQuery(":dialog.header_progress_bar").update(this.step_num+1):(this.lookup("dialog").hide(),$(document).trigger("nux_dialog_close"),this.dialog_close=!0),this.serverCall("skip_step").kwargs({step_num:this.step_num+1}).liveMutate().send()},stepUrl:function(a){return"#step="+a},standaloneRefreshFeed:function(){this.serverCall("standalone_refresh_feed").liveMutate().send()}}),a.NuxDialogSetPasswordStep=a.NuxDialogStep.extend({onPasswordSet:function(a){this.gotoNextStep()}}),a.NuxDialogSiloActivationStep=a.NuxDialogStep.extend({onActivate:function(){this.gotoNextStep()}}),a.NuxDialogRefreshFeedStep=a.NuxDialogStep.extend({onLoad:function(){this._super.apply(this,arguments),this.serverCall("refresh_feed").liveMutate().success(this.fnbind(function(){return this.delayed_next_step(),!1})).error(this.fnbind(function(){return this.delayed_next_step(),!1})).send()},delayed_next_step:function(){this.page_context!="internal_page"&&setTimeout(this.fnbind(this.gotoNextStep),5500)},gotoStep:function(a){this.serverCall("goto_step").kwargs({step_num:a}).send()}}),a.PowerUserFindFriendsStep=a.NuxDialogStep.extend({maybeLoadFollowFriendsDialog:function(){var a=this;this.serverCall("should_load_follow_dialog").success(function(b){b?a._loadFollowDialog():a._closeDialog()}).error(this._closeDialog).send()},_loadFollowDialog:function(){this._closeDialog
(),this.dialog(!1).close(null).title(this.dialog_title).load("get_follow_friends_dialog")},_closeDialog:function(){var a=require("webnode2").Dialog.dialogFor(this);a.close_()}}),a.NuxDialogContinueButton=c.extend({events:{"click #@next":"onClick"},onLoad:function(){this.standalone&&(this.standalone_dialog=this.lookup("standalone"),this.dialog_step=this.parent())},finishStep:function(){this.$("#@next").hasClass("submit_button_disabled")||(this.standalone?(this.dialog_step.standaloneRefreshFeed(),d.Dialog.dialogFor(this.standalone_dialog).close_()):this.parent()&&this.parent().gotoNextStep())},onClick:function(){return this.finishStep(),!1}}),a.NuxDialogInferredFriendsContinueButton=a.NuxDialogContinueButton.extend({events:{"click #@next":"onClick"},onLoad:function(){this._super.apply(this,arguments),this.fuid_map={};for(var a=0;a<this.unchecked_fuids.length;++a)this.fuid_map[this.unchecked_fuids[a]]=!1;for(var b=0;b<this.checked_fuids.length;++b)this.fuid_map[this.checked_fuids[b]]=!0},onClick:function(a){a.preventDefault(),this.serverCall("button_clicked").kwargs({fuid_map:this.fuid_map,prechecked_fuids:this.checked_fuids}).success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},add:function(a){this.fuid_map[a]=!0},remove:function(a){this.fuid_map[a]=!1},addAll:function(){for(var a in this.fuid_map)this.add(a)},removeAll:function(){for(var a in this.fuid_map)this.remove(a)}}),a.NewNuxDialogSkipButton=a.NuxDialogContinueButton.extend({events:{"click #@next":"onClick"},onClick:function(a){a.preventDefault(),this.serverCall("button_clicked").success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},finishStep:function(){this.$("#@next").hasClass("submit_button_disabled")||(this.standalone?d.Dialog.dialogFor(this).close_():this.parent()&&this.parent().gotoNextStep())}}),a.NuxDialogFollowMinimumTopicsContinueButton=a.NuxDialogContinueButton.extend({onClick:function(a){a.preventDefault();if(this.$("#@next").hasClass("submit_button_disabled"))return!1;this.serverCall("button_clicked").kwargs({tids:this.lookup("dynamic_topic_grid").newTids}).liveMutate().success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()},finishStep:function(){this.standalone?d.Dialog.dialogFor(this.standalone_dialog).close_():this._super.apply(this,arguments)},updateButton:function(a){var b=this.min_interests-a;b>=1?this.$("#@next").addClass("submit_button_disabled").text(this.num_topics_texts[b]):this.$("#@next").removeClass("submit_button_disabled").text(this.button_continue_text)}}),a.DynamicTopicGrid=c.extend({newTids:[],onLoad:function(){this.newTids=[]},addTopic:function(a){this.followedTids.push(a),this.newTids.push(a),this.updateContinueButton()},addRow:function(a){this.$("#@more").append('<span class="new_items"></span>');var b=this.$("#@more").children(".new_items").last();this.serverCall("load_row").kwargs({tid:a}).contentFor(b,{parentCID:this.cid}).sendOnlyOnce()},getFollowingCount:function(){return this.followedTids.length},removeTopic:function(a){var b=$.inArray(a,this.followedTids);b!=-1&&this.followedTids.splice(b,1),this.updateContinueButton(),b=$.inArray(a,this.newTids),b!=-1&&this.newTids.splice(b,1)},updateContinueButton:function(){this.lookup("continue_button").updateButton(this.getFollowingCount())}}),a.DynamicInterestsGrid=a.DynamicTopicGrid.extend({addTopic:function(a){this._super.apply(this,arguments),this.addRow(a)}}),a.InterestsGridItems=c.extend({onLoad:function(){var a=this.new_tids;for(var b=0;b<a.length;b++)this.lookup("dynamic_topic_grid").shownTids.push(a[b])}}),a.ExpertiseTopicListItemRemoveButton=c.extend({onLoad:function(){this.$("#@expertise-remove-button").click(this.fnbind(this.dismiss))},dismiss:function(a){return a.preventDefault(),this.serverCall("remove_expertise_topic").kwargs({tid:this.tid}).liveMutate().send(),!1}}),a.NuxDialogFollowExpertiseContinueButton=a.NuxDialogFollowMinimumTopicsContinueButton.extend({onClick:function(a){a.preventDefault(),this.serverCall("button_clicked").liveMutate().success(this.fnbind(this.finishStep)).error(this.fnbind(this.finishStep)).send()}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/nux/existing_user",function(require,a,b){var c=require("w2.quora").Component;a.ExistingUserNuxSidebar=c.extend({onLoad:function(){this.serverCall("track_impression").send()}}),a.ExistingUserNuxButton=c.extend({onLoad:function(){this.$("#@existing-user-nux").click(this.fnbind(this.initate))},initate:function(a){return a.preventDefault(),this.serverCall("start_existing_user_nux").liveMutate().send(),!1}}),a.ExistingUserNuxDismiss=c.extend({onLoad:function(){this.$("#@existing-user-nux-dismiss").click(this.fnbind(this.dismiss))},dismiss:function(a){return a.preventDefault(),this.serverCall("dismiss_existing_user_nux").liveMutate().send(),!1}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/nux/find_friends",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("twitter"),f=require("facebook"),g=require("view/paged_list").PagedList;a.FacebookFindFriendsButton=f.FacebookConnectButton.extend({events:{"click #@facebook_follow_button":"onClick"},onClick:function(){return f.isInitialized()&&(this.serverCall("button_clicked").send(),this.connect()),!1},onLogin:function(a){this.showLoading(),this._super.apply(this,arguments)},closeDialog:function(){this.trigger("fb_connected"),this.standalone&&(d.Dialog.dialogFor(this).close_(),this.parent()&&this.parent().standaloneRefreshFeed())},_onLogin:function(a){var b=this.serverCall("connect_facebook").kwargs({fb_access_token:a.accessToken,fb_uid:a.userID,expires:a.expiresIn});this.live_mutate&&b.liveMutate(),b.success(this.fnbind(this.closeDialog)).error(this.fnbind(this.closeDialog)).send()},onLoginFailed:function(){this.serverCall("record_connect_failure").send()},showLoading:function(){this.$("#@normal_text").hide(),this.$("#@loading_text").show(),this.$("#@row").addClass("complete")}}),a.FacebookFindFriendsAndContinueButton=a.FacebookFindFriendsButton.extend({onLoginFailed:function(){this.standalone?d.Dialog.dialogFor(this).close_():this.serverCall("login_failed").liveMutate().send(),this.serverCall("record_connect_failure").send()}}),a.PowerUserFacebookFindFriendsAndContinueButton=a.FacebookFindFriendsAndContinueButton.extend({onLoginFailed:function(){d.Dialog.dialogFor(this).close_(),this.serverCall("record_connect_failure").send()},_onLogin:function(a){this.serverCall("connect_facebook").kwargs({fb_access_token:a.accessToken,fb_uid:a.userID,expires:a.expiresIn}).success(this.fnbind(this.closeDialogSuccess)).error(this.fnbind(this.closeDialog)).send()},closeDialog:function(){d.Dialog.dialogFor(this).close_()},closeDialogSuccess:function(){this.lookup("power_user_find_friends_dialog").maybeLoadFollowFriendsDialog()}}),a.FriendFollowIndicatorLink=c.extend({events:{"click #@toggle":"onClick"},onLoad:function(){this.toggle=this.$("#@toggle"),this.continue_button=this.lookup("continue_button")},onClick:function(){this.$("#@toggle").toggleClass("selected"),this.$("#@toggle").toggleClass("unselected"),this.toggle.hasClass("selected")?this.continue_button.add(this.fuid):this.continue_button.remove(this.fuid),$(document).trigger("friendFollowChanged")}}),a.FriendToggleCheckbox=c.extend({events:{"click #@friend_row":"onClick"},onLoad:function(){this.checkbox=this.$("#@friend_row").find(":checkbox"),this.checkbox.change(this.fnbind(function(){this.checkbox.prop("checked",!this.checkbox.prop("checked"))})),this.continue_button=this.lookup("continue_button")},onUnload:function(){this.checkbox.unbind()},onClick:function(){this.checkbox.prop("checked",!this.checkbox.prop("checked")),this.checkbox.prop("checked")?(this.continue_button.add(this.fuid),this.$("#@friend_row").find(".follow_button").addClass("unfollow_button").text("â")):(this.continue_button.remove(this.fuid),this.$("#@friend_row").find(".follow_button").removeClass("unfollow_button").text(this.follow_text))}}),a.UnfollowedInferredFriendsToggleLink=c.extend({events:{"click #@add":"onAddClick","click #@remove":"onRemoveClick"},onLoad:function(){this.friends_list=$(this.lookup("inferred_friends_dialog").$("#@friends_list")),this.continue_button=this.lookup("continue_button")},changeAll:function(a){this.friend_toggles.prop("checked",a),a===!0?this.friends_list.find(".follow_button").addClass("unfollow_button").text("â"):this.friends_list.find(".follow_button").removeClass("unfollow_button").text(this.follow_text)},updateFriendsList:function(){if(!this.action)return;this.friend_toggles=this.friends_list.find(":checkbox"),this.changeAll(this.action=="add_all"?!0:!1)},onAddClick:function(){this.friend_toggles=this.friends_list.find(":checkbox"),this.action="add_all",this.changeAll(!0),this.friends_list.find(".follow_toggle").addClass("selected"),this.friends_list.find(".follow_toggle").removeClass("unselected"),this.$("#@add").hide(),this.$("#@remove").show(),this.continue_button.addAll(),this.serverCall("button_clicked").kwargs({button_name:this.action}).send()},onRemoveClick:function(){this.friend_toggles=this.friends_list.find(":checkbox"),this.action="remove_all",this.changeAll(!1),this.friends_list.find(".follow_toggle").addClass("unselected"),this.friends_list.find(".follow_toggle").removeClass("selected"),this.$("#@add").show(),this.$("#@remove").hide(),this.continue_button.removeAll(),this.serverCall("button_clicked").kwargs({button_name:this.action}).send()}}),a.InferredFriendsList=g.extend({onUpdate:function(a){this._super.apply(this,arguments);var b=this.lookup("select_all_toggle");b&&b.updateFriendsList()}})},{webnode2:!0,twitter:!0,"view/paged_list":!0,facebook:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/endorsement",function(require,a,b){var c=require("w2.quora").Component;a.EndorsementListItem=c.extend({onLoad:function(){this.$("#@remove_endorsement").click(this.fnbind(this.remove))},remove:function(a){a.preventDefault(),this.serverCall("remove_endorsement").liveMutate().sendOnlyOnce()}}),a.AcceptEndorsementTopicButton=c.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(this.accept))},accept:function(a){a.preventDefault(),this.serverCall("accept").liveMutate().sendOnlyOnce()}}),a.DeclineEndorsementTopicButton=c.extend({onLoad:function(){this.$("#@decline").click(this.fnbind(this.decline))},decline:function(a){a.preventDefault(),this.serverCall("decline").liveMutate().sendOnlyOnce()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/endorsement/modal",function(require,a,b){var c=require("w2.quora").Component;a.EndorsedTopicsModalLink=c.extend({onLoad:function(){this.$("#@create_modal_link").click(this.fnbind(function(a){a.preventDefault(),this.modal("load_inner")}))}}),a.UserTopicEndorsementsLink=c.extend({onLoad:function(){this.$("#@create_modal_link").click(this.fnbind(function(a){a.preventDefault(),this.modal("load_inner")})),this.$("#@endorse_link").click(this.fnbind(function(a){a.preventDefault(),this.serverCall("endorse_user").liveMutate().send()})),this.$("#@unendorse_link").click(this.fnbind(function(a){a.preventDefault(),this.serverCall("unendorse_user").liveMutate().send()}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/endorsement/endorse_by_topic",function(require,a,b){var c=require("w2.quora").Component,d=0;a.EndorseByTopicSidebarNextButton=c.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(a){a.preventDefault(),this.lookup("content").nextTopic()}}),a.EndorsementPeopleSelectorContainer=c.extend({onLoad:function(){this.lookup("people_selector").addQuestionBoxClass("ignore_interaction")},setTo:function(a){if(isNaN(parseInt(a)))return;this.lookup("people_selector").reset(),this.addEndorsement(a)},addEndorsement:function(a){this.serverCall("add_endorsement").kwargs({to_uid:a}).send()}}),a.EndorseByTopicSidebarContent=c.extend({onLoad:function(){this.topicShown&&(this.serverCall("track_impression").sendOnlyOnce(),d++,d>1&&this.$("#@activation_sidebar_content").find(".question_box").focus())},nextTopic:function(){this.serverCall("next_topic").liveMutate().sendOnlyOnce()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/endorsement/endorse_by_user",function(require,a,b){var c=require("w2.quora").Component,d=0;a.EndorseByUserSidebarNextButton=c.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(a){a.preventDefault(),this.lookup("content").nextUser()}}),a.EndorseByUserSidebarContent=c.extend({onLoad:function(){this.userShown&&(this.serverCall("track_impression").sendOnlyOnce(),d++,d>1&&this.$("#@activation_sidebar_content").find(".question_box").focus())},nextUser:function(){this.serverCall("next_user").liveMutate().sendOnlyOnce()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/profile_topics",function(require,a,b){var c=0,d=require("w2.quora").Component;a.CompleteProfileSidebarNextButton=d.extend({onLoad:function(){this.$("#@sidebar-header-button").click(this.fnbind(this.next))},next:function(a){a.preventDefault(),this.lookup("content").completeStep()}}),a.CompleteProfileContents=d.extend({onLoad:function(){this.serverCall("track_impression").send()},completeStep:function(){this.serverCall("complete_topic_step").liveMutate().sendOnlyOnce()}}),a.CompleteProfileTopicSelectorContainer=d.extend({onLoad:function(){c++,c>1&&this.$("#@topic_selector_container").find(".question_box").focus()}}),a.TopicStepListItem=d.extend({onLoad:function(){this.$("#@remove_button").click(this.fnbind(this.remove))},remove:function(a){a.preventDefault(),this.serverCall("remove_topic").liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/progress",function(require,a,b){var c=require("w2.quora").Component;a.ProgressBar=c.extend({onLoad:function(){var a=this;a.getMaxWidth()===0?setTimeout(function(){a.initialize()},1):a.initialize()},getMaxWidth:function(){return this.$("#@progress_bar_wrapper").width()},initialize:function(){this.$("#@progress_bar").css({width:this.getWidth()})},getWidth:function(){var a=this.getMaxWidth(),b=this.curr/this.total*a;return Math.min(a,b)},update:function(a){this.curr=a,this.$("#@progress_bar").animate({width:this.getWidth()})}}),a.ProgressBarBeacon=c.extend({onLoad:function(){this.lookup("progress_bar").update(this.curr)}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/activation/topic_bios",function(require,a,b){var c=require("w2.quora").Component;a.TopicBiosContents=c.extend({onLoad:function(){this.serverCall("track_impression").send()}}),a.TopicStepListItem=c.extend({onLoad:function(){this.$("#@remove_button").click(this.fnbind(this.remove))},remove:function(a){a.preventDefault(),this.serverCall("remove_topic").liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/group",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.GroupAnnouncementItem=c.extend({onLoad:function(){this.$("#@announcement_title").click(this.fnbind(function(){$(".announcement_editor").addClass("hidden"),$(".announcement_item").removeClass("hidden"),$(".editor_view").addClass("hidden"),$(".current_view").removeClass("hidden"),this.$("#@announcement_item").addClass("hidden"),this.$("#@announcement_editor").removeClass("hidden")}))}}),a.LeaveGroupDialog=require("dialog").Dialog.extend({onLoad:function(a){this._super.apply(this,arguments),this.setSuccessCallback(this.fnbind(function(a){a&&d.navigateTo(a)}))}}),a.PostGroupAnnouncement=c.extend({onLoad:function(){this.$("#@title").focus(),this.$("#@title").keyup(this.fnbind(function(){this.checkOkToPost()})),this.$("#@post_announcement").click(this.fnbind(function(){return this.postAnnouncement(),!1}))},checkOkToPost:function(){return this.getTitle()?(this.enableSubmit(),!0):(this.disableSubmit(),!1)},enableSubmit:function(){this.$("#@post_announcement").removeClass("submit_button_disabled")},disableSubmit:function(){this.$("#@post_announcement").addClass("submit_button_disabled")},getTitle:function(){return this.$("#@title").val()||null},getContent:function(){return this.child("editor").serialize()||null},postAnnouncement:function(){var a={title:this.getTitle(),content:this.getContent()};a&&this.serverCall("post").kwargs(a).liveMutate().send()}}),a.GroupAnnouncementsUpdateMain=c.extend({onLoad:function(){this.announcements=this.$("#@announcements"),this.cQuery(":update.editor").whenOnLoaded(this.fnbind(function(){this.current_content=this.getContent()})),this.current_title=this.getTitle(),this.lookup("content").registerTextArea(this.child("update").$("#@title")),this.lookup("content").registerTextArea(this.cQuery(":update.editor").$("#@editor")),this.child("update").$("#@title").keyup(this.fnbind(function(){this.checkOkToUpdate()})),this.cQuery(":update.editor").$("#@editor").keyup(this.fnbind(function(){this.checkOkToUpdate()})),this.$("#@update_announcement").click(this.fnbind(function(){return this.updateGroupAnnouncement(),!1})),this.$("#@remove_announcement").tooltip({contents:"Remove announcement"}),this.$("#@remove_announcement").click(this.fnbind(function(){return this.removeGroupAnnouncement(),!1}))},checkOkToUpdate:function(){return this.hasNewTitle()||this.hasNewContent()?(this.enableSubmit(),!0):(this.disableSubmit(),!1)},enableSubmit:function(){this.$("#@update_announcement").removeClass("submit_button_disabled")},disableSubmit:function(){this.$("#@update_announcement").addClass("submit_button_disabled")},updateGroupAnnouncement:function(){var a={title:this.getTitle(),content:this.getContent()};a&&this.serverCall("update").kwargs(a).success(this.fnbind(function(a){a&&(document.location=a),this.announcements.find(".editor_view").addClass("hidden"),this.announcements.find(".current_view").removeClass("hidden")})).liveMutate().send()},removeGroupAnnouncement:function(){this.serverCall("remove").success(this.fnbind(function(a){a&&(document.location=a)})).liveMutate().send()},getTitle:function(){return this.child("update").$("#@title").val()||null},getContent:function(){return this.cQuery(":update.editor").serialize()||null},hasNewTitle:function(){var a=this.getTitle();return $.trim(a)!=this.current_title},hasNewContent:function(){var a=this.getContent();return a.html!=this.current_content.html}})},{dialog:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("email",function(require,a,b){a.isValidEmail=function(){var a="[^\\x0d\\x22\\x5c\\x80-\\xff]",b="[^\\x0d\\x5b-\\x5d\\x80-\\xff]",c="[^\\x00-\\x20\\x22\\x28\\x29\\x2c\\x2e\\x3a-\\x3c\\x3e\\x40\\x5b-\\x5d\\x7f-\\xff]+",d="\\x5c[\\x00-\\x7f]",e="\\x5b("+b+"|"+d+")*\\x5d",f="\\x22("+a+"|"+d+")*\\x22",g=c,h="("+g+"|"+e+")",i="("+c+"|"+f+")",j=h+"(\\x2e"+h+")*",k=i+"(\\x2e"+i+")*",l=k+"\\x40"+j,m="^"+l+"$",n=new RegExp(m);return function(a){return n.test(a)}}()},{})}),require.whenReady("settings",function(){require.install("app/view/user/setup_",function(require,a,b){var c=require("w2.quora").Component;a.ChecklistStep=c.extend({onLoad:function(){this.$("#@step_link").click(this.fnbind(function(a){a.preventDefault();if(window.checklistDialogActive)return;window.checklistDialogActive=!0,this.short_name=="follow_topics"?this.dialog(!1).opt("width",720).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose)):this.dialog(!1).opt("width",500).opt("left","50%").opt("dialogClass","dialog_nux").load("get_step_dialog").close(this.fnbind(this.onDialogClose))}))},onDialogClose:function(){window.checklistDialogActive=!1,this.serverCall("mark_dialog_step_complete").send()}}),a.ChecklistLinkStep=c.extend({onLoad:function(){this.$("#@step_link").click(this.fnbind(function(){this.serverCall("log_link_click").send()}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/toggle_list",function(require,a,b){var c=require("w2.quora").Component,d=require("view/toggle");a.ToggledList=d.ToggledComponent.extend({onLoad:function(){var a=this.lookup("view_more_button",!0);a&&a.$("#@view_more_link").click(this.fnbind(function(){return this.toggle(),!1}))}}),a.ViewMoreLink=c.extend({onLoad:function(){this.$("#@view_more_link").click(this.fnbind(function(){this.$("#@view_more_link").addClass("hidden"),this.$("#@view_more_loading_text").removeClass("hidden")}))}})},{"view/toggle":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/reading_list",function(require,a,b){var c=require("w2.quora").Component;a.MarkAsReadButton=c.extend({onLoad:function(){var a=this;a.$("#@read_later").click(function(b){return b.preventDefault(),a.serverCall("unmark_as_read_later").liveMutate().send(),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/write",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("view/modal").Base;a.WriteMain=c.extend({onLoad:function(){var a=this,b=this.$("#@left_col_inner"),c=this.$("#@left_col");a.notifBanner||c.length>0&&b.length>0&&d.makeFixable(b,{min_height:c.outerHeight()+c.offset().top,min_width:990})}}),a.WritePageBatchActionLink=c.extend({onLoad:function(){var a=this;this.$("#@confirmation_dialogue").on("click",function(b){return a.modal("load_inner"),!1})}}),a.WritePageBatchActionConfirmationModal=e.extend({onLoad:function(){var a=this;this._super.apply(this,arguments)},onSubmit:function(){this.removeAll()},removeAll:function(){var a=this;this.serverCall("remove_all").liveMutate().success(function(b){a._closeModal()}).send()}})},{"view/fixable2":!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/upload",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("browser").browser,f=require("spin"),g=e.msie&&e.version<=9;a.UploadDialogContents=c.extend({onLoad:function(){var a=this;this.child("upload_form").success(this.fnbind(this.uploadSuccess)).failure(this.fnbind(this.uploadFailure));if(this.isBrowserOlderThanIE10())return this.$("#@drop_zone").removeClass("drop_zone"),this.child("drag_and_drop_form").$("#@drag_and_drop_form").hide(),!1;if(this.child("drag_and_drop_form")){a.addBodyDragoverListener();var b=function(b){b.stopPropagation(),b.preventDefault(),b.originalEvent.dataTransfer.dropEffect="copy",a.child("drag_and_drop_form").$("#@form_title").addClass("drag_and_hover"),a.$("#@drop_zone").addClass("drag_and_hover")},c=function(b){b.stopPropagation(),b.preventDefault(),a.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover"),a.$("#@drop_zone").removeClass("drag_and_hover")};this.child("drag_and_drop_form").setDropZone(this.$("#@drop_zone"),b,c),this.child("drag_and_drop_form").success(this.fnbind(this.uploadSuccess)).failure(this.fnbind(this.uploadFailure))}},onUnload:function(){this.removeBodyDragoverListener()},isBrowserOlderThanIE10:function(){return e.msie&&e.version<10},removeBodyDragoverListener:function(){$("document, body").unbind(".uploadDialog")},addBodyDragoverListener:function(){$("document, body").bind({"dragenter.uploadDialog":function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer;b.effectAllowed=b.dropEffect="none"},"dragover.uploadDialog":function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer;b.effectAllowed=b.dropEffect="none"}})},uploadSuccess:function(){},uploadFailure:function(){$(".drop_zone").removeClass("drag_and_hover"),this.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover"),this.child("upload_form").hideSpinner(),this.child("upload_form").lookup("editor",!0)&&this.cQuery(".upload_form:editor").$("#@spinner").hide()}}),a.InlineUploadWeb=c.extend({onLoad:function(){var a=this;a.$("#@download").click(this.fnbind(a.onClickDownload)),a.$("#@url").bind("input",function(){a.$("#@url").val()?a.$("#@download").removeClass("hidden"):a.$("#@download").addClass("hidden")})},onClickDownload:function(a){var b=this,c=b.$("#@url").focus().val(),d;c&&(b.$("#@download").off("click"),d=new Image,d.onload=function(){b.download(c)},d.onerror=function(){b.$("#@download").on("click",b.onClickDownload.bind(b)),a1ert(b.invalid_image_text),b.$("#@url").val("")},d.src=c),a.preventDefault(),a.stopPropagation()},download:function(){},focus:function(){this.$("#@url").focus()}}),a.InlineUploadPhotoWeb=a.InlineUploadWeb.extend({download:function(a){return this.serverCall("download").kwargs({target_id:this.target_id,target:this.target,url:a}).contentFor(this.lookup("upload_dialog").$("#@iframe"),{parentCID:this.cid}).liveMutate().except("image_error",this.fnbind(function(a){a1ert(a.message),d.Dialog.dialogFor(this).close_()})).except("thumbs_already_set",this.fnbind(function(){d.Dialog.dialogFor(this).close_()})).send(),this.cQuery(":upload_dialog").$("#@drop_zone").addClass("disabled"),this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").addClass("disabled"),!1}}),a.InlineUploadQTextImageWeb=a.InlineUploadWeb.extend({download:function(a){var b=d.Dialog.openerFor(this);d.Dialog.dialogFor(this).close_(),b.addImage(a)}}),a.UploadBaseForm=c.extend({onUpload:function(a){if(a&&!a.success){a.message&&a1ert(a.message),typeof this._uploadFailed=="function"&&this._uploadFailed(a);return}typeof this._upload=="function"&&this._upload(a)},success:function(a){return this._upload=a,this},failure:function(a){return this._uploadFailed=a,this},_uploadFiles:function(a){var b=this,c=this.$("#@form").get(0);if(g)$(document).one("quora_file_upload",function(a,c){b.onUpload(c)}),c.submit();else{var d=new FormData;$.each(c,function(a,b){b.type=="hidden"&&d.append(b.name,b.value)}),$.each(a,function(a,b){d.append("file",b)}),$.ajax({type:"POST",url:"/_/imgupload/upload_POST",data:d,processData:!1,contentType:!1,success:this.fnbind(this.onUpload),error:this.fnbind(function(a){var b={success:!1};a.status==413?b.message=this.too_large_error:b.message=this.upload_error,this.onUpload(b)})})}}}),a.UploadFileForm=a.UploadBaseForm.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.file_input=a.$("#@file"),a.file_button=a.$("#@file_button"),a.shouldShowUploadButton=!g&&a.file_button.length,a.spinner=f.createSpinnerDom({}),a.$("#@upload_spinner").append(a.spinner),a.file_input.on("change",function(){var b=a.$("#@file")[0].files;a.showSpinner(),a._uploadFiles(b)}),a.file_button.click(function(){a.file_input.click()}),a._showInput()},_showInput:function(){this.shouldShowUploadButton?(this.file_input.hide(),this.file_button.show()):(this.file_button.hide(),this.file_input.show())},_hideInput:function(){this.file_button.hide(),this.file_input.hide()},showSpinner:function(){this._hideInput(),this.$("#@upload_spinner").show(),this.lookup("upload_dialog")&&this.lookup("drag_and_drop_form",!0)&&(this.cQuery(":upload_dialog").$("#@drop_zone").addClass("disabled"),this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").addClass("disabled"))},hideSpinner:function(){this.$("#@upload_spinner").hide(),this._showInput(),this.lookup("upload_dialog")&&this.lookup("drag_and_drop_form",!0)&&(this.cQuery(":upload_dialog").$("#@drop_zone").removeClass("disabled"),this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").removeClass("disabled"))}}),a.DragAndDropForm=a.UploadBaseForm.extend({setDropZone:function(a,b,c){this.dropZoneElement=a,this.dropZoneElement.bind("dragover",b),this.dropZoneElement.bind("dragleave",c),this.addDropEventListener()},addDropEventListener:function(){this.dropZoneElement&&(this.onDropListener=this.fnbind(this.onDrop),this.dropZoneElement[0].addEventListener("drop",this.onDropListener,!1))},removeDropEventListener:function(){this.dropZoneElement&&this.dropZoneElement[0].removeEventListener("drop",this.onDropListener)},onUnload:function(){this.removeDropEventListener()},onDrop:function(a){if(a&&a.dataTransfer){var b=this.lookup("editor",!0);a.stopPropagation(),a.preventDefault(),$(".editor_wrapper .drop_zone").removeClass("drag_and_hover"),$(".editor_wrapper .drop_zone .target_box").addClass("hidden").removeClass("drag_and_hover"),this.lookup("upload_dialog",!0)&&this.cQuery(":upload_dialog.upload_form").showSpinner(),b&&b.$("#@spinner").show(),this._uploadFiles(a.dataTransfer.files)}},onUpload:function(){this._super.apply(this,arguments);var a=this.lookup("editor",!0);a&&a.$("#@spinner").hide()}}),a.EditPhotoDialogContents=a.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@from_facebook").click(this.fnbind(function(){this.fb_uid&&require("facebook").onInit(this.fnbind(function(){window.FB.api({method:"fql.query",query:"SELECT pic_big FROM user WHERE uid = "+this.fb_uid},this.fnbind(function(a){var b=a[0];b.pic_big?(this.$("#@view_web_upload").hide(),this.$("#@web_upload").hide(),this.$("#@from_facebook").hide(),this.lookup("upload_web").$("#@url").hide().val(b.pic_big),this.lookup("upload_web").$("#@download").click(),this.$("#@web_upload").show()):a1ert(this.no_fb_picture_error)}))}))}));var a=this;a.addBodyDragoverListener();var b=function(b){b.stopPropagation(),b.preventDefault(),b.originalEvent.dataTransfer.dropEffect="copy",a.child("drag_and_drop_form").$("#@form_title").addClass("drag_and_hover"),a.$("#@drop_zone").addClass("drag_and_hover")},c=function(b){b.stopPropagation(),b.preventDefault(),a.child("drag_and_drop_form").$("#@form_title").removeClass("drag_and_hover"),a.$("#@drop_zone").removeClass("drag_and_hover")};return this.child("drag_and_drop_form").setDropZone(this.$("#@drop_zone"),b,c),this.child("drag_and_drop_form").success(this.fnbind(this.uploadSuccess)),this.child("upload_form").success(this.fnbind(this.uploadSuccess)),!1},uploadSuccess:function(a){a.need_thumb_selection?this.serverCall("upload").kwargs({target_id:this.target_id,target:this.target}).contentFor(this.$("#@iframe"),{parentCID:this.cid}).send():d.Dialog.dialogFor(this).close_()}}),a.UploadQTextImageDialogContents=a.UploadDialogContents.extend({uploadSuccess:function(a){var b=d.Dialog.openerFor(this);d.Dialog.dialogFor(this).close_();for(var c=0;c<a.qimg_urls.length;c++)b.addImage(a.qimg_urls[c]);b.inputEntered()}})},{webnode2:!0,facebook:!0,browser:!0,spin:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/bug_report",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("view/upload");a.BugReportLink=c.extend({onLoad:function(){this.$("#@send_feedback").click(this.fnbind(function(a){a.preventDefault();var b=this;return b.should_hide_more_nav&&this.lookup("more_nav_item").doHide(),this._dialog=this.dialog({showXButton:!0,closeOnClickOut:!0,width:495}).title(b.dialog_title).close(function(){b._dialog=null}).load("dialog_contents"),!1}))},closeDialog:function(){this._dialog.close_()}}),a.BugReportDialog=e.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("editor").focus(),this.$("#@submit_feedback").click(this.fnbind(function(a){var b=this.lookup("editor").serialize(),c=this.$("#@photo_key").val();return this.serverCall("submit_feedback").kwargs({target:this.target,msg:b,photo_key:c}).success(this.fnbind(function(){return d.Dialog.openerFor(this).closeDialog(),!1})).sendOnlyOnce(),!1}))},uploadSuccess:function(a){this.$("#@photo_key").val(a.photo_key),this.serverCall("upload").kwargs({photo_key:a.photo_key,target:this.target}).contentFor(this.$("#@iframe"),{parentCID:this.cid}).send()}}),a.BugReportMain=e.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@submit_report").click(this.fnbind(function(a){var b=this.$("#@subject").val(),c=this.$("#@description").val(),d=this.$("#@photo_key").val(),e=this.$("#@project").val();return this.serverCall("submit_report").kwargs({target:this.target,subject:b,description:c,photo_key:d,project:e}).success(this.fnbind(function(a){window.location.reload()})).send(),!1}))},uploadSuccess:function(a){this.$("#@photo_key").val(a.photo_key),this.serverCall("upload").kwargs({photo_key:a.photo_key,target:this.target}).contentFor(this.$("#@upload_screenshot"),{parentCID:this.cid}).send()}}),a.BugReportTableCell=c.extend({onLoad:function(){this.$("#@delete_report").click(this.fnbind(function(a){return this.serverCall("delete_report").kwargs({report_id:this.report_id}).success(this.fnbind(function(a){window.location.
reload()})).send(),!1}))}})},{webnode2:!0,"view/upload":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/primary_topic",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.PrimaryTopicLink=c.extend({onLoad:function(){var a=this;this.$("#@add_primary_topic").click(this.fnbind(function(a){return a.preventDefault(),this.modal("load_modal"),!1})),this.$("#@remove_primary_topic").click(this.fnbind(function(a){a.preventDefault(),this.serverCall("clear_primary").liveMutate().send()}))}}),a.AddPrimaryTopicDialog=d.extend({onSubmit:function(){this._super.apply(this,arguments);var a=this.lookup("topic_selection"),b=a.getTopicNames();if(!b)return;this.serverCall("add").kwargs({topic_name:b[0],viewer_private:a.viewerPrivate}).liveMutate().send()}}),a.AddPrimaryTopicSelection=c.extend({onLoad:function(){this.setUpLabelClicks(),this.topic_added_index=0},setUpLabelClicks:function(){this.$("#@topic_list").find(".TopicRow").click(function(a){var b=$(this).find("input[type=radio]").eq(0);b.prop("checked",!0)})},getTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=radio]").each(function(b){$(this).is(":checked")&&a.push($(this).val())}),a},getAllTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=radio]").each(function(b){a.push($(this).val())}),a},newTopicAdded:function(a){var b=a.value;this.serverCall("new_topic_added").kwargs({topic_name:b}).contentFor(this.$("#@topic_added_"+this.topic_added_index),{parentCID:this.cid}).success(this.fnbind(function(){var b=this.$("#@topic_added_"+this.topic_added_index);b.show(),b.find(".TopicRow").click(function(a){var b=$(this).find("input[type=radio]").eq(0);b.prop("checked",!0)}),this.topic_added_index++,typeof a.id!="undefined"&&this.lookup("selector").addIgnoreOid(a.id)})).send()}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/voter_list",function(require,a,b){var c=require("w2.quora").Component;a.VoterListModalLink=c.extend({onLoad:function(){this.$("#@modal_link").click(this.fnbind(function(){return this.modal("load_inner",{kwargs:{object_id:this.object_id}}),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/share",function(require,a,b){var c=require("w2.quora").Component,d,e=a.ShareAction=c.extend({onLoad:function(){var a=this.$("#@share");this.onKeyCombination(a,"s",function(){return a.mouseover().click(),!1})},showDialog:function(){return this.modal("load_modal"),!1},events:{"click #@share":"showDialog"}}),f;a.AutoShowShareAction=e.extend({onLoad:function(){f=this},show:function(a){this.__js_init=a,setTimeout(this.fnbind(this.showDialog),1500)}}),a.showShareAction=function(a){f&&f.show(a)}},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/threaded_comments",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor,e=require("window_manager").isInHash,f=require("mathify").renderMath;a.TCommentListWrapper=c.extend({onLoad:function(a){var b=this;this.initState("visible",!0),this.first_level_all_loaded=!1,this.moreLink=this.$("#@comment_list_more_link"),this.isMoreLinkActive=!0,this.moreLink&&(this.offsetStep=this.offset,this.moreLink.on("click",function(){b.isMoreLinkActive&&(b.isMoreLinkActive=!1,b.pageComment())}))},pageComment:function(){this.serverCall("page_comment").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level,offset:this.offset,limit:this.offset+this.offsetStep}).success(this.fnbind(function(){this.isMoreLinkActive=!0,this.offset+=this.offsetStep,this.limit+=this.offsetStep,this.offset>=this.num_children&&this.moreLink.addClass("hidden")})).contentFor(this.$("#@comment_list_first_level_placeholder_"+this.offset),{parentCID:this.cid}).sendOnlyOnce()},hasSingleChild:function(){var a=this.child("t_comment_list");return a&&a.hasSingleChild()},focusAddRoot:function(){var a=this.child("t_comment_add_root");a&&a.focusEditor()},loadChildren:function(){this.lazy_load_children=!1,this.serverCall("load_child_list").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level}).success(this.fnbind(function(a){this.state("visible",!0)})).contentFor(this.$("#@comment_list_placeholder"),{parentCID:this.cid}).send()},loadAllFirstLevel:function(){this.first_level_all_loaded=!0,this.serverCall("load_all_first_level").kwargs({object_id:this.object_id,reply_to_id:this.reply_to_id,level:this.level}).contentFor(this.$("#@first_level_placeholder"),{parentCID:this.cid}).send()},stateHandlers:{highlighted:function(a){var b=this.$("#@comment_list"),c=b.hasClass("selected");if(arguments.length<1)return c;b.toggleClass("selected",a)},visible:function(a){var b=this.$("#@comment_list_wrapper"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a);var d=this.child("t_comment_list");if(d){var e=this.hasSingleChild(),f=!this.is_root;d.eachChildInAnyOrder(function(b){b.state("visible",a),a&&e&&f&&b.hasSingleChild&&b.hasSingleChild()&&b.state("expanded",!0)})}else a&&this.lazy_load_children&&this.loadChildren();a&&this.$("#@first_level_placeholder").size()>0&&!this.first_level_all_loaded&&this.loadAllFirstLevel()}}}),a.TCommentList=c.extend({hasSingleChild:function(){return this.children()&&this.children().length===1},eachChildInAnyOrder:function(a){var b=this.children();if(b)for(var c=0;c<b.length;c++)a(b[c])}}),a.TComment=c.extend({parentComment:function(){return this.parent().parent().parent()},clickHandlers:{delete_link:function(){this.deleteComment()},show_downvoted_link:function(){this.state("showDownvotedLinkVisible",!1)}},hasSingleChild:function(){var a=this.child("t_comment_list_wrapper");return a?a.hasSingleChild():!1},onLoad:function(){this.initState("expanded",!1),this.initState("showDownvotedLinkVisible",this.is_downvoted_and_hidden),this.initState("visible",!0),this.installMouseHandlers(),this.expandOnNotif(),f("@comment")},addNotifHighlight:function(a){a.addClass("highlighter");var b=!1,c=function(){var b=a.offset().top,c=b+a.height(),d=$(window).scrollTop(),e=d+$(window).height();return c>=d&&b<=e},d=c(),e=function(){b=!0};$(window).scroll(e);var f=setInterval(function(){if(b){var g=c();d&&!g&&(a.removeClass("highlighter"),clearInterval(f),$(window).unbind("scroll",e)),d=g,b=!1}},500)},expandOnNotif:function(){if(!this.initState("first_call",!0)&&e("comment"+this.id)){var a=[],b=this;while(!b.is_root)b=b.parentComment(),a.unshift(b);for(var c=0;c<a.length;c++)a[c].state("expanded",!0);this.addNotifHighlight(this.$("#@comment_highlight_wrapper"))}},deleteComment:function(){this.dialog().title(this.delete_dialog_title).cancel(null,this.delete_dialog_cancel_button_text).ok(this.fnbind(function(){this.serverCall("delete_comment").kwargs({cid:this.id,oid:this.object_id}).liveMutate().send()}),this.delete_dialog_title).html(this.delete_dialog_message)},stateHandlers:{expanded:function(a){var b=this.$("#@comment_inner"),c=b.hasClass("expanded");if(arguments.length<1)return c;b.toggleClass("expanded",a);var d=this.child("t_comment_replies_collapsed");d&&d.state("visible",!a);var e=this.child("t_comment_list_wrapper");e&&e.state("visible",a),this.$("#@comment").toggleClass("last_expanded",a&&this.is_last)},visible:function(a){var b=this.$("#@comment"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a)},showDownvotedLinkVisible:function(a){var b=this.$("#@show_downvoted_link_wrapper"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a),this.$("#@full_comment_text, #@footer_wrapper").toggleClass("hidden",a)}}}),a.TCommentReplyBox=c.extend({clickHandlers:{add_comment_link:function(){this._request()},cancel_link:function(){this._cancel()}},onLoad:function(a){this.initState("visible",!1),this.installMouseHandlers()},_cancel:function(a){this.state("visible",!1),this.lookup("t_comment_action_bar").state("visible",!0)},stateHandlers:{visible:function(a){var b=this.$("#@reply_box"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a);if(a){var d=this.lookup("editor");setTimeout(function(){d!==null&&d.focus()},0)}this.$("#@reply_box").toggleClass("parent_expanded",this.parent().state("expanded"))}},_request:function(){var a=this.lookup("editor");if(a.isEmpty())return;var b=a.serialize();this._cancel(),this.serverCall("add_comment").kwargs({oid:this.object_id,comment:b,reply_to_id:this.reply_to_id}).success(this.fnbind(function(b){this.parent().state("expanded",!0),a.clear()})).liveMutate().sendOnlyOnce()}}),a.TCommentAddRoot=c.extend({clickHandlers:{add_root_link:function(){this._request()}},onLoad:function(){this.installMouseHandlers()},focusEditor:function(){var a=this.lookup("editor");a.focus()},_request:function(){var a=this.lookup("editor");if(a.isEmpty())return;this.serverCall("add_comment").kwargs({oid:this.object_id,comment:a.serialize()}).success(this.fnbind(function(b){a.clear()})).liveMutate().sendOnlyOnce()}}),a.TCommentRepliesCollapsed=c.extend({clickHandlers:{show_child_link:function(a){this.parent().state("expanded",!0)}},onLoad:function(a){this.initState("visible",!this.parent().state("expanded")),this.installMouseHandlers()},stateHandlers:{visible:function(a){var b=this.$("#@show_child_link_wrapper"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a)}}}),a.TCommentActionBar=c.extend({vote:function(a,b){this.serverCall("comment_vote").kwargs({oid:this.object_id,cid:this.id,is_upvote:a,cancel:b}).liveMutate().sendOnlyOnce()},clickHandlers:{comment_downvote:function(){this.vote(!1,!1)},comment_upvote:function(){this.vote(!0,!1)},comment_downvote_cancel:function(){this.vote(!1,!0)},show_reply_box_link:function(){this.startEditing()},comment_upvote_cancel:function(){this.vote(!0,!0)}},startEditing:function(){this.state("visible",!1),this.lookup("t_comment_reply_box").state("visible",!0)},mouseDownHandlers:{show_reply_box_link:function(){this.startEditing()}},onLoad:function(a){this.initState("visible",!0),this.installMouseHandlers(),this.$("#@show_reply_box_link").focus(this.fnbind(this.startEditing))},stateHandlers:{visible:function(a){var b=this.$("#@action_bar"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a)}}}),a.TCommentFullTextInlineEditor=d.extend({onLoad:function(){this._super.apply(this,arguments),this.setToggleCallback(this.fnbind(function(){if(this.parent()){var a=this.lookup("t_comment_"+this.id);a&&a.$("#@comment_inner").toggleClass("comment_editor_focused")}}))}}),a.TCommentStandalone=c.extend({onLoad:function(){this.initState("expanded",!0),this.initState("comment_log_visible",!1),this.installMouseHandlers()},clickHandlers:{change_log_toggle:function(){this.state("comment_log_visible",!this.state("comment_log_visible"))}},stateHandlers:{expanded:function(a){var b=this.$("#@comments"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a);var d=this.child("t_comment_"+this.comment_id);if(!d)return;d.state("expanded",!0)},comment_log_visible:function(a){var b=this.$("#@comment_log"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a),this.$("#@view_label").toggle(!a)}}}),a.DeleteCommentButton=c.extend({onLoad:function(){this.$("#@delete").click(this.fnbind(function(a){return this.deleteComment(),!1}))},deleteComment:function(){this.serverCall("delete").liveMutate().send()}})},{"view/inline_editor":!0,mathify:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/notif",function(require,a,b){var c=require("w2.quora").Component;a.NotifQuestionLink=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this.serverCall("link_clicked_callback").send()}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("qtext",function(require,a,b){a.tooltip=function(a,b){return a=$(a),a.attr("data-tooltip")?!1:(a.attr("data-tooltip","attached"),a.tooltip({contents:b,parent_class:"external_link_tooltip",prepend:!0,align_center:!1}),setTimeout(function(){a.trigger("mouseenter")},10),!1)}},{})}),require.whenReady("settings",function(){require.install("app/view/thread",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor;a.ThreadComposeMessageBox=c.extend({onLoad:function(){this.$("#@submit").click(this.fnbind(function(){return this.lookup("editor").request(),!1}))}}),a.ThreadMessageInlineEditor=d.extend({trigger_request:function(){this.typing_area&&this.lookup("editor").stopTyping(),this.lookup("editor").request(),this.lookup("editor").resetThreadDetailHeight()},server_call_method:"UNDEFINED_SERVER_CALL_METHOD",_get_kwargs:function(){throw $.serverLog("Tried to call ThreadMessageInlineEditor#_get_kwargs()","ERROR"),"UNDEFINED_KWARGS"}})},{"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/topic_ontology",function(require,a,b){var c=require("w2.quora").Component;a.AddTopicParents=c.extend({onLoad:function(){this.$("#@existing_link").click(this.fnbind(function(a){a.preventDefault(),this.$("#@existing_link").addClass("hidden"),this.$("#@existing").removeClass("hidden"),this.lookup("parent_selector").focus()}))}}),a.AddTopicChildren=c.extend({onLoad:function(){this.$("#@existing_link").click(this.fnbind(function(a){a.preventDefault(),this.$("#@existing_link").addClass("hidden"),this.$("#@existing").removeClass("hidden"),this.lookup("child_selector").focus()}))}}),a.OrganizeChildItem=c.extend({toggleInstruction:function(){this.$("#@instruction").toggleClass("hidden")}}),a.ManageParentTopicsLink=c.extend({onLoad:function(){var a=this;a.$("#@link").click(function(b){b.preventDefault(),a.modal("load")})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/leaderboard",function(require,a,b){var c=require("w2.quora").Component,d=require("view/hover_menu").HoverMenu;a.LeaderboardHoverMenu=d.extend({isInvalidCloseTarget:function(a){var b=this.$("#@menu"),c=this._super.apply(this,arguments);return c||a.parents().filter(b).length>0?!0:!1}}),a.HideFromProfileLink=c.extend({onLoad:function(){var a=this;a.$("#@hide_from_profile").click(function(b){a.serverCall("hide_from_profile").success(function(){a.$("%@link").toggleClass("hidden")}).send(),b.preventDefault()}),a.$("#@show_on_profile").click(function(b){a.serverCall("show_on_profile").success(function(){a.$("%@link").toggleClass("hidden")}).send(),b.preventDefault()})}}),a.LeaderboardStatus=c.extend({onLoad:function(){var a=this;a.$("#@refresh_link").click(function(b){b.preventDefault(),a.refreshLeaderboard()})},refreshLeaderboard:function(){var a=this;a.serverCall("refresh_leaderboard").kwargs({tid:a.tid}).success(function(){a.$("#@refresh_link").addClass("completed").text("Refreshing completed. (Reloading the page)"),require("window_manager").reload()}).error(function(){a.$("#@refresh_link").addClass("completed").text("Refreshing failed! Reload to retry.")}).send(),a.$("#@refresh_link").addClass("completed").text("Refreshing started...")}}),a.AddToBlacklistMVW=c.extend({onLoad:function(){var a=this;a.$("#@add_link").click(function(b){b.preventDefault(),a.update(!1)}),a.$("#@remove_link").click(function(b){b.preventDefault(),a.update(!0)})},update:function(a){var b=this;b.serverCall("update").kwargs({tid:b.tid,is_removal:a}).success(function(){a===!0?b.$("#@remove_link").addClass("completed").text("Removed"):b.$("#@add_link").addClass("completed").text("Added")}).send()}})},{"view/hover_menu":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/draft",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings;a.ClearDraft=c.extend({onLoad:function(){this.$("#@clear_draft").click(this.fnbind(function(){var a={};return a[this.clear_draft_title]=this.fnbind(function(){this.serverCall("clear_draft").liveMutate().send()}),a[d.cancel]=null,$(".content").dialog({title:this.clear_draft_title,contents:this.clear_draft_message,buttons:a}),!1}))}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/follow",function(require,a,b){var c=require("w2.quora").Component;a.BoardMemberSelector=c.extend({onLoad:function(a){this.focusOnload&&a&&this.focus()},focus:function(){this.lookup("selector").focus(!0)},clear:function(){this.lookup("selector").reset()},setTo:function(a){a&&a!==""&&this.serverCall("add").kwargs({bid:this.bid,target_uid:a}).success(this.fnbind(function(){this.focus()})).liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/view_tracker",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("event").add;a.instance=null,a.BoardItemViewTracker=c.extend({init:function(){a.instance=this,this.all_board_item_ids={},this.reported_board_item_ids={},this.last_report_time=+(new Date),this.rate_limit_ms=3e3},onLoad:function(){var a=this.fnbind(this.report);e(document,"mousemove",a),e(document,"keypress",a),e(document,"scroll",a)},addBoardItem:function(a,b){this.all_board_item_ids[a]=b},removeBoardItem:function(a,b){delete this.all_board_item_ids[a]},isBoardItemVisible:function(a){var b=d._domids[a];if(!b)return!1;var c=document.getElementById(b);if(!c)return!1;var e=$(c);return e.children("div:first").is(":in-viewport")?e.is(":visible")?!0:!1:!1},report:function(){var a=+(new Date);if(a<this.last_report_time+this.rate_limit_ms)return;this.last_report_time=a;var b=[];for(var c in this.all_board_item_ids){var d=this.all_board_item_ids[c];this.reported_board_item_ids[d]===undefined&&this.isBoardItemVisible(c)&&(b.push(d),this.reported_board_item_ids[d]=!0)}b.length>0&&this.serverCall("report").kwargs({board_item_ids:b}).send()}})},{webnode2:!0,event:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/item",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies"),e=require("window_manager"),f=require("app/view/board/view_tracker"),g=require("view/inline_editor").InlineEditor,h=require("views").viewsLogger;a.BoardItemTimestamp=c.extend({onLoad:function(a){var b=this;b.$("#@link").mousedown(function(){d.setQfeedLog(b,"BoardItemClickthrough"),d.setQueryLog(b,"BoardItemClickthrough")}),b.onKeyCombination(b.$("#@link"),"o",function(){return e.navigateTo(b.$("#@link").attr("href")),!1})}}),a.BoardItemTitle=c.extend({onLoad:function(a){var b=this;b.$("#@link").mousedown(function(){d.setQfeedLog(b,"BoardItemClickthrough"),d.setQueryLog(b,"BoardItemClickthrough")})}}),a.LinkBoardItemView=c.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.$("#@edit").click(function(){return a.showEditor(),!1}),a.$("#@item").hover(function(b){a.$("#@item").addClass("hover")},function(b){a.$("#@item").removeClass("hover")})},showEditor:function(){this.cQuery(":description.editor").toggle_editor()}}),a.LinkBoardItemDescriptionInlineEditor=g.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.board_item=a.lookup("board_item"),a.setToggleCallback(function(){a.board_item.$("#@preview, #@edit").toggle()})},_get_kwargs:function(){return{input:this.get_value(),preview:this.cQuery(":link_editor.preview").getLinkInfo()}}}),a.BoardListItem=c.extend({onLoad:function(){f.instance&&f.instance.addBoardItem(this.cid,this.board_item_id)},onUnload:function(){f.instance&&f.instance.removeBoardItem(this.cid,this.board_item_id)}}),a.BoardItem=c.extend({onLoad:function(){h.addComponentToTrack(this)}})},{cookies:!0,window_manager:!0,views:!0,"view/inline_editor":!0,"app/view/board/view_tracker":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/topic_selector",function(require,a,b){var c=require("w2.quora").Component,d=require("typeahead").TypeaheadResults,e=require("settings").interface_strings;a.TypeBasedTempTopicSelectorAdd=c.extend({onLoad:function(){this.$("#@add_btn").click(this.fnbind(function(){return this.select(),!1})),this.tempTopicList={},this.lowercaseTempTopicList={}},select:function(){this.type=="to_tid"?this.showDialog():this._request()},showDialog:function(){var a=this;a.dialog().title(a.topic_merge_text).ok(function(){var b=require("app/view/topic").getTopicDialog(),c=b.lookup("editor");if(c.isEmpty())return!1;a._request()},e.ok).cancel(null,e.cancel).load("merge_dialog")},_get_kwargs:function(){var a,b,c={};return!(c.tid=this.oid)||!(c.type=this.type)||!(c.topic_name=this.parent().qValue)||/^\s*$/.test(c.topic_name)||this.type=="to_tid"&&(a=require("app/view/topic").getTopicDialog())&&(b=a.lookup("editor"))&&b.isEmpty()?null:(b&&(c.comment=b.serialize()),c)},_request:function(){var a=this._get_kwargs();if(!a)return!1;this.serverCall("add_topic").kwargs(a).success(this.fnbind(function(){this.parent().reset()})).liveMutate().send(),this.hide&&this.parent().hideSelector()}}),a.TempTopicSelectorAdd=a.TypeBasedTempTopicSelectorAdd.extend({select:function(){this.saveTempTopic(this.parent().result)},setoid:function(a){this.oid=a},saveName:function(a){this.tempTopicList[a]=a,this.lowercaseTempTopicList[a.toLowerCase()]=a},deleteName:function(a){delete this.tempTopicList[a],delete this.lowercaseTempTopicList[a.toLowerCase()]},getTempTopicNames:function(){return this.tempTopicList},getLowercaseTempTopicNames:function(){return this.lowercaseTempTopicList},getTempTopicNamesAsArray:function(){var a=[];for(var b in this.tempTopicList)a.push(b);return a},reset:function(){this.parent().resetTempTopics(),this.tempTopicList={}},saveTempTopic:function(a){var b=a.value;if(!b)return;this.saveName(b);var c=$("<li/>").addClass(this.tempTopicClass()).append($("<input/>").attr("type","hidden").attr("name","tidsugg_"+this.oid).val(b)).append($(this.topicNameTag()).text(this.tempTopicVisibleText(b)).addClass(this.topicNameClasses())).append($("<a/>").text(this.removeTopicText()).addClass(this.editLinkClasses()).attr("href","#").click(this.fnbind(function(){return this.deleteName(b),c.remove(),!1})));this.parent().addTempTopic(c)},topicNameTag:function(){return"<strong/>"},topicNameClasses:function(){return""},editLinkClasses:function(){return"light"},tempTopicClass:function(){return"p0_5"},onTempTopicAdded:function(a){this.parent().setText(""),this.parent().focus()},tempTopicVisibleText:function(a){return a},removeTopicText:function(){return" remove"}}),a.TempBoardItemTopicSelectorAdd=a.TempTopicSelectorAdd.extend({topicNameTag:function(){return"<span/>"},topicNameClasses:function(){return"topic_name"},editLinkClasses:function(){return"topic_remove"},removeTopicText:function(){return""},tempTopicClass:function(){return"topic_list_item"}}),a.TempBoardItemTopicSuggestionsSelectorAdd=a.TempBoardItemTopicSelectorAdd.extend({saveTempTopic:function(a){var b=a.value;if(!b)return;this.saveName(b);var c=$("<div/>").addClass("board_temp_topics_list_item").append($("<span/>").addClass(this.tempTopicClass()).append($(this.topicNameTag()).text(this.tempTopicVisibleText(b)).addClass(this.topicNameClasses()))).append($("<input/>").attr("type","checkbox").attr("checked","checked").attr("value",b).click(this.fnbind(function(){this.checkClicked(b)})));this.parent().addTempTopic(c),this.updateFollowersCount()},updateFollowersCount:function(){this.serverCall("update_count").kwargs({names:this.getTempTopicNames()}).contentFor(this.parent().$("#@followers"),{parentCID:this.cid}).send()},checkClicked:function(a){var b=this.tempTopicList[a];b&&b!=="undefined"?this.deleteName(a):(this.saveName(a),this.updateFollowersCount())},deleteName:function(a){delete this.tempTopicList[a],this.updateFollowersCount()},onTempTopicAdded:function(){this.updateFollowersCount()}}),a.TempTopicContextSelectorAdd=a.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments),this.defaultTopicName&&this.saveTempTopic({value:this.defaultTopicName,type:"topic",id:this.defaultTid,follower_count:this.defaultTopicFollowerCount})},tempTopicVisibleText:function(a){return a+":"},editLinkClasses:function(){return"light edit o"},tempTopicClass:function(){return""},removeTopicText:function(){return this.edit_text},onTempTopicAdded:function(){this._super.apply(this,arguments),this.parent().$("#@selector_wrapper, #@title").hide(),this.parent().$("#@input").blur()},deleteName:function(a){this._super.apply(this,arguments),this.parent().$("#@selector_wrapper, #@title").show(),this.parent().resetFocus()}}),a.TempReviewTopicContextSelectorAdd=a.TempTopicContextSelectorAdd.extend({tempTopicVisibleText:function(a){return this.reviews_of_text+a}}),a.TempTopicQuestionWizardSelectorAdd=a.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.lookup("topic_selection").getTopicNames().concat(this.lookup("topic_selection").getUnselectedTopicNames());for(var b=0;b<a.length;b++){var c=a[b];this.saveName(c)}},saveTempTopic:function(a){var b=a.value;if(!b)return;this.getLowercaseTempTopicNames()[b.toLowerCase()]||(this.saveName(b),this.lookup("topic_selection").newTopicAdded(a))}}),a.TempPrimaryTopicSelectorAdd=a.TempTopicSelectorAdd.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.lookup("topic_selection").getAllTopicNames();for(var b=0;b<a.length;b++)this.saveName(a[b])},saveTempTopic:function(a){var b=a.value;if(!b)return;this.getLowercaseTempTopicNames()[b.toLowerCase()]||(this.saveName(b),this.lookup("topic_selection").newTopicAdded(a))}}),a.LiveTempPrimaryTopicSelectorAdd=a.TempTopicSelectorAdd.extend({saveTempTopic:function(a){var b=a.value;if(!b)return;this.lookup("topic_selection").newTopicAdded(a)}}),a.TopicSelectorAdd=c.extend({onLoad:function(a){this.$("#@add_btn").click(this.fnbind(function(a){return this.select(),!1}))},getTopicName:function(){return this.parent().qValue},getKwargs:function(){return{selected_topic:this.getTopicName()}},select:function(){var a=this.getTopicName(),b=this.getKwargs();this.parent()&&this.parent().resetFocus(),this.onSelectCallback(),a&&this.addTopic(b)},addTopic:function(a){var b=this;b.serverCall("add").kwargs(a).liveMutate().error(b.fnbind(function(){var a={};a[this.close_button_text]=null,$(".content").dialog({title:this.dialog_title,contents:this.dialog_message,buttons:a})})).send()},onSelectCallback:function(){}}),a.QuestionTopicSelectorAdd=a.TopicSelectorAdd.extend({getKwargs:function(){return{selected_topics:this.getTopicName(),viewer_private:this.viewer_private,qid:this.qid}},getTopicName:function(){if(this.parent().qValue!=="")return $.makeArray(this.parent().qValue)}}),a.UserContentFilterTempTopicSelectorAdd=a.TempTopicSelectorAdd.extend({saveTempTopic:function(a){var b=a.value,c=a.id;if(!b)return;this.lookup("user_content_filter").tempTopicChosen(c,b)}}),a.ExpertiseTopicSelectorAdd=a.TopicSelectorAdd.extend({}),a.FilterNavListTempTopicSelectorAdd=a.TempTopicSelectorAdd.extend({saveTempTopic:function(a){var b=a.value,c=a.id,d=a.routing_name;if(!b)return;this.lookup("multiple_value_list").addFilterToKey(d)}}),a.HomePagePinnedTopicSelectorResults=d.extend({preventOverflow:function(){}})},{typeahead:!0,settings:!0,"app/view/topic":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/pmsg/pmsg",function(require,a,b){var c=require("w2.quora").Component,d=require("view/pmsg");a.FlagConfirmationPmsg=d.PMsg.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@undo").click(this.fnbind(function(a){return this.undo(),!1}))},undo:function(){this.serverCall("undo").liveMutate().send()}})},{"view/pmsg":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/admin",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor,e=require("view/modal").Base,f=require("window_manager"),g=require("settings").interface_strings;a.AdminLogItemView=c.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){return this.$("#@details").toggleClass("hidden"),!1})),this.$("#@item").hover(this.fnbind(function(){this.$("#@item").addClass("hover"),this.$("#@buttons").removeClass("hidden")}),this.fnbind(function(){this.$("#@item").removeClass("hover"),this.$("#@buttons").addClass("hidden")})),this.$("#@remove").tooltip({contents:this.hide_title}).click(this.fnbind(function(){return this.dialog().title(this.hide_title).cancel(null,g.cancel).ok(this.fnbind(function(){this.serverCall("hide_log_item").send()}),this.hide_title).html(this.hide_message),!1}))}}),a.UserAdminMenuLink=c.extend({onLoad:function(){this.$("#@menu_link").click(this.fnbind(function(a){return this.$("#@menu").menu(this.$("#@menu_link")),!1}))}}),a.AdminMode=c.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(){function b(){return a.toggle(),!1}var a=this;a.$("#@toggle").click(b),a.listen&&require("keystrokes").on([81,49,81,49],b)}}),a.AdminModeListener=c.extend({toggle:function(){this.serverCall("toggle").liveMutate().send()},onLoad:function(){function b(){return a.toggle(),!1}var a=this;require("keystrokes").on([81,49,81,49],b)}}),a.NicknameInlineEditor=d.extend({onLoad:function(){this._super.apply(this,arguments),f.getHash().substr(0,9)=="#editname"&&this.toggle_editor()}}),a.RemoveInboxMessagesLink=c.extend({onLoad:function(){this.$("#@delete").click(this.fnbind(function(){return this.dialog().title(this.delete_messages_title).cancel(null,g.cancel).ok(this.fnbind(function(){this.serverCall("delete_messages").liveMutate().send()}),this.delete_messages_title).html(this.delete_messages_message),!1}))}}),a.AdminRemoveUserPhoto=c.extend({onLoad:function(a){this.$("#@remove_photo_link").click(this.fnbind(function(){return this.dialog().title(this.remove_profile_photo).cancel().ok(this.fnbind(function(a){var b=a.dialogComponent.child("editor").serialize();this.serverCall("remove_photo").kwargs({ce:b}).liveMutate().send()}),this.remove_photo).load("remove_photo_dialog"),$("#admin_remove_profile_photo_comment").focus(),!1}))}}),a.FlagNameLink=c.extend({onLoad:function(){this.$("#@show_flag_name_modal").click(this.fnbind(function(){return this.modal("flag_modal"),!1}))}}),a.ResolveNameLink=c.extend({onLoad:function(){this.$("#@show_resolve_name_modal").click(this.fnbind(function(){return this.modal("verify_modal"),!1}))}}),a.ResolveNameModal=e.extend({onSubmit:function(){var a=this;this.serverCall("resolve_name").liveMutate().success(function(){a._closeModal()}).send()}}),a.FlagNameModal=e.extend({onSubmit:function(){var a=this;this.serverCall("flag_name").liveMutate().success(function(){a._closeModal()}).send()}}),a.BanRemoveLink=c.extend({onLoad:function(){var a=this;a.$("#@ban_remove_link").click(function(){return a.modal("ban_remove_modal"),!1})}}),a.BanRemoveModal=e.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("editor").focus()},onSubmit:function(){var a=this,b=a.lookup("editor");if(b.isEmpty()){a.$("#@required_comment_warning").removeClass("hidden"),b.focus();return}var c=b.serialize(),d=this.$("#@revert_edits").is(":checked"),e=this.$("#@mark_as_verified_spammer").is(":checked");return a.serverCall("ban_remove_all_users").kwargs({comment:c,revert_edits:d,mark_as_verified_spammer:e}).liveMutate().success(function(){a._closeModal()}).send(),!1}})},{window_manager:!0,keystrokes:!0,settings:!0,"view/modal":!0,"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/suggested_photo",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings;a.SuggestProfilePhoto=c.extend({onLoad:function(){this.$("#@photo").hover(this.fnbind(function(a){this.$("#@add, #@edit").show()}),this.fnbind(function(a){this.$("#@add, #@edit").hide()}))}}),a.SuggestedPhotoPending=c.extend({onLoad:function(){this.suggestion_from_viewer||this.$("#@photo").hover(this.fnbind(function(a){this.$("#@pending").show()}),this.fnbind(function(a){this.$("#@pending").hide()})),this.$("#@view").click(this.fnbind(function(){return this.parent().toggleSuggestion(),!1}))}}),a.SuggestedPhotoAccept=c.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(){return this.serverCall("accept").kwargs({uid:this.uid}).liveMutate().send(),!1}))}}),a.SuggestedPhotoDiscard=c.extend({onLoad:function(){this.$("#@discard").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.dialog_title).ok(this.fnbind(function(){this.serverCall("discard").kwargs({to_uid:this.to_uid}).liveMutate().send()}),this.dialog_button_text).cancel(null,d.cancel).html(this.dialog_message),!1}))}})},{settings:!0,"w2.quora":!0})}),require.whenReady
("settings",function(){require.install("app/view/vc",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("settings").interface_strings;a.RevertDialog=c.extend({onLoad:function(){this.lookup("editor").focus(),d.revertDialog=this},validateReason:function(){var a=this.lookup("editor");return a.isEmpty()?(this.$("#@required_comment_warning").removeClass("hidden"),a.focus(),!1):!0}}),a.BatchRevertDialog=c.extend({onLoad:function(){this.lookup("editor").focus(),d.batchRevertDialog=this}}),a.OperationRevert=c.extend({onLoad:function(){var a=this;a.$("#@operation_revert").click(function(){return a.dialog().title(a.dialog_title).ok(function(){var b=d.revertDialog.lookup("editor");if(!d.revertDialog.validateReason())return!1;a.serverCall("revert_revision").kwargs(a.getKwargs(b)).liveMutate().send()},a.ok_text).cancel(null,e.cancel).load("revert_dialog"),!1})},getKwargs:function(a){return{oid:this.oid,comment:a.serialize()}}}),a.AddQuestionRedirectRevertLink=c.extend({onLoad:function(){var a=this;a.$("#@revert").click(function(b){b.preventDefault(),a.dialog().title(a.dialog_title).ok(function(){var b=d.revertDialog.lookup("editor");if(b.isEmpty())return!1;a.serverCall("revert").kwargs({to_qid:a.to_qid,from_qid:a.from_qid,comment:b.serialize()}).liveMutate().send()},a.ok_text).cancel(null,e.cancel).load("revert_dialog")})}})},{webnode2:!0,settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/widgets",function(require,a,b){function d(){setTimeout(function(){window.close()},1e3)}var c=require("w2.quora").Component;a.IframeBuster=c.extend({onLoad:function(){top.location=this.to_url}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/answer_tag",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2");a.AnswerTagLink=c.extend({onLoad:function(){this.enabled?this.$("#@link").click(this.fnbind(function(a){return this.$("#@menu").menu(this.$("#@link")),!1})):this.$("#@link").click(this.fnbind(function(a){return this.lookup("tag_section").setTag(),!1}))}}),a.AnswerTagMenuListItem=c.extend({onLoad:function(){this.$("#@select_tag").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.dialog_title).load("add_tag_dialog"),!1}))}}),a.AddTagDialog=c.extend({onLoad:function(){var a=this;this.$("#@cancel").click(this.fnbind(function(){return d.Dialog.dialogFor(a).close_(),!1})),this.$("#@add_tag").click(this.fnbind(function(){var b=null;if(this.should_show_editor){var c=this.lookup("editor");b=c.serialize()}var e=this.$("#@locked").is(":checked");return this.serverCall("add_tag").kwargs({comment:b,lock:e}).liveMutate().success(this.fnbind(function(){d.Dialog.dialogFor(a).close_()})).send(),!1}))}}),a.AnswerTag=c.extend({onLoad:function(){this.$("#@show_comment").click(this.fnbind(function(){return this.$("#@comment").removeClass("hidden"),this.$("#@show_comment").addClass("hidden"),!1})),this.$("#@remove").tooltip({contents:this.remove_short_text}),this.$("#@remove").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.remove_text).cancel().ok(this.fnbind(function(){var a=arguments[0].dialogComponent,b=a.lookup("editor").serialize();this.serverCall("remove_tag").kwargs({comment:b}).liveMutate().send()}),this.remove_short_text).load("remove_tag_dialog"),!1}))}}),a.AnswerCollapsedTag=c.extend({onLoad:function(){var a=this;this.$("#@show_comment").click(function(b){b.preventDefault(),a.$("#@comment").removeClass("hidden"),a.$("#@show_comment").addClass("hidden")})}}),a.AnswerTagsMenuAdminOptions=c.extend({onLoad:function(){this.$("#@collapse").click(this.fnbind(function(){return this.serverCall("collapse").kwargs({lock:!1}).liveMutate().send(),!1})),this.$("#@collapse_and_lock").click(this.fnbind(function(){return this.serverCall("collapse").kwargs({lock:!0}).liveMutate().send(),!1}))}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/photo",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies");a.InlinePhotoEditor=c.extend({onLoad:function(){var a=this;this.$("#@x_photo").click(this.fnbind(function(){return this.dialog().title(a.dialog_title).cancel(null,a.close_button_text).ok(this.fnbind(function(){this.serverCall("remove_photo").send()}),a.dialog_button_text).html(a.dialog_message),!1})),a.whenOnLoaded(function(){a.$("#@photo").hover(function(){a.$("#@edit").toggleClass("hidden"),a.$("#@x_photo").toggleClass("hidden")})})}}),a.BoardPhoto=c.extend({onLoad:function(a){this.$("#@link").mousedown(this.fnbind(function(){d.setQfeedLog(this,"BoardClickthrough"),d.setQueryLog(this,"BoardClickthrough")}))}}),a.TopicPhoto=c.extend({onLoad:function(a){this.$("#@link").mousedown(this.fnbind(function(){d.setQfeedLog(this,"TopicClickthrough"),d.setQueryLog(this,"TopicClickthrough")}))}})},{cookies:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/add_answer",function(require,a,b){require("jquery.webnode2");var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor,e=require("cookies"),f=require("window_manager"),g=require("view/modal").Base,h=require("settings"),i=require("qtexteditor").QTextEditor,j=h.interface_strings,k=require("w2.context"),l=require("input_validate").InputValidator,m=require("gating");a.AnswerAdd=c.extend({onLoad:function(){var a=this;a.answerAdd=a.$("#@answer_add"),a.inner=a.answerAdd.find(".inner"),a.$("#@zen_enter").tooltip({contents:a.zen_mode_tooltip}),a.$("#@zen_enter").click(function(){a.enterZen()})},createExitZenButton:function(){var a=this;$("body").append('<div class="zen_exit"></div>'),a.exitZenButton=$(".zen_exit"),a.exitZenButton.css("right",$.getScrollbarWidth()),a.exitZenButton.click(function(){a.exitZen()})},createPlaceholder:function(){$("#zen_placeholder").length===0&&this.answerAdd.after('<div id="zen_placeholder"></div>'),this.placeholder=$("#zen_placeholder"),this.placeholder.css("width",this.answerAdd.outerWidth()),this.placeholder.css("height",this.answerAdd.outerHeight(!0))},resizeEditor:function(){var a=this,b=$(window).height(),c=a.answerAdd.find(".qtext_editor_buttons_wrapper").outerHeight(!0),d=a.answerAdd.find(".AnswerEditorHeader").outerHeight(!0),e=a.footer.outerHeight(!0),f=a.answerAdd.find(".star_rating_row").outerHeight(!0),g=a.answerAdd.find(".AnswerEditorMetadata").outerHeight(!0),h=3,i=b-c-d-e-a.getQuestionTextHeight()-f-g-h;a.answerAdd.find(".qed_content").css({"min-height":i})},getQuestionTextHeight:function(){return this.$("#@zen_question_text").outerHeight(!0)},fixEditorOptions:function(){var a=this,b=a.answerAdd.find(".qtext_editor_buttons"),c=b.offset().top;a.answerAdd.scroll(function(){a.answerAdd.scrollTop()>=c?b.hasClass("fixable_fixed")||(b.addClass("fixable_fixed"),b.css("top",0)):(b.removeClass("fixable_fixed"),b.attr("style",""))})},enterZen:function(){var a=this;a.footer=a.answerAdd.find(".form_buttons"),a.topOffset=a.inner.offset().top-$(window).scrollTop(),a.transformDistance=a.topOffset-a.getQuestionTextHeight(),a.footerTransformDistance=$(window).height()-a.footer.position().top-a.footer.outerHeight(!0)-a.getQuestionTextHeight(),a.animTime=333,a.$("#@zen_bg").show().addClass("is_active"),$("body").addClass("zen_mode"),$(".SiteHeader").css("padding-right",$.getScrollbarWidth()+"px"),$("body").css("padding-right",$.getScrollbarWidth()+"px"),a.createPlaceholder(),a.createExitZenButton(),a.answerAdd.addClass("is_zen"),a.inner.css({"margin-top":a.transformDistance+8,"-webkit-transition":"-webkit-transform "+a.animTime+"ms, border-color "+a.animTime+"ms",transition:"transform "+a.animTime+"ms, border-color "+a.animTime+"ms","-webkit-transform":"translate3d(0,"+ -a.transformDistance+"px,0)",transform:"translate3d(0,"+ -a.transformDistance+"px,0)"}),a.footer.css({"-webkit-transition":"all "+a.animTime+"ms",transition:"all "+a.animTime+"ms","-webkit-transform":"translate3d(0,"+a.footerTransformDistance+"px,0)",transform:"translate3d(0,"+a.footerTransformDistance+"px,0)"}),setTimeout(function(){a.initZen()},a.animTime),a.serverCall("zen_mode_entered").send()},initZen:function(){var a=this;a.answerAdd.addClass("finished_transition"),a.inner.attr("style",""),a.footer.attr("style",""),a.answerAdd.find(".editor_plus_options_wrapper").css("margin-bottom",a.footer.outerHeight()),a.fixEditorOptions(),a.resizeEditor(),$(window).resize(function(){a.resizeEditor()}),a.lookup("editor").focusEditorInput(),a.lookup("qtexteditor").setEscapeKeyCallback(a.fnbind(function(){a.answerAdd.hasClass("is_zen")&&a.exitZen()})),a.footer.find(".submit_button").click(function(){a.answerAdd.hasClass("is_zen")&&a.exitZen()})},exitZen:function(){var a=this;a.$("#@zen_bg").removeClass("is_active"),a.exitZenButton.addClass("transitioning_out"),a.answerAdd.addClass("transitioning_out"),a.inner.css({"-webkit-transition":"-webkit-transform "+a.animTime+"ms, border-color "+a.animTime+"ms "+a.animTime+"ms",transition:"transform "+a.animTime+"ms, border-color "+a.animTime+"ms "+a.animTime+"ms","-webkit-transform":"translate3d(0,"+a.transformDistance+"px,0)",transform:"translate3d(0,"+a.transformDistance+"px,0)"}),a.footer.css({"margin-top":a.footerTransformDistance,"-webkit-transition":"-webkit-transform ."+a.animTime+"s",transition:"transform ."+a.animTime+"s","-webkit-transform":"translate3d(0,"+ -a.footerTransformDistance+"px,0)",transform:"translate3d(0,"+ -a.footerTransformDistance+"px,0)"}),$("body").removeClass("zen_mode"),a.answerAdd.find(".qed_content").attr("style",""),a.answerAdd.find(".editor_plus_options_wrapper").attr("style",""),setTimeout(function(){a.resetEditor()},a.animTime),a.serverCall("zen_mode_exited").send()},resetEditor:function(){var a=this;a.$("#@zen_bg").hide(),$("body").attr("style",""),$(".SiteHeader").attr("style",""),a.placeholder.remove(),a.exitZenButton.remove(),a.answerAdd.removeClass("is_zen finished_transition transitioning_out"),a.inner.attr("style",""),a.footer.attr("style",""),$(window).off("resize"),a.answerAdd.unbind("scroll"),a.lookup("editor").focusEditorInput()},showHidden:function(){this.answerAdd.removeClass("collapsed")}}),a.AnswerInFeedEditorSection=c.extend({onLoad:function(){this._super.apply(this,arguments),this.cQuery(":editor.editor").hideFakeEditorByDefault=!0,this.cQuery(":editor.editor").blurOnLoad=!this.parent().parent().open}});var n=a.AnswerEditor=d.extend({contextConstructor:function(){return k.Editor},onLoad:function(){this.editor=this.lookup("editor");var a=this,b=this.editor.child("review_rating");this.editor.prevent_load_drop_zone=!0,this._super.apply(this,arguments),this.editorContext=this.getContext(k.Editor),this.qTextEditorContext=this.getContext(k.QTextEditor),this.disclaimer_update="",this.answer_resistance=!1,this.writing_tips_enabled&&(this.writingTips=this.cQuery(":writing_tips.tips"),this.shouldShowWritingTips=this.writingTips.shouldShowWritingTips),this.editor.setFocusCallback(function(){a.focusEditor()}),this.editor.isInteractive()||this.focusEditor(),this.draft_space&&this.editor.setAnswerLaterCallback(function(){return a.save_draft(!0),a.editor.hideFakeEditor(),!1}),this.updated_question_modal_shown=!1,b&&this.editor.setBlurCallback(this.fnbind(function(){b.$(".star_rating_row").removeClass("focus")})),this.onKeyCombination(this.input_button_obj,"Cmd-Enter",function(){return a.input_button_obj.click(),!1},null,!0),this.qTextEditorContext&&this.qTextEditorContext.on("focusInput",this.focusEditorInput.bind(this))},focusEditor:function(){var a=this.parent().parent();a.showHidden&&a.showHidden(),this.shouldShowWritingTips&&this.writingTips.isHidden()&&(this.showWritingTips(),this.shouldShowWritingTips=!1),m.qtext2||this.editor.$("#@editor").removeClass("hidden"),this.editor.support_drag_and_drop_upload&&(this.dragAndDropFormLoaded||(this.dragAndDropFormLoaded=!0,this.editor.loadDragAndDropForm()));var b=this.editor.child("review_rating");b&&b.$(".star_rating_row").addClass("focus")},focusEditorInput:function(){this.editor.hideFakeEditor()},showShareWarningDialog:function(){var a=this.lookup("editor_share"),b=a.getValues(),c;b.tw?b.fb?c=this.share_warning_texts.tw_fb:c=this.share_warning_texts.tw:b.fb&&(c=this.share_warning_texts.fb),a.serverCall("warning_dialog_shown").send(),this.lookup("editor_share").dialog().title(this.share_warning_dialog_title).cancel(null,j.cancel).ok(this.fnbind(function(){this.shouldShowShareWarningDialog=!1,this.input_button_obj.click()}),this.share_warning_dialog_ok).html(c)},showAnonAnswerWarningDialog:function(){var a=this;a.modal("anon_answer_warning").onSubmitCallBack(function(){a.shouldShowAnonAnswerWarningDialog=!1,a.input_button_obj.click()})},submitHandler:function(){this.input_button_obj.click(this.fnbind(function(a){if(this.getEditor()&&this.isEditorEmpty())return!1;var b={};this.lookup("editor_share",!0)&&(b=this.lookup("editor_share").getValues());var c=(b.tw||b.fb)&&this.shouldShowShareWarningDialog;if(c)return this.showShareWarningDialog(),!1;if(this.shouldShowAnonAnswerWarningDialog)return this.showAnonAnswerWarningDialog(),!1;if(!this.child("bounty_form").isValid())return!1;var d=this.editor.child("review_rating");if(d){var e=d.$("#@ratings").attr("class");e&&e.slice(-1)?l.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}):d.$(".inline_label").addClass("error")}else l.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}});a.preventDefault()}))},invokeEditServerCall:function(){if(this.getFacebookCheckbox()&&!require("facebook").hasPermission("publish_actions")){var a=arguments,b=this._super;require("facebook").requestPermissions("publish_stream",this.fnbind(function(){b.apply(this,a)}))}else this._super.apply(this,arguments)},ajax_callback:function(a){if(a&&a.answer_resistance){this.showAnswerResistance(),this.locked=!1;return}if(a&&a.show_updated_question_modal){this.modal("load_changed_modal",{kwargs:{submit_id:this.input_button_obj.attr("id"),qid:a.qid}}),this.updated_question_modal_shown=!0,this.locked=!1;return}return a.prompt_topic_bio&&this.modal("topic_bio_modal",{kwargs:{aid:a.aid}}),a.share_data&&a.share_data.autoShowShareDialog&&require("app/view/share").showShareAction(a.share_data),a&&a.show_collapse_modal&&this.showAnswerCollapseModal(a.aid),f.sameDomainURL(a.url)&&f.navigateTo(a.url),this._super.apply(this,arguments)},tlog_data:function(){return{type:"AddAnswer"}},getLoggedAction:function(){return"AnswerAdd"},logSaveDraft:function(){e.setTlog({type:"QuestionSaveDraft",qid:this.id})},_get_kwargs:function(){var a={id:this.id,input:this.get_value(),disclaimer_update:this.disclaimer_update,tw_checked:this.getTwitterCheckbox(),fb_checked:this.getFacebookCheckbox(),fb_uid:require("facebook").getFbUid(),fb_access_token:require("facebook").getAccessToken(),fb_expires:require("facebook").getExpiresIn(),review_data:this.getReviewData(),answer_resistance:this.answer_resistance,updated_question_modal_shown:this.updated_question_modal_shown,bounties_deposit_method:this.getBountiesDepositMethod(),bounties_confidentiality_checkbox_checked:this.getBountiesConfidentialityCheckbox()};return this.lookup("editor_share",!0)&&(a.share_values=this.lookup("editor_share").getValues()),a},getSaveDraftKwargs:function(){var a=this._super.apply(this,arguments);return a},getBountiesDepositMethod:function(){return this.child("bounty_form").getSelectedDepositMethod()},getBountiesConfidentialityCheckbox:function(){return this.child("bounty_form").getConfidentialityCheckboxChecked()},getFacebookCheckbox:function(){return this.editorContext.get("shareToFacebook")},getTwitterCheckbox:function(){return this.editorContext.get("shareToTwitter")},showWritingTips:function(){this.writingTips.show(),this.serverCall("log_show_flyout_on_editor_focus").kwargs({qid:this.id}).send()},showAnswerResistance:function(){this.writing_tips_enabled&&this.writingTips.isVisible()&&this.writingTips.hide(),this.answer_resistance=!0,this.lookup("answer_resistance").show(),this.input_button_obj.removeClass("disabled").text(this.answer_resistance_text),this.focusInput()},showAnswerCollapseModal:function(a){this.modal("show_collapse_modal",{kwargs:{aid:a,is_answer_page:this.is_answer_page}})}});a.AnswerInFeedEditor=n.extend({onLoad:function(){this._super.apply(this,arguments)},trigger_request:function(){e.setQfeedLog(this,"AddAnswer"),this._super.apply(this,arguments)},logSaveDraft:function(){e.setQfeedLog(this,"QuestionSaveDraft")},ajax_callback:function(a){if(a.answer_resistance){this.showAnswerResistance(),this.locked=!1;return}this.$("#@inline_editor_form").parents(".answer_editor").addClass("hidden"),this._super.apply(this,arguments)}}),a.AnswerEditorMetadataItem=c.extend({onLoad:function(){var a=this,b=this.$("#@toggle");b.click(function(){return a.$("#@item").toggleClass("ghosted"),b.text()===a.show_text?(a.showItem(),b.text(a.hide_text)):(a.hideItem(),b.text(a.show_text)),!1})},showItem:function(){return!1},hideItem:function(){return!1}}),a.AnswerEditorMetadataDisclaimerItem=a.AnswerEditorMetadataItem.extend({showItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="attach"),!1},hideItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="remove"),!1}}),a.AnswerEditorMetadataA2AItem=a.AnswerEditorMetadataItem.extend({showItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").answer_attribution_update="attach"),this.aid||this.serverCall("show_answer_attribution").liveMutate().send(),!1},hideItem:function(){return this.lookup("content_editor")&&(this.lookup("content_editor").answer_attribution_update="remove"),this.aid||this.serverCall("hide_answer_attribution").liveMutate().send(),!1}}),a.AnswerCollapseModal=g.extend({onSubmit:function(){this.isAnswerPage||this.goToAnswerPage(),this._closeModal()},goToAnswerPage:function(){window.location=this.url}}),a.AnswerQTextEditor=i.extend({onLoad:function(){this._super.apply(this,arguments);var a=this,b=this.$("#@editor_outer");this.should_track_question_state&&this.editor.one("focus",this.fnbind(this.trackQuestionState)),this.onKeyCombination(b,"a",function(){return f.scrollIntoView(b),a.hideFakeEditor(),!1}),this.onKeyCombination(b,"Escape",function(){document.activeElement.blur();var a=b;while(a.get(0)!==document.body&&!a.hasClass("kbfocusable"))a=a.parent();return a.click().focus(),!1},null,!0)},trackQuestionState:function(){this.serverCall("track_question_state").kwargs({qid:this.qid}).send()},setAnswerLaterCallback:function(a){this.$("#@answer_later_link").click(a)}}),a.ChangedQuestionModal=g.extend({onSubmit:function(){var a=this;this._closeModal(),$("#"+a.submit_id).click()}})},{facebook:!0,cookies:!0,input_validate:!0,window_manager:!0,settings:!0,"app/view/share":!0,"view/modal":!0,"w2.context":!0,"jquery.webnode2":!0,qtexteditor:!0,gating:!0,"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/disclaimer",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2");a.AttachDisclaimer=c.extend({onLoad:function(a){var b=this;b.$("#@add_disclaimer_link").click(function(){return b.attachDisclaimer(),!1}),b.$("#@remove_button").tooltip({contents:b.remove_disclaimer_tooltip}),b.$("#@remove_button").click(function(){return b.removeAttachedDisclaimer(),!1})},attachDisclaimer:function(){this.user_has_set_disclaimer?(this.$("#@add_disclaimer_link, #@disclaimer_attached").toggleClass("hidden"),this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="attach")):this.showDisclaimerDialog()},removeAttachedDisclaimer:function(){this.$("#@add_disclaimer_link, #@disclaimer_attached").toggleClass("hidden"),this.lookup("content_editor")&&(this.lookup("content_editor").disclaimer_update="remove")},showDisclaimerDialog:function(){this._dialog=this.dialog().title(this.create_disclaimer_title).load("set_disclaimer_dialog")}}),a.SetDisclaimerDialog=c.extend({onLoad:function(a){var b=this;b.$("#@cancel").click(function(){return d.Dialog.dialogFor(b).close_(),!1})},showEditor:function(){this.$("#@choose_profession_area").hide(),this.$("#@edit_disclaimer_area").show(),this.lookup("editor").focusInput(),this.$("#@cancel").hide()},showError:function(){this.$("#@choose_profession_area").hide(),this.$("#@wrong_profession_error").show()}}),a.DisclaimerIndicateProfession=c.extend({onLoad:function(){var a=this;a.$("%@profession").click(function(){return a.parent().showEditor(),!1}),a.$("%@other").click(function(){return a.parent().showError(),!1})}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/question_redirect",function(require,a,b){var c=require("w2.quora").Component;a.QuestionRedirectReviewsLink=c.extend({onLoad:function(){var a=this;a.$("#@redirect").click(function(b){return a.serverCall("add_question_redirect").liveMutate().send(),b.preventDefault(),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/components",function(require,a,b){require("jquery.whenIdle");var c=require("w2.quora").Component,d=require("cookies"),e=require("webnode2"),f=require("views").viewsLogger,g=require("view/inline_editor").registerEditorCallback,h=require("view/inline_editor").unregisterEditorCallback,i=require("view/inline_editor").isInEditMode,j=require("mathify").renderMath,k=require("settings").interface_strings,l=require("w2.context").AnswerVoteContext,m=require("unified_view/qtext").ExpandableContext;a.TruncatedQText=c.extend({onLoad:function(a){this.expandableContext=this.getContext(m);if(this.expandableContext){var b=this;this.$more=this.$("#@more"),this.$loading=this.$("#@loading"),this.expandableContext.on("loading",function(){b.$more&&b.$loading&&(b.$more.addClass("hidden"),b.$loading.removeClass("hidden"))})}j("@truncated")}}),a.ExpandedQText=c.extend({onLoad:function(){this._super.apply(this,arguments),j("@expanded")}}),a.TruncatePhraseList=c.extend({onLoad:function(){var a=this;a.$("#@view_all_link").click(function(){return a.$("#@partial_phrases").addClass("hidden"),a.$("#@all_phrases").removeClass("hidden"),!1})}}),a.QTextDiff=c.extend({onLoad:function(){var a=this;a.$("#@more_link").click(function(){return a.$("#@diff_snip").addClass("hidden"),a.$("#@full_diff").removeClass("hidden"),!1})}});var n=function(a){return a.target.nodeName=="A"||$(a.target).hasClass("qtext_embed")};a.QtextTruncate=c.extend({init:function(){this._super.apply(this,arguments),this.callback=null},onLoad:function(a){var b=this;if(b.show_more&&b.was_truncated||b.$("#@more_link").length>0)b.$("#@text_snip").click(function(a){if(!n(a))return b.onClick()}),b.$("#@more_link").click(function(){return b.onClick()})},onClick:function(){var a=this;return a.viewMore(),a.callback&&a.callback(),!1},setCallback:function(a){this.callback=a},viewMore:function(){this.$("#@text_snip").addClass("hidden"),this.$("#@full_text").removeClass("hidden")}}),a.JSTest=c.extend({onLoad:function(){var a=this;$.whenIdle(1,1e3,function(){setTimeout(function(){if(e.atLeastOneServerCallIsSent)return;a.serverCall("noop").send()},1e3)},"Quora.JSTest.noop")}}),a.SimpleMenu=c.extend({onLoad:function(){this.options||(this.options={}),this.$("#@menu_link").click(this.fnbind(function(){return this.$("#@menu_items").menu(this.$("#@menu_link"),this.options),!1}))}}),a.SimpleUserRequest=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(a){this.onClick(),a.preventDefault()}));var a;if(this.upvote||this.remove_upvote)a="u";else if(this.downvote||this.remove_downvote)a="d";else if(this.board_follow_button||this.board_request_follow_button||this.board_unfollow_button)a="f";a&&this.onKeyCombination(this.$("#@link"),a,this.fnbind(this.onClick))},onClick:function(){this.upvote&&(d.setQfeedLog(this,"BoardItemUpvote"),d.setQueryLog(this,"BoardItemUpvote"),d.setTlog({type:"BoardItemUpvote",board_item_id:this.board_item_id}),require("action_log").logSecondaryAction("BoardItemUpvote",{type:"board_item",board_item_id:this.board_item_id})),this.downvote&&(d.setQfeedLog(this,"BoardItemDownvote"),d.setTlog({type:"BoardItemVoteDown",board_item_id:this.board_item_id}));if(this.board_follow_button||this.board_request_follow_button)d.setQfeedLog(this,"BoardFollow"),d.setQueryLog(this,"BoardFollow"),d.setTlog({type:"BoardFollow",bid:this.bid}),require("action_log").logSecondaryAction("BoardFollow",{type:"board",bid:this.bid});this.serverCall("request").liveMutate().send()}}),a.SimpleUserRequestConfirm=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.title).cancel(null,k.cancel).ok(this.fnbind(function(){this.serverCall("request").liveMutate().send()}),this.button_text).html(this.confirm_text),!1}))}}),a.OrderItemButtons=c.extend({onLoad:function(){this.$("#@up").click(this.fnbind(function(){return this.serverCall("move_up").liveMutate().send(),!1})),this.$("#@down").click(this.fnbind(function(){return this.serverCall("move_down").liveMutate().send(),!1}))}}),a.AnswerListItem=c.extend({contextConstructor:function(){return l},onLoad:function(){f.addComponentToTrack(this)}}),a.AnswerHeader=c.extend({onLoad:function(){this.answerVoteContext=this.getContext(l);var a=this;if(a.optimistic_for_web)try{a.answerVoteContext.on("voteState",function(b,c){c=="upvote"?(a.$("#@credibility_fact_upvoted").removeClass("hidden"),a.$("#@credibility_fact_no_vote").addClass("hidden")):(a.$("#@credibility_fact_upvoted").addClass("hidden"),a.$("#@credibility_fact_no_vote").removeClass("hidden"))})}catch(b){}}}),a.ToggledAnswerHeader=c.extend({onLoad:function(){var a=this;a._registerLoadAndEdit(),g("cancel",a.contentType,a.oid,a.cid,a.performCancel.bind(a)),g("submitted",a.contentType,a.oid,a.cid,function(){return a.performCancel(),h("edit",a.contentType,a.oid,a.cid),a._registerLoadAndEdit(),!1}),i(a.contentType,a.oid)&&a._unregisterLoadAndRegisterEdit()},_registerLoadAndEdit:function(){var a=this;g("load",a.contentType,a.oid,a.cid,function(){a._unregisterLoadAndRegisterEdit()})},_unregisterLoadAndRegisterEdit:function(){var a=this;return h("load",a.contentType,a.oid,a.cid),a.performEdit(),g("edit",a.contentType,a.oid,a.cid,function(){return a.performEdit(),!1}),!1},onUnload:function(){h("load",this.contentType,this.oid,this.cid),h("edit",this.contentType,this.oid,this.cid),h("cancel",this.contentType,this.oid,this.cid),h("submitted",this.contentType,this.oid,this.cid)},performEdit:function(){this.$("#@read_mode_header").addClass("hidden"),this.$("#@edit_mode_header").removeClass("hidden")},performCancel:function(){this.$("#@read_mode_header").removeClass("hidden"),this.$("#@edit_mode_header").addClass("hidden")}})},{"unified_view/qtext":!0,cookies:!0,views:!0,webnode2:!0,mathify:!0,"w2.context":!0,"jquery.whenIdle":!0,"view/inline_editor":!0,settings:!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/link",function(require,a,b){var c=require("w2.quora").Component,d=require("qtexteditor"),e={onLoad:function(){this.$("#@link_no_image").click(this.fnbind(function(){return this.clearAllSelected(),this.setDisplayType("link_no_image"),this.$("#@link_no_image").addClass("selected"),!1})),this.$("#@link_small_image").click(this.fnbind(function(){return this.clearAllSelected(),this.setDisplayType("link_small_image"),this.$("#@link_small_image").addClass("selected"),!1})),this.$("#@link_large_image").click(this.fnbind(function(){return this.clearAllSelected(),this.setDisplayType("link_large_image"),this.$("#@link_large_image").addClass("selected"),!1})),this.$("#@remove_url").click(this.fnbind(function(){return this.parent().removeUrl(),!1}))},clearAllSelected:function(){this.$("#@link_no_image, #@link_small_image, #@link_large_image").removeClass("selected")},setDisplayType:function(a){var b;a=="link_no_image"?b=1:a=="link_small_image"?b=2:b=3,this.cQuery(":preview").setDisplayType(a,b)}};a.LinkEditor=c.extend(e),a.LinkVideo=c.extend({onLoad:function(){this.$("#@video_wrapper").click(this.fnbind(function(){this.parent().playVideo(),this.$("#@video_wrapper .qtext_embed.thumbnail").css("width","100%").css("height","272px")}))}}),a.LinkImageEditor=c.extend({onLoad:function(){this.index=0,this.$("#@next_photo").click(this.fnbind(function(a){return this.cycle_photo(1),!1})),this.$("#@prev_photo").click(this.fnbind(function(a){return this.cycle_photo(this.keys_and_sources.length-1),!1})),this.$("#@link").click(this.fnbind(function(){this.serverCall("track").send()}))},get_image_keys:function(){if(this.keys_and_sources!={}){var a=[];for(var b=this.index,c=0,d=this.keys_and_sources.length;c<d;c++,b=(b+1)%d)a.push(this.keys_and_sources[b][0]);return a}return[]},cycle_photo:function(a){var b=this.index;this.index=(b+a)%this.keys_and_sources.length,this.$("#@img").attr("src",this.keys_and_sources[this.index][1])}}),a.LinkTitle=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){this.serverCall("track").send()}))}}),a.EmbedLinkEditor=d.EmbedComponentBase.extend($.extend({},e,{onLoad:function(){e.onLoad.apply(this,arguments),this.$("#@remove_url").unbind("click");var a=this;this.$("#@remove_url").click(function(){a.componentDeleted()});var b=function(){return setTimeout(function(){a.triggerDataChanged()},0),!0},c=this.cQuery("preview.title.editor.editor");c.$("#@editor").keydown(b);var d=this.cQuery("preview.snippet.editor.editor");d.$("#@editor").keydown(b),this.getLinkImageEditor().whenOnLoaded(function(){c.whenOnLoaded(function(){d.whenOnLoaded(function(){var c=a.previous_info=a.getInfo();a.registerWithParent(a.preview.url,c);var d=a.getLinkImageEditor();d.$("#@next_photo").click(b),d.$("#@prev_photo").click(b)})})})},triggerDataChanged:function(){var a=this.getInfo();a!==this.previous_data&&(this.dataChanged(a),this.previous_data=a)},initializeEmbedComponent:function(a,b,c){this._super.apply(this,arguments);var d=this,e=c.find(".link_photo img")||[];e.length?e.load(function(){d.updatePlaceholderImageSize(),d.parent().updateEmbedComponentPositions()}):d.updatePlaceholderImageSize()},setDisplayType:function(a){e.setDisplayType.apply(this,arguments),this.triggerDataChanged()},getLink:function(){return this.cQuery("preview")},getLinkImageEditor:function(){return this.getLink().cQuery(":media")},getInfo:function(){var a=this.getLink().getLinkInfo();a.embed_type="link";var b=JSON.stringify(a);return b}})),a.Link=c.extend({getLinkInfo:function(){this.link_info.title=this.cQuery(":title.editor").get_value(),this.link_info.snippet=this.cQuery(":snippet.editor").get_value();var a=this.cQuery(":media");return a.editable&&(this.link_info.image_keys=a.get_image_keys()),this.link_info},disableInputs:function(){this.cQuery(":title.editor.editor").$("#@editor").addClass("qtext_editor_content_disabled"),this.cQuery(":snippet.editor.editor").$("#@editor").addClass("qtext_editor_content_disabled")},setDisplayType:function(a,b){this.$("#@link_wrapper").removeClass().addClass(a),this.link_info.display_type=b},playVideo:function(){var a=2;this.link_info.display_type==a&&(this.$("#@image_col, #@info_col").css("float","left"),this.$("#@image_col").css("width","100%"),this.$("#@image_and_info").css("display","block"))}})},{qtexteditor:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/static",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.JobsMain=c.extend({onLoad:function(){var a=this;a.$(".expand_link").click(function(b){b.preventDefault();var c=$(this).attr("id").split("_").pop();a.$("#@expand_"+c).toggleClass("hidden")})}}),a.JobListingMain=c.extend({events:{"click #@apply_now":"onClickApplyNow"},onClickApplyNow:function(){var a=this;return $(document).trigger("fire_facebook_conversion_pixel",[a.pixel_id]),a.serverCall("mark_ad_pixel_completed").success(function(){d.replaceURL(d.getPathName()),d.navigateTo(a.apply_url)}).send(),!1}})},{window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/answer_wiki",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor").InlineEditor;a.CreateAnswerWikiInlineEditor=d.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@inline_editor_cancel").click(this.fnbind(function(){return this.toggle_editor(),$("#answer_wiki").addClass("hidden"),!1}))},_get_kwargs:function(){return{qid:this.id,input:this.get_value()}}}),a.AnswerWikiInlineEditor=d.extend({_get_kwargs:function(){var a="";this.has_comment&&!this.lookup("comment_editor").isEmpty()&&(a=this.lookup("comment_editor").serialize());var b=this.$("#@notif"),c;return b?c=b.attr("checked")?1:0
:c=0,{qid:this.id,input:this.get_value(),sugg_exists:this.sugg_exists,comment:a,notif:c}}})},{"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/suggested_edits",function(require,a,b){var c=require("w2.quora").Component,d=require("app/view/common"),e=require("view/inline_editor"),f=e.triggerEditorCallback;a.SuggestedEditBar=c.extend({toggleButtons:function(){this.$("#@suggested_answer_buttons").toggleClass("hidden")}}),a.SuggestedEditButtons=c.extend({onLoad:function(){var a=this;a.$("#@view_original").click(function(){return a.content_type?d.triggerContentToggleCallback(a.content_type,a.object_id):a.parent().parent().toggleSuggestion(),!1});if(!a.content_type)return;a.$("#@edit_suggestion").click(function(){return f("edit",a.content_type,a.object_id),!1})}})},{"view/inline_editor":!0,"app/view/common":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/topic_create",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("webnode2");a.TopicCreateMain=c.extend({onLoad:function(){this.submitted=!1,this.$("#@fake_editor").click(this.fnbind(function(){return this.$("#@fake_editor_row").hide(),this.$("#@editor_row").show(),this.lookup("editor").focus(),!1})),this.$("#@create").click(this.fnbind(function(){var a=this.getTopicName(),b=this.lookup("editor").serialize();return a&&!this.submitted&&(this.submitted=!0,this.serverCall("create_topic").kwargs({topic_name:a,about:b}).success(this.fnbind(function(a){d.sameDomainURL(a)&&(document.location=a)})).liveMutate().send()),!1})),this.$("#@cancel").click(this.fnbind(function(){return this.cancelClicked(),!1}))},getTopicName:function(){return this.lookup("navigator").$("#@input").val()},cancelClicked:function(){}}),a.TopicCreateDialog=a.TopicCreateMain.extend({cancelClicked:function(){e.Dialog.dialogFor(this).close_()}})},{webnode2:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/suggested_sig",function(require,a,b){var c=require("w2.quora").Component;a.SuggestedSigOptions=c.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){return this.parent().parent().toggleSuggestion(),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/announcement",function(require,a,b){var c=require("w2.quora").Component;a.NUXQuestionPromptAnnouncementClose=c.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){return this.parent().closeAnnouncement(),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/board_selector",function(require,a,b){var c=require("w2.quora").Component;a.BoardItemLabel=c.extend({onLoad:function(a){var b=this.lookup("editor"),c=this.lookup("distro_options_container");this.is_submission?(b.setIsSubmission(!0),b.$("#@post_text").hide(),b.$("#@submit_text").show()):(b.setIsSubmission(!1),b.$("#@post_text").show(),b.$("#@submit_text").hide()),this.is_private||this.is_submission?c.hideDistroOptions():c.showDistroOptions()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/user",function(require,a,b){var c=require("w2.quora").Component,d=require("view/hover_menu").HoverMenu,e=require("cookies");a.Name=d.extend({onLoad:function(a){this._super.apply(this,arguments),this.$("#@link").mousedown(this.fnbind(function(){e.setQfeedLog(this,"UserClickthrough"),e.setQueryLog(this,"UserClickthrough")}))}}),a.UserPhoto=c.extend({onLoad:function(a){var b=this;this.$("#@link").mousedown(function(){e.setQfeedLog(b,"UserClickthrough"),e.setQueryLog(b,"UserClickthrough")})}}),a.TopWriterIcon=c.extend({onLoad:function(){this.$("#@icon").tooltip({contents:this.tooltip_text})}})},{cookies:!0,"view/hover_menu":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/layout",function(require,a,b){function e(a,b){$.each(window.YT.players,function(c,d){d.playerId==b&&(d.state=a.data,d.state==window.YT.PlayerState.PLAYING&&d.onReady&&(d.onReady(d),d.onReady=null))}),a.data==window.YT.PlayerState.PLAYING&&f(b)}function f(a){if(!window.YT||!window.YT.players)return;$.each(window.YT.players,function(b,c){c.playerId!=a&&c.player&&$("#"+c.playerId).size()&&c.player.pauseVideo()})}var c=require("w2.quora").Component,d=require("w2.livenode");a.QTextImageEnlarger=c.extend({onLoad:function(){var a=this;$(document).on("click",".qtext_image",function(b){a.openModal(b)}),$(document).on("keydown",function(b){if(b.keyCode==27)for(var c in a.masters)a.hideModal(a.masters[c])}),$(document).on("click",".photo_modal_bg, .photo_modal_close",function(){for(var b in a.masters)a.hideModal(a.masters[b])})},getContainer:function(a,b){var c=this;return c.masters={},c.masters[a]||(c.masters[a]=$("<div>").addClass("photo_modal_container").append($("<div>").addClass("photo_modal_bg")).append($("<div>").addClass("photo_modal_close")).append($("<img>").addClass("photo_modal_img").attr("src",a)).append($("<img>").addClass("photo_modal_img_large").attr("src",b)))},openModal:function(a){function y(){w&&x&&(n.find(".photo_modal_img_large").css("visibility","visible"),n.find(".photo_modal_img").css("visibility","hidden"))}var b=this,c=$(a.target),d=c.attr("src"),e=c.attr("master_src"),f=c.hasClass("zoomable_in"),g=c.parents(".truncated_q_text").length>0,h=c.hasClass("qtext_image_large"),i=g&&!h;if(!f||!e||i)return;var j=parseInt(c.attr("master_w")),k=parseInt(c.attr("master_h")),l=$(window).width(),m=$(window).height(),n=b.getContainer(d,e),o=!1;k>3*m&&k/j>3&&(o=!0),j>l&&(k*=(l-40)/j,j=l-40),k>m&&(j*=(m-40)/k,k=m-40);var p=c.offset().left,q=c.offset().top-$(window).scrollTop(),r=Math.round((l-c.width())/2-p),s=Math.round((m-c.height())/2-q),t=j/c.width();n.find(".photo_modal_img").css("left",p).css("top",q).css("width",c.width()).css("height",c.height()),o&&n.find(".photo_modal_img").css("visibility","hidden"),n.appendTo("body"),c.css("visibility","hidden");var u=$(document).scrollTop();$("body").css({position:"fixed",width:"100%",top:-u});var v=n.find(".photo_modal_close").outerWidth();o?n.find(".photo_modal_close").css("left",(l+parseInt(c.attr("master_w")))/2-v).css("top",(m-k)/2):n.find(".photo_modal_close").css("left",(l+j)/2-v).css("top",(m-k)/2),setTimeout(function(){n.find(".photo_modal_bg, .photo_modal_close").addClass("active"),o?n.find(".photo_modal_bg").css("height",20+parseInt(c.attr("master_h"))):n.find(".photo_modal_img").css("transform","translate3d("+r+"px,"+s+"px,0) scale("+t+")").css("-moz-transform","translate3d("+r+"px,"+s+"px,0) scale("+t+")").css("-ms-transform","translate3d("+r+"px,"+s+"px,0) scale("+t+")").css("-o-transform","translate3d("+r+"px,"+s+"px,0) scale("+t+")").css("-webkit-transform","translate3d("+r+"px,"+s+"px,0) scale("+t+")")},1);var w=!1,x=!1;setTimeout(function(){x=!0,y()},333),o&&n.css("position","fixed").css("overflow","scroll"),n.find(".photo_modal_img_large").load(function(){$(this).css("top",(m-k)/2),o?$(this).css("position","relative").css("left",(l-c.attr("master_w"))/2):$(this).css("left",(l-j)/2).css("width",j).css("height",k),w=!0,y()})},hideModal:function(a){a.find(".photo_modal_bg, .photo_modal_close").removeClass("active"),a.find(".photo_modal_img_large").remove(),a.find(".photo_modal_img").css("visibility","visible"),a.find(".photo_modal_img").css("-webkit-transform","translate3d(0,0,0) scale(1)"),a.find(".photo_modal_img").css("-moz-transform","translate3d(0,0,0) scale(1)"),a.find(".photo_modal_img").css("-ms-transform","translate3d(0,0,0) scale(1)"),a.find(".photo_modal_img").css("-o-transform","translate3d(0,0,0) scale(1)"),a.find(".photo_modal_img").css("ms-transform","translate3d(0,0,0) scale(1)"),setTimeout(function(){$(".qtext_image").css("visibility","visible");var b=Math.abs(parseInt($("body").css("top")));$("body").css({position:"",width:"",top:""}),$(document).scrollTop(b),a.remove()},333)}}),a.QTextGIFPlayer=c.extend({onLoad:function(a){if(!a)return;$(document).click(this.fnbind(function(a){var b=$(a.target).parent("[gif-embedded]");if(!b)return;var c=b.attr("gif-embedded"),d=b.attr("background-url");if(b.attr("is-playing")=="false"){var e=new Image;e.onload=function(){b.children(".qtext_image").attr("src",c),b.children(".gif_embed_noclick").css("visibility","hidden"),b.attr("is-playing","true")},e.src=c}else b.children(".qtext_image").attr("src",d),b.children(".gif_embed_noclick").css("visibility","visible"),b.attr("is-playing","false")}))}}),a.QTextEmbedEnlarger=c.extend({onLoad:function(a){if(!a)return;$(document).click(this.fnbind(function(a){var b=$(a.target),c;b.attr("data-embed")?c=b.attr("data-embed"):(b=b.parent(),c=b&&b.attr("data-embed"));if(!c||!b.hasClass("thumbnail"))return;this.loadEmbed(b,c)}))},loadEmbed:function(a,b){var c=this;if(!window.YT){window.YT={},window.YT.players=[],window.YT.next_id=0;var d=document.createElement("script");d.src="//www.youtube.com/player_api";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(d,g);var h=50,i=function l(d){if(d<0)return;window.setTimeout(function(){window.YT.Player?c.loadEmbed(a,b):l(d-h)},h)};i(1e4)}if(!window.YT.Player)return;a.append(b).removeClass("thumbnail");var j="YTPlayer-"+window.YT.next_id++;a.find(":first-child").attr("id",j);var k=new window.YT.Player(j,{events:{onStateChange:function(a){return e(a,j)}}});window.YT.players.push({player:k,playerId:j,state:-1}),f(j)}}),a.GridGuide=c.extend({onLoad:function(){this.setupKeyboardShortcut()},toggle:function(){this.$("#@grid-guide").is(":visible")?this.$("#@grid-guide").fadeOut(150):this.$("#@grid-guide").fadeIn(150)},setupKeyboardShortcut:function(){require("keystrokes").on([71,82,73,68],this.fnbind(this.toggle))}}),a.BrowserWarning=c.extend({onLoad:function(){d.addContentPadding()}}),a.LogoutNavElement=c.extend({onLoad:function(){this.$("#@logout_link").click(this.fnbind(function(){return this.$("#@logout_form").submit(),d.stopLiveUpdates(),!1}))}}),a.FacebookAdConversionPixel=c.extend({onLoad:function(){this.pixel_id&&$(document).trigger("fire_facebook_conversion_pixel",[this.pixel_id])}})},{"w2.livenode":!0,keystrokes:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/comment",function(require,a,b){var c=require("w2.quora").Component;a.CommentLink=c.extend({onLoad:function(){var a=this.$("#@view_comment_link");this.hasCheckedTriggeringModal=!1,this.onKeyCombination(a,"c",function(){return a.mouseover().click(),!1})},maybeTriggerModal:function(){var a=this;if(!a.is_logged_in)return;if(a.type==="board_item_id"||a.hasCheckedTriggeringModal)return;a.hasCheckedTriggeringModal=!0,a.serverCall("should_trigger_warning_modal").success(function(b){b&&a.triggerModal()}).send()},triggerModal:function(){this.modal("load_modal"),this.serverCall("mark_education_modal_seen").send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/datetime_",function(require,a,b){var c=require("w2.quora").Component,d=require("shared_utils"),e=null,f={};a.DateTimeComponent=c.extend({onLoad:function(){this.js_disp&&(this.timespanElem=this.$("#@datespan"),this.timespanElem.html(d.timestampStr(this.epoch_us,this.granularity)));if(this.js_update_interval){var a=this.js_update_interval+Math.floor(Math.random()*this.js_update_interval*.1);setInterval(this.fnbind(this.updateDisplayStr),a)}},updateDisplayStr:function(){this.timespanElem.html(d.timestampStr(this.epoch_us,this.granularity))}}),a.CountdownClock=c.extend({onLoad:function(){var a=this,b=a.$("#@countdown");e===null&&(e=setInterval(function(){var a=!0;for(var b in f)f.hasOwnProperty(b)&&(a=!1,f[b]());a&&(clearInterval(e),e=null)},200)),f[a.cid]=function(){var c=Math.floor(Date.now()/1e3),d=a.getTimeDifference(c),e=Math.floor(d/60%60),g=Math.floor(d/3600),h=Math.floor(d%60),i;if(a.should_pad_zeroes){var j=function(a){var b=a.toString();return b.length>1?b:"0"+b};e=j(e),h=j(h)}i=a.template.replace("{hrs}",g).replace("{mins}",e).replace("{secs}",h),a.text!==i&&(a.text=i,b.text(i)),a.hasExpired(c)&&delete f[a.cid]}},onUnload:function(){delete f[this.cid]},getTimeDifference:function(a){return Math.max(this.expires_secs-a,0)},hasExpired:function(a){return a>this.expires_secs}}),a.TimeElapsedClock=a.CountdownClock.extend({getTimeDifference:function(a){return Math.max(a-this.expires_secs,0)},hasExpired:function(a){return!1}})},{shared_utils:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/topic_editor",function(require,a,b){var c=require("w2.quora").Component,d=require("view/toggle");a.QuestionTopicsEditorCallToAction=c.extend({onLoad:function(a){a&&this.should_open_edit_state&&this.lookup("topics_editor").do_toggle()}}),a.TopicsEditor=d.ToggledComponent.extend({onLoad:function(a){this.isPageLoad=a,this.lazy_load&&this.do_toggle(),this.$("#@done").click(this.fnbind(function(){return this.toggleClasses(),!1}))},focusSelector:function(){try{this.cQuery(":topic_list.selector_wrapper.selector").focus(!0)}catch(a){}},toggleClasses:function(){this.$("#@selector").toggleClass("hidden"),this.$("#@view_topics").toggleClass("hidden"),this.$("#@edit_topics").toggleClass("hidden"),this.$("#@edit").toggleClass("hidden"),this.$("#@edit_link").toggleClass("hidden")},do_toggle:function(a){return this.lazy_load&&!this.toggled?!1:(this.toggleClasses(),(!this.isPageLoad||a===!0)&&this.focusSelector(),!0)}}),a.TopicEditorButton=c.extend({onLoad:function(){this.$("#@edit").click(this.fnbind(function(){return this.onClickAddOrEdit()})),this.$("#@add").click(this.fnbind(function(){return this.onClickAddOrEdit()}))},onClickAddOrEdit:function(){return this.hideTooltip(),!this.parent().do_toggle(!0)},hideTooltip:function(){var a=this.lookup("topic_editor_tooltip",!0);a!==undefined&&a.hide()}}),a.QuestionTopicEditorTooltip=c.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){this.hide()}))},hide:function(){this.$("#@tooltip").hide()}})},{"view/toggle":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/oauth",function(require,a,b){var c=require("w2.quora").Component;a.OauthCallbackPage=c.extend({onLoad:function(){window.opener?(this.access_token?window.opener.$(window.opener.document).trigger("oauth_approved",{service:this.service,accessToken:this.access_token}):window.opener.$(window.opener.document).trigger("oauth_rejected",{service:this.service}),window.close()):this.$("#@me").text("access token: "+JSON.stringify(this.access_token))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/linkedin_",function(require,a,b){var c=require("w2.quora").Component;a.LinkedinCallbackPage=c.extend({onLoad:function(){window.opener&&(window.opener.$(window.opener.document).trigger("linkedin_oauth_approved",this.liUid),window.close())}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/invisibleinfo",function(require,a,b){var c=require("w2.quora").Component;a.InfoToggle=c.extend({onLoad:function(){this._state=!1,this.setupKeyboardShortcut()},toggle:function(){this._state?(this._state=!1,$(".invisible_info").hide()):(this._state=!0,$(".invisible_info").show())},setupKeyboardShortcut:function(){require("keystrokes").on([81,73,68,81,73,68],this.fnbind(this.toggle))}})},{keystrokes:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/login",function(require,a,b){var c=require("w2.quora").Component;a.LogoutAllSessionsButton=c.extend({onLoad:function(){var a=this;a.$("#@logout").click(function(b){return a.serverCall("logout_all_sessions").kwargs({unh:a.unh,time:a.time,uid:a.uid}).liveMutate().send(),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/suggested_answer",function(require,a,b){var c=require("w2.quora").Component;a.AnswerSuggestedEditDiscardButtonInline=c.extend({onLoad:function(){this.$("#@submit").click(this.fnbind(function(){return this.serverCall("discard_suggested_edit").kwargs({aid:this.aid}).liveMutate().send(),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/photo",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("webnode2");a.EditPhotoDialogLink=c.extend({onLoad:function(){this.$("#@open_edit_photo").click(this.fnbind(function(){return this.editPhoto(),!1}))},editPhoto:function(){this._dialog||(this._dialog=this.dialog({showXButton:!0,closeOnClickOut:!0,width:550}).title(this.dialog_title).load("set_dialog_contents").close(this.fnbind(function(){this._dialog=null})))}}),a.EditPhotoChoice=c.extend({onLoad:function(){this.cQuery(":upload_dialog.drag_and_drop_form").$("#@form_title").text(this.click_best_text),this.cQuery(":upload_dialog.drag_and_drop_form").$("h3").removeClass("drag_and_hover"),this.cQuery(":upload_dialog").$("#@drop_zone").removeClass("drag_and_hover"),this.$(".@img_choice").click(this.fnbind(function(a){var b=$(a.target).attr("choice");return this.serverCall("choose_photo").kwargs({choice:b}).success(this.fnbind(function(){this.next_url?d.navigateTo(this.next_url):e.Dialog.dialogFor(this).close_()})).send(),this.$("#@choices").text(this.setting_text),!1}))}})},{webnode2:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/thanks",function(require,a,b){var c=require("w2.quora").Component;a.ThanksLink=c.extend({onLoad:function(){var a=this;this.$("#@thanks_link").click(function(){return a.serverCall("send_thanks").liveMutate().send(),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/tumblr",function(require,a,b){var c=require("w2.quora").Component;a.TumblrCallbackPage=c.extend({onLoad:function(){window.opener&&(this.url?(window.opener.$(window.opener.document).trigger("tumblr_oauth_approved",this.url),window.close()):alert(this.error_message))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/related",function(require,a,b){require("jquery.whenIdle");var c=require("w2.quora").Component,d=require("view/toggle");a.RelatedQuestionsToggler=d.TogglerComponent.extend({onVisible:function(){var a=this,b=a.fnbind(function(){a.serverCall("register_box_load").kwargs({experiment_id:a.experiment_id,clicktrack_id:a.clicktrack_id,qid:a.qid,qids:a.qids}).send()});$.whenIdle(350,b,"Quora.RelatedQuestionsToggler.registerBoxLoad")},toggle:function(){var a=this;a._super.apply(this,arguments),a.serverCall("register_show_more").kwargs({experiment_id:a.experiment_id,clicktrack_id:a.clicktrack_id}).send()}})},{"view/toggle":!0,"jquery.whenIdle":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/question_alias",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings;a.AddQuestionAliasList=c.extend({onLoad:function(){this.$("#@create_link").click(this.fnbind(function(){return this.$("#@create").hide(),this.$("#@add_alias").show(),this.lookup("input").$("#@input").focus(),!1})),this.$("#@add").click(this.fnbind(function(){var a=this.lookup("input").$("#@input").val();return a&&this.serverCall("add_question_alias").kwargs({qid:this.qid,alias:a}).success(this.fnbind(function(){this.lookup("input").$("#@input").val(""),this.lookup("input").$("#@input").focus()})).liveMutate().send(),!1}))}}),a.QuestionAliasText=c.extend({onLoad:function(){this.$("#@edit").click(this.fnbind(function(){return this.toggleEditor(),!1})),this.$("#@cancel").click(this.fnbind(function(){return this.toggleEditor(),!1})),this.$("#@update").click(this.fnbind(function(){var a=this.lookup("input").$("#@input").val();return a&&this.serverCall("edit_question_alias").kwargs({qid:this.qid,alias_id:this.alias_id,new_alias:a}).success(this.fnbind(function(){this.lookup("input").$("#@input").val(""),this.toggleEditor()})).liveMutate().send(),!1}))},toggleEditor:function(){this.$("#@text").toggle(),this.$("#@editor").toggle(),this.parent().$("#@remove").toggle()}}),a.QuestionAliasItem=c.extend({onLoad:function(){this.$("#@remove").tooltip({contents:this.tooltip_text}).click(this.fnbind(function(){this.clear(),this.$("#@text").addClass("item_selected");if(this._dialog)return;return this._dialog=this.dialog().title(this.dialog_title).ok(this.fnbind(function(){this.serverCall("remove_question_alias").kwargs({qid:this.qid,alias_id:this.alias_id}).liveMutate().send()}),this.button_text).cancel(this.fnbind(function(){this.clear()}),d.cancel).html(this.dialog_message),!1})),this.$("#@item").hover(this.fnbind(function(a){this.$("#@remove").show()}),this.fnbind(function(a){this.$("#@remove").hide()}))},clear:function(){$(".item_selected").removeClass("item_selected")}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/topics",function(require,a,b){var c=require("app/view/topic/edit_topic_modal");a.TopicRow=c.TopicRow.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.$("#@row").hover(function(){a.$("#@remove_context_topic_wrapper").is(":visible")||a.$("#@set_context_topic").show()},function(){a.$("#@remove_context_topic_wrapper").is(":visible")||a.$("#@set_context_topic").hide()})},bindClickHandlers:function(){var a=this;this.$("#@remove_topic").click(function(b){var c=a.lookup("selector");b.preventDefault(),a.is_context_topic&&a.removeContextTopic(),a.lookup("topic_selection").serverCall("topic_removed").kwargs({tid:a.tid}).success(function(a){a.tid&&c.removeIgnoreOid(a.tid)}).liveMutate().send()}),this.$("#@topic_name").click(function(){a.setContextTopic()}),this.$("#@set_context_topic").click(function(b){b.preventDefault(),a.setContextTopic()}),this.$("#@remove_context_topic").click(function(b){b.preventDefault(),a.is_context_topic&&a.removeContextTopic()})},setContextTopic:function(){this.lookup("topic_selection").serverCall("context_topic_changed").kwargs({tid:this.tid}).liveMutate().send()},removeContextTopic:function(){this.lookup("topic_selection").serverCall("context_topic_changed").kwargs({tid:""}).liveMutate().send()}})},{"app/view/topic/edit_topic_modal":!0})}),require.whenReady("settings",function(){require.install("app/view/user/profile",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("view/toggle");a.RestrictedTopicExpertSubmitApplicationForm=c.extend({onLoad:function(){var a=this;a.$("#@submit").click(this.fnbind(function(){for(var b=0;b<this.tid_count;b++)a.lookup("item_"+b).submit()}))}}),a.RestrictedTopicExpertSubmitApplicationItem=c.extend({onLoad:function(){var a=this.$("#@checkbox"),b=this.lookup("field");a.click(this.fnbind(function(){a.attr("checked")=="checked"?b.showEditor():b.hideEditor()}))},checkBox:function(){this.$("#@checkbox").attr("checked","checked")},submit:function(){var a=this.$("#@checkbox");if(a.attr("checked")=="checked"){var b,c,d=this.lookup("field").can_edit;if(d){c=this.lookup("field").needs_bio;var e=this.cQuery(":field.editor");e.isEmpty()||(b=e.serialize())}(!c||!d||c&&b)&&this.serverCall("submit_application").liveMutate().send(),b&&this.serverCall("update_bio").kwargs({bio:b}).liveMutate().send()}}}),a.RestrictedTopicExpertSubmitApplicationSigField=c.extend({onLoad:function(){var a=this;this.$("#@link").click(this.fnbind(function(){return a.showEditor(),a.lookup("item").checkBox(),!1}))},showEditor:function(){this.$("#@link").hide(),this.$("#@editor").show()},hideEditor:function(){this.$("#@link").show(),this.$("#@editor").hide()}}),a.ProfileNameAndSigEditor=c.extend({onLoad:function(){d.getHash().substr(0,9)=="#editname"&&(this.toggleEditor(),this.showNameEditor(),this.$("#@name").focus()),this.$("#@edit").click(this.fnbind(function(){return this.toggleEditor(),this.$("#@bio").focus(),!1})),this.$("#@edit_name").click(this.fnbind(function(){return this.showNameEditor(),!1})),this.$("#@done").click(this.fnbind(function(){return this.hideNameEditor(),this.toggleEditor(),!1})),this.$("#@update").click(this.fnbind(function(){var a=this.$("#@name").val(),b=this.$("#@bio").val();return this.serverCall("update").kwargs({name:a,bio:b}).success(this.fnbind(function(a){a?(this.$("#@name").addClass("input_validation_error"),this.$("#@error").text(a+".").show()):this.toggleEditor()})).liveMutate().send(),!1}))},showNameEditor:function(){this.$("#@edit_name").hide(),this.$("#@view_name").hide(),this.$("#@name_input").show()},hideNameEditor:function(){this.$("#@edit_name").show(),this.$("#@view_name").show(),this.$("#@name_input").hide()},toggleEditor:function(){this.$("#@view").toggle(),this.$("#@edit_view").toggle(),this.$("#@error").text("").hide(),this.$("#@name").removeClass("input_validation_error")}}),a.VerificationBadge=c.extend({onLoad:function(a){this.$("#@badge").tooltip({contents:this.tooltip_text})}}),a.NGProfileNameEditor=e.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@update").click(this.fnbind(function(){var a=this.$("#@name").val();return this.serverCall("update").kwargs({name:a}).success(this.fnbind(function(a){this.toggle()})).liveMutate().send(),!1}))}})},{"view/toggle":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/not_helpful",function(require,a,b){var c=require("w2.quora").Component;a.CollapseAnswerLink=c.extend({onLoad:function(){this.$("#@undo_not_collapsible").click(this.fnbind(function(a){return this.serverCall("undo_not_collapsible").kwargs({aid:this.aid}).liveMutate().send(),!1})),this.$("#@make_uncollapsible").click(this.fnbind(function(a){return this.serverCall("make_uncollapsible").kwargs({aid:this.aid}).liveMutate().send(),!1})),this.$("#@undo_collapse").click(this.fnbind(function(a){return this.serverCall("undo_collapse").kwargs({aid:this.aid}).liveMutate().send(),!1})),this.$("#@collapse").click(this.fnbind(function(a){return this.serverCall("collapse").kwargs({aid:this.aid}).liveMutate().send(),!1})),this.$("#@undo_lock").click(this.fnbind(function(a){return this.serverCall("unlock").kwargs({aid:this.aid}).liveMutate().send(),!1})),this.$("#@lock_collapse").click(this.fnbind(function(a){return this.serverCall("lock_collapse").kwargs({aid:this.aid}).liveMutate().send(),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/filterable_list",function(require,a,b){var c=require("w2.quora").Component;a.FilterableList=c.extend({onLoad:function(){this.lastQuery=null,this.delay=100;var a=this;this.$("#@search").keyup(function(){var b=a.fnbind(function(b){a.fetchResults(b)});setTimeout(b,a.delay,a.$("#@search").val())}),this.$("#@search_link").click(this.fnbind(function(){return this.$("#@search_link, #@bullet").hide(),this.$("#@search").show().focus(),this.$("#@after_search").show().focus(),this.$("#@search_row").show().focus(),!1}))},newQueryEntered:function(a){},fetchResults:function(a){if(a!=this.$("#@search").val())return;if(a==this.lastQuery)return;a&&a!==""&&a!=this.lastQuery?(this.serverCall("search_results").kwargs({query:a}).contentFor(this.$("#@search_results"),{parentCID:this.cid,useLoadingSpinner:!1}).success(this.fnbind(function(){var a=this.$("#@search").val();a&&a!==""?(this.$("#@search_results").show(),this.$("#@default").hide()):(this.$("#@search_results").hide(),this.$("#@default").show())})).send(),this.lastQuery=a,this.newQueryEntered(a)):a===""&&(this.$("#@search_results").hide(),this.$("#@default").show())}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/submission",function(require,a,b){var c=require("w2.quora").Component,d=require("settings").interface_strings;a.SimpleUserRequestCommentConfirm=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.title).cancel(null,d.cancel).ok(this.fnbind(function(){var a=arguments[0].dialogComponent,b=a.cQuery(":comment").serialize();this.serverCall("request").kwargs({comment:b}).liveMutate().send()}),this.button_text).load("comment_dialog"),!1}))}}),a.SubmissionView=c.extend({onLoad:function(a){var b=this;this.$("#@item").hover(function(a){b.$("#@delete").show(),b.$("#@item").addClass("hover")},function(a){b.$("#@delete").hide(),b.$("#@item").removeClass("hover")}),this.$("#@update_accept").click(this.fnbind(function(){return this.request("update_accept"),!1})),this.$("#@update").click(this.fnbind(function(){return this.request("update"),!1})),this.$("#@edit").click(this.fnbind(function(){return this.toggle(),!1})),this.$("#@cancel").click(this.fnbind(function(){return this.toggle(),!1}))},getNewPreview:function(){return null},request:function(a){var b=this.lookup("description").serialize(),c=this.lookup("title").serialize(),d=this.getNewPreview();this.serverCall(a).kwargs({new_description:b,new_title:c,new_preview:d}).liveMutate().send()},toggle:function(){this.$("#@editor").toggle(),this.$("#@content").toggle()}}),a.RejectSubmissionDialogContents=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){return this.$("#@comment").toggle(),this.lookup("comment").focus(),!1}))}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/announcement",function(require,a,b){var c=require("w2.quora").Component;a.Announcement=c.extend({onLoad:function(){this.$("#@close").click(this.fnbind(function(){return this.closeAnnouncement("x"),!1})),this.serverCall("track_announcement_view").send()},closeAnnouncement:function(a){this.serverCall("close_announcement").kwargs({closing_action:a}).liveMutate().send()}}),a.AddAdminAnnouncement=a.Announcement.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(function(){return this.closeAnnouncement("accept"),!1})),this.$("#@decline").click(this.fnbind(function(){return this.closeAnnouncement("decline"),!1})),this.serverCall("track_announcement_view").send()}}),a.NetworkAnnouncement=a.Announcement.extend({closeAnnouncement:function(a){this.serverCall("close_announcement").kwargs({ann_id:this.ann_id}).liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/board/settings",function(require,a,b){var c=require("w2.quora").Component;a.BlogSubdomainInput=c.extend({onLoad:function(){this.urlIsOK=!1,this.$("#@url").bind("keyup",this.fnbind(function(a){this.checkURL()})),this.$("#@update").click(this.fnbind(function(){return this.updateURL(),!1}))},checkURL:function(){var a=this.$("#@url").val();this.serverCall("check_url").kwargs({url:a}).success(this.fnbind(function(a){a===!0?this.urlAvailable():a===!1?this.urlNotAvailable():this.urlEmpty()})).error(this.fnbind(function(){this.urlNotAvailable()})).send()},getInput:function(){return this.$("#@url")},urlEmpty:function(){this.urlAvailable(),this.urlIsOK=!1,this.bid&&this.$("#@button").hide()},urlAvailable:function(){this.urlIsOK=!0,this.$("#@domain_unavailable").hide(),this.$("#@url").removeClass("input_validation_error"),this.bid&&this.$("#@button").show()},urlNotAvailable:function(){this.urlIsOK=!1,this.$("#@domain_unavailable").show(),this.$("#@url").addClass("input_validation_error"),this.bid&&this.$("#@button").hide()},updateURL:function(){var a=this.$("#@url").val();return a&&this.serverCall("register_choice").kwargs({url:a}).success(this.fnbind(function(){location.reload(!0)})).liveMutate().send(),!1}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/zapdos/card",function(require,a,b){var c=require("w2.quora").Component;a.CardButton=c.extend({onLoad:function(){var a=this;a.$("#@card-button-link").click(a.fnbind(a.onClick))},onClick:function(a){a.preventDefault();var b=this;return b.redirectUrl?window.location.href=b.redirectUrl:b.uiToHideId&&b.$("#"+b.uiToHideId).hide(),b.serverCall("click").send(),!1}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/user_settings/settings",function(require,a,b){var c=require("w2.quora").Component;a.SettingsRow=c.extend({onLoad:function(){var a=this;a.selectorId="#"+a.selectorId,this.$(a.selectorId).on("click",function(){a.optionSelected()})},optionSelected:function(){this.serverCall("settings_toggle").liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/reorderable_list",function(require,a,b){function k(a){var b=a.style[f];if(b)return{value:b,original:b};if(window.getComputedStyle){var c=window.getComputedStyle(a).getPropertyValue(g);if(c&&c!=="none")return{value:c,original:""}}return{value:"",original:""}}function l(a){var b=a.ownerDocument&&a.ownerDocument.defaultView&&a.ownerDocument.defaultView.getComputedStyle&&a.ownerDocument.defaultView.getComputedStyle(a,null),c=b&&b.
getPropertyValue("height")||"";return c&&c.indexOf(".")>-1?c=parseFloat(c)+parseInt(b.getPropertyValue("padding-top"))+parseInt(b.getPropertyValue("padding-bottom"))+parseInt(b.getPropertyValue("border-top-width"))+parseInt(b.getPropertyValue("border-bottom-width")):c=a.offsetHeight,c}function m(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}var c=require("w2.quora").Component,d=document.createElement("div"),e="webkitTransition"in d.style?"webkitTransition":"transition",f="webkitTransform"in d.style?"webkitTransform":"transform",g=f==="webkitTransform"?"-webkit-transform":"transform",h="webkitUserSelect"in d.style?"webkitUserSelect":"userSelect";d.style[f]="translateZ(0)";var i=d.style[f]?"translateZ(0) ":"",j=d.style[f]?"translateZ(1px) ":"";a.ReorderableList=c.extend({onLoad:function(){this.pageRoots=$(".Standard2ColLayout").add($(".ContentPageFeed").parent())},isOnDragActive:!1,enableLocalUpdate:!0,onStartSectionMousedownCallback:null,onEndSectionMousedownCallback:null,onStartSubsectionMousedownCallback:null,onEndSubsectionMousedownCallback:null,onStartSectionMousemoveCallback:null,onEndSectionMousemoveCallback:null,onStartSubsectionMousemoveCallback:null,onEndSubsectionMousemoveCallback:null,onStartSectionMouseupCallback:null,onEndSectionMouseupCallback:null,onStartSubsectionMouseupCallback:null,onEndSubsectionMouseupCallback:null,setToDefaultView:function(){this.target.node.style[h]="",this.target.node.style[e]="",this.target.node.style[f]=this.target.baseTransform.original,this.target.node.style.zIndex="",document.body.removeChild(this.targetNodeClone),this.targetNodeClone=null,this.target.node.style.visibility="";for(var a=0;a<this.sectionNodesContainer.length;a++){var b=this.sectionNodes[a][0];b.style.height="",b.style[f]="",b.style[e]="";for(var c=0;c<this.sectionNodesContainer[a].nodes.length;c++){var d=this.sectionNodesContainer[a].nodes[c];d.node.style[f]=d.baseTransform.original,d.node.style[e]=""}}this.pageRoots.removeClass("unselectable"),m(),this.removeMouseHandlers()},attach:function(){this.ReorderableList=this.$("#@wrapper")[0],this.otherNodes=[];var a=[];this.sectionNodes=this.$("#@wrapper").find(".ReorderableListBranch").each(function(){a.push($(this).parent())}),this.sectionNodes=a;for(var b=0;b<this.sectionNodes.length;b++){var c=this.sectionNodes[b].find(".section_title_wrapper .drag_icon"),d={startSectionIndex:b,node:this.sectionNodes[b]};c.on("mousedown",d,this.fnbind(this._onSectionMousedown));var e=this.sectionNodes[b].find(".ReorderableListContents .drag_icon");for(var f=0;f<e.length;f++){var g=e[f],h=$(g).closest(".ReorderableListItem").parent();d={startSectionIndex:b,startSubsectionIndex:g,node:h},$(g).on("mousedown",d,this.fnbind(this._onSubsectionMousedown))}}},detach:function(){if(this.sectionNodes)for(var a=0;a<this.sectionNodes.length;a++){var b=this.sectionNodes[a].find(".section_title_wrapper .drag_icon");b.off("mousedown");var c=this.sectionNodes[a].find(".ReorderableListContents .drag_icon");for(var d=0;d<c.length;d++){var e=c[d];$(e).off("mousedown")}}},updatePosition:function(a,b){this.latestPosition=b;var c=40,d=0,e=document.body,f=e.getBoundingClientRect(),g=this.target.node.getBoundingClientRect(),h=Math.min(f.bottom,window.innerHeight)-g.bottom,i=g.top-Math.max(f.top,0);h<c?d=c-h:i<c&&(d=i-c);var j=e.scrollTop;j!=e.scrollTop&&(this.startPosition.y+=j-e.scrollTop),this.latestPosition.time-this.previousPosition.time>100&&(this.previousPosition=this.latestPosition)},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,$(window).off("mousemove"),$(window).off("mouseup"))},_onMousedown:function(a){var b=a.data.node[0];this.startSectionIndex=a.data.startSectionIndex,this.startSubsectionIndex=a.data.startSubsectionIndex,this.target={node:b,baseTransform:k(b),height:b.offsetHeight},this.zero=this.target.node.offsetTop+this.target.height/2,this.sectionNodesContainer=[];for(var c=0;c<this.sectionNodes.length;c++){var d,f=[],h=this.sectionNodes[c][0];this.target.node!==h&&(h.style[e]=g+" 0.2s ease-in-out");var i=this.sectionNodes[c].find(".ReorderableListContents .ReorderableListItem");for(var j=0;j<i.length;j++){var m=i.eq(j)[0].parentNode;this.target.node!==m&&(m.style[e]=g+" 0.2s ease-in-out"),d=m.offsetTop,f.push({node:m,baseTransform:k(m),pos:d+(d<this.zero?m.offsetHeight:0)-this.zero})}d=h.offsetTop,this.sectionNodesContainer.push({nodes:f,posRelative:d+(d<this.zero?h.offsetHeight:0)-this.zero,pos:h.getBoundingClientRect().top+window.pageYOffset-h.clientTop,height:l(h)})}var n={x:a.pageX,y:a.pageY,time:a.timeStamp};this.startTransformPosition=a.clientY,this.startPosition=this.previousPosition=this.latestPosition=n,this.targetNodeClone=this.target.node.cloneNode(!0),this.target.node.style.visibility="hidden";var o=this.target.node.getBoundingClientRect();this.targetNodeClone.style.position="fixed",this.targetNodeClone.style.top=o.top+"px",this.targetNodeClone.style.left=o.left+"px",this.targetNodeClone.style["background-color"]="#fff",document.body.appendChild(this.targetNodeClone)},_onSectionMousedown:function(a){typeof this.onStartSectionMousedownCallback=="function"&&this.onStartSectionMousedownCallback(),this._onMousedown(a),typeof this.onEndSectionMousedownCallback=="function"&&this.onEndSectionMousedownCallback(this.target.node,this.targetNodeClone),this._onSectionMousemove(a),this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,$(window).on("mousemove",this.fnbind(this._onSectionMousemove)),$(window).on("mouseup",this.fnbind(this._onSectionMouseup)))},_onSubsectionMousedown:function(a){typeof this.onStartSubsectionMousedownCallback=="function"&&this.onStartSubsectionMousedownCallback(),this._onMousedown(a),typeof this.onEndSubsectionMousedownCallback=="function"&&this.onEndSubsectionMousedownCallback(this.targetNodeClone,this.startSectionIndex),this._onSubsectionMousemove(a),this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,$(window).on("mousemove",this.fnbind(this._onSubsectionMousemove)),$(window).on("mouseup",this.fnbind(this._onSubsectionMouseup)))},_onMousemove:function(a){this.isOnDragActive=!0,this.updatePosition(a,{x:a.pageX,y:a.pageY,time:a.timeStamp}),this.transformY=a.clientY,this.scrollIfNearEdge(this.transformY),this.pageRoots.addClass("unselectable");var b=this.transformY-this.startTransformPosition;this.target.node.style[f]="translate(0, "+b+"px) "+j+this.target.baseTransform.value,this.targetNodeClone.style[f]=this.target.node.style[f]},_onSectionMousemove:function(a){typeof this.onStartSectionMousemoveCallback=="function"&&this.onStartSectionMousemoveCallback(),this._onMousemove(a);var b=this.getTotalMovement(),c=this.target.node.offsetHeight;for(var d=0;d<this.sectionNodesContainer.length;d++){var e=this.sectionNodesContainer[d],g=this.sectionNodes[d][0],h=0;e.posRelative<0&&b.y<0&&e.posRelative>b.y?h=c:e.posRelative>0&&b.y>0&&e.posRelative<b.y&&(h=-c),h?g.style[f]="translate(0,"+h+"px) "+i:g.style[f]=""}typeof this.onEndSectionMousemoveCallback=="function"&&this.onEndSectionMousemoveCallback()},_onSubsectionMousemove:function(a){typeof this.onStartSubsectionMousemoveCallback=="function"&&this.onStartSubsectionMousemoveCallback(),this._onMousemove(a);var b=this.getTotalMovement(),c=this.target.height;for(var d=0;d<this.sectionNodesContainer.length;d++)this.latestPosition.y>this.sectionNodesContainer[d].pos&&this.latestPosition.y<(this.sectionNodesContainer[d+1]?this.sectionNodesContainer[d+1].pos:Infinity)?(this.endSectionIndex=d,d!==this.startSectionIndex?this.sectionNodes[d][0].style.height=this.sectionNodesContainer[d].height+this.target.height+"px":this.sectionNodes[d][0].style.height=this.sectionNodesContainer[d].height+"px"):d===this.startSectionIndex?this.sectionNodes[d][0].style.height=this.sectionNodesContainer[d].height-this.target.height+"px":this.sectionNodes[d][0].style.height=this.sectionNodesContainer[d].height+"px";for(d=0;d<this.sectionNodesContainer.length;d++){var e=this.sectionNodesContainer[d];for(var g=0;g<e.nodes.length;g++){var h=0,j=e.nodes[g];j.pos<0&&b.y<0&&j.pos>b.y?h+=c:j.pos>0&&b.y>0&&j.pos<b.y&&(h+=-c);if(this.latestPosition.y>e.pos&&d>this.startSectionIndex){h+=c,this.zero=this.target.node.offsetTop+this.target.height/2;var k=j.node.offsetTop;b.y>0?j.pos=k+(k<this.zero?j.offsetHeight:0)-this.zero+c:b.y<0&&(j.pos=k+(k<this.zero?j.offsetHeight:0)-this.zero-c);for(var l=0;l<this.sectionNodes.length;l++)this.sectionNodesContainer[l].pos=this.sectionNodes[l][0].getBoundingClientRect().top+window.pageYOffset-this.sectionNodes[l][0].clientTop}j.node.style[f]=h?"translate(0,"+h+"px) "+i+j.baseTransform.value:j.baseTransform.original}}typeof this.onEndSubsectionMousemoveCallback=="function"&&this.onEndSubsectionMousemoveCallback()},_onMouseup:function(){this.isOnDragActive=!1,$("html, body").stop()},_onSectionMouseup:function(){typeof this.onStartSectionMouseupCallback=="function"&&this.onStartSectionMouseupCallback(),this._onMouseup();var a=this.getTotalMovement(),b;if(a.y<0){for(b=0;b<this.sectionNodesContainer.length;b++)if(this.sectionNodesContainer[b].posRelative>a.y){this.endSectionIndex=b,this.enableLocalUpdate&&this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[this.endSectionIndex]);break}}else for(b=this.sectionNodesContainer.length-1;b>=0;b--)if(this.sectionNodesContainer[b].posRelative<a.y){this.startSectionIndex===b+1?this.endSectionIndex=b+1:this.endSectionIndex=b,this.enableLocalUpdate&&this.target.node.parentNode.insertBefore(this.target.node,this.sectionNodes[b+1]?this.sectionNodes[b+1]:null);break}this.removeMouseHandlers();if(!this.enableLocalUpdate){var c=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[f]="",this.targetNodeClone.style.position="absolute",this.targetNodeClone.style.left=c;var d,e=$(window).scrollTop();this.endSectionIndex!==0&&(a.y<0?(d=this.sectionNodes[this.endSectionIndex-1][0],e+=d.getBoundingClientRect().bottom):(d=this.sectionNodes[this.endSectionIndex][0],e+=d.getBoundingClientRect().bottom)),this.targetNodeClone.style.top=e+"px"}typeof this.onEndSectionMouseupCallback=="function"&&this.onEndSectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSectionIndex,this.startSectionIndex)},_onSubsectionMouseup:function(){this.removeMouseHandlers(),typeof this.onStartSubsectionMouseupCallback=="function"&&this.onStartSubsectionMouseupCallback(this.target.node,this.endSubsectionIndex,this.startSubsectionIndex),this._onMouseup();var a,b=this.sectionNodesContainer[this.endSectionIndex].nodes,c=this.getTotalMovement();if(b.length===0)this.enableLocalUpdate&&this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.appendChild(this.target.node),this.endSubsectionIndex=0;else if(c.y<0){b[b.length-1].pos+this.target.height>c.y&&(this.localUpdate&&this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,b[b.length-1].node.nextSibling),this.endSubsectionIndex=b.length);for(a=0;a<b.length;a++)if(b[a].pos>c.y){this.endSubsectionIndex=a,this.localUpdate&&this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,b[a].node);break}}else{b[0].pos>c.y&&(this.localUpdate&&this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,b[0].node),this.endSubsectionIndex=0);for(a=b.length-1;a>=0;a--)if(b[a].pos<c.y){this.endSectionIndex===this.startSectionIndex&&a+1!==this.startSubsectionIndex?this.endSubsectionIndex=a:this.endSubsectionIndex=a+1,this.localUpdate&&this.sectionNodes[this.endSectionIndex].querySelector("div.nested_contents").firstChild.insertBefore(this.target.node,b[a+1]?b[a+1].node:null);break}}if(!this.enableLocalUpdate){var d=this.targetNodeClone.getBoundingClientRect().left;this.targetNodeClone.style[f]="",this.targetNodeClone.style.position="absolute",this.targetNodeClone.style.left=d;var e,g=$(window).scrollTop();this.endSubsectionIndex===0||this.sectionNodesContainer[this.endSectionIndex].nodes.length===0?(e=$(this.sectionNodes[this.endSectionIndex]).find(".section_title_wrapper")[0],e===undefined?(e=$(this.sectionNodes[this.endSectionIndex])[0],g+=e.getBoundingClientRect().top):g+=e.getBoundingClientRect().bottom):c.y<0?(e=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node,g+=e.getBoundingClientRect().bottom):(this.endSectionIndex!==this.startSectionIndex?e=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex-1].node:e=this.sectionNodesContainer[this.endSectionIndex].nodes[this.endSubsectionIndex].node,g+=e.getBoundingClientRect().bottom),this.targetNodeClone.style.top=g+"px"}typeof this.onEndSubsectionMouseupCallback=="function"&&this.onEndSubsectionMouseupCallback(this.target.node,this.targetNodeClone,this.endSubsectionIndex,this.startSubsectionIndex,this.endSectionIndex,this.startSectionIndex)},scrollIfNearEdge:function(a){this.isOnDragActive&&(a+50>$(window).height()?$("html, body").stop().animate({scrollTop:$(document).height()},6e3,"linear"):a<100?$("html, body").stop().animate({scrollTop:0},6e3,"linear"):$("html, body").stop())},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y}}}),a.ReorderableListContents=c.extend({onLoad:function(){this.separator_tooltip_content&&this.$("#@separator").tooltip({contents:this.separator_tooltip_content})},onClickViewMore:function(){}}),a.ReorderableListItem=c.extend({onLoad:function(){var a=this,b=a.lookup("reorderable_list"),c=a.lookup("reorderable_list_branch");b.is_editing&&(b.detach(),b.attach()),b.showErrorOnLiveUpdate(),a.$("#@remove").click(function(){return a.remove(),!1}),a.$("#@item").mousedown(function(){b.$("#@wrapper").hasClass("is_editing")&&(b.resetActiveState(),a.is_internal_node?(c.$("#@wrapper").addClass("active"),$(this).focus()):$(this).addClass("active").focus())})},remove:function(){this.serverCall("remove").liveMutate().send()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/scroll_indicator",function(require,a,b){function f(a){var b=new e;return a=$.extend({anchorNav:null,navContainer:".nav",navTarget:"li",navAnchor:"a",navClickToScroll:!0,bodyElement:"",offsetHeight:0,heightOffsetBottom:150},a),b.navBeingClicked=!1,b.options=a,$.whenLoaded(1,function(){b.refreshIndicator()}),c.scroll(b.onScrollWindow.bind(b)),b}var c=$(window),d=$(document),e=function(){};this.anchorOffsets=[],e.prototype.refreshIndicator=function(){var a=this;this.anchorOffsets=[],this.navTargetNode=$(this.options.navContainer+" "+this.options.navTarget),this.navAnchorNode=$(this.options.navContainer+" "+this.options.navTarget+" "+this.options.navAnchor);var b=[];this.selectedIndex=0,this.options.navClickToScroll&&this.navAnchorNode.click(function(b){a.navBeingClicked=!0;var c=$(b.target).closest(a.options.navTarget).index();a.navTargetNode.each(function(){$(this).removeClass("active")}),$(b.target).closest(a.options.navTarget).addClass("active"),$("html, body").animate({scrollTop:a.anchorOffsets[c]+2},300,function(){a.navBeingClicked=!1}),b.preventDefault()});var e=0;this.navAnchorNode.each(function(a,c){b.push($(c).attr("href"))});for(var f=0;f<b.length;f++){var g=b[f];e=$(g).offset().top-this.options.offsetHeight;if(e>d.height()-c.height())break;this.anchorOffsets.push(e)}var h=f>1?$(b[f-1]).offset().top-this.options.offsetHeight:0,i=b.length-f,j=this.options.heightOffsetBottom/i;for(var k=f;k<b.length;k++){var l=k-f;e=h+j*l,this.anchorOffsets.push(e)}},e.prototype.onScrollWindow=function(){if(!this.navBeingClicked){var a=c.scrollTop();for(var b=0;b<this.anchorOffsets.length;b++)a>this.anchorOffsets[b]&&($(this.navTargetNode[this.selectedIndex]).removeClass("active"),this.selectedIndex=b,$(this.navTargetNode[b]).addClass("active"))}},a.makeIndicator=f},{})}),require.whenReady("settings",function(){require.install("app/view/topic/faq",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("view/scroll_indicator"),f=require("view/selector").ServerCallSelector,g=require("view/inline_editor").InlineEditor,h=require("input_validate").InputValidator,i=require("view/reorderable_list").ReorderableList,j=require("view/reorderable_list").ReorderableListContents,k=require("view/reorderable_list").ReorderableListItem,l=require("view/modal").Base,m=require("view/hover_menu").HoverMenu,n=require("view/topic_selector").TopicSelectorAdd,o=a.TopicFaqScrollIndicator=function(){},p=require("action_log").ActionableComponent,q=require("third_party/truncate");a.FaqBadge=c.extend({onLoad:function(){this.$("#@faq_badge").tooltip({contents:this.tooltip_text})}}),a.TopicFaqMainListWrapper=p.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@actionable").off("mousedown"),this.$("#@actionable").off("click")}}),a.TopicFaqMainList=i.extend({onLoad:function(){this._super.apply(this,arguments),this.user_can_edit&&(this.setEditLink(),this.update(),this.bindClickHandler(),this.updateToc()),this.updateFixable(),this.makeScrollIndicator();var a=this;a.is_editable_on_load&&setTimeout(function(){a.child("section_focus_helper").focusSection()},0)},enableLocalUpdate:!1,resetActiveState:function(){this.$("#@wrapper").find(".active").removeClass("active")},makeScrollIndicator:function(){o=e.makeIndicator({navContainer:".toc_section_titles",offsetHeight:0})},update:function(){this.is_editing?(this.$("#@wrapper").addClass("is_editing"),this.attach()):(this.$("#@wrapper").removeClass("is_editing"),this.detach()),this.resetActiveState()},updateScrollIndicator:function(){o.refreshIndicator()},updateFixable:function(){var a,b;a=$(".ContentPageTopicFeed"),b=160,d.makeFixable(this.$("#@topic_nav"),{scroll_dep:!0,footer:a,extra_top_spacing:20,extra_bottom_spacing:b,min_width:990})},showErrorOnLiveUpdate:function(){if(this.isOnDragActive){this.isOnDragActive=!1,$("html, body").stop();var a=this;this.serverCall("show_error_on_liveupdate").send().success(function(){setTimeout(a.fnbind(function(){a.detach(),a.attach()}),0)})}},toggleEditMode:function(){this.is_editing=!this.is_editing,this.update(),this.resetActiveState(),o.refreshIndicator(),this.updateFixable()},editLinkClickCallback:function(){this.is_editing&&this.popover&&this.popover.scrollToSelf()},bindClickHandler:function(){this.editSectionLink.click(this.fnbind(function(a){a.preventDefault(),this.toggleEditSection()}))},toggleEditSection:function(){this.is_editing_section=!this.is_editing_section,this.updateToc()},updateToc:function(){this.is_editing_section?(this.$("#@wrapper").addClass("is_editing_section"),this.editSectionLink.text(this.done_text)):(this.$("#@wrapper").removeClass("is_editing_section"),this.editSectionLink.text(this.add_text))},setEditLink:function(){var a=this.child("hover_menu").$("#@link");this.editSectionLink=a},setCurrentPopover:function(a){this.popover=a},onEndSectionMousedownCallback:function(a,b){$(b).addClass("dragging_node node_clone_section on_drag"),a.style.height=$(b).outerHeight()+"px"},onEndSubsectionMousedownCallback:function(a,b){$(a).addClass("dragging_node node_clone on_drag"),b<1?$(a).addClass("primary_section"):$(a).addClass("sec_section")},onEndSubsectionMouseupCallback:function(a,b,c,d,e,f){$(b).removeClass("on_drag"),$(b).addClass("on_release");if(c===d&&e===f){this.setToDefaultView();return}a=a.firstChild;var g=a.getAttribute("sid"),h=this.sectionNodes[e][0].firstChild.getAttribute("sid"),i=this;e===f?this.serverCall("move_question_in_section").kwargs({section_id:parseInt(h),qid:parseInt(a.getAttribute("oid")),new_pos:c}).liveMutate().send().success(function(){i.setToDefaultView()}).error(function(){i.setToDefaultView(),setTimeout(function(){i.detach(),i.attach()})}):this.serverCall("move_question_across_section").kwargs({section_id:parseInt(h),old_section_id:parseInt(g),qid:parseInt(a.getAttribute("oid")),new_pos:c}).liveMutate().send().success(function(){i.setToDefaultView()}).error(function(){i.setToDefaultView(),setTimeout(function(){i.detach(),i.attach()})})},onEndSectionMouseupCallback:function(a,b,c,d){$(b).removeClass("on_drag"),$(b).addClass("on_release");if(c<1||c===d){this.setToDefaultView();return}a=a.firstChild;if(c!=d){var e=this;this.serverCall("move_section").kwargs({section_id:parseInt(a.getAttribute("sid")),tid:e.tid,new_pos:c}).liveMutate().send().success(function(){e.setToDefaultView()})}}}),a.TopicFaqSubPageMainList=a.TopicFaqMainList.extend({updateFixable:function(){},setEditLink:function(){},bindClickHandler:function(){},updateToc:function(){}}),a.TopicFaqMainListEditLink=p.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.mainList=a.lookup("reorderable_list"),a.$("#@edit").click(function(b){b.preventDefault();var c=a.$("#@edit").offset().top-$(window).scrollTop();a.toggleMainListEditMode();if(a.is_faq_incomplete){var d=a.mainList.lookup("overview_selector");d.$input.focus();var e=a.$("#@edit").offset().top,f=e-c;$("html, body").scrollTop(f)}}),a.$("#@done").click(function(b){b.preventDefault(),a.toggleMainListEditMode()})},toggleMainListEditMode:function(){this.mainList.toggleEditMode(),this.mainList.editLinkClickCallback()}}),a.TopicFaqContents=j.extend({onLoad:function(){this._super.apply(this,arguments);var a=this,b=a.lookup("reorderable_list");b.showErrorOnLiveUpdate(),document.addEventListener("mousedown",function(){b.resetActiveState()},!0)}}),a.TopicFaqContentsScroller=c.extend({onLoad:function(){var a=this,b=a.lookup("reorderable_list");b.is_editing&&a.scroll_to_section_id&&a.whenOnLoaded(function(){var b=$("div[sid='"+a.scroll_to_section_id+"'].ReorderableListBranch"),c=b.offset().top,d=$(window).height(),e=c-d/2;$("html, body").animate({scrollTop:e},300),b.addClass("highlighted")})}}),a.TopicFaqSectionFocusHelper=c.extend({focusSection:function(){this.focus_section_id&&$(document).trigger("focusSection"+this.focus_section_id)}}),a.TopicSection=c.extend({onLoad:function(){var a=this,b=a.lookup("reorderable_list");a.should_show_overview_questions_popover?(a.child("overview_popover").show(),b.setCurrentPopover(a.child("overview_popover"))):a.should_show_adding_sections_popover?(a.child("add_section_popover").show(),b.setCurrentPopover(a.child("add_section_popover"))):a.should_show_editing_section_popover&&(a.child("editing_section_popover").show(),b.setCurrentPopover(a.child("editing_section_popover"))),a.registerFocusSectionEvent()},showOverviewQuestionsPopover:function(){this.should_show_overview_questions_popover&&this.child("overview_popover").show()},showAddingSectionsPopover:function(){this.should_show_adding_sections_popover&&this.child("add_section_popover").show()},showEditingSectionPopover:function(){this.should_show_editing_section_popover&&this.child("editing_section_popover").show()},scrollToAnchor:function(){var a=$("#"+this.anchor_id);$("html, body").scrollTop(a.offset().top)},registerFocusSectionEvent:function(){var a=this;$(document).on("focusSection"+a.section_id,function(){a.child("selector").$input.focus(),a.scrollToAnchor()})}}),a.TopicSectionContents=j.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.faq_list=a.cQuery(":topic_page.topic_faq_list"),a.selector=a.cQuery(":reorderable_list_branch.selector")},onClickViewMore:function(){this._super.apply(this,arguments),this.lookup("reorderable_list").updateScrollIndicator()}}),a.RecentlyAddedQuestionHighlighter=c.extend({onLoad:function(){var a=this,b=a.lookup("reorderable_list");b.is_editing&&a.highlight_question&&a.whenOnLoaded(function(){var b=$("div[sid='"+a.section_id+"'][oid='"+a.highlight_question+"']");b.addClass("highlighted")})}}),a.TopicSectionEmptyState=c.extend({onLoad:function(){var a=this.cQuery(":reorderable_list_branch.selector"),b=this;b.$("#@add_question").click(function(c){var d,e;b.is_secondary_section&&(d=b.cQuery(":reorderable_list_branch.section_title"),e=d.$("#@item").offset().top-$(window).scrollTop()),b.lookup("reorderable_list").toggleEditMode(),a.$input.focus();if(b.is_secondary_section){var f=d.$("#@item").offset().top,g=f-e;$("html, body").scrollTop(g)}c.preventDefault()})}}),a.TopicFaqViewMoreLabel=c.extend({onLoad:function(){var a=this;a.$("#@view_more").click(function(b){b.preventDefault(),a.expand()});var b=a.lookup("reorderable_list_contents");b.$("#@contents_wrapper").hasClass("show_hidden_items")&&a.expand()},expand:function(){this.lookup("reorderable_list_contents").$("#@contents_wrapper").addClass("show_hidden_items"),this.$("#@view_more").removeClass("view_mode_only"),this.$("#@view_more").addClass("hidden")}}),a.TopicSectionQuestionItem=k.extend({remove:function(){this.modal("remove")}}),a.SectionTitleItem=k.extend({remove:function(){this.modal("remove")}}),a.SectionEditFaqLink=p.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.$("#@link").click(function(b){var c=a.lookup("section_title_item"),d=c.$("#@item").offset().top-$(window).scrollTop();a.lookup("reorderable_list").toggleEditMode();var e=c.$("#@item").offset().top,f=e-d;$("html, body").scrollTop(f);if(a.incomplete_state){var g=a.cQuery(":reorderable_list_branch.selector");g.$input.focus()}b.preventDefault()})}}),a.TopicFaqRemoveQuestionWarning=l.extend({onSubmit:function(){var a=this;a.serverCall("remove").liveMutate().success(function(){a._closeModal()}).sendOnlyOnce()}}),a.TopicFaqRemoveSectionWarning=l.extend({onSubmit:function(){var a=this;a.serverCall("remove").liveMutate().success(function(){a._closeModal()}).sendOnlyOnce()}});var r=a.TopicFaqPopover=c.extend({onLoad:function(){var a=this;a.is_dismissable&&(a.$("#@close").click(function(b){a.hide(),a.onClose(),b.preventDefault()}),a.$("#@dismiss_link").click(function(b){a.hide(),a.onDismiss(),b.preventDefault()}))},scrollToSelf:function(){var a=this.$("#@popover").offset().top,b=$(window).height(),c=a-b/2;$("html, body").animate({scrollTop:c},300)},onClose:function(){this.serverCall("set_user_got_popover").send()},onDismiss:function(){this.onClose()},show:function(){this.$("#@popover").removeClass("hidden")},hide:function(){this.$("#@popover").addClass("hidden")}});a.TopicFaqEditorNuxPopoverOverviewQuestions=r.extend({onDismiss:function(){this._super.apply(this,arguments),this.lookup("reorderable_list_branch").showAddingSectionsPopover(),$("html, body").animate({scrollTop:0},300)}}),a.TopicFaqEditorNuxPopoverAddingSections=r.extend({onDismiss:function(){this._super.apply(this,arguments);if(this.has_next_step){this.lookup("reorderable_list_branch").showEditingSectionPopover();var a=this.cQuery(":reorderable_list_branch.editing_section_popover"),b=a.$("#@popover").offset().top,c=$(window).height(),d=b-c/2;$("html, body").animate({scrollTop:d},300)}}}),a.TopicFaqEmptyState=c.extend({onLoad:function(){var a=this;a.$("#@edit_faq").click(function(b){a.lookup("topic_faq_list").toggleEditMode(),b.preventDefault()})}}),a.TopicPageAboutSection=c.extend({toggleTopicPhoto:function(){this.$("#@topic_photo").toggleClass("hidden")}}),a.TopicWikiNoButtonInlineEditor=g.extend({onLoad:function(){var a=this;a._super.apply(a,arguments);var b=a.lookup("topic_about");if(b){var c=b.fnbind(b.toggleTopicPhoto);a.setToggleCallback(c)}}}),a.SectionShortNameInlineEditor=g.extend({submitHandler:function(){var a=this;a._super.apply(a,arguments),this.input_obj.keypress(this.fnbind(function(a){var b=a.which;b=="13"&&(h.validate(this,{valid:this.fnbind(this.trigger_request),invalid:function(){}}),a.preventDefault())}))}}),a.TopicFaqQuestionSelector=f.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.questionMarkInserted=!1,a.should_render_instruction&&(a.serverCall("results_content_for").contentFor(a.$results,{parentCID:a.cid}).kwargs({query:a.query}).send(),a.$input.focus(function(){a.showResults(!0)}),a.$input.blur(function(){a.showResults(!1)}))},serverCallHandler:function(a,b){this._super.apply(this,arguments),!a&&!this.faq_is_empty&&this.setQuery("")},resultsServerCallHandler:function(){this._super.apply(this,arguments),this.$input.focus()},updateResults:function(){var a=this;a.should_render_instruction?a._busy||(a.setBusy(!0),a.serverCall("results_content_for").contentFor(a.$results,{parentCID:a.cid}).kwargs({query:a.query}).success(a.fnbind(a.resultsServerCallHandler)).except(a.fnbind(a.resultsServerCallHandler)).error(a.fnbind(a.resultsServerCallHandler)).send()):a._super.apply(a,arguments)},createNewQuestion:function(){var a=this;if(a.hasPendingServerCall())return;require("action_log").logPrimaryAction("WebTopicFaqMainListWrapperQuestionAdd",a.impression_target),a.makeServerCall(a.serverCall("create_new_question").kwargs({input_text:a.query}).liveMutate().except("success",a.fnbind(a._handleAddQuestionSuccess)))},addExistingQuestion:function(a){var b=this;if(b.hasPendingServerCall())return;b.makeServerCall(b.serverCall("add_existing_question").kwargs({qid:a}).liveMutate())},_handleAddQuestionSuccess:function(a){this.serverCallHandler(!1,a)},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery(""),this.questionMarkInserted=!1;return}if(!this.query){this.questionMarkInserted=!1;return}if(this.questionMarkInserted)return;this.query.match(/[?]$/)===null&&(this.questionMarkInserted=!0,this.setQuery(this.query+"?"))},queryDidChange:function(){this._super.apply(this,arguments),this.maybeInsertQuestionMark()},resultWasSelected:function(a){switch(a.ty){case"question":this.addExistingQuestion(a.data.qid);break;case"create_question":this.createNewQuestion()}}}),a.TopicFaqAddSectionHoverMenu=m.extend({isInvalidCloseTarget:function(a){var b=this.$("#@menu"),c=this._super.apply(this,arguments);return c||a.parents().filter(b).length>0?!0:(this.shown&&this.lookup("reorderable_list").toggleEditSection(),!1)},doShow:function(){this._super.apply(this,arguments),this.cQuery(".menu_contents.selector").focus()}}),a.SectionTitleSelectorAdd=n.extend({addTopic:function(a){var b=this;b.serverCall("is_descendant_topic").kwargs(a).success(function(c){if(c){var d={};d[b.error_dialog_button_text]=null,b.serverCall("add").kwargs(a).liveMutate().error(b.fnbind(function(){$(".content").dialog({title:b.error_dialog_title,contents:b.error_dialog_message,buttons:d})})).send()}else b.modal("load_resistance_modal",{kwargs:a})}).send()},onSelectCallback:function(){this.lookup("hover_menu").hide(),this.lookup("reorderable_list").toggleEditSection()}}),a.TopicFaqAddSectionResistanceModal=l.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.$radios=a.$("#@picker input[type=radio]"),a.$radios.change(function(){a.$radios.map(function(){var a=$(this),b=$("label[for='"+a.attr("id")+"']");b.toggleClass("selected",a.is(":checked")),b.toggleClass("not_selected",!a.is(":checked"))})}),a.$("#@new_topic_name").focus(function(){a.$("#@create_topic").prop("checked",!0),a.$("#@create_topic").change()}),a.$("#@new_topic_name").focus()},onSubmit:function(){var a=this;a.$("#@create_topic").is(":checked")?a.serverCall("add_new_topic").kwargs({new_topic_name:a.$("#@new_topic_name").val()}).liveMutate().error(a.fnbind(function(){var b={};b[a.error_dialog_button_text]=null,$(".content").dialog({title:a.error_dialog_title,contents:a.error_dialog_message,buttons:b})})).success(function(){a._closeModal()}).send():a.serverCall("add_selected_topic").liveMutate().success(function(){a._closeModal()}).send()}}),a.CompleteTopicFaqSidebarWrapper=c.extend({onLoad:function(){this.serverCall("track_impression").send()}}),a.ShowNextTopicLink=p.extend({onLoad:function(){var a=this;a._super.apply(this,arguments),a.$("#@next_topic").click(function(b){a.serverCall("trigger_next_topic").liveMutate().send(),b.preventDefault()})}})},{"view/fixable2":!0,"view/modal":!0,input_validate:!0,"view/reorderable_list":!0,"view/topic_selector":!0,"third_party/truncate":!0,"view/hover_menu":!0,"view/selector":!0,"view/inline_editor":!0,"view/scroll_indicator":!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/quora_meets_bagel",function(require,a,b){var c=require("w2.quora").Component;a.QMBPage=c.extend({onLoad:function(){var a=this;a.$("%@qmb_button").click(a.fnbind(function(b){var c=b.target.id;return a.serverCall("take_qmb_action").kwargs({which_action:c}).success(function(){window.location.reload()}).send(),!1}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/moderation/appeal",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.AppealLink=c.extend({onLoad:function(){this.$("#@show_appeal_modal").click(this.fnbind(function(
){return this.showAppealModal(),!1}))},showAppealModal:function(){this.modal("appeal_modal")}}),a.AppealModal=d.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@submit_button").addClass("submit_button_disabled");var a=this.$("#@policy_checkbox"),b=this;a.click(function(a){a.currentTarget.checked?b.$("#@appeal_details").removeClass("hidden"):(b.$("#@appeal_details").addClass("hidden"),b.$("#@submit_button").addClass("submit_button_disabled"))}),b.$("#@appeal_type").change(this.fnbind(function(){b.$("#@submit_button").removeClass("submit_button_disabled")}));var c=this.$("#@answer_tag_details_link"),d=this.$("#@answer_tag_details_content");c.click(function(a){d.hasClass("hidden")?(d.removeClass("hidden"),c.text(b.collapse_details)):(d.addClass("hidden"),c.text(b.show_details))})},onSubmit:function(){this.appeal()},appeal:function(){var a=this.child("appeal_comment").serialize(),b=this.$("input:radio:checked").val(),c={comment:a,appeal_type:b};this.serverCall("send_appeal").liveMutate().kwargs(c).success(this._closeModal()).send()}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/answer_credibility",function(require,a,b){var c=require("w2.quora").Component;a.EndorsementAndAnswerFact=c.extend({onLoad:function(){var a=this;a.$("#@endorsement_modal").click(function(){return a.modal("load_endorsement_modal"),!1})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/tooltip",function(require,a,b){var c=require("w2.quora").Component;a.TooltipComponent=c.extend({onLoad:function(){var a=this.$("#@tooltip");a.parent().tooltip(this.options),a.remove()}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/fixable_component",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2");a.FixableComponent=c.extend({onLoad:function(){var a=this.$("#@fixable_component");d.makeFixable(a.parent(),this.options),a.remove()}})},{"view/fixable2":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/advertising/create_ad",function(require,a,b){var c=require("w2.quora").Component,d=require("view/upload"),e=require("window_manager");a.CreateAdMain=d.UploadDialogContents.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@submit_ad").click(this.fnbind(function(a){var b=this.$("#@headline").val(),c=this.$("#@url").val(),d=this.$("#@description").val(),f=this.$("#@photo_key").val();return this.serverCall("submit_ad").kwargs({ad_id:this.ad_id,headline:b,description:d,url:c,photo_key:f}).success(this.fnbind(function(a){e.navigateTo("create_campaign?ad_id="+a)})).send(),!1}))},uploadSuccess:function(a){this.$("#@photo_key").val(a.photo_key),this.serverCall("upload").kwargs({ad_id:this.ad_id,photo_key:a.photo_key}).contentFor(this.$("#@upload_image"),{parentCID:this.cid}).send()}})},{window_manager:!0,"view/upload":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/advertising/create_campaign",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.CreateCampaignForm=c.extend({onLoad:function(){var a=this;a.$("#@ad_content_"+a.selected_ad_id).show(),a.$("#@ad_selector").change(function(){a.changeSelectedAd()}),a.$("#@submit").click(function(){a.doSubmit()})},changeSelectedAd:function(){var a=this;a.$("#@ad_content_"+a.selected_ad_id).hide(),a.selected_ad_id=a.$("#@ad_selector").val(),a.$("#@ad_content_"+a.selected_ad_id).show()},doSubmit:function(){var a=this,b=a.selected_ad_id,c=a.lookup("start_date").getTime(),e=a.lookup("end_date").getTime(),f=a.lookup("topic_selection").getTopicNames();a.serverCall("create_campaign").kwargs({offer:a.$("#@offer").val(),budget:a.$("#@budget").val(),start:c*1e3,end:e*1e3,topic_names:f,ad_id:b}).success(function(a){d.navigateTo("manage?campaign_id="+a)}).send()}}),a.DateSelector=c.extend({onLoad:function(){var a=this,b=new Date,c=b.toJSON().slice(0,10);a.$("#@select_date").val(c)},convertDateToTimeStamp:function(a){var b=new Date(a);return b.getTime()},getTime:function(){var a=this.$("#@select_date").val();if(a==="")return-1;var b=new Date(a);return b.getTime()}})},{window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/advertising/manage_campaign",function(require,a,b){var c=require("w2.quora").Component,d=a.CampaignStopButton=c.extend({events:{"click #@stop":"onClick"},onLoad:function(){console.log("load")},onClick:function(a){return console.log("clicked"),this.serverCall("stop").send(),!1}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/privacy",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base,e=require("webnode2");a.FirstAnonAnswerWarningDialog=d.extend({onSubmit:function(){this.serverCall("accept").send(),this._super.apply(this,arguments),e.Modal.modalFor(this).executeOnSubmitCallBack()}})},{webnode2:!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/manage",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base,e=require("w2.context"),f=a.FeedControlModalContext=e.Context.extend({initialProperties:function(){return{itemFollowed:[]}}});a.FeedControlModal=d.extend({contextConstructor:function(){return f},onLoad:function(){var a=this;a._super.apply(this,arguments);var b=a.$("#@organize"),c=a.$("#@discover"),d=a.$("#__w2_modal_overlay_"),e=a.child("feed_control_container").$("#@organize"),f=a.child("feed_control_container").$("#@discover");b.click(this.fnbind(function(){b.addClass("selected"),e.removeClass("hidden"),c.removeClass("selected"),f.addClass("hidden")})),c.click(this.fnbind(function(){c.addClass("selected"),f.removeClass("hidden"),b.removeClass("selected"),e.addClass("hidden")})),d.on("mousedown",function(b){b.target==this&&!a._isScrollBarClicked(b)&&a.maybeRefreshFeed()})},_isScrollBarClicked:function(a){var b=$.getScrollbarWidth();return window.innerWidth-a.clientX<b?!0:!1},onClose:function(){this.maybeRefreshFeed()},onSubmit:function(){this.maybeRefreshFeed()},onCancel:function(){this.maybeRefreshFeed()},maybeRefreshFeed:function(){var a=this;a.FeedControlModalContext=a.getContext(f);var b=a.FeedControlModalContext.get("itemFollowed");a._closeModal(),Object.keys(b).length>0&&a.refreshFeed()},refreshFeed:function(){var a=this,b=$("#feed_control_update_feed_screen"),c=5500;b.removeClass("hidden"),a.serverCall("refresh_feed").success(function(){setTimeout(b.addClass("hidden"),c)}).error(function(){setTimeout(b.addClass("hidden"),c)}).liveMutate().send()}}),a.FeedControlModalLink=c.extend({onLoad:function(){var a=this;this.$("#@create_modal_link").click(this.fnbind(function(){return a.modal("load_inner",{closeOnBackgroundClick:!1}),!1}))}}),a.FeedControlContent=c.extend({onLoad:function(){var a=this;a.feed_control_contents=[];for(var b in a.content_ids){var c=a.content_ids[b],d="#@"+c;a.feed_control_contents[c]={filter_link:a.child("filter_section").$(d),content_class:a.$(d),scroll_position:0}}for(var e in a.feed_control_contents){var f=a.feed_control_contents[e],g=a._createOnLinkClicked(e);f.filter_link.click(this.fnbind(g))}},_createOnLinkClicked:function(a){var b=this;return function(){var c=b.feed_control_contents[b.active_id];c.scroll_position=c.content_class.parent().scrollTop(),c.filter_link.removeClass("selected"),c.content_class.addClass("hidden");var d=b.feed_control_contents[a];d.filter_link.addClass("selected"),d.content_class.removeClass("hidden"),d.content_class.parent().scrollTop(d.scroll_position),b.active_id=a}}}),a.FeedControlContentRow=c.extend({onLoad:function(){var a=this,b=a.$("#@item_button");a.FeedControlModalContext=a.getContext(f),b.click(this.fnbind(function(){var b=this.cid,c=a.FeedControlModalContext.get("itemFollowed");b in c?delete c[b]:c[b]=!0,a.FeedControlModalContext.set("itemFollowed",c)}))}})},{"w2.context":!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("unified_view/modal",function(require,a,b){var c=require("interface/component").Component,d=require("interface/settings").pageIsMobile,e=require;if(d)var f=e("mobile_app2/client");else var g=e("webnode2");a.ModalBase=c.extend({onLoad:function(){var a=this;a.close_button=a.$id("@close_button"),a.cancel_button=a.$id("@cancel_button"),a.submit_button=a.$id("@submit_button"),a.close_button.on("click",function(b){a.onClose(),b.preventDefault()}),a.cancel_button.on("click",function(b){a.onCancel(),b.preventDefault()}),a.submit_button.on("click",function(b){a.onSubmit(),b.preventDefault()})},_closeModal:function(){d?f.sendMessageToClient("dismissModal"):g.Modal.modalFor(this).close()},onClose:function(){this._closeModal()},onCancel:function(){this._closeModal()},onSubmit:function(){if(this.submitDisabled)return;this._closeModal()},disableSubmit:function(){this.submitDisabled=!0,this.submit_button.addClass("action_disabled")},enableSubmit:function(){this.submitDisabled=!1,this.submit_button.removeClass("action_disabled")}})},{"interface/settings":!0,"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/lazy",function(require,a,b){var c=require("interface/component").Component,d=require("interface/rpc").rpc;a.LazyComponent=c.extend({onLoad:function(){var a=this,b=a.$id("@wrapper").get()[0];b&&d("/api/rerender_component_POST").contentFor(b,{parentCID:a.parent().cid}).kwargs({serialized_component:a.serialized_component}).send({batched:!0})}})},{"interface/rpc":!0,"interface/component":!0})}),require.whenReady("settings",function(){!0,window.log&&window.log.enabled&&window.log("main","main-pre2 is loaded."),require("w2.timing").logTime("mainPre2ScriptEnd")}),require.whenReady("settings",function(){require.install("log.settings",function(require,a,b){a.resetSettings=function(a){var b=require("settings");a.enable(b===null?!1:b.client_side_logging||!1),a.scopes.resetLevel("",a.level.error),a.scopes.resetLevel("page",a.level.trace),a.scopes.resetLevel("w2.livenode",a.level.trace),a.scopes.resetLevel("views",a.level.trace),a.scopes.resetLevel("qtext2",a.level.trace),a.scopes.resetLevel("test",a.level.trace)}},{settings:!0})}),require.whenReady("settings",function(){require.install("log",function(require,a,b){(function(b,undefined){var c=new Date,d=function(a){return Array.prototype.join.call(a," ")},e=function(a,b){for(var c in b)a[c]=b[c];return a},f=b.log=a.log=function(){return f.log.apply(f,arguments)},g=b.console,h=g||{},i=window&&window.navigator.appName=="Microsoft Internet Explorer";if(i){var j=/MSIE ([0-9]{1,}[.0-9]{0,})/;j.exec(navigator.userAgent)!==null&&parseFloat(RegExp.$1)>=8?(h={},h.log=function(){g&&g.log&&g.log(d(arguments))},h.info=function(){g&&g.log&&g.info(d(arguments))},h.warn=function(){g&&g.log&&g.warn(d(arguments))},h.error=function(){g&&g.log&&g.error(d(arguments))}):h={}}var k=["log","info","warn","error"],l=function(){};for(var m in k){var n=k[m];h[n]||(h[n]=l)}var o=function(a){a===undefined&&(a=null),this.level=a,this.children={}};o.prototype.setLevel=function(a,b,c){var d=this.tryGetChild(a,c);if(d===null){b===undefined&&(b=null),this.level=b;return}d.child===undefined&&(this.children[d.name]=d.child=new o),d.child.setLevel(a,b,d.continueFrom),this.optimize(d.name)},o.prototype.removeChildren=function(a,b){var c=this.tryGetChild(a,b);if(c===null){this.children={};return}if(c.child===undefined)return;c.child.removeChildren(a,c.continueFrom),this.optimize(c.name)},o.prototype.optimize=function(a){var b=this.children[a];b!==undefined&&b.level===null&&b.childCount()===0&&delete this.children[a]},o.prototype.childCount=function(){var a=0;for(var b in this.children)this.children.hasOwnProperty(b)&&a++;return a},o.prototype.getLevel=function(a,b){var c=this.tryGetChild(a,b);if(c===null||c.child===undefined)return this.level;var d=c.child.getLevel(a,c.continueFrom);return d!==null?d:this.level},o.prototype.print=function(a,b,c){var d=this.level===null?c:this.level;f.console.log(a+b+": "+f.level.toString(d)+(this.level===null?" (inherited)":""));for(b in this.children){var e=this.children[b];e.print(a+"  ",b,d)}},o.prototype.tryGetChild=function(a,b){if("string"!=typeof a)throw new Error("Scope must be string.");b=b||0;if(b>=a.length)return null;var c=a.indexOf(".",b),d=null;return c<0?(c=a.length,d=a.substr(b,c-b)):(d=a.substr(b,c-b),c++),{name:d,child:this.children[d],continueFrom:c}};var p=function(a,b,c){this.time=new Date,this.level=a,this.scope=b,this.data=c,this.message=d(c)};p.prototype.toString=function(){return f.level.toString(this.level).concat(" ",this._timeToString(),", ",this.scope,": ",this.message)},p.prototype.print=function(){var a=this.level=="trace"?"log":this.level;f.console[f.level.toString(a)].apply(f.console,[this._timeToString()+", "+this.scope+":"].concat(this.data))},p.prototype.checkScope=function(a){return this.scope==a||this.scope.startsWith(a+".")},p.prototype._timeToString=function(){return((this.time-c)/1e3).toString()+"s"};var q=function(a){this.list=a||[]};q.prototype.toString=function(){return this.list.join("\r\n")},q.prototype.print=function(){for(var a in this.list)this.list[a].print()},q.prototype.add=function(a){return this.list.push(a)},q.prototype.count=function(){return this.list.length},q.prototype.getLast=function(){return this.list.length===0?null:this.list[this.list.length-1]},q.prototype.clear=function(){this.list=[]},q.prototype.filter=function(a,b){var c,d;if(typeof a=="function")return c=Array.prototype.filter.apply(this.list,arguments),new q(c);b===undefined&&typeof a=="string"&&(b=a,a=null);var e=typeof a=="number";if(!e){var f={};for(d in a)f[a[d]]=a[d];a=f}c=[];for(d in this.list){var g=this.list[d];if(a!==null&&a!==undefined&&(e?g.level<a:!(g.level in a)))continue;if(b!==null&&b!==undefined&&!g.checkScope(b))continue;c.push(g)}return new q(c)};var r={enabled:null,outputEnabled:!0,entries:new q,level:{none:0,trace:1,log:2,info:3,warn:4,error:5,toString:function(a){switch(a){case 0:return"none";case 1:return"trace";case 2:return"log";case 3:return"info";case 4:return"warn";case 5:return"error";default:throw new Error("Unknown log.level value.")}}},scopes:{root:new o(0),cache:{},setLevel:function(a,b){this.root.setLevel(a,b),this.cache={}},resetLevel:function(a,b){this.root.removeChildren(a),this.root.setLevel(a,b),this.cache={}},removeChildren:function(a){this.root.removeChildren(a),this.cache={}},getLevel:function(a){return this.cache[a]===undefined&&(this.cache[a]=this.root.getLevel(a)||f.level.none),this.cache[a]},hasLevel:function(a,b){var c=this.getLevel(a);return c<=b&&c!=f.level.none},print:function(a){f.console.log("Log scopes:"),this.root.print("  ","(root)")}},enabledImpl:{console:h,trace:function(a){var b=this._tryAddLogEntry(f.level.log,a,Array.prototype.slice.call(arguments,1));return b===null?null:(f.outputEnabled&&(f.console.trace?f.console.trace():f.console.log.call(f.console,("Stack trace:\r\n"+f._getStackTrace()).replace("\r\n","\r\n  "))),b)},log:function(a){return this._tryAddLogEntry(f.level.log,a,Array.prototype.slice.call(arguments,1))},info:function(a){return this._tryAddLogEntry(f.level.info,a,Array.prototype.slice.call(arguments,1))},warn:function(a){return this._tryAddLogEntry(f.level.warn,a,Array.prototype.slice.call(arguments,1))},error:function(a){return this._tryAddLogEntry(f.level.error,a,Array.prototype.slice.call(arguments,1))},_tryAddLogEntry:function(a,b,c){if(!f.scopes.hasLevel(b,a))return null;var d=new p(a,b,c);return f.entries.add(d),f.outputEnabled&&d.print(),d},_getStackTrace:function(){var a=[],b=!1;try{e.dont.exist+=0}catch(c){var d,e,f;if(c.stack){d=c.stack.split("\n");for(e=0,f=d.length;e<f;e++)d[e].match(/^\s*[A-Za-z0-9\-_\$]+\(/)&&a.push(d[e]);a.shift(),b=!0}else if(window&&window.opera&&c.message){d=c.message.split("\n");for(e=0,f=d.length;e<f;e++)if(d[e].match(/^\s*[A-Za-z0-9\-_\$]+\(/)){var g=d[e];d[e+1]&&(g+=" at "+d[e+1],e++),a.push(g)}a.shift(),b=!0}}if(!b){var h=arguments.callee.caller;while(h){var i=h.toString(),j=i.substring(i.indexOf("function"),i.indexOf("{"))||"anonymous";a.push(j),h=h.caller}}return a.join("\r\n")}},disabledImpl:{console:{log:function(){},trace:function(){},info:function(){},warn:function(){}},log:function(){},trace:function(){},info:function(){},warn:function(){},error:function(){}},enable:function(a){a=a===undefined?!0:a;if(f.enabled===a)return;f.enabled=a;var b=a?f.enabledImpl:f.disabledImpl;e(f,b)},disable:function(){f.enable(!1)},enableOutput:function(a){a=a===null?!0:a,f.outputEnabled=a},disableOutput:function(){f.enableOutput(!1)},resetSettings:function(){require("log.settings").resetSettings(f),f("log.resetSettings","Settings are reset to default.")}};e(f,r),f.resetSettings()})(this)},{"log.settings":!0})}),require.whenReady("settings",function(){require.install("w2.keycombo",function(require,a,b){var c=require("cookies"),d=require("scribe"),e="keyboard_used",f=!0,g={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",13:"ENTER",27:"ESCAPE",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN"},h=a.hasCmdKey=/Mac/.test(navigator.platform),i=function(){$("body").addClass("show_focus"),c.cookie(e)||(c.cookie(e,!0),d.log({category:"keyboard_shortcuts",time:(new Date).getTime()}))},j=function(a){return a.toUpperCase().split(" ").map(function(a){return{alt:/ALT-/.test(a),ctrl:/CTRL-/.test(a)||!h&&/CMD-/.test(a),meta:/META-/.test(a)||h&&/CMD-/.test(a),shift:/SHIFT-/.test(a),character:a.split("-").pop()}})},k=function(a){return a.map(function(a){var b="";return a.alt&&(b+="ALT-"),a.ctrl&&(b+="CTRL-"),a.meta&&(b+="META-"),a.shift&&(b+="SHIFT-"),b+=a.character,b}).join(" ")};a.bindKeyComboHandler=function(a,b,c,d){var e=j(b);b=k(e);var h=$(a).data("kchandlers")||{};if(b in h)return!1;var l=0,m,n=function(){l=0,clearTimeout(m)},o=function(a){clearTimeout(m);if(!f)return;var b=a.target.nodeName.toLowerCase();if(!d&&(a.target.isContentEditable||b=="input"||b=="textarea"))return;var h=e[l],j=g[a.which]||String.fromCharCode(a.which).toUpperCase();if(j===h.character&&a.altKey==h.alt&&a.ctrlKey==h.ctrl&&a.metaKey==h.meta&&a.shiftKey==h.shift)return l+=1,l==e.length?(l=0,i(),c(a)):(m=setTimeout(n,1e3),!1);n()};return h[b]=o,$(a).data("kchandlers",h),$(a).on("keydown",o),!0},a.unbindKeyComboHandler=function(a,b){a=a.toUpperCase();var c=$(b).data("kchandlers")||{};return a in c?($(b).unbind("keydown",c[a]),delete c[a],!0):!1};var l=192;require("keystrokes").on(l,function(){f=!f,console.log("Keyboard shortcuts "+(f?"enabled":"disabled"))})},{cookies:!0,scribe:!0,keystrokes:!0})}),require.whenReady("settings",function(){require.install("ytplayer",function(require,a,b){a.getYTPlayerStatuses=function(a,b){var c=[];return a.find(".qtext_embed iframe").each(function(a,d){var e=$(d).attr("id"),f=$(d).parent().attr("data-yt-id");$.each(window.YT.players,function(a,b){if(b.playerId==e){var d=b.player.getCurrentTime();c.push({ytId:f,time:d,state:b.state})}}),b&&b(d)}),c},a.restoreYTPlayerStatuses=function(a,b){$.each(b,function(b,c){var d=a.find('.qtext_embed[data-yt-id="'+c.ytId+'"]');if(!d.size())return;d=d.get(0),$(d).click(),$.each(window.YT.players,function(a,b){b.playerId==$(d).find("iframe").attr("id")&&(b.onReady=function(a){a.player.seekTo(c.time),(c.state==window.YT.PlayerState.PAUSED||c.state==window.YT.PlayerState.ENDED)&&a.player.pauseVideo()})})})}},{})}),require.whenReady("settings",function(){require.install("interface/helpers",function(require,a,b){function c(a,b,c,d){var e,f=function(b){return d&&d(b)?a:b},g=function(c){var d=a[c],e=b[c];if(d!==undefined){if(typeof d!="function")throw new TypeError("You can't override members that aren't functions.");a[c]=function(){var a=this._super,c;typeof e=="function"&&(this._super=e.bind(b));try{c=d.apply(this,arguments)}finally{this._super=a}return f(c)}}else if(typeof e=="function"){var g=function(){return f(e.apply(this,arguments))},h=g.bind(b);h.bind=function(a){return g.bind(a)},a[c]=h}else Object.defineProperty(a,c,{get:function(){return f(b[c])},set:function(){throw"You cannot set a wrapped property on an outer object. Please talk to Platform team if you feel you need this."},enumerable:!0})};for(e=0;c&&e<c.length;e++)g(c[e]);return a}function d(a){throw new Error("Sorry, "+a+" is not implemented yet. Please yell at Platform team.")}a.wrap=c,a.notImplemented=d},{})}),require.whenReady("settings",function(){require.install("interface/settings",function(require,a,b){var c=require("interface/helpers").wrap,d=require("settings"),e=["pageIsMobile","isLoggedIn","serverCallUrl","batchedServerCallUrl","interface_strings"];c(a,d,e)},{"interface/helpers":!0,settings:!0})}),require.whenReady("settings",function(){require.install("interface/jquery",function(require,a,b){function j(a,b,d,g){if(typeof d!="string")throw new TypeError("events must be a string. event/handler maps not supported.");if(c.pageIsMobile){var h=d.split(" "),i=h.reduce(function(a,b){return a||b=="click"},!1);if(i){a||e("removing click events on mobile");var j=f("mobile_app2/util");j.safeClickHandlerForElements(b,g)}return h.filter(function(a){return a!=="click"}).join(" ")}return d}var c=require("interface/settings"),d=require("interface/helpers").wrap,e=require("interface/helpers").notImplemented,f=require,g,h;c.pageIsMobile?(f("zepto"),g=window.Zepto,window.$=undefined,h=function(a){return g.zepto.isZ(a)}):(g=$,h=function(a){return a instanceof g});var i=["get","on","off","text","hasClass","addClass","removeClass","toggleClass","val","attr","focus","html","is","map","css"],k=function(){var a={on:function(a,b){return a=j(!0,this.get(),a,b),this._super.call(this,a,b)},off:function(a,b){return a=j(!1,this.get(),a,b),this._super.call(this,a,b)}},b=g.apply(this,arguments);return d(a,b,i,h)};a._jQuery=g,a.jQuery=k,a.extend=g.extend},{"interface/settings":!0,"interface/helpers":!0})}),require.whenReady("settings",function(){require.install("interface/rpc",function(require,a,b){var c=require("interface/settings"),d=require("Class").Class,e=require("interface/helpers").wrap,f=require("interface/jquery").extend,g=require,h,i,j=function(a){return a instanceof i},k=function(a){return a instanceof h},l=["_data","args","xargs","kwargs","contentFor","error","except","send","success","_url"];if(c.pageIsMobile){var m=g("mobile_app2/server_call");i=m._ServerCall,h=m.RPC,Array.prototype.push.apply(l,["callback"])}else{var n=g("webnode2");i=n._ServerCall,h=n.RPC,Array.prototype.push.apply(l,["_success","_error","url"])}var o=l,p=l.concat("liveMutate"),q={contentFor:function(a,b){if(!b.parentCID)throw new Error("must explicitly specify parentCID.");return c.pageIsMobile&&(b=b.parentCID),this._super(a,b)}},r=a.RPC=d.extend(f({__init__:function(a){var b=new h(a);return e(this,b,o,k)}},q));a.rpc=function(a){return c.pageIsMobile?new r(a):(new r).url(a)};var s=require("rpc_manager").enqueueRequest;a.ServerCall=d.extend(f({__init__:function(a,b,c){var d=new i(a,b,c);return e(this,d,p,j)}},q))},{"interface/settings":!0,"interface/jquery":!0,rpc_manager:!0,Class:!0,"interface/helpers":!0})}),require.whenReady("settings",function(){require.install("debounce",function(require,a,b){a.debounce=function(a,b,c){function n(a){var b=typeof a;return!!a&&(b=="object"||b=="function")}function p(){i&&clearTimeout(i),e&&clearTimeout(e),k=0,e=i=j=undefined}function q(){return Date.now()}function r(b,c){c&&clearTimeout(c),e=i=j=undefined,b&&(k=q(),f=a.apply(h,d),!i&&!e&&(d=h=undefined))}function s(){var a=b-(q()-g);a<=0||a>b?r(j,e):i=setTimeout(s,a)}function t(){r(m,i)}function u(){var c,n;d=arguments,g=q(),h=this,j=m&&(i||!o);if(l===!1)c=o&&!i;else{!e&&!o&&(k=g);var p=l-(g-k);n=p<=0||p>l,n?(e&&(e=clearTimeout(e)),k=g,f=a.apply(h,d)):e||(e=setTimeout(t,p))}return n&&i?i=clearTimeout(i):!i&&b!==l&&(i=setTimeout(s,b)),c&&(n=!0,f=a.apply(h,d)),n&&!i&&!e&&(d=h=undefined),f}var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(typeof a!="function")throw"Only able to debounce functions.";b=b<0?0:+b||0;var o;return c===!0?(o=!0,m=!1):n(c)&&(o=!!c.leading,l="maxWait"in c&&Math.max(+c.maxWait||0,b),m="trailing"in c?!!c.trailing:m),u.cancel=p,u}},{})}),require.whenReady("settings",function(){require.install("rpc_manager",function(require,a,b){var c=require("interface/rpc").rpc,d=require("interface/settings"),e=require("debounce").debounce,f=require("Class").Class.extend({__init__:function(){this._urlToBatchedUrl={},this._pendingRequests={},this._makeBatchRequests={},this._debounceWait=10,this._registerUrlToBatchedUrl(d.serverCallUrl,d.batchedServerCallUrl),this._registerUrlToBatchedUrl("/api/rerender_component_POST","/api/batched_rerender_component_POST")},_registerUrlToBatchedUrl:function(a,b){this._urlToBatchedUrl[a]=b,this._pendingRequests[a]=[],this._makeBatchRequests[a]=this._getBatchRequestFunction(a)},_shouldBatchRequest:function(a){return a._url()in this._urlToBatchedUrl},enqueue:function(a){if(!this._shouldBatchRequest(a))return a.send();this._pendingRequests[a._url()].push({request:a,data:this._getDataObject(a),success:this._getSuccessCallback(a),error:this._getErrorCallback(a)}),this._makeBatchRequests[a._url()]()},_getDataObject:function(a){var b=a._data();return delete b.formkey,delete b.window_id,delete b.referring_controller,delete b.referring_action,b},_getSuccessCallback:function(a){return d.pageIsMobile?function(b){b={success:!0,response:{value:b}},a.callback.call(a,b)}:function(b){a._success().call(a,{value:b})}},_getErrorCallback:function(a){return d.pageIsMobile?function(b){b=b||{success:!1,response:{}},a.callback.call(a,b)}:function(b){a._error().call(a,b)}},_getBatchRequestFunction:function(a){var b=this;return e(function(){var e=b._pendingRequests[a];b._pendingRequests[a]=[];if(e.length===1){e[0].request.send();return}var f=e.map(function(a){return a.data}),g=function(a){e.forEach(function(b){b.error(a)})},h=function(a){var b=d.pageIsMobile?a.value:a;e.forEach(function(a,c){a.success(b[c])})};c(b._urlToBatchedUrl[a]).kwargs({requestsData:f}).success(h).error(g).send()},b._debounceWait)}}),g=new f;a.enqueueRequest=function(a){g.enqueue(a)}},{"interface/rpc":!0,"interface/settings":!0,Class:!0,debounce:!0})}),require.whenReady("settings",function(){require.install("fastclick",function(require,a,b){function c(a){"use strict";var b,d=this;this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=10,this.layer=a;if(!a||!a.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return c.prototype.onClick.apply(d,arguments)},this.onMouse=function(){return c.prototype.onMouse.apply(d,arguments)},this.onTouchStart=function(){return c.prototype.onTouchStart.apply(d,arguments)},this.onTouchMove=function(){return c.prototype.onTouchMove.apply(d,arguments)},this.onTouchEnd=function(){return c.prototype.onTouchEnd.apply(d,arguments)},this.onTouchCancel=function(){return c.prototype.onTouchCancel.apply(d,arguments)};if(c.notNeeded(a))return;this.deviceIsAndroid&&(a.addEventListener("mouseover",this.onMouse,!0),a.addEventListener("mousedown",this.onMouse,!0),a.addEventListener("mouseup",this.onMouse,!0)),a.addEventListener("click",this.onClick,!0),a.addEventListener("touchstart",this.onTouchStart,!1),a.addEventListener("touchmove",this.onTouchMove,!1),a.addEventListener("touchend",this.onTouchEnd,!1),a.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(a.removeEventListener=function(b,c,d){var e=Node.prototype.removeEventListener;b==="click"?e.call(a,b,c.hijacked||c,d):e.call(a,b,c,d)},a.addEventListener=function(b,c,d){var e=Node.prototype.addEventListener;b==="click"?e.call(a,b,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(a,b,c,d)}),typeof a.onclick=="function"&&(b=a.onclick,a.addEventListener("click",function(a){b(a)},!1),a.onclick=null)}c.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,c.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),c.prototype.deviceIsIOS4=c.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),c.prototype.deviceIsIOSWithBadTarget=c.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),c.prototype.needsClick=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(this.deviceIsIOS&&a.type==="file"||a.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(a.className)},c.prototype.needsFocus=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},c.prototype.sendClick=function(a,b){"use strict";var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent(this.determineEventType(a),!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},c.prototype.determineEventType=function(a){return"use strict",this.deviceIsAndroid&&a.tagName.toLowerCase()==="select"?"mousedown":"click"},c.prototype.focus=function(a){"use strict";var b;this.deviceIsIOS&&a.setSelectionRange&&a.type.indexOf("date")!==0&&a.type!=="time"?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},c.prototype.updateScrollParent=function(a){"use strict";var b,c;b=a.fastClickScrollParent;if(!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},c.prototype.getTargetElementFromEventTarget=function(a){return"use strict",a.nodeType===Node.TEXT_NODE?a.parentNode:a},c.prototype.onTouchStart=function(a){"use strict";var b,c,d;if(a.targetTouches.length>1)return!0;b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0];if(this.deviceIsIOS){d=window.getSelection();if(d.rangeCount&&!d.isCollapsed)return!0;if(!this.deviceIsIOS4){if(c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<200&&a.preventDefault(),!0},c.prototype.touchHasMoved=function(a){"use strict";var b=a.changedTouches[0],c=this.touchBoundary;return Math.abs(b.pageX-this.touchStartX)>c||Math.abs(b.pageY-this.touchStartY)>c?!0:!1},c.prototype.onTouchMove=function(a){"use strict";if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(a.target)||this.touchHasMoved(a))this.trackingClick=!1,this.targetElement=null;return!0},c.prototype.findControl=function(a){return"use strict",a.control!==undefined?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},c.prototype.onTouchEnd=function(a){"use strict";var b,c,d,e,f,g=this.targetElement;if(!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;var h=a.timeStamp-this.trackingClickStart;if(h>100)return!1;this.cancelNextClick=!1,this.lastClickTime=a.timeStamp,c=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(f=a.changedTouches[0],g=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||g,g.fastClickScrollParent=this.targetElement.fastClickScrollParent),d=g.tagName.toLowerCase();if(d==="label"){b=this.findControl(g);if(b){this.focus(g);if(this.deviceIsAndroid)return!1;g=b}}else if(this.needsFocus(g)){if(a.timeStamp-c>100||this.deviceIsIOS&&window.top!==window&&d==="input")return this.targetElement=null,!1;this.focus(g);if(!this.deviceIsIOS4||d!=="select")this.targetElement=null,a.preventDefault();return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){e=g.fastClickScrollParent;if(e&&e.fastClickLastScrollTop!==e.scrollTop)return!0}return this.needsClick(g)||(a.preventDefault(),this.sendClick(g,a)),!1},c.prototype.onTouchCancel=function(){"use strict",this.trackingClick=!1,this.targetElement=null},c.prototype.onMouse=function(a){return"use strict",this.targetElement?a.forwardedTouchEvent?!0:a.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0
,a.stopPropagation(),a.preventDefault(),!1):!0:!0:!0},c.prototype.onClick=function(a){"use strict";var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):a.target.type==="submit"&&a.detail===0?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},c.prototype.destroy=function(){"use strict";var a=this.layer;this.deviceIsAndroid&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchmove",this.onTouchMove,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},c.notNeeded=function(a){"use strict";var b,d;if(typeof window.ontouchstart=="undefined")return!0;d=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(d){if(!c.prototype.deviceIsAndroid)return!0;b=document.querySelector("meta[name=viewport]");if(b){if(b.content.indexOf("user-scalable=no")!==-1)return!0;if(d>31&&window.innerWidth<=window.screen.width)return!0}}return a.style.msTouchAction==="none"?!0:!1},c.attach=function(a){return"use strict",new c(a)},typeof define!="undefined"&&define.amd?define(function(){return"use strict",c}):typeof b!="undefined"&&b.exports?(b.exports=c.attach,b.exports.FastClick=c):window.FastClick=c},{})}),require.whenReady("settings",function(){require.install("view/captcha",function(require,a,b){require("jquery");var c=require("w2.quora").Component,d=require("view/modal").Base,e;$(document).bind("w2rpcexception-captcha_required",function(a,b){b.rpc.__liveMutation&&require("w2.livenode").mutationDoneAfterVersion(b.rpc.__liveMutationInfo.transactionId,0),e.load_captcha()}),a.Captcha=c.extend({init:function(){this._super.apply(this,arguments),e=this},load_captcha:function(){var a=this;return a.modal("load_captcha_modal"),!1}}),a.CaptchaModal=d.extend({onLoad:function(){this._super.apply(this,arguments);var a=this,b=function(){a.serverCall("on_captcha_verified").liveMutate().success(function(){a._closeModal()}).send()},c=grecaptcha.render(a.$("#@captcha")[0],{sitekey:a.recaptcha_key,theme:"light",callback:b})}})},{jquery:!0,"w2.livenode":!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/reauth",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base,e,f;$(document).bind("w2rpcexception-reauth_required",function(a,b){b.rpc.__liveMutation&&require("w2.livenode").mutationDoneAfterVersion(b.rpc.__liveMutationInfo.transactionId,0),f=b.rpc,b.response.exception.args[1]===!0&&(f=f.liveMutate()),e.load_reauth()}),a.ReauthWrapper=c.extend({init:function(){this._super.apply(this,arguments),e=this},load_reauth:function(){return this.modal("load_reauth_modal"),!1}}),a.ReauthModal=d.extend({onSubmit:function(){var a=this,b=function(b){b.login_success?(a.previous_call.send(),a._closeModal()):a.$("#@password").val("")},c={password:this.$("#@password").val()};this.serverCall("verify").kwargs(c).success(b).send()},onLoad:function(){this._super.apply(this,arguments),this.previous_call=f;var a=this;this.$("#@password").focus(),this.$("#@password").keypress(function(b){b.keyCode==13&&a.$("#@submit_button").click()}),this.$("#@forgot_password_link").on("click",function(){a.serverCall("send_reset_password_email").send()})}})},{"w2.livenode":!0,"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("unified_view/insertion_query",function(require,a,b){a.insertionQ=function(){function j(b,e){var f,g="insQ_"+a++,i=function(a){if(a.animationName===g||a[c]===g)l(a.target)||e(a.target)};f=document.createElement("style"),f.innerHTML="@"+d+"keyframes "+g+" {  from {  outline: 1px solid transparent  } to {  outline: 0px solid transparent }  }"+"\n"+b+" { animation-duration: 0.001s; animation-name: "+g+"; "+d+"animation-duration: 0.001s; "+d+"animation-name: "+g+"; "+" } ",document.head.appendChild(f);var j=setTimeout(function(){document.addEventListener("animationstart",i,!1),document.addEventListener("MSAnimationStart",i,!1),document.addEventListener("webkitAnimationStart",i,!1)},h.timeout);return{destroy:function(){clearTimeout(j),f&&(document.head.removeChild(f),f=null),document.removeEventListener("animationstart",i),document.removeEventListener("MSAnimationStart",i),document.removeEventListener("webkitAnimationStart",i)}}}function k(a){a.QinsQ=!0}function l(a){return h.strictlyNew&&a.QinsQ===!0}function m(a){return l(a.parentNode)?a:m(a.parentNode)}function n(a){k(a),a=a.firstChild;for(;a;a=a.nextSibling)a!==undefined&&a.nodeType===1&&n(a)}function o(a,b){var c=[],d=function(){var a;return function(){clearTimeout(a),a=setTimeout(function(){c.forEach(n),b(c),c=[]},10)}}();return j(a,function(a){if(l(a))return;k(a);var b=m(a);c.indexOf(b)<0&&c.push(b),d()})}"use strict";var a=100,b=!1,c="animationName",d="",e="Webkit Moz O ms Khtml".split(" "),f="",g=document.createElement("div"),h={strictlyNew:!0,timeout:20};g.style.animationName&&(b=!0);if(b===!1)for(var i=0;i<e.length;i++)if(g.style[e[i]+"AnimationName"]!==undefined){f=e[i],c=f+"AnimationName",d="-"+f.toLowerCase()+"-",b=!0;break}var p=function(a){return b&&a.match(/[^{}]/)?(h.strictlyNew&&n(document.body),{every:function(b){return j(a,b)},summary:function(b){return o(a,b)}}):!1};return p.config=function(a){for(var b in a)a.hasOwnProperty(b)&&(h[b]=a[b])},p}()},{})}),require.whenReady("settings",function(){require.install("unified_view/lazy_load_images",function(require,a,b){function e(a){a.getAttribute("data-src")&&(a.setAttribute("src",a.getAttribute("data-src")),a.removeAttribute("data-src"))}function f(){var a=document.querySelectorAll("img[data-src]");for(var b=0;b<a.length;b++)e(a[b])}var c=require("unified_view/insertion_query"),d=2e3;a.loadDeferredImages=function(){f(),c.insertionQ("img").every(function(a){e(a)}),setInterval(f,d)}},{"unified_view/insertion_query":!0})}),require.whenReady("settings",function(){require.install("lazy_load_images",function(require,a,b){function e(){c.lazyLoadImages&&$(window).load(function(){d.loadDeferredImages()})}var c=require("settings"),d=require("unified_view/lazy_load_images");e()},{"unified_view/lazy_load_images":!0,settings:!0})}),require.whenReady("settings",function(){require.install("view/selector",function(require,a,b){var c=require("w2.quora").Component,d=require("spin"),e=require("simscroll");a.Selector=c.extend({onLoad:function(){function b(b){if(b.type==="keydown"){var c=a.child("results");if(c){var d=c.getSelectedResult();d===null&&a.allowNoSelection?a.submit():d&&a.resultWasSelected(d)}else a.submit()}}function c(){a.showResults(!1),a.$input.blur()}function d(b,c){b.preventDefault();if(b.type==="keydown"){var d=a.child("results");d&&d.moveSelection(c)}}function f(f){if(a.shouldSimScroll){if(!a.query&&e.maybeSimulateScroll(f))return!1;if(!a.query&&f.which==39){a.$input.blur();return}}switch(f.which){case 13:b(f);break;case 27:c();break;case 38:d(f,-1);break;case 40:d(f,1);break;default:var g=a.$input.val();g!==a.query&&a._setQuery(g)}}var a=this;a._busy=!1,a.$input=a.$("#@input"),a.$results=a.$("#@results"),a.$spinner=a.$("#@spinner"),a.busySpinnerConfig={length:3,width:1,radius:3},a.shouldSimScroll=!1,a.shouldShowLengthCounter=!1,a.query=a.$input.val(),a.$input.change(f).keydown(f).keyup(f).focus(a.fnbind(a.inputFocusHandler)).blur(a.fnbind(a.inputBlurHandler))},showLengthCounter:function(a){this.length_limit&&(this.shouldShowLengthCounter?a?this.$("#@counter_wrapper").removeClass("hidden"):this.$("#@counter_wrapper").addClass("hidden"):this.$("#@counter_wrapper").addClass("hidden"))},inputFocusHandler:function(){this.length_limit&&this.lookup("counter").show()},inputBlurHandler:function(){this.length_limit&&this.lookup("counter").hide()},setQuery:function(a){var b=this.$input[0].selectionStart,c=this.$input[0].selectionEnd;this.$input.val(a),this.$input[0].setSelectionRange(b,c),this._setQuery(a)},queryDidChange:function(){},resultsDidChange:function(){},resultWasSelected:function(a,b){},submit:function(){},showResults:function(a){a?this.$results.removeClass("hidden"):this.$results.addClass("hidden")},getExtraKwargs:function(){return{}},updateResults:function(){var a=this;if(a.query.trim().length===0)a.showResults(!1);else if(!a._busy){var b={query:a.query},c=a.getExtraKwargs();for(var d in c)b[d]=c[d];a.setBusy(!0),a.serverCall("results_content_for").contentFor(a.$results,{parentCID:a.cid}).kwargs(b).success(a.fnbind(a.resultsServerCallHandler)).except(a.fnbind(a.resultsServerCallHandler)).error(a.fnbind(a.resultsServerCallHandler)).send()}},resultsServerCallHandler:function(){this.setBusy(!1),this.showResults(!0),this.child("results").query!==this.$input.val()&&this.updateResults()},isBusy:function(){return this._busy},setBusy:function(a){function c(){return!b._busy&&b._spinner}var b=this;b._busy=a,b._busy&&!b._spinner?(b._spinner=d.createSpinnerElement(this.busySpinnerConfig),b.$spinner.append(b._spinner.el)):c()&&setTimeout(function(){c()&&(b._spinner.stop(),b._spinner=null)},100)},_setQuery:function(a){this.query=a,this.length_limit&&this.lookup("counter").updateCounter(a.length),this.queryDidChange(),this.updateResults()}}),a.SelectorResults=c.extend({onLoad:function(){var a=this;a.allowNoSelection?a.setSelection(-1):a.setSelection(0),a.$(".@result").hover(function(b){var c=a.getIndexFromResultElementID(this.id);a.setSelection(c)}).mousedown(function(a){a.preventDefault()}).click(function(b){var c=b.metaKey||b.ctrlKey,d=a.getIndexFromResultElementID(this.id),e=a.results[d];a.parent().resultWasSelected(e,c)}),a.allowNoSelection&&a.$("#@wrapper").mouseleave(function(b){a.setSelection(-1)}),a.parent().resultsDidChange()},getSelectedResult:function(){return this.selectedIndex===-1?null:!this.numResults&&this.allowNoSelection?null:this.results[this.selectedIndex]},setSelection:function(a){if(!this.numResults)return;if(!isNaN(parseInt(a))){this.selectedIndex!==-1&&!isNaN(parseInt(this.selectedIndex))&&this.$("#@result_"+this.selectedIndex).removeClass("selector_highlighted");if(this.allowNoSelection&&a<-1||!this.allowNoSelection&&a<0)a=this.numResults-1;a>this.numResults-1&&(a=this.allowNoSelection?-1:0);if(a===-1)this.selectedIndex=a;else{var b=this.$("#@result_"+a);b&&(b.addClass("selector_highlighted"),this.selectedIndex=a)}}},moveSelection:function(a){var b=this.selectedIndex+a;this.setSelection(b)},getIndexFromResultElementID:function(a){var b=a.split("_");return parseInt(b[b.length-1])}}),a.ServerCallSelector=a.Selector.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.$serverMessage=a.$("#@server_message"),a.pendingServerCallRequest=null,a.serverCallBusy=!1,a.hideResultsOnServerCall=!0},queryDidChange:function(){this._super.apply(this,arguments),this.showServerMessage(!1)},makeServerCall:function(a){this.pendingServerCallRequest=a,this.isBusy()||this.doServerCall()},hasPendingServerCall:function(){return this.pendingServerCallRequest!==null||this.serverCallBusy},resultsServerCallHandler:function(){var a=this;a.pendingServerCallRequest!==null?a.doServerCall():(a._super.apply(a,arguments),a.showServerMessage(!1))},doServerCall:function(){var a=this;a.setBusy(!0),a.serverCallBusy=!0,a.hideResultsOnServerCall&&a.showResults(!1),a.showServerMessage(!1),a.pendingServerCallRequest.contentFor(a.$serverMessage,{parentCID:a.cid}).success(a.fnbind(function(){a.serverCallHandler(!0)})).except(a.fnbind(function(b){a.serverCallHandler(!1,b)})).error(a.fnbind(function(){a.serverCallHandler(!1)})).send(),a.pendingServerCallRequest=null},serverCallHandler:function(a,b){this.serverCallBusy=!1,this.setBusy(!1),a&&(this.hideResultsOnServerCall&&this.showResults(!1),this.showServerMessage(!0))},showServerMessage:function(a){a?this.$serverMessage.removeClass("hidden"):this.$serverMessage.addClass("hidden")}})},{simscroll:!0,spin:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/question_selector",function(require,a,b){var c=require("view/selector").ServerCallSelector;a.RedirectQuestionESSelector=c.extend({onLoad:function(a){var b=this;b._super.apply(b,arguments)},resultWasSelected:function(a){var b=this;b.setQuery(""),b.parent().$("#@to_qid").val(a.data.qid),b.serverCall("question_redirect_preview").kwargs({to_qid:a.data.qid}).contentFor(b.parent().$("#@question_redirect_preview"),{parentCID:b.cid}).send(),b.$("#@input").blur()}})},{"view/selector":!0})}),require.whenReady("settings",function(){require.install("app/view/home",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("view/toggle"),f=require("window_manager");a.HomeMain=c.extend({onLoad:function(){var a=this.$("#@left_col_inner"),b=this.$("#@left_col");b.length>0&&a.length>0&&d.makeFixable(a,{min_height:b.outerHeight()+b.offset().top,min_width:990})},removeQpUrlParam:function(a){var b=f.getURL(),c=b.indexOf("?qp_story=");c!=-1&&(f.replaceURL(b.substring(0,c)),this.lookup(a).$("#@topic_feed").removeClass("invisible"))}}),a.ContentPageFeed=e.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments),setTimeout(this.fnbind(this.recordImpression),0),this.$(".feed_item_wrapper").hide(),this.$(".feed_item_wrapper").fadeIn(500)},show:function(){this.$("#@wrapper").show()},recordImpression:function(){this.$("#@wrapper").is(":in-viewport")?this.serverCall("record_impression").send():setTimeout(this.fnbind(this.recordImpression),200)}}),a.HomePageTopicFeedsPopover=c.extend({hide:function(){this.$("#@popover").addClass("hidden")}}),a.DismissHomePageTopicFeedsPopoverLink=c.extend({onLoad:function(){var a=this;this.$("#@dismiss_link").on("click",function(){a.parent().hide(),a.serverCall("dismiss_popover").send()})}})},{"view/fixable2":!0,"view/toggle":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("interface/component",function(require,a,b){var c=require("interface/settings"),d=require("interface/helpers").wrap,e=require,f=require("interface/jquery").jQuery,g=require("interface/jquery")._jQuery,h=require("interface/rpc").ServerCall,i,j=["cid","_my","whenOnLoaded","onLoad","onUnload","parent","children","child","getDvar","lookup","onKeyCombination","uninstallKeyComboHandlers","cQuery","contextConstructor","__vcon","__js_init","state","stateHandlers"];c.pageIsMobile?(i=e("mobile_app2/server_call").MobileComponent,Array.prototype.push.apply(j,["registerNewBroadcastDependencies","rerender","_onUnloaded"])):i=e("w2.quora").Component,a.Component=require("Class").Class.extend({__init__:function(a,b,c,e,f){var g=new i(a,b,c,e,f);return g.init.call(this,c),d(this,g,j)},$id:function(a){if(a[0]!="@")throw new Error("Expect id to begin with @. Got: "+a);return a=a.replace("@",this._my()),f("#"+a)},unsafe$id:function(a){if(a[0]!="@")throw new Error("Expect id to begin with @. Got: "+a);return a=a.replace("@",this._my()),g("#"+a)},serverCall:function(a){if(this.__vcon){if(this.__vcon.length===1)return new h(this.__vcon,a,this);switch(this.__vcon[0]){case"cls":return new h(this.__vcon,a,this);case"live":return new h(this.__vcon.slice(2),a,this);case"hmac":return new h(this.__vcon,a,this)}}}})},{"interface/rpc":!0,"interface/settings":!0,"interface/jquery":!0,Class:!0,"interface/helpers":!0})}),require.whenReady("settings",function(){require.install("unified_view/toggle",function(require,a,b){var c=require("interface/component").Component,d=require("assert").ok,e=require,f=require("debounce").debounce,g=require("interface/settings").pageIsMobile,h;if(g){var i=e("mobile_app2/util");h=i.isElementInViewport}else h=function(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&b.right<=(window.innerWidth||document.documentElement.clientWidth)};a.ToggleBase=c.extend({__init__:function(){this._super.apply(this,arguments),this._init_toggle()},_init_toggle:function(){this.fetchCalled=!1,this.fetchCompleted=!1,this.switchCompleted=!1,this.switchPending=!1,this.$fetchInto=this.$id(this.fetch_into),this.$switchShow=this.optional$id(this.switch_show),this.$switchHide=this.optional$id(this.switch_hide),this.$loadingShow=this.optional$id(this.loading_show),this.$loadingHide=this.optional$id(this.loading_hide),this.$fetchOnElem=this.fetch_on.length>1?this.$id(this.fetch_on[1]):this.$switchHide,this.$switchOnElem=this.switch_on.length>1?this.$id(this.switch_on[1]):this.$switchHide,this.bindFetch(),this.handleSwitch(),this.bindKeys(),d(this.fetchCompleted||this.$fetchInto,"$fetchInto undefined but fetch is not completed.")},optional$id:function(a){return a?this.$id(a):null},bindFetch:function(){switch(this.fetch_on[0]){case"request":this.fetchCalled=!0,this.fetchCompleted=!0;break;case"load":this.fetch();break;case"view":case"hover":case"click":var a=this.fetch_on[0];d(this.$fetchOnElem,"$fetchOnElem undefined for view/hover/click triggers."),a=="hover"?this.bindHover(this.$fetchOnElem,this.fetch.bind(this)):a=="view"?this.bindInViewPort(this.$fetchOnElem,this.fetch.bind(this)):this.bindClick(this.$fetchOnElem,this.fetch.bind(this));break;default:throw new Error("Invalid fetch trigger specified "+this.fetch_on)}},bindKeys:function(){if(!this.key_combination)return;this.onKeyCombination(this.$fetchOnElem.get(0),"Enter",this.triggerSwitch.bind(this))},handleSwitch:function(){switch(this.switch_on[0]){case"request":this.fetchCalled=!0,this.fetchCompleted=!0,this.switchCompleted=!0;break;case"load":this.triggerSwitch();break;case"view":case"hover":case"click":var a=this.switch_on[0];d(this.$switchOnElem,"$switchOnElem undefined for hover/click triggers."),a=="hover"?this.bindHover(this.$switchOnElem,this.triggerSwitch.bind(this)):a=="view"?this.bindInViewPort(this.$switchOnElem,this.triggerSwitch.bind(this)):this.bindClick(this.$switchOnElem,this.triggerSwitch.bind(this));break;default:throw new Error("Invalid show trigger specified "+this.switch_on)}},fetch:function(){if(this.fetchCalled)return;this.fetchCalled=!0,this.serverCall("fetch_toggled_component").kwargs({serialized_args:this.serialized_args}).contentFor(this.$fetchInto.get(0),{parentCID:this.cid}).success(this.onFetched.bind(this)).send({batched:!0})},onFetched:function(){this.fetchCompleted=!0,this.switchPending&&(this.switchPending=!1,this.triggerSwitch())},enterLoadingState:function(){this.$loadingShow&&this.$loadingShow.removeClass("hidden"),this.$loadingHide&&this.$loadingHide.addClass("hidden")},exitLoadingState:function(){this.$loadingShow&&this.$loadingShow.addClass("hidden")},actualSwitch:function(){if(!this.two_way_switch&&this.switchCompleted)return;this.switchCompleted=!0,this.$switchShow&&this.$switchShow.toggleClass("hidden"),this.$switchHide&&this.$switchHide.toggleClass("hidden")},triggerSwitch:function(){this.fetch(),this.fetchCompleted?(this.exitLoadingState(),this.actualSwitch()):(this.switchPending=!0,this.enterLoadingState())},bindClick:function(a,b){a.on("click",function(a){a.preventDefault(),b()})},bindHover:function(a,b){g?this.bindInViewPort(a,b):a.on("hover",b)},bindInViewPort:function(a,b){if(h(a.get(0)))b();else{var c={leading:!0},d=f(function(){h(a.get(0))&&(b(),window.removeEventListener("scroll",d))},50,c);window.addEventListener("scroll",d)}}})},{assert:!0,debounce:!0,"interface/component":!0,"interface/settings":!0})}),require.whenReady("settings",function(){require.install("interface/cookies",function(require,a,b){var c=require("interface/settings"),d=require("interface/helpers").wrap,e=require,f,g,h=["setQfeedLog","setTlog"];c.pageIsMobile?(f=e("mobile_app2/cookies"),g=function(a,b,c){return b===null?b="":b=""+b,f.setCookie(a,b,c)}):(f=e("cookies"),g=function(a,b,c){return f.cookie(a,b,c)}),d(a,f,h),a.setCookie=g},{"interface/settings":!0,"interface/helpers":!0})}),require.whenReady("settings",function(){require.install("unified_view/qtext",function(require,a,b){var c=require("interface/settings"),d=require,e=require("unified_view/toggle"),f=require("interface/cookies"),g=require("interface/jquery")._jQuery,h=require("w2.context");if(c.pageIsMobile)var i=d("mobile_app2/action_log");else var i=d("action_log");var j=a.ExpandableContext=h.Context.extend({initialProperties:function(){return{loading:!1,forceSwitch:!0}}});a.Expandable=e.ToggleBase.extend({contextConstructor:function(){return j},onLoad:function(){this.expandableContext=this.getContext(j),this.expandableContext.on("forceSwitch",this.triggerSwitch.bind(this))},enterLoadingState:function(){this.expandableContext.set("loading",!0)},actualSwitch:function(){if(!this.switchCompleted){this.obj_type&&f.setQfeedLog(this,this.obj_type+"Expand"),i.logSecondaryAction("ContentExpand",null);if(!c.pageIsMobile&&window.YT&&window.YT.players){var a=d("ytplayer"),b=g(this.$switchHide.get(0)),e=g(this.$switchShow.get(0)),h=a.getYTPlayerStatuses(b,function(a){g(a).parent().addClass("thumbnail").empty()});a.restoreYTPlayerStatuses(e,h)}}this._super()}})},{"interface/cookies":!0,"interface/settings":!0,"unified_view/toggle":!0,"interface/jquery":!0,"w2.context":!0})}),require.whenReady("settings",function(){require.install("views",function(require,a,b){var c=require("webnode2"),d=require("event"),e=d.add,f=require("log").log,g=require("Class").Class.extend({__init__:function(){this.trackedKey={},this.trackedComponents=[],this.lastCheckTime=0,this.rateLimitMs=400,e(document,"scroll",this.fnbind(this.logViews))},addComponentToTrack:function(a){var b=a.view_tracking_key;b||f&&f.enabled&&f("views",'"view_tracking_key" not found for the component.This should be specified in js_init');if(this.trackedKey[b])return;this.trackedKey[b]=!0,this.trackedComponents.push(a)},logViews:function(){var a=+(new Date),b=[],d,e,f,g,h;if(a<this.lastCheckTime+this.rateLimitMs)return;for(d=0;d<this.trackedComponents.length;d++){e=this.trackedComponents[d];if(!e)continue;f=e.getJQueryObject(),g=f.is(":visible")&&f.is(":in-viewport");if(!g)continue;b.push(e.view_tracking_key),this.trackedComponents[d]=undefined}h={keys:b},b.length&&c.rpc("/ajax/log_views_POST").kwargs({messages:h}).send(),this.trackedComponents=this.trackedComponents.filter(function(a){return a!==undefined})}});a.viewsLogger=new g},{webnode2:!0,Class:!0,event:!0,log:!0})}),require.whenReady("settings",function(){require.install("app/view/feed",function(require,a,b){var c=require("webnode2"),d=require("event"),e=require("w2.quora").Component,f=d.add,g=d.remove,h=require("view/fixable2"),i=require("window_manager"),j=require("settings"),k=require("cookies"),l=require("log").log,m=require("views").viewsLogger,n=require("w2.context");a.UniversalPageFeed=require("view/paged_list").PagedList.extend({init:function(a){this._super.apply(this,arguments),this.pageLoadTime=+(new Date),this.viewerUid=a.uid,this.hashPosition={},this.initiallyVisible={},this.firstQueryID=0,this.offset=0,this.firstElement=0,this.needsRefresh=!1,this.num_prefeed_stories=a.num_prefeed_stories,this.hashImpressions={},this.lastCheckTime=0,this.lastRevealTime=0,this.visibleStorySelectors=[],this.impressionData=[],this.dontLogImpressions=a.dont_log_imp,this.maxImpPos=-1,this.hashReadingTime={},this.loggedReadingTime={},this.hashPreviousVisibleTime={},this.lastVisibilityUpdate=0,this.shouldLogReadingTime=require("gating").enable_reading_time_logging,this.nextThreshold={},this.readingTimeUpdates=[],this.usePersistentFeed=a.use_persistent_feed,this.pfInitialMoreStoriesPos=a.pf_initial_morestories_pos,this.moreStoriesShown=!1,this.pfPrefetchStarted=!1,this.numConsecutivePreloadFails=0,this.bannerShown=!1,this.setDvar("feed_story_hash",null),this.setDvar("feed_story_position",null),this.setDvar("feed_story_inner_position",null),this.setDvar("feed_story_initial",null),this.setDvar("feed_ty",a.feed_ty),this.setDvar("feed_page",a.feed_page),this.setDvar("page_data",a.page_data),this.setDvar("focus_ty",a.focus_ty)},onLoad:function(a){l("feed.UniversalPageFeed.onLoad","start"),this._super.apply(this,arguments);var b=this;if(this.debug)return;this.recordImpressions(!0),setInterval(this.fnbind(this.recordImpressions,!1),b.rate_limiter_ms+500),this.shouldLogReadingTime&&(this.updateVisibility(!0),setInterval(this.fnbind(this.updateVisibility,!1),this.reading_time_rate));var c=this.fnbind(this.recordImpressions,!1,!1);this._mousemove_handler=f(document,"mousemove",c),this._keypress_handler=f(document,"keypress",c),this._scroll_handler=f(document,"scroll",c),this.usePersistentFeed&&(this._pfPrefetchScrollHandler=f(document,"scroll",function(){b.pfPrefetchStarted||(b.pfPrefetchStarted=!0,setInterval(b.fnbind(b.prefetchPersistentFeed),2500))}));var d=this.child("more_stories");d.$("#@more_stories").click(function(){var a=+(new Date);a-b.pageLoadTime>=9e6?location.reload():b.revealPreloadedPersistentFeed(!0,!0),b.hideMoreStoriesButton()}),$(document).bind("bannerShown",function(){b.bannerShown=!0,b.hideMoreStoriesButton()}),$(document).bind("bannerHidden",function(){b.bannerShown=!1})},onFeedBottomIndicatorClicked:function(){this.hasHiddenPrefetchedStories()?this.revealPreloadedPersistentFeed(!0,!0):location.reload()},onUnload:function(){g(document,"mousemove",this._mousemove_handler),g(document,"keypress",this._keypress_handler),g(document,"scroll",this._scroll_handler),g(document,"scroll",this._pfPrefetchScrollHandler)},getPrefetchedItems:function(){return $(".UniversalPageFeed").find(".preloaded_pf")},hasHiddenPrefetchedStories:function(){return this.getPrefetchedItems().length>0},prefetchPersistentFeed:function(){var a=this;if(!this.usePersistentFeed)return;if(this.currently_fetching||this.waiting_for_updates||this.waiting_for_updates_from_preload){l("feed.UniversalPageFeed.prefetchPersistentFeed","end early","    currently_fetching:",this.currently_fetching,"    waiting_for_updates:",this.waiting_for_updates,"    waiting_for_updates_from_preload:",this.waiting_for_updates_from_preload);return}if(this.hasHiddenPrefetchedStories()){l("feed.UniversalPageFeed.prefetchPersistentFeed","already prefetched");return}if(this.numConsecutivePreloadFails>2){l("feed.UniveresalPageFEed.prefetchPersistentFeed","rate limit due to consecutive fails");return}l("feed.UniversalPageFeed.prefetchPersistentFeed","start"),a.waiting_for_updates_from_preload=!0,this.serverCall("prefetch_stories").kwargs({cid:this.cid,current:this.model_count}).success(function(b){b?(l("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return success",a.waiting_for_updates_from_preload),a.numConsecutivePreloadFails=0):(a.waiting_for_updates_from_preload=!1,a.numConsecutivePreloadFails+=1,l("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return empty. number of consecutive failures:",a.numConsecutivePreloadFails))}).error(function(){a.waiting_for_updates_from_preload=!1,a.numConsecutivePreloadFails+=1,l("feed.UniversalPageFeed.prefetchPersistentFeed","prefetch return error. number of consecutive failures:",a.numConsecutivePreloadFails)}).send(),l("feed.UniversalPageFeed.prefetchPersistentFeed","fetched")},revealStories:function(){setTimeout(function(){$(".reveal_story").removeClass("reveal_story")},1500)},revealPreloadedPersistentFeed:function(a,b){var d=this;if(!this.usePersistentFeed)return;l("feed.UniversalPageFeed.revealPreloadedPersistentFeed","start");if(!this.hasHiddenPrefetchedStories()){l("feed.UniversalPageFeed.revealPreloadedPersistentFeed","no stories to reveal");return}if(a){var e=+(new Date);this.lastRevealTime=e}var f=this.children(),g=0,h=!1;for(var i=0;i<f.length;i++){var j=f[i],k=j.$("#@item");k.hasClass("preloaded_pf")?(k.removeClass("preloaded_pf"),k.removeClass("hidden"),a&&b&&(k.addClass("reveal_story"),this.revealStories()),++g,h||(this.firstElement=j.getHash(),h=!0)):k.hasClass("hidden_timestamp")&&(k.removeClass("hidden_timestamp"),k.removeClass("hidden"))}l("feed.UniversalPageFeed.revealPreloadedPersistentFeed",g,"stories revealed"),this.hideMoreStoriesButton();if(a){var m=d.$(".SiteHeader").height(),n=c.getLiveDomElement(d.cid).offsetTop,o=20,p=Math.max(n*2,window.innerHeight*2);window.scrollTo(0,p),$("html, body").animate({scrollTop:n-m-o},700)}l("feed.UniversalPageFeed.revealPreloadedPersistentFeed","server call"),this.serverCall("reveal_stories").send(),l("feed.UniversalPageFeed.revealPreloadedPersistentFeed","end")},showMoreStoriesButton:function(){if(!this.usePersistentFeed||!this.hasHiddenPrefetchedStories()||this.bannerShown)return;l("feed.UniversalPageFeed.showMoreStoriesButton","show more stories button");var a=this.child("more_stories"),b=a.$("#@more_stories");b.removeClass("hidden"),this.moreStoriesShown=!0},hideMoreStoriesButton:function(){if(!this.usePersistentFeed)return;l("feed.UniversalPageFeed.hideMoreStoriesButton","hide more stories button");var a=this.child("more_stories"),b=a.$("#@more_stories");b.addClass("hidden")},bottomIndicatorIsVisible:function(){var a=$(".FeedBottomIndicator");return a&&a.is(":in-viewport")},updatePositions:function(a){var b=this.children(),d=!1,e,f,g,h;if(!a){h=this.offset;for(e=0;e<b.length;e++){g=b[e];if(!g.getDvar)continue;if(g.getDvar("feed_story_hash")==this.firstElement){var i=this.orderedVisibleChildren();for(f=0;f<i.length;f++)i[f]==c.getLiveDomId(g.cid)&&(this.offset=f)}}this.offset!=h&&(d=!0)}var j=this.orderedVisibleChildren(),k,l;this.firstQueryID=0;for(f=0;f<j.length;f++){k=document.getElementById(j[f]),g=c.getComponentFromElement(k),l=g.$("#@item"),this.firstQueryID<=0&&!l.hasClass("preloaded_pf")&&(this.firstQueryID=g.query_id);var m=f-this.offset+this.num_prefeed_stories,n=g.getHash();this.hashPosition[n]=m}if(a)for(f=0;f<b.length;f++)c.getLiveDomId(b[f].cid)==j[0]&&(this.firstElement=b[f].getDvar("feed_story_hash"));return d},addReadingTimeEntry:function(a){this.readingTimeUpdates.push({hash:a,position:this.hashPosition[a],initially_visible:this.initiallyVisible.hasOwnProperty(a),reading_time:this.hashReadingTime[a]}),this.loggedReadingTime[a]=this.hashReadingTime[a]},updateVisibility:function(a){var b=this,c=+(new Date);if(!document.hasFocus()||this.dontLogImpressions){this.lastVisibilityUpdate=c;return}var d=this.children(),e,f,g;for(g=0;g<d.length;g++){e=d[g];if(!e.getHash||!e.validForLoggingImpression(!1))continue;f=e.getHash(),e.isVisible()?(this.hashPreviousVisibleTime[f]===this.lastVisibilityUpdate&&this.lastVisibilityUpdate>c-2*this.reading_time_rate&&(this.hashReadingTime[f]=(this.hashReadingTime[f]||0)+(c-this.lastVisibilityUpdate)),this.hashPreviousVisibleTime[f]=c):this.hashReadingTime[f]&&this.hashReadingTime[f]>this.loggedReadingTime[f]&&this.addReadingTimeEntry(f)}var h;for(f in this.hashReadingTime)h=this.nextThreshold[f]||0,this.hashPosition.hasOwnProperty(f)&&this.reading_time_thresholds[h]&&this.hashReadingTime[f]>=this.reading_time_thresholds[h]&&(this.addReadingTimeEntry(f),this.nextThreshold[f]=h+1);if(this.readingTimeUpdates.length>0&&this.viewerUid&&c-this.pageLoadTime>=this.wait_until_log_impression_ms){var i=this.readingTimeUpdates,j=this.serverCall("log_reading_times");j.kwargs({data:i}),j.error(function(){for(var a in i){var c=i[a].hash;i[a].reading_time===b.loggedReadingTime[c]&&b.nextThreshold[c]--}}),l("feed.UniversalPageFeed.updateVisibility","server call"),j.send(),l("feed.UniversalPageFeed.updateVisibility","server call sent"),this.readingTimeUpdates=[]}l("feed.UniversalPageFeed.updateVisibility","end"),this.lastVisibilityUpdate=c},addImpression:function(a,b){var d=a.getHash();this.hashImpressions[d]=!0,this.impressionData.push({hash:d,initially_visible:this.initiallyVisible.hasOwnProperty(d),position:b});if(require("gating").feed_impression_feedback){var e=c._domids[a.cid],f=$(document.getElementById(e));this.visibleStorySelectors.push(f)}},recordImpressions:function(a){var b=this;if(this.debug)return;var d=+(new Date),e=a||this.needsRefresh;this.needsRefresh=!1;if(!e&&d<this.lastCheckTime+this.rate_limiter_ms||d<this.lastRevealTime+3e3)return;this.lastCheckTime=d,l("feed.UniversalPageFeed.recordImpressions","started, called with",a);var f=this.children(),g,h;e=this.updatePositions(a)||e;var i=!1;for(h=0;h<f.length;h++){g=f[h];if(!g.getHash||!g.validForLoggingImpression(e))continue;var j=g.isVisible(),k=g.getHash(),m=this.hashPosition[k];l("feed.UniversalPageFeed.recordImpressions","    firstQueryID:",this.firstQueryID,"    comp.query_id:",g.query_id,"    domid:",c._domids[g.cid],"    inViewport:",j,"    position:",m,"    hash:",k),this.usePersistentFeed&&j&&(this.maxImpPos=Math.max(this.maxImpPos,m),g.query_id!=this.firstQueryID&&g.query_id>0?(l("feed.UniversalPageFeed.recordImpressions","diff",g.query_id,this.firstQueryID),i=!0):!this.moreStoriesShown&&this.pfInitialMoreStoriesPos>=0&&m>=this.pfInitialMoreStoriesPos&&(l("feed.UniversalPageFeed.recordImpressions","initial morestories button shown: pos"
,m),i=!0));if(this.hashImpressions[k]||!e&&!j)continue;l("feed.UniversalPageFeed.recordImpressions","check to see if should reset dvars/record impression"),e&&(g.setDvar("feed_story_position",m),g.setDvar("feed_story_initial",!0)),j&&(l("feed.UniversalPageFeed.recordImpressions","impression recorded"),a&&(b.initiallyVisible[g.getHash()]=!0),this.addImpression(g,m))}(i||this.bottomIndicatorIsVisible())&&this.hasHiddenPrefetchedStories()&&this.showMoreStoriesButton();if(this.impressionData.length>0&&this.viewerUid&&d-this.pageLoadTime>=this.wait_until_log_impression_ms){var n=this.serverCall("log_impressions"),o=this.impressionData;n.kwargs({data:o}),n.error(function(){for(var a in o){var c=!0;for(var d in b.impressionData)if(b.impressionData[d].hash==o[a].hash){c=!1;break}c&&b.impressionData.push(o[a])}}),this.dontLogImpressions||(l("feed.UniversalPageFeed.recordImpressions","server call"),n.send(),l("feed.UniversalPageFeed.recordImpressions","server call sent"));for(var p=0;p<this.visibleStorySelectors.length;p++)this.visibleStorySelectors[p].addClass("seen");this.visibleStorySelectors=[],this.impressionData=[]}l("feed.UniversalPageFeed.recordImpressions","end")}}),a.FeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments);var a=i.getURL();if(a.indexOf("?qp_story=")!=-1||a.indexOf("?digest_story=")!=-1)i.replaceURL("/"),this.lookup("home_feed").$("#feed_visibility_wrapper").removeClass("invisible")}}),a.PinnedFeedMain=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments),this.removeQpUrlParam("pinned_feed")}}),a.TopicMainFeed=require("app/view/home").HomeMain.extend({onLoad:function(){this._super.apply(this,arguments),this.removeQpUrlParam("topic_feed")}}),a.FeedMuteItem=e.extend({onLoad:function(){this.$("#@mute_item").tooltip({contents:this.tooltip_text}).click(this.fnbind(function(){this.lookup("item").showMuteControls()}))}}),a.FeedMuteItemOverlay=e.extend({onLoad:function(){this.feed_item=this.cQuery(":item").$("#@feed_item"),this.cancel=this.$("#@cancel_mute_item_wrapper"),this.overlay=this.$("#@mute_item_overlay")},hide:function(){var a=this;a.overlay.removeClass("is_shown"),setTimeout(function(){a.overlay.hide()},333)},show:function(){var a=this;a.overlay.css({width:a.feed_item.outerWidth(),height:a.feed_item.outerHeight()}),a.overlay.show(),setTimeout(function(){a.overlay.addClass("is_shown")},1)}}),a.FeedMuteItemControls=e.extend({onLoad:function(){this.item=this.cQuery(":item").$("#@item"),this.controls=this.$("#@mute_item_controls"),this.shown=!1},hide:function(){var a=this;a.controls.removeClass("is_shown"),setTimeout(function(){a.controls.hide()},333),this.shown=!1},show:function(){var a=this;a.controls.show(),a._centerPage(),setTimeout(function(){a.controls.addClass("is_shown")},1),this.shown=!0},_centerPage:function(){var a=this.controls.offset().top,b=a-$(window).height()/2;$("html, body").animate({scrollTop:b},1e3)}}),a.FeedMuteButton=e.extend({onLoad:function(){var a=this.lookup("mute_item_controls").lookup("item");this.item=a.$("#@item"),this.feed_item=a.$("#@feed_item"),this.mute_item_overlay=a.lookup("mute_item_overlay").$("#@mute_item_overlay"),this.mute_item_controls=a.lookup("mute_item_controls").$("#@mute_item_controls"),this.$("#@mute_button").click(this.fnbind(function(){this.hideFeedItem();var a=this.qfeed_log_action;a&&k.setQfeedLog(this,a),this.serverCall("mute").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()})),this.$("#@mute_button").tooltip({contents:this.tooltip_text})},hideFeedItem:function(){this.mute_item_controls.hide(),this.mute_item_overlay.hide(),this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}}),a.FeedUnfollowButton=e.extend({onLoad:function(){var a=this.lookup("mute_item_controls").lookup("item");this.item=a.$("#@item"),this.feed_item=a.$("#@feed_item"),this.mute_item_overlay=a.lookup("mute_item_overlay").$("#@mute_item_overlay"),this.mute_item_controls=this.lookup("mute_item_controls").$("#@mute_item_controls");var b={user:"UserUnfollow",question:"QuestionUnfollow",blog:"BoardUnfollow",topic:"TopicUnfollow"};this.$("#@unfollow_button").click(this.fnbind(function(){this.hideFeedItem(),this.serverCall("unfollow").kwargs({oid:this.oid,qid:this.qid,bid:this.bid}).liveMutate().send()}))},hideFeedItem:function(){this.mute_item_controls.hide(),this.mute_item_overlay.hide(),this.feed_item.parent(".feed_item").animate({opacity:0},this.fnbind(function(){this.feed_item.parent(".feed_item").slideUp(300)}))}}),a.ExpandableLink=e.extend({onLoad:function(){this.$("#@show").click(this.fnbind(function(){return this.$("#@inner_tree").show(),this.$("#@show").hide(),!1})),this.$("#@hide").click(this.fnbind(function(){return this.$("#@inner_tree").hide(),this.$("#@show").show(),!1}))}}),a.ContentPageFeedStoryItemBase=e.extend({onLoad:function(){var a="";this.$("#@item .credibility_facts").truncate({lines:2}),this.$("#@item .truncated_q_text a.more_link").html(a).removeClass("more_link").removeAttr("id").addClass("read_more").attr("href",this.target_url),this.$("#@item a.lil_button.rate_up").removeAttr("id").attr("href",this.target_url),this.$("#@item .answer_content").css({cursor:"pointer"}),this.$("#@item_overlay").mousedown(this.fnbind(function(){return this.serverCall("on_item_click").send(),!1}))}}),a.QuestionNumberAnswers=e.extend({onLoad:function(a){this.$("#@link").mousedown(this.fnbind(function(){k.setQfeedLog(this,"QuestionClickthrough"),k.setQueryLog(this,"QuestionClickthrough")}))}}),a.HomepageFeedStoryItem=e.extend({contextConstructor:function(){return n.FeedStoryItem},init:function(){function b(){if(a.alreadySent)return;a.alreadySent=!0,k.setMessage("vtc",[a.hash,a.view_tracking_key]),a.allowServerCall&&a.serverCall("dummy_call_nonlivedepped").send()}this._super.apply(this,arguments),this.setDvar("feed_story_hash",this.hash);var a=this;a.allowServerCall=!0,a.alreadySent=!1,this.parent().needsRefresh=!0,this.$("#@item").mousedown(b),$("a",this.$("#@item")).mousedown(function(c){a.allowServerCall=c.target.pathname==window.location.pathname,b()})},onLoad:function(){var a=this;this.feedStoryItemContext=this.getContext(n.FeedStoryItem),this.feed_item=this.$("#@feed_item"),this.show_mute_item&&(this.controls=this.cQuery(":mute_item_controls"),this.overlay=this.cQuery(":mute_item_overlay"),this.close=this.cQuery(":mute_item_overlay").$("#@cancel_mute_item_wrapper"),this.close.click(function(){a.hideMuteControls()}),this._closeOnEsc()),this._save_feed_debug_handler(),m.addComponentToTrack(this),this.feedStoryItemContext.on("showRemoveFromFeedMenu",function(b,c){c===!0&&a.showMuteControls()}),this.feedStoryItemContext.on("showQuestionDownvoteFeedback",function(b,c){c===!0&&a.showQuestionDownvoteFeedback()}),this.feedStoryItemContext.on("showAnswerDownvoteFeedback",function(b,c){c===!0&&a.showAnswerDownvoteFeedback()})},getHash:function(){return this.hash},isVisible:function(){var a=$("#"+c.getLiveParent(this.cid));if(!a.is(":visible"))return!1;var b=this.$("#@item");return!b.hasClass("hidden")&&a.is(":in-viewport")},validForLoggingImpression:function(a){var b=c.getLiveParent(this.cid);if(!b)return!1;var d=$("#"+b);return!a&&!d.is(":visible")?!1:!0},showMuteControls:function(){if(this.controls.shown)return;this.feed_item.addClass("is_blurred"),this.overlay.show(),this.controls.show()},hideMuteControls:function(){if(!this.controls.shown)return;this.feed_item.removeClass("is_blurred"),this.overlay.hide(),this.controls.hide()},showQuestionDownvoteFeedback:function(){this.showFeedback("load_question_downvote_feedback")},showAnswerDownvoteFeedback:function(){this.showFeedback("load_answer_downvote_feedback")},showFeedback:function(a){var b=this,c=b.feed_item.offset().top;b.feedback=b.$("#@feedback"),b.feed_item.fadeOut(0,function(){b.feedback.fadeIn(333),$(window).scrollTop()>c&&$("html, body").animate({scrollTop:c-80},1e3)}),b.show_mute_item&&b.controls.shown&&b.hideMuteControls(),b.serverCall(a).contentFor(b.$("#@feedback"),{parentCID:b.cid}).send()},_closeOnEsc:function(){var a=this;$(document).bind("keydown.mute_item_exit",function(b){b.keyCode==27&&a.hideMuteControls()})},_save_feed_debug_handler:function(){if(j.save_feed_story_debug){var a=this;this.$("#@save_feed_story").on("click",function(b){b.preventDefault();if(a.save_feed_clicked)return;a.serverCall("save_feed_story").send(),$(this).html("Saved").addClass("clicked"),a.save_feed_clicked=!0})}}}),a.QuestionTopics=e.extend({onLoad:function(){this.$("#@view_all_link").tooltip({contents:this.tooltip_text}),this.$("#@view_all_link").click(this.fnbind(function(){return this.$("#@view_all").addClass("hidden"),this.$("#@view_all_link").addClass("hidden"),this.$("#@all_topics").removeClass("hidden"),!1}))}}),a.EventView=e.extend({contextConstructor:function(){return n.AnswerVoteContext},onLoad:function(){this._super.apply(this,arguments);var a=this;if(this.scroll_to_top){var b=this.lookup("item").$("#@item");if(b){var c=20;window.scroll(0,$(b).offset().top-i.headerOffset-c),$(b).effect("highlight",{},2e3)}}}}),a.FeedBottomIndicator=e.extend({onLoad:function(){var a=this;this.$("#@feed_bottom").click(function(){a.parent().onFeedBottomIndicatorClicked()})}}),a.InlineFollowSuggestionCard=require("action_log").ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.setDvar("feed_story_inner_position",this.inner_position)}}),a.PinnedTopicHeader=e.extend({onLoad:function(){var a=this,b=a.$("#@topic_header"),c=b.height();h.makeFixable(b,{scroll_dep:!0,min_height:c,min_scroll:c+20}),b[0].addEventListener("w2.fixable.fixed",function(){b.css({top:$(".SiteHeader").outerHeight()})})}})},{"view/fixable2":!0,log:!0,window_manager:!0,settings:!0,webnode2:!0,views:!0,"app/view/home":!0,cookies:!0,gating:!0,"view/paged_list":!0,"w2.context":!0,action_log:!0,event:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/feed/feedback",function(require,a,b){var c=require("w2.quora").Component,d=require("w2.context").FeedStoryItem;a.Feedback=c.extend({onLoad:function(){var a=this;this.feedback=this.lookup("item").$("#@feedback"),this.feed_item=this.lookup("item").$("#@feed_item"),this.feedStoryItemContext=this.getContext(d),this.$("#@undo").click(function(b){b.preventDefault(),a.hideFeedback(),a.serverCall("undo").liveMutate().send()}),this.feedStoryItemContext&&this.feedStoryItemContext.on("showAnswerDownvoteFeedback",function(b,c){c===!1&&a.hideFeedback()})},showFeedback:function(){var a=this;this.feedStoryItemContext!==null&&this.feedStoryItemContext.set("feedbackShown",!0),a.feed_item.fadeOut(0,function(){a.feedback.fadeIn(333)})},hideFeedback:function(){var a=this;this.feedStoryItemContext!==null&&this.feedStoryItemContext.set("feedbackShown",!1),a.feedback.fadeOut(0,function(){a.feed_item.fadeIn(333)})}}),a.UnfollowOrMuteTopic=c.extend({onLoad:function(){var a=this;a.feedback=a.lookup("item").$("#@feedback"),a.setHandler("unfollow_topic"),a.setHandler("mute_topic")},setHandler:function(a){var b=this;b.$("#@"+a).click(function(c){c.preventDefault(),b.serverCall(a).contentFor(b.feedback,{parentCID:b.cid}).send()})}})},{"w2.context":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/tutorial",function(require,a,b){var c=require("w2.quora").Component;a.GoToWritepageNotif=c.extend({onLoad:function(){var a=this;window.setTimeout(function(){a.serverCall("send_notif").send()},a.delay*1e3)}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question",function(require,a,b){function l(a){var b=$(window).scrollTop(),c=$(".header").outerHeight();a=a.top-c,(a<b||b===0)&&$(window).scrollTop(a);return}var c=require("w2.quora").Component,d=require("webnode2"),e=require("cookies"),f=require("window_manager"),g=require("view/modal").Base,h=require("views").viewsLogger,i=require("mathify").renderMath,j=require("view/inline_editor").InlineEditor,k=require("w2.context");a.QuestionMain=c.extend({onLoad:function(a){a&&this.record_impression&&setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3)},onUnload:function(){this.uninstallScrollHandlers()}}),a.QuestionLink=c.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){e.setQfeedLog(this,"QuestionClickthrough"),e.setQueryLog(this,"QuestionClickthrough")})),this.onKeyCombination(this.$("#@link"),"o",this.fnbind(function(){return f.navigateTo(this.$("#@link").attr("href")),!1})),i("@link")}}),a.NewUserSendNotif=c.extend({init:function(){this._super.apply(this,arguments),this.seen=!1,this.notif_bottom=!1,this.idleTime=1,this.noActivity=!1;var a=$(document).find(".answer_wrapper").get();this.answersLocation=[];for(var b=0;b<a.length;b++){var c=$(a[b]);this.answersLocation.push(c.offset().top+c.height())}var d=this;$(document).bind("nux_dialog_close",function(){d.installScrollHandlers(d.fnbind(d.scrollHandler)),d.delay===!0&&(d.delay=!1,d.maybeSendNotif()),d.delay&&window.setTimeout(function(){d.maybeSendNotif()},d.delay*1e3),d.no_activity&&(window.setInterval(function(){d.idleTime=d.idleTime+1,d.idleTime>d.no_activity&&(d.noActivity=!0)},1e3),$(this).mousemove(function(a){d.onUserActivity()}),$(this).keypress(function(a){d.onUserActivity()}))})},onUserActivity:function(){this.noActivity&&(this.maybeSendNotif(),this.noActivity=!1),this.idleTime=0},maybeSendNotif:function(){this.seen||(this.seen=!0,this.serverCall("send_go_home_notif").kwargs({}).send())},maybeSendNotifBottom:function(){this.notif_bottom||(this.notif_bottom=!0,this.serverCall("send_go_home_notif_double").kwargs({}).send())},hitBottomHandler:function(){var a=$(window).scrollTop(),b=$(document).height(),c=$(window).height();a+c==b&&(this.double_notif?this.maybeSendNotifBottom():this.maybeSendNotif())},answerReadHandler:function(){var a=$(window).scrollTop(),b=0;for(var c=0;c<this.answersLocation.length;c++)a>this.answersLocation[c]&&(b+=1);b>=this.answer_read&&this.maybeSendNotif()},scrollHandler:function(){var a=$(window).scrollTop();(this.hit_bottom||this.double_notif)&&this.hitBottomHandler(),this.answer_read&&this.answerReadHandler(),this.on_scroll&&a>200&&this.maybeSendNotif()},onUnload:function(){this.uninstallScrollHandlers()}}),a.RelatedQuestionsList=c.extend({onLoad:function(){this.recordStep(["rq_impression","rq_impression_repeated"])},recordStep:function(a){this.serverCall("record_step").kwargs({steps:a}).send()}}),a.RelatedQuestionLink=require("action_log").ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.$("#@actionable").mousedown(a.fnbind(function(){a.recordStep("related_question_click")}))},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}}),a.QuestionArea=c.extend({contextConstructor:function(){return k.QuestionArea},onLoad:function(){var a=this;this._super.apply(this,arguments),a.questionAreaContext=a.getContext(k.QuestionArea),a.questionAreaContext.on("editClicked",a.editLinkClicked.bind(a)),a.questionAreaContext.on("cancelClicked",a.cancelLinkClicked.bind(a)),a.$("#@question_update").click(function(b){b.preventDefault(),a.questionAreaContext.set("triggerRequest"),a.$("#@details_container").addClass("hidden"),a.questionAreaContext.set("showActionBar",!0)}),a.$("#@question_cancel").click(function(b){b.preventDefault(),a.questionAreaContext.set("triggerCancel"),a.$("#@details_container").addClass("hidden"),a.questionAreaContext.set("showActionBar",!0)})},editLinkClicked:function(){this.$("#@details_container").removeClass("hidden"),this.questionAreaContext.set("showActionBar",!1)},cancelLinkClicked:function(){this.$("#@details_container").addClass("hidden"),this.questionAreaContext.set("showActionBar",!0)}}),a.QuestionTextInlineEditor=j.extend({onLoad:function(){var a=this;this._super.apply(this,arguments),a.questionAreaContext=a.getContext(k.QuestionArea),a.questionAreaContext&&(a.questionAreaContext.on("triggerRequest",a.trigger_request.bind(a)),a.questionAreaContext.on("triggerCancel",a.trigger_cancel.bind(a)),a.questionAreaContext.on("editClicked",a.toggle_editor.bind(a)),a.questionAreaContext.on("cancelClicked",a.toggle_editor.bind(a)))},onEditLinkClick:function(){this.questionAreaContext.set("editClicked")},cancelEditor:function(){this._super.apply(this,arguments),this.questionAreaContext.set("cancelClicked")}}),a.QuestionTextAndDetailsEditor=c.extend({onLoad:function(){var a=this;a.$("#@question_update").click(function(b){b.preventDefault(),a.lookup("edit_title").trigger_request(),a.lookup("edit_details").trigger_request(),a.$("#@details_container").addClass("hidden"),a.$("#@answer_container").removeClass("hidden")}),a.$("#@question_cancel").click(function(b){b.preventDefault(),a.lookup("edit_title").trigger_cancel(),a.lookup("edit_details").trigger_cancel(),a.lookup("question_details",!0)&&a.lookup("question_details").trigger_cancel(),a.$("#@details_container").addClass("hidden"),a.$("#@answer_container").removeClass("hidden")})},editLinkClicked:function(){this.$("#@details_container").removeClass("hidden"),this.$("#@answer_container").addClass("hidden"),this.lookup("edit_details").startEditing(),this.lookup("edit_title").startEditing()},cancelLinkClicked:function(){this.$("#@details_container").addClass("hidden"),this.$("#@answer_container").removeClass("hidden"),this.lookup("edit_details").toggle_editor()}}),a.QuestionDeleteLink=c.extend({onLoad:function(){var a=this;this.$("#@delete_question_link").click(function(){return $(".content").dialog({title:a.delete_title,contents:a.delete_content,buttons:{Ok:function(){a._request("delete_question")},Cancel:null}}),!1}),this.$("#@undelete_question_link").click(function(){return $(".content").dialog({title:a.undelete_title,contents:a.undelete_content,buttons:{Ok:function(){a._request("undelete_question")},Cancel:null}}),!1})},_request:function(a){this.serverCall(a).kwargs({qid:this.qid}).liveMutate().send()}}),a.QuestionDeleteDialog=require("dialog").AddCommentDialog.extend({getPars:function(){return this.comment_required&&this.lookup("editor").isEmpty()?!1:{comment:this.lookup("editor").serialize(),review:this.review}}}),a.AnswerActions=c.extend({contextConstructor:function(){return k.AnswerVoteContext}}),a.AnswerPermaLink=c.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){e.setQfeedLog(this,"AnswerClickthrough"),e.setQueryLog(this,"AnswerClickthrough")})),this.tooltip&&this.$("#@link").tooltip({contents:this.tooltip})}}),a.AnswerUndeleteBanner=c.extend({onLoad:function(){var a=this;a.$("#@answer_undelete").click(function(b){a.modal("load_answer_delete_modal").onSubmitCallBack(function(){a.serverCall("unremove_answer").kwargs({aid:a.aid}).liveMutate().send()})})}}),a.AnswerUndeleteModal=g.extend({onSubmit:function(){this._super.apply(this,arguments),d.Modal.modalFor(this).executeOnSubmitCallBack()}}),a.AnswerAddInstructions=c.extend({onLoad:function(){this.$("#@view_deleted_answer").click(this.fnbind(function(){return this.$("#@deleted_answer").toggleClass("hidden"),!1}))}}),a.CreateAnswerWikiLink=c.extend({onLoad:function(){this.$("#@create_answer_wiki").click(this.fnbind(function(){return $("#answer_wiki").toggleClass("hidden"),!1}))}}),a.AnswerListDiv=c.extend({onLoad:function(){this.header_height=$(".SiteHeader").outerHeight(),this.offset=15,this.$("#@answers_anchor").css("top","-"+this.header_height+"px"),window.location.hash=="#answers"&&$(window).scrollTop(this.$("#@answers_anchor").offset().top)},onUnload:function(){this.uninstallScrollHandlers()},show:function(){this.$("#@collapsed").show()}}),a.QuestionAnswerMain=c.extend({onLoad:function(a){a&&setTimeout(this.fnbind(function(){this.serverCall("record_impression").send()}),1e3),this.recordStep("share_impression")},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()}}),a.ReviewPageEditTopicLink=c.extend({onLoad:function(){this.$("#@edit_topic").click(this.fnbind(function(){return this.openDialog(),!1}))},openDialog:function(){this._dialog=this.dialog().title(this.edit_text).load("content")},closeDialog:function(){this._dialog.close_()}}),a.ReviewPageEditTopicDialog=c.extend({onLoad:function(){this.submitted=!1,this.$("#@cancel").click(this.fnbind(function(){return this.closeDialog(),!1})),this.$("#@edit").click(this.fnbind(function(){var a=this.getContextName();return a&&!this.submitted&&(this.submitted=!0,this.editTopic(a)),!1}))},editTopic:function(a){this.closeDialog(),this.serverCall("edit_topic").kwargs({topic_name:a}).liveMutate().send()},getContextName:function(){var a=this.cQuery(":context.topic_add").getTempTopicNamesAsArray();return a.length>0?a[0]:null},closeDialog:function(){d.Dialog.openerFor(this).closeDialog()}});var m=a.StarRatingButtons=c.extend({onLoad:function(){var a=this,b=this.$("#@ratings").attr("class");$.each(this.$("%@rating"),function(c,d){$(this).attr("title",""),$(this).hover(function(){b=a.$("#@ratings").attr("class"),a.$("#@ratings").removeClass();var c=$(this).attr("rating");a.$("#@ratings").addClass("current_rating_"+c)},function(){a.$("#@ratings").attr("class",b)}),$(this).click(function(){a.$("#@ratings").removeClass();var c=$(this).attr("rating");return a.$("#@ratings").addClass("current_rating_"+c),b="current_rating_"+c,!1})})}});a.ReviewQuestionTextMain=c.extend({onLoad:function(){var a=this;this.$("#@edit").click(this.fnbind(function(){a.$("#@name").hide(),a.$("#@selector").show()}))}}),a.TopicReviewRatingLabel=c.extend({onLoad:function(a){this.$("#@request").click(this.fnbind(function(){return this.requestReviews(),!1}))},requestReviews:function(){this.submitted||(this.submitted=!0,this.serverCall("request_reviews").success(this.fnbind(function(a){a[0]=="/"&&(document.location=a)})).liveMutate().send())}}),a.AnswerPagingCompleteIndicator=c.extend({onLoad:function(){this.show_content_page_feed&&setTimeout(this.fnbind(this.showContentPageFeed),0)},showContentPageFeed:function(){var a=this.lookup("content_page_feed");a?a.show():setTimeout(this.fnbind(this.showContentPageFeed),250)}}),a.AttachDisclaimerLink2=c.extend({onLoad:function(){this.$("#@add_disclaimer_link").click(this.fnbind(function(){return this._dialog=this.dialog().title(this.create_disclaimer_title).load("set_disclaimer_dialog"),!1}))}}),a.AnswerPagedListItem=c.extend({onLoad:function(){h.addComponentToTrack(this)}})},{cookies:!0,window_manager:!0,views:!0,webnode2:!0,"view/modal":!0,"w2.context":!0,dialog:!0,"view/inline_editor":!0,mathify:!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/merge/_merge",function(require,a,b){var c=require("w2.quora").Component;a.QuestionMergeCandidates=c.extend({onLoad:function(){var a=this;a.$insertionEl=a.$("#@insert_candidate"),a.$showAllLinkEl=a.$("#@show_all_link"),a.$showAllLinkEl.click(function(b){b.preventDefault(),a.$("#@candidates .candidate").removeClass("hidden"),a.$showAllLinkEl.addClass("hidden")})},selectQID:function(a){var b=this,c=b.$("#@candidates input[type=checkbox][value="+a+"]");c.length?c.map(function(){var a=$(this),c=$("label[for='"+a.attr("id")+"']");a.attr("checked",!0),a.change(),c.insertAfter(b.$insertionEl),c.removeClass("hidden")}):b.serverCall("get_checkbox_content").kwargs({qid:a}).contentFor(b.$insertionEl,{parentCID:b.cid}).success(function(){b.$insertionEl.children().map(function(){$(this).insertAfter(b.$insertionEl)})}).send()},getSelectedQIDs:function(){var a=[];return this.$("#@candidates input[type=checkbox]:checked:not(:disabled)").map(function(){a.push(parseInt(this.value))}),a}}),a.QuestionMergeCanonicalPicker=c.extend({onLoad:function(){var a=this;a.$radios=a.$("#@picker input[type=radio]"),a.$radios.change(function(b){a.$radios.map(function(){var a=$(this),b=$("label[for='"+a.attr("id")+"']");b.toggleClass("selected",a.is(":checked")),b.toggleClass("not_selected",!a.is(":checked"))})})},getSelectedQID:function(){var a=this.$("#@picker input[type=radio]:checked");if(a)return parseInt(a.val())}}),a.OriginallyAnsweredBanner=c.extend({onLoad:function(){var a=this;a.$("#@remove").click(function(b){b.preventDefault(),a.serverCall("remove_banner").liveMutate().send()})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/merge/selector",function(require,a,b){var c=require("w2.quora").Component,d=require("view/selector").Selector;a.QuestionMergeESSelector=d.extend({resultWasSelected:function(a){var b=this;b.parent().child("candidates").selectQID(a.data.qid),b.setQuery("")},getExtraKwargs:function(){return{ignore_qids:this.parent().child("candidates").getSelectedQIDs()}}})},{"view/selector":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/merge/modal",function(require,a,b){var c=require("window_manager"),d=require("view/modal");a._QuestionMergeModal=d.MultiStep.extend({onSubmitSuccess:function(a,b,d,e){var f=this,g=25e3,h=1e3;e<g?setTimeout(f.fnbind(function(){f.serverCall("answer_has_moved").kwargs({qids:b,canonical_qid:d,time_so_far:e+h}).success(function(e){e?f.onSubmitSuccess(a,b,d,e):c.navigateTo(a)}).send()}),h):(f.serverCall("log_timeout_before_answers_moved").kwargs({time_taken:e+h}).send(),c.navigateTo(a))},getCallBacks:function(){var a=this;return{QuestionMergeModalSelectorStep:{getStepData:function(){var b=a.data_cache[a.key],c=a.child("candidates").getSelectedQIDs();return c.push(b.qid),$.extend(b,{selectedQIDs:c})},onSubmit:function(){a.child("candidates").getSelectedQIDs().length&&a._loadNext()}},QuestionMergeModalCanonicalStep:{isLastStep:!0,onSubmit:function(){var b=a.child("picker").getSelectedQID(),c=a.data_cache.QuestionMergeModalSelectorStep;if(b){a.disableSubmit();var d=c.selectedQIDs;a.serverCall("submit").kwargs({qids:d,canonical_qid:b}).success(function(c){a.onSubmitSuccess(c,d,b,0)}).liveMutate().send()}}}}}})},{"view/modal":!0,window_manager:!0})}),require.whenReady("settings",function(){require.install("app/view/board/blog",function(require,a,b){var c=require("w2.quora").Component;a.CreateBlog=c.extend({onLoad:function(){this.submitted=!1,this.$("#@name").focus(),this.$("#@fake_editor").click(this.fnbind(function(){return this.$("#@fake_editor_row").hide(),this.$("#@editor_row").show(),this.lookup("editor").focus(),!1})),this.$("#@create").click(this.fnbind(function(){var a=this.$("#@name").val(),b=this.lookup("subdomain").getInput().val();a?this.$("#@name").removeClass("input_validation_error"):(this.$("#@name").addClass("input_validation_error"),this.$("#@name").focus()),b?this.lookup("subdomain").getInput().removeClass("input_validation_error"):(this.lookup("subdomain").getInput().addClass("input_validation_error"),a&&this.lookup("subdomain").getInput().focus());if(b&&a&&this.lookup("subdomain").urlIsOK&&!this.submitted){this.$("#@create").addClass("submit_button_disabled"),this.submitted=!0;var c=this.lookup("editor").serialize();this.disable(),this.serverCall("create").kwargs({name:a,description:c,url:b,topics:""}).success(this.fnbind(function(a){a&&(document.location=a)})).liveMutate().send()}return!1}))},disable:function(){this.$("#@name").addClass("qtext_editor_content_disabled"),this.lookup("subdomain").getInput().addClass("qtext_editor_content_disabled"),this.lookup("editor").$("#@editor").addClass("qtext_editor_content_disabled")}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies"),e=require("settings").interface_strings;a.TopicAliases=c.extend({onLoad:function(){var a=this.fnbind(this.addAliasSubmit);this.$("#@topic_alias_add").click(a),this.$("#@topic_alias_add_form").submit(a),this.$("#@show_alias_link").click(this.fnbind(function(a){a.preventDefault(),this.$("#@add_topic_alias").show(),this.$("#@show_alias").hide(),this.$("#@topic_alias_input").focus()}))},get_value:function(){return this.$("#@topic_alias_input").val()},addAliasSubmit:function(){return this._request(this.get_value()),!1},_request:function(a){if(!this.tid||!a)return!1;this.serverCall("add_topic_alias").kwargs({tid:this.tid,alias:a}).success(this.fnbind(function(){this.$("#@topic_alias_input").val(""),this.$("#@topic_alias_input").focus()})).liveMutate().send()}}),a.TopicAlias=c.extend({onLoad:function(){var a=this,b={title:a.dialog_title,contents:a.dialog_contents,buttons:{Ok:this.fnbind(this._request),Cancel:null}};this.$("#@topic_alias_remove").click(function(){return $(".content").dialog(b),!1})},_request:function(){if(!this.tid||!this.alias)return!1;this.serverCall("remove_topic_alias").kwargs({tid:this.tid,alias:this.alias}).liveMutate().send()}}),a.TopicDelete=c.extend({onLoad:function(){var a=this;this.$("#@delete_topic_link").click(function(){return a.showDialog(!0),!1}),this.$("#@undelete_topic_link").click(function(){return a.showDialog(!1),!1})},getKwargs:function(a){return{tid:this.tid,comment:a.serialize()}},showDialog:function(a){var b=this.title,c=a?"delete_topic":"undelete_topic",d=a?"delete_dialog":"undelete_dialog",g=this;g.dialog().title(b).ok(function(){var a=f.lookup("editor");if(a.isEmpty())return!1;g.serverCall(c).kwargs(g.getKwargs(a)).liveMutate().send()},e.ok).cancel(null,e.cancel).load(d)}});var f;a.TopicDialog=c.extend({onLoad:function(){this.lookup("editor").focus(),f=this}}),a.getTopicDialog=function(){return f},a.TopicFollowButton=c.extend({onLoad:function(){var a=this.fnbind(this.follow),b=this.fnbind(this.unfollow);this.$("#@follow").click(a),this.$("#@unfollow").click(b),this.onKeyCombination(this.$("#@follow"),"f",a),this.onKeyCombination(this.$("#@unfollow"),"f",b),this.tooltip&&this.$("#@follow").tooltip({contents:this.tooltip_text})},follow:function(a){d.setQfeedLog(this,"TopicFollow"),d.setQueryLog(this,"TopicFollow"),d.setTlog({type:"TopicFollow",tid:this.tid}),require("action_log").logSecondaryAction("TopicFollow",{type:"topic",tid:this.tid}),this.serverCall("follow").kwargs({tid:this.tid}).liveMutate().send(),a.preventDefault()},unfollow:function(a){this.serverCall("unfollow").kwargs({tid:this.tid}).liveMutate().send(),a.preventDefault()}}),a.AdultTopicFollowButton=require("dialog").DialogLink.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@link").click(this.fnbind(function(){return this.serverCall("follow").liveMutate().send(),!1}))}}),a.TopicNameLinkBase=c.extend({onLoad:function(){this.$("#@link").mousedown(this.fnbind(function(){d.setQfeedLog(this,"TopicClickthrough"),d.setQueryLog(this,"TopicClickthrough")}))}}),a.HoverTopicMenuMuteLink=c.extend({onLoad:function(){var a=this;a.$("#@hover_menu_muting_link").click(function(b){return b.preventDefault(),$(this).hasClass("topic_muted")?a.serverCall("unmute").liveMutate().send():(a.lookup("topic_name_link").doHide(),a.serverCall("mute").liveMutate().send()),!1})}}),a.TopicTrendingIndicator=c.extend({onLoad:function(){this.$("#@trending").tooltip({contents:this.tooltipText})}})},{cookies:!0,settings:!0,dialog:!0,action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/signup",function(require,a,b){var c=require("webnode2"),d=require("w2.quora").Component,e=require("window_manager"),f=require("login").LiveLoginDialog,g=require("cookies"),h=require("w2.context").CaptchaInput,i=require("facebook");window.loginInProgress=!1,$(document).bind("w2rpcexception-signup_blocked.default",function(a,b){e.navigateTo("/signup/blocked")}),a.SignupFormFields=d.extend({onLoad:function(){this.captchaContext=this.getContext(h);var a=this;this.__js_init.fb_signup_button_enabled_by_default||(this.$("#@email, #@name, #@password").keyup(function(){a.maybeEnableDisableSubmitButton()}),this.captchaContext.on("isCaptchaFilled",function(){a.maybeEnableDisableSubmitButton()}))},maybeEnableDisableSubmitButton:function(){var a=this;a.$("#@name").val()&&a.$("#@email").val()&&a.$("#@password").val()&&a.captchaContext.get("isCaptchaFilled")===!0?a.trigger("enable_submit"):a.trigger("disable_submit")},validate:function(){var a=this;if(!this.child("name_validator").isValid)if(!this.$("#@name")||this.child("name_validator")!==null)return!1;if(!this.child("email_validator").isValid)if(!this.$("#@email")||this.child("email_validator").isValid!==null)return this.$("#@email").removeAttr("readonly"),!1;if(this.$("#@password").val().length<this.minimum_password_length)return!1;if(!this.child("password_validator").isValid)if(!this.$("#@password")||this.child("password_validator").isValid!==null)return a1ert(this.check_password_message),!1;return a.captchaContext.set("sync",!0),a.captchaContext.get("isCaptchaFilled")===!1?!1:!0}}),a.ModalSignupDialog=d.extend({contextConstructor:function(){return h},onLoad
:function(){var a=this;a.captchaContext=a.getContext(h),this.initFormFields(),a.logged_in_modal_dialog&&this.serverCall("show_fb_modal").send(),a.log_times=[5,10,20,40],a.log_idx=0;var b=function(){a.recordStep("seconds_on_page_"+a.log_times[a.log_idx]),a.log_idx++};for(var c=0;c<a.log_times.length;c++)setTimeout(b,a.log_times[c]*1e3);a.updateCheckboxCookie(),a.recordStep("signup_dialog_begin"),a.fbConnected=!1,a.twConnected=!1,a.googConnected=!1,a.signupRpcPending=!1,a.fbProfileInfo={},a.fbInfo={},a.twInfo={},a.googInfo={},a.show_facebook_connect&&(a.child("fb_connect").bind("fb_login",function(){a.updateFbLoginStatus(!0)}),a.child("fb_connect").bind("fb_login_failed",function(b){a.showAuthExplanation("facebook")})),a.show_twitter_connect&&(a.child("tw_connect").bind("tw_login",function(b,c,d){a.updateTwLoginStatus(c,d)}),a.child("tw_connect").bind("tw_login_failed",function(b){a.showAuthExplanation("twitter")})),a.show_google_connect&&(a.child("goog_connect").bind("goog_login",function(b,c,d){a.updateGoLoginStatus(c,d)}),a.child("goog_connect").bind("goog_login_failed",function(b){a.showAuthExplanation("google")})),a.register_submit_button&&a.registerSubmitButton(),a.registerLoginLink(),a.registerEmailSignupLink(),a.registerCancelLinks(),a.has_passwordless&&(a.recordStep("login_has_passwordless"),a.$("#@login").show(),a.$("#@create_account").hide()),$(window).resize(a.fnbind(function(b){a.centerComponent()}));var d=a.child("facepile");d&&d.bind("facepile_parsed",a.fnbind(function(b){a.centerComponent()})),a.centerComponent(),a.$("#@form").show(),a.$("%@create_account_footer_link").click(a.fnbind(function(){a.onClickCreateAccountLink()})),a.$("%@sign_in_footer_link").click(a.fnbind(function(){a.onClickSignInLink()})),a.$("%@remind_me_footer_link").click(function(){a.onClickNotNowLink()}),a.$("#@close_x").click(a.fnbind(function(){return a.onClickNotNowLink(),!1})),a.$("#@checkbox_tos").change(a.fnbind(function(){a.clickCheckbox()})),a.$("#@connect_button_overlay").click(a.fnbind(function(){a.$("#@connect_button_overlay").is(":visible")&&a.$("#@checkbox_error").removeClass("hidden")})),window.loginIntent?(a.onClickLoginLink(),window.loginIntent=!1):window.askQuestionIntent&&(a.onClickAskQuestionLink(),window.askQuestionIntent=!1)},initFormFields:function(){this.formFields=this.child("form_fields"),this.submit=this.$("#@submit"),this.spinner=this.$("#@spinner")},updateCheckboxCookie:function(){var a=this.$("#@checkbox_tos");a.hasClass("age_checkbox")&&(a.is(":checked")||g.setAgeGate())},clickCheckbox:function(){var a=this;a.$("#@checkbox_tos").is(":checked")?a.$("#@connect_button_overlay").addClass("hidden"):a.$("#@connect_button_overlay").removeClass("hidden"),a.updateCheckboxCookie()},registerEmailSignupLink:function(){var a=this;a.$("%@use_email_signup").click(function(){return a.show_facebook_connect&&window.FB.getLoginStatus(a.fnbind(function(b){a.toggleConnectButtonsAndForm(!0)})),a.hidePhotoSection(),a.toggleConnectButtonsAndForm(!0),!1})},hidePhotoSection:function(){this.$("#@contents").addClass("no_picture_form"),this.$("#@connected_photo_wrapper").hide()},registerCancelLinks:function(){var a=this;a.$("%@cancel_link").click(function(){return a.close(),!1}),a.logged_in_modal_bg_close&&a.$("#@background").click(function(){if(!a.logged_in_modal_bg_close)return!1;a.close(),a.serverCall("close_fb_modal_background").send()}),a.background_click_dismisses_dialog&&a.$("#@background").click(function(){if(!a.background_click_dismisses_dialog)return!1;if(a.signupRpcPending)return!1;a.close(),a.recordStep("signup_dialog_background_click_to_close")})},toggleCancelLinks:function(a){a?this.$("%@cancel_link").show():this.$("%@cancel_link").hide()},disableCancelBasedOnOptions:function(){this.disable_background_close_on_connect&&(this.background_click_dismisses_dialog=!1)},formTopCoord:function(){return Math.max(($(window).height()-this.$("#@form").outerHeight())/2-20,20)},centerComponent:function(){var a=this.shouldShowFbFacepile();this.toggleFbFacepileDisplay(a);if(this.$("#@top_section")){var b=this.shouldShowTopSection();this.toggleTopSectionDisplay(b)}},shouldShowTopSection:function(){return!0},shouldShowFbFacepile:function(){return!0},toggleFbFacepileDisplay:function(a){a?this.$("#@facepile_container").show():this.$("#@facepile_container").hide()},toggleTopSectionDisplay:function(a){a?this.$("#@top_section").show():this.$("#@top_section").hide()},toggleConnectButtonsAndForm:function(a){this.showWaitingForLogin(!1),a?(this.$("#@connect").hide(),this.$("#@signup_form").show(),this.updateFormFieldFocus()):(this.$("#@connect").show(),this.$("#@signup_form").hide()),this.hideFooterLinks(),this.$("#@login").is(":visible")?this.$(".login_footer_links").show():this.$("#@signup_form").is(":visible")?this.$(".signup_footer_links").show():this.$("#@connect").is(":visible")&&this.$(".regular_login_links").show(),this.centerComponent()},showWaitingForLogin:function(a){a?(this.$("#@connect").hide(),this.$("#@signup_form").hide(),this.$("#@account_loading").show()):this.$("#@account_loading").hide(),this.centerComponent()},updateFbLoginStatus:function(a){var b=this;window.FB.getLoginStatus(function(c){c.status==="connected"&&b.showWaitingForLogin(!0),a||b.recordStep("signup_fb_initially_"+c.status);if(c.status==="connected"){var d=c.authResponse;b.fbInfo={uid:c.authResponse.userID,accessToken:c.authResponse.accessToken,expiresIn:c.authResponse.expiresIn},b.serverCall("save_fb_token").kwargs({fb_uid:b.fbInfo.uid,access_token:b.fbInfo.accessToken,expires_in:b.fbInfo.expiresIn}).send(),b.queryFacebookProfile(function(a){b.fbProfileInfo={name:a.name,email:a.email,photoUrl:a.picture},b.updateFormFields(b.fbProfileInfo)});var e=b.enable_passwordless_signup&&a;if(window.loginInProgress===!0)return;window.loginInProgress=!0,b.serverCall("try_login_facebook").kwargs({fb_access_token:b.fbInfo.accessToken,auto_signup:e,logged_in:b.logged_in_modal_dialog,code:b.code}).success(function(c){c?b.completeLogin():b.enable_passwordless_signup?b.toggleConnectButtonsAndForm(a):b.toggleConnectButtonsAndForm(!0),window.loginInProgress=!1}).except("banned_user",function(){b.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){b.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).send(),b.updateLoginMessage(),i.updatePermissions(b.fnbind(b.updateLoginMessage)),a&&b.disableCancelBasedOnOptions()}}),b.centerComponent()},updateTwLoginStatus:function(a,b){var c=this;c.twConnected=!0,c.twInfo={uid:b.twitter_uid,accessToken:a.key},c.showWaitingForLogin(!0),c.updateFormFields({name:b.name,photoUrl:b.photo_url});if(window.loginInProgress===!0)return;window.loginInProgress=!0,c.serverCall("try_login_twitter").kwargs({tw_oauth_key:a.key}).success(function(a){a?c.completeLogin():c.toggleConnectButtonsAndForm(!0),window.loginInProgress=!1}).except("banned_user",function(){c.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){c.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).send(),c.disableCancelBasedOnOptions(),c.centerComponent()},updateGoLoginStatus:function(a,b){var c=this;c.googConnected=!0,c.googInfo={uid:b.email,accessToken:a},c.showWaitingForLogin(!0),c.updateFormFields({name:b.name,email:b.email,photoUrl:b.photo_url}),c.formFields.$("#@email").attr("readonly","readonly");if(window.loginInProgress===!0)return;window.loginInProgress=!0,c.serverCall("try_login_google").kwargs({goog_access_token:a,auto_signup:c.enable_passwordless_signup,code:c.code}).success(function(a){a?c.completeLogin():c.toggleConnectButtonsAndForm(!0),window.loginInProgress=!1}).except("banned_user",function(){c.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){c.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).send(),c.disableCancelBasedOnOptions(),c.centerComponent()},showAuthExplanation:function(a){var b=this;if(b.show_explanation){var c=2700;b.$("#@connect_main_title").text(b.auth_explanation_title),b.$("#@connect_subtitle").text(b.auth_explanation_subtitle),b.$("#@connect_row").effect("highlight",{},c),b.$("#@connect_subtitle").addClass("subtitle_centered");var d,e;a=="google"?(d=b.lookup("goog_connect").$("#@google_connect_button"),e=b.lookup("fb_connect").$("#@facebook_connect_button")):(d=b.lookup("fb_connect").$("#@facebook_connect_button"),e=b.lookup("goog_connect").$("#@google_connect_button")),d.effect("highlight",{color:"#87ceeb"},c);var f=b.$("#@arrow_pointing_down"),g=f.find("span.arrow_down");f.show();var h=a=="google";h===!0?(g.removeClass("arrow_right"),g.addClass("arrow_left")):(g.removeClass("arrow_left"),g.addClass("arrow_right")),b.$(".connect_buttons").css("padding-top","5px"),b.$("#@explanation_login_links").show(),b.$("#@explanation_login_links").effect("highlight",{},c)}},updateFormFields:function(a){var b=this.formFields;if(!b)return;var c=b.$("#@name");c.val(a.name),c.val()!==""&&c.addClass("disabled_text_field").click(function(){c.removeClass("disabled_text_field")}),b.child("name_validator").validate();if(a.email){var d=b.$("#@email");d.val(a.email).addClass("disabled_text_field").click(function(){d.attr("readonly")||d.removeClass("disabled_text_field")});var e={invalid:this.fnbind(function(a){this.formFields.$("#@email").removeAttr("readonly")})};b.child("email_validator").validate(e)}this.$("#@picture_spinner").hide(),a.photoUrl?this.$("#@connected_pic").attr("src",a.photoUrl).show():this.hidePhotoSection(),this.centerComponent()},updateFormFieldFocus:function(){var a=this.formFields;if(!a)return;a.$("#@name").val()?a.$("#@email").val()?a.$("#@password").focus():a.$("#@email").focus():a.$("#@name").focus()},registerLoginLink:function(){var a=this;this.$("%@login_link").click(function(){return a.onClickLoginLink(),!1})},updateLoginMessage:function(){i.getFbUid()?i.hasPermission("publish_actions")?(this.$("#@login_connect_and_timeline_msg").show(),this.$("#@login_connect_msg").hide()):(this.$("#@login_connect_and_timeline_msg").hide(),this.$("#@login_connect_msg").show()):(this.$("#@login_connect_and_timeline_msg").hide(),this.$("#@login_connect_msg").hide()),this.centerComponent()},registerSubmitButton:function(){this.formFields.bind("enable_submit",this.fnbind(function(){this.submit.removeAttr("disabled").removeClass("submit_button_disabled")})),this.formFields.bind("disable_submit",this.fnbind(function(){this.submit.attr("disabled","disabled").addClass("submit_button_disabled")}))},close:function(){return this.recordStep("signup_dialog_close"),this.$("#@background").hide(),this.$("#@form").hide(),this.$("#@top_section").remove(),c.Dialog._instance.cancel_(),!1},show:function(){this.$("#@background").show(),this.$("#@form").show(),this.$("#@top_section").show()},queryFacebookProfile:function(a){window.FB.api("/me?fields=id,name,email",this.fnbind(function(b){this.fbConnected=!0,this.recordStep("signup_facebook_api_succeeded"),a({email:b.email,name:b.name,fb_uid:b.id,picture:"https://graph.facebook.com/"+b.id+"/picture?type=normal"})}))},completeLogin:function(){this.logged_in_modal_dialog&&this.close(),require("settings").pageMode=="post_reload"&&$(document).trigger("quora_login")},recordStep:function(a){this.serverCall("record_step").kwargs({step_name:a}).send()},showFbModal:function(){this.serverCall("show_fb_modal").send()},getHashParams:function(){var a={},b=document.location.hash.substr(1).split("&");for(var c=0;c<b.length;++c)a[b[0]]=b[1];return a},objectToString:function(a,b){b=b||"";var c=[];for(var d in a)typeof a[d]=="object"?c.push(b+d+"=<br>"+this.objectToString(a[d],b+"&nbsp;&nbsp;")):c.push(b+d+"="+a[d]);return c.join(",<br>")},events:{"click #@create_account_link":"onClickCreateAccountLink","click #@submit":"onClickSubmit"},onClickLoginLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@login").show(),this.$(".login_footer_links").show(),this.centerComponent(),this.toggleConnectButtonsAndForm(this.fbConnected||this.twConnected),!1},onClickAskQuestionLink:function(){this.$("#@ask_question_instructions").show()},onClickCreateAccountLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@create_account").show(),this.$("#@signup_form").show(),this.$(".signup_footer_links").show(),this.centerComponent(),!1},onClickSignInLink:function(){return this.hideDialogViews(),this.hideFooterLinks(),this.$("#@create_account").show(),this.$("#@connect").show(),this.$(".regular_login_links").show(),this.$("#@google_button").show(),this.centerComponent(),!1},onClickNotNowLink:function(){this.close(),this.logged_in_modal_dialog&&this.serverCall("close_fb_modal").send()},hideDialogViews:function(){this.$("#@create_account").hide(),this.$("#@connect").hide(),this.$("#@signup_form").hide(),this.$("#@login").hide()},hideFooterLinks:function(){this.$(".regular_login_links").hide(),this.$(".login_footer_links").hide(),this.$(".signup_footer_links").hide()},onClickSubmit:function(){var a=this;if(a.signupRpcPending)return!1;var b=a.formFields;if(b.validate()){a.signupRpcPending=!0,a.spinner.show(),a.submit.attr("disabled","disabled").addClass("submit_button_disabled");if(window.loginInProgress===!0)return;window.loginInProgress=!0,a.serverCall("signup").kwargs({name:b.$("#@name").val(),email:b.$("#@email").val(),password:b.$("#@password").val(),"g-recaptcha-response":a.captchaContext.get("captchaResponse"),fb_access_token:a.fbInfo.accessToken,fb_expires:a.fbInfo.expiresIn,tw_oauth_key:a.twInfo.accessToken,goog_access_token:a.googInfo.accessToken,code:a.code}).success(function(b){a.spinner.hide(),b?a.completeLogin():a.submit.removeAttr("disabled").removeClass("submit_button_disabled"),a.signupRpcPending=!1,window.loginInProgress=!0}).error(function(){a.signupRpcPending=!1,a.spinner.hide(),a.submit.removeAttr("disabled").removeClass("submit_button_disabled"),window.loginInProgress=!0}).send()}return!1}});var j=a.SignupForm2=d.extend({contextConstructor:function(){return h},onLoad:function(){var a=this;this.captchaContext=this.getContext(h),this.inline_login&&this.parent()&&this.parent()instanceof f&&this.serverCall("record_signup_step").kwargs({signup_action:"signup_dialog_begin"}).send(),this.signupRpcPending=!1,this.registerKeyupCallbacks(),this.useLoadingSpinnerForConnectedFriends=!1,this.child("twitter_connect_button")&&this.child("twitter_connect_button").bind("tw_login",this.fnbind(function(a,b,c){this.onTwitterOAuth(b.key,c)})),this.child("google_connect_button")&&(this.child("google_connect_button").bind("goog_login",this.fnbind(function(a,b,c){this.onGoogleOAuth(b,c)})),this.child("google_connect_button").bind("goog_login_failed",this.fnbind(function(){this.showAuthExplanation("google")}))),this.child("facebook_connect_button")&&(this.child("facebook_connect_button").bind("fb_login",this.fnbind(function(a,b){this.tryLoginFacebook(b.accessToken,!0),this.serverCall("show_connected_friends").kwargs({fb_uid:b.userID,fb_access_token:b.accessToken,fb_expires:b.expiresIn,tw_uid:this.$("#@tw_uid").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send(),this.useLoadingSpinnerForConnectedFriends=!1,this.$("#@fb_uid").val(b.userID),this.$("#@fb_access_token").val(b.accessToken),this.$("#@fb_expires").val(b.expiresIn)})),this.child("facebook_connect_button").bind("fb_login_failed",this.fnbind(function(){this.showAuthExplanation("facebook")})),this.child("facebook_connect_button").bind("fb_connected",this.fnbind(function(a,b,c){this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_succeeded"}).send(),this.onFacebookAccountConnected(c)}))),this.$("#@form").submit(this.fnbind(function(b){if(this.signupRpcPending)return!1;a.captchaContext.set("sync",!0);if(a.captchaContext.get("isCaptchaFilled")===!1)return!1;if(!this.validateName())return!1;if(!this.validateEmail())return!1;if(!this.validatePassword())return!1;this.signupRpcPending=!0;if(this.inline_login||this.next_url){this.$("#@spinner").removeClass("hidden");var c={name:this.$("#@name").val(),email:this.$("#@email").val(),password:this.$("#@password").val(),"g-recaptcha-response":a.captchaContext.get("captchaResponse")},d=this.getOptionalArgs();c.optional_args=d;if(window.loginInProgress===!0)return;window.loginInProgress=!0,this.is_ios&&document.activeElement.blur();var e=this.serverCall("signup_dont_redirect").kwargs(c).success(this.fnbind(function(a){this.$("#@spinner").addClass("hidden"),a?this.completeLogin():this.$("#@submit").removeAttr("disabled"),this.signupRpcPending=!1,window.loginInProgress=!1})).error(this.fnbind(function(){this.signupRpcPending=!1,this.$("#@spinner").hide(),this.$("#@submit").removeAttr("disabled"),window.loginInProgress=!1}));return this.disable_live_updates||e.liveMutate(),e.send(),this.$("#@submit").attr("disabled","disabled"),!1}return this.$("#@submit").attr("disabled","disabled"),this.onFormSubmission(),!0})),this.$("#@email").keyup(this.fnbind(function(){this.child("email_validator").hideAllErrors()})),this.$("#@name").keyup(this.fnbind(function(){this.child("name_validator").hideAllErrors()})),this.$("#@password").keyup(this.fnbind(function(){this.child("password_validator").hideAllErrors()}))},showAuthExplanation:function(a){var b=this;if(b.show_explanation){var c=2700;b.$("#@step_1_title").hide(),b.$("#@auth_explanation_container").show().effect("highlight",{},c);var d,e;a=="facebook"?(d=this.child("facebook_connect_button").$("#@facebook_connect_button"),e=this.child("google_connect_button").$("#@google_connect_button")):(d=this.child("google_connect_button").$("#@google_connect_button"),e=this.child("facebook_connect_button").$("#@facebook_connect_button")),d.effect("highlight",{color:"#87ceeb"},c);var f,g,h;b.show_explanation=="narrow"?(f=b.$("#@arrow_pointing_right"),g="area_top",h="area_bottom"):(f=b.$("#@arrow_pointing_down"),g="arrow_left",h="arrow_right"),a=="facebook"?(f.removeClass(h),f.addClass(g)):(f.removeClass(g),f.addClass(h)),b.$("#@bypass_connect_row").effect("highlight",{},c),b.$("#@login_link").css({"font-size":"1.3em","font-weight":"bold"}),b.$("#@bypass_connect_link").css({"font-size":"1.3em","font-weight":"bold"})}},onTwitterOAuth:function(a,b){this.serverCall("record_signup_step").kwargs({signup_action:"signup_twitter_connected"}).send();if(window.loginInProgress===!0)return;window.loginInProgress=!0,this.serverCall("try_login_twitter").kwargs({tw_oauth_key:a}).success(this.fnbind(function(c){c?(this.completeLogin(),window.loginInProgress=!1):(window.loginInProgress=!1,this.onTwitterAccountConnected(a,b))})).except("banned_user",function(){this.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){this.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1,this.onTwitterAccountConnected(a,b)}).send(),this.serverCall("show_connected_friends").kwargs({tw_uid:b.twitter_uid,fb_uid:this.$("#@fb_uid").val(),fb_access_token:this.$("#@fb_access_token").val(),fb_expires:this.$("#@fb_expires").val()}).contentFor(this.$("#@connected_friends_list"),{parentCID:this.cid,useLoadingSpinner:this.useLoadingSpinnerForConnectedFriends}).send(),this.useLoadingSpinnerForConnectedFriends=!1,this.$("#@connected_pic").hasClass("fb_photo")||(b.photo_url?this.$("#@connected_pic").attr("src",b.photo_url):this.$("#@connected_pic").hide())},onGoogleOAuth:function(a,b){this.serverCall("record_signup_step").kwargs({signup_action:"signup_google_connected"}).send(),this.tryLoginGoogle(a,this.onGoogleAccountConnected.bind(this,a,b)),this.$("#@connected_pic").hasClass("fb_photo")||(b.photo_url?this.$("#@connected_pic").attr("src",b.photo_url):this.$("#@connected_pic").hide())},tryLoginFacebook:function(a,b){var c=this;if(window.loginInProgress===!0)return;window.loginInProgress=!0,c.serverCall("try_login_facebook").kwargs({fb_access_token:a,code:c.code,auto_signup:!0}).success(function(a){a&&c.completeLogin(),window.loginInProgress=!1}).except("banned_user",function(){c.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){c.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1}).send()},tryLoginGoogle:function(a,b){var c=this;if(window.loginInProgress===!0)return;window.loginInProgress=!0,c.serverCall("try_login_google").kwargs({goog_access_token:a,code:c.code}).success(function(a){a?(c.completeLogin(),window.loginInProgress=!1):(window.loginInProgress=!1,b())}).except("banned_user",function(){c.serverCall("login_user_is_banned").send(),window.loginInProgress=!1}).except("too_many_attempts",function(){c.serverCall("login_user_rate_limited").send(),window.loginInProgress=!1}).error(function(){window.loginInProgress=!1,b()}).send()},onFormSubmission:function(){},onTwitterAccountConnected:function(a,b){this.accountConnected(),this.child("twitter_connect_button").$("#@twitter_connect_button").hide(),this.$("#@twitter_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.$("#@email").focus(),this.showConnectedFriends(),this.showTwitterConnectedInfo(b),this.$("#@tw_oauth_key").val(a),this.$("#@tw_uid").val(b.twitter_uid),this.$("#@tw_screen_name").val(b.twitter_screen_name),this.$("#@name").val(b.name),this.child("name_validator").validate(),this.onShowStepTwo()},onGoogleAccountConnected:function(a,b){this.accountConnected(),this.child("google_connect_button").$("#@google_connect_button").hide(),this.$("#@google_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.$("#@password").focus(),this.showConnectedFriends(),this.showGoogleConnectedInfo(b),this.$("#@goog_access_token").val(a),this.$("#@goog_email").val(b.email),this.$("#@goog_name").val(b.name),this.$("#@name").val(b.name),this.$("#@email").val(b.email),this.child("name_validator").validate(),this.$("#@email").attr("readonly","readonly"),this.$("#@email").addClass("disabled_text_field");var c={invalid:this.fnbind(function(a){this.$("#@email").removeAttr("readonly"),this.$("#@email").removeClass("disabled_text_field")})};this.child("email_validator").validate(c),this.onShowStepTwo()},showConnectedFriends:function(){this.$("#@connected_friends_list").show()},onFacebookAccountConnected:function(a){this.accountConnected(),this.hide_welcome_on_connect&&this.$("#@signup_welcome").hide();if(a&&a[0])window.RESULTS=a,a[0].pic_big?(this.$("#@connected_pic").attr("src",a[0].pic_big),this.$("#@connected_pic").addClass("fb_photo")):this.$("#@connected_pic").hide(),a[0].contact_email&&this.$("#@email").val(a[0].contact_email),this.child("facebook_connect_button").$("#@facebook_connect_button").hide(),this.$("#@facebook_connected").show(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@password").focus(),this.$("#@step_2").removeClass("hidden"),this.showConnectedFriends(),this.showFbConnectedInfo(a),this.$("#@name").val(a[0].name),this.child("name_validator").validate(),this.onShowStepTwo();else{var b=window.console;b&&b.error&&b.error("Error retrieving data from Facebook."),this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},validateName:function(){if(!this.child("name_validator").isValid)if(!this.$("#@name")||this.child("name_validator")!==null)return this.child("name_validator").invalidMessage?a1ert(this.child("name_validator").invalidMessage):a1ert(this.check_name_message),!1;return!0},validateEmail:function(){if(!this.child("email_validator").isValid)if(!this.$("#@email")||this.child("email_validator").isValid!==null)return this.child("email_validator").invalidMessage?a1ert(this.child("email_validator").invalidMessage):a1ert(this.check_email_message),!1;return!0},validatePassword:function(){var a=this.$("#@password").val();if(a.length<this.minimum_password_length||a.length>this.maximum_password_length)return!1;if(a.toLowerCase()=="password")return!1;if(!this.child("password_validator").isValid){if(!this.$("#@password")||this.child("password_validator").isValid!==null)return this.child("password_validator").invalidMessage?a1ert(this.child("password_validator").invalidMessage):a1ert(this.check_password_message),!1}else window.console.log("validator hasn't responded yet, allowing through");return!0},registerKeyupCallbacks:function(){this.$("#@email, #@name, #@password").keyup(this.fnbind(function(){this.$("#@name").val()&&this.$("#@email").val()&&this.$("#@password").val()?(this.$("#@submit").removeAttr("disabled"),this.$("#@submit").removeClass("submit_button_disabled")):(this.$("#@submit").attr("disabled","disabled"),this.$("#@submit").addClass("submit_button_disabled"))}))},showFbConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@fb_name").text(a[0].name),this.$("#@fb_info").show()},showTwitterConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@tw_name").text("@"+a.twitter_screen_name),this.$("#@twitter_info").show()},showGoogleConnectedInfo:function(a){this.$("#@connected_info").show(),this.$("#@goog_name").text(a.name),this.$("#@goog_email").text(a.email),this.$("#@goog_info").show()},getOptionalArgs:function(){var a=this.$("#@fb_access_token").val(),b=this.$("#@tw_oauth_key").val(),c=this.$("#@goog_access_token").val();return{code:this.$("#@code").val(),group:this.$("#@group").val(),source_user_name:this.$("#@source_user_name").val(),source_url:this.$("#@source_url").val(),tid:this.tid,fb_access_token:a,fb_expires:this.$("#@fb_expires").val(),tw_oauth_key:b,google_access_token:c}},completeLogin:function(){this.inline_login||e.navigateTo(this.next_url||"/"),require("settings").pageMode=="post_reload"&&$(document).trigger("quora_login")},accountConnected:function(){},cancelClicked:function(){this.toggleStep1Header(!0),this.lookup("home_logged_out")&&(this.lookup("home_logged_out").$("#@contents").show(),this.lookup("home_logged_out").$("#@signup_form").hide())},onShowStepTwo:function(){this.toggleStep1Header(!1),this.serverCall("record_signup_step").kwargs({signup_action:"signup_show_step_two"}).send()},bypassConnectLink:function(){this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.onShowStepTwo(),this.$("#@name").focus()},toggleStep1Header:function(a){this.hide_step1_header_on_step2&&(a?(this.$("#@step_1_title").show(),this.$("#@connect_buttons").show()):(this.$("#@step_1_title").hide(),this.$("#@connect_buttons").hide()))},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@login_link":"onClickLoginLink","click #@create_account_link":"onClickCreateAccountLink","click #@cancel":"onClickCancel"},onClickBypassConnectLink:function(a){return this.bypassConnectLink(),!1},onClickTwitterSignupLink:function(a){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_twitter"}).send();var b=window.open("/twitter/oauth_window","_BLANK","height=400,width=800");return!1},onClickGoogleSignupLink:function(a){this.serverCall("record_signup_step").kwargs({signup_action:"signup_connect_to_google"}).send();var b=window.open("/google_/oauth_window","_BLANK","height=550,width=700");return!1},onClickLoginLink:function(a){this.$("#@step_1").addClass("hidden"),this.$("#@step_2").addClass("hidden"),this.$("#@login_form").removeClass("hidden")},onClickCreateAccountLink:function(a){this.$("#@step_1").removeClass("hidden"),this.$("#@login_form").addClass("hidden")},onClickCancel:function(a){return this.cancelClicked(),!1},onHomePageSignupFormLoad:function(){var a=e.getPathName(),b={};if(a=="/"||a=="/signup")b={path:a};this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit",funnel_args:b}).send(),this.no_associated_users&&this.serverCall("record_signup_step").kwargs({signup_action:"signup_homepage_visit_no_account",funnel_args:b}).send()}}),k=a.SignupFormExpanded=j.extend({cancelClicked:function(){this.toggleStep1Header(!0),this.lookup("home_logged_out")&&(this.lookup("home_logged_out").$("#@contents").show(),this.lookup("home_logged_out").$("#@signup_form_expanded").addClass("w3").removeClass("row")),this.child("facebook_connect_button").$("#@facebook_connect_button").show(),this.$("#@facebook_connected, #@google_connected, #@twitter_connected, #@connected_friends_list, #@connected_info, #@twitter_info, #@connected_photo_wrapper").hide(),this.$("#@step_2").addClass("hidden"),this.$("#@connect_option, #@connect_explanation, #@connect_option").show(),this.$("#@twitter_signup_link").show()},bypassConnectLink:function(){this.serverCall("record_signup_step").kwargs({signup_action:"bypass_connect_link"}).send(),this.$("#@connect_option").hide(),this.$("#@connect_explanation").hide(),this.$("#@step_2").removeClass("hidden"),this.onShowStepTwo(),this.accountConnected(),this.$("#@name").focus()}}),l=a.SignupFormBigButtons=k.extend({onLoad:function(){this._super.apply(this,arguments),this.onHomePageSignupFormLoad(),this.doingPasswordlessSignup=!1},accountConnected:function(){this.lookup("home_logged_out")&&this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,.15)},onShowStepTwo:function(){this._super.apply(this,arguments),this.$("#@step_1").hide(),this.setStepTwoTitle()},setStepTwoTitle:function(){var a=this.$("#@step_2_header_prefix").text(),b=this.$("#@name").val()==="",c=this.$("#@email").val()==="",d=this.$("#@password").val()==="";b||this.$("#@name").addClass("prefilled"),c||this.$("#@email").addClass("prefilled"),b&&c&&d||(c&&d?(a=this.blank_email_and_password_text,this.$("#@email").focus()):d&&(a=this.blank_password_text,this.$("#@password").focus())),this.$("#@step_2_header_prefix").text(a)},cancelClicked:function(){this._super.apply(this,arguments),this.$("#@step_1").show(),this.lookup("home_logged_out")&&this.lookup("home_logged_out").$("#@quora_explanation").fadeTo(1,1)},showFbConnectedInfo:function(a){this.$("#@connected_info").show()},showTwitterConnectedInfo:function(a){this.$("#@connected_info").show()},showGoogleConnectedInfo:function(a){this.$("#@connected_info").show()},registerKeyupCallbacks:function(){},showConnectedFriends:function(){},validateName:function(){return this.doingPasswordlessSignup?!0:this.$("#@name").val()===""?(this.child("name_validator").$("#@invalid_message").text(this.name_validation_text),this.child("name_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},validateEmail:function(){return this.doingPasswordlessSignup?!0:this.$("#@email").val()===""?(this.child("email_validator").$("#@invalid_message").text(this.email_validation_text),this.child("email_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},validatePassword:function(){return this.doingPasswordlessSignup?!0:this.$("#@password").val()===""?(this.child("password_validator").$("#@invalid_message").text(this.password_validation_text),this.child("password_validator").showErrorOnComponent("#@invalid_message"),!1):this._super.apply(this,arguments)},events:{"click #@bypass_connect_link":"onClickBypassConnectLink","click #@twitter_signup_link":"onClickTwitterSignupLink","click #@google_signup_link":"onClickGoogleSignupLink","click #@cancel":"onClickCancel","click #@name":"onClickName","click #@email":"onClickEmail"},onClickName:function(a){var b=this;b.$("#@name").removeClass("prefilled")},onClickEmail:function(a){var b=this;b.$("#@email").attr("readonly")||b.$("#@email").removeClass("prefilled")},onFacebookAccountConnected:function(a){this.doingPasswordlessSignup=!0;if(a&&a[0]){if(window.loginInProgress===!0)return;window.loginInProgress=!0,window.RESULTS=a,a[0].pic_big?(this.$("#@connected_pic").attr("src",a[0].pic_big),this.$("#@connected_pic").addClass("fb_photo")):this.$("#@connected_pic").hide(),a[0].contact_email&&this.$("#@email").val()===""&&this.$("#@email").val(a[0].contact_email),this.$("#@name").val()===""&&this.$("#@name").val(a[0].name),this.doSignup(),window.loginInProgress=!1}else{var b=window.console;b&&b.error&&b.error("Error retrieving data from Facebook."),this.serverCall("record_signup_step").kwargs({signup_action:"signup_facebook_api_failed"}).send()}},doSignup:function(){this.$("#@form").submit()}});a.SignupConnectedFriends=
d.extend({onLoad:function(){},events:{"click #@more_friends":"onClickMoreFriends"},onClickMoreFriends:function(a){var b=this;return b.dialog().title(b.dialog_title_text).cancel(null,b.dialog_close_text).html(b.dialog_desciption_text),!1}})},{"w2.context":!0,window_manager:!0,settings:!0,webnode2:!0,cookies:!0,facebook:!0,login:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/contact_importer",function(require,a,b){function i(a,b){var c=!1;return $.each(b,function(b,d){if(d.test(a)){c=!0;return}}),c}var c=require("settings"),d=require("google_"),e=require("w2.quora").Component,f=[/@yahoo\.(ca|cn|co\.id|co\.in|co\.jp|co\.kr|co\.nz|co\.uk|com|com\.ar|com\.au|com\.br|com\.cn|com\.hk|com\.mx|com\.my|com\.ph|com\.sg|com\.tr|com\.tw|com\.vn|de|dk|es|fr|gr|ie|it|no|pl|se)$/,/@ymail\.com$/,/@rocketmail\.com$/],g=[/@gmail\.com$/,/@googlemail\.com$/],h=[/@.*(hotmail|live|msn)\..+$/],j=a.ImportContactsForm=e.extend({prevEmail:null,isGoogleAppsEmail:!1,shouldLogImpression:!0,onLoad:function(){var a=this;this.isGoogleAppsEmail=this.is_google_apps_email,this.prevEmail=this.getEmail(),this.$("input[type=submit]").focus(),this.$("#@email").keyup(function(){a.prevEmail!=a.getEmail()&&(a.prevEmail=a.getEmail(),a.validateEmail())}),this.$("input[type=submit]").click(function(){return a.onSubmit()}),this.shouldLogImpression&&this.serverCall("log_impression").kwargs({email:this.getEmail()}).send()},submitForm:function(){this.$("#@contact_importer_form").submit()},updateAndSubmitForm:function(a,b){this.$("#@service").val(a),this.$("#@access_token").val(b),this.$("#@spinner").show(),this.submitForm()},onOAuthRejected:function(a){},onSubmit:function(){return this.openOAuthDialog(this.getEmail())?!1:!0},getEmail:function(){return $.trim(this.$("#@email").val())},lastTimeoutId:null,validateEmail:function(){var a=this.getEmail();if(!a)return this.onOAuthEmailEntered("empty"),!1;this.lastTimeoutId&&(clearTimeout(this.lastTimeoutId),this.lastTimeoutId=null);var b=i(a,f),c=i(a,g),d=i(a,h);this.isGoogleAppsEmail=!1,this.isGoogleAppsDomainCheckQueued=!1,b?this.onOAuthEmailEntered("yahoo"):c?this.onOAuthEmailEntered("gmail"):d?this.onOAuthEmailEntered("hotmail"):(this.onUnknownDomainEntered(),this.lastTimeoutId=setTimeout(this.fnbind(function(){this.checkGoogleAppsDomain()}),500))},onOAuthEmailEntered:function(a){},onUnknownEmailDomainEntered:function(){},isCheckingGoogleAppsDomain:!1,isGoogleAppsDomainCheckQueued:!1,checkGoogleAppsDomain:function(){if(this.isCheckingGoogleAppsDomain){this.isGoogleAppsDomainCheckQueued=!0;return}this.isCheckingGoogleAppsDomain=!0;var a=this.getEmail(),b=this;this.serverCall("is_google_apps_domain").kwargs({email:a}).success(function(c){c&&(b.isGoogleAppsEmail=!0),b.onCheckGoogleAppsDomainResponse(a,c),b.isCheckingGoogleAppsDomain=!1,b.isGoogleAppsDomainCheckQueued&&(b.isGoogleAppsDomainCheckQueued=!1,b.checkGoogleAppsDomain())}).send()},onCheckGoogleAppsDomainResponse:function(a,b){},logOAuthAttempt:function(a){this.serverCall("log_contact_importer_oauth_attempt").kwargs({email:a}).send()},onGoogleOAuthCallback:function(a){var b=this;if(a&&a.error===undefined){var c="google",d=a.access_token;b.updateAndSubmitForm(c,d)}else b.onOAuthRejected()},openOAuthDialog:function(a){var b=this;return i(a,f)?(b.logOAuthAttempt(a),window.open("/oauth/yahoo","_BLANK","height=400,width=800"),!0):i(a,g)||b.isGoogleAppsEmail?(b.logOAuthAttempt(a),d.onInit(function(){var a={callback:b.fnbind(b.onGoogleOAuthCallback),clientid:c.googleClientId,cookiepolicy:c.googleCookiePolicy,scope:b.scopes};b.prompt_ota_install&&(a.apppackagename=c.androidAppPackageName),window.gapi.auth.signIn(a)}),!0):i(a,h)?(b.logOAuthAttempt(a),window.open("/oauth/hotmail","_BLANK","height=600,width=1000"),!0):!1},getEmailDomain:function(a){return i(a,f)?"yahoo":i(a,g)||this.isGoogleAppsEmail?"google":i(a,h)?"hotmail":"other"}});a.OAuthFormSubmissionListener=e.extend({onLoad:function(){var a=this;$(document).bind("oauth_approved",function(b,c){var d=c.service,e=c.accessToken;a.lookup("contact_importer").updateAndSubmitForm(d,e)}),$(document).bind("oauth_rejected",function(b,c){var d=c.service;a.lookup("contact_importer").onOAuthRejected()})}}),a.SimpleImportContactsForm=j.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@contact_importer_form").submit(this.fnbind(this.onFormSubmit))},onFormSubmit:function(){return!this.child("submit").$("#@import_contacts").is(":disabled")},unsupportedMessageTimeoutId:null,clearUnsupportedMessageTimeout:function(){this.unsupportedMessageTimeoutId&&(clearTimeout(this.unsupportedMessageTimeoutId),this.unsupportedMessageTimeoutId=null)},onOAuthEmailEntered:function(a){this.$("#@spinner").hide(),this.$("#@email_import_error").hide(),this.$("#@unsupported_domain").hide(),this.$("#@form_error").hide(),this.enableSubmitButton(!0),this.clearUnsupportedMessageTimeout()},onUnknownDomainEntered:function(){this.$("#@spinner").show(),this.$("#@email_import_error").hide(),this.$("#@form_error").hide(),this.enableSubmitButton(!1),this.clearUnsupportedMessageTimeout()},onUnsupportedDomainEntered:function(){this.$("#@spinner").hide(),this.$("#@unsupported_domain").show(),this.$("#@email_import_error").show(),this.enableSubmitButton(!1)},onCheckGoogleAppsDomainResponse:function(a,b){if(this.getEmail()==a)if(!b){var c=this;this.unsupportedMessageTimeoutId=setTimeout(function(){c.onUnsupportedDomainEntered()},500)}else this.$("#@spinner").hide(),this.$("#@unsupported_domain").hide(),this.enableSubmitButton(!0)},enableSubmitButton:function(a){a?this.child("submit").$("#@import_contacts").attr("disabled",!1).removeClass("submit_button_disabled").addClass("follow_button"):this.child("submit").$("#@import_contacts").attr("disabled",!0).addClass("submit_button_disabled").removeClass("follow_button")}}),a.NuxDialogImportContactsForm=a.SimpleImportContactsForm.extend({shouldLogImpression:!1,onLoad:function(){var a=this;a._super.apply(a,arguments),a.$("#@change_email_link").click(function(){return a.$("#@default_email_container").hide(),a.$("#@change_email_container").show(),!1}),a.getEmailDomain(a.getEmail())=="other"&&a.onUnsupportedDomainEntered(),a.$("#@skip").click(function(){return a.serverCall("record_step").kwargs({step_name:"skip_oauth_dialog"}).success(function(){a.lookup("dialog_step").skipNextStep()}).send(),!1})},onOAuthRejected:function(a){this.serverCall("record_step").kwargs({step_name:"reject_oauth"}).send()},onSubmit:function(){var a=this._super.apply(this,arguments),b=!a;return b?this.serverCall("record_step").kwargs({step_name:"open_oauth",props:{domain:this.getEmailDomain(this.getEmail())}}).send():this.serverCall("record_step").kwargs({step_name:"invalid_import_domain"}).send(),a},submitForm:function(){var a=this.$("#@service").val(),b=this.$("#@access_token").val();return this.importContacts(this.getEmail(),a,b),!1},importContacts:function(a,b,c){var d=this;d.$("#@alt_spinner").show(),d.serverCall("import_contacts").kwargs({email:a,service:b,access_token:c}).liveMutate().success(function(){d.lookup("dialog_step").gotoNextStep()}).sendOnlyOnce()}})},{google_:!0,"w2.quora":!0,settings:!0})}),require.whenReady("settings",function(){require.install("app/view/growl",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=!1;a.GrowlBase=c.extend({onLoad:function(a){this.growl=this.$("#@growl"),this.age_sec<(a?1.5:15)&&this.show(!a),this.growl.mouseover(this.fnbind(function(a){this.growl.hasClass("fade_out")||(clearTimeout(this.hideTimer),this.growl.removeClass("fade_out"),this.customMouseOver())})),this.growl.mouseout(this.fnbind(function(a){this.hideAfter(1)})),this.hideAfter(this.visible_sec)},show:function(a){e&&(a=!1),e=!0,a&&this.growl.addClass("fade_in"),this.growl.removeClass("fade_out").removeClass("hidden"),a&&setTimeout(this.fnbind(function(){this.growl.removeClass("fade_in")}),200)},hideAfter:function(a){this.hideTimer=setTimeout(this.fnbind(function(){this.hide()}),a*1e3)},hide:function(){this.growl.addClass("fade_out"),setTimeout(this.fnbind(function(){this.growl.hasClass("fade_out")&&(this.growl.addClass("hidden").removeClass("fade_out"),e=!1)}),1250)},customMouseOver:function(){}}),a.ProductNotifGrowl=a.GrowlBase.extend({customMouseOver:function(){if(this.marked_as_read_sent)return;d.rpc("/notifications/mark_as_read_POST").kwargs({snid:this.snid}).send(),this.marked_as_read_sent=!0}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/notifications/base",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.Notif=c.extend({onLoad:function(){var a=this,b=this.$("#@notif a"),c=b.first();b.click(function(b){$(this).attr("href")=="#"&&b.preventDefault(),a.$("#@notif").hasClass("unseen")&&a.markAsSeen()}),this.onKeyCombination(c,"o",function(){var a=c.attr("href");c.click(),a!="#"&&d.navigateTo(a)}),this.actionBar&&this.$("#@content_toggle").click(this.fnbind(function(a){a.preventDefault(),this.$("#@notif_content").removeClass("hidden"),this.$("#@content_toggle").addClass("hidden")}))},markAsSeen:function(a){this.serverCall("mark_as_seen").liveMutate().send()}}),a.AggregatedNotif=c.extend({onLoad:function(){var a=this;this.initState("expanded",this.expanded),this.$("#@expand").click(function(){return a.state("expanded",!a.state("expanded")),!1}),this.$("#@mark").click(function(b){b.preventDefault(),a.markAsSeen()})},stateHandlers:{expanded:function(a){var b=this.lookup("list").$("#@notifs"),c=!b.hasClass("hidden");if(arguments.length<1)return c;b.toggleClass("hidden",!a)}},markAsSeen:function(){this.serverCall("mark_as_seen").liveMutate().send()}}),a.SentNotifCollectionViewBase=a.Notif.extend({})},{window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/notifications",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("app/view/notifications/base");a.NotificationsMain=c.extend({onLoad:function(){d.makeFixable(this.$("#@notifs_nav"),{min_width:990})}}),a.NotificationsClearButton=c.extend({onLoad:function(){this.$("#@clear").click(this.fnbind(function(){return this.serverCall("mark_as_seen").liveMutate().send(),!1}))}}),a.NotificationPreview=c.extend({onLoad:function(){this.$("#@details").click(this.fnbind(function(){return this.$("#@notification_details").toggleClass("hidden"),!1})),this.$("#@notification").click(this.fnbind(function(){return this.$("#@notification_diff").toggleClass("hidden"),this.$("#@notification, #@bullet").hide(),!1}))}}),a.UserFollowNotif=a.BoardItemUpvoteNotif=a.AnswerAgreeNotif=a.SubscriptionNewSubscriberToUserNotif=e.Notif.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.child("name")&&a.child("name").$("#@link").attr("href",a.responsibleUserUrl)}})},{"view/fixable2":!0,"app/view/notifications/base":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/notifications/header",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("view/toggle");a.TitleNotificationsCount=c.extend({onLoad:function(a){a||this.setTitle()},setTitle:function(){var a=d.getTitle(),b=a,c,e="",f;if(this.notif_count||this.inbox_count)e+="(",this.notif_count&&(e+=this.notif_count),this.inbox_count&&(e+="/"+this.inbox_count),e+=") ";b=a.replace(/^\(((\d+)?\/)?\d+\) |/,e),a!=b&&d.setTitle(b)}}),a.NextButton=e.ToggledComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.locked=!1,$(document).keydown(this.fnbind(function(a){return this.docKeydown(a)}))},gotoNext:function(){this.nextUrl&&d.navigateTo(this.nextUrl)},isLocked:function(){var a=!1;return $("input, textarea, .qtext_editor_content").each(function(){var b=$(this);if(b.attr("focused")=="true"||b.is(":focus"))return a=!0,!1}),this.locked||a},docKeydown:function(a){var b=a||window.event;if(this.isLocked())return!0;if(a.target.isContentEditable||a.target.nodeName=="INPUT"||a.target.nodeName=="TEXTAREA")return!0;if(b.keyCode==39)return this.gotoNext(),!1}})},{"view/toggle":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/navigation",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("view/hover_menu").HoverMenu,f=require("view/editable_list").EditableList;a.SettingsNavListContents=f.extend({onLoad:function(){this._super.apply(this,arguments),d.makeFixable(this.$("#@wrapper"),{min_width:990})}}),a.HomeNavList=f.extend({setEditLink:function(){var a=this.lookup("hover_menu").$("#@link");this.editLink=a}}),a.HomeNavListHoverMenu=e.extend({isInvalidCloseTarget:function(a){var b=this.$("#@menu"),c=this._super.apply(this,arguments);return c||a.parents().filter(b).length>0||a.hasClass("HomeNavListItem")||a.hasClass("remove_link")?!0:(this.shown&&this.parent().toggleEdit(),!1)}}),a.TrendingTopicsNavListItem=c.extend({onLoad:function(){var a=this;return this.$("#@tid").on("click",function(b){a.metaKey=b.metaKey,a.serverCall("log_click").success(function(){if(a.metaKey)return;window.location.href=a.uri}).error(function(){if(a.metaKey)return;window.location.href=a.uri}).send()}),!1}}),a.ReadLaterFilters=c.extend({onLoad:function(){d.makeFixable(this.$("#@filters"),{min_width:990})}})},{"view/fixable2":!0,"view/editable_list":!0,"view/hover_menu":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/user",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("cookies"),f=require("settings"),g=require("view/modal").Base,h=f.interface_strings;a.AcceptSuggestedSigButton=c.extend({onLoad:function(){this.$("#@accept").click(this.fnbind(this.accept))},accept:function(a){a.preventDefault(),this.serverCall("accept").liveMutate().sendOnlyOnce()}}),a.DiscardSuggestedSigButton=c.extend({onLoad:function(){var a=this;this.$("#@discard").on("click",function(b){a.discard(b)})},discard:function(a){a.preventDefault(),this.serverCall("discard").liveMutate().sendOnlyOnce()}}),a.ReviewSuggestedSigButton=c.extend({onLoad:function(){this.$("#@review").click(this.fnbind(this.review))},review:function(a){a.preventDefault(),a.stopPropagation(),this.modal("get_editor")}}),a.BioRequestNotifButton=c.extend({onLoad:function(){this.$("#@add_bio").click(this.fnbind(this.add))},add:function(a){a.preventDefault(),a.stopPropagation(),this.modal("get_editor")}}),a.UserTopicSig=c.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){return this.toggleSuggestion(),!1}));if(this.isFlagged){var a;this.isNotHelpful?a=this.not_helpful_tooltip:this.isNotStandalone&&(a=this.not_standalone_tooltip),this.$("#@sig").tooltip({contents:a})}},toggleSuggestion:function(){this.$("#@pending").toggle(),this.$("#@view").toggle()}}),a.TopicSigSelectionModal=g.extend({onLoad:function(){var a=this;a.input=a.$("#@input"),a.input.on("input",function(){var b=parseInt(a.max_length)-a.input.val().length;b<=a.warning_length?a.$("#@limit").text(b):a.$("#@limit").text("")});var b=a.input.val();a.input.focus(),a.input.val(""),a.input.val(b);var c=parseInt(a.max_length)-a.input.val().length;c<=a.warning_length?a.$("#@limit").text(c):a.$("#@limit").text(""),a._super.apply(a,arguments)},onSubmit:function(){this.submitSig()},submitSig:function(){var a=this,b=this.$("#@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:b}).liveMutate().send(),a._closeModal()}}),a.TopicSelectionForQuestionModal=a.TopicSigSelectionModal.extend({submitSig:function(){var a=this,b=this.$("#@checkbox").is(":checked");this.serverCall("update_sig").kwargs({to_uid:this.to_uid,tid:this.tid,sig:this.input.val(),experienced:b}).success(function(){a.modal("load_multi_topic_selection_modal_for_question")}).liveMutate().send()},onCancel:function(){this.modal("load_multi_topic_selection_modal_for_question")}}),a.UserBioSelectionModal=g.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.input=a.$("#@input");var b=a.input.val();a.input.on("input",function(){var b=parseInt(a.max_length)-a.input.val().length;b<=a.warning_length?a.$("#@limit").text(b):a.$("#@limit").text("")}),this.input.focus(),this.input.val(""),this.input.val(b);var c=parseInt(a.max_length)-a.input.val().length;c<=a.warning_length?a.$("#@limit").text(c):a.$("#@limit").text("")},onSubmit:function(){var a=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){a._closeModal()}).liveMutate().send()}}),a.UserBioInMultiTopicBioModal=a.UserBioSelectionModal.extend({onSubmit:function(){var a=this;this.serverCall("update_sig").kwargs({sig:this.input.val()}).success(function(){a.modal("load_multi_topic_selection_modal_for_question")}).send()},onCancel:function(){this.modal("load_multi_topic_selection_modal_for_question")},onClose:function(){this.modal("load_multi_topic_selection_modal_for_question")}}),a.SuggestedTopicModal=g.extend({onLoad:function(){var a=this;a.input=this.$("#@input"),a.text=a.input.val(),a.canEdit=a.viewer==a.uid,a.input.on("input",function(){var b=parseInt(a.max_length)-a.input.val().length;b<=a.warning_length?a.$("#@limit").text(b):a.$("#@limit").text("")}),a.input.focus(),a.input.val(""),a.input.val(this.text);var b=parseInt(a.max_length)-a.input.val().length;b<=a.warning_length?a.$("#@limit").text(b):a.$("#@limit").text(""),a._super.apply(this,arguments)},acceptSig:function(){var a=this,b=this.$("#@checkbox").is(":checked");this.serverCall("accept").liveMutate().kwargs({experienced:b}).success(function(){a._closeModal()}).send()},discardSig:function(){this.serverCall("discard").liveMutate().send()},onSubmit:function(){this.canEdit&&this.input.val()==this.text?this.acceptSig():this.submitSig()},submitSig:function(){var a=this,b=this.$("#@checkbox").is(":checked");return this.serverCall("update_sig").liveMutate().kwargs({viewer:this.viewer,sig:this.input.val(),experienced:b}).success(function(){a._closeModal()}).send(),!1},onCancel:function(){this.discardSig(),this._closeModal()},onClose:function(){this._closeModal()}}),a.QuestionUserSigEditLink=a.UserSigEditLinkDialog=a.TopicSigEditLinkDialog=c.extend({onLoad:function(){this.$("#@link").click(this.fnbind(function(){return this.showDialog(),!1}))},showDialog:function(){return this.modal("get_editor"),!1}}),a.LinkBioListItem=c.extend({onLoad:function(){var a=this;a.tid===0?this.$("#@link").on("click",function(){return a.showDialog(),!1}):this.$("#@link").on("click",function(){return a.modal("load_modal"),!1})},showDialog:function(){return this.modal("get_editor"),!1}}),a.QuestionTopicSigEditLink=c.extend({onLoad:function(){var a=this;this.$("#@link").on("click",function(){return a.modal("load_modal"),!1})}}),a.SetTopicForQuestionLinkSpan=c.extend({onLoad:function(){var a=this,b=a.lookup("bio_list_item");b&&b.$("#@bio_list_item").click(function(){a.$("#@radio")&&(a.unselectAll(),a.setBio())}),a.$("#@radio").click(function(b){a.unselectAll(),a.setBio(),b.stopPropagation()})},unselectAll:function(){var a=$(".SetTopicForQuestionLinkSpan input[type=radio]");for(var b=0;b<a.length;b++){a[b].checked=!1;var c=this.lookup("bio_list_item");c&&c.$("#@bio_list_item").removeClass("selected")}},setBio:function(){this.$("#@radio").checked=!0;var a=this.lookup("bio_list_item");a&&(a.$("#@bio_list_item").addClass("selected"),this.serverCall("set_bio").liveMutate().send())}}),a.ProfileBioListItem=c.extend({onLoad:function(){if(this.isFlagged){var a;this.isNotHelpful?a=this.not_helpful_tooltip:this.isNotStandalone&&(a=this.not_standalone_tooltip),this.$("#@sig").tooltip({contents:a})}}}),a.ProfilePhoto=c.extend({toggleSuggestion:function(){this.$("#@view_pending").toggleClass("hidden"),this.$("#@pending").toggleClass("hidden");var a=this.parent().$("#@user_action_link");$(this.$("#@pending")).is(":visible")?a.addClass("w1").removeClass("w1_5"):a.removeClass("w1").addClass("w1_5")}}),a.WantedAnswerDialog=require("dialog").Dialog.extend({onLoad:function(a){this._super.apply(this,arguments),this.child("question_selector").focus(),this.setSuccessCallback(this.fnbind(function(a){a&&d.navigateTo(a)}))},getPars:function(){var a=this.child("question_selector").getQid(),b=this.child("question_selector").qValue;return{qid:a,text:b}}}),a.UserFollowLink=c.extend({onLoad:function(){this.$("#@follow_user").click(this.fnbind(function(a){this.follow(),a.preventDefault()})),this.$("#@unfollow_user").click(this.fnbind(function(a){this.unfollow(),a.preventDefault()})),this.onKeyCombination(this.$("#@follow_user"),"f",this.fnbind(this.follow)),this.onKeyCombination(this.$("#@unfollow_user"),"f",this.fnbind(this.unfollow))},follow:function(){e.setQfeedLog(this,"UserFollow"),e.setQueryLog(this,"UserFollow"),e.setTlog({type:"UserFollow",uid:this.uid}),this.serverCall("follow_user").liveMutate().send()},unfollow:function(){e.setQfeedLog(this,"UserUnfollow"),e.setQueryLog(this,"UserUnfollow"),e.setTlog({type:"UserUnfollow",uid:this.uid}),this.serverCall("unfollow_user").liveMutate().send()}}),a.UserSig=c.extend({onLoad:function(){this.$("#@view").click(this.fnbind(function(){return this.toggleSuggestion(),!1}))},toggleSuggestion:function(){this.$("#@pending").toggle(),this.$("#@view").toggle()}}),a.BatchRevertControls=c.extend({onLoad:function(){this.$("#@select_all_check").change(this.fnbind(function(a){return this.toggleCheckboxes(),!1})),this.$("#@select_all_word").click(this.fnbind(function(a){return this.toggleCheckboxes(),!1})),this.$("#@revert").click(this.fnbind(function(){return this.batchRevert(),!1}))},batchRevert:function(){var a=[];return this.$(".user_log_operations_to_revert input:checked").each(function(b){a.push($(this).attr("name"))}),a.length===0?!1:(this._dialog=this.dialog().title(this.dialog_title).cancel(null,h.cancel).ok(this.fnbind(function(b){var c=b.dialogComponent,d=c.lookup("editor");if(d.isEmpty())return;var e=d.serialize();this.serverCall("batch_revert").kwargs({revert_strings:a,comment:e}).liveMutate().send()})).load("batch_revert_dialog"),!1)},toggleCheckboxes:function(){var a=this.$(".user_log_operations_to_revert .pagedlist_hidden input:not(:disabled)").length,b=this.$(".user_log_operations_to_revert input:not(:disabled)").length-a,c=this.$(".user_log_operations_to_revert input:checked").length;b!=c?(this.$("#@select_all_check").attr("checked",!0),this.$("input:not(:disabled)").attr("checked",!0),this.$(".user_log_operations_to_revert .pagedlist_hidden input").each(function(a){$(this).attr("checked",!1)})):(this.$("#@select_all_check").attr("checked",!1),this.$("input:not(:disabled)").attr("checked",!1))},getKwargs:function(a,b){return{revert_strings:a,comment:b.serialize()}}}),a.UnconfirmedEmailBlockedEditor=c.extend({onLoad:function(){this.$("#@resend").click(this.fnbind(function(){return this.serverCall("resend_email_confirmation").send(),!1}))}})},{cookies:!0,window_manager:!0,settings:!0,"view/modal":!0,dialog:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/query/query",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("action_log"),f=require("event").add,g=require("w2.context").AnswerVoteContext,h=a.QueryResult=e.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments),this.setDvar("query_id",this.query_id),this.setDvar("index",this.index);var a="_blank";this.compact&&(a="_parent"),this.$('#@title a[href!="#"], #@content a[href!="#"]').attr("target",a),this.reportTidsToParent(),this.checkHighlight(),this.unseen.bound||(f(document,"scroll",this.fnbind(this.recordPrivateViews)),setTimeout(this.fnbind(this.recordPrivateViews),400),this.unseen.bound=!0),this.unseen.items[this.cid]=this,this.view_item=[this.type,this.object_id]},reportTidsToParent:function(){},navigateToObject:function(){var a=this.$("#@title a").attr("href");window.open(a,"_parent")},checkHighlight:function(){var a=this.$("#@title")[0],b=this.$("#@content")[0],c=a.innerHTML+b.innerHTML;c.indexOf("matched_term")<0&&this.serverCall("log_highlight_error").send()},unseen:{bound:!1,items:{},lastCheckTime:0,rateLimit:500},recordPrivateViews:function(){var a=+(new Date);if(a<this.unseen.lastCheckTime+this.unseen.rateLimit)return;this.unseen.lastCheckTime=a;var b=[],c=[];for(var d in this.unseen.items){var e=this.unseen.items[d];e.$("#@item").is(":in-viewport")&&(b.push(e),c.push(e.view_item),delete this.unseen.items[d])}b.length>0&&b[0].serverCall("log_private_views").kwargs({view_items:c}).send()}});a.QuestionQueryResult=h.extend({reportTidsToParent:function(){this.lookup("query_results").storeQuestionTids(this.tids)}}),a.TopicQueryResult=h.extend({reportTidsToParent:function(){this.index===0&&this.lookup("query_results").storeHighlightedTid(this.object_id)}}),a.QueryResultRankingMetadata=c.extend({onLoad:function(){this.$("#@metadata").click(this.fnbind(function(){var a=this.$("#@metadata").parent().hasClass("expanded");this.$(".metadata").parent().removeClass("expanded"),a||this.$("#@metadata").parent().addClass("expanded")}))}}),a.QueryResults=c.extend({contextConstructor:function(){return g},onLoad:function(a){this.storedResultTids=[],this.highlightedTid=null,this.haveUpdatedAddQuestionInSidebar=!1,this.$("#@create_topic_link").click(this.fnbind(function(){return this.showDialog("create_topic_dialog"),!1})),d.makeFixable(this.$("#@sidebar_add_question"))},showDialog:function(a,b){this._dialog=this.dialog().load(a,{kwargs:{tid:this.getPrimaryTid()}})},storeQuestionTids:function(a){this.storedResultTids=this.storedResultTids.concat(a),this.updateAddQuestionInSidebar()},storeHighlightedTid:function(a){this.highlightedTid||(this.highlightedTid=a),this.updateAddQuestionInSidebar()},updateAddQuestionInSidebar:function(){if(this.showing_add_question_in_sidebar&&!this.haveUpdatedAddQuestionInSidebar){var a=this.getPrimaryTid();this.lookup("add_question_simple").replaceContextEditor(a),this.haveUpdatedAddQuestionInSidebar=!0}},getPrimaryTid:function(){if(this.highlightedTid)return this.highlightedTid;var a=this.storedResultTids,b={},c;for(var d=0;d<a.length;d++)c=a[d],b[c]?b[c]=b[c]+1:b[c]=1;var e=-1,f=-1,g;for(var h=0;h<a.length;h++)c=a[h],g=b[c],g>f&&(e=c,f=g);return f>=this.tid_prepopulate_threshold?e:null}})},{"w2.context":!0,"view/fixable2":!0,action_log:!0,event:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/query/selector",function(require,a,b){function f(a){return a.replace(/ /g,"+")}var c=require("w2.quora").Component,d=require("window_manager"),e=require("view/selector").Selector;a.FullTextSearchInput=e.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.$instruction=a.$("#@instruction"),a.busySpinnerConfig={length:4,width:1,radius:5}},resultWasSelected:function(a){d.navigateTo(f(a.data.url))},submit:function(){d.navigateTo("/search?q="+f(this.$input.val()))}})},{"view/selector":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/filter_nav_list",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager");a.FilterNavListItem=c.extend({onLoad:function(){var a=this;this.$("#@item").on("click",function(){var b=$(this);if(b.hasClass("selected"))return!1;var c=b.attr("value");return a.updateDataAndReloadList(a.data_key,c),!1})},updateDataAndReloadList:function(a,b){var c=d.parseURLParams(location.search.substring(1).replace(/\+/g,"%20"));c[a]=b;for(var e in c)(c[e]==="all"||c[e]==="")&&delete c[e];var f=$.param(c);window.location=window.location.pathname+"?"+f}}),a.FilterMultipleValuesNavListBase=c.extend({updateDataAndReloadList:function(a){var b=$.param(a);window.location=window.location.pathname+"?"+b},addFilterToKey:function(a){var b=this.data_key,c=d.parseURLParams(location.search.substring(1).replace(/\+/g,"%20")),e=[];c[b]=="followed"&&delete c[b],c[b]&&(e=c[b].split(" "));if(e.length===0)c[b]=a;else{e.push(a);var f=e.join(" ");c[b]=f}this.updateDataAndReloadList(c)},removeFilterFromKey:function(a){var b=this.data_key,c=d.parseURLParams(location.search.substring(1).replace(/\+/g,"%20")),e=c[b].split(" "),f=e.indexOf(a);if(f>-1){e.splice(f,1);var g=e.join(" ");c[b]=g}for(var h in c)(c[h]==="all"||c[h]==="")&&delete c[h];this.updateDataAndReloadList(c)}}),a.FilterMultipleValuesNavListItemBase=c.extend({onLoad:function(){var a=this;a.$("#@remove").click(function(){return a.lookup("multiple_value_list").removeFilterFromKey(a.filter_value.toString()),!1})}})},{window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/query/filters",function(require,a,b){var c=require("w2.quora").Component,d=require("view/fixable2"),e=require("view/filter_nav_list");a.SearchFilters=c.extend({onLoad:function(){var a=this;d.makeFixable(a.$("#@sidebar_filters"),{min_height:a.$("#@sidebar_filters").outerHeight()+a.$("#@sidebar_filters").offset().top,min_width:990})}}),a.SearchFilterAuthorList=e.FilterMultipleValuesNavListBase.extend({setTo:function(a){this.lookup("people_selector").reset(),this.addFilterToKey(a)}})},{"view/fixable2":!0,"view/filter_nav_list":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/suggestions",function(require,a,b){var c=require("w2.quora").Component,d=require("action_log");a.FollowSuggestionCard=d.ActionableComponent.extend({onLoad:function(){this._super.apply(this,arguments);var a=this,b=!1,c=a.$("#@actionable").parent();c.mouseleave(a.fnbind(function(){b===!0&&(c.fadeOut(),a.serverCall("follow").liveMutate().send())})),a.$("#@follow").click(a.fnbind(function(c){c.preventDefault(),a.$("#@follow, #@unfollow").toggle(),b=!0})),a.$("#@unfollow").click(a.fnbind(function(c){c.preventDefault(),a.$("#@follow, #@unfollow").toggle(),b=!1}))}})},{action_log:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/user_stats",function(require,a,b){var c=require("w2.quora").Component,d=require("view/hover_menu").HoverMenu;a.StatsMain=c.extend({show:function(){this.$("#@stats_main").removeClass("fade_in")},updateGraph:function(a){a||(a=this.content_type),this.child("graphs_section").updateGraphs(a,this.interval_type,this.oid)},updateContentList:function(){this.serverCall("render_new_content_list_wrapper").args(this.content_type,this.interval_type).contentFor(this.$("#@stats_side"),{parentCID:this.cid}).send()},updateAttributes:function(a){var b=!1,c=!1;if("oid"in a&&this.oid!=a.oid){this.oid=a.oid,b=!0;if(this.content_type===4){this.updateGraph(a.content_type);return}}"interval_type"in a&&(a.interval_type=parseInt(a.interval_type),this.interval_type!=a.interval_type&&(this.interval_type=a.interval_type,b=!0,c=!0)),"content_type"in a&&(a.content_type=parseInt(a.content_type),this.content_type!=a.content_type&&(this.content_type=a.content_type,b=!0,c=!0)),b&&this.updateGraph(),c&&this.updateContentList()}}),a.Filter=d.extend({registerClickHandlers:function(){var a=this;this._super.apply(this,arguments),this.$("%@option").click(function(b){a.updateAttributes($(b.target).attr("name")),a.$("#@link").text($(b.target).text()),$(b.target).parent().siblings().removeClass("selected"),$(b.target).parent().addClass("selected"),b.preventDefault()})},updateAttributes:function(){}}),a.FilterIntervalType=a.Filter.extend({updateAttributes:function(a){this.lookup("stats_main").updateAttributes({interval_type:a,oid:null})}}),a.FilterContentType=a.Filter.extend({updateAttributes:function(a){this.lookup("stats_main").updateAttributes({content_type:a,oid:null})}}),a.ContentListWrapper=c.extend({onLoad:function(){var a=this.$("#@content_list_wrapper"),b=a.outerHeight(),c=$(window).height(),d=a.offset().top,e=c-d-32;e>b&&a.css("height",e),this.lookup("stats_main").show()}}),a.ContentListItem=c.extend({onLoad:function(){var a=this;this.$("#@link").click(this.fnbind(function(){this.$("#@link").hasClass("is_active")||(a.$(".is_active").removeClass("is_active"),this.$("#@link").addClass("is_active")),this.lookup("stats_main").updateAttributes({oid:this.oid,content_type:this.content_type})}))}}),a.RSGraph=c.extend({onLoad:function(){var a=new Rickshaw.Color.Palette({scheme:this.colors});for(var b in this.data_json)this.data_json[b].color=a.color();var c=new Rickshaw.Graph({element:this.$("#@rsgraph").get(0),series:this.data_json,width:this.width,height:this.getHeight(),renderer:"bar",stroke:!0,min:this.min,max:this.max,xmin:this.xmin,xmax:this.xmax,interpolation:"step-after"});c.render();var d=new Rickshaw.Graph.Axis.Y({graph:c,tickFormat:this.ypercent?function(a){return(a*100).toFixed(1)+"%"}:null});d.render();var e=new Rickshaw.Graph.Axis.Time({graph:c});e.render();var f=new Rickshaw.Graph.HoverDetail({graph:c})},getHeight:function(){var a=$(window)
.height(),b=$(".graphs").offset().top,c=a-b-32;return c>this.height?c:this.height}}),a.Graphs=c.extend({onLoad:function(){var a=window.location.hash;this.metrics.forEach(this.fnbind(function(a){this.child("headsup_section").$("#@"+a).click(this.fnbind(function(b){var c=$(b.target);return c.hasClass("heads_up_item")||(c=c.parents(".heads_up_item")),c.hasClass("is_active")||(c.siblings(".is_active").removeClass("is_active"),c.addClass("is_active")),this.active_metric!=a&&(this.$(".stats_graph").hide(),this.child("stats_graphs").$("#@graph_"+a).fadeIn(500),this.active_metric=a),b.preventDefault(),!1}))})),this.metrics.forEach(this.fnbind(function(b){"#"+b==a&&this.child("headsup_section").$("#@"+b).click()}))},updateGraphs:function(a,b,c){this.serverCall("render_new_graphs").args(a,b,c).contentFor(this.$("#@graphs"),{parentCID:this.cid}).send(),this.serverCall("get_new_counts").args(a,b,c).success(this.fnbind(function(a){a.forEach(this.fnbind(function(a){a[1]===null?this.child("headsup_section").$("#@"+a[0]).hide():(this.child("headsup_section").$("#@"+a[0]).show(),this.child("headsup_section").$("#@"+a[0]+">.big_num").text(a[1]),this.child("headsup_section").$("#@"+a[0]+">.num_label").text(a[2])),$(".heads_up_item").first().addClass("is_active")}))})).send()}})},{"view/hover_menu":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/user/content",function(require,a,b){var c=require("webnode2"),d=require("event"),e=d.add,f=d.remove,g=require("w2.quora").Component;a.UserContentMain=g.extend({onLoad:function(){this.$("#@toggle_filters").click(this.fnbind(function(){return this.$("#@filters").toggle(),!1}))},getUrlVars:function(){var a={},b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d});return a},updateDataAndReloadList:function(a,b){var c=this.getUrlVars();c[a]=b;for(var d in c)c[d]===null&&delete c[d];var e=$.param(c);window.location=window.location.pathname+"?"+e}}),a.UserContentFilter=g.extend({onLoad:function(){this.configureLinks()},configureLinks:function(){var a=this,b=this.$("#@filter_links a");this.$("#@filter_links a").click(function(){var b=$(this);if(b.hasClass("selected"))return!1;var c=b.attr("value");return a.lookup("user_content_main").updateDataAndReloadList(a.data_key,c),!1})}}),a.UserContentFilterTopics=a.UserContentFilter.extend({configureLinks:function(){this.$("#@all_topics").click(this.fnbind(function(){return this.$("#@all_topics").hasClass("selected")||this.clearChosenTopic(),!1})),this.$("#@remove_chosen_topic").click(this.fnbind(function(){return this.clearChosenTopic(),!1}))},clearChosenTopic:function(){this.lookup("user_content_main").updateDataAndReloadList(this.data_key,null)},tempTopicChosen:function(a,b){this.$("#@chosen_topic").text(b),this.$("#@chosen_topic_link_row").show(),this.$("#@topic_selector_row").hide(),this.$("#@all_topics").removeClass("selected"),this.lookup("user_content_main").updateDataAndReloadList(this.data_key,a)}})},{webnode2:!0,event:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/user/subscribe",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.UserSubscribeLink=c.extend({onLoad:function(){var a=this;a.button=a.$("#@user_subscribe_button"),a.button.click(function(b){a.modal("load_inner",{kwargs:{should_show_subscribe:a.canSubscribe(),subscribe_to_uid:a.uid}}),b.preventDefault()})},canSubscribe:function(){return!this.button.hasClass("unsubscribe_button")}}),a.SubscribeConfirmModal=d.extend({onSubmit:function(){this.serverCall("change_subscription").liveMutate().success(this.fnbind(function(){this._closeModal()})).send()}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/site_header/logged_in",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("view/hover_menu"),f=require("cookies"),g=require("siteuri").URI;a.LoggedInSiteHeader=c.extend({shortcuts:{"Ctrl-Alt-h":"/","Ctrl-Alt-m":"/messages","Ctrl-Alt-n":"/notifications","Ctrl-Alt-w":"/write"},onShortcut:function(a){var b=g(this.shortcuts[a]).absolute();d.navigateTo(b)},onLoad:function(){for(var a in this.shortcuts)this.onKeyCombination(document.body,a,this.onShortcut.bind(this,a))}}),a.NotifsNavItemBase=e.HoverMenu.extend({isInvalidCloseTarget:function(a){var b=this.$("#@link"),c=this.$(".SiteHeaderHoverMenuContents");return a.is(b)||a.parents(b).is(b)||a.is(c)||a.parents(c).is(c)?!0:!1}}),a.NotifsHoverMenuContents=c.extend({onLoad:function(){var a=this.$("#@hover_menu_header_link"),b=this.$("#@dropdown");b.scroll(function(){b.scrollTop()>0?a.addClass("has_shadow"):a.removeClass("has_shadow")})}}),a.MobileSiteLink=c.extend({onLoad:function(){this.$("#@mobile_link").click(this.fnbind(function(){return f.cookie("m","1"),location.reload(!0),!1}))}})},{cookies:!0,siteuri:!0,"view/hover_menu":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/site_header/logged_out",function(require,a,b){var c=require("w2.quora").Component,d=require("settings");a.LoggedOutSiteHeader=c.extend({onLoad:function(){var a=this,b=d.controller,c=d.action;a.$("#@signup").click(function(){return a.serverCall("attempt_login").liveMutate().send(),!1}),a.$("#@login").click(function(){return window.loginIntent=!0,a.serverCall("attempt_login").liveMutate().send(),!1}),a.$("#@ask_question").click(function(){return window.askQuestionIntent=!0,a.serverCall("attempt_login").liveMutate().send(),a.serverCall("log_ask_question_attempt").kwargs({page_controller:b,page_action:c,url:window.location.pathname}).send(),!1})}})},{settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/intro_to_quora",function(require,a,b){var c=require("webnode2"),d=require("w2.quora").Component,e=a.ITQSidebar=d.extend({onLoad:function(){var a=this;a.stepHandler=function(b){a.nextStep(b)},a.introToQuoraSidebar=a.$("#@intro_to_quora_sidebar"),a.activeInstruction=a.$(".sidebar_step_show"),a.highlight(a.currStep),a.scrollToStory(a.currStep),a.$("#@close").one("click",function(){a.cancel()}),a.$("div[sidebar-selector=next_step]").one("click",function(){a.nextStep()}),a.$("div[sidebar-selector=opt_out]").one("click",function(){a.cancel()}),a.serverCall("log_impression").send()},nextStep:function(){var a=this;a.activeInstruction=a.activeInstruction.next(),a.activeInstruction.length!==0?(a.activeInstruction.prev().hide(0),a.activeInstruction.show(0),a.currStep++,a.highlight(a.currStep),a.scrollToStory(a.currStep),a.serverCall("complete_step").kwargs({step_num:a.currStep}).send()):(a.serverCall("complete_itq").liveMutate().send(),a.close())},highlight:function(a){this.clearHighlight();var b={pinned_topics:{selector:".HomeNavList"},upvote:{selector:".add_upvote"},follow:{selector:".itq_follow"},answer:[{selector:".answer_editor"},{selector:".write_answer"}],ask:{selector:".AddQuestionDialogButton",noticeSuffix:"_bottom_left"}};a=a.toString();var c=this.stepMap[a];if(c in b){var d=b[c];Array.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){var f=d[e],g="itq_notice_bubble",h=f.selector;typeof f.noticeSuffix!="undefined"&&(g+=f.noticeSuffix),$(h).addClass(g),$(h).one("click",this.stepHandler)}}c==="ask"&&this.introToQuoraSidebar.addClass("intro_to_quora_sidebar_point_up")},clearHighlight:function(){var a=["","_bottom_left","_smaller"];for(var b=0;b<a.length;b++){var c="itq_notice_bubble"+a[b];$("."+c).unbind("click",this.stepHandler),$("."+c).removeClass(c)}this.introToQuoraSidebar.removeClass("intro_to_quora_sidebar_point_up")},selectStory:function(a){var b={upvote:"a.add_upvote",follow:"a.itq_follow",answer:"a.write_answer"},c=null,d=this.stepMap[a.toString()];if(d in b){c=b[d],Array.isArray(c)&&(c=c.join(","));var e=$(".pagedlist_item").has(c),f=null;for(var g=0;g<e.length;g++){var h=$(e[g]),i=h.offset().top-$(window).scrollTop();$(window).scrollTop()?i-=$(".SiteHeader").height():i-=$(".Feed").offset().top;if(i>=0)return h;f=h}return f}return null},scrollToStory:function(a){var b=this,c=b.selectStory(a);if(c===null)return;if(c.prev(".pagedlist_item").length===0)$("body").animate({scrollTop:0},1e3);else{var d=c.prev(".pagedlist_item"),e=d.offset().top+d.height()-$(".SiteHeader").height();$("body").animate({scrollTop:e},1e3)}},close:function(){var a=this;a.clearHighlight(),a.$(".sidebar_title").css("white-space","nowrap"),a.introToQuoraSidebar.animate({opacity:0},1e3),a.introToQuoraSidebar.addClass("hidden")},cancel:function(){this.serverCall("cancel_itq").liveMutate().send(),this.close()}})},{webnode2:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("shared_utils",function(require,a,b){var c=require("settings").interfaceLanguage,d=a.SECOND=1e3,e=a.MINUTE=60*d,f=a.HOUR=60*e,g=a.DAY=24*f,h={en:{monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],timeAbbrevs:["d","h","m","s"],justNow:"just now",yesterday:"yesterday",agoTemplate:"{time} ago",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"},es:{monthNames:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],timeAbbrevs:["d","h","m","s"],justNow:"ahora mismo",yesterday:"ayer",agoTemplate:"Hace {time}",dayMonthTemplate:"{day} {month}",dayMonthYearTemplate:"{day} {month} {year}"}},i=h[c],j=function(a,b){return a.replace(/\{([^{}]*)\}/g,function(a,c){return b[c]})},k=function(a,b){var c=new Array(4),h=[g,f,e,d],j=i.timeAbbrevs,k;for(k=0;k<c.length;++k)c[k]=Math.floor(a/h[k]),a-=c[k]*h[k];var l=0;while(l<c.length&&!c[l])++l;var m=c.length-1;while(m>=0&&h[m]<b)--m;var n="";for(k=l;k<=m;++k)n+=c[k].toString()+j[k],k<m&&(n+=" ");return n};a.timestampStr=function(a,b){var c=new Date,h=new Date(a/1e3),l=c.getTime()-h.getTime(),m;if(l<0)return l>=-2*d?i.justNow:h.toLocaleDateString("en",{weekday:"short",year:"numeric",month:"short",day:"numeric"});if(b){m=k(l,b);if(m)return j(i.agoTemplate,{time:m})}if(l<e)return i.justNow;if(l<f){var n=Math.floor(c.getTime()/e)-Math.floor(h.getTime()/e);return m=n.toString()+i.timeAbbrevs[2],j(i.agoTemplate,{time:m})}if(l<12*f||l<g&&c.getDate()==h.getDate()){var o=Math.floor(c.getTime()/f)-Math.floor(h.getTime()/f);return m=o.toString()+i.timeAbbrevs[1],j(i.agoTemplate,{time:m})}var p=new Date;p.setDate(c.getDate()-1);if(l<2*g&&h.getDate()==p.getDate())return i.yesterday;if(l<31*g&&c.getMonth()==h.getMonth()){var q=Math.floor(c.getTime()/g)-Math.floor(h.getTime()/g);return m=q.toString()+i.timeAbbrevs[0],j(i.agoTemplate,{time:m})}return h.getFullYear()==c.getFullYear()?j(i.dayMonthTemplate,{day:h.getDate().toString(),month:i.monthNames[h.getMonth()]}):j(i.dayMonthYearTemplate,{day:h.getDate().toString(),month:i.monthNames[h.getMonth()],year:h.getFullYear()})}},{settings:!0})}),require.whenReady("settings",function(){require.install("app/view/question/question_add",function(require,a,b){function g(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var c=require("w2.quora").Component,d=require("webnode2"),e=require("cookies"),f=require("window_manager"),h=a.AddQuestionInline=c.extend({onLoad:function(){this.editor=this.lookup("navigator"),this.lookup("navigator").$("#@input").focus(this.fnbind(function(){this.$("#@wrapper").addClass("expanded")})),this.lookup("navigator").$("#@input").keydown(this.fnbind(function(){this.$("#@add").removeClass("disabled"),this.$("#@topic_section").fadeIn(250)})),this.setupAddClick(),this.disabled=!1},focusQuestionBox:function(){this.editor.focus(!0)},setupAddClick:function(){this.$("#@add").click(this.fnbind(function(){return this.addQuestion(),!1}))},checkSubmitStatus:function(){this.add_request_pending||this.minLength&&this.lookup("editor").valLength()<this.minLength?($(".dialog .submit_button").addClass("submit_button_disabled"),this.disabled=!0):($(".dialog .submit_button").removeClass("submit_button_disabled"),this.disabled=!1)},isDefaultText:function(){return this.lookup("editor").html().slice(0,this.default_text.length)==this.default_text},setFocusCallback:function(a){this.lookup("editor").setFocusCallback(a)},fixQuestion:function(a){this.$("#@fixit").show(),this.$("#@text").html(a),this.attempts++,this.attempts>1&&this.$("#@skip").show()},questionAddedCallback:function(a){var b=a[0];f.sameDomainURL(b)&&f.navigateTo(b),d.Dialog.openerFor(this).closeDialog()},addQuestionClickedCallback:function(a){},isPrivate:function(){return this.getDistribution()===0?1:0},expand:function(){if(this.expanded)return;this.$("#@editor_row").addClass("form_row"),this.$("#@form_buttons").removeClass("hidden"),this.$("#@form_option_row").removeClass("hidden"),this.focus(),this.expanded=!0},clear:function(){this.lookup("editor").clear(),this.$("#@question_privacy").attr("checked",!1)},select:function(){this.lookup("editor").selectAll()},getKwargs:function(){var a={question:this.getQuestionText(),is_private:this.isPrivate(),topic_names:this.lookup("topic_section").getTopicNames(),unselected_topic_names:this.lookup("topic_section").getUnselectedTopicNames(),context_topic_name:this.getContextTopicName()};return a},getContextTopicName:function(){return this.$("#@context_topic_section").find('input[name="tidsugg_null"]').val()},getQuestionText:function(){return this.lookup("navigator").$("#@input").val()},getDistribution:function(){var a=this.lookup("anon_checkbox");return a?a.getValue():1},showPoorQuestionFeedback:function(a){this.add_request_pending=!1,this.enableAddQuestionButton(),this.editor.focus(),this.fixQuestion(a.note),this.$("#@fixit").show()},addQuestion:function(){if(this.disabled)return!1;require("action_log").logSecondaryAction("QuestionAdd",null),this.disableAddQuestionButton();var a=this.getKwargs(),b=this.serverCall(this.getAddQuestionServerCall()).kwargs(a).success(this.fnbind(function(a){this.add_request_pending=!1,this.enableAddQuestionButton(),this.questionAddedCallback(a)})).except("poor_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("problematic_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("non_english_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("survey_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).error(this.fnbind(function(a){this.add_request_pending=!1,this.enableAddQuestionButton()})).disableNextPostReload();this.shouldLiveMutateAddQuestionCall()&&(b.liveMutate(),b.persistMutation()),b.send(),this.addQuestionClickedCallback(a)},shouldLiveMutateAddQuestionCall:function(){return!0},getAddQuestionServerCall:function(){return this.shouldLiveMutateAddQuestionCall()?"add_question":"add_question_with_context"},focus:function(){this.lookup("navigator").focus(!0)},disableAddQuestionButton:function(){this.disabled=!0},enableAddQuestionButton:function(){this.disabled=!1}}),i=a.AddQuestionIntoTopicInline=h.extend({questionAddedCallback:function(a){var b=a[0],c=a[1];this.parent().newQuestionAdded(b,c)},addQuestionClickedCallback:function(a){var b=a.question;this.parent().newQuestionPending(b),this.lookup("navigator").clear(),this.focusQuestionBox()},disableAddQuestionButton:function(){},enableAddQuestionButton:function(){},shouldLiveMutateAddQuestionCall:function(){return!1}});a.AddQuestionWithTopicInline=i.extend({getKwargs:function(){var a=this._super.apply(this,arguments);return a.question_details=this.lookup("details_editor").serialize(),a},addQuestionClickedCallback:function(a){this._super.apply(this,arguments),this.lookup("details_editor").clear()}}),a.AddQuestionDialogFromInlineForm=c.extend({onLoad:function(){this.hasStartedTyping=!1,this.$("#@question_text").keydown(this.fnbind(function(a){if(a.keyCode==13)return this.lookup("button").openDialog(),a.stopPropagation(),!1;this.hasStartedTyping||(this.serverCall("log_start_adding_question").send(),this.hasStartedTyping=!0)})),this.$("#@question_text").bind("focus keydown",this.fnbind(function(a){this.$("#@anon_checkbox").show()}))},addButtonClickCallback:function(){this.hasStartedTyping||(this.serverCall("log_start_adding_question").send(),this.hasStartedTyping=!0)},getQuestionText:function(){var a=this.$("#@question_text").val(),b=$("<div/>").text(a).html();return b},getIsPrivate:function(){var a=this.child("anon_checkbox",!0);return a?a.getValue()===0?1:0:0}}),a.AddQuestionDialogLink=c.extend({onLoad:function(){this.should_show_tooltip?this.$("#@tooltip_container").tooltip({contents:this.tooltip_text,direction:"bottom"}):this.$("#@dialog_link").click(this.fnbind(function(){return this.openDialog(),!1}))},openDialog:function(){var a=!1,b=null,c=null,d=null,e=this.parent(),f=this.getQuestionText();return e&&(e.addButtonClickCallback&&e.addButtonClickCallback(),e.getIsPrivate&&(a=e.getIsPrivate()),e.query&&(b=e.query),e.question_text&&(c=e.question_text),e.skip_step&&(d=e.skip_step),e.getQuestionDetails&&this.lookup("wizard").forceQuestionDetails(e.getQuestionDetails())),this.lookup("wizard").open(f,a,b,c,d,this.tid),this.lookup("hover_menu")&&this.lookup("hover_menu").doHide&&this.lookup("hover_menu").doHide(),!1},getQuestionText:function(){return this.parent().getQuestionText?this.parent().getQuestionText():""}}),a.AddQuestionDialogLinkInSearch=a.AddQuestionDialogLink.extend({onLoad:function(){var a=this;this.$("#@dialog_link").click(this.fnbind(function(){return require("action_log").logPrimaryAction("StartQuestionAdd",{hash:a.hash,type:a.impression_type}),this.openDialog(),!1}))}}),a.AddQuestionWizard=c.extend({onLoad:function(){this.$("#@question_text_done").click(this.fnbind(function(a){return this.questionTextDoneCallback(),!1})),this.$("#@cancel, #@close_x").click(this.fnbind(function(){return this.close(),!1}));var a=this,b=a.lookup("question");b.setEnterCallback(function(){a.questionTextDoneCallback()}),this.duration=75,this.question_text_html=null,this.last_topic_lookup_question_text_html=null,this.add_button_disabled=!1,this.$("#@remove_context_link").click(this.fnbind(function(){return this.context_tid=0,this.$("#@add_question_context").remove(),this.$("#@remove_context_link").remove(),!1})),this.enableQuestionTextDoneButton(),this.lookup("question").setFocusCallback(this.fnbind(function(){this.removeQuestionFeedbackHighlight()})),this.skip_soft_rules=!1,this.duplicate_no_results=!1,this.forced_question_details=null},_show_add_question:function(){this.$("#@add_question_title").addClass("as_title"),this.$("#@question_row_inner").show()},_hide_add_question:function(){this.$("#@add_question_title").removeClass("as_title"),this.$("#@question_row_inner").hide()},open:function(a,b,c,d,e,f){this.origQuestionHtml=d||a,this.origQuery=c,this.tid=f,this.skipStep=e,this.showCheckboxesOnDuplicateStep=e=="skip_1",this.skipDuplicateCheckOnOrigQuestion=e=="skip_2";var g=this.lookup("anon_checkbox");if(g){var h=b?g.anon_value:g.public_value;g.setValue(h)}this.center(),this.$("#@wizard_dialog .dialog_buttons").remove(),this.$("#@wizard_dialog").removeClass("hidden");var i=this.lookup("question");i.focus();if(a){this.lookup("question").setHtml(a);var j=this;$(document).ready(function(){setTimeout(function(){a&&j.questionTextDoneCallback()},0)})}this.serverCall("log_open_wizard_dialog").send()},center:function(){var a=420,b=100,c=this.$("#@wizard_dialog"),d=$(window).width(),e=$(window).scrollTop(),f=a,g=d-f,h=g/2,i=$(window).height()/2;i-=c.outerHeight(),c.css("top",i+"px"),c.css("left",h+"px"),c.css("width",a+"px"),c.appendTo($(document.body));return},close:function(){this.add_button_disabled=!1,this.enableQuestionTextDoneButton(),this.skip_soft_rules=!1,this.$("#@wizard_dialog").addClass("hidden"),this.showQuestionSection(),this.lookup("question").clear(),this.$("#@fixit_title").html(""),this.$("#@fixit_text").html(""),this.$("#@fixit").hide()},showQuestionSection:function(){return this.toggleSection("#@question_row_inner"),this.toggleTitles("#@add_question_title",!1),this.$("#@question_text_preview").addClass("hidden").text(""),this.lookup("question").$("#@editor").removeClass("disabled_for_submit"),this._show_add_question(),this.center(),!1},showDuplicatesSection:function(){var a=this.question_text_html.replace(/<(?:.|\n)*?>/gm,""),b=this.$("#@question_text_preview"),c="&nbsp;",d=new RegExp(c,"g");a=a.replace(d," ");var e=150;a.length>e&&(a=a.substring(0,e)+"..."),b.html(a).removeClass("hidden");var f=$(window).height()/2-b.height();this.$("#@wizard_dialog").find(".question_wizard_duplicate_wrapper").css("max-height",f+"px").css("overflow","auto");if(this.skipDuplicateCheckOnOrigQuestion&&this.question_text_html==this.origQuestionHtml)return this.duplicatesDoneCallback(),!1;this.serverCall("log_duplicate_step_started").send(),this.toggleSection("#@duplicate_row_inner"),this.toggleTitles("#@duplicates_title",!1),this.checkDuplicateResults();var g=this.lookup("wizard");g.duplicate_no_results&&g.duplicatesDoneCallback();var h=this.$("#@wizard_dialog").outerHeight()/2;return this.$("#@wizard_dialog").css("top",f-h+"px"),!1},showTopicsSection:function(){function e(){c++;var b=d.lookup("add_topics_step",!0);if(b){b.onShownInWizard();var f=$(window).height()/3;a.find(".AddQuestionWizardTopicSelection").css("max-height",f+"px").css("overflow","auto")}else c<=10&&setTimeout(e,200)}this.toggleSection("#@topics_row_inner"),this.toggleTitles("#@topics_title",!1);var a=this.$("#@wizard_dialog"),b=a.find(".selector"),c=0,d=this;return e(),b.css("max-height",b.height()),!1},onEnterPressed:function(){this.enterPressedCallback&&this.enterPressedCallback()},onEditorInputChange:function(){this.enableQuestionTextDoneButton(),this.skip_soft_rules=!1},toggleSection:function(a){this.$("%@section_inner_content").hide(),this.$(a).show()},toggleTitles:function(a,b){b?this.$("%@title_tabs").removeClass("hidden").addClass("inactive"):this.$("%@title_tabs").addClass("hidden"),this.$(a).removeClass("inactive").removeClass("hidden")},showPoorQuestionFeedback:function(a){this.showQuestionSection(),this.$("#@fixit_title").html(a.title),this.$("#@fixit_text").html(a.note),this.$("#@fixit").slideDown(200),a.matched_phrase&&this.addQuestionFeedbackHighlight(a.matched_phrase),a.is_blocking?(this.disableQuestionTextDoneButton(),this.$("#@fixit_instruction").hide()):(this.$("#@fixit_instruction").show(),this.skip_soft_rules=!0)},hidePoorQuestionFeedback:function(){this.$("#@fixit").slideUp(200)},removeQuestionFeedbackHighlight:function(){this.lookup("question").$("#@editor .question_feedback_highlight").contents().unwrap()},addQuestionFeedbackHighlight:function(a){this.lookup("question").$("#@editor").html(function(b,c){var d=new RegExp("("+g(a)+")","i");return c.replace(d,'<span class="question_feedback_highlight">$1</span>')})},enableQuestionTextDoneButton:function(){this.question_text_done_button_enabled=!0,this.$("#@question_text_done").removeClass("submit_button_disabled"),this.lookup("question").$("#@editor").removeClass("disabled_for_submit")},disableQuestionTextDoneButton:function(){this.$("#@question_text_done").addClass("submit_button_disabled"),this.question_text_done_button_enabled=!1},checkDuplicateResults:function(){var a=this.$(".duplicate_question_link_span");this.duplicate_no_results=a.length===0},questionTextDoneCallback:function(){if(!this.question_text_done_button_enabled)return;this.hidePoorQuestionFeedback(),this.lookup("question").$("#@editor").addClass("disabled_for_submit"),this.lookup("question").blur(),this.question_text_html=this.lookup("question").html(!1),this.$("#@duplicate_row_inner").empty().hide(),this.serverCall("get_duplicate_component").contentFor(this.$("#@duplicate_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize(),check_for_question_issues:!0,skip_soft_rules:this.skip_soft_rules}).except("poor_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("problematic_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).except("non_english_question",this.fnbind(function(a){this.showPoorQuestionFeedback(a)})).success(this.fnbind(function(a){this.loadTopics(),this.skipStep||(this.$("#@topics_row").hide(),this.$("#@duplicate_row").show(),this.showDuplicatesSection())})).send(),this.skipStep&&(this.$("#@topics_row").hide(),this.$("#@duplicate_row").show(),this.showDuplicatesSection())},loadTopics:function(){var a=this.lookup("question").html(!1);this.last_topic_lookup_question_text_html!=a&&(this.last_topic_lookup_question_text_html=a,this.serverCall("get_topic_component").contentFor(this.$("#@topics_row_inner"),{parentCID:this.cid}).kwargs({query:this.lookup("question").serialize()}).send())},duplicatesDoneCallback:function(){this.$("#@topics_row").show(),this.showTopicsSection()},getQuestionText:function(){return this.lookup("question").serialize()},forceQuestionDetails:function(a){this.forced_question_details=a},getQuestionDetails:function(){return this.forced_question_details===null?this.lookup("duplicate_step").getQuestionDetails():this.forced_question_details},topicsDoneCallback:function(){if(this.add_button_disabled)return;var a={question:this.getQuestionText(),question_details:this.getQuestionDetails(),is_private:this.lookup("add_topics_step").getIsPrivate(),topic_names:this.lookup("add_topics_step").getTopicNames(),unselected_topic_names:this.lookup("add_topics_step").getUnselectedTopicNames(),added_topic_names:this.lookup("add_topics_step").getAddedTopicNames(),orig_query:this.origQuery,context_tid:this.context_tid,faq_tid:this.tid,top_topic_suggestions:this.lookup("add_topics_step").getTopTopicSuggestions()};require("action_log").logSecondaryAction("QuestionAdd",null),this.add_button_disabled=!0,this.serverCall("add_question").kwargs(a).liveMutate().success(this.fnbind(function(a){var b=a[0];f.navigateTo(b)})).error(this.fnbind(function(){this.add_button_disabled=!1})).except(this.fnbind(function(){this.add_button_disabled=!1})).send()}}),a.AddQuestionWizardDuplicateStep=c.extend({onLoad:function(){this.parent().showCheckboxesOnDuplicateStep&&this.$("#@extra_checkboxes").show(),this.whenOnLoaded(this.fnbind(function(){var a,b=this.child("anon_checkbox2"),c;b&&(c=this.parent().lookup("anon_checkbox"),c&&(a=b.$("#@checkbox"),a.change(function(){c.setValue(b.getValue())})))}));var a=this.$("#@question_details_link");a&&a.click(this.fnbind(function(){return this.$("#@question_details_link").hide(),this.$("#@question_details_editor").show(),this.lookup("question_details").focus(),!1})),this.$("#@duplicates_done").click(this.fnbind(function(a){return this.serverCall("log_step_complete").kwargs({details:this.getQuestionDetails()}).success(this.fnbind(function(a){this.$("#@question_details_too_long").hide(),this.parent().duplicatesDoneCallback()})).except("long_question_details",this.fnbind(function(a){this.$("#@question_details_too_long").show()})).send(),!1})),this.$("#@duplicates_done").focus(),this.$("#@cancel").click(this.fnbind(function(){return this.parent().showQuestionSection(),this.$("#@extra_checkboxes").hide(),this.parent().showCheckboxesOnDuplicateStep=!1,!1}))},getQuestionDetails:function(){return this.lookup("question_details").serialize()}}),a.AddQuestionDuplicateQuestionLink=c.extend({onLoad:function(){this.$("#@link").find("a").click(this.fnbind(function(){return e.setMessage("look",[this.qid,!0]),this.serverCall("log_question_click").send(),!0}))}}),a.AddQuestionWizardTopicStep=c.extend({onLoad:function(){this.$("#@topics_done").click(this.fnbind(function(a){return this.parent().topicsDoneCallback(),!1})),this.$("#@topics_done").focus(),this.$("#@cancel").click(this.fnbind(function(){var a=this.parent();return a.skipDuplicateCheckOnOrigQuestion&&a.question_text_html==a.origQuestionHtml?a.showQuestionSection():a.duplicate_no_results?a.showQuestionSection():a.showDuplicatesSection(),!1}))},onShownInWizard:function(){this.empty&&this.lookup("selector").focus(!0)},getIsPrivate:function(){var a=this.lookup("anon_checkbox");return a?a.getValue()===0?1:0:!1},getTopicNames:function(){return this.lookup("topic_selection").getTopicNames()},getUnselectedTopicNames:function(){return this.lookup("topic_selection").getUnselectedTopicNames()},getAddedTopicNames:function(){return this.lookup("topic_selection").getAddedTopicNames()},getTopTopicSuggestions:function(){return this.lookup("topic_selection").top_topic_suggestions}}),a.AddQuestionTopicSelection=c.extend({onLoad:function(){this.setUpLabelClicks(),this.topic_added_index=0},setUpLabelClicks:function(){var a=".QuestionWizardTopicRow";this.$("#@topic_list").find(a).click(function(a){var b=$(this).find("input[type=checkbox]").eq(0);b.prop("checked",!b.prop("checked"))}),this.$("#@topic_list").find("input[type=checkbox]").click(function(a){a.stopPropagation()})},getTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=checkbox]").each(function(b){$(this).is(":checked")&&$(this).val()&&a.push($(this).val())}),a},getUnselectedTopicNames:function(){var a=[];return this.$("#@topic_list").find("input[type=checkbox]").each(function(b){!$(this).is(":checked")&&$(this).val()&&a.push($(this).val())}),a},getAddedTopicNames:function(){var a=[];for(var b=0;b<this.topic_added_index;b++){var c=this.$("#@topic_added_"+b).find("input[type=checkbox]");c.val()&&a.push(c.val())}return a},newTopicAdded:function(a){var b=a.value,c=this.topic_added_index;this.topic_added_index++,this.serverCall("new_topic_added").kwargs({topic_name:b}).contentFor(this.$("#@topic_added_"+c),{parentCID:this.cid}).success(this.fnbind(function(){var b=this.$("#@topic_added_"+c);b.show();var d=b.find(".QuestionWizardTopicRow"),e=d.find("input[type=checkbox]");d.click(function(){e.prop("checked",!e.prop("checked"))}),e.click(function(a){a.stopPropagation()}),typeof a.id!="undefined"&&this.lookup("selector").addIgnoreOid(a.id)})).send()}}),a.AddQuestionAnonymousCheckbox=c.extend({onLoad:function(){this.cb=this.$("#@checkbox")},getValue:function(){return this.cb.attr("checked")?this.anon_value:this.public_value},setValue:function(a){a==this.anon_value?this.cb.attr("checked","checked"):this.cb.removeAttr("checked")},getCheckboxElement:function(){return this.$("#@checkbox")}})},{webnode2:!0,cookies:!0,action_log:!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("qtexteditor",function(require,a,b){function l(){return(new Date).getTime()*1e3}function m(a){var b=parseInt(a,10);return isNaN(b)?a!="normal"&&a!="lighter":b>400}var c=require("w2.quora").Component,d=require("qed/edit").edit,e=require("qed/util"),f=e.hasCtrlOrCmd,g=e.deleteContents,h=require("view/fixable2"),i=require("qed/npd"),j=require("browser").browser,k=require("qed/modifiers"),n=a.QTextEditorBase=c.extend({onUnload:function(){this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null),this.meaningfulChangeTimeout&&(clearTimeout(this.meaningfulChangeTimeout),this.meaningfulChangeTimeout=null),this.uninstallScrollHandlers(),this._qed&&(this._qed.stop(),delete this._qed)},onLoad:function(){function c(b){return function(){return a.modify(function(a,c){$(a).before("["+b+"]"),$(c).after("[/"+b+"]")},!0),!1}}function f(b,c){e.$("#@cmd_"+b).click(function(){return a.modify(c,!0),e.inputEntered(),!1})}this.linkSelectorLoaded=!1,this.editor=this.$("#@editor");if(this.editor.length===0)return;var a=this._qed=d(this.editor[0]);if(!a)return;var b=require("webnode2");b.interactionMode&&b.interactionMode.bindInteractionMode(this.editor),this.enterCallback||(this.enterCallback=null),this.focusCallback||(this.focusCallback=null),this.blurCallback||(this.blurCallback=null),this.typingStateCallback||(this.typingStateCallback=function(){}),this.typingTimeout=null,this.lastInputTime=0,this.lastTypingReportTime=0,this.lastReportedTypingState="empty",this.typingStopped=!1,this.meaningfulChangeCallback||(this.meaningfulChangeCallback=function(){}),this.meaningfulChangeTimeout=null,this.resetMeaningfulChange(),this.$("#@cmd_heading").tooltip({contents:this.interface_strings.heading}),this.$("#@cmd_blockquote").tooltip({contents:this.interface_strings.blockquote}),this.$("#@cmd_insertorderedlist").tooltip({contents:this.interface_strings.ordered_list}),this.$("#@cmd_insertunorderedlist").tooltip({contents:this.interface_strings.unordered_list}),this.$("#@cmd_inserthr").tooltip({contents:this.interface_strings.horizontal_separator}),this.$("#@add_qlink").tooltip({contents:this.interface_strings.link_things}),this.$("#@cmd_qimg").tooltip({contents:this.interface_strings.insert_image}),this.$("#@cmd_code").tooltip({contents:this.interface_strings.code_block}),this.$("#@cmd_latex").tooltip({contents:this.interface_strings.latex}),this.$("#@cmd_tips").tooltip({contents:this.interface_strings.writing_tips}),this.$("#@add_qlink").click(this.fnbind(function(){return this.addLink(),!1})),this.$("#@cmd_code").click
(c("code")),this.$("#@cmd_latex").click(c("math")),this.$("#@cmd_qimg").click(this.fnbind(function(){return this.openImageDialog(),!1})),this.$("#@cmd_tips").click(this.fnbind(function(a){a.preventDefault(),this.cQuery("writing_tips").toggle()}));var e=this;f("bold",k.bold),f("italic",k.italic),f("underline",k.underline),f("blockquote",k.blockquote),f("insertorderedlist",k.orderedList),f("insertunorderedlist",k.unorderedList),f("inserthr",function(a,b){var c=k.insertHR(a,b,e.hr_img);e.markImageAsDetected(c),e.setImageAsUnselectable(c)}),f("heading",k.heading),this.$("#@save").click(this.fnbind(function(){this.save()})),this.editor.on("input",this.fnbind(function(a){this.editorInputChange(a)})),this.isIE=navigator.userAgent.match(/(Trident)|(.NET)/i),this.isIE||(this.isIE=window&&window.navigator.appName=="Microsoft Internet Explorer"),this.isIE=j.msie,this.editor.keydown(this.fnbind(function(a){return this.isIE&&(this.editorInputChange(a),this.handlePlaceholder(!0)),this.editorKeyDown(a)})),this.editor.keyup(this.fnbind(function(a){return this.editorKeyUp(a)})),this.editor.keypress(this.fnbind(function(a){return this.editorKeyPress(a)}));var g=this.fnbind(function(){this.editor.anchor()});this.editor.focus(this.fnbind(function(){this.editor.attr("focused",!0),this.handlePlaceholder(!1),$(document).on("livenode_op_start",g),this.loadLinkSelector(),this.length_limit&&this.lookup("counter").show(),this.focusCallback&&this.focusCallback(),this.focusEditLinkCallback&&this.focusEditLinkCallback()})),this.editor.blur(this.fnbind(function(){this.editor.removeAttr("focused"),this.handlePlaceholder(!1),this.length_limit&&this.lookup("counter").hide(),$(document).off("livenode_op_start",g),this.blurCallback&&this.blurCallback(),this.detectLinks()})),this.editor.click(this.fnbind(function(a){this.setFormattingButtons(a.target)}));var h=this.fnbind(function(){this.qlinkSync()});this.$("#@qlink_text").keydown(h),this.$("#@qlink_text").keyup(h),this.$("#@qlink_text").keypress(h),this.$("#@qlink_text").change(h),this.$(".@qlink_close").click(this.fnbind(function(){return this.replaceLinkWithText(this.$("#@qlink_key").val(),"@"+this.getLinkSelector().getValue()),this.editor.focus(),!1})),this.$("#@qlink_update").click(this.fnbind(function(){return this.qlinkUpdate(),!1})),this.$("#@editor img").each(function(a,b){e.markImageAsDetected(b)}),this._enableImageDetection=!0,this.registerLinkHandlers(),this.$("#@fake_editor").click(this.fnbind(function(){this.hideFakeEditor()})),this.hideFakeEditorByDefault&&(this.hideFakeEditor(),this.blurOnLoad&&this.editor.blur()),e.support_drag_and_drop_upload&&!e.prevent_load_drop_zone&&e.loadDragAndDropForm()},uploadSuccess:function(a){for(var b=0;b<a.qimg_urls.length;b++)this.addImage(a.qimg_urls[b]);this.inputEntered(),this.editor.focus()},isDragAndDropEvent:function(a){var b=!1,c=!1,d=a.dataTransfer||a.originalEvent.dataTransfer;return d.types?($.each(d.types,function(a,d){d==="text/uri-list"&&(c=!0);if(d.match(/image/i)||d.match(/file/i))b=!0}),!c&&b):!1},loadDragAndDropForm:function(){this.$("#@drop_zone").removeClass("hidden");var a=this.child("drag_and_drop_wrapper"),b=a.child("drag_and_drop_form"),c=this;this.addBodyDragoverListener();if(this.$("#@drop_zone")&&b){var d=function(a){c.isDragAndDropEvent(a)&&(a.stopPropagation(),a.preventDefault(),a.originalEvent.dataTransfer.dropEffect="copy",c.$("#@target_box").addClass("drag_and_hover"))},e=function(a){c.isDragAndDropEvent(a)&&(a.stopPropagation(),a.preventDefault(),c.$("#@target_box").removeClass("drag_and_hover"))};b.setDropZone(this.$("#@drop_zone"),d,e),b.success(this.fnbind(this.uploadSuccess))}this.editor.on("paste",function(a){var d=a.clipboardData||a.originalEvent.clipboardData,e=[];if(!d||!d.items)return;for(var f=0;f<d.items.length;++f){var g=d.items[f].type;(g.match(/image/i)||g.match(/file/i))&&e.push(d.items[f].getAsFile())}e.length&&(c.$("#@spinner").show(),b._uploadFiles(e))})},disableBrowserFileDragDefault:function(a){a.stopPropagation(),a.preventDefault();var b=a.originalEvent.dataTransfer;b.effectAllowed=b.dropEffect="none"},addBodyDragoverListener:function(){var a=this;$("document, body").bind({dragenter:function(b){if(a.isDragAndDropEvent(b)){b.stopPropagation(),b.preventDefault(),a.disableBrowserFileDragDefault(b),a.$("#@drop_zone").addClass("drag_and_hover"),a.$("#@target_box").removeClass("hidden");var c=a.$("#@editor").height()-10;a.$("#@target_box").height(c).css({"line-height":c+"px"})}},dragover:function(b){a.isDragAndDropEvent(b)&&(a.disableBrowserFileDragDefault(b),b.stopPropagation(),b.preventDefault(),a.$("#@drop_zone").removeClass("drag_and_hover"),a.$("#@target_box").addClass("hidden"))}})},fixEditorButtons:function(){if(this.buttonsVisible&&this.shouldFixButtons){var a=this.$("#@qtext_editor_buttons_wrapper"),b=this.$("#@editor_outer");h.makeFixable(a,{scroll_dep:!0,sticky_release:!1,min_scroll_callback:function(){return b.offset().top-$(".SiteHeader").outerHeight()},max_scroll_callback:function(){return b.offset().top+b.outerHeight()-$(".SiteHeader").outerHeight()}})}},setImageAsUnselectable:function(a){a.setAttribute("unselectable","on")},handlePlaceholder:function(a){!this.isEmpty()||a?this.editor.removeClass("needs_placeholder"):this.editor.addClass("needs_placeholder")},hideFakeEditor:function(){this.$("#@fake_editor").hide(),this.editor.show(),this.editor.focus(),this.fixEditorButtons()},registerLinkHandlers:function(){function c(c,d){b&&b.indexOf(c)>=0&&a.addLinkHandlerForType(c,a.fnbind(d))}this._linkHandlers={};var a=this,b=a.supported_link_handlers;c("youtube",a.handleYoutubeLink),c("image",a.handleImageLink),c("email",a.handleEmailLink),c("invalid",a.handleInvalidLink)},addLinkHandlerForType:function(a,b){this._linkHandlers&&(this._linkHandlers[a]=b)},getLinkHandler:function(a){return this._linkHandlers&&this._linkHandlers[a]},loadLinkSelector:function(a){this.linkSelectorLoaded||this.serverCall("get_link_selector").contentFor(this.$("#@link_selector"),{parentCID:this.cid}).success(this.fnbind(function(){if(!this.plaintext){var b=this.getLinkSelector();b&&b.setCallback(this.fnbind(function(){this.onLinkSelection()}))}this.linkSelectorLoaded=!0,a&&$.isFunction(a)&&a()})).sendOnlyOnce()},makeKey:function(){var a="",b="abcdefghijklmnopqrstuvwxyz0123456789";for(var c=0;c<10;c++)a+=b[Math.floor(Math.random()*b.length)];return a},syncTypingState:function(){var a=1e7,b;this.isEmpty()||this.typingStopped?b="empty":this.lastInputTime<l()-a?b="paused":b="typing";var c=!1;b!=this.lastReportedTypingState&&(c=!0),b!="empty"&&this.lastTypingReportTime<l()-55e6&&(c=!0),c&&(this.typingStateCallback(b),this.lastReportedTypingState=b,this.lastTypingReportTime=l()),this.typingTimeout&&(clearTimeout(this.typingTimeout),this.typingTimeout=null);if(b=="typing"||b=="paused")this.typingTimeout=setTimeout(this.fnbind(function(){this.syncTypingState()}),a/1e3)},checkMeaningfulChange:function(){var a=this.checkMeaningfulTimeoutPeriod*1e3;if(this.meaningfulChangeTimeout)return;this.meaningfulChangeTimeout=setTimeout(this.fnbind(function(){var a=this.serialize(!0);(!this.meaningfulChangeBase||a.html!=this.meaningfulChangeBase.html||a.data!=this.meaningfulChangeBase.data)&&this.meaningfulChangeCallback(),this.meaningfulChangeBase=a,this.meaningfulChangeTimeout=null}),a)},reportMeaningfulChange:function(){this.meaningfulChangeBase=null,this.checkMeaningfulChange()},resetMeaningfulChange:function(){this.meaningfulChangeBase=this.serialize(!0),this.meaningfulChangeTimeout&&(clearTimeout(this.meaningfulChangeTimeout),this.meaningfulChangeTimeout=null)},editorKeyUp:function(){this.detectNewImages(),this.inputEntered(),this._detectLinksOnNextKeyUp&&(this._detectLinksOnNextKeyUp=!1,this.detectLinks())},inputEntered:function(){this.length_limit&&this.updateLengthCounter(),this.typingStopped=!1,this.lastInputTime=l(),this.syncTypingState(),this.checkMeaningfulChange(),this.dirtyText()},updateLengthCounter:function(){this.lookup("counter").updateCounter(this.valLength())},text:function(a){var b=this._cachedText;if(a||!b)b=this._qed.text();return(this._cachedText=b)||""},dirtyText:function(){this._cachedText=null},_cachedUrlInfo:{},getUrlInfo:function(a,b){var c=this,d=c._cachedUrlInfo[a];d!==!1&&(d?b(d):($(c).trigger("link-fetch-start",[a]),c.serverCall("get_url_info").kwargs({url:a}).success(function(d){b(c._cachedUrlInfo[a]=d),$(c).trigger("link-fetch-end",[a])}).error(function(){c._cachedUrlInfo[a]=!1,$(c).trigger("link-fetch-end",[a])}).send()))},detectLinks:function(){var a=this,b=require("linkify").iterLinks;b(a.text(),function(b,c){a.detectLink(b,c)})},detectLink:function(a,b){var c=this;if(a&&a.indexOf("mailto:")===0){var d={type:"email",title:b,url:a};c.handleDetectedLink(d,a,b)}else c.getUrlInfo(a,function(d){c.handleDetectedLink(d,a,b)})},handleDetectedLink:function(a,b,c){var d=a&&a.type,e=d&&this.getLinkHandler(d);return e?e(a,b,c):$(this).trigger("link-added-to-editor",[a,b,c])},handleImageLink:function(a,b,c){var d=this;d.findTextAndModify(c,function(b){var c=d.replaceLinkWithImage(b,a.url);d.detectNewImage(c)})},handleYoutubeLink:function(a,b,c){var d=this;d.findTextAndModify(c,function(b){var c="http://img.youtube.com/vi/"+a.video_id+"/hqdefault.jpg",e=d.replaceLinkWithImage(b,c);d.markImageAsDetected(e);for(var f in a)e.setAttribute(f,a[f])})},handleInvalidLink:function(){},handleEmailLink:function(){},replaceLinkWithImage:function(a,b){var c=a;$(c.foundStart).replaceWith(c.start),$(c.foundEnd).replaceWith(c.end),e.deleteContents(c.start,c.end),this.handleImageWithinLink(c);var d=b&&this.addImage(b,!0);return d},handleImageWithinLink:function(a){var b=a.start.parentElement;if(!e.hasTag(b,"a")||b!==a.end.parentElement)return;var c=b.firstChild;while(c){var d=c.nextSibling;c.nodeType===3?(!c.nodeValue||c.nodeValue.length===0)&&$(c).remove():e.hasTag(c,"span")&&c!==a.start&&c!==a.end&&(!c.childNodes||c.childNodes.length===0)&&$(b).after(c),c=d}b.firstChild==a.start&&b.lastChild==a.end&&($(b).before(a.start).after(a.end),e.deleteContents(a.start,a.end))},findTextAndModify:function(a,b,c){var d=this,e=require("find");d._qed.modify(function(c,f){e.findText(d.editor.get(0),a,function(a,d){var e={start:c,end:f,foundStart:a,foundEnd:d};return b(e)})},c)},onLinkAdded:function(a){var b=this;$(b).bind("link-added-to-editor",function(c,d,e,f){return a.call(b,d,e,f)})},onLinkFetchStart:function(a){var b=this;$(b).bind("link-fetch-start",function(c,d){return a.call(b,d)})},onLinkFetchEnd:function(a){var b=this;$(b).bind("link-fetch-end",function(c,d){return a.call(b,d)})},detectNewImages:function(){if(!this._enableImageDetection)return;var a=this;this.$("#@editor img").each(function(b,c){a.detectNewImage(c)})},detectNewImage:function(a){function c(a,b,c){if(!/^webkit-fake-url:/.test(a)){var d=new Image;d.onload=b,c&&(d.onerror=c),d.src=a}else c&&c()}var b=this;if(!b.markImageAsDetected(a))return;$(a).addClass("qtext_image");var d=function(){$(a).remove()};c(a.src,function(){b.serverCall("upload_image_by_url").kwargs({url:a.src}).success(function(b){if(b&&b.failed){d();return}b&&c(b.url,function(){a.src=b.url})}).send()},function(){d()})},markImageAsDetected:function(a){if(!a.hasAttribute("detected"))return a.setAttribute("detected",a.src.slice(0,100)),!0},editorInputChange:function(){this.handlePlaceholder(!1)},editorKeyPress:function(a){if(String.fromCharCode(a.which)=="@")return this.addLink(),!1},setEscapeKeyCallback:function(a){this.escapeKeyCallback=a},editorKeyDown:function(a){if(this.enterCallback&&!a.shiftKey&&a.keyCode==13)return this.enterCallback(),!1;switch(a.which){case 27:this.escapeKeyCallback&&this.escapeKeyCallback();break;case 86:if(!f(a))break;case 32:case 13:this._detectLinksOnNextKeyUp=!0}return!0},addDummySpan:function(){var a;return this._qed.modify(function(b,c){g(b,c),a=document.createElement("span"),c.parentNode.insertBefore(a,c)}),a},openImageDialog:function(){var a=this;a._dialog=a._dialog||a.dialog({showXButton:!0,closeOnClickOut:!0,width:550}).title(a.interface_strings.insert_image).close(function(){a._dialog=null}).load("image_dialog_contents")},addImage:function(a,b,c){var d=this;return d._qed.modify(function(e){var f=e.parentNode;if(f){var g=document,h=g.createElement("img"),i,j;return h.src=a,d.setImageAsUnselectable(h),c?j=h:(i=g.createElement("div"),i.appendChild(h),j=i),f.insertBefore(j,e),b||d.detectNewImages(),h}},!0)},addLink:function(){if(!this.linkSelectorLoaded)return this.loadLinkSelector(this.fnbind(this.addLink));var a=this.makeKey(),b=document.createElement("a");b.id="qlink_"+a,b.innerHTML="â¦",b.className="qlink",b.href="#",this._qed.modify(function(a,c){function d(a){$(a).closest("a.qlink").map(function(){$(this).after(a)})}d(a),d(c),g(a,c),$(a).before(b)},!0),this.qlink_data[a]={target:{},text:""},setTimeout(this.fnbind(function(){this.editLink(a,"")}),0)},setSelectionlessCallback:function(a){if(!this.selectionlessCallback){var b=this.getLinkSelector(),c=this;b.setSelectionlessCallback(function(){c.callSelectionlessCallback()})}this.selectionlessCallback=a},callSelectionlessCallback:function(){var a=this.selectionlessCallback;a&&a()},editLink:function(a,b){this.closeEditLink(),this.editingLink=!0;var c=this,d=this.qlink_data[a].text?this.qlink_data[a].text:b,e=this.qlink_data[a].target;e.type&&this.$("#@qlink_selector").hide(),this.$("#@qlink_key").val(a),d&&this.$("#@qlink_text").val(d);var f=this.$("#@editor_wrapper").offset(),g=this.$("#@editor #qlink_"+a).offset(),h=g.left-f.left,i=g.top-f.top;this.$("#@qlink_editor").css("left",h-10),this.$("#@qlink_editor").css("top",i+20),this.$("#@qlink_editor").removeClass("hidden");var j=this.getLinkSelector();j.clear(),j.setText(d),j.focus(!0),j.setEscKeyDown(this.fnbind(function(b){var c=j.getValue(),d=b.keyCode==27,e=!c&&b.keyCode==13,f=!c&&b.keyCode==8,g="@";d&&c&&(g="@"+c);if(e||d||f)return this.replaceLinkWithText(a,g),setTimeout(this.fnbind(function(){this.editor.focus()}),0),!1}));var k=function(){c.replaceLinkWithText(a,"@"+j.getValue())};this.setSelectionlessCallback(this.fnbind(function(){k(),setTimeout(this.fnbind(function(){this.editor.focus()}),0)})),j.setKeyUp(function(){c.editLinkText(a,j.getValue())}),e.type?this.$("#@qlink_text").focus():(this.focusEditLinkCallback=this.fnbind(function(){this.editingLink?k():this.closeEditLink()}),this.$("#@editor #qlink_"+a).addClass("qlink_active"))},getLinkSelector:function(){return this.child("link_selector")},replaceLinkWithText:function(a,b){this.closeEditLink();if(!a)return;var c=this.$("#@editor #qlink_"+a),d=$("<div>");b=d.text(b).html(),c.length&&this._qed.modify(function(a,d){c.after(d).after(a).replaceWith(b||"")}),delete this.qlink_data[a]},editLinkText:function(a,b){if(!this.editingLink)return;this.qlink_data[a].text=b,this.$("#@editor #qlink_"+a).text("@"+b)},closeEditLink:function(){this.editingLink=!1;var a=this.$("#@qlink_key").val();if(!a)return;this.$("#@qlink_editor").addClass("hidden"),this.$("#@editor #qlink_"+a).removeClass("qlink_active"),this.$("#@qlink_selector").show()},qlinkSync:function(){var a=this.$("#@qlink_key").val(),b=this.$("#@qlink_text").val(),c=this.$("#@editor #qlink_"+a);c.text(b||"â¦");var d=this.getLinkSelector().result;b&&c.attr("title",this.qlink_data[a].text=b),d&&(this.qlink_data[a].target=d)},qlinkUpdate:function(){this.qlinkSync(),this.closeEditLink()},onLinkSelection:function(){var a=this.getLinkSelector().qValue;this.$("#@qlink_text").val(a),this.qlinkUpdate(),setTimeout(this.fnbind(function(){this.editor.focus()}),0),this.inputEntered()},setFormattingButtons:function(a){var b=$(a),c={bold:m(b.css("font-weight")),italic:b.css("font-style")=="italic",underline:b.css("text-decoration")=="underline"};e.isHeading(a)&&delete c.bold;for(var d in c)c[d]?this.$("#@cmd_"+d).addClass("qtext_editor_button_active"):this.$("#@cmd_"+d).removeClass("qtext_editor_button_active")},setEnterCallback:function(a){this.enterCallback=a},setTypingStateCallback:function(a){this.plaintext?this.typingStateCallback=null:this.typingStateCallback=a},setMeaningfulChangeCallback:function(a){this.plaintext?this.meaningfulChangeCallback=null:this.meaningfulChangeCallback=a},setFocusCallback:function(a){this.focusCallback=a},setBlurCallback:function(a){this.blurCallback=a},serialize:function(a){var b={html:this.html(a)};return this.plaintext?b.data={}:b.data=this.qlink_data,b},html:function(a){if(this.plaintext){var b=this.editor.val();return b||(b=""),b.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")}return this._qed?this._qed.html(!a):this.editor.html()},setHtml:function(a,b){return b&&(this.qlink_data=b),this.editor.html(a)},isEmpty:function(){if(this.plaintext)return this.editor.val()==="";if(this.editor.length===0)return!0;var a=this.editor[0];if(!a)return!0;if(a.childNodes.length==1&&a.childNodes[0].tagName=="BR")return!0;var b=this.html(!0);return b===""},valLength:function(){if(this.plaintext){var a=this.editor.val();return a?a.replace(/\n/g,"<br>").length:0}return this.text().length},clear:function(a){this.plaintext?this.editor.val(""):(this._qed&&this._qed.clear(a),this.qlink_data={},this.lastInputTime=l(),this.syncTypingState(),this.dirtyText())},stopTyping:function(){this.plaintext||(this.typingStopped=!0,this.syncTypingState())},selectAll:function(){var a=this.editor;this._qed.modify(function(b,c){$(b).prependTo(a),$(c).appendTo(a)},!0)},focus:require("atexit").hook(function(){var a=this;a.whenOnLoaded(function(){var b=a.editor;b.anchor().focus();var c=a.plaintext?b.val().length>0:b.text().length>0;if(c){var d=b.get(0);a.plaintext?d.setSelectionRange?d.setSelectionRange(0,b.val().length):b.select():a._qed.modify(function(a,b){e.insertBefore(d,a,d.lastChild),e.insertBefore(d,b,d.lastChild)},!0)}b.attr("focused",!0)})}),blur:function(){this.editor.blur().removeAttr("focused")},isInteractive:function(){return this.$("#@editor").attr("interactive")},hasChanged:function(a){return a.html!=this.html()},showLengthCounter:function(a){this.length_limit&&(a?this.$("#@editor_wrapper").removeClass("hide_counter"):this.$("#@editor_wrapper").addClass("hide_counter"))}}),o=a.QTextEditor=n.extend({onLoad:function(){this._super.apply(this,arguments),j.msie&&j.version>=9&&document.execCommand("AutoUrlDetect",!1,!1);var a=this;this.link_class_to_option={},this.options=["href","text","preview","delete"],$.each(this.options,function(b,c){var d=a.getClassName(c);a.link_class_to_option[d]=c}),a.linkEditorDiv=a.$("#@editor_wrapper"),a.initLinkOptions(),a.onLinkAdded(function(b,c,d){a.handleLinkAdded(b,c,d)}),a.editor.mouseover(function(b){return a.linkEditorMouseOver(b)}),a.editor.keydown(function(b){return a.linkEditorKeyDown(b)}),a._retrievingUrlInfo={},a._retrievingUrlInfoCount=0,a.onLinkFetchStart(function(b){a.$("#@spinner").show(),a._retrievingUrlInfo[b]=!0,a._retrievingUrlInfoCount++}),a.onLinkFetchEnd(function(b){a._retrievingUrlInfoCount--,delete a._retrievingUrlInfo[b],a._retrievingUrlInfoCount===0&&a.$("#@spinner").hide()}),this.initSpinner()},initSpinner:function(){var a=require("spin").createSpinnerElement({color:"#000"});this.$("#@spinner").append(a.el)},onUnload:function(){this._super.apply(this,arguments),this.editor=$(),delete this.linkEditorDiv,delete this.linkOptions},getUrlInfo:function(a,b){if(this._retrievingUrlInfo&&this._retrievingUrlInfo[a])return;this._retrievingUrlInfo[a]=!0;var c=this;this._super.apply(this,[a,function(d){delete c._retrievingUrlInfo[a],b(d)}])},getClassName:function(a){return"qtext_editor_link_"+a},getAttrName:function(a){return a==="href"?a:"data-link-"+a},getButton:function(a){return this.$("#@link_option_"+a)},initLinkOptions:function(){var a=this;a.linkOptions=a.$("#@qtext_editor_link_options");var b=[["href",a.interface_strings.show_linked_url],["text",a.interface_strings.show_linked_title],["delete",a.interface_strings.show_unlinked]],c=0;$.each(b,function(b,d){a.getButton(d[0]).click(function(){return a.handleLinkOption(d[0])}).tooltip({contents:d[1]}),c+=a.getButton(d[0]).outerWidth(!0)}),a.linkOptions.css("width",c)},positionLinkOptions:function(a){var b=$("<span>ï»¿</span>").prependTo(a),c=b.offset(),d=b.height();b.remove();var e=this.linkEditorDiv.offset(),f=c.left-e.left-2,g=c.top-e.top;this.linkOptionsHeight=this.linkOptionsHeight||this.linkOptions.outerHeight(),g-=this.linkOptionsHeight,this._positionIntersectsHeader(c.top+g)&&(g=g+this.linkOptionsHeight+d),this.linkOptions.css("top",g),this.linkOptions.css("left",f)},_positionIntersectsHeader:function(a){var b=$(".SiteHeader");if(b.length===0)return require("assert").ok(b.length===0,"var siteHeader does not exist in qTextEditor positionLinkOption"),!1;var c=b.offset().top+b.outerHeight();return c>a},linkEditorMouseOver:function(a){var b=a.target,c=(b&&b.nodeName||"").toLowerCase(),d=this.linkOptions;b=$(b);var f;if(c==="a")f=b[0];else{var g=b.parents("a");g.length>0&&(f=g[0])}this.unhighlightLinkTarget(),f&&(this.linkTarget=f,this.positionLinkOptions(f));if(f||e.contains(d[0],b)){var h=this.detectNewLinkElement(f);h&&(this.highlightActiveButton(f),this.highlightLinkTarget(),d.show())}else d.hide()},highlightActiveButton:function(a){var b=this,c=b.getOption(a);$.each(b.options,function(a,d){var e=b.getButton(d);d===c?e.addClass("active"):e.removeClass("active")})},highlightLinkTarget:function(){this.linkTarget&&$(this.linkTarget).addClass("qtext_editor_link_hover")},unhighlightLinkTarget:function(){this.linkTarget&&$(this.linkTarget).removeClass("qtext_editor_link_hover")},linkAlreadyDetected:function(a,b){var c=this,d=this.getLinkParent(b),e=d?c.getQlinkKey(d):null;if(e)return!0;if(d){var f=d;if($(f).text()!==a)return c.moveSelectionOut(f,b.start,b.end),c.moveSelectionOut(f,b.foundStart,b.foundEnd),c.detectNewLinkElement(d),!0}return!1},getLinkParent:function(a){var b=$(a.foundStart).parents("a"),c=b.length>0?b[0]:null;return c},detectLinks:function(){var a=this,b=require("linkify").iterLinks,c,d,e=function(b){a.linkAlreadyDetected(d,b)||a.detectLink(c,d)},f=[];b(a.text(),function(a,b){f.push({href:a,text:b})}),f.sort(function(a,b){return b.text.length-a.text.length});for(var g=0;g<f.length;g++)c=f[g].href,d=f[g].text,a.findTextAndModify(d,e);this.detectNewLinkElements()},detectLink:function(a){if(this.has_excluded_tld(a))return;this._super.apply(this,arguments)},has_excluded_tld:function(a){var b=this.tlds_to_exclude;if(!b)return!1;for(var c=0;c<b.length;c++){var d=b[c];if(a&&a.toLowerCase().indexOf(d,a.length-d.length)!==-1)return!0}return!1},linkEditorKeyDown:function(){this.linkOptions.hide(),this.unhighlightLinkTarget()},getQlinkKey:function(a){if(e.hasTag(a,"a")){var b=$(a).attr("id");if(b&&b.indexOf("qlink_")===0)return b.substring(6)}return null},handleInvalidLink:function(a,b,c){this.handleLinkAdded(a,b,c,"href")},handleEmailLink:function(a,b,c){var d=this.interface_strings.send_email.replace("{}",a.title);this.handleLinkAdded(a,b,c,"href",d)},handleLinkAdded:function(a,b,c,d,f){var g=this,h=document.activeElement==g.editor.get(0),i=a.title||c;i===b&&(d=d||"text",d==="text"&&(f=f||this.getDefaultText(b),i=f)),f=f||i,g.findTextAndModify(c,function(a){if(g.linkAlreadyDetected(c,a))return!1;var j=g.getLinkParent(a);return e.deleteContents(a.foundStart,a.foundEnd),g._qed.modify(function(e,h){var k=g.makeKey(),l="qlink_"+k;j?(g.moveSelectionOut(j,a.start,a.end),g.moveSelectionOut(j,a.foundStart,a.foundEnd),g.moveSelectionOut(j,e,h)):j="<a>",j=$(j),j.attr("id",l),j.text(i),j.addClass("qlink"),j.attr(g.getAttrName("text"),f),j.attr(g.getAttrName("href"),b),j.attr(g.getAttrName("delete"),c),g.setOption(j,d||"text"),$(a.foundStart).after(j)},h),!0})},getDefaultText:function(a){var b=this.getHostName(a.toLowerCase());if(!b)return a;var c=b.split("."),d=c.slice(-1)[0].match(/com|net|org|edu|gov/i)?2:3;c=c.slice(-d);var e=c.join(".");return this.interface_strings.page_on_domain.replace("{}",e)},getHostName:function(a){var b=a.match(/^https?:\/\/([^/]+)/i);return b?b[1]:null},removeLinkClasses:function(a){var b=this;$.each(this.options,function(c,d){var e=b.getClassName(d);$(a).removeClass(e)})},getOption:function(a){var b,c=this;return $.each(this.options,function(d,e){$(a).hasClass(c.getClassName(e))&&(b=e)}),b},setOption:function(a,b){this.removeLinkClasses(a),$(a).addClass(this.getClassName(b))},getValue:function(a,b){return $(a).attr(this.getAttrName(b))},setValue:function(a,b,c){return $(a).attr(this.getAttrName(b),c)},getLinkHtml:function(a){return i.cleanInnerHTML(a)},initNonDetectedLink:function(a){var b=this.makeKey(),c="qlink_"+b;a=$(a);var d=a.attr("href");if(!d||$.trim(d).length===0||d==="#"){var e=a.attr(this.getAttrName("href"));d=e||"http://..."}var f=this.getLinkHtml(a[0]);if(!f||$.trim(f).length===0)f=d;if(this._retrievingUrlInfo[d]||this._retrievingUrlInfo[f])return!1;a.attr("id",c),a.attr(this.getAttrName("text"),f),a.attr(this.getAttrName("href"),d),a.html(f),a.addClass("qlink");var g=this.getOption(a);return g||this.setOption(a,"text"),!0},initLinkSelectorLink:function(a){a=$(a);if(a.attr(this.getAttrName("text"))||this.getOption(a))return!0;var b=this.getQlinkKey(a[0]);if(!this.qlink_data[b])return!0;if(this.editingLink&&b===this.$("#@qlink_key").val())return!1;var c=this.getValue(a,"href");if(!c||c==="#"||c.length===0)c=this.qlink_data[b].target.url;var d=this.getLinkHtml(a[0]);return this.setValue(a,"href",c),this.setValue(a,"text",d),this.setValue(a,"delete",d),this.setOption(a,"text"),!0},qlinkSync:function(){this._super.apply(this,arguments);var a=this.$("#@qlink_key").val(),b=this.$("#@qlink_text").val(),c=this.$("#@editor #qlink_"+a);if(!b||!a||!c)return;var d=this.getLinkSelector().result;if(!d)return;this.initLinkSelectorLink(c)},detectNewLinkElement:function(a){a=$(a);var b=this.getQlinkKey(a[0]);return b&&a.attr(this.getAttrName("text"))?!0:this.qlink_data[b]?this.initLinkSelectorLink(a):this.initNonDetectedLink(a)},detectNewLinkElements:function(){var a=this;this.$("#@editor a").each(function(b,c){a.detectNewLinkElement(c)})},handleLinkOption:function(a){var b=this,c=b.linkTarget,d=b.getQlinkKey(c);if(!d)return b.editor.focus(),!1;if(b.getOption(c)===a)return b.editor.focus(),!1;var e=b.getValue(c,a);return b.unhighlightLinkTarget(c),b._qed.modify(function(){b.updateLinkText(c,d,e,a),b.setOption(c,a),a==="delete"?$(c).removeClass("qlink"):$(c).addClass("qlink")},!0),b.highlightLinkTarget(c),b.highlightActiveButton(c),!1},updateLinkText:function(a,b,c,d){var e=this.getOption(a),f=this,g;this._qed.modify(function(b,e){f.moveSelectionOut(a,b,e),g=f.getPreviousValue(a),d!=="href"?$(a).html(c):$(a).text(c)},!0),this.setValue(a,e,g)},getPreviousValue:function(a){var b,c=this.getOption(a);return c!=="href"?b=this.getLinkHtml(a):b=$(a).text(),b},containsSelection:function(a,b,c){return $.contains(a,b)||$.contains(a,c)},moveSelectionOut:function(a,b,c){this.containsSelection(a,b,c)&&$(a).after(b).after(c)}});a.ThreadMessageQTextEditor=o.extend({onLoad:function(){this.is_disabled=!1,this._super.apply(this,arguments),this.setTypingStateCallback(this.fnbind(function(a){this.serverCall("typing").kwargs({thread_id:this.thread_id,state:a}).send()})),this.focusOnload&&this.focus(),this.adjustThreadDetailHeight()},request:function(){if(this.is_disabled||this.isEmpty()&&!this.plaintext)return!1;var a={};a.thread_id=this.thread_id,a.object_id=this.object_id,this.isEmpty()&&this.plaintext?a.msg={html:this.editor.val()}:a.msg=this.serialize(),require("w2.rpc"),require("webnode2").rpc("/thread/"+this.ajax_POST).kwargs(a).liveMutate().success(this.fnbind(function(){this.cleanUp()})).send(),this.disable()},disable:function(){this.is_disabled=!0,this.editor.addClass("qtext_editor_content_disabled")},cleanUp:function(){this.is_disabled=!1,this.editor.removeClass("qtext_editor_content_disabled"),this.clear(),this.blur(),this.focus()},editorInputChange:function(){this._super.apply(this,arguments),this.adjustThreadDetailHeight()},adjustThreadDetailHeight:function(){this.lookup("messages_main_base").$("#@thread_detail").css("padding-bottom",this.lookup("compose_box").$("#@compose_box_container").outerHeight())},resetThreadDetailHeight:function(){this.lookup("messages_main_base").$("#@thread_detail").removeAttr("style")}}),a.TCommentQTextEditor=o.extend({onLoad:function(){function c(c){c||!b?a.$("#@qtext_editor_buttons_wrapper").toggle(c):b&&(b=!1,a.focus())}var a=this,b;a._super.apply(a,arguments),a.editor.focus(function(){c(!0)}).blur(function(){c(!1)}),a.$("#@qtext_editor_buttons_wrapper").mousedown(function(){b=!0}),a.setMeaningfulChangeCallback(a.fnbind(function(){a.save_draft(!1)}))},save_draft:function(){this.serverCall("save_draft_auto").kwargs({content:this.serialize(),window_id:require("webnode2").windowId,draft_space:this.draft_space}).send()}}),a.EmbedQtextEditor=o.extend({onUnload:function(){delete this.embedEditorDiv},onLoad:function(){this._super.apply(this,arguments);var a=this;a.url_attr_name="data-url",a.embed_data_attr_name="data-embed",a.embedEditorDiv=a.$("#@embed_editor"),a.last_embed_update=+(new Date),a.embedComponents={},a.placeholderImages={},a.overlays={},a.retrieveExistingEmbeds(),a.onLinkAdded(function(b){a.handleLinkAdded(b)}),a.onLinkFetchStart(function(){a.$("#@spinner").show()}),a.onLinkFetchEnd(function(){a.$("#@spinner").hide()}),a.editor.keydown(function(b){return a.embedEditorKeyDown(b)}),a.editor.bind("paste",function(){a.updateEmbedDetectedAttr(),a.detectEmbeds()}),a.editor.bind("cut",function(){a.detectEmbeds()})},clear:function(){var a=this,b;for(b in a.embedComponents)a.deleteComponent(b,!0);this._super.apply(this,arguments)},retrieveExistingEmbeds:function(){var a=this;$.each(this.idsToUrls,function(b){var c=a.editor.find("#"+a.imageId(b));a.placeholderImages[b]=c,a.markEmbedAsDetected(c);var d=a.embedEditorDiv.find("#"+a.overlayId(b));a.overlays[b]=d})},embedEditorKeyDown:function(){var a=this;return a.detectEmbeds(),!0},detectEmbeds:function(){var a=this;if(a.detectEmbedCallback)return;a.detectEmbedCallback=setTimeout(function(){a.detectAndRemoveDeletedComponents(),a.detectNewPlaceholderImages(),delete a.detectEmbedCallback},0)},imageId:function(a){return"embed_image_"+a},getImageInEditor:function(a){return this.editor.find("#"+this.imageId(a))},getImage:function(a){var b=this.getImageInEditor();return b.length&&(this.placeholderImages[a]=b),this.placeholderImages[a]},overlayId:function(a){return"embed_overlay_"+a},getOverlay:function(a){return this.overlays[a]},detectAndRemoveDeletedComponents:function(){var a=this;a.getEmbedComponents(function(b){var c=a.editor.find("#"+a.imageId(b));a.isInEditor(c)||a.deleteComponent(b,!0)}),a.updateEmbedComponentPositions()},isInEditor:function(a){return a=$(a),a=a&&a.length?a[0]:null,a?this.editor.length===0?!1:e.contains(this.editor[0],a):!1},deleteComponent:function(a,b){var c=this,d=this.embedComponents[a],e=this.getOverlay(a),f=this.getImage(a);delete this.embedComponents[a],delete this.idsToUrls[a],delete this.overlays[a],delete this.placeholderImages[a],require("webnode2").unloadComponent(d.cid),e.forgetContents(),e.remove(),f&&(f.attr("height",0),f.attr("width",0),f.attr("embed_detected",0),c._qed.modify(function(){f.remove()}),c.updateEmbedComponentPositions()),b&&d.handleDeleted(),this.editor.focus()},getEmbedComponents:function(a){$.each(this.embedComponents,a)},getGuid:function(){var a=e.guid();return a.replace(/\./g,"")},handleLinkAdded:function(a){var b=this,c=a.url;if(c in b.seenUrls)return;var d=b.getGuid();b.seenUrls[c]=d,b.idsToUrls[d]=c;var e="embed_component_from_preview",f={preview:a};b.createAndPopulateOverlay(d,e,f)},createAndPopulateOverlay:function(a,b,c,d){var e=this,f=e.createOverlay(a);e.$("#@spinner").show(),e.serverCall(b).success(function(){e.$("#@spinner").hide()}).error(function(){e.$("#@spinner").hide(),d&&d.remove()}).contentFor(f,{parentCID:e.cid,useLoadingSpinner:!1}).kwargs(c).send()},markEmbedAsDetected:function(a){a.attr("embed_detected",this.last_embed_update)},updateEmbedDetectedAttr:function(){var a=this,b=this.last_embed_update;this.last_embed_update=+(new Date),this.$("#@editor img").each(function(c,d){d=$(d);if(d.attr("type")!=="embed")return;d.attr("embed_detected")==b&&a.markEmbedAsDetected(d)})},detectNewPlaceholderImages:function(){var a=this;this.$("#@editor img").each(function(b,c){c=$(c);if(c.attr("type")!=="embed")return;if(c.attr("embed_detected")==a.last_embed_update)return;var d=c.attr(a.url_attr_name),e,f=a.seenUrls[d];if(f){e=a.idsToUrls[f];if(e){c.remove(),setTimeout(function(){a.updateEmbedComponentPositions()},0);return}}else f=a.getGuid();c.attr("id",a.imageId(f)),a.markEmbedAsDetected(c),a.placeholderImages[f]=c;var g=JSON.parse(c.attr(a.embed_data_attr_name));d?e=d:e=g.url,a.seenUrls[e]=f,a.idsToUrls[f]=e;var h="embed_component_from_client_embed_data",i={url:e,embed_data:g};a.createAndPopulateOverlay(f,h,i,c)})},updateEmbedComponentPositions
:function(){var a=this;a.getEmbedComponents(function(b,c){a.updateEmbedComponentPosition(b,c)})},updateEmbedComponentPosition:function(a,b){if(b.positionUpdated){var c=this.getImage(a),d=$(c).offset(),e=this.embedEditorDiv.offset(),f=d.left-e.left,g=d.top-e.top,h=this.getOverlay(a),i=this.editor.width();b.positionUpdated(h,f,g,i)}},registerEmbedComponent:function(a,b,c){var d=this,e=d.seenUrls[b];d.embedComponents[e]=a;var f=this.placeholderImages[e];if(f&&!d.isInEditor(f)){this.getOverlay(e).hide(),setTimeout(function(){d.deleteComponent(e,!0)},0);return}f||d.createPlaceholderImage(e,b),d.setImageEmbedDataAttr(e,c),d.updatePlaceholderImageSize(e),f||d.insertPlaceholderImage(e),d.updateEmbedComponentPosition(e,a),a.initializeEmbedComponent(e,d.getImage(e),d.getOverlay(e)),d.updateEmbedComponentPositions()},createOverlay:function(a){var b=$("<div>",{id:this.overlayId(a)});return b.addClass("embed_overlay"),this.embedEditorDiv.append(b),this.overlays[a]=b,b},createPlaceholderImage:function(a,b,c){var d=this,e={src:d.spacerUrl,id:d.imageId(a),type:"embed"};e[d.url_attr_name]=b;var f=$("<img>",e);f.css("margin","0").css("padding","0").css("border","none"),d.markEmbedAsDetected(f),d.markImageAsDetected(f[0]),c&&c(f),this.placeholderImages[a]=f},insertPlaceholderImage:function(a){var b=this.getImage(a),c=$("<div>");c.append(b),this._qed.modify(function(a){var b=a.parentNode;b&&b.insertBefore(c[0],a)})},addImage:function(a){var b=this,c=new Image;c.onload=function(){b.updateEmbedComponentPositions(),$(c).remove()},c.src=a;var d=this._super.apply(this,arguments);return d},updatePlaceholderImageSize:function(a,b,c){var d=this.getOverlay(a),e=this.getImage(a);b=b?b:d.height(),c=c?c:d.width(),e.attr("height",b),e.attr("width",c)},setImageEmbedDataAttr:function(a,b){var c=this.getImage(a);c.attr(this.embed_data_attr_name,b)},notifySubmit:function(){}}),a.EmbedComponentBase=c.extend({registerWithParent:function(a,b){this.parent().registerEmbedComponent(this,a,b)},initializeEmbedComponent:function(a,b,c){this.id=a,this.img=b,this.overlay=c},dataChanged:function(a){this.setImageEmbedDataAttr(a),this.updatePlaceholderImageSize(),this.parent().updateEmbedComponentPositions()},setImageEmbedDataAttr:function(a){this.parent().setImageEmbedDataAttr(this.id,a)},componentDeleted:function(){this.parent().deleteComponent(this.id,!1)},updatePlaceholderImageSize:function(){var a=this.overlay.height(),b=this.overlay.width();if(this.previous_height!==a||this.previous_width!==b)this.parent().updatePlaceholderImageSize(this.id,a,b),this.previous_height=a,this.previous_width=b},positionUpdated:function(a,b,c,d){a.css("position","absolute").css("left",b).css("top",c).css("width",d)},handleDeleted:function(){}}),a.QuestionWizardQTextEditor=o.extend({onLoad:function(){this._super.apply(this,arguments)},editorInputChange:function(){this._super.apply(this,arguments),this.parent().onEditorInputChange&&this.parent().onEditorInputChange()}})},{"qed/edit":!0,"view/fixable2":!0,webnode2:!0,assert:!0,"qed/modifiers":!0,atexit:!0,"qed/npd":!0,linkify:!0,"qed/util":!0,"w2.quora":!0,spin:!0,find:!0,"w2.rpc":!0,browser:!0})}),require.whenReady("settings",function(){require.install("app/view/survey/question_page",function(require,a,b){var c=require("w2.quora").Component;a.Survey=c.extend({onLoad:function(){var a=this;a.bindSurveyDismissHandler(),a.bindSurveySubmitHandler(),a.serverCall("show_card").send()},bindSurveySubmitHandler:function(){var a=this;this.$("#@submit_form").on("click",function(){var b=a.$("#@survey_form").find("input[type='radio']:checked").val(),c=$(this).parents(".Survey"),d=a.$("#@response_input").val();typeof b!="undefined"&&a.serverCall("submit_survey").kwargs({selected_option:b,response_text:d}).success(function(){a.$("#@survey_wrapper").addClass("hidden"),a.$("#@feedback").removeClass("hidden"),c.hide()}).send()})},bindSurveyDismissHandler:function(){var a=this;this.$("#@dismiss").on("click",function(){a.$("#@survey").fadeOut(800),a.serverCall("dismiss_survey").send()})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("async_post",function(require,a,b){function d(a){function i(){e&&clearTimeout(e),e=setTimeout(j,f)}function j(){if(d.length===0)return;if(g){i();return}g=!0,h=d,d=[],c.rpc(a).kwargs({messages:h}).success(k).error(l).send()}function k(){h.length=0,g=!1}function l(){d=d.concat(h),h.length=0,g=!1}var b=this,d=[],e=null,f=500,g=!1,h=[];return b.send=function(a){d.push(a),i()},b}var c=require("webnode2");a.AsyncPost=function(a){return d(a)}},{webnode2:!0})}),require.whenReady("settings",function(){require.install("typeahead",function(require,a,b){function o(){return new Date}var c=require("simscroll"),d=require("window_manager"),e=require("cookies"),f=require("w2.quora").Component,g=require("html"),h=require("siteuri").URI,i=require("settings").keyboardShortcuts,j=require("email"),k=require("async_post").AsyncPost,l=require("e2e"),m=require("assert").ok,n=k("/ajax/typeahead_log_POST");a.TypeaheadResults=f.extend({onLoad:function(){this.focusedIndex=null,this.instructions=null,this.runSetup()},preventOverflow:function(){var a=this.$("#@results_frame"),b=a.offset().top,c=a.outerHeight(!0),e=b+c,f=$(window).scrollTop()+d.headerOffset,g=$(window).scrollTop()+$(window).height(),h=g-b,i=b-f,j;c&&$(document.body).height()<c&&$(document.body).height(c),i>500&&h<200?(a.addClass("inverted"),j=f-a.offset().top):j=e-g,j>0&&a.css({"overflow-y":"scroll",height:c-j})},runSetup:function(){for(var a=0;a<this.results.length;a++)this.setupListItem(a)},setupListItem:function(a){var b=this.$("#@list_item_"+a);b.addClass("needsclick"),this.$("#@list_item_"+a+" *").addClass("needsclick"),b.mouseover(this.fnbind(function(b){return this.setFocusIndex(a),!1})),b.mouseout(this.fnbind(function(){return this.setFocusIndex(null),!1})),b.mousedown(this.fnbind(function(b){return b.stopPropagation(),b.preventDefault(),this.goResult(a,b)}))},hideDropdown:function(a,b){var c=this.$("#@results_frame");a?(this.parent().shouldAnimateShowDropdown=!0,c.removeClass("fade_in").addClass("fade_out"),setTimeout(function(){c.removeClass("is_shown").removeClass("fade_out"),b&&b()},150)):(c.removeClass("is_shown"),b&&b())},showDropdown:function(a,b){if(this.results.length){var c=this.$("#@results_frame");this.parent().shouldAnimateShowDropdown&&(a=!0,this.parent().shouldAnimateShowDropdown=!1),a?(c.hasClass("fade_in")||c.addClass("is_shown").addClass("fade_in"),setTimeout(function(){b&&b()},150)):c.addClass("is_shown"),this.preventOverflow()}},isVisible:function(){var a=this.$("#@results_frame");return a.is(":visible")&&a.css("visibility")!="hidden"},hide:function(){this.hideDropdown(!0),this.setFocusIndex(null)},getResult:function(a){return this.results[a]},logData:function(a){if(this.query&&this.log_data_json){var b={data:this.log_data_json,click_index:a};n.send(b)}},goResult:function(a,b){this.logData(a);if(this.actionType=="url")d.handleClick(this.actionOfIndex[a],b);else{if(this.actionType=="value")return this.hide(),this.qValue=this.actionOfIndex[a],this.parent().setValue(this.qValue,this.results[a]),!1;m(0)}},down:function(){this.focusedIndex===null?this.setFocusIndex(0):this.focusedIndex<this.nResults-1?this.setFocusIndex(this.focusedIndex+1):this.focusedIndex==this.nResults-1&&this.setFocusIndex(null)},up:function(){this.focusedIndex===null?this.setFocusIndex(this.nResults-1):0===this.focusedIndex?this.setFocusIndex(null):0<this.focusedIndex&&this.setFocusIndex(this.focusedIndex-1)},go:function(a){return this.focusedIndex!==null?(this.goResult(this.focusedIndex,a),!0):!1},setFocusIndex:function(a,b){if(this.empty)return;var c=this.$("#@list_item_"+a);this.focusedIndex!==null&&this.$("#@list_item_"+this.focusedIndex).removeClass("selected");if(c.hasClass("instruction")){b&&b.cancelIfSelectingInstruction||this.focusedIndex===a+1?this.focusedIndex=null:this.setFocusIndex(a+1);return}if(c.length===0){this.focusedIndex=null;return}if(a!==null){c.addClass("selected");var d=$(window),e=d.scrollTop(),f=c.offset().top+c.height()+20-(e+d.height());f>0&&d.scrollTop(e+f)}this.focusedIndex=a}}),a.NavigatorResults=a.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments),this.cookieSet=!1},setCookieHelper:function(a,b){this.cookieSet||(this.cookieSet=!0,e.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,a]),e.setSingleUse("q",JSON.stringify(this.query)))},goResult:function(a,b){var c=a;this.query&&this.numMatches>0&&(c>=this.numMatches&&(c=-1),this.cookieSet||(this.cookieSet=!0,e.setMessage("qrl",[require("webnode2").windowId,this.query,this.matchTargetsJson,this.contextTid,c]),e.setSingleUse("q",JSON.stringify(this.query)))),this._super.apply(this,arguments)}}),a.FullNavigatorResults=a.NavigatorResults.extend({onLoad:function(a){this._super.apply(this,arguments),(a||!this.query)&&this.hideDropdown(),this.focusedIndex=null,this.instructions=null,this.forceOpenResults=!1,this.openResultsLinkInNewTab=this.parent().openResultsLinkInNewTab(),this.openResultsLinkInNewTab||this.runSetup()},hideDropdown:function(a,b){this.forceOpenResults||(this._super.apply(this,arguments),this.parent().parent().$("#@results_tray").hide())},hide:function(){this.hideDropdown(!0),this.forceOpenResults||this.setFocusIndex(null)},showDropdown:function(a,b){if(this.results.length){this.$("#@results_frame").show();var c=null,d=this.parent().parent().$("#@results_tray");if(this.results.length<=1)c=35;else{var e=Math.max(375,this.results.length*35);c=e}d.show(),parseInt(d.height(),10)!==parseInt(c,10)&&d.css("height",c+"px")}},goResult:function(a,b){this.forceOpenResults=!0,this.actionType=="url"?(this.setCookieHelper(a,b),this.$("#@list_item_"+a).hasClass("addquestionitem")?this.parent().addQuestionClick():d.handleClick(this.actionOfIndex[a],b)):m(0)},go:function(a){return this.forceOpenResults=!0,this.focusedIndex!==null?(this.$("#@list_item_"+this.focusedIndex).hasClass("addquestionitem")?this.parent().addQuestionClick():this.goResult(this.focusedIndex,a),!0):!1},down:function(){this.focusedIndex===null?this.setFocusIndex(0):this.focusedIndex<this.nResults-1?this.setFocusIndex(this.focusedIndex+1):this.focusedIndex===this.nResults-1&&(this.highlightAddQuestion?this.setFocusIndex(0):this.setFocusIndex(null))}}),a.InlineQuestionsNavigatorResults=a.FullNavigatorResults.extend({onLoad:function(a){this._super.apply(this,arguments);for(var b=0;b<this.results.length;b++)this.bindListItem(b)},bindListItem:function(a){this.$("#@list_item_"+a).click(this.fnbind(function(){this.serverCall("log_question_click").send()}))}}),a.Typeahead=f.extend({onLoad:function(){this.qValue=this.initialValue,this.result=null,this.requestOutstanding=!1,this.closed=!1,this.selectionChosen=!1,this.selectionlessCallback=null,this.placeholderActive=!1,this.extraKeydown=null,this.userClicked=!1,this.shouldAnimateShowDropdown=!0,this.simulateScroll=!0;var a=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",g.decode(a)),this.$("#@view_selector").click(this.fnbind(function(){return this.$("#@selector_wrapper").removeClass("hidden"),this.$("#@view_selector_wrapper").addClass("hidden"),this.focus(!0),!1}));var b=this;b.data||(b.data={}),b.$("#@input").focus(function(){$(this).attr("focused","true"),b.inputFocus(),b.extraFocus&&b.extraFocus()}).blur(function(){b.$("#@results_shell").children(".results_frame:hover").length?b.$("#@input").focus():($(this).removeAttr("focused"),b.inputBlur(),b.userClicked=!1)}).keydown(function(a){return b.inputKeydown(a)}).keyup(function(a){return b.inputKeyup(a)}).keypress(function(a){if(a.which==13||a.which==27)return a.stopPropagation(),a.preventDefault(),!1}).click(function(){b.userClicked=!0})},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},requestUpdate:function(){this.requestOutstanding=!0,this.requestStartTime=o();var a=this.getRequestUpdatePostData();a.___W2_parentId=this.cid,a.___W2_windowId=require("webnode2").windowId;var b=$.param(a).replace(/\+/g,"%20"),c=l.startAction({url:d.getURL(),vcon:this.fakeVcon,method:this.fakeMethod,mustReport:Math.random()<l.SAMPLE_RATE,server_time:1,standard:{server_side:100,e2e:200,owner:6}}),e=this.fnbind(function(){$.ajax({type:"GET",url:this.resultsQueryPath,dataType:"json",data:b,success:this.fnbind(function(a){l.finishAction(c.id),this.ajaxCallback(a)}),error:this.fnbind(function(a,b,c){this.requestOutstanding=!1})})});!a||a.q.length===0?this.child("results").hideDropdown(!0,e):e()},close:function(){this.closed=!0,this.child("results").hide()},clear:function(){this.clearInput(),this.close()},clearInput:function(){this.$("#@input").val(""),this.$("#@input").get(0).style.backgroundColor="#fff"},reset:function(){this.qValue=this.initialValue,this.clearInput(),this.result=null},resetFocus:function(){this.reset(),this.requestUpdate(),this.focus(),this.inputFocus()},setCallback:function(a){var b=this.callback;if(!b)b=a;else{var c=b;b=function(){c(),a()}}this.callback=b},setSelectionlessCallback:function(a){var b=this.selectionlessCallback;if(!b)b=a;else{var c=b;b=function(){c(),a()}}this.selectionlessCallback=b},setExtraFocus:function(a){this.extraFocus=a},setExtraKeydown:function(a){this.extraKeydown=a},setValue:function(a,b){this.qValue=a,this.$("#@input").val(this.qValue),this.result=b;var c=this.$("#@input");this.selectionChosen=!0,this.callback&&this.callback()},getValue:function(){return this.placeholderActive?"":this.$("#@input").val()},ajaxCallback:function(a){var b=o();if(!this.requestOutstanding)return;this.requestOutstanding=!1;if(this.closed)return;if(!this.child("results"))return;require("webnode2").unloadComponent(this.child("results").cid),this.$("#@results_shell").setContent(a),!this.child("results").empty&&(this.child("results").query||this.always_show_dropdown_on_results)&&this.child("results").showDropdown(),this.child("results").query!=this.qValue&&this.requestUpdate(),this.shouldHighlightFirstResult()&&this.child("results").setFocusIndex(0,{cancelIfSelectingInstruction:!0}),this.child("results").highlightAddQuestion&&this.child("results").setFocusIndex(this.child("results").results.length-1,{cancelIfSelectingInstruction:!0}),this.parent().typeaheadUpdateReturned&&this.parent().typeaheadUpdateReturned(),this.openResultsLinkInNewTab&&this.$("#@results_shell").find('a[href!="#"]').attr("target","_blank")},openResultsLinkInNewTab:function(){return!1},shouldHighlightFirstResult:function(){return this.minAutoFocusIndexLength&&this.qValue.length<this.minAutoFocusIndexLength||this.child("results").highlightFirst},inputKeydown:function(a){var b=this.$("#@input"),d=b.val();if(this.simulateScroll&&!this.child("results").isVisible()&&!this.requestOutstanding&&c.maybeSimulateScroll(a))return b.blur(),!1;c.cancelSimulatedScroll();if(a.keyCode==40)return this.requestOutstanding=!1,this.child("results").down(),!1;if(a.keyCode==38)return this.child("results").up(),!1;if(a.keyCode==27)return this.child("results").hide(),this.userClicked=!1,!1;if(a.keyCode==13){if(this.child("results").go(a))return!1;if(this.selectionlessCallback&&this.selectionlessCallback())return!1}return this.extraKeydown?this.extraKeydown(a.keyCode):!0},inputKeyup:function(){return this.onInputChange(),!1},onInputChange:function(){var a=this.getValue();if(a==this.qValue)return;this.qValue=a,this.requestOutstanding||this.requestUpdate(),this.qValue===""&&(this.closed=!1)},inputBlur:function(){this.setPlaceholder(),this.blurFakeInput(),this.child("results")&&!this.no_hide_on_blur&&this.child("results").hide()},disable:function(){this.close(),this.$("#@input").attr("disabled","disabled"),this.$("#@input").css("background","#e0e0e0")},enable:function(){this.$("#@input").attr("disabled",!1),this.$("#@input").css("background","#fff")},setText:function(a){var b=this.$("#@input").val();b!=a&&(this.$("#@input").val(a),this.onInputChange())},setPlaceholder:function(){var a=this.$("#@input").attr("placeholder");a&&!this.getValue()&&(this.placeholderActive=!0,this.$("#@input").addClass("light"),this.$("#@input").val(a))},removePlaceholder:function(){this.placeholderActive&&(this.placeholderActive=!1,this.$("#@input").removeClass("light"),this.clearInput())},focus:function(a){if(!a)if(window.getSelection){if(window.getSelection().rangeCount>0)return}else if(document.selection&&document.selection.createRange())return;if(!this.$("#@input").is(":visible"))return;this.$("#@input").attr("focused",!0),this.closed=!1,this.$("#@input").focus(),this.removePlaceholder()},inputFocus:function(){this.$("#@input").attr("focused",!0),this.removePlaceholder(),this.$("#@input").get(0).style.backgroundColor="",this.focusFakeInput(),this.selectionChosen?(this.selectionChosen=!1,this.result=null,this.requestUpdate()):(!this.focusOnLoad||this.userClicked&&this.focusOnLoad)&&this.showResultsDropdown()},focusFakeInput:function(){this.$("#@input").closest(".search_input").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".search_input").removeClass("focus")},showResultsDropdown:function(){this.child("results").showDropdown()},hideResultsDropdown:function(){this.child("results").hideDropdown(!0)},cursorPosition:function(a){var b=a.get(0),c=null;if(b.selectionStart!==undefined)b.selectionStart==b.selectionEnd&&(c=b.selectionStart);else if(document.selection){var d=document.selection.createRange().duplicate();d.text===""&&(d.moveEnd("character",b.value.length),d.text===""?c=b.value.length:c=b.value.lastIndexOf(d.text))}return c},addIgnoreOid:function(a){typeof this.data.ignore_oids=="undefined"&&(this.data.ignore_oids=[]),this.data.ignore_oids.push(a)},removeIgnoreOid:function(a){typeof this.data.ignore_oids=="undefined"&&(this.data.ignore_oids=[]);var b=this.data.ignore_oids.indexOf(a);b>-1&&this.data.ignore_oids.splice(b,1)}}),a.ContextTypeahead=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.width=this.$("#@input").outerWidth(),this.paddingRight=parseInt(this.$("#@input").css("paddingRight").replace("px",""),10),this.orgPlaceholder=this.$("#@input").attr("placeholder"),this.child("context")&&this.child("context").setDefault&&(this.child("context").setDefault(),this.context_dict.id&&this.clearInstruction()),this.child("context")&&this.child("context").hasContext()&&this.showClearButton(),this.$("#@clear").click(this.fnbind(function(){return this.reset(),this.resetContext(),this.clearInstruction(),this.$("#@input").focus(),!1})),this.setExtraKeydown(this.fnbind(function(a){if(a==9){var b=this.child("results").focusedIndex?this.child("results").focusedIndex:0,c=this.child("results").getResult(b);if(c&&c.text)return this.clearInstruction(),this.context_dict={type:c.type,id:c.id},this.child("context").setContext(c.text,c.url),this.$("#@input").val(""),this.showClearButton(),!1}else if(a==8){var d=this.$("#@input");(d.val()===""||this.cursorPosition(d)===0)&&this.resetContext()}return!0})),this.setExtraFocus(this.fnbind(function(){this.$("#@input_wrapper").css("background-color","#fff")})),this.focusOnLoad?this.focus():this.setPlaceholder()},showClearButton:function(){this.$("#@clear").show()},hideClearButton:function(){this.$("#@clear").hide()},clearInstruction:function(){this.$("#@input").attr("placeholder",""),this.removePlaceholder()},resetContext:function(){this.context_dict={},this.child("context").removeContext(),this.$("#@input").attr("placeholder",this.orgPlaceholder),this.hideClearButton(),this.requestUpdate()},getRequestUpdatePostData:function(){var a={q:this.qValue,context_type:this.context_dict.type,context_id:this.context_dict.id,data:JSON.stringify(this.data)};return a}}),a.MultiSelectTypeahead=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments);var b=this;b.data.partial_results=null,b.qValues=[],b.results=[],b.count=0,b.input=b.$("#@input"),b.$("#@multi_select_typeahead").click(function(){b.input.focus()}),b.input.keypress(function(a){a.which===13&&(b.input.attr("focused",!1),b.child("results").hide(),a.preventDefault())}),b.input.keydown(function(a){if(a.which===8&&b.input.val()===""&&b.qValues.length>0){var c=b.qValues.length-1;while(c>=0&&!(c in b.qValues))c--;c in b.qValues&&(b.remove(c),b.child("token_list").$("#@item"+c).hide())}b.fixWidth()}),b.input.bind("paste",b.fnbind(b.fixWidth))},fixWidth:function(){var a=350,b=50,c=12;this.count===0?this.input.width(a):this.input.width(Math.min(a,Math.max(b,c*this.input.val().length)))},setValue:function(a,b){this.qValue=a,this.input.val(this.qValue),this.result=b;if($.inArray(this.qValue,this.qValues)!=-1){this.reset();return}this.qValues.push(this.qValue),this.results.push(this.result),this.data.partial_results=this.results,this.updateContainer(),this.count++,this.child("token_list").addItem(this.result.text,this.qValues.length-1),this.input.attr("placeholder",""),this.fixWidth(),this.input.hasClass("maintain_background_white")||this.input.css("background-color","#eee"),this.selectionChosen=!0,this.callback&&this.callback(),this.reset()},remove:function(a){delete this.qValues[a],delete this.results[a],this.updateContainer(),this.count--,this.count===0&&this.input.attr("placeholder",this.placeholder)},updateContainer:function(){var a=this;this.lookup("typeaheadContainer").updateValues($.grep(this.qValues,function(b,c){return c in a.qValues}))},clear:function(){var a=this;$.each(a.qValues,function(b,c){delete a.qValues[b],delete a.results[b],a.child("token_list").$("#@item"+b).hide()}),a.count=0,a.input.attr("placeholder",a.placeholder),a.resetFocus(),a.fixWidth(),a.updateContainer()},focusFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").addClass("focus")},blurFakeInput:function(){this.$("#@input").closest(".multi_select_typeahead").removeClass("focus")}}),a.MultiSelectTokenList=f.extend({attachRemoveClickHandler:function(a){this.$("#@remove"+a).click(this.fnbind(function(a){return this.parent().remove(a),this.parent().fixWidth(),this.parent().input.focus(),this.$("#@item"+a).hide(),!1},a))},cloneItem:function(a){var b=this.$("#@item"+a).clone(),c=b.attr("id");b.attr("id",this.constructNextId(c,a));var d=$(".token_remove",b),e=d.attr("id");d.attr("id",this.constructNextId(e,a));var f=$(".token_name_text",b),g=f.attr("id");return f.attr("id",this.constructNextId(g,a)),this.attachRemoveClickHandler(a),b},constructNextId:function(a,b){var c=a.lastIndexOf(b),d=a.slice(0,c)+(b+1);return d},addItem:function(a,b){this.cloneItem(b).appendTo(this.$("#@token_list")),this.$("#@text"+b).text(a),this.$("#@item"+b).css("display","inline-block")}}),a.TopicSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.lookup("topic_add").select(),this.type!="to_tid"&&this.type!="replace_topic"&&this.reset()})),this.simulateScroll=!1},shouldHighlightFirstResult:function(){return this._super.apply(this,arguments)&&this.child("results").nResults>1},addTempTopic:function(a){this.$("#@temp_topics_list").append(a),this.parent().$("#@update").show(),this.parent().onAddTempTopic&&this.parent().onAddTempTopic()},resetTempTopics:function(a){this.$("#@temp_topics_list").text("")},hideSelector:function(){this.$("#@selector_wrapper").addClass("hidden"),this.$("#@view_selector_wrapper").removeClass("hidden"),this.$("#@view_selector").focus()}}),a.Navigator=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@add_new_question").click(this.fnbind(function(){return this.lookup("add_question").openDialog(this.qValue),!1})),this.setSelectionlessCallback(this.fnbind(function(){this.lookup("add_question").openDialog(this.qValue)}))}}),a.FullNavigator=a.ContextTypeahead.extend({onLoad:function(){this._super.apply(this,arguments),this.$("#@input").keydown(this.fnbind(function(a){this.keydownHandler(a)})),this.$("#@input").blur(this.fnbind(function(){this.hideAddQuestionNote()})),this.$("#@input").focus(this.fnbind(function(){this.hideAddQuestionNote()})),this.$("#@add_new_question").click(this.fnbind(function(){return this.addQuestionClick(),!1})),this.$("#@placeholder").hover(this.fnbind(function(){this.hideInstructionPlaceholder()})),this.$("#@input").click(this.fnbind(function(){return this.focus(!0),!1})),this.setSelectionlessCallback(this.fnbind(function(){})),this.open_add_question_dialog_on_load&&this.lookup("add_question").openDialog(this.qValue),this.focusOnLoad&&this.showInstructionPlaceholder(this.translated_instruction_placeholder)},keydownHandler:function(a){a.keyCode!=13&&this.hideAddQuestionNote()},hideAddQuestionNote:function(){this.hideInstructionPlaceholder(),this.lookup("add_question_note").$("#@note").hide()},addQuestionClick:function(){this.child("results").hide(),this.lookup("add_question").setTid(this.getTopic()),this.lookup("add_question").openDialog(this.qValue)},showInstructionPlaceholder:function(a){!this.$("#@input").val()&&!this.context_dict.id&&(this.$("#@placeholder").text(a),this.$("#@placeholder").show())},hideInstructionPlaceholder:function(){this.$("#@placeholder").hide()},getTopic:function(){return this.context_dict&&this.context_dict.type=="topic"?this.context_dict.id:null}}),a.InlineQuestionsNavigator=a.FullNavigator.extend({onLoad:function(){this._super.apply(this,arguments)},inputBlur:function(){this.setPlaceholder(),this.blurFakeInput()},addQuestionClick:function(){this.parent().addQuestion()}}),a.SearchPageInlineQuestionsNavigator=a.InlineQuestionsNavigator.extend({onLoad:function(){this.loaded=!1,this._super.apply(this,arguments),this.$("#@input").focus(this.fnbind(function(){this.loaded||(this.requestUpdate(),this.loaded=!0)})),this.simulateScroll=!1},keydownHandler:function(a){this._super.apply(this,arguments),a.keyCode>=48&&a.keyCode<=90&&this.$("#@results_shell").slideDown(100)},close:function(){this._super.apply(this,arguments),this.$("#@results_shell").slideUp(100)},openResultsLinkInNewTab:function(){return!0},addQuestionClick:function(){}}),a.InlineTopicsNavigator=a.InlineQuestionsNavigator.extend({onLoad:function(){this._super.apply(this,arguments),this.extraKeydown=null,this.simulateScroll=!1},inputBlur:function(){this.setPlaceholder(),this.blurFakeInput(),this.child("results")&&!this.no_hide_on_blur&&this.child("results").$("#@results_frame").hide()}}),a.RedirectQuestionSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.$("#@input").val($.trim($("<div>"+this.result.html+"</div>").text())),this.parent().$("#@to_qid").val(this.qValue),this.serverCall("question_redirect_preview").kwargs({to_qid:this.qValue}).contentFor(this.parent().$("#@question_redirect_preview"),{parentCID:this.cid}).send(),this.$("#@input").blur()}))}}),a.WantedAnswerSelector=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.setCallback(function(b){a.to_uid=a.qValue,a.lookup("wanted_answer_suggestions").setTo(a.to_uid,b)})},setValue:function(a,b,c){this.qValue=a,this.result=b,this.selectionChosen=!0,this.callback&&this.callback(c)}}),a.WantedAnswerSelectorResults=a.TypeaheadResults.extend({goResult:function(a,b){if(b.target.classList.contains("ask_to_answer")||b.type==="keydown"&&b.keyCode===13){var c=$(b.target).parents("li");return this.logData(a),this.qValue=this.actionOfIndex[a],this.lookup("wanted_answer_selector").setValue(this.qValue,this.results[a],c),this.updateResultItem(c),!1}},updateResultItem:function(a){a.children(".text_col.asked").removeClass("hidden"),a.children(".text_col.ask").addClass("hidden"),a.children(".ask_button_column").addClass("hidden")}}),a.FeedControlSelectorResults=a.TypeaheadResults.extend({goResult:function(a,b){var c=this,d=$(b.target).parents("a");d&&(d.hasClass("pressed")?(d.removeClass("pressed"),d.children("span").text(c.follow_text)):(d.addClass("pressed"),d.children("span").text(c.unfollow_text)))}}),a.PeopleSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.to_uid=this.qValue,this.reset(),this.parent().setTo(this.to_uid)})),this.parent().allow_selectionless_input&&this.setSelectionlessCallback(this.fnbind(function(){this.to_uid=this.qValue,this.reset(),this.parent().setTo(this.to_uid)}))}}),a.EndorsementSelector=a.PeopleSelector.extend({addQuestionBoxClass:function(a){this.$("#@input").addClass(a)}}),a.ContactsSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.setEmail(this.qValue)})),this.allow_selectionless_input&&this.setSelectionlessCallback(this.fnbind(function(){this.setEmail(this.qValue)})),this.trigger_selection_on_blur&&this.$("#@input").blur(this.fnbind(function(){var a=this.$("#@input").val();a&&a!=this.placeholder&&this.setEmail(a)})),this.$("#@input").keypress(this.fnbind(function(a){a.which==13&&(this.$("#@input").attr("focused",!1),this.child("results").hide(),a.preventDefault())}))},setEmail:function(a){this.parent().setTo(a),this.forceReset&&this.reset()}}),a.LinkSelector=a.Typeahead.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;this.simulateScroll=!1,a.$("#@input").keydown(function(){if(a._escKeyDown)return a._escKeyDown.apply(this,arguments)}),a.$("#@input").keyup(function(b){if(a._keyUp)return a._keyUp.apply(this,arguments)})},setEscKeyDown:function(a){this._escKeyDown=a},setKeyUp:function(a){this._keyUp=a}}),a.BoardSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.qValue=this.bid?this.bid:null,this.simulateScroll=!1,this.$("#@fake_input").click(this.fnbind(function(){return this.clearInput(),!1})),this.setSelectionlessCallback(function(){this.child("results").hideDropdown(),this.focusNext()}),this.setCallback(this.fnbind(function(){var a=this.getBid();if(!a){this.$("#@input").css("background","#fff"),this.focusNext();return}this.swapInput(a)})),this.$("#@input").click(this.fnbind(function(a){a.stopPropagation()})),this.child("results").$("#@results_frame").click(this.fnbind(function(a){a.stopPropagation()})),$(document).click(this.fnbind(function(){this.child("results")&&this.child("results").hide()}))},inputBlur:function(){this.setPlaceholder()},setInput:function(a){this.setValue(a),this.swapInput(a)},swapInput:function(a){this.$("#@input_wrapper").hide(),this.$("#@fake_input").show(),this.selectionChosen=!1,this.serverCall("update_preview").kwargs({bid:a}).contentFor(this.$("#@fake_input"),{parentCID:this.cid}).send(),this.focusNext()},focusNext:function(){try{this.cQuery(":editor.editor")&&this.cQuery(":editor").showEditor()}catch(a){}},resetFakeInput:function(){this.qValue=this.initialValue,this.$("#@fake_input").hide(),this.$("#@input_wrapper").show(),this.$("#@input").val(""),this.$("#@input").css("background","#fff")},clearInput:function(a){this.resetFakeInput(),this.focus(!0),this.child("results").showDropdown()},getText:function(){var a=this.$("#@input").val();return a==this.$("#@input").attr("placeholder")?null:a},getBid:function(){return isNaN(this.qValue)?null:this.qValue}}),a.PeopleAndSocialContactsSelector=a.Typeahead.extend({onLoad:function(a){this._super.apply(this,arguments),this.setCallback(this.fnbind(function(){this.result&&this.result.text?this.setUserOrEmail(this.qValue,this.result.text):this.setUserOrEmail(this.qValue,this.qValue)})),this.allow_selectionless_input&&this.setSelectionlessCallback(this.callback),this.trigger_selection_on_blur&&this.$("#@input").blur(this.fnbind(function(){var a=this.$("#@input").val();a&&a!=this.placeholder&&this.setUserOrEmail(a,a)})),this.$("#@input").keypress(this.fnbind(function(a){a.which==13&&(this.$("#@input").attr("focused",!1),this.child("results").hide(),a.preventDefault())}))},setUserOrEmail:function(a,b){typeof a=="string"&&a.indexOf("@")>=0?this.parent().setEmailTo(a,b):typeof a=="number"&&this.parent().setUserTo(a,b),this.reset()}}),a.PeopleAndSocialContactsMultiSelector=a.MultiSelectTypeahead.extend({onLoad:function(a){this._super.apply(this,arguments);var b=this;b.allow_selectionless_input&&b.setSelectionlessCallback(b.fnbind(b.setWithoutSelection)),b.trigger_selection_on_blur&&b.input.blur(b.fnbind(b.setWithoutSelection))},setWithoutSelection:function(){this.qValue&&j.isValidEmail(this.qValue)&&this.setValue(this.qValue,{type:"contact",value:this.qValue,text:this.qValue})},updateContainer:function(){var a=this;this.lookup("socialTypeaheadContainer").updateResults($.grep(this.results,function(b,c){return c in a.results&&b.type!=="instruction"}))}}),a.SearchSuggestions=a.TypeaheadResults.extend({onLoad:function(){this._super.apply(this,arguments);var a=this.$(".full_search.instant_results").width();this.$("#@results_frame").css("width",a)},hide:function(){this.hideDropdown(!0),this.forceOpenResults||this.setFocusIndex
(null)},goResult:function(a,b){if(this.actionType=="url"){this.serverCall("log_navigator_click").kwargs({query_hash:this.query_hash,index:a}).send(),this.setCookies();var c=this.results[a].type||null;if(c=="addquestionitem"){var f=this.results[a].question,g=this.parent().lookup("wizard");g.close();var h=this.results[a].query||null,i=f;g.open(f,!1,!1,h,i,"skip_1");return}var j=this.query_type;j=="all"?e.setSingleUse("q",JSON.stringify(this.results[a].plaintext)):j=="author"?e.setSingleUse("q",JSON.stringify("author: "+this.parent().selectedAuthor+": "+this.results[a].plaintext)):e.setSingleUse("q",JSON.stringify(j+": "+this.results[a].plaintext));if(this.parent().isAuthorSelected===!0){var k=this.actionOfIndex[a].slice(0,20),l=this.actionOfIndex[a].slice(20,this.actionOfIndex[a].length),n=this.parent().selectedAuthor.replace(/ /g,"+"),o=k+n+"%3A+"+l;d.handleClick(o,b)}else d.handleClick(this.actionOfIndex[a],b)}else m(0)},setCookies:function(){e.setMessage("qhash",[this.query_hash,this.parent().selectedOid])}}),a.QuerySuggestionsNavigator=a.Typeahead.extend({onLoad:function(){this.qValue=this.initialValue,this.result=null,this.requestOutstanding=!1,this.closed=!1,this.selectionChosen=!1,this.selectionlessCallback=null,this.placeholderActive=!1,this.extraKeydown=null,this.userClicked=!1,this.simulateScroll=!0,this.originalPageTitle=$("title").text(),this.query_hash=Math.random().toString(36),this.data={query_hash:this.query_hash,keepFilters:this.keepFilters},this.search_typ="",this.selectedOid=null,this.selectedAuthor="",this.isAuthorSelected=!1;var a=this.$("#@input").attr("placeholder");this.$("#@input").attr("placeholder",g.decode(a)),this.$("#@view_selector").click(this.fnbind(function(){return this.$("#@selector_wrapper").removeClass("hidden"),this.$("#@view_selector_wrapper").addClass("hidden"),this.focus(),!1}));var b=this;b.data||(b.data={}),b.$("#@input").focus(function(){$(this).attr("focused","true"),b.inputFocus(),b.extraFocus&&b.extraFocus()}).blur(function(){$(this).removeAttr("focused"),b.inputBlur(),b.userClicked=!1}).keydown(function(a){return b.inputKeydown(a)}).keyup(function(a){return b.inputKeyup(a)}).click(function(){b.userClicked=!0}),this.onKeyCombination(document.body,"/",function(){return b.$("#@input").focus(),b.showResultsDropdown(),!1},document.body),this.setSelectionlessCallback(this.fnbind(function(){if(this.child("results").actionType=="url"&&this.qValue!==""){var a=h("/search?q="+encodeURIComponent(this.qValue).replace(/%20/g,"+")+this.keepFilters);this.setCookies(),window.location.href=a.unicode()}this.child("results").hide()})),this.$("#@search").click(this.fnbind(function(){return this.selectionlessCallback(),!1}))},inputKeydown:function(a){var b=this.$("#@input"),d=b.val();this.qValue=d;var e=!this.child("results").isVisible()&&!this.requestOutstanding,f=a.keyCode==39,g=i&&a.keyCode==27;if(!this.userClicked&&this.simulateScroll&&e&&(c.maybeSimulateScroll(a)||f||g)){b.blur();if(f)return;return!1}this.closed=!1,c.cancelSimulatedScroll();if(a.keyCode==40)return this.requestOutstanding=!1,this.child("results").down(),this.previewSearchInInput(),!1;if(a.keyCode==38)return this.child("results").up(),this.previewSearchInInput(),!1;if(a.keyCode==27)return!i||this.child("results").isVisible()?this.child("results").hide():b.blur(),this.userClicked=!1,this.resetInputIcon(),!1;if(a.keyCode==13){if(this.child("results").go(a))return this.child("results").hide(),!1;if(this.selectionlessCallback&&this.selectionlessCallback())return!1}else{if(a.keyCode==9){var h=this.child("results").focusedIndex;return h===null?(this.child("results").down(),this.previewSearchInInput(),!1):(this.requestUpdate(),!1)}a.keyCode==39&&(this.userClicked=!0)}return this.resetInputIcon(),this.extraKeydown?this.extraKeydown(a.keyCode):!0},onInputChange:function(){var a=this.getValue();if(a==this.qValue)return;if(!this.should_update)return;this.qValue=a,this.requestOutstanding||this.requestUpdate(),this.qValue===""&&(this.closed=!1)},focusedUpdate:function(){var a=this.qValue,b;if(a.indexOf(":")>=0){var c=a.split(":"),d=c[0];this.search_type=$.trim(d);if(this.search_type=="author"){var e=c[1];b=c[2]}else b=c[1]}},setValue:function(a,b){this._super.apply(this,arguments),b.img_src?this.$("#@input_icon").attr("src",b.img_src):this.resetInputIcon()},resetInputIcon:function(){this.$("#@input_icon").attr("src",this.default_search_icon)},previewSearchInInput:function(){var a=this.child("results").focusedIndex,b=this.child("results").getResult(a);b===undefined?this.setValue(this.child("results").query,{}):this.setValue(b.plaintext,b)},getRequestUpdatePostData:function(){return{q:this.qValue,data:JSON.stringify(this.data)}},setCookies:function(){e.setMessage("qhash",[this.query_hash,this.selectedOid])}})},{cookies:!0,async_post:!0,window_manager:!0,siteuri:!0,settings:!0,webnode2:!0,simscroll:!0,assert:!0,e2e:!0,html:!0,email:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/topic/edit_topic_modal",function(require,a,b){var c=require("w2.quora").Component;a.EditTopicsLink=c.extend({onLoad:function(){var a=this;this.$("#@edit_topics").click(function(b){a.modal("load_modal"),b.preventDefault()})}}),a.EditTopicsList=c.extend({newTopicAdded:function(a){var b=this;this.serverCall("new_topic_added").kwargs({topic_name:a.value}).liveMutate().success(function(a){a.tid&&b.lookup("selector").addIgnoreOid(a.tid)}).send()}}),a.TopicRow=c.extend({onLoad:function(){this.bindClickHandlers()},bindClickHandlers:function(){var a=this,b=a.lookup("selector");this.$("#@remove_topic").click(function(c){c.preventDefault(),a.lookup("topic_selection").serverCall("topic_removed").kwargs({tid:a.tid}).success(function(a){a.tid&&b.removeIgnoreOid(a.tid)}).liveMutate().send()})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/question/lookup_bar",function(require,a,b){var c=require("w2.quora").Component,d=require("view/selector").ServerCallSelector,e=require("qtexteditor").QTextEditor,f=require("window_manager"),g=require("siteuri").URI,h=require("cookies"),i=null;a.LookupBarSelector=d.extend({onLoad:function(){var a=this;i=a,this._super.apply(this,arguments),this.$results_wrapper=this.$("#@results_wrapper"),a.displayedRevision=0,a.currentRevision=0,a.currentOutstandingRequests=0,a.lastRevisionNeedsUpdate=!1,a.cache={},a.cacheSize=0,a.focused=!0,a.shouldSimScroll=!0,a.$wrapper=a.$("#@wrapper"),a.$(document).mouseup(function(b){!a.$wrapper.is(b.target)&&a.$wrapper.has(b.target).length===0&&$.inArray("LookupBarAddQuestionDetailsLink",b.target.classList)<0?(a.focused=!1,a.setHighlight(!1),a.showResults(!1),a.askMode==="forced"&&(a.query.trim()===""||a._queryIsPunctation(a.query.trim())?(a.setAskMode(!1),a.hideInterstitials()):a.askMode=!0,(a.query.trim()===""||a._queryIsPunctation(a.query.trim()))&&a._setQuery("",!0))):(a.shouldSimScroll=!1,a.focused=!0,a.query.trim().length!==0?a.hasResults?a.showResults(!0):a._setQuery(a.$input.val()):a.showResults(!1))}),a.addQuestion=this.lookup("add_question"),a.askMode=!1,a.showingInterstitial=!1,a.hideResultsOnServerCall=!1},capitalize:function(a){return a?(a=a.charAt(0).toUpperCase()+a.slice(1),a):a},setInputVal:function(a,b){var c=this.$input[0].selectionStart,d=this.$input[0].selectionEnd;b&&(c+=b,d+=b),this.$input.val(a),a.length>0&&this.$input[0].setSelectionRange(c,d)},_queryIsPunctation:function(a){return a===this.opening_question_punctuation+this.closing_question_punctuation||a===this.opening_question_punctuation&&a.length>0||a===this.closing_question_punctuation&&a.length>0},_setQuery:function(a,b){var c=this.capitalize(a);if(b||this.askMode&&c!==a){var d="";(a||b)&&a.indexOf(this.opening_question_punctuation)==-1&&(d=this.opening_question_punctuation);var e="";(a||b)&&a.indexOf(this.closing_question_punctuation)==-1&&(e=this.closing_question_punctuation),a=d+c+e,this.setInputVal(a,d.length)}else this.askMode&&this.askMode!=="forced"&&this._queryIsPunctation(a)&&(a="",this.setInputVal(a));this.length_limit&&(a.length>this.length_limit?this.addQuestion.questionIsOverLimit=!0:this.addQuestion.questionIsOverLimit=!1),this._super.apply(this,[a])},addToCache:function(a,b){a in this.cache||this.cacheSize++,this.cache[a]=b;if(this.cacheSize>this.max_cache_size){var c=this.currentRevision+1,d=null;for(var e in this.cache)this.cache[e][1]<c&&(c=this.cache[e][1],d=e);this.cacheSize--,delete this.cache[d]}},updateResults:function(){var a=this,b=a.query.trim();if(!(a.askMode!=="forced"||!a._queryIsPunctation(b)&&b!=="")){a.showInterstitial("button");return}var c={query:a.query},d=a.getExtraKwargs();for(var e in d)c[e]=d[e];var f=JSON.stringify(c),g=a.currentRevision;a.lastRevisionNeedsUpdate=!1;if(b.length===0)a.displayedRevision=g,a.setAskMode(!1),a.showResults(!1);else if(f in a.cache)a.currentOutstandingRequests++,a.resultsServerCallHandler(g,a.cache[f][0],this.showingInterstitial);else if(a.currentOutstandingRequests<a.max_concurrent_requests){c.parent_cid=a.cid,a.currentOutstandingRequests++;var h=this.showingInterstitial;a.serverCall("results_content_for").kwargs(c).success(function(b){a.resultsServerCallHandler(g,b,f,h)}).except(function(){a.resultsServerCallHandler(g,null,f,h)}).error(function(){a.resultsServerCallHandler(g,null,f,h)}).send()}else a.lastRevisionNeedsUpdate=!0},getExtraKwargs:function(){return{ask_mode:this.askMode}},resultsServerCallHandler:function(a,b,c,d){this.currentOutstandingRequests--,this.hasResults=!0;if(a<this.displayedRevision)return;d&&(this.showingInterstitial=!1,this.$("#@ask_mode_interstitial").addClass("hidden"),this.$("#@results").removeClass("hidden")),b!==null&&(this.$results.forgetContents(),this.$results.setContent(b),this.displayedRevision=a,this.addToCache(c,[b,a])),this.showResults(!0),this.lastRevisionNeedsUpdate&&this.updateResults()},queryDidChange:function(){this.currentRevision++,this.addQuestion.enableButton(!0),this._super.apply(this,arguments)},showResults:function(a){a&&this.focused?this.$results_wrapper.removeClass("hidden"):this.$results_wrapper.addClass("hidden")},resultWasSelected:function(a,b){var c=this,d=this.lookup("results").lookup(a.data.cname);d.processAction(a.data.action_mousedown),a.ty==="search"?c.submit(b):(a.data.qid!==-1&&h.setMessage("look",[a.data.qid,!0]),c.query.length<140&&h.cookie("qsu-q",JSON.stringify(c.query),{expires:1}),b?window.open(a.data.url):window.location.href=a.data.url)},openDialog:function(a){var b=null,c=null,d="step_2",e=this.addQuestion.$("#@anon_checkbox"),f=e.attr("checked"),g=this.lookup("wizard");return g.forceQuestionDetails(this.addQuestion.getQuestionDetails()),g.open(a,f,b,c,d,this.tid),this.lookup("hover_menu")&&this.lookup("hover_menu").doHide&&this.lookup("hover_menu").doHide(),!1},hideInterstitials:function(){var a=["bad","good","button"];for(var b=0;b<a.length;b++)this.$("#@interstitial_text_"+a[b]).addClass("hidden");this.showingInterstitial=!1,this.$("#@ask_mode_interstitial").addClass("hidden"),this.$("#@results").removeClass("hidden")},showInterstitial:function(a){this.hideInterstitials(),this.$("#@interstitial_text_"+a).removeClass("hidden"),this.showingInterstitial=!0,this.$("#@ask_mode_interstitial").removeClass("hidden"),this.$("#@results").addClass("hidden")},setHighlight:function(a,b){var c=this.parent().parent().$("#@body_blur");a?c.addClass("lookup_bar_modal_overlay"):c.removeClass("lookup_bar_modal_overlay"),this.nextHighlightCallback&&this.nextHighlightCallback(),this.nextHighlightCallback=b},setAskMode:function(a,b){this.askMode=a,(this.query.trim()||a)&&this._setQuery(this.query.trim(),!0),a?(this.$input.focus(),b?this.showInterstitial(b):this.query.trim().length>=10&&this.query.split(" ").length>=3?this.showInterstitial("good"):this.showInterstitial("bad"),this.addQuestion.$("#@ask_mode").removeClass("hidden"),this.addQuestion.$("#@ask_switch").addClass("hidden"),this.logMiscAction("LookupBarSetAskModeClickthrough"),this.lastRevisionNeedsUpdate=!1,this.focused=!0,this.showResults(!0),this.shouldShowLengthCounter=!0,this.showLengthCounter(!0)):(this.addQuestion.$("#@ask_mode").addClass("hidden"),this.addQuestion.$("#@ask_switch").removeClass("hidden"),this.shouldShowLengthCounter=!1,this.showLengthCounter(!1))},logMiscAction:function(a){var b=this.lookup("results",!0);if(!b)return;var c=b.lookup("search",!0);if(!c)return;c.processAction(a)},submit:function(a){if(this.query.trim()){var b=g("/search?q="+encodeURIComponent(this.query).replace(/%20/g,"+")+this.keepFilters);a?window.open(b.unicode()):window.location.href=b.unicode()}},ask:function(){var a=this;if(a.hasPendingServerCall())return;a.addQuestion.enableButton(!1),a.makeServerCall(a.serverCall("add_question").kwargs({input_text:a.query,is_anon:a.addQuestion.getIsPrivate(),question_details:a.addQuestion.getQuestionDetails()})),this.$input.focus()},serverCallHandler:function(a,b){this._super.apply(this,arguments),this.addQuestion.enableButton(!0),!a&&b.type=="success"?(this.logMiscAction("LookupBarAddQuestionSuccess"),f.navigateTo(b.url)):this.logMiscAction("LookupBarAddQuestionFail")}}),a.AddQuestionSwitchModeButton=c.extend({onLoad:function(){this.$("#@dialog_link").click(this.fnbind(function(){return this.parent().parent().setAskMode(!0),!1}))}}),a.AddQuestionSubmitAutoTopicsButton=c.extend({onLoad:function(){this.$("#@dialog_link").click(this.fnbind(function(){return this.parent().parent().ask(),!1}))}}),a.LookupBarAddQuestion=c.extend({onLoad:function(){this.skip_step="step_2",this.askButton=this.lookup("ask_button"),this.questionIsOverLimit=!1,this.detailIsOverLimit=!1},getQuestionText:function(){return this.parent().query},showQuestionDetailsEditior:function(){this.$("#@question_details_editor").show(),this.lookup("question_details").focus()},getQuestionDetails:function(){var a=this.lookup("question_details",!0);return a?a.serialize():""},getIsPrivate:function(){return!!this.$("#@anon_checkbox").attr("checked")},enableButton:function(a){this.questionIsOverLimit||this.detailIsOverLimit?this.askButton.$("#@dialog_link").addClass("disabled"):a?this.askButton.$("#@dialog_link").removeClass("disabled"):this.askButton.$("#@dialog_link").addClass("disabled")}}),a.LookupBarAddQuestionDetailsLink=c.extend({onLoad:function(){var a=this;a.$("#@question_details_link").click(function(){a.lookup("lookup_bar_add_question").showQuestionDetailsEditior(),a.lookup("selector").showResults(!0)})}}),a.LookupBarAddQuestionDetailsEditor=e.extend({updateLengthCounter:function(){this._super.apply(this,arguments);var a=this.lookup("lookup_bar_add_question"),b=parseInt(this.lookup("counter").limit);this.valLength()>b?(a.detailIsOverLimit=!0,a.enableButton(!1)):(a.detailIsOverLimit=!1,a.enableButton(!0))}});var j=[];a.AddQuestionLookupBarButton=c.extend({setAllEnabled:function(a){j.forEach(function(b){b.setEnabled(a)})},setEnabled:function(a){a?this.$("#@dialog_link").removeClass("disabled"):this.$("#@dialog_link").addClass("disabled")},onLoad:function(){var a=this;j.push(a),this.$("#@dialog_link").click(function(){var b=i;return b.setAskMode("forced","button"),a.setAllEnabled(!1),b.setHighlight(!0,function(){a.setAllEnabled(!0)}),!1})}})},{cookies:!0,window_manager:!0,siteuri:!0,qtexteditor:!0,"view/selector":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/payment/payable",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.BankSettings=c.extend({onLoad:function(){var a=this;a.$("#@edit").click(function(b){b.preventDefault(),a.modal("load_edit_debit_card_modal")})}}),a.EditDebitCardModal=d.extend({onSubmit:function(){var a=this;a.child("add_debit_card_form").submit(function(){a._closeModal()})}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/ask",function(require,a,b){var c=require("w2.quora").Component,d=require("window_manager"),e=require("view/selector").ServerCallSelector;a.AskSelector=e.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.questionMarkInserted=!1,a.$headerNav=a.parent().$("#@nav"),a.$contentWrapper=$(".ContentWrapper"),a.$("#@ask_button").click(function(b){a.addQuestion()}),a.$input.focus(function(b){a.$headerNav.fadeTo(400,.4)}),a.$input.blur(function(b){a.$headerNav.fadeTo(400,1),a.$contentWrapper.fadeTo(400,1)}),a.$input.val().length>0&&(a.$input.focus(),a.updateResults())},addQuestion:function(){var a=this;if(a.hasPendingServerCall())return;a.makeServerCall(a.serverCall("add_question").kwargs({input_text:a.query}).except("success",a.fnbind(a._handleAddQuestionSuccess)))},_handleAddQuestionSuccess:function(a){d.navigateTo(a.url)},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery(""),this.questionMarkInserted=!1;return}if(!this.query){this.questionMarkInserted=!1;return}if(this.questionMarkInserted)return;this.query.match(/[?]$/)===null&&(this.questionMarkInserted=!0,this.setQuery(this.query+"?"))},queryDidChange:function(){this._super.apply(this,arguments),this.maybeInsertQuestionMark()},resultsDidChange:function(){var a=this.child("results").numResults>0?.4:1;this.$contentWrapper.fadeTo(400,a)},resultWasSelected:function(a){switch(a.ty){case"question":d.navigateTo(a.data.url);break;case"ask_question":this.addQuestion()}}})},{"view/selector":!0,window_manager:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("third_party/truncate",function(require,a,b){(function(a,b,undefined){function d(a,b){if(a.innerText)a.innerText=b;else if(a.nodeValue)a.nodeValue=b;else{if(!a.textContent)return!1;a.textContent=b}}function e(a,b,c,e){var g=a.parent(),h;a.remove();var i=c?c.length:0;if(g.contents().length>i)return h=g.contents().eq(-1-i),f(h,b,c,e);var j=g.prev();return h=j.contents().eq(-1),h.length?(d(h[0],h.text()+e.ellipsis),g.remove(),c.length&&j.append(c),!0):!1}function f(a,c,f,g){var h=a[0],i=a.text(),j="",k,l,m=0,n=i.length;while(m<=n)k=m+(n-m>>1),l=b.trim(i.substr(0,k+1))+g.ellipsis,d(h,l),c.height()>g.maxHeight?n=k-1:(m=k+1,j=j.length>l.length?j:l);return j.length>0?(d(h,j),!0):e(a,c,f,g)}function g(a,d,e,h){var i=a[0],j=a.contents(),k,l,m=0,n=j.length,o=!1;a.empty();for(;m<n&&!o;m++){k=j.eq(m),l=k[0];if(l.nodeType===8)continue;i.appendChild(l),e.length&&(b.inArray(i.tagName.toLowerCase(),c)>=0?a.after(e):a.append(e)),d.height()>h.maxHeight&&(l.nodeType===3?o=f(k,d,e,h):o=g(k,d,e,h)),!o&&e.length&&e.remove()}return o}function h(a,c){this.element=a,this.$element=b(a),this._name="truncate",this._defaults={lineHeight:parseInt(this.$element.css("line-height")),lines:1,ellipsis:"â¦",showMore:"",showLess:""},this.options=b.extend({},this._defaults,c),this.options.maxHeight===undefined&&(this.options.maxHeight=parseInt(this.options.lines,10)*parseInt(this.options.lineHeight,10)),this.$clipNode=b(b(this.options.showMore),this.$element),this.original=this.cached=a.innerHTML,this.isTruncated=!1,this.isCollapsed=!0,this.update()}var c=["table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"];h.prototype={update:function(a){var b=!this.isCollapsed;a?this.original=this.element.innerHTML=a:this.isCollapsed&&this.element.innerHTML===this.cached&&(this.element.innerHTML=this.original);var c=this.$element.wrapInner("<div/>").children();c.css({border:"none",margin:0,padding:0,width:"auto",height:"auto"}),this.isTruncated=!1,c.height()>this.options.maxHeight?this.isTruncated=g(c,c,this.$clipNode,this.options):this.isCollapsed=!1,c.replaceWith(c.contents()),this.cached=this.element.innerHTML,b&&(this.element.innerHTML=this.original)},expand:function(){if(!this.isCollapsed)return;this.isCollapsed=!1,this.element.innerHTML=this.isTruncated?this.original+this.options.showLess:this.original},collapse:function(a){if(this.isCollapsed)return;this.isCollapsed=!0,a=a||!1,a?this.update():this.element.innerHTML=this.cached}},b.fn.truncate=function(a){var c=b.makeArray(arguments).slice(1);return this.each(function(){var d=b.data(this,"jquery-truncate");d?typeof d[a]=="function"&&d[a].apply(d,c):b.data(this,"jquery-truncate",new h(this,a))})},a.Truncate=h})(this,jQuery)},{})}),require.whenReady("settings",function(){require.install("app/view/quality/base",function(require,a,b){var c=require("w2.quora").Component;a.QualityTips=c.extend({onLoad:function(){var a=this;a.is_dismissable&&a.$("#@close").click(function(b){a.hide(),a.onClose(),b.preventDefault()})},onClose:function(){this.serverCall("close_popover").send()},isVisible:function(){return!this.isHidden()},isHidden:function(){return this.$("#@popover").hasClass("hidden")},show:function(){this.$("#@popover").removeClass("hidden")},hide:function(){this.$("#@popover").addClass("hidden")},toggle:function(){this.$("#@popover").toggleClass("hidden")}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/quality/answer",function(require,a,b){var c=require("w2.quora").Component,d=require("app/view/quality/base").QualityTips;a.WritingTips=d.extend({toggle:function(){this.$("#@popover").hasClass("hidden")&&this.serverCall("log_show_flyout_on_icon_click").send(),this._super.apply(this,arguments),this.cQuery(":content_editor.editor.answer_resistance").hide()}})},{"app/view/quality/base":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/answer/improvement",function(require,a,b){var c=require("w2.quora").Component,d=require("view/inline_editor"),e=d.registerEditorCallback,f=d.unregisterEditorCallback,g=d.triggerEditorCallback,h=d.isInEditMode;a.EditAnswer=c.extend({onLoad:function(){var a=this;a.editing=!1,a.$("#@link").click(function(){return a.handleClick(),!1}),e("cancel",a.content_type,a.oid,a.cid,function(){return a.performCancel(),!1}),e("submitted",a.content_type,a.oid,a.cid,function(){return a.performCancel(),!1}),e("edit",a.content_type,a.oid,a.cid,function(){return a.performEdit(),!1}),h(a.content_type,a.oid)&&a.performEdit()},onUnload:function(){f("cancel",this.content_type,this.oid,this.cid),f("submitted",this.content_type,this.oid,this.cid),f("edit",this.content_type,this.oid,this.cid)},handleClick:function(){this.editing?g("cancel",this.content_type,this.oid):g("edit",this.content_type,this.oid)},performEdit:function(){this.editing=!0,this.$("#@link").text(this.alternate_text)},performCancel:function(){this.editing=!1,this.$("#@link").text(this.text)}}),a.AskToImproveLink=c.extend({onLoad:function(){var a=this,b=this.lookup("answer",null);if(b){var c=b.$("#@ask_to_improve");a.$("#@link").click(function(b){b.preventDefault(),a.serverCall("load_prompt").contentFor(c,{parentCID:a.cid}).send()})}}}),a.AskToImprovePrompt=c.extend({onLoad:function(){var a=this;this.selectedType=null,this.$("#@prompt input[type=radio]").click(function(){a.setRequestType($(this).val())}),this.$("#@prompt .prompt_option").click(function(){var b=$(this).find("input[type=radio]");b.attr("checked",!0),a.setRequestType(b.val())}),this.$("#@cancel").click(function(b){b.preventDefault(),a.closePrompt()}),this.$("#@submit").click(function(){a.$("#@submit").hasClass("disabled")||a.serverCall("add_request").kwargs({request_type:a.getRequestType()}).success(function(){a.$("#@prompt").fadeOut()}).liveMutate().send()})},closePrompt:function(){this.$("#@prompt").hide()},setRequestType:function(a){this.selectedType=a,this.$("#@submit").hasClass("disabled")&&this.$("#@submit").removeClass("disabled")},getRequestType:function(){return this.selectedType}}),a.WritingTips=c.extend({onLoad:function(){var a=this;this.$("#@icon").click(function(){a.child("tips").toggle()})}})},{"view/inline_editor":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/advertising/manage_payment",function(require,a,b){var c=require("w2.quora").Component;a.AddCreditCardForm=c.extend({onLoad:function(){var a=this;a.cc_form=a.child("add_credit_card_form"),a.$("#@add_card_button").click(function(b){console.log(a.cc_form),a.cc_form.getStripeToken(function(b,c){c.error?alert(c.error.message):(console.log(c),a.serverCall("save_credit_card").kwargs({token:c}).liveMutate().success(function(){}).send())})})}}),a.CreditCardDisplayInfo=c.extend({onLoad:function(){var a=this;a.$("#@delete_card").click(function(b){a.serverCall("delete_credit_card").kwargs({}).liveMutate().send()}),a.$("#@set_default").click(function(b){a.serverCall("set_default_card").kwargs({}).liveMutate().send()})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/advertising/ads_home",function(require,a,b){var c=require("w2.quora").Component;a.AdsHomeMain=c.extend({onLoad:function(){var a=this;a.$("#@manage_payment").click(function(a){window.location="advertising/manage_payment"}),a.$("#@create_ad").click(function(a){window.location="advertising/create_ad"}),a.$("#@create_campaign").click(function(a){window.location="advertising/create_campaign"}),a.$("#@manage_campaign").click(function(a){window.location="advertising/manage"})}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/signup/conversion_logging",function(require,a,b){var c=require("w2.quora").Component,d=require("webnode2"),e=require("cookies"),f=require("settings");a.ConversionLogging=c.extend({onLoad:function(){$("a").on("click",function(a){var b=a.currentTarget,c=b.getAttribute("href");if(c&&c!="#"){var g=d.getComponentFromElement(b),h=[];for(var i=0;i<3&&g&&g.__vcon;i++)h.push(g),g=g.parent();var j=[];for(i=0;i<h.length;i++)j.push(h[i].__vcon[1]);var k=[];k.push(f.controller),k.push(f.action),k.push(window.location.pathname);var l=k.concat(j);JSON.stringify(l).length<400&&e.setMessage("cl",l)}})}})},{webnode2:!0,cookies:!0,settings:!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/bounty/writer",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.BountyApplicationLink=c.extend({onLoad:function(){var a=this;a.$("#@link").click(function(b){b.preventDefault(),a.modal("load_modal")})}}),a.BountyApplicationModal=d.extend({onSubmit:function(){var a=this;a.child("bounty_application_form").submit(function(){a._closeModal()})}}),a.BountyDepositForm=c.extend({onLoad:function(){var a=this;a.$radios=a.$("#@picker input[type=radio]"),a.$bank_radio=a.$("#@bank"),a.addDebitCardForm=a.child("add_debit_card_form"),a.addDebitCardForm&&(a.$bank_details=a.$("#@bank_details"),a.bankDetailsElementHeight=a.$bank_details.height(),a.bankDetailsAnimDuration=333,a.bankDetailsAnimEasing="swing"),a.$radios.change(function(b){a.addDebitCardForm&&(a.$bank_radio.is(":checked")?(a.$bank_details.removeClass("hidden"),a.$bank_details.animate({height:a.bankDetailsElementHeight,opacity:1},a.bankDetailsAnimDuration,a.bankDetailsAnimEasing,function(){a.addDebitCardForm&&a.addDebitCardForm.focus()})):a.$bank_details.animate({height:0,opacity:0},a.bankDetailsAnimDuration,a.bankDetailsAnimEasing,function(){a.$bank_details.addClass("hidden")})),a.$radios.map(function(){var a=$(this),b=$("label[for='"+a.attr("id")+"']").parent();b.toggleClass("selected",a.is(":checked")),b.toggleClass("not_selected",!a.is(":checked"))})})},submit:function(a){var b=this,c=b.$("#@picker input[type=radio]:checked");if(c){var d=c.val(),e=b.child("add_debit_card_form");d!=="bank"?alert("Charities are not supported yet."):d==="bank"&&e?e.submit(function(){a(d)}):a(d)}}}),a.BountyDepositModal=d.extend({onSubmit:function(){var a=this;a.child("bounty_deposit_form").submit(function(b){f(b),a._closeModal()})}});var e,f=function(a){e&&e.setSelectedDepositMethod(a)};a.BountyAnswerAreaForm=c.extend({onLoad:function(){var a=this;e=a,a.$("#@choose_deposit_method").click(function(b){b.preventDefault(),a.modal("load_deposit_method_modal")})},onUnload:function(){e=null},isValid:function(){return this.hasAcceptedApplication?this.getSelectedDepositMethod()&&this.getConfidentialityCheckboxChecked():!0},setSelectedDepositMethod:function(a){var b=this;b.depositMethod=a,a==="bank"&&b.serverCall("load_current_payment_method").contentFor(b.$("#@bank"),{parentCID:b.cid}).liveMutate().send(),b.$("#@choose_deposit_method .payment_method").addClass("hidden"),b.$("#@choose_deposit_method .payment_method."+a).removeClass("hidden")},getSelectedDepositMethod:function(){return this.depositMethod},getConfidentialityCheckboxChecked:function(){return this.$("#@confidentiality_checkbox").is(":checked")}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/bounty/manage",function(require,a,b){var c=require("w2.quora").Component,d=require("view/modal").Base;a.BountyAddLink=c.extend({onLoad:function(){var a=this;a.$("#@link").click(function(b){b.preventDefault(),a.modal("load_modal")})}}),a.BountyAddModal=d.extend({onSubmit:function(){function c(){a.child("bounty_add_form").submit(function(){a._closeModal()})}var a=this,b=a.child("add_card_form",!0);b?b.submit(function(){c()}):c()}}),a.BountyChooseBestAnswerLink=c.extend({onLoad:function(){var a=this;a.$("#@link").click(function(b){b.preventDefault(),a.modal("load_modal")})}}),a.BountyChooseBestAnswerModal=d.extend({onSubmit:function(){var a=this;a.child("choose_best_form").submit(function(){a._closeModal()})}})},{"view/modal":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("unified_view/util",function(require,a,b){a.positionForElement=function(a){var b=0,c=0,d=a.offsetWidth,e=a.offsetHeight;while(a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop))b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{left:b,top:c,width:d,height:e}}},{})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/base",function(require,a,b){var c=require("interface/component").Component,d=require("w2.context"),e=require("interface/settings"),f=require("unified_view/util"),g=require;if(e.pageIsMobile)var h=g("mobile_app2/client");else var i=g("view/hover_menu"),j=g("sticky"),k=g("window_manager");a.ActionBarWeb=c.extend({contextConstructor:function(){return d.ActionBar},onLoad:function(){this.overflowMenuShown=!1,this.overflowMenuMovedToBody=!1,this.overflowMenuLoaded=!this.lazy_loaded,this.$overflowLinkElem=this.unsafe$id(this.overflow_link_id),this.$overflowMenuElem=this.unsafe$id(this.overflow_menu_id),this.$actionBarElem=this.unsafe$id(this.action_bar_elem_id),this.$overflowMenuContentsElem=this.$id(this.overflow_menu_contents_id),this.actionBarContext=this.getContext(d.ActionBar),this.is_action_bar&&(this.overflowMenu=new i.ToggleableMenu({$linkElem:this.$overflowLinkElem,$menuElem:this.$overflowMenuElem,loadFunction:this.loadOverflowMenu.bind(this),alignment:"right",clickOpen:!0}),this.is_sticky&&(this.actionBarContext.on("commentsElem",this.maybeEnableSticky.bind(this)),this.actionBarContext.on("updateSticky",this.updateSticky.bind(this))))},loadOverflowMenu:function(){if(this.overflowMenuLoaded)return;this.overflowMenuLoaded=!0,this.serverCall("load_menu").contentFor(this.$overflowMenuContentsElem.get(0),{parentCID:this.cid}).send()},maybeEnableSticky:function(){if(!this.is_sticky)return;var a=this.actionBarContext.get("commentsElem"),b=this.actionBarContext.get("showComments");a&&!b?j.add({elem:this.$actionBarElem,container:this.$actionBarElem.parent().parent(),offsets:this.sticky_offsets}):j.remove(this.$actionBarElem)},updateSticky:function(){if(!this.is_sticky)return;this.maybeEnableSticky(),k.scrollIntoView(this.$actionBarElem)}}),a.ActionBarMobile=c.extend({contextConstructor:function(){return d.ActionBar},onLoad:function(){this.actionBarContext=this.getContext(d.ActionBar),this.overflowMenuShown=!1,this.$overflowLinkElem=this.$id(this.overflow_link_id),this.$overflowLinkElem.on("click",this.showMenu.bind(this))},showMenu:function(){if(this.overflowMenuShown)return;this.overflowMenuShown=!0;var a=this.actionBarContext.get("overflowItems"),b=[],c=-1;a.forEach(function(a,d){b.push(a.label),a.is_destructive&&(c=d)}),h.supportsDestructiveActionSheetButtons()||(c=-1),h.sendMessageToClient("showActionSheet",{buttonTitles:b,destructiveButtonIndex:c,position:f.positionForElement(this.$overflowLinkElem.get(0))}),h.registerOneTimeMessageHandler("actionSheetDismissed",function(b){this.overflowMenuShown=!1;var c=parseInt(b.buttonIndex,10);if(c<0||a.length<=c)return;setTimeout(this.selectOverflowItem.bind(this,c),100)}.bind(this))},selectOverflowItem:function(a){this.actionBarContext.set("selectedOverflowItem",a)}})},{"unified_view/util":!0,"interface/settings":!0,"interface/component":!0,"w2.context":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/answer",function(require,a,b){var c=require("interface/component").Component,d=require("w2.context");a.ReadMoreActionItem=
c.extend({onLoad:function(){this.$id(this.link_id).on("click",this.handleClick.bind(this))},handleClick:function(a){a.preventDefault(),this.getContext(d.QuestionAnswerVerbose).set("expand",!0)}})},{"interface/component":!0,"w2.context":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/_action_bar",function(require,a,b){var c=require("unified_view/action_bar/base"),d=require("w2.context");a.Question=c.ActionBarWeb.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.questionAreaContext=a.getContext(d.QuestionArea),a.questionAreaContext&&a.questionAreaContext.on("showActionBar",function(b,c){c?a.$actionBarElem.show():a.$actionBarElem.hide()})}}),a.EditQuestionOverflow=c.ActionBarMobile.extend({onLoad:function(){var a=this;a.editQuestionOverflowContext=a.getContext(d.EditQuestionOverflow),a.editQuestionOverflowContext.on("showMenu",function(){a.showMenu()}),a._super.apply(a,arguments)}})},{"w2.context":!0,"unified_view/action_bar/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/shared",function(require,a,b){var c=require("interface/component").Component,d=require("w2.context");a.CommentsActionItem=c.extend({onLoad:function(){this.actionBarContext=this.getContext(d.ActionBar),this.$linkElem=this.$id(this.link_id),this.$linkElem.on("hover",this.loadComments.bind(this)),this.$linkElem.on("click",this.toggleComments.bind(this))},loadComments:function(){this.actionBarContext.set("loadComments",!0)},toggleComments:function(a){a.preventDefault();var b=this.actionBarContext.get("showComments");this.actionBarContext.set("showComments",!b)}}),a.CommentsExtraItem=c.extend({onLoad:function(){this.actionBarContext=this.getContext(d.ActionBar),this.$wrapperElem=this.$id(this.wrapper_id),this.fetched=!this.lazy_loaded,this.actionBarContext.set("commentsElem",this.$wrapperElem),this.actionBarContext.on("loadComments",this.loadComments.bind(this)),this.actionBarContext.on("showComments",this.toggleComments.bind(this))},loadComments:function(){if(this.fetched)return;this.fetched=!0,this.serverCall("fetch_comments").contentFor(this.$wrapperElem.get(0),{parentCID:this.parent().cid}).send()},toggleComments:function(a,b){this.$wrapperElem.toggleClass("hidden",!b),this.actionBarContext.set("updateSticky",!0)}})},{"interface/component":!0,"w2.context":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/blog",function(require,a,b){var c=require("interface/component").Component,d=require("interface/settings"),e=require;if(d.pageIsMobile)var f=e("mobile_app2/client");a.AddPostActionItem=c.extend({onLoad:function(){this.$id(this.link_id).on("click",this.handleClick.bind(this))},handleClick:function(a){a.preventDefault(),f.sendMessageToClient("invokeRichTextEditor",this.editor_kwargs)}})},{"interface/settings":!0,"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/question",function(require,a,b){var c=require("interface/component").Component,d=require("w2.context"),e=require("interface/settings").pageIsMobile,f=require("gating"),g=require;if(e)var h=g("mobile_app2/client"),i=g("mobile_app2/cookies"),j=g("mobile_app2/action_log");a.AddAnswerEditorWrapper=c.extend({contextConstructor:function(){return d.QTextEditor},onLoad:function(){var a=this;a.editorLoaded=!1,a.$editorWrapper=a.$id("@add_answer_editor_wrapper"),a.getContext(d.ActionBar).on("toggleEditor",function(){a.toggleEditor()})},toggleEditor:function(){this.editorLoaded?this.$editorWrapper.hasClass("hidden")?(this.$editorWrapper.removeClass("hidden"),this.focusEditor()):this.$editorWrapper.addClass("hidden"):this.loadEditor()},loadEditor:function(){e?this.loadEditorMobile():this.loadEditorDesktop()},loadEditorMobile:function(){var a=this;a.should_track_question_state&&a.trackQuestionState(),f.qtext2_mobile?h.sendMessageToClient("openURL",{target:"modal",url:"/editor/mobile_write_answer?qid="+a.qid}):h.invokeRichTextEditor(a.editor_kwargs,{onSucceed:function(){i.setTlog({type:"AddAnswer"}),i.setQfeedLog(a,"AddAnswer"),h.broadcastReload(a.editor_kwargs.broadcast_key),j.logPrimaryAction("MobileEditorAddAnswer",a.getDvar("impression_target")),j.logSecondaryAction("MobileEditorAddAnswer",null)},onCancel:function(){h.broadcastReload(a.editor_kwargs.broadcast_key)}})},loadEditorDesktop:function(){var a=this;a.serverCall("load_add_answer_editor").contentFor(a.$editorWrapper.get(0),{parentCID:a.cid}).success(function(){a.$editorWrapper.removeClass("hidden"),a.editorLoaded=!0,a.focusEditor()}).send()},focusEditor:function(){this.getContext(d.QTextEditor).set("focusInput",!0)},trackQuestionState:function(){this.serverCall("track_question_state").kwargs({qid:this.qid}).send()}})},{"interface/settings":!0,"interface/component":!0,"w2.context":!0,gating:!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/remove_from_feed",function(require,a,b){var c=require("unified_view/action_bar/base"),d=require("w2.context");a.RemoveFromFeed=c.ActionBarMobile.extend({onLoad:function(){var a=this;a.feedStoryItemContext=a.getContext(d.FeedStoryItem),a.feedStoryItemContext.on("showRemoveFromFeedMenu",function(){a.showMenu()}),a._super.apply(a,arguments)}})},{"w2.context":!0,"unified_view/action_bar/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/user",function(require,a,b){var c=require("interface/component").Component,d=require("interface/settings"),e=require;if(d.pageIsMobile)var f=e("mobile_app2/client"),g=e("mobile_app2/util");a.SendMessageActionItem=c.extend({onLoad:function(){var a=this;g.safeClickHandler(this.$id("@message_link").get(0),function(b){f.sendMessageToClient("invokeRichTextEditor",{title:a.editor_title,editor_type:"text",text_formatting:"basic",done_server_call:"compose_new_message_wrapper",request_params:{uid:a.oid,viewer:a.message_viewer,target:a.oid},supports_callbacks:!0},{onSucceed:function(){f.markPageAsDirty("/inbox"),f.reloadDirtyPages(),f.isIOSApp()&&f.sendMessageToClient("dismissModal")}}),b.preventDefault()})}})},{"interface/settings":!0,"interface/component":!0})}),require.whenReady("settings",function(){require.install("interface/dialog",function(require,a,b){var c=require("interface/settings"),d=require;if(c.pageIsMobile){var e=d("mobile_app2/app/view/common");a.showConfirmationDialog=function(a,b,c,d){e.showConfirm({title:b,message:c,callback:d})}}else{var f=d("webnode2").Dialog.extend();a.showConfirmationDialog=function(a,b,d,e){a._dialog=(new f(a)).title(b).cancel(null,c.interface_strings.cancel).ok(function(){e()},b).close(function(){a._dialog=null}).html(d)}}},{"interface/settings":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/base",function(require,a,b){var c=require,d=require("interface/component").Component,e=require("interface/settings").pageIsMobile,f=require("w2.context"),g=require("interface/cookies"),h=require("interface/dialog").showConfirmationDialog,i=require("unified_view/modal").ModalBase;if(e)var j=c("mobile_app2/client"),k=c("mobile_app2/app/view/common");else var l=c("webnode2"),m=l.ModalWithCallBacks;a.Item=d.extend({onLoad:function(){e?this.mobileOnLoad():this.desktopOnLoad()},mobileOnLoad:function(){this.actionBarContext=this.getContext(f.ActionBar);var a=this,b=this.actionBarContext.get("overflowItems");b[this.index]={label:this.label,is_destructive:this.is_destructive},this.actionBarContext.set("overflowItems",b),this.actionBarContext.on("selectedOverflowItem",function(b,c){c==a.index&&a.onSelectAction()})},desktopOnLoad:function(){var a=this;this.$id("@overflow_menu_item").on("click",function(b){return a.onSelectAction(),a.close_on_click&&b.preventDefault(),a.close_on_click})},onSelectAction:function(){},invokeRichTextEditor:function(a){j.invokeRichTextEditor(a,{onSucceed:function(){a.broadcast_key&&j.broadcastReload(a.broadcast_key)}})}}),a.WithServerCall=a.Item.extend({onSelectAction:function(){this.serverCall("selected").success(function(a){e?a.value&&a.value.url&&j.sendMessageToClient("openURL",{url:a.value.url}):a.url&&(document.location=a.url)}).send()}}),a.WithLink=a.Item.extend({desktopOnLoad:function(){var a=this;this.$id("@overflow_menu_item").on("click",function(b){a.onSelectAction(b)})},onSelectAction:function(){if(!e)return;j.sendMessageToClient("openURL",{target:this.target,url:this.url})}}),a.WithModal=a.WithLink.extend({onSelectAction:function(a){if(e)this._super.apply(this,arguments);else{a.preventDefault();var b=new m(this,{});b.load("load_modal")}}}),a.Toggleable=a.Item.extend({onToggledOff:function(){if(this.one_way)return;this.qfeed_log_action_on_disable&&g.setQfeedLog(this,this.qfeed_log_action_on_disable);if(this.tlog_action_context&&this.tlog_action_on_disable){var a={type:this.tlog_action_on_disable};a[this.tlog_action_context]=this.oid,g.setTlog(a)}this.with_server_call&&this.makeServerCall("on_toggled_off")},onToggledOn:function(){this.qfeed_log_action_on_enable&&g.setQfeedLog(this,this.qfeed_log_action_on_enable);if(this.tlog_action_context&&this.tlog_action_on_enable){var a={type:this.tlog_action_on_enable};a[this.tlog_action_context]=this.oid,g.setTlog(a)}this.with_server_call&&this.makeServerCall("on_toggled_on")},makeServerCall:function(a){var b=this;b.serverCall(a).liveMutate().success(function(){e&&(b.broadcast_key&&j.broadcastReload(b.broadcast_key),b.should_reload&&j.sendMessageToClient("reload"))}).send()},onSelectAction:function(){this.is_on?this.onToggledOff():this.onToggledOn()}}),a.ToggleableWithConfirmation=a.Toggleable.extend({onToggledOn:function(){var a=this,b=a._super,c=function(){b.apply(a)};a.should_show_on_toggled_on?h(a,a.on_toggled_on_title,a.on_toggled_on_message,c):c()},onToggledOff:function(){var a=this,b=a._super,c=function(){b.apply(a)};a.should_show_on_toggled_off?h(a,a.on_toggled_off_title,a.on_toggled_off_message,c):c()}}),a.ToggleableWithModalConfirmation=a.Toggleable.extend({onToggledOn:function(){var a=this,b=a._super,c=function(){b.apply(a)};if(a.should_show_on_toggled_on)if(e)k.showConfirm({title:a.on_toggled_on_title,message:a.on_toggled_on_message,callback:c});else{var d=new m(this,{});d.load("load_modal").onSubmitCallBack(function(){a.serverCall("on_toggled_on").liveMutate().send()})}else c()},onToggledOff:function(){var a=this,b=a._super,c=function(){b.apply(a)};if(a.should_show_on_toggled_off)if(e)k.showConfirm({title:a.on_toggled_off_title,message:a.on_toggled_off_message,callback:c});else{var d=new m(this,{});d.load("load_modal").onSubmitCallBack(function(){a.serverCall("on_toggled_off").liveMutate().send()})}else c()}}),a.ToggleableWithModalConfirmationModal=i.extend({onSubmit:function(){this._super.apply(this,arguments),l.Modal.modalFor(this).executeOnSubmitCallBack()}})},{"interface/settings":!0,"interface/component":!0,"w2.context":!0,"interface/cookies":!0,"unified_view/modal":!0,"interface/dialog":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/answer",function(require,a,b){var c=require,d=require("interface/settings").pageIsMobile,e=require("unified_view/action_bar/overflow_menu/base");if(d)var f=c("mobile_app2/client");else var g=c("webnode2").ModalWithCallBacks;a.EditBio=e.WithServerCall.extend({onSelectAction:function(){if(d)f.sendMessageToClient("openURL",{target:"modal",url:this.url});else{var a=new g(this,{});a.load("selected")}}}),a.AskToImprove=e.Toggleable.extend({onToggledOn:function(){d&&this.url!="#"&&f.sendMessageToClient("openURL",{target:"modal",url:this.url})}})},{"interface/settings":!0,"unified_view/action_bar/overflow_menu/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/profile",function(require,a,b){var c=require,d=require("interface/settings").pageIsMobile,e=require("unified_view/action_bar/overflow_menu/base");if(!d){var f=c("webnode2"),g=f.ModalWithCallBacks,h=c("view/modal").Base;a.CallbackModal=h.extend({onSubmit:function(){this._super.apply(this,arguments),f.Modal.modalFor(this).executeOnSubmitCallBack()}})}else var i=c("mobile_app2/client");a.MuteUser=e.Toggleable.extend({onToggledOff:function(){var a=this;if(d)this.unmuteServerCall();else{var b=new g(this,{});b.onSubmitCallBack(function(){a.unmuteServerCall()}),b.load("load_unmute_modal")}},onToggledOn:function(){var a=this;if(d)this.muteServerCall();else{var b=new g(this,{});b.onSubmitCallBack(function(){a.muteServerCall()}),b.load("load_mute_modal")}},muteServerCall:function(){this.serverCall("mute_user").liveMutate().send()},unmuteServerCall:function(){this.serverCall("unmute_user").liveMutate().send()}}),a.BlockUser=e.Toggleable.extend({onToggledOff:function(){var a=this;if(d)this.unblockServerCall();else{var b=new g(this,{});b.onSubmitCallBack(function(){a.unblockServerCall()}),b.load("load_unblock_modal")}},onToggledOn:function(){var a=this;if(d)this.blockServerCall();else{var b=new g(this,{});b.onSubmitCallBack(function(){a.blockServerCall()}),b.load("load_block_modal")}},blockServerCall:function(){this.serverCall("block_user").liveMutate().send()},unblockServerCall:function(){this.serverCall("unblock_user").liveMutate().send()}})},{"interface/settings":!0,"unified_view/action_bar/overflow_menu/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/privacy",function(require,a,b){var c=require("interface/component").Component,d=require("interface/settings").pageIsMobile,e=require("unified_view/modal").ModalBase,f=require;if(!d)var g=f("webnode2"),h=g.ModalWithCallBacks;else var i=f("mobile_app2/client");a.ToggleQuestionPrivacyJSMixin={load_confirmation_dialog:function(a){if(d)i.sendMessageToClient("openURL",{target:"modal",url:a.mobile_url});else{var b={qid:this.qid,to_privacy:this.to_privacy,all_inconsistent_qids:a.all_inconsistent_qids,acted_inconsistent_qids:a.acted_inconsistent_qids},c=new h(this,{kwargs:b});c.load("confirm_dialog_contents")}},set_privacy:function(){var a=this;return a.serverCall("try_set_privacy").kwargs({qid:a.qid,to_privacy:a.to_privacy}).success(function(b){d&&(b=b.value,b||i.sendMessageToClient("reload")),b&&"response"in b&&b.response=="privacy_change_needs_confirmation"&&a.load_confirmation_dialog(b)}).liveMutate().send(),!1}},a.ToggleQuestionPrivacyMixin=c.extend(a.ToggleQuestionPrivacyJSMixin),a.ConfirmPrivacyModal=e.extend({onSubmit:function(){var a=this,b=a._super,c={qid:a.qid,to_privacy:a.to_privacy,all_inconsistent_qids:a.all_inconsistent_qids};a.serverCall("set_privacy").kwargs(c).success(function(){b.apply(a)}).liveMutate().send()}}),a.QuestionAnonLink=a.ToggleQuestionPrivacyMixin.extend({onLoad:function(){var a=this;this.$id("@set_privacy").on("click",function(b){b.preventDefault(),a.set_privacy()})}})},{"interface/settings":!0,"interface/component":!0,"unified_view/modal":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/question",function(require,a,b){var c=require,d=require("unified_view/action_bar/overflow_menu/base"),e=require("unified_view/privacy"),f=require("w2.context");a.PrivacyToggle=d.Toggleable.extend(e.ToggleQuestionPrivacyJSMixin).extend({onToggledOn:function(){this.set_privacy()},onToggledOff:function(){this.set_privacy()}}),a.EditMenu=d.Item.extend({contextConstructor:function(){return f.EditQuestionOverflow},onSelectAction:function(){this.getContext(f.EditQuestionOverflow).set("showMenu",!0)}})},{"w2.context":!0,"unified_view/action_bar/overflow_menu/base":!0,"unified_view/privacy":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/remove_from_feed",function(require,a,b){var c=require("unified_view/action_bar/overflow_menu/base"),d=require("w2.context");a.Item=c.WithServerCall.extend({onSelectAction:function(){this._super.apply(this,arguments),this.getContext(d.FeedStoryItem).set("hideItem",!0)}}),a.DownvoteQuestion=c.WithServerCall.extend({onSelectAction:function(){this._super.apply(this,arguments),this.getContext(d.FeedStoryItem).set("showQuestionDownvoteFeedback",!0)}})},{"w2.context":!0,"unified_view/action_bar/overflow_menu/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/action_bar/overflow_menu/shared",function(require,a,b){var c=require,d=require("interface/settings").pageIsMobile,e=require("unified_view/action_bar/overflow_menu/base"),f=require("w2.context");if(d)var g=c("mobile_app2/client");else var h=c("view/inline_editor"),i=h.registerEditorCallback,j=h.unregisterEditorCallback,k=h.triggerEditorCallback,l=h.isInEditMode,m=c("app/view/common"),n=m.registerContentToggleCallback,o=m.unregisterContentToggleCallback,p=m.triggerContentToggleCallback;a.AddModerationFlagWrapper=e.Item.extend({desktopOnLoad:function(){},onSelectAction:function(){g.sendMessageToClient("openURL",{target:"modal",url:this.url})}}),a.NativeShare=e.Item.extend({onSelectAction:function(){var a=this;g.showNativeShareSheet(this.share,this,function(b,c){switch(c){case 0:g.sendMessageToClient("openURL",b.quora_message_data);break;case 1:g.sendMessageToClient("openURL",b.share_to_blog_data);break;case 2:g.sendMessageToClient("shareCopyURL",b.copy_data),a.serverCall("share_log_copy_link").kwargs({data:b}).send()}})}}),a.EditItemMobile=e.Item.extend({onSelectAction:function(){this.invokeRichTextEditor(this.editor_kwargs)}}),a.EditItemWeb=e.Item.extend({onLoad:function(){this._super(),this.$labelElem=this.$id("@contents"),this.bindEditorEvents(),this.editorLoaded()},onUnload:function(){this.unbindEditorEvents()},bindEditorEvents:function(){i("cancel",this.content_type,this.oid,this.cid,this.setToggled.bind(this,!1)),i("submitted",this.content_type,this.oid,this.cid,this.setToggled.bind(this,!1)),i("load",this.content_type,this.oid,this.cid,this.editorLoaded.bind(this)),i("edit",this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindEditorEvents:function(){j("cancel",this.content_type,this.oid,this.cid),j("submitted",this.content_type,this.oid,this.cid),j("edit",this.content_type,this.oid,this.cid)},onSelectAction:function(){var a=this.toggled?"cancel":"edit";k(a,this.content_type,this.oid)},editorLoaded:function(){this.setToggled(l(this.content_type,this.oid))},setToggled:function(a){this.toggled=a,this.updateLabel()},toggle:function(){this.setToggled(!this.toggled)},updateLabel:function(){var a=this.toggled?this.alternate_label:this.label;this.$labelElem.text(a)}}),a.SuggestionsPendingItemWeb=a.EditItemWeb.extend({bindEditorEvents:function(){n(this.content_type,this.oid,this.cid,this.toggle.bind(this)),i("submit",this.content_type,this.oid,this.cid,this.toggle.bind(this))},unbindEditorEvents:function(){o(this.content_type,this.oid,this.cid),j("submit",this.content_type,this.oid,this.cid)},onSelectAction:function(){p(this.content_type,this.oid)}}),a.AddComment=e.Item.extend({onSelectAction:function(){this.invokeRichTextEditor(this.editor_kwargs)}}),a.RemoveFromFeed=e.Item.extend({onSelectAction:function(){this.getContext(f.FeedStoryItem).set("showRemoveFromFeedMenu",!0)}})},{"interface/settings":!0,"w2.context":!0,"unified_view/action_bar/overflow_menu/base":!0})}),require.whenReady("settings",function(){require.install("unified_view/bounty/manage",function(require,a,b){var c=require("interface/component").Component;a.BountyApplicationManage=c.extend({onLoad:function(){var a=this;a.$id("@accept_link").on("click",function(b){b.preventDefault(),a.serverCall("accept").liveMutate().send()})}}),a.BountyAddForm=c.extend({onLoad:function(){this.isSubmitting=!1},isValid:function(){var a=this.getValues();return!!a.question_text},getAmountCents:function(){var a=this.$id("@amount_picker input[type=radio]:checked");if(a)return parseInt(a.val())},getValues:function(){return{question_text:this.$id("@question_text").val(),question_details:this.$id("@question_details").val(),amount_cents:this.getAmountCents(),anonymous:this.$id("@anonymous").attr("checked")==="checked"}},submit:function(a){var b=this;b.isSubmitting||(b.isSubmitting=!0,b.serverCall("submit").kwargs(this.getValues()).success(function(){b.isSubmitting=!1,a()}).error(function(){b.isSubmitting=!1}).liveMutate().send())}}),a.BountyChooseBestAnswerForm=c.extend({onLoad:function(){this.isSubmitting=!1},isValid:function(){return!!this.getSelectedAID()},getSelectedAID:function(){var a=this.$id("@picker input[type=radio]:checked");if(a)return parseInt(a.val())},submit:function(a){var b=this;b.isValid()&&!b.isSubmitting&&(b.isSubmitting=!0,b.serverCall("submit").kwargs({aid:b.getSelectedAID()}).success(function(){b.isSubmitting=!1,a()}).error(function(){b.isSubmitting=!1}).liveMutate().send())}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/bounty/writer",function(require,a,b){var c=require("interface/component").Component;a.BountyApplicationBioPicker=c.extend({getTID:function(){var a=this.$id("@picker input[type=radio]:checked");if(a)return parseInt(a.val())}}),a.BountyApplicationForm=c.extend({onLoad:function(){this.isSubmitting=!1},isValid:function(){return this.getValues().bio_tid!==undefined},getValues:function(){return{bio_tid:this.child("bio_picker").getTID(),reason:this.$id("@reason").val()}},submit:function(a){var b=this;!b.isSubmitting&&b.isValid()&&(b.isSubmitting=!0,b.serverCall("submit").kwargs(this.getValues()).liveMutate().success(function(){b.isSubmitting=!1,a()}).error(function(){b.isSubmitting=!1}).send())}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/abstract",function(require,a,b){var c=require("interface/component").Component,d=require,e=require("interface/settings"),f=require("interface/cookies");a.Button=c.extend({keyCombination:null,onLoad:function(){var a=this;if(!a.disabled){var b=a.$id("@button");b.on("click",function(b){b.preventDefault(),a.onClick()}),a.keyCombination&&a.onKeyCombination(b.get(),a.keyCombination,a.onClick.bind(a))}},onClick:function(){this.onPressed()},onPressed:function(){var a=this;a.qfeed_log_press_action&&f.setQfeedLog(a,a.qfeed_log_press_action),this.serverCall("press").liveMutate().error(function(){a.switchState(!1)}).send()}}),a.TwoStateButton=a.Button.extend({onClick:function(){var a=this;a.dirtyURL(),a.pressed?a.onUnpressed():a.onPressed(),a.switchState(!this.pressed)},dirtyURL:function(){var a=this;if(e.pageIsMobile&&a.url_to_dirty){var b=d("mobile_app2/client");b.sendMessageToClient("removeURLFromCache",{url:a.url_to_dirty})}},switchState:function(a){if(this.pressed==a)return;if(!e.isLoggedIn)return;if(!e.pageIsMobile&&!this.optimistic_for_web)return;var b=this.$id("@button"),c=this.$id("@text"),d=c.text();c.text(this.optimistic_text),this.optimistic_text=d;if(this.optimistic_count){var f=this.$id("@count");this.optimistic_count==="0"?f.addClass("hidden"):f.removeClass("hidden");var g=f.text();f.text(this.optimistic_count),this.optimistic_count=g}this.pressed?b.removeClass("pressed"):b.addClass("pressed"),this.pressed=a},onUnpressed:function(){var a=this;a.qfeed_log_unpress_action&&f.setQfeedLog(a,a.qfeed_log_unpress_action),this.serverCall("unpress").liveMutate().error(function(){a.switchState(!0)}).send()}})},{"interface/cookies":!0,"interface/settings":!0,"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/downvote",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies"),e=require("interface/settings"),f=require("w2.context").AnswerVoteContext,g=require("w2.context").FeedStoryItem;a.Answer=c.extend({keyCombination:"d",onLoad:function(){var a=this;this._super.apply(this,arguments),this.answerVoteContext=this.getContext(f),this.feedStoryItemContext=this.getContext(g);if(!this.optimistic_for_web)return;this.answerVoteContext.on("voteState",function(b,c){c==="downvote"?a.switchState(!0):a.switchState(!1)}),this.answerVoteContext.get("voteState")==="no"&&this.pressed&&this.answerVoteContext.set("voteState","downvote");if(this.feedStoryItemContext!==null){var b=function(b,c){c===!1&&a.answerVoteContext.set("voteState","no")};this.feedStoryItemContext.on("feedbackShown",b)}},onClick:function(){this.dirtyURL(),this.pressed?(this.onUnpressed(),this.updateAnswerVoteState("no")):(this.onPressed(),this.updateAnswerVoteState("downvote"))},updateAnswerVoteState:function(a){this.optimistic_for_web?this.answerVoteContext.set("voteState",a):this.switchState(!this.pressed)},onPressed:function(){d.setQfeedLog(this,"AnswerDownvote"),d.setTlog({type:"AnswerVoteDown",aid:this.aid}),this.show_feedback&&this.feedStoryItemContext&&this.feedStoryItemContext.set("showAnswerDownvoteFeedback",!0),this._super.apply(this,arguments)},onUnpressed:function(){e.pageIsMobile||this.show_feedback&&this.feedStoryItemContext&&this.feedStoryItemContext.set("showAnswerDownvoteFeedback",!1),this._super.apply(this,arguments)}}),a.BlogPost=c.extend({keyCombination:"d",onPressed:function(){d.setTlog({type:"BoardItemVoteDown",board_item_id:this.biid}),this._super.apply(this,arguments)}}),a.Question=c.extend({keyCombination:"d",onLoad:function(){this.feedStoryItemContext=this.getContext(g),this._super.apply(this,arguments)},onPressed:function(){d.setQfeedLog(this,"QuestionDownvote"),d.setTlog({type:"QuestionDownvote",qid:this.qid}),this.show_feedback&&this.feedStoryItemContext&&this.feedStoryItemContext.set("showQuestionDownvoteFeedback",!0),this._super.apply(this,arguments)},onUnpressed:function(){this._super.apply(this,arguments)}})},{"interface/cookies":!0,"interface/settings":!0,"w2.context":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/follow",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies");a.Topic=c.extend({onPressed:function(){d.setTlog({type:"TopicFollow",tid:this.tid}),d.setQfeedLog(this,"TopicFollow"),this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"TopicUnfollow",tid:this.tid}),d.setQfeedLog(this,"TopicUnfollow"),this._super.apply(this,arguments)}}),a.Question=c.extend({keyCombination:"w",onPressed:function(){d.setTlog({type:"QuestionFollow",qid:this.qid}),this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"QuestionUnfollow",qid:this.qid}),this._super.apply(this,arguments)}}),a.User=c.extend({keyCombination:"f",onPressed:function(){d.setTlog({type:"UserFollow",uid:this.uid}),d.setQfeedLog(this,"UserFollow"),this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"UserUnfollow",uid:this.uid}),d.setQfeedLog(this,"UserUnfollow"),this._super.apply(this,arguments)}}),a.Blog=c.extend({onPressed:function(){d.setTlog({type:"BoardFollow",bid:this.bid}),this._super.apply(this,arguments)}})},{"interface/cookies":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/pin",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies");a.Topic=c.extend({onPressed:function(){d.setTlog({type:"PinFollow",oid:this.oid}),d.setQfeedLog(this,"PinFollow"),this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"PinFollow",oid:this.oid}),d.setQfeedLog(this,"PinUnfollow"),this._super.apply(this,arguments)}})},{"interface/cookies":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/reask",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies"),e=require("interface/settings").pageIsMobile,f=require;if(e)var g=f("mobile_app2/client");a.ReAsk=c.extend({onPressed:function(){d.setTlog({type:"ReAsk",qid:this.qid}),d.setQfeedLog(this,"ReAsk");if(e){var a=g.getBroadcastKey("question",this.qid,"following");g.broadcastKeyUpdate(a,"yes")}this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"ReAsk",qid:this.qid}),d.setQfeedLog(this,"ReAsk"),this._super.apply(this,arguments)}})},{"interface/cookies":!0,"interface/settings":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/slow_connection",function(require,a,b){var c=require("unified_view/button/abstract").Button,d=require,e=require("interface/settings").pageIsMobile;if(e)var f=d("mobile_app2/client");a.SlowConnectionButton=c.extend({onPressed:function(){this.serverCall("press").success(function(){e&&f.sendMessageToClient("reload")}).send()}})},{"interface/settings":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/network",function(require,a,b){var c=require,d=require("unified_view/button/abstract").Button,e=require("interface/settings").pageIsMobile;if(e)var f=c("mobile_app2/client");a.ActivationButton=d.extend({onPressed:function(){this.serverCall("press").success(function(){e?f.sendMessageToClient("openURL",{url:"/"}):document.location="/"}).liveMutate().send()}})},{"interface/settings":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/upvote",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies"),e=require("w2.context").AnswerVoteContext;a.Answer=c.extend({keyCombination:"u",onLoad:function(){var a=this;this._super.apply(this,arguments),this.answerVoteContext=this.getContext(e);if(!this.optimistic_for_web)return;this.answerVoteContext.on("voteState",function(b,c){c==="upvote"?a.switchState(!0):a.switchState(!1)}),this.answerVoteContext.get("voteState")==="no"&&this.pressed&&this.answerVoteContext.set("voteState","upvote")},onClick:function(){this.dirtyURL(),this.pressed?(this.onUnpressed(),this.updateAnswerVoteState("no")):(this.onPressed(),this.updateAnswerVoteState("upvote"))},updateAnswerVoteState:function(a){this.optimistic_for_web?this.answerVoteContext.set("voteState",a):this.switchState(!this.pressed)},onPressed:function(){d.setQfeedLog(this,"AnswerUpvote"),d.setTlog({type:"AnswerVoteUp",aid:this.aid}),this._super.apply(this,arguments)}}),a.BlogPost=c.extend({keyCombination:"u",onPressed:function(){d.setQfeedLog(this,"BoardItemUpvote"),d.setTlog({type:"BoardItemUpvote",board_item_id:this.biid}),this._super.apply(this,arguments)}})},{"interface/cookies":!0,"w2.context":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/write_answer",function(require,a,b){var c=require("unified_view/button/abstract").Button,d=require("w2.context");a.WriteAnswer=c.extend({keyCombination:"a",onClick:function(){this.getContext(d.ActionBar).set("toggleEditor",!0)}})},{"w2.context":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/button/writing_list",function(require,a,b){var c=require("unified_view/button/abstract").TwoStateButton,d=require("interface/cookies");a.WritingList=c.extend({onPressed:function(){d.setTlog({type:"QuestionAnswerLater",oid:this.oid}),d.setQfeedLog(this,"QuestionAnswerLater"),this._super.apply(this,arguments)},onUnpressed:function(){d.setTlog({type:"UnmarkQuestionAnswerLater",oid:this.oid}),d.setQfeedLog(this,"UnmarkQuestionAnswerLater"),this._super.apply(this,arguments)}})},{"interface/cookies":!0,"unified_view/button/abstract":!0})}),require.whenReady("settings",function(){require.install("unified_view/network/invite",function(require,a,b){var c=require("interface/component").Component;a.InviteForm=c.extend({onLoad:function(){var a=this;a.$id("@input").on("keydown",function(b){b.keyCode==13&&a.sendInvite()}),a.$id("@submit").on("click",function(){a.sendInvite()})},sendInvite:function(){var a=this,b=a.$id("@input").val();a.serverCall("invite").kwargs({email:b}).success(function(){a.$id("@input").val("").focus()}).send()}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/network/join",function(require,a,b){var c=require("interface/component").Component;a.PublicRequestForm=c.extend({onLoad:function(){var a=this;a.$id("@input").on("keydown",function(b){b.keyCode==13&&a.sendRequest()}),a.$id("@submit").on("click",function(){a.sendRequest()})},sendRequest:function(){var a=this,b=a.$id("@input").val();a.serverCall("request").kwargs({email:b}).success(function(){a.$id("@input").val("").focus()}).send()}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/payment/money",function(require,a,b){var c=require("interface/component").Component;a.MoneyAmountInput=c.extend({onLoad:function(){var a=this;a.$amount=a.$id("@amount"
),a.$amount.on("keydown paste change",function(b){setTimeout(function(){a._filter()},1)}),a.$amount.on("blur",function(b){a._filter(!0)})},getValueInCents:function(){var a=this._cleanVal(!0)[1];return a.indexOf(".")===-1?a+="00":a=a.replace(".",""),parseInt(a)},_filter:function(a){var b=this._cleanVal(a),c=b[0],d=b[1],e=b[2];if(c!==d){var f=this.$amount.get()[0],g=f.selectionStart+e,h=f.selectionEnd+e;this.$amount.val(d),f.setSelectionRange(g,h)}},_cleanVal:function(a){var b=this.$amount.val(),c="",d=0,e=0,f=0;for(var g=0;g<b.length;g++){var h=b.charAt(g);this.allowCents&&h==="."?e===0&&(d===0&&(c+="0",d++,f++),c+=h,e++):isNaN(h)||(e>0?e!==3&&(c+=h,e++):d<this.maxDollarNumbers&&(c+=h,d++))}if(a)while(e!==0&&e<3)c+="0",e++;var i=c.length;c=c.replace(/^0+(?=\d)/,"");var j=i-c.length;return j>0&&(d-=j,f-=j),[b,c,f]}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/payment/_payment",function(require,a,b){var c=require("interface/component").Component;a.PaymentMethod=c,a.AddCardForm=c.extend({onLoad:function(){var a=this;a.$name=a.$id("@name"),a.$number=a.$id("@number"),a.$expiry=a.$id("@expiry"),a.$cvc=a.$id("@cvc"),a.$zip=a.$id("@zip"),a.$date_of_birth=a.$id("@date_of_birth"),a.cardType=null,a.isSubmitting=!1,a._inputClean(a.$number,function(b){var c=Stripe.card.cardType(b);switch(c){case"Unknown":c=null;break;case"American Express":c="amex";break;case"Diners Club":c="diners";break;default:c=c.toLowerCase().replace(/\s+/g,"")}a._setCardType(c);var d=b.replace(/[^0-9]/g,"");return c==="amex"?d=(d.slice(0,4)+" "+d.slice(4,10)+" "+d.slice(10,d.length)).trim():d=(d.slice(0,4)+" "+d.slice(4,8)+" "+d.slice(8,12)+" "+d.slice(12,d.length)).trim(),d}),a._inputClean(a.$expiry,function(a){var b=a.replace(/[^0-9]/g,"");return a.slice(2,a.length)===" /"?b[0]:(b.length===1&&(b[0]!=="0"&&b[0]!=="1"||a.length===2&&b[0]==="1"&&(a[1]===" "||isNaN(a[1])))&&(b="0"+b),b.length>1&&(b=b.slice(0,2)+" / "+b.slice(2,b.length)),b)}),a.$cvc&&a._inputClean(a.$cvc,function(a){return a.replace(/[^0-9]/g,"")}),a.$date_of_birth&&a._inputClean(a.$date_of_birth,function(a){var b=a.replace(/[^0-9]/g,"");a.slice(-2)===" /"&&(b=b.slice(0,b.length-1));var c=b.slice(0,2),d=parseInt(c,10);if(d>12||c.length<2&&d>1)b="0"+b;var e=b.slice(2,4),f=parseInt(e,10);if(f>31||e.length<2&&f>3)b=b.slice(0,2)+"0"+b.slice(2,b.length);var g=b.slice(4,6);if(g.length==2&&g!="19"&&g!="20"){var h="19";parseInt(g,10)<16&&(h="20"),b=b.slice(0,4)+h+b.slice(4,b.length)}var i=b.slice(0,2);return b.length>=2&&(i+=" / "+b.slice(2,4)),b.length>=4&&(i+=" / "+b.slice(4,b.length)),i}),a.focus()},focus:function(){this.$number.focus()},getExpiryMonth:function(){return this.$expiry.val().replace(/[^0-9]/g,"").slice(0,2)},getExpiryYear:function(){var a=this.$expiry.val();return a.replace(/[^0-9]/g,"").slice(2,a.length)},getBirthYear:function(){var a=this.$date_of_birth.val();return a.replace(/[^0-9]/g,"").slice(4,a.length)},getBirthMonth:function(){return this.$date_of_birth.val().replace(/[^0-9]/g,"").slice(0,2)},getBirthDay:function(){return this.$date_of_birth.val().replace(/[^0-9]/g,"").slice(2,4)},isValid:function(){return this.debit_only?this.getBirthYear()&&this.getBirthMonth()&&this.getBirthDay():!0},submit:function(a){var b=this;!b.isSubmitting&&b.isValid()&&(b.isSubmitting=!0,b._getStripeToken(function(c,d){if(d.error)b.isSubmitting=!1,alert(d.error.message);else{var e={stripe_response:d};b.debit_only&&(e.birth_year=b.getBirthYear(),e.birth_month=b.getBirthMonth(),e.birth_day=b.getBirthDay()),b.serverCall("submit").kwargs(e).success(function(){b.isSubmitting=!1,a()}).error(function(){b.isSubmitting=!1}).liveMutate().send()}}))},_getStripeToken:function(a){function c(c,d){!d.error&&b.debit_only&&d.card.funding!=="debit"?a(c,{error:{message:b.debit_only_error_text}}):a(c,d)}var b=this;Stripe.card.createToken({name:this.$name.val(),number:this.$number.val(),exp_month:this.getExpiryMonth(),exp_year:this.getExpiryYear(),cvc:this.debit_only?undefined:this.$cvc.val(),address_zip:this.debit_only?undefined:this.$zip.val(),currency:"usd"},c)},_inputClean:function(a,b){a&&a.on("keydown paste change",function(c){setTimeout(function(){var c=a.val(),d=b(c);c!==d&&a.val(d)},1)})},_setCardType:function(a){if(this.cardType===a)return;this.cardType&&this.$number.removeClass(this.cardType),this.cardType=a,this.cardType&&this.$number.addClass(this.cardType),this.cardType==="amex"?this.$number.attr("maxlength","17"):this.$number.attr("maxlength","19")}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/settings/privacy",function(require,a,b){var c=require,d=require("interface/component").Component,e=require("interface/settings").pageIsMobile;if(!e)var f=c("webnode2"),g=f.ModalWithCallBacks;else var h=c("mobile_app2/app/view/common"),i=c("mobile_app2/client"),j=c("settings").interface_strings;var k=d.extend({onLoad:function(a){e?this.mobileOnLoad():this.desktopOnLoad(a)},desktopOnLoad:function(){var a=this;this.$id("@check_reauth").on("click",function(b){a.serverCall("check_reauth").success(function(){a.showControl()}).send(),b.preventDefault()})},showControl:function(){this.$id("@check_reauth").addClass("hidden"),this.$id("@option_control").removeClass("hidden")},showAlert:function(a){var b=this;h.showAlert({title:b.dialog_title,message:b.dialog_message,callback:function(b){b.buttonIndex===0&&a&&a()},cancelButtonTitle:b.dialog_button_title,otherButtonTitles:[j.cancel]})}});a.DeactivateAccountCell=k.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var a=this;this.$id("@deactivate").on("click",function(){var b=new g(a,{});b.onSubmitCallBack(function(){a.deactivateAccount()}),b.load("load_deactivate_account_modal")})},mobileOnLoad:function(){var a=this;this.$id("@deactivate").on("click",function(){a.showAlert(a.deactivateAccount.bind(a))})},deactivateAccount:function(){this.serverCall("deactivate_account").success(function(){e&&i.sendMessageToClient("loginStateChanged",{isLoggedIn:!1})}).send()}}),a.DeleteAccountCell=k.extend({desktopOnLoad:function(){this._super.apply(this,arguments);var a=this;this.$id("@delete").on("click",function(){var b=new g(a,{});b.onSubmitCallBack(function(){a.deleteAccount()}),b.load("load_delete_account_modal")})},mobileOnLoad:function(){var a=this;this.$id("@delete").on("click",function(){a.showAlert(a.deleteAccount.bind(a))})},deleteAccount:function(){this.serverCall("delete_account").success(function(){e&&i.sendMessageToClient("loginStateChanged",{isLoggedIn:!1})}).send()}})},{"interface/settings":!0,"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/switch",function(require,a,b){var c=require("interface/component").Component;a.Switch=c.extend({onLoad:function(){var a=this,b=a.$id("@switch");b.on("click",function(){b.hasClass("on")?a.serverCall("off").kwargs(a.kwargs).liveMutate().error(function(){b.removeClass("on").addClass("off")}).send():a.serverCall("on").kwargs(a.kwargs).liveMutate().error(function(){b.addClass("on").removeClass("off")}).send(),b.toggleClass("on").toggleClass("off")})}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/mobile_debug",function(require,a,b){var c=require("interface/component").Component,d=require("interface/cookies"),e=require("keystrokes"),f,g,h=c.extend({toggle:function(){var a=this;a.has_cookie?d.setCookie(a.cookie_key,null):d.setCookie(a.cookie_key,1),window.location.reload()}});a.ToggleMobileButton=h.extend({onLoad:function(){var a=this;f=a,a.$id("@toggle").on("click",function(b){return a.toggle(),b.preventDefault(),b.stopPropagation(),!1})}}),a.ToggleTabletButton=h.extend({onLoad:function(){var a=this;g=a,a.$id("@toggle").on("click",function(b){return a.toggle(),b.preventDefault(),b.stopPropagation(),!1})}}),e.on([77,48,77,48],function(){f&&f.toggle()}),e.on([84,48,84,48],function(){g&&g.toggle()})},{"interface/cookies":!0,"interface/component":!0,keystrokes:!0})}),require.whenReady("settings",function(){require.install("unified_view/translation",function(require,a,b){var c=require("interface/component").Component;a.TranslationInterfaceToggle=c.extend({onLoad:function(){this._state=!1,this.setupKeyboardShortcut()},toggle:function(){var a=this,b,c=document.getElementsByClassName("translation_interface_info");if(!a._state){a._state=!0;for(b=0;b<c.length;b++)c[b].style.display="block"}else{a._state=!1;for(b=0;b<c.length;b++)c[b].style.display="none"}},setupKeyboardShortcut:function(){require("keystrokes").on([76,73,68,76,73,68],this.fnbind(this.toggle))}})},{"interface/component":!0,keystrokes:!0})}),require.whenReady("settings",function(){require.install("qtext2/util",function(require,a,b){var c=["keydown","keyup","keypress"],d=/^https?\:\/\//,e={assert:function(a){if(!a){var b=Array.prototype.slice.call(arguments,1);throw new Error(b)}},create:function(a){return document.createElement(a)},extend:function(a,b){if(!b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},getData:function(a,b){return a.getAttribute("data-"+b)},setData:function(a,b,c){a.setAttribute("data-"+b,c)},removeData:function(a,b){a.removeAttribute("data-"+b)},isTextNode:function(a){return a.nodeType==3},on:function(a,b,d){b.addEventListener(a,function(b){var e;return c.indexOf(a)!=-1&&(b.which=b.charCode!==undefined?b.charCode:b.keyCode),e=d(b),e===!1&&(b.preventDefault(),b.stopPropagation()),e})},ensureProtocol:function(a){return d.test(a)||(a="http://"+a),a},splitLines:function(a){return a.split(/\n|\r\n?/)},splitByRegex:function(a,b){var c,d=[];while(a)c=a.match(b),c?(c.index&&d.push({text:a.slice(0,c.index)}),d.push({text:c[0],match:c}),a=a.slice(c.index+c[0].length)):(d.push({text:a}),a="");return d},jsonEqual:function(a,b){var c,d;if(a===b)return!0;if(typeof a!="object"||typeof b!="object")return a===b;if(a===null||a===undefined||b===null||b===undefined)return!1;if(typeof a!=typeof b)return!1;if(a instanceof Array){if(a.length!==b.length)return!1;for(var f=0;f<a.length;f++)if(!e.jsonEqual(a[f],b[f]))return!1;return!0}return c=Object.getOwnPropertyNames(a),d=Object.getOwnPropertyNames(b),c.length!=d.length?!1:c.every(function(c){return e.jsonEqual(a[c],b[c])})}};a.Util=e},{})}),require.whenReady("settings",function(){require.install("third_party/rangy-core",function(require,a,b){window.rangy=function(){function h(c,d){var e=typeof c[d];return e==b||e==a&&!!c[d]||e=="unknown"}function i(b,c){return typeof b[c]==a&&!!b[c]}function j(a,b){return typeof a[b]!=c}function k(a){return function(b,c){var d=c.length;while(d--)if(!a(b,c[d]))return!1;return!0}}function o(a){return a&&l(a,g)&&n(a,f)}function q(a){window.alert("Rangy not supported in your browser. Reason: "+a),p.initialized=!0,p.supported=!1}function r(a){var b="Rangy warning: "+a;p.config.alertOnWarn?window.alert(b):typeof window.console!=c&&typeof window.console.log!=c&&window.console.log(b)}function u(){if(p.initialized)return;var a,b=!1,c=!1;h(document,"createRange")&&(a=document.createRange(),l(a,e)&&n(a,d)&&(b=!0),a.detach());var f=i(document,"body")?document.body:document.getElementsByTagName("body")[0];f&&h(f,"createTextRange")&&(a=f.createTextRange(),o(a)&&(c=!0)),!b&&!c&&q("Neither Range nor TextRange are implemented"),p.initialized=!0,p.features={implementsDomRange:b,implementsTextRange:c};var g=t.concat(s);for(var j=0,k=g.length;j<k;++j)try{g[j](p)}catch(m){i(window,"console")&&h(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",m)}}function w(a){a=a||window,u();for(var b=0,c=v.length;b<c;++b)v[b](a)}function x(a){this.name=a,this.initialized=!1,this.supported=!1}var a="object",b="function",c="undefined",d=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],f=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],l=k(h),m=k(i),n=k(j),p={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:h,isHostObject:i,isHostProperty:j,areHostMethods:l,areHostObjects:m,areHostProperties:n,isTextRange:o},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};p.fail=q,p.warn=r,{}.hasOwnProperty?p.util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}:q("hasOwnProperty not supported");var s=[],t=[];p.init=u,p.addInitListener=function(a){p.initialized?a(p):s.push(a)};var v=[];p.addCreateMissingNativeApiListener=function(a){v.push(a)},p.createMissingNativeApi=w,x.prototype.fail=function(a){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+a)},x.prototype.warn=function(a){p.warn("Module "+this.name+": "+a)},x.prototype.createError=function(a){return new Error("Error in Rangy "+this.name+" module: "+a)},p.createModule=function(a,b){var c=new x(a);p.modules[a]=c,t.push(function(a){b(a,c),c.initialized=!0,c.supported=!0})},p.requireModules=function(a){for(var b=0,c=a.length,d,e;b<c;++b){e=a[b],d=p.modules[e];if(!d||!(d instanceof x))throw new Error("Module '"+e+"' not found");if(!d.supported)throw new Error("Module '"+e+"' not supported")}};var y=!1,z=function(a){y||(y=!0,p.initialized||u())};if(typeof window==c){q("No window found");return}if(typeof document==c){q("No document found");return}return h(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",z,!1),h(window,"addEventListener")?window.addEventListener("load",z,!1):h(window,"attachEvent")?window.attachEvent("onload",z):q("Window does not have required addEventListener or attachEvent method"),p}(),rangy.createModule("DomUtil",function(a,b){function h(a){var b;return typeof a.namespaceURI==c||(b=a.namespaceURI)===null||b=="http://www.w3.org/1999/xhtml"}function i(a){var b=a.parentNode;return b.nodeType==1?b:null}function j(a){var b=0;while(a=a.previousSibling)b++;return b}function k(a){var b;return o(a)?a.length:(b=a.childNodes)?b.length:0}function l(a,b){var c=[],d;for(d=a;d;d=d.parentNode)c.push(d);for(d=b;d;d=d.parentNode)if(g(c,d))return d;return null}function m(a,b,c){var d=c?b:b.parentNode;while(d){if(d===a)return!0;d=d.parentNode}return!1}function n(a,b,c){var d,e=c?a:a.parentNode;while(e){d=e.parentNode;if(d===b)return e;e=d}return null}function o(a){var b=a.nodeType;return b==3||b==4||b==8}function p(a,b){var c=b.nextSibling,d=b.parentNode;return c?d.insertBefore(a,c):d.appendChild(a),a}function q(a,b){var c=a.cloneNode(!1);return c.deleteData(0,b),a.deleteData(b,a.length-b),p(c,a),c}function r(a){if(a.nodeType==9)return a;if(typeof a.ownerDocument!=c)return a.ownerDocument;if(typeof a.document!=c)return a.document;if(a.parentNode)return r(a.parentNode);throw new Error("getDocument: no document found for node")}function s(a){var b=r(a);if(typeof b.defaultView!=c)return b.defaultView;if(typeof b.parentWindow!=c)return b.parentWindow;throw new Error("Cannot get a window object for node")}function t(a){if(typeof a.contentDocument!=c)return a.contentDocument;if(typeof a.contentWindow!=c)return a.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function u(a){if(typeof a.contentWindow!=c)return a.contentWindow;if(typeof a.contentDocument!=c)return a.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function v(a){return d.isHostObject(a,"body")?a.body:a.getElementsByTagName("body")[0]}function w(a){var b;while(b=a.parentNode)a=b;return a}function x(a,b,c,d){var e,f,g,h,i;if(a==c)return b===d?0:b<d?-1:1;if(e=n(c,a,!0))return b<=j(e)?-1:1;if(e=n(a,c,!0))return j(e)<d?-1:1;f=l(a,c),g=a===f?f:n(a,f,!0),h=c===f?f:n(c,f,!0);if(g===h)throw new Error("comparePoints got to case 4 and childA and childB are the same!");i=f.firstChild;while(i){if(i===g)return-1;if(i===h)return 1;i=i.nextSibling}throw new Error("Should not be here!")}function y(a){var b=r(a).createDocumentFragment(),c;while(c=a.firstChild)b.appendChild(c);return b}function z(a){if(!a)return"[No node]";if(o(a))return'"'+a.data+'"';if(a.nodeType==1){var b=a.id?' id="'+a.id+'"':"";return"<"+a.nodeName+b+">["+a.childNodes.length+"]"}return a.nodeName}function A(a){this.root=a,this._next=a}function B(a){return new A(a)}function C(a,b){this.node=a,this.offset=b}function D(a){this.code=this[a],this.codeName=a,this.message="DOMException: "+this.codeName}var c="undefined",d=a.util;d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||b.fail("document missing a Node creation method"),d.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var e=document.createElement("div");d.areHostMethods(e,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"]))||b.fail("Incomplete Element implementation"),d.isHostProperty(e,"innerHTML")||b.fail("Element is missing innerHTML property");var f=document.createTextNode("test");d.areHostMethods(f,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(e,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(f,["data"]))||b.fail("Incomplete Text Node implementation");var g=function(a,b){var c=a.length;while(c--)if(a[c]===b)return!0;return!1};A.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,b,c;if(this._current){b=a.firstChild;if(b)this._next=b;else{c=null;while(a!==this.root&&!(c=a.nextSibling))a=a.parentNode;this._next=c}}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(a){return this.node===a.node&this.offset==a.offset},inspect:function(){return"[DomPosition("+z(this.node)+":"+this.offset+")]"}},D.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},D.prototype.toString=function(){return this.message},a.dom={arrayContains:g,isHtmlNamespace:h,parentElement:i,getNodeIndex:j,getNodeLength:k,getCommonAncestor:l,isAncestorOf:m,getClosestAncestorIn:n,isCharacterDataNode:o,insertAfter:p,splitDataNode:q,getDocument:r,getWindow:s,getIframeWindow:u,getIframeDocument:t,getBody:v,getRootContainer:w,comparePoints:x,inspectNode:z,fragmentFromNodeChildren:y,createIterator:B,DomPosition:C},a.DOMException=D}),rangy.createModule("DomRange",function(a,b){function f(a,b){return a.nodeType!=3&&(c.isAncestorOf(a,b.startContainer,!0)||c.isAncestorOf(a,b.endContainer,!0))}function g(a){return c.getDocument(a.startContainer)}function h(a,b,c){var d=a._listeners[b];if(d)for(var e=0,f=d.length;e<f;++e)d[e].call(a,{target:a,args:c})}function i(a){return new d(a.parentNode,c.getNodeIndex(a))}function j(a){return new d(a.parentNode,c.getNodeIndex(a)+1)}function k(a,b,d){var e=a.nodeType==11?a.firstChild:a;return c.isCharacterDataNode(b)?d==b.length?c.insertAfter(a,b):b.parentNode.insertBefore(a,d==0?b:c.splitDataNode(b,d)):d>=b.childNodes.length?b.appendChild(a):b.insertBefore(a,b.childNodes[d]),e}function l(a){var b;for(var c,d=g(a.range).createDocumentFragment(),f;c=a.next();){b=a.isPartiallySelectedSubtree(),c=c.cloneNode(!b),b&&(f=a.getSubtreeIterator(),c.appendChild(l(f)),f.detach(!0));if(c.nodeType==10)throw new e("HIERARCHY_REQUEST_ERR");d.appendChild(c)}return d}function m(a,b,d){var e,f;d=d||{stop:!1};for(var g,h;g=a.next();)if(a.isPartiallySelectedSubtree()){if(b(g)===!1){d.stop=!0;return}h=a.getSubtreeIterator(),m(h,b,d),h.detach(!0);if(d.stop)return}else{e=c.createIterator(g);while(f=e.next())if(b(f)===!1){d.stop=!0;return}}}function n(a){var b;while(a.next())a.isPartiallySelectedSubtree()?(b=a.getSubtreeIterator(),n(b),b.detach(!0)):a.remove()}function o(a){for(var b,c=g(a.range).createDocumentFragment(),d;b=a.next();){a.isPartiallySelectedSubtree()?(b=b.cloneNode(!1),d=a.getSubtreeIterator(),b.appendChild(o(d)),d.detach(!0)):a.remove();if(b.nodeType==10)throw new e("HIERARCHY_REQUEST_ERR");c.appendChild(b)}return c}function p(a,b,c){var d=!!b&&!!b.length,e,f=!!c;d&&(e=new RegExp("^("+b.join("|")+")$"));var g=[];return m(new r(a,!1),function(a){(!d||e.test(a.nodeType))&&(!f||c(a))&&g.push(a)}),g}function q(a){var b=typeof a.getName=="undefined"?"Range":a.getName();return"["+b+"("+c.inspectNode(a.startContainer)+":"+a.startOffset+", "+c.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function r(a,b){this.range=a,this.clonePartiallySelectedTextNodes=b;if(!a.collapsed){this.sc=a.startContainer,this.so=a.startOffset,this.ec=a.endContainer,this.eo=a.endOffset;var d=a.commonAncestorContainer;this.sc===this.ec&&c.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===d&&!c.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:c.getClosestAncestorIn(this.sc,d,!0),this._last=this.ec===d&&!c.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:c.getClosestAncestorIn(this.ec,d,!0))}}function s(a){this.code=this[a],this.codeName=a,this.message="RangeException: "+this.codeName}function t(a,b,c){this.nodes=p(a,b,c),this._next=this.nodes[0],this._position=0}function z(a){return function(b,d){var e,f=d?b:b.parentNode;while(f){e=f.nodeType;if(c.arrayContains(a,e))return f;f=f.parentNode}return null}}function E(a,b){if(D(a,b))throw new s("INVALID_NODE_TYPE_ERR")}function F(a){if(!a.startContainer)throw new e("INVALID_STATE_ERR")}function G(a,b){if(!c.arrayContains(b,a.nodeType))throw new s("INVALID_NODE_TYPE_ERR")}function H(a,b){if(b<0||b>(c.isCharacterDataNode(a)?a.length:a.childNodes.length))throw new e("INDEX_SIZE_ERR")}function I(a,b){if(B(a,!0)!==B(b,!0))throw new e("WRONG_DOCUMENT_ERR")}function J(a){if(C(a,!0))throw new e("NO_MODIFICATION_ALLOWED_ERR")}function K(a,b){if(!a)throw new e(b)}function L(a){return!c.arrayContains(v,a.nodeType)&&!B(a,!0)}function M(a,b){return b<=(c.isCharacterDataNode(a)?a.length:a.childNodes.length)}function N(a){return!!a.startContainer&&!!a.endContainer&&!L(a.startContainer)&&!L(a.endContainer)&&M(a.startContainer,a.startOffset)&&M(a.endContainer,a.endOffset)}function O(a){F(a);if(!N(a))throw new Error("Range error: Range is no longer valid after DOM mutation ("+a.inspect()+")")}function ab(){}function bb(a){a.START_TO_START=U,a.START_TO_END=V,a.END_TO_END=W,a.END_TO_START=X,a.NODE_BEFORE=Y,a.NODE_AFTER=Z,a.NODE_BEFORE_AND_AFTER=$,a.NODE_INSIDE=_}function cb(a){bb(a),bb(a.prototype)}function db(a,b){return function(){O(this);var d=this.startContainer,e=this.startOffset,f=this.commonAncestorContainer,g=new r(this,!0),h,i;d!==f&&(h=c.getClosestAncestorIn(d,f,!0),i=j(h),d=i.node,e=i.offset),m(g,J),g.reset();var k=a(g);return g.detach(),b(this,d,e,d,e),k}}function eb(b,d,e){function g(a,b){return function(c){F(this),G(c,u),G(A(c),v);var d=(a?i:j)(c);(b?h:k)(this,d.node,d.offset)}}function h(a,b,e){var f=a.endContainer,g=a.endOffset;if(b!==a.startContainer||e!==a.startOffset){if(A(b)!=A(f)||c.comparePoints(b,e,f,g)==1)f=b,g=e;d(a,b,e,f,g)}}function k(a,b,e){var f=a.startContainer,g=a.startOffset;if(b!==a.endContainer||e!==a.endOffset){if(A(b)!=A(f)||c.comparePoints(b,e,f,g)==-1)f=b,g=e;d(a,f,g,b,e)}}function l(a,b,c){(b!==a.startContainer||c!==a.startOffset||b!==a.endContainer||c!==a.endOffset)&&d(a,b,c,b,c)}b.prototype=new ab,a.util.extend(b.prototype,{setStart:function(a,b){F(this),E(a,!0),H(a,b),h(this,a,b)},setEnd:function(a,b){F(this),E(a,!0),H(a,b),k(this,a,b)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(a){O(this),a?d(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):d(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){F(this),E(a,!0),d(this,a,0,a,c.getNodeLength(a))},selectNode:function(a){F(this),E(a,!1),G(a,u);var b=i(a),c=j(a);d(this,b.node,b.offset,c.node,c.offset)},extractContents:db(o,d),deleteContents:db(n,d),canSurroundContents:function(){O(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},detach:function(){e(this)},splitBoundaries:function(){O(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=a===e;c.isCharacterDataNode(e)&&f>0&&f<e.length&&c.splitDataNode(e,f),c.isCharacterDataNode(a)&&b>0&&b<a.length&&(a=c.splitDataNode(a,b),g?(f-=b,e=a):e==a.parentNode&&f>=c.getNodeIndex(a)&&f++,b=0),d(this,a,b,e,f)},normalizeBoundaries:function(){O(this);var a=this.startContainer,b=this.startOffset,e=this.endContainer,f=this.endOffset,g=function(a){var b=a.nextSibling;b&&b.nodeType==a.nodeType&&(e=a,f=a.length,a.appendData(b.data),b.parentNode.removeChild(b))},h=function(d){var g=d.previousSibling;if(g&&g.nodeType==d.nodeType){a=d;var h=d.length;b=g.length,d.insertData(0,g.data),g.parentNode.removeChild(g);if(a==e)f+=b,e=a;else if(e==d.parentNode){var i=c.getNodeIndex(d);f==i?(e=d,f=h):f>i&&f--}}},i=!0;if(c.isCharacterDataNode(e))e.length==f&&g(e);else{if(f>0){var j=e.childNodes[f-1];j&&c.isCharacterDataNode(j)&&g(j)}i=!this.collapsed}if(i){if(c.isCharacterDataNode(a))b==0&&h(a);else if(b<a.childNodes.length){var k=a.childNodes[b];k&&c.isCharacterDataNode(k)&&h(k)}}else a=e,b=f;d(this,a,b,e,f)},collapseToPoint:function(a,b){F(this),E(a,!0),H(a,b),l(this,a,b)}}),cb(b)}function fb(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:c.getCommonAncestor(a.startContainer,a.endContainer)}function gb(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!==c,g=a.endContainer!==d||a.endOffset!==e;a.startContainer=b,a.startOffset=c,a.endContainer=d,a.endOffset=e,fb(a),h(a,"boundarychange",{startMoved:f,endMoved:g})}function hb(a){F(a),a.startContainer=a.startOffset=a.endContainer=a.endOffset=null,a.collapsed=a.commonAncestorContainer=null,h(a,"detach",null),a._listeners=null}function ib(a){this.startContainer=a,this.startOffset=0,this.endContainer=a,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},fb(this)}a.requireModules(["DomUtil"]);var c=a.dom,d=c.DomPosition,e=a.DOMException;r.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;return a&&(this._next=a!==this._last?a.nextSibling:null,c.isCharacterDataNode(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so))),a},remove:function(){var a=this._current,b,d;!c.isCharacterDataNode(a)||a!==this.sc&&a!==this.ec?a.parentNode&&a.parentNode.removeChild(a):(b=a===this.sc?this.so:0,d=a===this.ec?this.eo:a.length,b!=d&&a.deleteData(b,d-b))},isPartiallySelectedSubtree:function(){var a=this._current;return f(a,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse();else{a=new ib(g(this.range));var b=this._current,d=b,e=0,f=b,h=c.getNodeLength(b);c.isAncestorOf(b,this.sc,!0)&&(d=this.sc,e=this.so),c.isAncestorOf(b,this.ec,!0)&&(f=this.ec,h=this.eo),gb(a,d,e,f,h)}return new r(a,this.clonePartiallySelectedTextNodes)},detach:function(a){a&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},s.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},s.prototype.toString=function(){return this.message},t.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var u=[1,3,4,5,7,8,10],v=[2,9,11],w=[5,6,10,12],x=[1,3,4,5,7,8,10,11],y=[1,3,4,5,7,8],A=c.getRootContainer,B=z([9,11]),C=z(w),D=z([6,10,12]),P=document.createElement("style"),Q=!1;try{P.innerHTML="<b>x</b>",Q=P.firstChild.nodeType==3}catch(R){}a.features.htmlParsingConforms=Q;var S=Q?function(a){var b=this.startContainer,d=c.getDocument(b);if(!b)throw new e("INVALID_STATE_ERR");var f=null;return b.nodeType==1?f=b:c.isCharacterDataNode(b)&&(f=c.parentElement(b)),f===null||f.nodeName=="HTML"&&c.isHtmlNamespace(c.getDocument(f).documentElement)&&c.isHtmlNamespace(f)?f=d.createElement("body"):f=f.cloneNode(!1),f.innerHTML=a,c.fragmentFromNodeChildren(f)}:function(a){F(this);var b=g(this),d=b.createElement("body");return d.innerHTML=a,c.fragmentFromNodeChildren(d)},T=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],U=0,V=1,W=2,X=3,Y=0,Z=1,$=2,_=3;ab.prototype={attachListener:function(a,b){this._listeners[a].push(b)},compareBoundaryPoints:function(a,b){O(this),I(this.startContainer,b.startContainer);var d,e,f,g,h=a==X||a==U?"start":"end",i=a==V||a==U?"start":"end";return d=this[h+"Container"],e=this[h+"Offset"],f=b[i+"Container"],g=b[i+"Offset"],c.comparePoints(d,e,f,g)},insertNode:function(a){O(this),G(a,x),J(this.startContainer);if(c.isAncestorOf(a,this.startContainer,!0))throw new e("HIERARCHY_REQUEST_ERR");var b=k(a,this.startContainer,this.startOffset);this.setStartBefore(b)},cloneContents:function(){O(this);var a,b;if(this.collapsed)return g(this).createDocumentFragment();if(this.startContainer===this.endContainer&&c.isCharacterDataNode(this.startContainer))return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),b=g(this).createDocumentFragment(),b.appendChild(a),b;var d=new r(this,!0);return a=l(d),d.detach(),a},canSurroundContents:function(){O(this),J(this.startContainer),J(this.endContainer);var a=new r(this,!0),b=a._first&&f(a._first,this)||a._last&&f(a._last,this);return a.detach(),!b},surroundContents:function(a){G(a,y);if(!this.canSurroundContents())throw new s("BAD_BOUNDARYPOINTS_ERR");var b=this.extractContents();if(a.hasChildNodes())while(a.lastChild)a.removeChild(a.lastChild);k(a,this.startContainer,this.startOffset),a.appendChild(b),this.selectNode(a)},cloneRange:function(){O(this);var a=new ib(g(this)),b=T.length,c;while(b--)c=T[b],a[c]=this[c];return a},toString:function(){O(this);var a=this.startContainer;if(a===this.endContainer&&c.isCharacterDataNode(a))return a.nodeType==3||a.nodeType==4?a.data.slice(this.startOffset,this.endOffset):"";var b=[],d=new r(this,!0);return m(d,function(a){(a.nodeType==3||a.nodeType==4)&&b.push(a.data)}),d.detach(),b.join("")},compareNode:function(a){O(this);var b=a.parentNode,d=c.getNodeIndex(a);if(!b)throw new e("NOT_FOUND_ERR");var f=this.comparePoint(b,d),g=this.comparePoint(b,d+1);return f<0?g>0?$:Y:g>0?Z:_},comparePoint:function(a,b){return O(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)<0?-1:c.comparePoints(a,b,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:S,toHtml:function(){O(this);var a=g(this).createElement("div");return a.appendChild(this.cloneContents()),a.innerHTML},intersectsNode:function(a,b){O(this),K(a,"NOT_FOUND_ERR");if(c.getDocument(a)!==g(this))return!1;var d=a.parentNode,e=c.getNodeIndex(a);K(d,"NOT_FOUND_ERR");var f=c.comparePoints(d,e,this.endContainer,this.endOffset),h=c.comparePoints(d,e+1,this.startContainer,this.startOffset);return b?f<=0&&h>=0:f<0&&h>0},isPointInRange:function(a,b){return O(this),K(a,"HIERARCHY_REQUEST_ERR"),I(a,this.startContainer),c.comparePoints(a,b,this.startContainer,this.startOffset)>=0&&c.comparePoints(a,b,this.endContainer,this.endOffset)<=0},intersectsRange:function(a,b){O(this);if(g(a)!=g(this))throw new e("WRONG_DOCUMENT_ERR");var d=c.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),f=c.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return b?d<=0&&f>=0:d<0&&f>0},intersection:function(a){if(this.intersectsRange(a)){var b=c.comparePoints(this.startContainer,this.startOffset,a.startContainer,a.startOffset),d=c.comparePoints(this.endContainer,this.endOffset,a.endContainer,a.endOffset),e=this.cloneRange();return b==-1&&e.setStart(a.startContainer,a.startOffset),d==1&&e.setEnd(a.endContainer,a.endOffset),e}return null},union:function(
a){if(this.intersectsRange(a,!0)){var b=this.cloneRange();return c.comparePoints(a.startContainer,a.startOffset,this.startContainer,this.startOffset)==-1&&b.setStart(a.startContainer,a.startOffset),c.comparePoints(a.endContainer,a.endOffset,this.endContainer,this.endOffset)==1&&b.setEnd(a.endContainer,a.endOffset),b}throw new s("Ranges do not intersect")},containsNode:function(a,b){return b?this.intersectsNode(a,!1):this.compareNode(a)==_},containsNodeContents:function(a){return this.comparePoint(a,0)>=0&&this.comparePoint(a,c.getNodeLength(a))<=0},containsRange:function(a){return this.intersection(a).equals(a)},containsNodeText:function(a){var b=this.cloneRange();b.selectNode(a);var c=b.getNodes([3]);if(c.length>0){b.setStart(c[0],0);var d=c.pop();b.setEnd(d,d.length);var e=this.containsRange(b);return b.detach(),e}return this.containsNodeContents(a)},createNodeIterator:function(a,b){return O(this),new t(this,a,b)},getNodes:function(a,b){return O(this),p(this,a,b)},getDocument:function(){return g(this)},collapseBefore:function(a){F(this),this.setEndBefore(a),this.collapse(!1)},collapseAfter:function(a){F(this),this.setStartAfter(a),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(a){return ib.rangesEqual(this,a)},isValid:function(){return N(this)},inspect:function(){return q(this)}},eb(ib,gb,hb),a.rangePrototype=ab.prototype,ib.rangeProperties=T,ib.RangeIterator=r,ib.copyComparisonConstants=cb,ib.createPrototypeRange=eb,ib.inspect=q,ib.getRangeDocument=g,ib.rangesEqual=function(a,b){return a.startContainer===b.startContainer&&a.startOffset===b.startOffset&&a.endContainer===b.endContainer&&a.endOffset===b.endOffset},a.DomRange=ib,a.RangeException=s}),rangy.createModule("WrappedRange",function(a,b){function g(a){var b=a.parentElement(),c=a.duplicate();c.collapse(!0);var e=c.parentElement();c=a.duplicate(),c.collapse(!1);var f=c.parentElement(),g=e==f?e:d.getCommonAncestor(e,f);return g==b?g:d.getCommonAncestor(b,g)}function h(a){return a.compareEndPoints("StartToEnd",a)==0}function i(a,b,c,f){var g=a.duplicate();g.collapse(c);var h=g.parentElement();d.isAncestorOf(b,h,!0)||(h=b);if(!h.canHaveHTML)return new e(h.parentNode,d.getNodeIndex(h));var i=d.getDocument(h).createElement("span"),j,k=c?"StartToStart":"StartToEnd",l,m,n,o;do h.insertBefore(i,i.previousSibling),g.moveToElementText(i);while((j=g.compareEndPoints(k,a))>0&&i.previousSibling);o=i.nextSibling;if(j==-1&&o&&d.isCharacterDataNode(o)){g.setEndPoint(c?"EndToStart":"EndToEnd",a);var p;if(/[\r\n]/.test(o.data)){var q=g.duplicate(),r=q.text.replace(/\r\n/g,"\r").length;p=q.moveStart("character",r);while((j=q.compareEndPoints("StartToEnd",q))==-1)p++,q.moveStart("character",1)}else p=g.text.length;n=new e(o,p)}else l=(f||!c)&&i.previousSibling,m=(f||c)&&i.nextSibling,m&&d.isCharacterDataNode(m)?n=new e(m,0):l&&d.isCharacterDataNode(l)?n=new e(l,l.length):n=new e(h,d.getNodeIndex(i));return i.parentNode.removeChild(i),n}function j(a,b){var c,e,f=a.offset,g=d.getDocument(a.node),h,i,j=g.body.createTextRange(),k=d.isCharacterDataNode(a.node);return k?(c=a.node,e=c.parentNode):(i=a.node.childNodes,c=f<i.length?i[f]:null,e=a.node),h=g.createElement("span"),h.innerHTML="&#feff;",c?e.insertBefore(h,c):e.appendChild(h),j.moveToElementText(h),j.collapse(!b),e.removeChild(h),k&&j[b?"moveStart":"moveEnd"]("character",f),j}a.requireModules(["DomUtil","DomRange"]);var c,d=a.dom,e=d.DomPosition,f=a.DomRange;if(a.features.implementsDomRange&&(!a.features.implementsTextRange||!a.config.preferTextRange))(function(){function h(a){var b=e.length,c;while(b--)c=e[b],a[c]=a.nativeRange[c]}function i(a,b,c,d,e){var f=a.startContainer!==b||a.startOffset!=c,g=a.endContainer!==d||a.endOffset!=e;if(f||g)a.setEnd(d,e),a.setStart(b,c)}function j(a){a.nativeRange.detach(),a.detached=!0;var b=e.length,c;while(b--)c=e[b],a[c]=null}var b,e=f.rangeProperties,g,k;c=function(a){if(!a)throw new Error("Range must be specified");this.nativeRange=a,h(this)},f.createPrototypeRange(c,i,j),b=c.prototype,b.selectNode=function(a){this.nativeRange.selectNode(a),h(this)},b.deleteContents=function(){this.nativeRange.deleteContents(),h(this)},b.extractContents=function(){var a=this.nativeRange.extractContents();return h(this),a},b.cloneContents=function(){return this.nativeRange.cloneContents()},b.surroundContents=function(a){this.nativeRange.surroundContents(a),h(this)},b.collapse=function(a){this.nativeRange.collapse(a),h(this)},b.cloneRange=function(){return new c(this.nativeRange.cloneRange())},b.refresh=function(){h(this)},b.toString=function(){return this.nativeRange.toString()};var l=document.createTextNode("test");d.getBody(document).appendChild(l);var m=document.createRange();m.setStart(l,0),m.setEnd(l,0);try{m.setStart(l,1),g=!0,b.setStart=function(a,b){this.nativeRange.setStart(a,b),h(this)},b.setEnd=function(a,b){this.nativeRange.setEnd(a,b),h(this)},k=function(a){return function(b){this.nativeRange[a](b),h(this)}}}catch(n){g=!1,b.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(c){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}h(this)},b.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(c){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,b)}h(this)},k=function(a,b){return function(c){try{this.nativeRange[a](c)}catch(d){this.nativeRange[b](c),this.nativeRange[a](c)}h(this)}}}b.setStartBefore=k("setStartBefore","setEndBefore"),b.setStartAfter=k("setStartAfter","setEndAfter"),b.setEndBefore=k("setEndBefore","setStartBefore"),b.setEndAfter=k("setEndAfter","setStartAfter"),m.selectNodeContents(l),m.startContainer==l&&m.endContainer==l&&m.startOffset==0&&m.endOffset==l.length?b.selectNodeContents=function(a){this.nativeRange.selectNodeContents(a),h(this)}:b.selectNodeContents=function(a){this.setStart(a,0),this.setEnd(a,f.getEndOffset(a))},m.selectNodeContents(l),m.setEnd(l,3);var o=document.createRange();o.selectNodeContents(l),o.setEnd(l,4),o.setStart(l,2),m.compareBoundaryPoints(m.START_TO_END,o)==-1&m.compareBoundaryPoints(m.END_TO_START,o)==1?b.compareBoundaryPoints=function(a,b){return b=b.nativeRange||b,a==b.START_TO_END?a=b.END_TO_START:a==b.END_TO_START&&(a=b.START_TO_END),this.nativeRange.compareBoundaryPoints(a,b)}:b.compareBoundaryPoints=function(a,b){return this.nativeRange.compareBoundaryPoints(a,b.nativeRange||b)},a.util.isHostMethod(m,"createContextualFragment")&&(b.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)}),d.getBody(document).removeChild(l),m.detach(),o.detach()})(),a.createNativeRange=function(a){return a=a||document,a.createRange()};else if(a.features.implementsTextRange){c=function(a){this.textRange=a,this.refresh()},c.prototype=new f(document),c.prototype.refresh=function(){var a,b,c=g(this.textRange);h(this.textRange)?b=a=i(this.textRange,c,!0,!0):(a=i(this.textRange,c,!0,!1),b=i(this.textRange,c,!1,!1)),this.setStart(a.node,a.offset),this.setEnd(b.node,b.offset)},f.copyComparisonConstants(c);var k=function(){return this}();typeof k.Range=="undefined"&&(k.Range=c),a.createNativeRange=function(a){return a=a||document,a.body.createTextRange()}}a.features.implementsTextRange&&(c.rangeToTextRange=function(a){if(a.collapsed){var b=j(new e(a.startContainer,a.startOffset),!0);return b}var c=j(new e(a.startContainer,a.startOffset),!0),f=j(new e(a.endContainer,a.endOffset),!1),g=d.getDocument(a.startContainer).body.createTextRange();return g.setEndPoint("StartToStart",c),g.setEndPoint("EndToEnd",f),g}),c.prototype.getName=function(){return"WrappedRange"},a.WrappedRange=c,a.createRange=function(b){return b=b||document,new c(a.createNativeRange(b))},a.createRangyRange=function(a){return a=a||document,new f(a)},a.createIframeRange=function(b){return a.createRange(d.getIframeDocument(b))},a.createIframeRangyRange=function(b){return a.createRangyRange(d.getIframeDocument(b))},a.addCreateMissingNativeApiListener(function(b){var c=b.document;typeof c.createRange=="undefined"&&(c.createRange=function(){return a.createRange(this)}),c=b=null})}),rangy.createModule("WrappedSelection",function(a,b){function n(a){return(a||window).getSelection()}function o(a){return(a||window).document.selection}function C(a,b,c){var d=c?"end":"start",e=c?"start":"end";a.anchorNode=b[d+"Container"],a.anchorOffset=b[d+"Offset"],a.focusNode=b[e+"Container"],a.focusOffset=b[e+"Offset"]}function D(a){var b=a.nativeSelection;a.anchorNode=b.anchorNode,a.anchorOffset=b.anchorOffset,a.focusNode=b.focusNode,a.focusOffset=b.focusOffset}function E(a){a.anchorNode=a.focusNode=null,a.anchorOffset=a.focusOffset=0,a.rangeCount=0,a.isCollapsed=!0,a._ranges.length=0}function F(b){var c;return b instanceof g?(c=b._selectionNativeRange,c||(c=a.createNativeRange(e.getDocument(b.startContainer)),c.setEnd(b.endContainer,b.endOffset),c.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=c,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof h?c=b.nativeRange:a.features.implementsDomRange&&b instanceof e.getWindow(b.startContainer).Range&&(c=b),c}function G(a){if(!a.length||a[0].nodeType!=1)return!1;for(var b=1,c=a.length;b<c;++b)if(!e.isAncestorOf(a[0],a[b]))return!1;return!0}function H(a){var b=a.getNodes();if(!G(b))throw new Error("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return b[0]}function I(a){return!!a&&typeof a.text!="undefined"}function J(a,b){var c=new h(b);a._ranges=[c],C(a,c,!1),a.rangeCount=1,a.isCollapsed=c.collapsed}function K(b){b._ranges.length=0;if(b.docSelection.type=="None")E(b);else{var c=b.docSelection.createRange();if(I(c))J(b,c);else{b.rangeCount=c.length;var d,f=e.getDocument(c.item(0));for(var g=0;g<b.rangeCount;++g)d=a.createRange(f),d.selectNode(c.item(g)),b._ranges.push(d);b.isCollapsed=b.rangeCount==1&&b._ranges[0].collapsed,C(b,b._ranges[b.rangeCount-1],!1)}}}function L(a,b){var c=a.docSelection.createRange(),d=H(b),f=e.getDocument(c.item(0)),g=e.getBody(f).createControlRange();for(var h=0,i=c.length;h<i;++h)g.add(c.item(h));try{g.add(d)}catch(j){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}g.select(),K(a)}function N(a,b,c){this.nativeSelection=a,this.docSelection=b,this._ranges=[],this.win=c,this.refresh()}function P(a,b){var c=e.getDocument(b[0].startContainer),d=e.getBody(c).createControlRange();for(var f=0,g;f<rangeCount;++f){g=H(b[f]);try{d.add(g)}catch(h){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}d.select(),K(a)}function U(a,b){if(a.anchorNode&&e.getDocument(a.anchorNode)!==e.getDocument(b))throw new i("WRONG_DOCUMENT_ERR")}function V(a){var b=[],c=new j(a.anchorNode,a.anchorOffset),d=new j(a.focusNode,a.focusOffset),e=typeof a.getName=="function"?a.getName():"Selection";if(typeof a.rangeCount!="undefined")for(var f=0,h=a.rangeCount;f<h;++f)b[f]=g.inspect(a.getRangeAt(f));return"["+e+"(Ranges: "+b.join(", ")+")(anchor: "+c.inspect()+", focus: "+d.inspect()+"]"}a.requireModules(["DomUtil","DomRange","WrappedRange"]),a.config.checkSelectionRanges=!0;var c="boolean",d="_rangySelection",e=a.dom,f=a.util,g=a.DomRange,h=a.WrappedRange,i=a.DOMException,j=e.DomPosition,k,l,m="Control",p=a.util.isHostMethod(window,"getSelection"),q=a.util.isHostObject(document,"selection"),r=q&&(!p||a.config.preferTextRange);r?(k=o,a.isSelectionValid=function(a){var b=(a||window).document,c=b.selection;return c.type!="None"||e.getDocument(c.createRange().parentElement())==b}):p?(k=n,a.isSelectionValid=function(){return!0}):b.fail("Neither document.selection or window.getSelection() detected."),a.getNativeSelection=k;var s=k(),t=a.createNativeRange(document),u=e.getBody(document),v=f.areHostObjects(s,["anchorNode","focusNode"]&&f.areHostProperties(s,["anchorOffset","focusOffset"]));a.features.selectionHasAnchorAndFocus=v;var w=f.isHostMethod(s,"extend");a.features.selectionHasExtend=w;var x=typeof s.rangeCount=="number";a.features.selectionHasRangeCount=x;var y=!1,z=!0;f.areHostMethods(s,["addRange","getRangeAt","removeAllRanges"])&&typeof s.rangeCount=="number"&&a.features.implementsDomRange&&function(){var a=document.createElement("iframe");a.frameBorder=0,a.style.position="absolute",a.style.left="-10000px",u.appendChild(a);var b=e.getIframeDocument(a);b.open(),b.write("<html><head></head><body>12</body></html>"),b.close();var c=e.getIframeWindow(a).getSelection(),d=b.documentElement,f=d.lastChild,g=f.firstChild,h=b.createRange();h.setStart(g,1),h.collapse(!0),c.addRange(h),z=c.rangeCount==1,c.removeAllRanges();var i=h.cloneRange();h.setStart(g,0),i.setEnd(g,2),c.addRange(h),c.addRange(i),y=c.rangeCount==2,h.detach(),i.detach(),u.removeChild(a)}(),a.features.selectionSupportsMultipleRanges=y,a.features.collapsedNonEditableSelectionsSupported=z;var A=!1,B;u&&f.isHostMethod(u,"createControlRange")&&(B=u.createControlRange(),f.areHostProperties(B,["item","add"])&&(A=!0)),a.features.implementsControlRange=A,v?l=function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:l=function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var M;f.isHostMethod(s,"getRangeAt")?M=function(a,b){try{return a.getRangeAt(b)}catch(c){return null}}:v&&(M=function(b){var c=e.getDocument(b.anchorNode),d=a.createRange(c);return d.setStart(b.anchorNode,b.anchorOffset),d.setEnd(b.focusNode,b.focusOffset),d.collapsed!==this.isCollapsed&&(d.setStart(b.focusNode,b.focusOffset),d.setEnd(b.anchorNode,b.anchorOffset)),d}),a.getSelection=function(a){a=a||window;var b=a[d],c=k(a),e=q?o(a):null;return b?(b.nativeSelection=c,b.docSelection=e,b.refresh(a)):(b=new N(c,e,a),a[d]=b),b},a.getIframeSelection=function(b){return a.getSelection(e.getIframeWindow(b))};var O=N.prototype;if(!r&&v&&f.areHostMethods(s,["removeAllRanges","addRange"])){O.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),E(this)};var Q=function(b,c){var d=g.getRangeDocument(c),e=a.createRange(d);e.collapseToPoint(c.endContainer,c.endOffset),b.nativeSelection.addRange(F(e)),b.nativeSelection.extend(c.startContainer,c.startOffset),b.refresh()};x?O.addRange=function(b,c){if(A&&q&&this.docSelection.type==m)L(this,b);else if(c&&w)Q(this,b);else{var d;y?d=this.rangeCount:(this.removeAllRanges(),d=0),this.nativeSelection.addRange(F(b)),this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==d+1){if(a.config.checkSelectionRanges){var e=M(this.nativeSelection,this.rangeCount-1);e&&!g.rangesEqual(e,b)&&(b=new h(e))}this._ranges[this.rangeCount-1]=b,C(this,b,T(this.nativeSelection)),this.isCollapsed=l(this)}else this.refresh()}}:O.addRange=function(a,b){b&&w?Q(this,a):(this.nativeSelection.addRange(F(a)),this.refresh())},O.setRanges=function(a){if(A&&a.length>1)P(this,a);else{this.removeAllRanges();for(var b=0,c=a.length;b<c;++b)this.addRange(a[b])}}}else{if(!(f.isHostMethod(s,"empty")&&f.isHostMethod(t,"select")&&A&&r))return b.fail("No means of selecting a Range or TextRange was found"),!1;O.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a;if(this.anchorNode)a=e.getDocument(this.anchorNode);else if(this.docSelection.type==m){var b=this.docSelection.createRange();b.length&&(a=e.getDocument(b.item(0)).body.createTextRange())}if(a){var c=a.body.createTextRange();c.select(),this.docSelection.empty()}}}catch(d){}E(this)},O.addRange=function(a){this.docSelection.type==m?L(this,a):(h.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,C(this,a,!1))},O.setRanges=function(a){this.removeAllRanges();var b=a.length;b>1?P(this,a):b&&this.addRange(a[0])}}O.getRangeAt=function(a){if(a<0||a>=this.rangeCount)throw new i("INDEX_SIZE_ERR");return this._ranges[a]};var R;if(r)R=function(b){var c;a.isSelectionValid(b.win)?c=b.docSelection.createRange():(c=e.getBody(b.win.document).createTextRange(),c.collapse(!0)),b.docSelection.type==m?K(b):I(c)?J(b,c):E(b)};else if(f.isHostMethod(s,"getRangeAt")&&typeof s.rangeCount=="number")R=function(b){if(A&&q&&b.docSelection.type==m)K(b);else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var c=0,d=b.rangeCount;c<d;++c)b._ranges[c]=new a.WrappedRange(b.nativeSelection.getRangeAt(c));C(b,b._ranges[b.rangeCount-1],T(b.nativeSelection)),b.isCollapsed=l(b)}else E(b)}};else{if(!v||typeof s.isCollapsed!=c||typeof t.collapsed!=c||!a.features.implementsDomRange)return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;R=function(a){var b,c=a.nativeSelection;c.anchorNode?(b=M(c,0),a._ranges=[b],a.rangeCount=1,D(a),a.isCollapsed=l(a)):E(a)}}O.refresh=function(a){var b=a?this._ranges.slice(0):null;R(this);if(a){var c=b.length;if(c!=this._ranges.length)return!1;while(c--)if(!g.rangesEqual(b[c],this._ranges[c]))return!1;return!0}};var S=function(a,b){var c=a.getAllRanges(),d=!1;a.removeAllRanges();for(var e=0,f=c.length;e<f;++e)d||b!==c[e]?a.addRange(c[e]):d=!0;a.rangeCount||E(a)};A?O.removeRange=function(a){if(this.docSelection.type==m){var b=this.docSelection.createRange(),c=H(a),d=e.getDocument(b.item(0)),f=e.getBody(d).createControlRange(),g,h=!1;for(var i=0,j=b.length;i<j;++i)g=b.item(i),g!==c||h?f.add(b.item(i)):h=!0;f.select(),K(this)}else S(this,a)}:O.removeRange=function(a){S(this,a)};var T;!r&&v&&a.features.implementsDomRange?(T=function(a){var b=!1;return a.anchorNode&&(b=e.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset)==1),b},O.isBackwards=function(){return T(this)}):T=O.isBackwards=function(){return!1},O.toString=function(){var a=[];for(var b=0,c=this.rangeCount;b<c;++b)a[b]=""+this._ranges[b];return a.join("")},O.collapse=function(b,c){U(this,b);var d=a.createRange(e.getDocument(b));d.collapseToPoint(b,c),this.removeAllRanges(),this.addRange(d),this.isCollapsed=!0},O.collapseToStart=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)},O.collapseToEnd=function(){if(!this.rangeCount)throw new i("INVALID_STATE_ERR");var a=this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)},O.selectAllChildren=function(b){U(this,b);var c=a.createRange(e.getDocument(b));c.selectNodeContents(b),this.removeAllRanges(),this.addRange(c)},O.deleteFromDocument=function(){if(A&&q&&this.docSelection.type==m){var a=this.docSelection.createRange(),b;while(a.length)b=a.item(0),a.remove(b),b.parentNode.removeChild(b);this.refresh()}else if(this.rangeCount){var c=this.getAllRanges();this.removeAllRanges();for(var d=0,e=c.length;d<e;++d)c[d].deleteContents();this.addRange(c[e-1])}},O.getAllRanges=function(){return this._ranges.slice(0)},O.setSingleRange=function(a){this.setRanges([a])},O.containsNode=function(a,b){for(var c=0,d=this._ranges.length;c<d;++c)if(this._ranges[c].containsNode(a,b))return!0;return!1},O.toHtml=function(){var a="";if(this.rangeCount){var b=g.getRangeDocument(this._ranges[0]).createElement("div");for(var c=0,d=this._ranges.length;c<d;++c)b.appendChild(this._ranges[c].cloneContents());a=b.innerHTML}return a},O.getName=function(){return"WrappedSelection"},O.inspect=function(){return V(this)},O.detach=function(){this.win[d]=null,this.win=this.anchorNode=this.focusNode=null},N.inspect=V,a.Selection=N,a.selectionPrototype=O,a.addCreateMissingNativeApiListener(function(b){typeof b.getSelection=="undefined"&&(b.getSelection=function(){return a.getSelection(this)}),b=null})})},{})}),require.whenReady("settings",function(){require.install("qtext2/undo",function(require,a,b){var c=require("Class").Class,d=c.extend({__init__:function(a){this.current={state:a,next:null,prev:null}},state:function(){return this.current.state},add:function(a){this.current.next&&(this.current.next.prev=null),this.current.next={state:a,prev:this.current,next:null},this.current=this.current.next},undo:function(){this.current.prev&&(this.current=this.current.prev)},redo:function(){this.current.next&&(this.current=this.current.next)},canUndo:function(){return!!this.current.prev},canRedo:function(){return!!this.current.next}});a.UndoManager=d},{Class:!0})}),require.whenReady("settings",function(){require.install("qtext2/parser",function(require,a,b){var c=require("Class").Class,d=require("log").log,e=require("qtext2/base"),f=require("qtext2/util").Util,g=e.Span,h=e.UnorderedListSection,i=e.OrderedListSection,j=e.PlainSection,k=e.CodeSection,l=e.ImageSection,m=e.VideoSection,n=e.CONTENT_TYPES,o=function(a){return["B","I","U","A","EM"].indexOf(a)!=-1},p=function(a){return["OL","UL"].indexOf(a)!=-1},q=function(a){return["H1","H2","H3","H4","H5"].indexOf(a)!=-1},r=function(a){return a=="BLOCKQUOTE"},s=function(a){return a=="META"},t=function(a){return a.replace(/( |\r\n|\n|\r|\u00a0)+/gm," ")},u=c.extend({__init__:function(a){this.spans=[],this.modifiers=f.extend(a,{}),this.indent=0,this.content=""},visit:function(a){this._enter(a),this._exit(a)},_visitChildren:function(a){for(var b=a.firstChild;b!==null;b=b.nextSibling)this.visit(b)},_enter:function(a){if(f.isTextNode(a)){this.content+=a.textContent;return}this._getModifier(a)&&(this.modifiers[this._getModifier(a)]=this._getModifierValue(a)),this._visitChildren(a)},_exit:function(a){f.isTextNode(a)?this._createSpan():this._getModifier(a)&&delete this.modifiers[this._getModifier(a)]},_createSpan:function(){var a=this.content;if(a.match(/^\n+$/g)||!a.length)return;a=t(a),this.spans.push(new g(a,this.modifiers)),this.content=""},_getModifier:function(a){return{B:"bold",I:"italic",EM:"italic",U:"underline",A:"link"}[a.nodeName]},_getModifierValue:function(a){return{B:!0,I:!0,EM:!0,U:!0,A:{type:"url",url:a.href}}[a.nodeName]}}),v=function(a,b){var c=new u(b);return c.visit(a),c.spans},w=function(a,b){var c,d=a.nodeName=="OL"?i:h,e=[],g;b=b||0,f.assert(p(a.nodeName),"Unknown list type",a);for(var j=a.firstElementChild;j;j=j.nextElementSibling)c=j.nodeName,c=="LI"?(g=new d(v(j,{})),g.setIndent(b),e.push(g)):p(c)&&(e=e.concat(w(j,b+1)));return e},x=function(a,b){var c,e=[],g=[],h;b=b||{};var i=function(){e.length&&(g.push(new j(e)),e=[])};for(var m=a.firstChild;m;m=m.nextSibling)c=m.nodeName,c=="SPAN"||f.isTextNode(m)||o(c)?e=e.concat(v(m,b)):c=="CODE"?e=e.concat(v(m,f.extend(b,{code:!0}))):(i(),c=="P"||c=="DIV"?g=g.concat(x(m)):p(c)?g=g.concat(w(m)):q(c)?g=g.concat(x(m,f.extend(b,{bold:!0}))):r(c)?(h=x(m),h.forEach(function(a){a.setQuoted(!0)}),g=g.concat(h)):c=="PRE"?g.push(new k(v(m,b))):c=="IMG"?g.push(l.fromURL(m.src)):s(c)||d.warn("qtext2","Cannot create section from ",m));return i(),g},y=function(a){var b=document.createElement("DIV"),c;return b.innerHTML=a,c=x(b),d.log("qtext2",b),c},z=function(a){var b=[];return a.length===0?[]:(f.splitLines(a).forEach(function(a){f.splitByRegex(a,m.YOUTUBE_URL_RE).forEach(function(a){a.match?b.push(m.fromURL(a.text)):b.push(new j([new g(a.text)]))})}),b)},A=function(a,b){return b==n.HTML?y(a):b==n.TEXT?z(a):[]};a.parseHTML=y,a.parseText=z,a.parse=A},{"qtext2/util":!0,Class:!0,"qtext2/base":!0,log:!0})}),require.whenReady("settings",function(){require.install("qtext2/base",function(require,a,b){require("third_party/rangy-core");var c=window.rangy,d=require("browser").browser,e=require("linkify"),f=require("log").log,g=require("Class").Class,h=require("qtext2/util").Util,i=require("qtext2/undo").UndoManager,j=require("interface/settings").pageIsMobile,k=require("window_manager");f=f.bind(f,"qtext2");var l={BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,END:35,HOME:36,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,DELETE:46,AT:50,7:55,8:56,9:57,A:65,B:66,I:73,K:75,L:76,U:85,Z:90,COMMA:188,PERIOD:190,BACKTICK:192,RSQ:221,APOSTROPHE:222,isNavigation:function(a){return a==l.LEFT_ARROW||a==l.RIGHT_ARROW||a==l.UP_ARROW||a==l.DOWN_ARROW||a==l.HOME||a==l.END}},m=["bold","italic","underline","code","math"],n={TEXT:"text/plain",HTML:"text/html"},o={},p=g.extend({__init__:function(a,b){this.span=a,this.offset=b},toJSON:function(){var a=this.span.parent;return{spanIdx:a.children.indexOf(this.span),sectionIdx:a.parent.children.indexOf(a),offset:this.offset}},clone:function(){return new p(this.span,this.offset)},atSpanStart:function(){return this.offset===0},atSpanEnd:function(){return this.offset==this.span.getLength()},atSectionStart:function(){var a=this.span.parent;return this.atSpanStart()&&this.span==a.firstChild()},atSectionEnd:function(){var a=this.span.parent;return this.atSpanEnd()&&this.span==a.lastChild()},atDocStart:function(){var a=this.span.parent,b=a.parent;return this.atSectionStart()&&a==b.firstChild()},atDocEnd:function(){var a=this.span.parent,b=a.parent;return this.atSectionEnd()&&a==b.lastChild()},equals:function(a){return a.span===this.span&&a.offset===this.offset}}),q=g.extend({__init__:function(a,b){this.start=a,this.end=b},toJSON:function(){return{start:this.start.toJSON(),end:this.end.toJSON()}},getStartNode:function(){return this.start.span.getFocusNode()},getEndNode:function(){return this.end.span.getFocusNode()},moveStart:function(a){this.start.span=a.span,this.start.offset=a.offset,this._apply()},moveEnd:function(a){this.end.span=a.span,this.end.offset=a.offset,this._apply()},move:function(a,b,c){b=b||a,this.start.span=a.span,this.start.offset=a.offset,this.end.span=b.span,this.end.offset=b.offset,this._apply(c)},isCollapsed:function(){return this.start.span==this.end.span&&this.start.offset==this.end.offset},update:function(a){var b=c.getSelection(),d,e,f;if(!b.anchorNode)return;b.isCollapsed?d=e=this._fromNode(b.anchorNode,b.anchorOffset):(f=b.getRangeAt(0),d=this._fromNode(f.startContainer,f.startOffset),e=this._fromNode(f.endContainer,f.endOffset)),d&&e&&this.move(d,e,a)},_fromNode:function(a,b){var c,d,e,f;if(t.is(a))f=t.get(a),b===0?(d=f.firstChild().firstChild(),e=0):(d=f.lastChild().lastChild(),e=d.getLength());else if(u.is(a))c=u.get(a),b===0?(d=c.firstChild(),e=0):(d=c.lastChild(),e=d.getLength());else{while(a&&!C.is(a))a=a.parentNode;if(!a)return null;d=C.get(a),e=b}return new p(d,e)},_apply:function(a){var b=c.getSelection(),d=this.getStartNode(),e,f;if(this.isCollapsed()){if(!a&&b.isCollapsed&&d==b.anchorNode&&this.start.offset==b.anchorOffset)return;f=c.createRange(),f.setStart(d,this.start.offset),f.setEnd(d,this.start.offset),f.collapse(!0),b.setSingleRange(f)}else{f=b.getRangeAt(0),e=this.end.span.getFocusNode();if(!a&&!b.isCollapsed&&d==f.startContainer&&this.start.offset==f.startOffset&&e==f.endContainer&&this.end.offset==f.endOffset)return;f.setStart(d,this.start.offset),f.setEnd(e,this.end.offset),b.setSingleRange(f)}},scrollIntoViewIfNeeded:function(){if(!j)return;var a=window.getSelection().getRangeAt(0).getClientRects(),b=document.body,c=b.parentElement,d=b.scrollTop||c.scrollTop,e=d+window.innerHeight,f,g,h=30;a.length===0?f=this.start.span.parent.node.offsetTop:f=d+a[0].top,g=f+h,f<d?(b.scrollTop+=f-d,c.scrollTop+=f-d):g>e&&(b.scrollTop+=g-e,c.scrollTop+=g-e)}}),r=g.extend({__init__:function(a,b){this.update(a,b)},update:function(a){this.position=a.start.clone(),this.modifiers=h.extend({},a.start.span.modifiers)},toggleModifier:function(a,b){b in this.modifiers?delete this.modifiers[b]:this.modifiers[b]=!0,this.position=a.start.clone()},hasModifier:function(a){return a in this.modifiers},hasChanged:function(a){return!h.jsonEqual(this.modifiers,a.start.span.modifiers)},apply:function(a){var b;for(b in this.modifiers)a.setModifier(b);for(b in a.modifiers)this.hasModifier(b)||a.removeModifier(b)}}),s=g.extend({__init__:function(a){this.kind=a,this.node=h.create("DIV"),this.node.className=this.kind,this.children=[]},init:function(){},insertBefore:function(a,b){a.parent&&a.parent.removeChild(a),b?(this.node.insertBefore(a.node,b.node),this.children.splice(this.children.indexOf(b),0,a)):(this.node.appendChild(a.node),this.children.push(a)),a.parent=this},appendChild:function(a){this.insertBefore(a)},removeChild:function(a){var b=this.children.indexOf(a);this.children.splice(b,1),this.node.removeChild(a.node)},removeChildren:function(){var a=this.firstChild(),b;while(a)b=a.nextSibling(),this.removeChild(a),a=b},previousSibling:function(){return this.node.previousSibling&&this.Class.get(this.node.previousSibling)},nextSibling:function(){return this.node.nextSibling&&this.Class.get(this.node.nextSibling)},firstChild:function(){return this.children.length===0?null:this.children[0]},lastChild:function(){return this.children.length===0?null:this.children[this.children.length-1]}});s.create=function(a,b){var c;return h.assert(!b.__init__,"Do not override __init__"),b.__init__=function(){this._super(a),this.init.apply(this,arguments),this.Class=c,c.add(this,this.node)},c=s.extend(b),c.add=function(a,b){h.setData(b,"kind",a.kind),b.qtextContainer=a},c.get=function(a){return h.assert(c.is(a)),a.qtextContainer},c.is=function(b){return b.nodeType==1&&h.getData(b,"kind")==a},c};var t=s.create("doc",{init:function(a){this.node.setAttribute("contenteditable","true"),this._attachEventListeners(),a||(a=[new v]),a.forEach(this.appendChild.bind(this)),c.init();var b=this.firstChild().firstChild();this.caret=new q(b.first(),b.first()),this.formattingState=new r(this.caret),this.undoManager=new i(this.toJSON()),this.linkSelector=null,this._listeners={}},isEmpty:function(){return this.children.length==1&&this.children[0].isEmpty()},toJSON:function(){var a={sections:[],caret:this.caret.toJSON()};return this.children.forEach(function(b){a.sections.push(b.toJSON())}),a},fromJSON:function(a){var b,c,d=this;this.removeChildren(),a.sections&&a.sections.length?a.sections.forEach(function(a){d.appendChild(u.fromJSON(a))}):this.appendChild(new v),a.caret?(b=a.caret.start,c=a.caret.end,this.caret.move(new p(this.children[b.sectionIdx].children[b.spanIdx],b.offset),new p(this.children[c.sectionIdx].children[c.spanIdx],c.offset))):this.caret.move(this.lastChild().last())},hasChanged:function(a){var b=this.toJSON();return!h.jsonEqual(b.sections,a.sections)},_handleEmptySpan:function(a,b){var c,d,e;return a.parent.firstChild()==a&&a.parent.children.length==1?(a.setPlaceholder(),a.first()):(d=a.previousSibling(),e=a.nextSibling(),a.parent.removeChild(a),b?d?(a=d,c=d.getLength()):(a=e,c=0):e?(a=e,c=0):(a=d,c=d.getLength()),new p(a,c))},_attachEventListeners:function(){var a=this,b=function(b,c){f(b,c.which,c,a.caret)};h.on("keydown",this.node,function(c){var d=!0;a.caret.update(),b("before keydown",c);if(c.which==l.BACKSPACE)a.saveState(),d=a.handleBackspace(),a.caret.scrollIntoViewIfNeeded();else if(c.which==l.DELETE)a.saveState(),d=a.handleDelete();else if(c.which==l.RETURN&&!c.metaKey&&!c.ctrlKey)a.saveState(),d=a.handleReturn(),a.caret.scrollIntoViewIfNeeded();else if(c.which==l.SPACE)a.saveState(),d=a.detectLinks();else if(c.which==l.COMMA||c.which==l.PERIOD)a.saveState();else if(c.which==l.TAB&&!c.shiftKey)a.handleCommand("indent"),d=!1;else if(c.which==l.TAB&&c.shiftKey)a.handleCommand("deindent"),d=!1;else if(c.which==l.B&&(c.metaKey||c.ctrlKey))a.handleCommand("bold"),d=!1;else if(c.which==l.I&&(c.metaKey||c.ctrlKey))a.handleCommand("italic"),d=!1;else if(c.which==l.U&&(c.metaKey||c.ctrlKey))a.handleCommand("underline"),d=!1;else if(c.which==l.K&&!c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("link"),d=!1;else if(c.which==l["7"]&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("ordered_list"),d=!1;else if(c.which==l["8"]&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("unordered_list"),d=!1;else if(c.which==l["9"]&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("quote"),d=!1;else if(c.which==l.K&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("code"),d=!1;else if(c.which==l.L&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("math"),d=!1;else if(c.which==l.Z&&!c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("undo"),d=!1;else if(c.which==l.Z&&c.shiftKey&&(c.metaKey||c.ctrlKey))a.handleCommand("redo"),d=!1;else if(c.which==l.AT&&c.shiftKey)d=a.handleCommand("mention");else if(c.which==l.LEFT_ARROW||c.which==l.UP_ARROW||c.which==l.HOME)d=!a.caret.start.atDocStart();else if(c.which==l.RIGHT_ARROW||c.which==l.DOWN_ARROW||c.which==l.END)d=!a.caret.end.atDocEnd();return b("after keydown",c),a._trigger("keydown"),d}),h.on("keypress",this.node,function(c){b("keypress",c),!a.caret.isCollapsed()&&c.which!==0&&!c.ctrlKey&&!c.metaKey&&!c.altKey&&a._deleteSelection()}),h.on("keyup",this.node,function(c){return b("keyup",c),a.caret.update(),l.isNavigation(c.which)?a._updateFormattingState():a.formattingState.hasChanged(a.caret)&&a._applyFormattingChange(),!1}),h.on("mousedown",this.node,function(c){a.caret.update(),b("mousedown",c)}),h.on("mousemove",this.node,function(){a.caret.update()}),h.on("mouseup",this.node,function(c){b("mouseup",c),a.caret.update(),a._updateFormattingState
()}),h.on("compositionstart",this.node,function(a){b("compositionstart",a)}),h.on("compositionupdate",this.node,function(a){b("compositionupdate",a)}),h.on("compositionend",this.node,function(a){b("compositionend",a)}),h.on("focus",this.node,this._trigger.bind(this,"focus")),h.on("blur",this.node,this._trigger.bind(this,"blur")),h.on("copy",this.node,function(c){b("copy",c),c.clipboardData.setData(n.TEXT,a.convertSelectionToContent(n.TEXT)),c.clipboardData.setData(n.HTML,a.convertSelectionToContent(n.HTML)),c.preventDefault(),c.stopPropagation()}),h.on("cut",this.node,function(c){b("cut",c),c.clipboardData.setData(n.TEXT,a.convertSelectionToContent(n.TEXT)),c.clipboardData.setData(n.HTML,a.convertSelectionToContent(n.HTML)),a._deleteSelection(),c.preventDefault(),c.stopPropagation()}),h.on("paste",this.node,function(c){b("paste",c);if(!c.clipboardData||!c.clipboardData.types||!c.clipboardData.types.indexOf||!c.clipboardData.getData)return;var d=[n.HTML,n.TEXT],e;return d.some(function(b){if(c.clipboardData.types.indexOf(b)>=0)return e=c.clipboardData.getData(b),f("paste",b,e),a.handlePaste(e,b),a.saveState(),!0}),!1});if(d.mobile||d.ipad){var c=function(){a.caret.update(),window.requestAnimationFrame(c)};window.requestAnimationFrame(c)}},on:function(a,b){this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b)},_trigger:function(a){this._listeners[a]&&this._listeners[a].forEach(function(a){a()})},_updateFormattingState:function(){this.formattingState.update(this.caret)},_applyFormattingChange:function(){var a=this.caret.start.span,b=this.formattingState.position.offset,c=this.caret.start.offset;a===this.formattingState.position.span?c>b?(c<a.getLength()&&a.split(c),b>0&&(a=a.split(b)),this.formattingState.apply(a),this.caret.move(a.last()),this._updateFormattingState()):c<b&&this._updateFormattingState():this._updateFormattingState()},getToolbarState:function(a){var b=this.formattingState,c=this.caret.start.span,d=c.parent,e=this.caret.isCollapsed(),f=b.hasModifier("bold"),g=b.hasModifier("italic"),h=b.hasModifier("link"),i=b.hasModifier("code")||d instanceof y,j=b.hasModifier("math")||d instanceof z,k=d instanceof x,l=d instanceof w,m=k||l,n=h||i||j,o=!this.undoManager.canUndo(),p=!this.undoManager.canRedo();if(a===0)return[{name:"link_input",focused:!0},{name:"cite"},{name:"space"},{name:"link_save"}];if(a===1)return[{name:"bold",pressed:f,disabled:n},{name:"italic",pressed:g,disabled:n},{name:"ordered_list",pressed:k},{name:"unordered_list",pressed:l},{name:"quote",pressed:d.isQuoted()},{name:"link",pressed:h,disabled:e},{name:"image"},{name:"space"},{name:"overflow_show"}];if(a===2)return[{name:"undo",disabled:o},{name:"redo",disabled:p},{name:"deindent",disabled:!m},{name:"indent",disabled:!m},{name:"mention",disabled:h||i||j},{name:"code",pressed:i},{name:"math",pressed:j},{name:"space"},{name:"overflow_hide"}]},handleCommand:function(a){var b=this;switch(a){case"bold":return b.saveState(),b.toggleModifier("bold");case"italic":return b.saveState(),b.toggleModifier("italic");case"underline":return;case"ordered_list":return b.saveState(),b.toggleSectionType(x);case"unordered_list":return b.saveState(),b.toggleSectionType(w);case"quote":return b.saveState(),b.toggleQuotes();case"link":return b.saveState(),b.toggleExternalLink(!1);case"cite":return b.saveState(),b.toggleExternalLink(!0);case"mention":return b.showInternalLinkSelector();case"code":return b.saveState(),b.toggleCode();case"math":return b.saveState(),b.toggleMath();case"indent":return b.saveState(),b.indentSections();case"deindent":return b.saveState(),b.deindentSections();case"undo":return b.handleUndo();case"redo":return b.handleRedo()}},handleBackspace:function(){var a,b;return this.caret.isCollapsed()?(b=this.caret.start.clone(),b.atDocStart()?!1:b.atSectionStart()?(a=b.span.parent,a.getIndent()>0?a.setIndent(a.getIndent()-1):this.caret.move(a.previousSibling().merge(a)),!1):(b.atSpanStart()&&(b.span=b.span.previous(),b.offset=b.span.getLength()),b.span.deleteText(b.offset-1,b.offset),b.span.isEmpty()?(b=this._handleEmptySpan(b.span,!0),this.caret.move(b,b,!0)):(b.offset--,this.caret.move(b)),!1)):(this._deleteSelection(!0),!1)},handleDelete:function(){var a,b;return this.caret.isCollapsed()?(b=this.caret.start.clone(),b.atDocEnd()?!1:b.atSectionEnd()?(a=b.span.parent,this.caret.move(a.merge(a.nextSibling())),!1):(b.atSpanEnd()&&(b.span=b.span.next(),b.offset=0),b.span.deleteText(b.offset,b.offset+1),b.span.isEmpty()?this.caret.move(this._handleEmptySpan(b.span,!0)):this.caret.move(b),!1)):(this._deleteSelection(!1),!1)},handleReturn:function(){var a,b;return this.caret.isCollapsed()||this._deleteSelection(!1),a=this.caret.start.span.parent,b=this.caret.start.clone(),a.isEmpty()?(a.getIndent()>0?a.setIndent(a.getIndent()-1):a instanceof v?a.isQuoted()&&a.setQuoted(!1):a=a.changeType(v),b=a.first(),this.caret.move(b),!1):(this.caret.move(this.caret.start.span.parent.split(this.caret.start)),!1)},_deleteSelection:function(a){var b=this.caret.start,c=this.caret.end,d=b.span.parent,e=c.span.parent,f;if(d==e)d.deleteText(b,c);else{d.deleteText(b,d.last());while(d.nextSibling()!=e)d.parent.removeChild(d.nextSibling());e.deleteText(e.first(),c),b=d.merge(e)}b.span.isEmpty()?f=this._handleEmptySpan(b.span,a):f=b,this.caret.move(f,f,!0)},_getSelectedSpans:function(a){var b=[],c=this.caret.start,d=this.caret.end;if(this.caret.isCollapsed())return[];if(c.span==d.span)d.offset<d.span.getLength()&&d.span.split(d.offset,a),c.offset>0&&(d.span=c.span=c.span.split(c.offset,a)),b=[c.span];else{c.offset>0&&(c.offset==c.span.getLength()?c.span=c.span.next():c.span=c.span.split(c.offset,a)),d.offset<d.span.getLength()&&(d.offset===0?d.span=d.span.previous():d.span.split(d.offset,a));for(var e=c.span;e!=d.span;e=e.next())b.push(e);b.push(d.span)}return this.caret.move(c.span.first(),d.span.last()),b},toggleModifier:function(a){var b,c;this.formattingState.toggleModifier(this.caret,a);if(this.caret.isCollapsed())return;b=this._getSelectedSpans(!1),c=b[0].getModifier(a),b.forEach(function(b){c?b.removeModifier(a):b.setModifier(a,!0)})},_toggleMathOrCodeModifier:function(a){var b=this._getSelectedSpans(!0),c=b[0].getModifier(a);c?b.forEach(function(b){b.removeModifier(a)}):(b=this._mergeSpansBySection(b),b.forEach(function(b){b.removeModifier("math"),b.removeModifier("code"),b.setModifier(a,!0)}),this.caret.move(b[0].first(),b[b.length-1].last()))},_getSelectedSections:function(){var a=[],b=this.caret.start,c=this.caret.end,d;if(this.caret.isCollapsed())a.push(b.span.parent);else{for(d=b.span.parent;d!=c.span.parent;d=d.nextSibling())a.push(d);a.push(c.span.parent)}return a},toggleSectionType:function(a){var b=this._getSelectedSections(),c=b[0]instanceof a,d=this.caret.start.clone(),e=this.caret.end.clone();b.forEach(function(b){c?b.changeType(v):b.changeType(a)}),this.caret.move(d,e)},indentSections:function(){var a=this._getSelectedSections();a.forEach(function(a){a.setIndent(a.getIndent()+1)})},deindentSections:function(){var a=this._getSelectedSections();a.forEach(function(a){a.setIndent(a.getIndent()-1)})},toggleQuotes:function(){var a=this._getSelectedSections(),b=a[0].isQuoted();a.forEach(function(a){a.setQuoted(!b)})},toggleCode:function(){this.caret.isCollapsed()?this.toggleSectionType(y):this._toggleMathOrCodeModifier("code")},toggleMath:function(){this.caret.isCollapsed()?this.toggleSectionType(z):this._toggleMathOrCodeModifier("math")},convertSelectionToContent:function(a){var b=this._getSelectedSpans(!1),c=this._getSelectedSections(),d=c[0],e=d.getContentPrefix(a,c);return b.forEach(function(b){d!=b.parent&&(e+=d.getContentSuffix(a,c),d=b.parent,e+=d.getContentPrefix(a,c)),e+=b.toContent(a)}),e+=d.getContentSuffix(a,c),f(a,e),e},handlePaste:function(a,b){var c=this,d,e,f,g,h,i,j;j=require("qtext2/parser").parse(a,b);if(j.length===0)return;c.caret.isCollapsed()||c._deleteSelection(!0),d=c.caret.start,f=d.span.parent,f.split(d),g=f.nextSibling(),j.forEach(function(a){c.insertBefore(a,g)}),h=f.nextSibling(),(h.constructor==f.constructor||h instanceof v)&&f.merge(h),i=g.previousSibling(),i.isEditable()&&(i.constructor==g.constructor||g instanceof v)?(e=i.last(),i.merge(g)):e=g.first(),this.caret.move(e)},saveState:function(){this.undoManager.add(this.toJSON()),this._trigger("meaningfulChange")},handleUndo:function(){this.undoManager.canRedo()||this.saveState(),this.undoManager.undo(),this.fromJSON(this.undoManager.state())},handleRedo:function(){this.undoManager.redo(),this.fromJSON(this.undoManager.state())},_shouldAllowLinks:function(){var a=this.caret.start.span,b=a.parent;return this.caret.isCollapsed()?a.hasModifier("link")?!1:b instanceof y||a.hasModifier("code")?!1:b instanceof z||a.hasModifier("math")?!1:!0:!1},setLinkSelector:function(a){var b=this;b.linkSelector=a,a.onSubmit(function(c){var d=b.caret.start.span,e=new C(" ",d.modifiers);d.setText(c.text),d.setModifier("link",c.target||{type:"url",url:c.url}),d.parent.insertBefore(e,d.nextSibling()),a.hide(),b.caret.move(e.last()),b.saveState()}),a.onCancel(function(c){var d=b.caret.start.span;d.setText(c),a.hide(),b.caret.move(d.last())})},showInternalLinkSelector:function(){if(!this._shouldAllowLinks())return!0;var a=this.caret.start,b=a.span,c=b.parent,d,e;return c.isEmpty()?(d=b,d.setText("@")):(d=new C("@",b.modifiers),a.atSpanStart()?c.insertBefore(d,b):a.atSpanEnd()?c.insertBefore(d,b.nextSibling()):(b=b.split(a.offset),c.insertBefore(d,b))),this.caret.move(d.last()),j?this.linkSelector.show():(e=$(d.node).offset(),this.linkSelector.show(e.left+$(d.node).width(),e.top)),!1},detectLinks:function(){if(!this._shouldAllowLinks())return!0;var a=this.caret.start.span,b=this.caret.start.offset,c=a.parent,d=a.getText(),f,g=[],h;return e.linkify(d.slice(0,b),{callback:function(b,c){b.length>0&&(f=new C(b,a.modifiers),c&&(f.setModifier("link",{type:"url",url:c}),h=f),g.push(f))}}),h?(g.forEach(function(b){c.insertBefore(b,a)}),b<a.getLength()?(a.setText(d.slice(b)),this.caret.move(a.first()),!0):(a.setText(" "),this.caret.move(a.last()),!1)):!0},toggleExternalLink:function(){var a=this,b;if(this.caret.isCollapsed())return;b=this._getSelectedSpans(!0),b[0].hasModifier("link")||b[0].hasModifier("citation")?b.forEach(function(a){a.removeModifier("link"),a.removeModifier("citation")}):this.linkSelector.getExternalURL(function(c,d){var e,f,g=d?"citation":"link";c&&(c=h.ensureProtocol(c),b=a._mergeSpansBySection(b),b.forEach(function(a){a.setModifier(g,{type:"url",url:c})})),e=window.scrollX,f=window.scrollY,a.node.focus(),window.scrollTo(e,f),a.caret.move(b[0].first(),b[b.length-1].last())})},_mergeSpansBySection:function(a){var b=null,c=null,d=[];return a.forEach(function(a){a.parent!=c?(b=a,c=a.parent,d.push(a)):(b.setText(b.getText()+a.getText()),a.parent.removeChild(a))}),d},insertImages:function(a){if(a.length===0)return;var b=this,c=this.caret.start,d=c.span.parent,e;c.atSectionStart()?e=d:(c.atSectionEnd()||d.split(c),e=d.nextSibling()),a.forEach(function(a){b.insertBefore(A.fromURL(a),e)}),e?this.caret.move(e.first()):this.caret.move(d.last())}}),u=s.create("section",{init:function(a,b,c,d){var e=this;b=b||[new C],b.slice().forEach(function(a){e.appendChild(a)}),h.setData(this.node,"type",a),this.setIndent(c||0),this.setQuoted(d)},getType:function(){return h.getData(this.node,"type")},getIndent:function(){return parseInt(h.getData(this.node,"indent"))},setIndent:function(a){return a=Math.min(this.maxIndent,Math.max(0,a)),h.setData(this.node,"indent",a)},setQuoted:function(a){a?h.setData(this.node,"quoted","true"):h.removeData(this.node,"quoted")},isQuoted:function(){return!!h.getData(this.node,"quoted")},setEditable:function(a){a?this.node.removeAttribute("contenteditable"):this.node.setAttribute("contenteditable","false")},isEditable:function(){return this.node.isContentEditable},toJSON:function(){var a={type:this.getType(),indent:this.getIndent(),quoted:this.isQuoted(),spans:[]};return this.children.forEach(function(b){a.spans.push(b.toJSON())}),a},first:function(){return this.firstChild().first()},last:function(){return this.lastChild().last()},deleteText:function(a,b){if(a.span==b.span)a.span.deleteText(a.offset,b.offset);else{a.span.deleteText(a.offset,a.span.getLength());while(a.span.nextSibling()!=b.span)this.removeChild(a.span.nextSibling());b.span&&(b.span.deleteText(0,b.offset),b.span.isEmpty()&&this.removeChild(b.span)),a.span.isEmpty()&&(this.children.length==1?a.span.setPlaceholder():this.removeChild(a.span))}},isEmpty:function(){return this.children.length==1&&this.children[0].isEmpty()},_createSplitSection:function(){return new this.constructor([],this.getIndent(),this.isQuoted())},split:function(a){var b,c=this._createSplitSection(),d,e,f=a.span,g=a.offset;return g===0?(f==this.firstChild()&&this.insertBefore(new C,f),e=f):g===f.getLength()&&f!=this.lastChild()?e=f.nextSibling():e=f.split(g,!0),b=this.children.indexOf(e)+1,d=this.children.slice(b),d.unshift(e),d.forEach(function(a){c.appendChild(a)}),this.parent.insertBefore(c,this.nextSibling()),e.first()},merge:function(a){var b;if(!this.isEditable())this.parent.removeChild(this),b=a.first();else if(a.isEmpty()||!a.isEditable())a.parent.removeChild(a),b=this.last();else{this.isEmpty()?(this.removeChild(this.firstChild()),this.setIndent(a.getIndent()),this.setQuoted(a.isQuoted()),b=a.first()):b=this.last();while(a.children.length)this.appendChild(a.firstChild());a.parent.removeChild(a)}return b},changeType:function(a){var b=new a(this.children,this.getIndent(),this.isQuoted());return this.parent.insertBefore(b,this),this.parent.removeChild(this),b},getContentPrefix:function(a,b){if(a==n.TEXT)return this._getTextPrefix(b);if(a==n.HTML)return this._getHTMLPrefix(b)},getContentSuffix:function(a,b){if(a==n.TEXT)return this._getTextSuffix(b);if(a==n.HTML)return this._getHTMLSuffix(b)},_getTextPrefix:function(){var a,b="";for(a=0;a<this.getIndent()*4;a++)b+=" ";return this.isQuoted()&&(b+=">"),b},_getTextSuffix:function(){return"\n"},_getHTMLPrefix:function(a){var b="",c=a.indexOf(this),d=this.getIndent(),e=-1,f;c>0?(f=a[c-1],f instanceof this.constructor&&(e=f.getIndent()),this.isQuoted()&&!f.isQuoted()&&(b+="<blockquote>")):this.isQuoted()&&(b+="<blockquote>");while(d>e)b+=this.htmlIndentPrefix,d--;return b+this.htmlPrefix},_getHTMLSuffix:function(a){var b=this.htmlSuffix,c=a.indexOf(this),d=this.getIndent(),e=-1,f;c<a.length-1&&(f=a[c+1],f instanceof this.constructor&&(e=f.getIndent()));while(d>e)d--,b+=this.htmlIndentSuffix;return this.isQuoted()&&(!f||!f.isQuoted())&&(b+="</blockquote>"),b},maxIndent:0});u.fromJSON=function(a){var b=[],c=o[a.type];return a.spans.forEach(function(a){b.push(new C(a.text,a.modifiers))}),new c(b,a.indent,a.quoted)};var v=u.extend({init:function(a,b,c){this._super("plain",a,b,c)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});o.plain=v;var w=u.extend({init:function(a,b,c){this._super("unordered-list",a,b,c)},_getTextPrefix:function(a){return this._super(a)+"* "},maxIndent:2,htmlIndentPrefix:"<ul>",htmlIndentSuffix:"</ul>",htmlPrefix:"<li>",htmlSuffix:"</li>"});o["unordered-list"]=w;var x=u.extend({init:function(a,b,c){this._super("ordered-list",a,b,c)},_getTextPrefix:function(a){var b=this._super(a),c,d=this.getIndent(),e=a.indexOf(this)-1,f=1;while(e>=0){c=a[e];if(d>c.getIndent()||!(c instanceof this.constructor))break;d==c.getIndent()&&f++,e--}return b+f+". "},maxIndent:2,htmlIndentPrefix:"<ol>",htmlIndentSuffix:"</ol>",htmlPrefix:"<li>",htmlSuffix:"</li>"});o["ordered-list"]=x;var y=u.extend({init:function(a,b,c){this._super("code",a,b,c)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<pre>",htmlSuffix:"</pre>"});o.code=y;var z=u.extend({init:function(a,b,c){this._super("math",a,b,c)},_getTextPrefix:function(a){return this._super(a)+"$$"},_getTextSuffix:function(a){return"$$"+this._super(a)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<pre>$$",htmlSuffix:"$$</pre>"});o.math=z;var A=u.extend({init:function(a,b,c){h.assert(a.length==1,"ImageSections should have exactly one child:",a),h.assert(a[0].hasModifier("image"),"missing image modifier on image span"),this._super("image",a,b,c),this.setEditable(!1)},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});A.fromURL=function(a){return new A([new C("",{image:a})])},o.image=A;var B=u.extend({init:function(a,b,c){h.assert(a.length==1,"VideoSections should have exactly one child:",a),h.assert(a[0].hasModifier("video"),"missing video modifier on video span"),this._super("video",a,b,c),this.setEditable(!1),this._setPreviewImage()},_setPreviewImage:function(){var a=this.children[0].getModifier("video"),b=k.parseParams(a),c,d;b.v?c=b.v:(d=document.createElement("a"),d.href=a,c=d.pathname.slice(1)),this.children[0].setModifier("image","https://img.youtube.com/vi/"+c+"/hqdefault.jpg")},htmlIndentPrefix:"",htmlIndentSuffix:"",htmlPrefix:"<p>",htmlSuffix:"</p>"});B.YOUTUBE_URL_RE=/(?:https?:\/{2})?(?:w{3}\.)?youtu(?:be)?\.(?:com|be)(?:\/watch\?v=|\/)([^\s]+)/,B.fromURL=function(a){return new B([new C("",{video:a})])},o.video=B;var C=s.create("span",{init:function(a,b){b=b||{},this.modifiers={},this._content=h.create("div"),this._content.className="content",this.node.appendChild(this._content),this._image=null,a?this.setText(a):this.setPlaceholder();for(var c in b)this.setModifier(c,b[c])},toJSON:function(){return{modifiers:h.extend({},this.modifiers),text:this.getText()}},previous:function(){return this.previousSibling()||this.parent.previousSibling()&&this.parent.previousSibling().lastChild()},next:function(){return this.nextSibling()||this.parent.nextSibling()&&this.parent.nextSibling().firstChild()},first:function(){return new p(this,0)},last:function(){return new p(this,this.getLength())},setModifier:function(a,b){this.modifiers[a]=b||!0,a=="image"&&(this._image===null&&(this._image=h.create("img")),this.setText(""),this._content.appendChild(this._image),this._image.src=b),this._updateClass()},removeModifier:function(a){delete this.modifiers[a],this._updateClass()},getModifier:function(a){return this.modifiers[a]},hasModifier:function(a){return a in this.modifiers},_updateClass:function(){this.node.className="span";for(var a in this.modifiers)this.modifiers.hasOwnProperty(a)&&this.modifiers[a]&&(this.node.className+=" "+a)},isEmpty:function(){return this.node.textContent===""||this.node.innerHTML===""||this.node.innerHTML=="<br>"},getText:function(){return this._content.textContent},setText:function(a){this._content.textContent=a},deleteText:function(a,b){this.setText(this.getText().slice(0,a)+this.getText().slice(b))},getLength:function(){return this.hasModifier("image")?1:this.getText().length},getFocusNode:function(){return h.isTextNode(this._content.firstChild)?this._content.firstChild:this._content},setPlaceholder:function(){this._content.innerHTML="<br/>";for(var a in this.modifiers)this.removeModifier(a)},shouldAvoidSplitting:function(){return this.hasModifier("link")||this.hasModifier("code")||this.hasModifier("math")},split:function(a,b){var c;return!b&&this.shouldAvoidSplitting()?this:(this.isEmpty()?c=new C(null,this.modifiers):a===0?(c=new C(this.getText(),this.modifiers),this.setPlaceholder()):(c=new C(this.getText().slice(a),this.modifiers),this.setText(this.getText().slice(0,a))),this.parent.insertBefore(c,this.nextSibling()),c)},_toText:function(){var a,b;return a=this.getText(),this.hasModifier("math")&&(a="$"+a+"$"),this.hasModifier("italic")&&(a="*"+a+"*"),this.hasModifier("bold")&&(a="**"+a+"**"),this.hasModifier("underline")&&(a="_"+a+"_"),this.hasModifier("link")&&(b=this.getModifier("link"),a+=" ("+b.url+")"),a},_toHTML:function(){var a,b;return this.hasModifier("image")?'<img src="'+this.getModifier("image")+'"/>':(a=this.getText(),this.hasModifier("italic")&&(a="<i>"+a+"</i>"),this.hasModifier("bold")&&(a="<b>"+a+"</b>"),this.hasModifier("underline")&&(a="<u>"+a+"</u>"),this.hasModifier("link")&&(b=this.getModifier("link"),a='<a href="'+b.url+'">'+a+"</a>"),this.hasModifier("code")?a="<code>"+a+"</code>":this.hasModifier("math")&&(a="<code>$"+a+"$</code>"),a)},toContent:function(a){if(a==n.TEXT)return this._toText();if(a==n.HTML)return this._toHTML()}});a.MODIFIERS=m,a.CONTENT_TYPES=n,a.Position=p,a.Caret=q,a.Container=s,a.Doc=t,a.PlainSection=v,a.UnorderedListSection=w,a.OrderedListSection=x,a.CodeSection=y,a.MathSection=z,a.ImageSection=A,a.VideoSection=B,a.Span=C},{"qtext2/undo":!0,"interface/settings":!0,"qtext2/parser":!0,log:!0,window_manager:!0,"qtext2/util":!0,"third_party/rangy-core":!0,linkify:!0,Class:!0,browser:!0})}),require.whenReady("settings",function(){require.install("qtext2/ui",function(require,a,b){var c=require("Class").Class;a.LinkSelector=c.extend({show:function(){},hide:function(){},onSubmit:function(){},onCancel:function(){},getExternalURL:function(){}})},{Class:!0})}),require.whenReady("settings",function(){require.install("unified_view/upload",function(require,a,b){a.uploadImages=function(a,b,c,d){var e=new FormData;e.append("formkey",require("settings").formkey),e.append("kind",a);for(var f=0;f<b.length;f++)e.append("file",b[f]);var g=new XMLHttpRequest;g.onreadystatechange=function(){if(g.readyState!=4)return;g.status!=200&&d();var a=JSON.parse(g.response);a.success?c(a.qimg_urls):d(a.message)},g.open("POST","/_/imgupload/upload_POST",!0),g.send(e)}},{settings:!0})}),require.whenReady("settings",function(){require.install("qtext2/tests/test_util",function(require,a,b){var c=require("qtext2/util"),d=c.Util;a.suite=function(){describe("Util",function(){describe("create",function(){it("should create DIVs correctly",function(){expect(d.create("DIV").nodeName).to.equal("DIV")}),it("should create SPANs correctly",function(){expect(d.create("SPAN").nodeName).to.equal("SPAN")})}),describe("extend",function(){it("should handle empty props",function(){expect(d.extend({a:1})).to.eql({a:1})}),it("should add props",function(){expect(d.extend({},{a:1})).to.eql({a:1})}),it("should overwrite props",function(){expect(d.extend({a:1},{a:2})).to.eql({a:2})})}),describe("getData",function(){it("should be null for unset data",function(){var a=d.create("DIV");expect(d.getData(a,"type")).to.be(null)}),it("should return correct data",function(){var a=d.create("DIV");d.setData(a,"type","plain"),expect(d.getData(a,"type")).to.be("plain")})}),describe("setData",function(){it("should set correct data",function(){var a=d.create("DIV");d.setData(a,"type","plain"),expect(d.getData(a,"type")).to.be("plain")})}),describe("isTextNode",function(){it("should detect text nodes correctly",function(){var a=document.createTextNode("hi");expect(d.isTextNode(a)).to.be.ok()}),it("should not detect DIVs as text nodes",function(){var a=d.create("DIV");expect(d.isTextNode(a)).to.not.be.ok()})}),describe("on",function(){it("should attach keydown handler",function(){var a=d.create("DIV"),b=!1;d.on("keydown",a,function(){b=!0}),a.dispatchEvent(new KeyboardEvent("keydown")),expect(b).to.be.ok()})}),describe("jsonEqual",function(){it("should handle primitives correctly",function(){expect(d.jsonEqual(1,1)).to.be(!0),expect(d.jsonEqual(!0,!0)).to.be(!0),expect(d.jsonEqual("hello","hello")).to.be(!0),expect(d.jsonEqual(null,null)).to.be(!0),expect(d.jsonEqual(undefined,undefined)).to.be(!0),expect(d.jsonEqual(1,"1")).to.be(!1),expect(d.jsonEqual(null,undefined)).to.be(!1)}),it("should handle arrays correctly",function(){expect(d.jsonEqual([],[])).to.be(!0),expect(d.jsonEqual([1,2],[1,2])).to.be(!0),expect(d.jsonEqual([{a:1}],[{a:1}])).to.be(!0),expect(d.jsonEqual(undefined,[1,2])).to.be(!1),expect(d.jsonEqual([1,2],undefined)).to.be(!1),expect(d.jsonEqual([1,2],[1])).to.be(!1),expect(d.jsonEqual([2],[1,2])).to.be(!1)}),it("should handle objects correctly",function(){expect(d.jsonEqual({},{})).to.be(!0),expect(d.jsonEqual({a:1},{a:1})).to.be(!0),expect(d.jsonEqual({a:1,b:2},{b:2,a:1})).to.be(!0),expect(d.jsonEqual({a:[1,2]},{a:[1,2]})).to.be(!0),expect(d.jsonEqual({a:{b:1}},{a:{b:1}})).to.be(!0),expect(d.jsonEqual({a:1},{})).to.be(!1),expect(d.jsonEqual({},{a:1})).to.be(!1),expect(d.jsonEqual({a:1},{b:2})).to.be(!1),expect(d.jsonEqual({},"")).to.be(!1),expect(d.jsonEqual("",{})).to.be(!1),expect(d.jsonEqual({},null)).to.be(!1),expect(d.jsonEqual(null,{})).to.be(!1)})})})}},{"qtext2/util":!0})}),require.whenReady("settings",function(){require.install("qtext2/tests/test_base",function(require,a,b){var c=require("qtext2/util"),d=require("qtext2/base"),e=require("qtext2/ui"),f=c.Util,g=d.Position,h=d.Caret,i=d.Doc,j=d.PlainSection,k=d.OrderedListSection,l=d.UnorderedListSection,m=d.CodeSection,n=d.MathSection,o=d.ImageSection,p=d.Span,q=d.CONTENT_TYPES,r=function(a){var b=new i(a);return document.getElementById("editors").appendChild(b.node),b.node.focus(),b},s=function(a){document.getElementById("editors").removeChild(a.node)};a.suite=function(){describe("Position",function(){describe("toJSON",function(){it("should get the correct indices",function(){var a=new p("first"),b=new p("second"),c=new p("third"),d=new j([a,b]),e=new k([c]),f=r([d,e]),h;h=new g(b,3),expect(h.toJSON()).to.eql({spanIdx:1,sectionIdx:0,offset:3}),h=new g(a,0),expect(h.toJSON()).to.eql({spanIdx:0,sectionIdx:0,offset:0}),s(f)})}),describe("atSpanStart, atSpanEnd, atSectionStart, atSectionEnd, atDocStart, atDocEnd",function(){describe("empty doc",function(){var a,b;beforeEach(function(){a=r(),b=new g(a.firstChild().firstChild(),0)}),it("should be at span start",function(){expect(b.atSpanStart()).to.be(!0)}),it("should be at span end",function(){expect(b.atSpanStart()).to.be(!0)}),it("should be at section start",function(){expect(b.atSectionStart()).to.be(!0)}),it("should be at section end",function(){expect(b.atSectionEnd()).to.be(!0)}),it("should be at doc start",function(){expect(b.atDocStart()).to.be(!0)}),it("should be at doc end",function(){expect(b.atDocEnd()).to.be(!0)}),afterEach(function(){s(a)})}),describe("non-empty doc",function(){var a,b,c,d;beforeEach(function(){a=r([new j,new k]),b=a.firstChild().firstChild(),c=a.lastChild().firstChild(),d=new p("Third"),b.setText("First"),c.setText("Second"),a.lastChild().appendChild(d)}),it("should not be at start or end of anything",function(){var a=new g(b,3);expect(a.atDocStart()).to.be(!1),expect(a.atDocEnd()).to.be(!1),expect(a.atSectionStart()).to.be(!1),expect(a.atSectionEnd()).to.be(!1),expect(a.atSpanStart()).to.be(!1),expect(a.atSpanEnd()).to.be(!1)}),it("should be at start of span and section but not doc",function(){var a=new g(c,0);expect(a.atDocStart()).to.be(!1),expect(a.atDocEnd()).to.be(!1),expect(a.atSectionStart()).to.be(!0),expect(a.atSectionEnd()).to.be(!1),expect(a.atSpanStart()).to.be(!0),expect(a.atSpanEnd()).to.be(!1)}),it("should be at start of span but not section or doc",function(){var a=new g(d,0);expect(a.atDocStart()).to.be(!1),expect(a.atDocEnd()).to.be(!1),expect(a.atSectionStart()).to.be(!1),expect(a.atSectionEnd()).to.be(!1),expect(a.atSpanStart()).to.be(!0),expect(a.atSpanEnd()).to.be(!1)}),it("should be at end of span and section but not doc",function(){var a=new g(b,b.getLength());expect(a.atDocStart()).to.be(!1),expect(a.atDocEnd()).to.be(!1),expect(a.atSectionStart()).to.be(!1),expect(a.atSectionEnd()).to.be(!0),expect(a.atSpanStart()).to.be(!1),expect(a.atSpanEnd()).to.be(!0)}),afterEach(function(){s(a)})})})}),describe("Caret",function(){describe("moveStart, moveEnd, move",function(){var a,b,c,d;beforeEach(function(){d=r(),d.firstChild().appendChild(new p("second")),b=d.firstChild().firstChild(),b.setText("first"),c=b.next(),a=new h(new g(b,0),new g(c,1))}),it("should move caret inside a span when non-empty",function(){a.move(new g(b,1)),expect(a.start).to.have.property("span",b),expect(a.start).to.have.property("offset",1),expect(a.end).to.have.property("span",b),expect(a.end).to.have.property("offset",1);var c=rangy.getSelection();expect(c.anchorNode).to.be(b.getFocusNode())}),it("should move caret inside a span when empty",function(){b.setPlaceholder(),a.move(new g(b,0)),expect(a.start).to.have.property("span",b),expect(a.start).to.have.property("offset",0),expect(a.end).to.have.property("span",b),expect(a.end).to.have.property("offset",0);var c=rangy.getSelection();expect(c.anchorNode).to.be(b.getFocusNode())}),it("should select spans when start and end are specified",function(){a.move(new g(b,1),new g(c,2)),expect(a.start).to.have.property("span",b),expect(a.start).to.have.property("offset",1),expect(a.end).to.have.property("span",c),expect(a.end).to.have.property("offset",2);var d=rangy.getSelection();expect(d.anchorNode).to.be(b.getFocusNode()),expect(d.focusNode).to.be(c.getFocusNode()),expect(d.isCollapsed).to.be(!1)}),afterEach(function(){s(d)})}),describe("update",function(){var a,b,c,d;beforeEach(function(){d=r(),d.appendChild(new j),b=d.firstChild().firstChild(),c=b.next(),b.setText("first"),c.setText("second"),a=new h(new g(b,0),new g(c,1))});var e=function(a,b){var c=rangy.createRange();c.setStart(a,b),c.setEnd(a,b),c.collapse(!0),rangy.getSelection().setSingleRange(c)};it("should move to the first span when document node is selected",function(){e(d.node,0),a.update(),expect(a.start).to.have.property("span",b),expect(a.start).to.have.property("offset",0),expect(a.end).to.have.property("span",b),expect(a.end).to.have.property("offset",0);var c=rangy.getSelection();expect(c.anchorNode).to.be(b.getFocusNode())}),it("should move to the first span of the selected section",function(){e(d.lastChild().node,0),a.update(),expect(a.start).to.have.property("span",c),expect(a.start).to.have.property("offset",0),expect(a.end).to.have.property("span",c),expect(a.end).to.have.property("offset",0);var b=rangy.getSelection();expect(b.anchorNode).to.be(c.getFocusNode())}),afterEach(function(){s(d)})})}),describe("Container",function(){var a=d.Container.create("test",{});describe("insertBefore and appendChild",function(){it("should update parents",function(){var b=new a,c=new a,d=new a;b.appendChild(d),expect(d.parent).to.be(b),expect(b.children).to.eql([d]),expect(c.children).to.eql([]),c.appendChild(d),expect(d.parent).to.be(c),expect(b.children).to.eql([]),expect(c.children).to.eql([d])}),it("should append when referenceChild is null",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.insertBefore(d),expect(b.children).to.eql([c,d])}),it("should insert before referenceChild correctly",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.insertBefore(d,c),expect(b.children).to.eql([d,c])})}),describe("removeChild",function(){it("should remove child correctly",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(b.children).to.eql([c,d]),b.removeChild(c),expect(b.children).to.eql([d]),b.removeChild(d),expect(b.children).to.eql([])})}),describe("removeChildren",function(){it("should remove all children",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(b.children).to.eql([c,d]),b.removeChildren(),expect(b.children).to.eql([])})}),describe("previousSibling",function(){it("should return null",function(){var b=new a,c=new a;b.appendChild(c),expect(c.previousSibling()).to.be(null)}),it("should return first child",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(d.previousSibling()).to.be(c)})}),describe("nextSibling",function(){it("should return null",function(){var b=new a,c=new a;b.appendChild(c),expect(c.nextSibling()).to.be(null)}),it("should return second child",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(c.nextSibling()).to.be(d)})}),describe("firstChild",function(){it("should return null",function(){var b=new a;expect(b.firstChild()).to.be(null)}),it("should return first child",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(b.firstChild()).to.be(c)})}),describe("lastChild",function(){it("should return null",function(){var b=new a;expect(b.lastChild()).to.be(null)}),it("should return last child",function(){var b=new a,c=new a,d=new a;b.appendChild(c),b.appendChild(d),expect(b.lastChild()).to.be(d)})})}),describe("Doc",function(){describe("init",function(){it("should have one empty, plain section on creation",function(){var a=r();expect(a.firstChild()).to.be.a(j),expect(a.firstChild().isEmpty()).to.be(!0),s(a)})}),describe("toJSON",function(){it("should serialize the entire state",function(){var a=new p("first"),b=new p("second"),c=new j([a]),d=new k([b]),e=r([c,d]),f;e.caret.move(a.first(),b.last()),f=e.toJSON(),expect(f.caret).to.eql({start:{spanIdx:0,sectionIdx:0,offset:0},end:{spanIdx:0,sectionIdx:1,offset:6}}),expect(f.sections.length).to.be(2),expect(f.sections[0]).to.eql({indent:0,quoted:!1,type:"plain",spans:[{modifiers:{},text:"first"}]}),expect(f.sections[1]).to.eql({indent:0,quoted
:!1,type:"ordered-list",spans:[{modifiers:{},text:"second"}]}),s(e)})}),describe("handleUndo",function(){it("should remember the latest changes",function(){var a=new i([new j([new p("hi")])]);a.saveState(),a.firstChild().firstChild().setText("hello"),expect(a.firstChild().firstChild().getText()).to.be("hello"),a.handleUndo(),expect(a.firstChild().firstChild().getText()).to.be("hi"),a.handleRedo(),expect(a.firstChild().firstChild().getText()).to.be("hello")})}),describe("fromJSON",function(){it("should restore the document correctly",function(){var a=r(),b,c,d,e,f,g;a.fromJSON({caret:{start:{offset:0,spanIdx:0,sectionIdx:0},end:{offset:3,spanIdx:1,sectionIdx:0}},sections:[{type:"plain",spans:[{text:"hi",modifiers:{bold:!0}},{text:"there"}]},{type:"unordered-list",indent:1,spans:[{text:"bye",modifiers:{italic:!0}}]},{type:"unordered-list",indent:1,quoted:!0,spans:[{text:"text"}]}]}),expect(a.children.length).to.be(3),b=a.firstChild(),expect(b).to.be.a(j),expect(b.children.length).to.be(2),expect(b.isQuoted()).to.be(!1),e=b.firstChild(),expect(e.getText()).to.be("hi"),expect(e.hasModifier("bold")).to.be(!0),f=b.lastChild(),expect(f.getText()).to.be("there"),c=b.nextSibling(),expect(c).to.be.an(l),expect(c.children.length).to.be(1),expect(c.getIndent()).to.be(1),expect(c.isQuoted()).to.be(!1),g=c.firstChild(),expect(g.getText()).to.be("bye"),expect(g.hasModifier("italic")).to.be(!0),d=c.nextSibling(),expect(d.isQuoted()).to.be(!0),s(a)}),it("should handle empty json correctly",function(){var a=r(),b;a.fromJSON({}),expect(a.children.length).to.be(1),b=a.firstChild(),expect(b).to.be.a(j),expect(b.isEmpty()).to.be(!0),s(a)})}),describe("_applyFormattingChange",function(){var a,b,c;beforeEach(function(){a=new j,b=a.firstChild(),c=r([a]),b.setText("first")}),it("should apply formatting state when at start of a span",function(){c.caret.move(a.first()),c._updateFormattingState(),c.toggleModifier("bold"),b.setText("1first"),c.caret.move(new g(b,1)),c._applyFormattingChange(),expect(a.children.length).to.be(2),expect(a.firstChild().hasModifier("bold")).to.be(!0),expect(a.firstChild().getText()).to.be("1"),expect(a.lastChild().hasModifier("bold")).to.be(!1),expect(a.lastChild().getText()).to.be("first")}),it("should apply formatting state when at end of a span",function(){c.caret.move(a.last()),c._updateFormattingState(),c.toggleModifier("bold"),b.setText("first1"),c.caret.move(a.last()),c._applyFormattingChange(),expect(a.children.length).to.be(2),expect(a.firstChild().hasModifier("bold")).to.be(!1),expect(a.firstChild().getText()).to.be("first"),expect(a.lastChild().hasModifier("bold")).to.be(!0),expect(a.lastChild().getText()).to.be("1")}),it("should apply formatting state when in the middle of a span",function(){c.caret.move(new g(b,3)),c._updateFormattingState(),c.toggleModifier("bold"),b.setText("fir1st"),c.caret.move(new g(b,4)),c._applyFormattingChange(),expect(a.children.length).to.be(3),expect(a.firstChild().hasModifier("bold")).to.be(!1),expect(a.firstChild().getText()).to.be("fir"),expect(a.children[1].hasModifier("bold")).to.be(!0),expect(a.children[1].getText()).to.be("1"),expect(a.lastChild().hasModifier("bold")).to.be(!1),expect(a.lastChild().getText()).to.be("st")}),it("should ignore formatting change when moving left",function(){c.caret.move(a.last()),c._updateFormattingState(),c.toggleModifier("bold"),b.setText("firs"),c.caret.move(a.last()),c._applyFormattingChange(),expect(a.children.length).to.be(1),expect(a.firstChild().getText()).to.be("firs"),expect(a.firstChild().hasModifier("bold")).to.be(!1)}),it("should ignore formatting change when in a different span",function(){var b=new p("second");a.appendChild(b),c.caret.move(a.last()),c._updateFormattingState(),c.toggleModifier("bold"),c.caret.move(new g(b,1)),c._applyFormattingChange(),expect(a.children.length).to.be(2),expect(a.firstChild().hasModifier("bold")).to.be(!1),expect(a.lastChild().hasModifier("bold")).to.be(!1)}),afterEach(function(){s(c)})}),describe("handleBackspace",function(){it("should not delete last remaining section and span from empty document",function(){var a=r();a.handleBackspace(),expect(a.node.children.length).to.be(1),expect(a.node.firstChild.children.length).to.be(1),s(a)}),it("should merge sections when at front of a section",function(){var a=new j,b=new k,c=a.firstChild(),d=b.firstChild(),e=r([a,b]);c.setText("hi"),d.setText("there"),e.caret.move(new g(d,0)),e.handleBackspace(),expect(e.children.length).to.be(1),expect(e.firstChild().children).to.eql([c,d]),s(e)}),it("should not leave empty spans in middle of a section",function(){var a=r(),b=a.firstChild(),c=b.firstChild(),d=new p("2"),e=new p("3");c.setText("1"),b.appendChild(d),b.appendChild(e),a.caret.move(new g(d,1)),a.handleBackspace(),expect(b.children.length).to.be(2),expect(b.children).to.eql([c,e]),s(a)}),it("should delete text in previous span when at start of a span",function(){var a=r(),b=a.firstChild(),c=b.firstChild(),d=new p("second");c.setText("first"),b.appendChild(d),a.caret.move(new g(d,0)),a.handleBackspace(),expect(c.getText()).to.be("firs"),expect(a.caret.start.span).to.be(c),expect(a.caret.start.offset).to.be(c.getLength()),s(a)}),it("should unindent list items when at start of the section",function(){var a=new k,b=new l,c=a.firstChild(),d=b.firstChild(),e=r([a,b]);c.setText("one"),d.setText("two"),b.setIndent(2),e.caret.move(b.first()),e.handleBackspace(),expect(e.children.length).to.be(2),e.handleBackspace(),expect(e.children.length).to.be(2),e.handleBackspace(),expect(e.children.length).to.be(1),expect(e.firstChild().children).to.eql([c,d]),s(e)}),describe("selection",function(){var a,b,c,d,e,f,h;beforeEach(function(){b=new j,c=new k,d=new j,e=b.firstChild(),f=c.firstChild(),h=d.firstChild(),a=r([b,c,d]),e.setText("first"),f.setText("second"),h.setText("third")}),it("should merge sections when deleting",function(){a.caret.moveStart(new g(e,1)),a.caret.moveEnd(new g(f,1)),a.handleBackspace(),expect(a.children).to.eql([b,d]),expect(a.firstChild().children).to.eql([e,f]),expect(e.getText()).to.be("f"),expect(f.getText()).to.be("econd")}),it("should delete sections that are completely selected",function(){a.caret.moveStart(new g(e,1)),a.caret.moveEnd(new g(h,1)),a.handleBackspace(),expect(a.children).to.eql([b]),expect(b.children).to.eql([e,h]),expect(e.getText()).to.be("f"),expect(h.getText()).to.be("hird")}),it("should leave section empty when a section is exactly selected",function(){a.caret.moveStart(new g(f,0)),a.caret.moveEnd(new g(f,f.getLength())),a.handleBackspace(),expect(a.children).to.eql([b,c,d]),expect(c.firstChild().isEmpty()).to.be(!0),expect(a.caret.isCollapsed()).to.be(!0),expect(a.caret.start.span).to.be(f),expect(a.caret.start.offset).to.be(0)}),it("should handle empty start span correctly",function(){var e=new p("fourth");d.appendChild(e),a.caret.moveStart(new g(f,0)),a.caret.moveEnd(new g(e,1)),a.handleBackspace(),expect(a.children).to.eql([b,c]),expect(c.children).to.eql([e]),expect(e.getText()).to.be("ourth"),expect(a.caret.isCollapsed()).to.be(!0),expect(a.caret.start.span).to.be(e),expect(a.caret.start.offset).to.be(0)}),afterEach(function(){s(a)})})}),describe("handleDelete",function(){it("should not delete last remaining section and span from empty document",function(){var a=r();a.handleDelete(),expect(a.node.children.length).to.be(1),expect(a.node.firstChild.children.length).to.be(1),s(a)}),it("should merge sections when at end of a section",function(){var a=new j,b=new k,c=a.firstChild(),d=b.firstChild(),e=r([a,b]);c.setText("hi"),d.setText("there"),e.caret.move(new g(c,c.getLength())),e.handleDelete(),expect(e.children.length).to.be(1),expect(e.firstChild().children).to.eql([c,d]),s(e)}),it("should not leave empty spans in middle of a section",function(){var a=r(),b=a.firstChild(),c=b.firstChild(),d=new p("2"),e=new p("3");c.setText("1"),b.appendChild(d),b.appendChild(e),a.caret.move(new g(d,0)),a.handleDelete(),expect(b.children.length).to.be(2),expect(b.children).to.eql([c,e]),s(a)}),it("should delete text in next span when at end of a span",function(){var a=r(),b=a.firstChild(),c=b.firstChild(),d=new p("second");c.setText("first"),b.appendChild(d),a.caret.move(new g(c,c.getLength())),a.handleDelete(),expect(d.getText()).to.be("econd"),expect(a.caret.start.span).to.be(d),expect(a.caret.start.offset).to.be(0),s(a)}),describe("selection",function(){var a,b,c,d,e,f,h;beforeEach(function(){b=new j,c=new k,d=new j,e=b.firstChild(),f=c.firstChild(),h=d.firstChild(),a=r([b,c,d]),e.setText("first"),f.setText("second"),h.setText("third")}),it("should merge sections when deleting",function(){a.caret.moveStart(new g(e,1)),a.caret.moveEnd(new g(f,1)),a.handleDelete(),expect(a.children).to.eql([b,d]),expect(a.firstChild().children).to.eql([e,f]),expect(e.getText()).to.be("f"),expect(f.getText()).to.be("econd")}),it("should delete sections that are completely selected",function(){a.caret.moveStart(new g(e,1)),a.caret.moveEnd(new g(h,1)),a.handleDelete(),expect(a.children).to.eql([b]),expect(b.children).to.eql([e,h]),expect(e.getText()).to.be("f"),expect(h.getText()).to.be("hird")}),it("should leave section empty when a section is exactly selected",function(){a.caret.moveStart(new g(f,0)),a.caret.moveEnd(new g(f,f.getLength())),a.handleDelete(),expect(a.children).to.eql([b,c,d]),expect(c.firstChild().isEmpty()).to.be(!0),expect(a.caret.isCollapsed()).to.be(!0),expect(a.caret.start.span).to.be(f),expect(a.caret.start.offset).to.be(0)}),afterEach(function(){s(a)})})}),describe("handleReturn",function(){var a,b;beforeEach(function(){b=new k,a=r([b])}),it("should first deindent empty sections if indented",function(){b.setIndent(2),a.caret.move(b.first()),a.handleReturn(),expect(a.firstChild()).to.be.an(k),expect(a.firstChild().getIndent()).to.be(1),a.handleReturn(),expect(a.firstChild()).to.be.an(k),expect(a.firstChild().getIndent()).to.be(0)}),it("should convert unindented sections to plaintext",function(){expect(a.firstChild()).to.be.an(k),a.handleReturn(),expect(a.firstChild()).to.be.an(j)}),it("should convert quoted non-plaintex sections to quoted plaintext",function(){b.setQuoted(!0),expect(a.firstChild()).to.be.an(k),a.handleReturn(),expect(a.firstChild()).to.be.an(j),expect(a.firstChild().isQuoted()).to.be(!0)}),it("should unquote plaintext",function(){b.changeType(j).setQuoted(!0),expect(a.firstChild().isQuoted()).to.be(!0),a.handleReturn(),expect(a.firstChild().isQuoted()).to.be(!1)}),afterEach(function(){s(a)})}),describe("_getSelectedSpans",function(){var a,b,c,d,e,f,h;beforeEach(function(){b=new j,c=new k,d=new j,e=b.firstChild(),f=c.firstChild(),h=d.firstChild(),a=r([b,c,d]),e.setText("first"),f.setText("second"),h.setText("third")}),it("should split start section when in the middle of it",function(){var c;a.caret.move(new g(e,1),new g(e,e.getLength())),c=a._getSelectedSpans(),expect(c.length).to.be(1),expect(c[0].getText()).to.be("irst"),expect(b.children.length).to.be(2),expect(e.getText()).to.be("f"),expect(e.nextSibling().getText()).to.be("irst")}),it("should split end section when in the middle of it",function(){var c;a.caret.move(new g(e,0),new g(e,e.getLength()-1)),c=a._getSelectedSpans(),expect(c.length).to.be(1),expect(c[0].getText()).to.be("firs"),expect(b.children.length).to.be(2),expect(e.getText()).to.be("firs"),expect(e.nextSibling().getText()).to.be("t")}),it("should split spans correctly when forceSplit is true",function(){var c;e.setModifier("math"),a.caret.move(new g(e,1),new g(e,e.getLength()-1)),c=a._getSelectedSpans(!0),expect(b.children.length).to.be(3),expect(c.length).to.be(1),expect(c[0].getText()).to.be("irs")}),it("should not create empty spans",function(){var c;a.caret.move(new g(e,e.getLength()),new g(h,0)),c=a._getSelectedSpans(),expect(c).to.eql([f]),expect(b.children).to.eql([e]),expect(d.children).to.eql([h])}),it("should get spans across sections",function(){var b;a.caret.move(new g(e,0),new g(h,h.getLength())),b=a._getSelectedSpans(),expect(b).to.eql([e,f,h])}),afterEach(function(){s(a)})}),describe("toggleModifier",function(){var a,b,c,d,e,f,h;beforeEach(function(){b=new j,c=new k,d=new j,e=b.firstChild(),f=c.firstChild(),h=d.firstChild(),a=r([b,c,d]),e.setText("first"),f.setText("second"),h.setText("third")}),it("should use the first span's modifier to toggle",function(){e.setModifier("bold",!0),h.setModifier("bold",!0),a.caret.move(b.first(),d.last()),a.toggleModifier("bold"),expect(e.hasModifier("bold")).to.be(!1),expect(f.hasModifier("bold")).to.be(!1),expect(h.hasModifier("bold")).to.be(!1)}),it("should create new spans as needed",function(){a.caret.move(new g(e,1),new g(f,f.getLength()-1)),a.toggleModifier("bold"),expect(b.children.length).to.be(2),expect(c.children.length).to.be(2),expect(b.lastChild().getText()).to.be("irst"),expect(b.firstChild().hasModifier("bold")).to.be(!1),expect(b.lastChild().hasModifier("bold")).to.be(!0),expect(c.firstChild().getText()).to.be("secon"),expect(c.firstChild().hasModifier("bold")).to.be(!0),expect(c.lastChild().hasModifier("bold")).to.be(!1)}),it("should leave the selection unchanged",function(){a.caret.move(new g(e,1),new g(f,f.getLength()-1)),a.toggleModifier("bold");var d=rangy.getSelection();expect(d.anchorNode).to.be(b.lastChild().getFocusNode()),expect(d.anchorOffset).to.be(0),expect(d.focusNode).to.be(c.firstChild().getFocusNode()),expect(d.focusOffset).to.be(c.firstChild().getLength())}),afterEach(function(){s(a)})}),describe("toggleMath, toggleCode",function(){var a,b,c,d,e,f;beforeEach(function(){d=new p("one"),e=new p("two"),f=new p("three"),b=new j([d]),c=new k([e,f]),a=r([b,c])}),it("should merge spans in each section",function(){e.setModifier("bold",!0),a.caret.move(b.first(),c.last()),a.toggleMath(),expect(b.children.length).to.be(1),expect(b.firstChild().getText()).to.be("one"),expect(b.firstChild().hasModifier("math")).to.be(!0),expect(c.lastChild().getText()).to.be("twothree"),expect(c.lastChild().hasModifier("math")).to.be(!0)}),it("should ensure only one of math or code modifiers is applied",function(){d.setModifier("math",!0),a.caret.move(b.first(),c.last()),a.toggleCode(),expect(b.firstChild().hasModifier("math")).to.be(!1),expect(c.firstChild().hasModifier("math")).to.be(!1)}),it("should convert current section when nothing is selected",function(){a.caret.move(b.first()),a.toggleMath(),expect(a.firstChild()).to.be.a(n),a.toggleCode(),expect(a.firstChild()).to.be.a(m),a.toggleCode(),expect(a.firstChild()).to.be.a(j)}),afterEach(function(){s(a)})}),describe("convertSelectionToContent",function(){var a,b,c,d,f,h,i;beforeEach(function(){a=new k,b=new k,c=new k,d=a.firstChild(),f=b.firstChild(),h=c.firstChild(),i=r([a,b,c]),d.setText("first"),f.setText("second"),h.setText("third")}),it("should always include section prefix and suffix",function(){var a=new g(d,3);i.caret.move(new g(d,0),a),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. fir\n"),i.caret.move(new g(d,1),a),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. ir\n")}),it("should update numbering for ordered lists",function(){var a=new g(h,h.getLength());i.caret.move(new g(d,0),a),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. first\n2. second\n3. third\n"),b.setIndent(1),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. first\n    1. second\n2. third\n"),b.setIndent(0),i.caret.move(new g(f,0),a),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. second\n2. third\n")}),it("should generate correct html for lists",function(){var a=new g(h,h.getLength());i.caret.move(new g(d,0),a),expect(i.convertSelectionToContent(q.HTML)).to.be("<ol><li>first</li><li>second</li><li>third</li></ol>"),b.setIndent(2),expect(i.convertSelectionToContent(q.HTML)).to.be("<ol><li>first</li><ol><ol><li>second</li></ol></ol><li>third</li></ol>"),b.setIndent(0)}),it("should generate correct html for quoted lists",function(){i.caret.move(a.first(),c.last()),b.setQuoted(!0),expect(i.convertSelectionToContent(q.HTML)).to.be("<ol><li>first</li><blockquote><li>second</li></blockquote><li>third</li></ol>"),a.setQuoted(!0),c.setQuoted(!0),expect(i.convertSelectionToContent(q.HTML)).to.be("<blockquote><ol><li>first</li><li>second</li><li>third</li></ol></blockquote>")}),it("should generate correct html for quoted plaintext",function(){i.caret.move(a.first(),c.last()),i.toggleSectionType(j),i.children[0].setQuoted(!0),expect(i.convertSelectionToContent(q.HTML)).to.be("<blockquote><p>first</p></blockquote><p>second</p><p>third</p>"),i.children[1].setQuoted(!0),i.children[2].setQuoted(!0),expect(i.convertSelectionToContent(q.HTML)).to.be("<blockquote><p>first</p><p>second</p><p>third</p></blockquote>")}),it("should generate correct html and text for external links",function(){var a=e.LinkSelector.extend({getExternalURL:function(a){a("http://www.google.com")}});i.setLinkSelector(new a),i.caret.move(d.first(),d.last()),i.toggleExternalLink(),expect(i.convertSelectionToContent(q.HTML)).to.be('<ol><li><a href="http://www.google.com">first</a></li></ol>'),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. first (http://www.google.com)\n")}),it("should generate correct html for code sections",function(){a.changeType(m),a=i.firstChild(),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.HTML)).to.be("<pre>first</pre>")}),it("should generate correct html for code spans",function(){d.setModifier("code",!0),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.HTML)).to.be("<ol><li><code>first</code></li></ol>")}),it("should generate correct html for math sections",function(){a.changeType(n),a=i.firstChild(),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.HTML)).to.be("<pre>$$first$$</pre>")}),it("should generate correct html for math spans",function(){d.setModifier("math",!0),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.HTML)).to.be("<ol><li><code>$first$</code></li></ol>")}),it("should generate correct text for math sections",function(){a.changeType(n),a=i.firstChild(),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.TEXT)).to.be("$$first$$\n")}),it("should generate correct text for math spans",function(){d.setModifier("math",!0),i.caret.move(a.first(),a.last()),expect(i.convertSelectionToContent(q.TEXT)).to.be("1. $first$\n")}),afterEach(function(){s(i)})}),describe("handlePaste",function(){var a,b,c,d,e,f,h;beforeEach(function(){b=new j,c=new k,d=new j,e=b.firstChild(),f=c.firstChild(),h=d.firstChild(),a=r([b,c,d]),e.setText("first"),f.setText("second"),h.setText("third")}),it("should insert plain text inline everywhere",function(){a.caret.move(new g(e,2)),a.handlePaste("fourth",q.HTML),expect(a.children.length).to.be(3),a.caret.move(new g(f,2)),a.handlePaste("fourth",q.HTML),expect(a.children.length).to.be(3)}),it("should not split if pasting into the same section type",function(){a.caret.move(new g(f,2)),a.handlePaste("<ol><li>fourth</li></ol>",q.HTML),expect(a.children.length).to.be(3)}),it("should maintain order of pasted content",function(){var c,d;a.caret.move(b.last()),a.handlePaste("<ul><li>fourth</li><li>fifth</li></ul>",q.HTML),expect(a.children.length).to.be(5),c=b.nextSibling(),expect(c).to.be.a(l),expect(c.children.length).to.be(1),expect(c.firstChild().getText()).to.be("fourth"),d=c.nextSibling(),expect(d).to.be.a(l),expect(d.children.length).to.be(1),expect(d.firstChild().getText()).to.be("fifth")}),it("should split if pasting into a section of different type",function(){a.caret.move(b.last()),a.handlePaste("<ol><li>fourth</li></ol>",q.HTML),expect(a.children.length).to.be(4)}),it("should move caret at the end of the pasted content",function(){a.caret.move(b.last()),a.handlePaste("<ol><li>fourth</li></ol>",q.HTML),expect(a.children.length).to.be(4),expect(a.caret.start.equals(b.nextSibling().last())).to.be(!0)}),it("should handle blockquoted sections correctly",function(){a.caret.move(b.last()),a.handlePaste("<blockquote>quoted</blockquote>",q.HTML),expect(a.children.length).to.be(3),expect(a.firstChild().isQuoted()).to.be(!1),a.caret.move(c.first()),a.handlePaste("<blockquote>quoted</blockquote>",q.HTML),expect(a.children.length).to.be(3),expect(a.children[1].isQuoted()).to.be(!0)}),it("should replace the current selection",function(){a.caret.move(f.first(),h.last()),a.handlePaste("<ol><li>fourth</li></ol>",q.HTML),expect(a.children.length).to.be(2),expect(a.firstChild()).to.be(b),expect(a.lastChild()).to.be.a(k),expect(a.caret.start.equals(a.lastChild().last())).to.be(!0)}),it("should not destroy selection if pasted content is empty",function(){a.caret.move(f.first(),h.last()),a.handlePaste("",q.TEXT),expect(a.children).to.eql([b,c,d])}),it("should not merge sections of different types",function(){a.caret.move(c.last()),a.handlePaste("<ul><li>fourth</li></ul>",q.HTML),expect(a.children.length).to.be(5),expect(a.children[1]).to.be.an(k),expect(a.children[2]).to.be.an(l),expect(a.children[3]).to.be.an(k),expect(a.caret.start).to.eql(a.children[3].first())}),afterEach(function(){s(a)})}),describe("toggleExternalLink",function(){var a,b,c,d,f,h,i,l="https://youtu.be/dQw4w9WgXcQ",m=!1,n=e.LinkSelector.extend({getExternalURL:function(a){a(l,m)}});beforeEach(function(){b=new j,c=new k,d=new j,f=b.firstChild(),h=c.firstChild(),i=d.firstChild(),a=r([b,c,d]),f.setText("first"),h.setText("second"),i.setText("third"),a.setLinkSelector(new n)}),it("should linkify one span correctly",function(){var c;a.caret.move(f.first(),f.last()),a.toggleExternalLink(),c=b.firstChild(),expect(c.getModifier("link")).to.eql({type:"url",url:l}),expect(c.getText()).to.eql("first"),a.toggleExternalLink(),c=a.firstChild().firstChild(),expect(c.hasModifier("link")).to.be(!1)}),it("should maintain selection",function(){a.caret.move(f.first(),f.last()),a.toggleExternalLink(),expect(a.caret.start.equals(b.first())).to.be(!0),expect(a.caret.end.equals(b.last())).to.be(!0),a.caret.move(f.first(),h.last()),a.toggleExternalLink(),expect(a.caret.start.equals(b.first())).to.be(!0),expect(a.caret.end.equals(c.last())).to.be(!0)}),it("should merge linked spans in a section",function(){var c=new p("fourth"),d;b.appendChild(c),a.caret.move(f.first(),new g(c,2)),a.toggleExternalLink(),d=a.firstChild().firstChild(),expect(d.getModifier("link")).to.eql({type:"url",url:l}),expect(d.getText()).to.eql("firstfo"),a.toggleExternalLink(),d=a.firstChild().firstChild(),expect(d.hasModifier("link")).to.be(!1)}),it("should preserve sections when linking spans",function(){var d,e;a.caret.move(b.first(),c.last()),a.toggleExternalLink(),d=b.firstChild(),e=c.firstChild(),expect(d.getModifier("link")).to.eql({type:"url",url:l}),expect(d.getText()).to.eql("first"),expect(e.getModifier("link")).to.eql({type:"url",url:l}),expect(e.getText()).to.eql("second"),a.toggleExternalLink(),d=b.firstChild(),e=c.firstChild(),expect(d.hasModifier("link")).to.be(!1),expect(e.hasModifier("link")).to.be(!1)}),it("should linkify citations correctly",function(){var c;a.caret.move(f.first(),f.last()),m=!0,a.toggleExternalLink(),c=b.firstChild(),expect(c.getModifier("link")).to.eql({type:"url",url:l,citation:!0}),expect(c.getText()).to.eql("first"),a.toggleExternalLink(),c=a.firstChild().firstChild(),expect(c.hasModifier("link")).to.be(!1)}),afterEach(function(){s(a)})}),describe("showInternalLinkSelector",function(){var a,b,c,d,f={target:{type:"url",url:"/Science"},text:"Science"},h=function(a){expect(a.getModifier("link")).to.eql(f.target),expect(a.getText()).to.eql(f.text),expect(a.nextSibling().getText()).to.be(" ")},i=e.LinkSelector.extend({onSubmit:function(a){this.callback=a},show:function(){this.callback(f)}}),k=e.LinkSelector.extend({__init__:function(a){this.value="@"+a},onCancel:function(a){this.callback=a},show:function(){this.callback(this.value)}});beforeEach(function(){c=new p("first"),d=new p("second"),b=new j([c,d]),a=r([b])}),it("should correctly insert link before first span",function(){a.setLinkSelector(new i),a.caret.move(c.first()),a.showInternalLinkSelector(),h(b.firstChild())}),it("should correctly insert link after last span",function(){a.setLinkSelector(new i),a.caret.move(d.last()),a.showInternalLinkSelector(),h(b.lastChild().previousSibling())}),it("should correctly insert link in the middle of a span",function(){var d;a.setLinkSelector(new i),c.setModifier("bold",!0),a.caret.move(new g(c,2)),a.showInternalLinkSelector(),d=b.children[1],expect(b.firstChild().getText()).to.be("fi"),h(d),expect(d.hasModifier("bold")).to.be(!0)}),it("should correctly insert text when canceling",function(){var d;a.setLinkSelector(new k("Foo")),c.setModifier("bold",!0),a.caret.move(new g(c,2)),a.showInternalLinkSelector(),d=b.children[1],expect(b.firstChild().getText()).to.be("fi"),expect(d.getText()).to.be("@Foo"),expect(d.nextSibling().getText()).to.be("rst"),expect(d.hasModifier("bold")).to.be(!0)}),it("should not leave placeholder spans lying around",function(){a.setLinkSelector(new k("")),a.caret.move(c.first()),b.removeChild(d),c.setPlaceholder(""),a.showInternalLinkSelector(),expect(b.children.length).to.be(1),expect(b.firstChild().getText()).to.be("@")}),afterEach(function(){s(a)})}),describe("detectLinks",function(){var a,b,c,d="https://youtu.be/dQw4w9WgXcQ",e=function(a,b,c){c=c||b,expect(a.getModifier("link")).to.eql({type:"url",url:b}),expect(a.getText()).to.eql(c)};beforeEach(function(){c=new p,b=new j([c]),a=r([b])}),it("should handle spans without links correctly",function(){c.setText("Here be dragons but no URLs."),a.caret.move(c.last()),a.detectLinks(),expect(b.firstChild().hasModifier("link")).to.be(!1)}),it("should linkify one url correctly",function(){var f;c.setText(d+" "),a.caret.move(c.last()),a.detectLinks(),f=b.firstChild(),e(f,d)}),it("should linkify multiple urls correctly",function(){c.setText("google.com,http://www.facebook.com"),a.caret.move(c.last()),a.detectLinks(),expect(b.children.length).to.be(4),e(b.children[0],"http://google.com","google.com"),e(b.children[2],"http://www.facebook.com"),expect(a.caret.start.equals(b.last()))}),it("should only linkify preceding text",function(){c.setText("google.com http://www.facebook.com "),a.caret.move(new g(c,10)),a.detectLinks(),expect(b.children.length).to.be(2),e(b.children[0],"http://google.com","google.com"),expect(b.children[1].hasModifier("link")).to.be(!1)}),afterEach(function(){s(a)})}),describe("insertImages",function(){var a,b,c,d=["http://dreamatico.com/data_images/kitten/kitten-1.jpg","http://dreamatico.com/data_images/kitten/kitten-2.jpg"],e=function(a,b){expect(a).to.be.an(o),expect(a.children.length).to.be(1),expect(a.children[0].getModifier("image")).to.be(b)};beforeEach(function(){c=new p,b=new j([c]),a=r([b])}),it("should append images when at the end of a section",function(){c.setText("Here be dragons"),a.caret.move(c.last()),a.insertImages(d),expect(a.children.length).to.be(3),expect(a.children[0]).to.be(b),e(a.children[1],d[0]),e(a.children[2],d[1])}),it("should prepend images when at the beginning of a section",function(){c.setText("Here be dragons"),a.caret.move(c.first()),a.insertImages(d),expect(a.children.length).to.be(3),e(a.children[0],d[0]),e(a.children[1],d[1]),expect(a.children[2]).to.be(b)}),it("should split current section when in the middle of it",function(){c.setText("Here be dragons"),a.caret.move(new g(c,5)),a.insertImages(d),expect(a.children.length).to.be(4),expect(a.firstChild()).to.be.a(j),expect(a.firstChild().firstChild().getText()).to.eql("Here "),e(a.children[1],d[0]),e(a.children[2],d[1]),expect(a.lastChild()).to.be.a(j),expect(a.lastChild().firstChild().getText()).to.eql("be dragons")}),afterEach(function(){s(a)})})}),describe("Section",function(){describe("init",function(){it("should be initially empty",function(){var a=new j;expect(a.isEmpty()).to.be(!0),expect(a.firstChild()).to.be.a(p)})}),describe("getIndent, setIndent",function(){it("should not allow negative indent",function(){var a=new j;a.setIndent(-1),expect(a.getIndent()).to.be(0)})}),describe("deleteText",function(){var a,b,c,d;beforeEach(function(){a=new j,b=a.firstChild(),c=new p("second"),d=new p("third"),b.setText("first"),a.appendChild(c),a.appendChild(d)}),it("should delete text when in a single span",function(){a.deleteText(new g(b,0),new g(b,1)),expect(a.children.length).to.be(3),expect(b.getText()).to.be("irst"),expect(c.getText()).to.be("second"),expect(d.getText()).to.be("third")}),it("should leave at most one empty span",function(){a.deleteText(new g(b,0),new g(b,b.getLength())),expect(a.children.length).to.be(3),expect(b.isEmpty()).to.be(!0),expect(c.isEmpty()).to.be(!1),expect(d.isEmpty()).to.be(!1),a.deleteText(new g(b,0),new g(d,d.getLength())),expect(a.children.length).to.be(1),expect(a.children[0]).to.be(b)}),it("should delete spans that are completely covered",function(){a.deleteText(new g(b,1),new g(d,1)),expect(a.children.length).to.be(2),expect(a.children).to.eql([b,d]),expect(b.getText()).to.be("f"),expect(d.getText()).to.be("hird")})}),describe("changeType",function(){it("should keep children when changing types",function(){var a=new i,b=[new p("milk"),new p("eggs"),new p("butter")],c=new l(b),d;a.appendChild(c),d=c.changeType(k),expect(d instanceof k).to.be(!0),expect(d.children).to.eql(b)})}),describe("split",function(){it("should split empty sections correctly",function(){var a=new j,b=a.firstChild(),c=new i([a]),d,e;a.split(new g(b,0)),expect(c.children.length).to.be(2),d=c.children[0],e=c.children[1],expect(d.children.length).to.be(1),expect(d.firstChild().isEmpty()).to.be(!0),expect(e.children.length).to.be(1),expect(e.firstChild().isEmpty()).to.be(!0)}),it("should not create empty spans in non-empty sections",function(){var a=new j,b=a.firstChild(),c=new p("second"),d=new i([a]),e,f;b.setText("first"),a.appendChild(c),a.split(new g(b,b.getLength())),expect(d.children.length).to.be(2),e=d.children[0],f=d.children[1],expect(e.children.length).to.be(1),expect(e.firstChild().getText()).to.be("first"),expect(f.children.length).to.be(1),expect(f.firstChild().getText()).to.be("second")}),it("should retain indentation for ordered lists",function(){var a=new k,b=a.firstChild(),c=new i([a]);b.setText("first"),a.setIndent(2),a.split(new g(b,2)),expect(c.children.length).to.be(2),expect(c.children[0].getIndent()).to.be(2),expect(c.children[1].getIndent()).to.be(2)}),it("should retain indentation for unordered lists",function(){var a=new l,b=a.firstChild(),c=new i([a]);b.setText("first"),a.setIndent(2),a.split(new g(b,2)),expect(c.children.length).to.be(2),expect(c.children[0].getIndent()).to.be(2),expect(c.children[1].getIndent()).to.be(2)}),it("should retain quoted status",function(){var a=new k,b=a.firstChild(),c=new i([a]);b.setText("first"),a.setQuoted(!0),a.split(new g(b,2)),expect(c.children.length).to.be(2),expect(c.children[0].isQuoted()).to.be(!0),expect(c.children[1].isQuoted()).to.be(!0)})}),describe("merge",function(){var a,b,c,d,e;beforeEach(function(){a=new j,b=new k,c=a.firstChild(),d=b.firstChild(),e=r([a,b])}),it("should remove empty span when first section is not empty",function(){var d;c.setText("hi"),d=a.merge(b),expect(e.children).to.eql([a]),expect(a.children).to.eql([c]),expect(d).to.eql(c.last())}),it("should remove empty span when second section is not empty",function(){var c;d.setText("hi"),c=a.merge(b),expect(e.children).to.eql([a]),expect(a.children).to.eql([d]),expect(c).to.eql(d.first())}),it("should have one empty span when both sections are empty",function(){var d=a.merge(b);expect(e.children).to.eql([a]),expect(a.children).to.eql([c]),expect(a.children[0].isEmpty()).to.be(!0),expect(d).to.eql(c.first())}),it("should merge non-empty sections correctly",function(){var f;c.setText("hi"),d.setText("hello"),f=a.merge(b),expect(e.children).to.eql([a]),expect(a.children).to.eql([c,d]),expect(f).to.eql(c.last())}),it("should delete non-editable section when it is the earlier section",function(){var f;c.setText("hi"),d.setText("hello"),a.setEditable(!1),f=a.merge(b),expect(e.children).to.eql([b]),expect(b.children).to.eql([d]),expect(f).eql(b.first())}),it("should delete non-editable section when it is the later section",function(){var f;c.setText("hi"),d.setText("hello"),b.setEditable(!1),f=a.merge(b),expect(e.children).to.eql([a]),expect(a.children).to.eql([c]),expect(f).eql(a.last())}),afterEach(function(){s(e)})}),describe("_getTextPrefix",function(){var a,b,c,d,e;beforeEach(function(){a=new j,b=new k,c=a.firstChild(),d=b.firstChild(),e=new i([a,b])}),it("should use asterisks for unordered lists",function(){var a=new l;expect(a._getTextPrefix([a])).to.be("* "),a.setIndent(1),expect(a._getTextPrefix([a])).to.be("    * ")}),it("should use numbers for ordered lists",function(){var a=new k;expect(a._getTextPrefix([a])).to.be("1. "),a.setIndent(1),expect
(a._getTextPrefix([a])).to.be("    1. ")}),it("should set numbering correctly for ordered lists",function(){var a=new k,b=new k,c=new k;new i([a,b]),expect(a._getTextPrefix([a])).to.be("1. "),expect(b._getTextPrefix([a,b])).to.be("2. "),expect(b._getTextPrefix([b])).to.be("1. "),b.setIndent(1),expect(b._getTextPrefix([a,b])).to.be("    1. "),expect(c._getTextPrefix([a,b,c])).to.be("2. ")})}),describe("_getHTMLPrefix",function(){var a,b,c,d,e,f;beforeEach(function(){a=new j,b=new k,c=new k,d=new l,e=new l,f=new i([a,b,c,d,e])}),it("should generate correct HTML for unordered lists",function(){expect(e._getHTMLPrefix([d,e])).to.be("<li>"),e.setIndent(1),expect(e._getHTMLPrefix([d,e])).to.be("<ul><li>")}),it("should generate correct HTML for ordered lists",function(){expect(c._getHTMLPrefix([b,c])).to.be("<li>"),c.setIndent(1),expect(c._getHTMLPrefix([b,c])).to.be("<ol><li>")})}),describe("_getHTMLSuffix",function(){var a,b,c,d,e,f;beforeEach(function(){a=new j,b=new k,c=new k,d=new l,e=new l,f=new i([a,b,c,d,e])}),it("should generate correct HTML for unordered lists",function(){expect(e._getHTMLSuffix([d,e])).to.be("</li></ul>"),e.setIndent(1),expect(e._getHTMLSuffix([d,e])).to.be("</li></ul></ul>")}),it("should generate correct HTML for ordered lists",function(){expect(c._getHTMLSuffix([b,c])).to.be("</li></ol>"),c.setIndent(1),expect(c._getHTMLSuffix([b,c])).to.be("</li></ol></ol>")})})}),describe("Span",function(){describe("init",function(){it("should be initially empty",function(){var a=new p;expect(a.isEmpty()).to.be(!0)}),it("should set text when specified",function(){var a="Who goÃ©s there?",b=new p(a);expect(b.getText()).to.be(a)}),it("should set modifiers when specified",function(){var a=new p;expect(a.hasModifier("bold")).to.be(!1),a=new p("",{bold:!0}),expect(a.hasModifier("bold")).to.be(!0)})}),describe("previous, next",function(){var a,b,c,d,e;beforeEach(function(){a=new j,b=new k,c=a.firstChild(),d=b.firstChild(),e=new p("hi"),b.appendChild(e),new i([a,b])}),it("should return previous spans in the document",function(){expect(c.previous()).to.be(null),expect(d.previous()).to.be(c),expect(e.previous()).to.be(d)}),it("should return next spans in the document",function(){expect(c.next()).to.be(d),expect(d.next()).to.be(e),expect(e.next()).to.be(null)})}),describe("addModifier, removeModifier, hasModifier",function(){var a;beforeEach(function(){a=new p("hi"),expect(a.hasModifier("bold")).to.be(!1)}),it("should add modifier",function(){a.setModifier("bold",!0),expect(a.hasModifier("bold")).to.be(!0)}),it("should remove modifier",function(){a.setModifier("bold",!0),a.removeModifier("bold"),expect(a.hasModifier("bold")).to.be(!1)}),it("should add a css class for each modifier",function(){a.setModifier("bold",!0),a.setModifier("italic",!0),a.setModifier("link",!0),expect(a.node.classList.contains("bold")).to.be(!0),expect(a.node.classList.contains("italic")).to.be(!0),expect(a.node.classList.contains("link")).to.be(!0)})}),describe("getText, setText, deleteText, getLength",function(){it("should set text correctly",function(){var a="BeyoncÃ©",b=new p;b.setText(a),expect(b.getText()).to.be(a),expect(b.getLength()).to.be(a.length)}),it("should delete text correctly",function(){var a="123456",b=new p(a);b.deleteText(2,4),expect(b.getText()).to.be("1256"),expect(b.getLength()).to.be(4)})}),describe("isEmpty",function(){it("should be empty when text is deleted",function(){var a=new p("To be or not to be");expect(a.isEmpty()).to.be(!1),a.deleteText(0,a.getLength()),expect(a.isEmpty()).to.be(!0)}),it("should be empty when set as placeholder",function(){var a=new p("hi");expect(a.isEmpty()).to.be(!1),a.setPlaceholder(),expect(a.isEmpty()).to.be(!0)})}),describe("getFocusNode",function(){it("should give focus to text when non-empty",function(){var a=new p("hi"),b=a.getFocusNode(0);expect(f.isTextNode(b)).to.be(!0),b=a.getFocusNode(3),expect(f.isTextNode(b)).to.be(!0)}),it("should give focus to content node when empty",function(){var a=new p,b=a.getFocusNode(0);expect(f.isTextNode(b)).to.be(!1)}),it("should give focus to content node when placeholder",function(){var a=new p("hi"),b;a.setPlaceholder(),b=a.getFocusNode(0),expect(f.isTextNode(b)).to.be(!1)})}),describe("split",function(){var a,b;beforeEach(function(){var b=new j;a=b.firstChild()}),it("should create new empty span when empty",function(){b=a.split(0),expect(a.isEmpty()).to.be(!0),expect(b.isEmpty()).to.be(!0)}),it("should become empty when split at front",function(){var c="To be or not to be";a.setText(c),b=a.split(0),expect(a.isEmpty()).to.be(!0),expect(b.isEmpty()).to.be(!1)}),it("should split text at correct offset",function(){var c="To be or not to be";a.setText(c),b=a.split(9),expect(a.getText()).to.be("To be or "),expect(b.getText()).to.be("not to be")}),it("should copy modifiers when splitting",function(){a.setText("hi"),a.setModifier("bold",!0),a.setModifier("italic",!0),b=a.split(3),expect(b.hasModifier("bold")).to.be(!0),expect(b.hasModifier("italic")).to.be(!0),expect(b.hasModifier("link")).to.be(!1)}),it("should not split link spans by default",function(){a.setText("quora"),a.setModifier("link",{url:"/Quora"}),b=a.split(2),expect(b).to.be(a),expect(a.parent.children.length).to.be(1),b=a.split(2,!0),expect(a.parent.children.length).to.be(2)}),afterEach(function(){expect(a.nextSibling()).to.be(b)})}),describe("_toText",function(){var a=new p("words");expect(a._toText()).to.be("words"),a.setModifier("bold",!0),expect(a._toText()).to.be("**words**"),a.removeModifier("bold"),a.setModifier("italic",!0),expect(a._toText()).to.be("*words*"),a.removeModifier("italic"),a.setModifier("underline",!0),expect(a._toText()).to.be("_words_"),a.removeModifier("underline")})})}},{"qtext2/util":!0,"qtext2/base":!0,"qtext2/ui":!0})}),require.whenReady("settings",function(){require.install("qtext2/tests/test_parser",function(require,a,b){var c=require("qtext2/parser").parseHTML,d=require("qtext2/parser").parseText,e=require("qtext2/base"),f=e.PlainSection,g=e.OrderedListSection,h=e.UnorderedListSection,i=e.CodeSection,j=e.ImageSection,k=e.VideoSection;a.suite=function(){describe("parseHTML",function(){var a=["link","style"],b=["b","i","u","em"],d={b:"bold",i:"italic",u:"underline",em:"italic"},e=["h1","h2","h3","h4","h5"],k=["p","div"];a.forEach(function(a){it("should ignore "+a+" tags",function(){var b="<"+a+"></"+a+">",d=c(b);expect(d.length).to.be(0)})}),it("should ignore meta tags",function(){var a='<meta charset="utf-8">',b=c(a);expect(b.length).to.be(0)}),it("should ignore comment tags",function(){var a="<!--[if gte mso 9]><xml></xml><![endif]-->",b=c(a);expect(b.length).to.be(0)}),it("should parse top-level plain text",function(){var a="Text",b=c(a),d;expect(b.length).to.be(1),d=b[0],expect(d).to.be.a(f),expect(d.children.length).to.be(1),expect(d.firstChild().getText()).to.be("Text")}),b.forEach(function(a){it("should parse top-level "+a+" tags",function(){var b="<"+a+">formatted</"+a+">plain",e=c(b),g=d[a],h,i;expect(e.length).to.be(1),h=e[0],expect(h).to.be.a(f),expect(h.children.length).to.be(2),i=h.children[0],expect(i.getText()).to.be("formatted"),expect(i.hasModifier(g)).to.be(!0),i=h.children[1],expect(i.getText()).to.be("plain"),expect(i.hasModifier(g)).to.be(!1)})}),e.forEach(function(a){it("should parse top-level "+a+" tags as sections",function(){var b="<"+a+">Title</"+a+">",d=c(b),e;expect(d.length).to.be(1),expect(d[0]).to.be.a(f),expect(d[0].children.length).to.be(1),e=d[0].firstChild(),expect(e.getText()).to.be("Title"),expect(e.hasModifier("bold")).to.be(!0)})}),k.forEach(function(a){it("should treat "+a+"s as paragraphs",function(){var b="<"+a+">one</"+a+"><"+a+">two</"+a+">",d=c(b);expect(d.length).to.be(2),expect(d[0]).to.be.a(f),expect(d[1]).to.be.a(f)})}),it("should convert OLs to lists correctly",function(){var a="<ol><li>one</li><ol><li>two</li></ol></ol>",b=c(a);expect(b.length).to.be(2),expect(b[0]).to.be.a(g),expect(b[1]).to.be.a(g),expect(b[0].getIndent()).to.be(0),expect(b[1].getIndent()).to.be(1)}),it("should convert ULs to lists correctly",function(){var a="<ul><li>one</li><ul><li>two</li></ul></ul>",b=c(a);expect(b.length).to.be(2),expect(b[0]).to.be.a(h),expect(b[1]).to.be.a(h),expect(b[0].getIndent()).to.be(0),expect(b[1].getIndent()).to.be(1)}),it("should convert mixed OLs and ULs to lists correctly",function(){var a="<ul><li>one</li><ol><li>two</li></ol></ul>",b=c(a);expect(b.length).to.be(2),expect(b[0]).to.be.a(h),expect(b[1]).to.be.a(g),expect(b[0].getIndent()).to.be(0),expect(b[1].getIndent()).to.be(1)}),it("should collapse whitespace correctly",function(){var a="Â ",b="one\n\n\ntwo"+a+"three\r\nfour",d=c(b);expect(d.length).to.be(1),expect(d[0].children.length).to.be(1),expect(d[0].firstChild().getText()).to.be("one two three four")}),it("should ignore extraneous newlines",function(){var a="<p>one</p>\n\n\n<p>two</p>",b=c(a);expect(b.length).to.be(2),expect(b[0].children.length).to.be(1),expect(b[0].firstChild().getText()).to.be("one"),expect(b[1].children.length).to.be(1),expect(b[1].firstChild().getText()).to.be("two")}),it("should not ignore top-level text",function(){var a="one<p>two</p>three",b=c(a);expect(b.length).to.be(3),expect(b[0].children.length).to.be(1),expect(b[0].firstChild().getText()).to.be("one"),expect(b[1].children.length).to.be(1),expect(b[1].firstChild().getText()).to.be("two"),expect(b[2].children.length).to.be(1),expect(b[2].firstChild().getText()).to.be("three")}),it("should treat span tags as inline text",function(){var a="<span>one</span><p><span>two</span>three</p>",b=c(a);expect(b.length).to.be(2),expect(b[0].children.length).to.be(1),expect(b[0].firstChild().getText()).to.be("one"),expect(b[1].children.length).to.be(2),expect(b[1].firstChild().getText()).to.be("two"),expect(b[1].lastChild().getText()).to.be("three")}),it("should parse code tags as inline code spans",function(){var a="<span>one</span><code>two</code>",b=c(a);expect(b.length).to.be(1),expect(b[0]).to.be.a(f),expect(b[0].children.length).to.be(2),expect(b[0].firstChild().getText()).to.be("one"),expect(b[0].firstChild().hasModifier("code")).to.be(!1),expect(b[0].lastChild().getText()).to.be("two"),expect(b[0].lastChild().hasModifier("code")).to.be(!0)}),it("should parse pre tags as code sections",function(){var a="<pre>one<span>two</span></pre>",b=c(a);expect(b.length).to.be(1),expect(b[0]).to.be.a(i),expect(b[0].children.length).to.be(2),expect(b[0].firstChild().getText()).to.be("one"),expect(b[0].firstChild().hasModifier("code")).to.be(!1),expect(b[0].lastChild().getText()).to.be("two"),expect(b[0].lastChild().hasModifier("code")).to.be(!1)}),it("should parse img tags as image sections",function(){var a="http://dreamatico.com/data_images/kitten/kitten-2.jpg",b='<img src="'+a+'"/>',d=c(b);expect(d.length).to.be(1),expect(d[0]).to.be.an(j),expect(d[0].children.length).to.be(1),expect(d[0].firstChild().getModifier("image")).to.be(a)})}),describe("parseText",function(){it("should convert lines to sections",function(){var a="one\ntwo",b=d(a);expect(b.length).to.be(2),expect(b[0].children.length).to.be(1),expect(b[0].firstChild().getText()).to.be("one"),expect(b[1].children.length).to.be(1),expect(b[1].firstChild().getText()).to.be("two")}),it("should handle newlines on all platforms",function(){var a="one\ntwo\r\nthree\rfour",b=d(a);expect(b.length).to.be(4),expect(b[0].children.length).to.be(1),expect(b[0].firstChild().getText()).to.be("one"),expect(b[1].children.length).to.be(1),expect(b[1].firstChild().getText()).to.be("two"),expect(b[2].children.length).to.be(1),expect(b[2].firstChild().getText()).to.be("three"),expect(b[3].children.length).to.be(1),expect(b[3].firstChild().getText()).to.be("four")}),it("should convert youtube links to video sections",function(){var a="8C-hQleMFhY",b="https://youtu.be/"+a,c="https://www.youtube.com/watch?v="+a,e=[b,c].join("\n"),f=d(e);expect(f.length).to.be(2),expect(f[0]).to.be.a(k),expect(f[0].firstChild().getModifier("video")).to.eql(b),expect(f[1]).to.be.a(k),expect(f[1].firstChild().getModifier("video")).to.eql(c)})})}},{"qtext2/parser":!0,"qtext2/base":!0})}),require.whenReady("settings",function(){require.install("qtext2/tests/main",function(require,a,b){var c=require("qtext2/tests/test_util"),d=require("qtext2/tests/test_base"),e=require("qtext2/tests/test_parser");a.runTests=function(){mocha.setup({ui:"bdd",ignoreLeaks:!0}),describe("util",c.suite),describe("base",d.suite),describe("parser",e.suite),mocha.run()}},{"qtext2/tests/test_util":!0,"qtext2/tests/test_parser":!0,"qtext2/tests/test_base":!0})}),require.whenReady("settings",function(){require.install("unified_view/qtext2/editor",function(require,a,b){var c=require("interface/component").Component,d=require("qtext2/util").Util,e=require("qtext2/base").Doc,f=require("interface/settings").pageIsMobile,g=require("qtext2/ui"),h=require("unified_view/upload"),i=require("qtext2/tests/main").runTests,j=require("settings").interface_strings,k,l,m=require;f?k=m("mobile_app2/client"):l=m("window_manager");var n=function(a,b,c,e){var f=function(){b.innerHTML=e.drop_images,b.classList.remove("hidden"),b.style.lineHeight=a.node.clientHeight+"px"},g=function(){b.classList.remove("uploading"),b.classList.add("hidden")},i=function(a){f(),a>1?b.innerHTML=e.uploading_images.replace("{}",a):b.innerHTML=e.uploading_image},j=function(b){a.saveState(),a.insertImages(b),g()},k=function(a){a1ert(a||e.upload_error),g()},l=function(a){a.length?(i(a.length),h.uploadImages("qtext",a,j,k)):g()};d.on("dragenter",a.node,f),d.on("dragleave",b,g),d.on("dragover",b,function(a){a.preventDefault()}),d.on("drop",b,function(a){a.preventDefault(),a.stopPropagation();if(!a.dataTransfer){g();return}l(a.dataTransfer.files)}),d.on("change",c,function(){l(c.files)}),d.on("paste",a.node,function(a){var b=a.clipboardData,c=[];if(!b||!b.items)return!1;for(var d=0;d<b.items.length;++d){var e=b.items[d].type;(e.match(/image/i)||e.match(/file/i))&&c.push(b.items[d].getAsFile())}return l(c),!1})},o=g.LinkSelector.extend({__init__:function(a,b,c){var d=this;this.toolbar=a,this.$linkInput=this.toolbar.$id("@link_input"),this.$isCitation=this.toolbar.$id("@is_citation"),this.$selector=b,this.$wrapper=c,this.$linkInput.on("keydown",function(a){if(a.which==13)return d._invokeLinkInputCallback(),!1;if(a.which==27)return d.$linkInput.val(""),d._invokeLinkInputCallback(),!1}),this.toolbar.$id("@link_save").on("click",function(){return d._invokeLinkInputCallback(),!1})},_invokeLinkInputCallback:function(){this._linkInputCallback&&(this._linkInputCallback(this.$linkInput.val(),this.$isCitation.attr("checked")=="checked"),this._linkInputCallback=null)},show:function(a,b){var c;f?k.sendMessageToClient("openURL",{url:"/qtext2/mobile_add_link",target:"modal"}):(c=this.$wrapper.parent().offset(),a-=c.left,b-=c.top,this.$selector.clearInput(),this.$wrapper.css("position","absolute").css("left",a).css("top",b).removeClass("hidden"),this.$selector.focus(!0))},hide:function(){f||this.$wrapper.addClass("hidden")},onSubmit:function(a){var b=this;f?k.registerMessageHandler("addLinkSelectorPressed",a):b.$selector.setCallback(function(){a({text:b.$selector.result.value,url:b.$selector.result.url})})},onCancel:function(a){var b=this;f||b.$selector.setEscKeyDown(function(c){var d="@"+b.$selector.getValue();if(c.keyCode==27||d==="@"&&(c.keyCode==8||c.keyCode==13))return a(d),!1})},getExternalURL:function(a){this._linkInputCallback=a,this.toolbar.showBar(0)}});a.Editor=c.extend({onLoad:function(){var a=this;this.toolbar=this.child("toolbar"),this.doc=new e,this.doc.fromJSON(this.content_json),n(this.doc,this.$id("@drop_zone").get(0),this.$id("@file").get(0),this.interface_strings),this.doc.setLinkSelector(new o(this.toolbar,this.child("link_selector"),this.unsafe$id("@link_selector_wrapper"))),this.toolbar.on("click",function(b){b=="image"?a.unsafe$id("@file").click():b=="link_hide"?a.toolbar.showBar(1):b=="overflow_show"?a.toolbar.showBar(2):b=="overflow_hide"?a.toolbar.showBar(1):a.doc.handleCommand(b)}),this.toolbar.on("imageUpload",function(b){a.doc.insertImages(b)}),this.unsafe$id("@doc").append(this.doc.node),this.doc.node.addEventListener("focus",function(){a.toolbar.makeActive(a.doc)}),this.focus(),this.$id("@fake_editor").on("click",this.hideFakeEditor.bind(this)),this._setupEventListeners()},_setupEventListeners:function(){var a=this;this.doc.on("focus",function(){a._onFocus&&a._onFocus()}),this.doc.on("blur",function(){a._onBlur&&a._onBlur()}),this.doc.on("meaningfulChange",function(){a._onMeaningfulChange&&a._onMeaningfulChange()}),this._trackTypingState()},_trackTypingState:function(){var a=this,b=1e4,c=55e3,d="empty",e=0,f=0,g,h=function(){var i,j,k=(new Date).getTime();a.isEmpty()?i="empty":(e<k-b?i="paused":i="typing",f<k-c&&(j=!0)),i!=d&&(j=!0),j&&a._onTypingStateChange&&(a._onTypingStateChange(i),d=i,f=k),g&&(clearTimeout(g),g=null);if(i=="typing"||i=="paused")g=setTimeout(h,b)};this.doc.on("keydown",function(){e=(new Date).getTime(),h()})},setFocusCallback:function(a){this._onFocus=a},setBlurCallback:function(a){this._onBlur=a},setMeaningfulChangeCallback:function(a){this._onMeaningfulChange=a},setTypingStateCallback:function(a){this._onTypingStateChange=a},isInteractive:function(){return!0},isEmpty:function(){return this.doc.isEmpty()},stopTyping:function(){},fixEditorButtons:function(){this.toolbar.fix()},focus:function(){this.doc.node.focus()},hideFakeEditor:function(){this.$id("@fake_editor").addClass("hidden"),this.$id("@editor").removeClass("hidden"),this.focus(),this.fixEditorButtons()},serialize:function(){return this.doc.toJSON()},hasChanged:function(a){return this.doc.hasChanged(a)}}),a.Answer=a.Editor.extend({onLoad:function(){this._super.apply(this,arguments),this.setupKeyboardShortcuts()},setAnswerLaterCallback:function(a){this.$id("@answer_later_link").on("click",a)},setupKeyboardShortcuts:function(){var a=this,b=this.unsafe$id("@editor_outer");this.onKeyCombination(b,"a",function(){return l.scrollIntoView(b),a.hideFakeEditor(),!1}),this.onKeyCombination(b,"Escape",function(){a.doc.node.blur();var c=b;while(c.get(0)!==document.body&&!c.hasClass("kbfocusable"))c=c.parent();return c.click().focus(),!1},null,!0)}}),a.MobileLinkSelector=c.extend({onLoad:function(){k.sendMessageToClient("showSearchInput",{searchPlaceholderText:"Find Questions, People, and Topics",searchFocus:!0,searchCancelButton:!1})}}),a.MobileEditorMain=c.extend({onLoad:function(){var b=this;this.editor=this.lookup("editor"),k.sendMessageToClient("setupEditor"),k.sendMessageToClient("restoreState",{key:b._getKey()}),k.setNavigationButton({text:j.done,style:"done",callback:function(){b.submit()}}),this.editor.setFocusCallback(function(){a.activeEditor=b}),this.editor.setMeaningfulChangeCallback(this.saveState.bind(this))},saveState:function(){k.sendMessageToClient("saveState",{key:this._getKey(),value:this.editor.serialize()})},restoreState:function(a){if(a.key!=this._getKey()){console.error("Mismatching key:",a);return}this.editor.doc.fromJSON(a.value)},submit:undefined}),a.MobileWriteAnswerMain=a.MobileEditorMain.extend({submit:function(){this.serverCall("submit").kwargs({qid:this.qid,content:this.editor.serialize()}).success(function(){k.sendMessageToClient("dismissModal")}).send()},_getKey:function(){return this.qid}}),a.TestMain=c.extend({onLoad:function(){i()}}),a.activeEditor=null},{"interface/settings":!0,"interface/component":!0,"qtext2/base":!0,settings:!0,"qtext2/util":!0,"unified_view/upload":!0,"qtext2/tests/main":!0,"qtext2/ui":!0})}),require.whenReady("settings",function(){require.install("qtext2",function(require,a,b){var c=require("unified_view/qtext2/editor"),d=require("unified_view/qtext2/toolbar");a.handleToolbarAction=function(a,b){d.activeToolbar&&d.activeToolbar.trigger(a,b)},a.handleRestoreState=function(a){console.log(a),c.activeEditor.restoreState(a)},a.saveDraft=function(){c.activeEditor.saveDraft()},a.clearDraft=function(){c.activeEditor.clearDraft()}},{"unified_view/qtext2/toolbar":!0,"unified_view/qtext2/editor":!0})}),require.whenReady("settings",function(){require.install("unified_view/qtext2/toolbar",function(require,a,b){var c=require("interface/component").Component,d=require("interface/settings").pageIsMobile,e=require("qtext2"),f=require("qtext2/util").Util,g=require,h;d&&(h=g("mobile_app2/client"));var i=c.extend({onLoad:function(){this._barIdx=1},on:function(a,b){this._handlers=this._handlers||[],this._handlers[a]=b},trigger:function(a,b){this._handlers[a]&&this._handlers[a](b)},makeActive:function(b){this.showBar(1),this._doc=b,this._startUpdating(),a.activeToolbar=this},makeInactive:function(){this._doc=null,a.activeToolbar=null},showBar:function(a){this._barIdx=a,this._animation=!0},_startUpdating:function(){var a=this,b=function(){a._doc&&(a.update(a._doc.getToolbarState(a._barIdx),a._animation),a._animation=!1,requestAnimationFrame(b))};b()},update:function(a,b){if(f.jsonEqual(a,this.currentState))return;this._update(a,b),this.currentState=a},_update:null});a.Web=i.extend({onLoad:function(){this._super.apply(this,arguments);var a=this;a.buttons.forEach(function(b){var c=b=="image"?"click":"touchstart mousedown";a.$id("@"+b).on(c,function(){return a.trigger("click",b),!1})}),a.fix()},_update:function(a,b){var c=this,d,e=this.unsafe$id("@bar"+this._barIdx),f=c.unsafe$id("@storage"),g=e.children(".left"),h=c.unsafe$id("@scroller");e.find(".modifier").each(function(a,b){f.append(b)}),a.forEach(function(a){a.name=="space"?g=e.children(".right"):(d=c.unsafe$id("@"+a.name),d.removeClass("disabled"),d.removeClass("pressed"),a.disabled?d.addClass("disabled"):a.pressed&&d.addClass("pressed"),g.append(d),a.focused&&d.focus())}),b?h.addClass("animate"):h.removeClass("animate"),this._barIdx===0?(h.removeClass("one"),h.removeClass("two"),h.addClass("zero")):this._barIdx===1?(h.removeClass("zero"),h.removeClass("two"),h.addClass("one")):this._barIdx===2&&(h.removeClass("zero"),h.removeClass("one"),h.addClass("two"))},fix:function(){var a=this.unsafe$id("@toolbar"),b=a.parent(),c=$(".SiteHeader").height(),d=function(){var e=b.offset().top-document.body.scrollTop-c,f=e+b.height()-a.height()*2;e<0&&f>0?(a.css("position","fixed"),a.css("top",c),a.css("left",b.offset().left),a.css("width",b.width())):(a.css("position","absolute"),a.css("top",0),a.css("left",0),a.css("width","")),window.requestAnimationFrame(d)};d()}}),a.activeToolbar=null;var j=this;a.MobileWebShim=a.Web.extend({onLoad:function(){this._super.apply(this),j=this},trigger:function(a,b){e.handleToolbarAction(a,b)},fix:function(){var a=this.unsafe$id("@toolbar"),b=function(){document.body.scrollTop>0?(a.css("position","absolute"),a.css("top",document.body.scrollTop+"px")):(a.css("position",""),a.css("top","")),window.requestAnimationFrame(b)};b()}}),a.updateMobileWebShim=function(a){if(j){var b=1;for(var c=0;c<a.buttons.length;c++){if(a.buttons[c].name=="link_input"){b=0;break}if(a.buttons[c].name=="undo"){b=2;break}}j.showBar(b),j.update(a.buttons,a.animation)}},a.Mobile=i.extend({makeActive:function(){this._super.apply(this,arguments)},_update:function(a,b){h.sendMessageToClient("updateToolbar",{buttons:a,animation:b})}})},{qtext2:!0,"interface/settings":!0,"interface/component":!0,"qtext2/util":!0})}),require.whenReady("settings",function(){require.install("unified_view/character_counter",function(require,a,b){var c=require("interface/component").Component;a.CharacterCounter=c.extend({updateCounter:function(a){var b=this,c=b.$id("@counter");b.left=parseInt(b.limit)-a,c.text(b.left),c.toggleClass("warning",b.left<=b.warning_limit),b.updateVisibility()},updateVisibility:function(){this.left<this.visible_on?this.show():this.hide()},show:function(){this.left<this.visible_on&&this.$id("@counter").removeClass("fade_out")},hide:function(){this.left>=0&&this.$id("@counter").addClass("fade_out")}})},{"interface/component":!0})}),require.whenReady("settings",function(){require.install("unified_view/main",function(require,a,b){!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0},{"unified_view/action_bar/overflow_menu/base":!0,"unified_view/payment/_payment":!0,"unified_view/action_bar/shared":!0,"unified_view/button/downvote":!0,"unified_view/action_bar/overflow_menu/answer":!0,"unified_view/button/write_answer":!0,"unified_view/network/invite":!0,"unified_view/action_bar/base":!0,"unified_view/action_bar/user":!0,"unified_view/bounty/writer":!0,"unified_view/qtext":!0,"unified_view/translation":!0,"unified_view/action_bar/overflow_menu/profile":!0,"unified_view/toggle":!0,"unified_view/action_bar/answer":!0,"unified_view/button/network":!0,"unified_view/button/writing_list":!0,"unified_view/button/slow_connection":!0,"unified_view/network/join":!0,"unified_view/action_bar/remove_from_feed":!0,"unified_view/button/reask":!0,"unified_view/action_bar/_action_bar":!0,"unified_view/button/upvote":!0,"unified_view/settings/privacy":!0,"unified_view/qtext2/toolbar":!0,"unified_view/action_bar/overflow_menu/question":!0,"unified_view/lazy":!0,"unified_view/payment/money":!0,"unified_view/switch":!0,"unified_view/qtext2/editor":!0,"unified_view/action_bar/question":!0,"unified_view/button/abstract":!0,"unified_view/character_counter":!0,"unified_view/action_bar/blog":!0,"unified_view/action_bar/overflow_menu/remove_from_feed":!0,"unified_view/mobile_debug":!0,"unified_view/privacy":!0,"unified_view/button/pin":!0,"unified_view/util":!0,"unified_view/modal":!0,"unified_view/action_bar/overflow_menu/shared":!0,"unified_view/bounty/manage":!0,"unified_view/button/follow":!0})}),require.whenReady("settings",function(){require.install("unified_view/captcha",function(require,a,b){var c=require("interface/component").Component,d=require("w2.context").CaptchaInput,e=[],f=!1,g=function(a){f===!1?e.push(a):a.render()};a.captchaLoaded=function(){f=!0,e.map(g)},a.CaptchaInput=c.extend({onLoad:function(){var a=this;a._isGrecaptchaReady=!1,a.captchaContext=a.getContext(d),a.captchaContext.on("sync",function(b,c){var d=a.getCaptchaResponse();a.captchaContext.set("captchaResponse",d),a.captchaContext.set("isCaptchaFilled",d!==""&&d!=="random string"),c===!0&&a.maybeAddValidationText()}),a.renderedId=null,g(a)},getCaptchaResponse:function(){var a=this;return a.renderedId!==null&&f===!0?grecaptcha.getResponse(a.renderedId):""},render:function(){var a=this,b=function(){a.captchaContext.set("sync",!0)},c=a.$id("@captcha"),d=c.get()[0];a.renderedId=grecaptcha.render(d.id,{sitekey:a.recaptcha_key,theme:"light",callback:b,"expired-callback":b})},maybeAddValidationText:function(){var a=this,b=a.getCaptchaResponse();b===""?a.$id("@captcha_validation_text").text(a.missing_captcha_text):a.$id("@captcha_validation_text").text("")}})},{"interface/component":!0,"w2.context":!0})}),require.whenReady("settings",function(){require.install("app/view/ama",function(require,a,b){var c=require("interface/settings").pageIsMobile,d=require("unified_view/modal").ModalBase,e=require;if(!c)var f=e("webnode2"),g=f.ModalWithCallBacks;var h=require("w2.quora").Component,i=require("view/fixable2"),j=require("view/selector").ServerCallSelector;a.AMAAddQuestionSelector=j.extend({onLoad:function(){var a=this;a._super.apply(a,arguments),a.questionMarkInserted=!1},serverCallHandler:function(a,b){this._super.apply(this,arguments),this.setQuery("")},resultsServerCallHandler:function(){this._super.apply(this,arguments),this.$input.focus()},updateResults:function(){var a=this;a._busy||(a.setBusy(!0),a.serverCall("results_content_for").contentFor(a.$results,{parentCID:a.cid}).kwargs({query:a.query}).success(a.fnbind(a.resultsServerCallHandler)).except(a.fnbind(a.resultsServerCallHandler)).error(a.fnbind(a.resultsServerCallHandler)).send())},createNewQuestion:function(){var a=this;if(a.hasPendingServerCall())return;a.makeServerCall(a.serverCall("create_new_question").kwargs({input_text:a.query}).liveMutate())},pickExistingQuestion:function(a){var b=this;if(b.hasPendingServerCall())return;b.makeServerCall(b.serverCall("pick_existing_question").kwargs({qid:a}))},maybeInsertQuestionMark:function(){if(this.query==="?"&&this.questionMarkInserted){this.setQuery(""),this.questionMarkInserted=!1;return}if(!this.query){this.questionMarkInserted=!1;return}if(this.questionMarkInserted)return;this.query.match(/[?]$/)===null&&(this.questionMarkInserted=!0,this.setQuery(this.query+"?"))},queryDidChange:function(){this._super.apply(this,arguments),this.maybeInsertQuestionMark()},resultWasSelected:function(a){switch(a.ty){case"question":this.pickExistingQuestion(a.data.qid);break;case"create_question":this.createNewQuestion()}}}),a.AMAQuestionAddHeader=h.extend({onLoad:function(){i.makeFixable(this.$("#@question_add_header"),{scroll_dep:!0})}}),a.AMAWriterStats=h.extend({onLoad:function(){i.makeFixable(this.$("#@writer_stats"),{scroll_dep:!0})}}),a.AMAMetricGraph=h.extend({onLoad:function(){var a=new Rickshaw.Graph({element:this.$("#@rsgraph").get(0),series:[{color:"steelblue",data:this.series_data}],width:150,height:40,interpolation:"basis",renderer:"line"});a.render()}}),a.FinishSessionButton=h.extend({onLoad:function(){var a=this;this.$("#@finish_session_button").click(function(){var b={ama_id:a.ama_id},c=new g(a,{kwargs:b});c.load("finish_session_confirm")})}}),a.FinishSessionConfirmModal=d.extend({onSubmit:function(){var a=this,b=a._super;b.apply(a),a.serverCall("finish_session").success(function(){window.location.replace(a.redirect_url)}).send()}})},{"view/selector":!0,"interface/settings":!0,"unified_view/modal":!0,"view/fixable2":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.install("view/wikipedia_demand",function(require,a,b){var c=require("w2.quora").Component;a.WikipediaFAQEnabledComponent=c.extend({onLoad:function(){this.$("#@faq_enable_link").click(this.fnbind(function(a){a.preventDefault(),this.serverCall("enable_faq").send()}))}})},{"w2.quora":!0})}),require.whenReady("settings",function(){require.install("app/view/tribes",function(require,a,b){var c=require("w2.quora").Component,d=require("cookies"),e=require("linkify"),f=require("w2.context").TribeChat,g=require("view/modal").Base;a.allMessageListComponents={},a.notifyMessageListComponent=function(b){b.channel_id in a.allMessageListComponents&&a.allMessageListComponents[b.channel_id].addMessage(b)},a.TribeChat=c.extend({contextConstructor:function(){return f},onLoad:function(){var a=this;this.tribeChatContext=this.getContext(f);var b=d.cookie(a.getCookieName())&&d.cookie(a.getCookieName())=="1";b&&a.tribeChatContext.set("minimized",!0),a.$("#@title").click(function(){a.tribeChatContext.get("minimized")===!1?a.hidePopup():a.showPopup()}),a.$("#@title_link").click(function(a){a.stopPropagation()}),a.tribeChatContext.set("unreadMessageCount",a.unread_count),a.tribeChatContext.on("unreadMessageCount",function(b,c){a.updateUnreadCount(c)})},getCookieName:function(){return this.cookie_prefix+String(this.channel_id)},updateUnreadCount:function(a){a===0?this.$("#@unread_badge").addClass("hidden"):(this.$("#@unread_badge").removeClass("hidden"),this.$("#@unread_badge").text(a))},hidePopup:function(){this.tribeChatContext.set("minimized",!0),d.cookie(this.getCookieName(),"1")},showPopup:function(){this.tribeChatContext.set("minimized",!1),d.cookie(this.getCookieName(),"0")}}),a.MessageList=c.extend({onLoad:function(){var b=this;this.tribeChatContext=this.getContext(f),b.pageTitle=document.title,a.allMessageListComponents[b.channel_id]=b,b.sortMessages(),b.renderMessageList(),b.tribeIsSeen=!1,b.notifyBrowserTab(),setTimeout(function(){b.initSeenDetection()},100),b.tribeChatContext.on("minimized",function(a,c){c===!0?b.$("#@messages").addClass("hidden"):(b.$("#@messages").removeClass("hidden"),b.scrollMessageList())})},sortMessages:function(){this.messages.sort(function(a,b){return a.time-b.time})},getCookieName:function(){return"tv-"+String(this.channel_id)},getCurrentTime:function(){return(new Date).getTime()*1e3},getUser:function(a){var b=$.grep(this.users,function(b){return b.uid==a});return b[0]},initSeenDetection:function(){var a=this;a.$("#@messages").on("wheel click",function(){clearTimeout(a.unseenTimer),a.markTribeAsSeen(a.getCurrentTime())}),a.tribeChatContext.on("messageBoxFocused",function(b,c){c===!0&&(clearTimeout(a.unseenTimer),a.markTribeAsSeen(a.getCurrentTime()))})},startUnseenTimer:function(){var a=this;a.unseenTimer=setTimeout(function(){a.markTribeAsUnseen()},1e4)},notifyBrowserTab:function(){var a=this;a.notifyBrowserInterval=setInterval(function(){var b=a.tribeChatContext.get("unreadMessageCount");if(b===0)return;if($('link[rel="shortcut icon"').length===0){var c='<link type="image/x-icon" rel="shortcut icon"href="'+a.favicon_url+'">';$("head").append(c)
}document.title==a.pageTitle?b==1?document.title="1 New Message":document.title=b+" New Messages":document.title=a.pageTitle},2e3)},resetBrowser:function(){var a=this;document.title=a.pageTitle;if($('link[rel="shortcut icon"').length>0){var b="/static/images/favicon.ico";$('link[rel="shortcut icon"').attr("href",b)}clearInterval(a.notifyBrowserInterval)},markTribeAsUnseen:function(){this.tribeIsSeen=!1,this.notifyBrowserTab(),this.tribeChatContext.set("messageBoxFocused",!1)},markTribeAsSeen:function(a){this.tribeIsSeen=!0,this.tribeChatContext.set("unreadMessageCount",0),this.startUnseenTimer(),this.resetBrowser(),this.serverCall("mark_channel_as_seen").kwargs({channel_id:this.channel_id,time:a}).send()},addMessage:function(a){var b=this;if(b.channel_id!=a.channel_id)return;var c=0;for(var d=0;d<b.messages.length;d++){if(b.messages[d].message_id==a.message_id)return;b.messages[d].time<a.time&&(c=d+1)}b.messages.splice(c,0,a),b.messages.length>100&&b.messages.shift(),b.renderMessageList();if(b.viewer!==a.uid&&b.tribeIsSeen===!1){var e=b.tribeChatContext.get("unreadMessageCount");e+=1,b.tribeChatContext.set("unreadMessageCount",e)}},prettyTime:function(a){var b=new Date(a/1e3),c=b.getHours(),d="0"+b.getMinutes();return c+":"+d.substr(-2)},getMessageHtml:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a)),b=b.innerHTML;var c="";return e.linkify(b,{callback:function(a,b){b?c+='<a target="_blank" href="'+b+'">'+a+"</a>":c+=a}}),c},renderMessage:function(a){var b=this.getUser(a.uid);if(!b)return"";var c=$("<div/>",{"class":"tribe_message"}),d=b.name+" "+this.prettyTime(a.time);return c.append($("<a/>",{"class":"profile_photo_link",href:b.url}).append($("<img/>",{"class":"profile_photo_img",src:b.photo_url,title:b.name})).append($("<div/>",{"class":"profile_photo_tooltip",text:d}))).append($("<div/>",{"class":"tribe_message_contents"}).append($("<span/>",{html:this.getMessageHtml(a.message)}))),c},renderTimestamp:function(a){return $("<div/>",{"class":"tribe_timestamp",text:this.prettyTime(a.time)})},renderMessageList:function(){var a=this,b=0,c=a.$("#@messages");c.empty(),a.messages.forEach(function(d,e){e!==0&&d.time-b>=18e8&&c.append(a.renderTimestamp(d)),b=d.time,c.append(a.renderMessage(d))}),a.scrollMessageList()},scrollMessageList:function(){var a=this;a.$("#@messages").scrollTop(a.$("#@messages").prop("scrollHeight"))}}),a.ComposeMessageBox=c.extend({onLoad:function(){var a=this,b=this.$("#@message_box");this.tribeChatContext=this.getContext(f),a.initTextarea(b),b.on("click",function(){a.tribeChatContext.set("messageBoxFocused",!0)}),b.on("blur",function(){a.tribeChatContext.set("messageBoxFocused",!1)}),b.on("keydown",function(c){a.tribeChatContext.get("messageBoxFocused")===!1&&a.tribeChatContext.set("messageBoxFocused",!0),c.keyCode==13&&(b.val().length!==0&&a.serverCall("add_message").kwargs({message:b.val()}).send(),setTimeout(function(){b.val(""),b.css("height","auto")},1))}),a.tribeChatContext.on("minimized",function(a,c){c===!0?b.addClass("hidden"):b.removeClass("hidden")})},initTextarea:function(a){a.on("keydown paste",function(){var b=a.height(),c=parseInt(a.css("padding-top"))+parseInt(a.css("padding-bottom")),d=parseInt(a.prop("scrollHeight"))-c;this.max&&d>this.max&&(d=this.max),d>b-c&&a.css("height",d+"px")})}}),a.ManageMembersModalLink=c.extend({onLoad:function(){var a=this;this.$("#@modal_link").on("click",function(b){a.modal("load_inner"),b.preventDefault()})}}),a.ManageMembersModal=g.extend({onLoad:function(){this._super.apply(this,arguments),this.lookup("people_selector").inputFocus()},setTo:function(a){if(isNaN(parseInt(a)))return;this.serverCall("add_member").kwargs({channel_id:this.channel_id,to_uid:a}).send(),this.lookup("people_selector").reset()}})},{linkify:!0,cookies:!0,"view/modal":!0,"w2.context":!0,"w2.quora":!0})}),require.whenReady("settings",function(){require.enqueue(function(require){require("json2"),require("assert"),require("log"),require("jquery"),require("jquery.securepost"),require("jquery.cookie"),require("jquery.dialog"),require("jquery.tooltip"),require("jquery.menu"),require("jquery.topic"),require("jquery.viewport"),require("spin"),require("jquery.whenIdle"),require("Class"),require("jquery.ajax"),require("effects.core"),require("effects.shake"),require("effects.highlight"),require("jquery.webnode2"),require("jquery.quora"),require("polyfills/requestAnimationFrame"),require("w2.errors"),require("w2.dialog"),require("w2.modal"),require("w2.rpc"),require("w2.interaction"),require("w2.event"),require("w2.quora"),!0,require("init"),require("facebook"),require("twitter"),require("google_"),require("mathjax"),require("login"),require("network"),require("dialog"),require("mobile"),require("keystrokes"),require("view/captcha"),require("view/reauth"),require("lazy_load_images"),!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,window.log&&window.log.enabled&&window.log("main","main is loaded."),require("w2.timing").logTime("mainScriptEnd")})}),require.whenReady("settings",function(){require.install("main-loaded",function(require,a,b){},{})});