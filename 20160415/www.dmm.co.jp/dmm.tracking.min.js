/**
 * DMM i3 tracker
 *
 * Copyright (c) 2014 DMM.com
 * http://www.dmm.com/
 * @version v0.9 (2016-04-12)
 */
!function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=n[a]={exports:{}};e[a][0].call(p.exports,function(t){var n=e[a][1][t];return r(n?n:t)},p,p.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){var i=t("./tracking/setup"),r=t("./tracking/DMMi3"),o=window.DMMi3Object,a=i(o||"i3");r(a)},{"./tracking/DMMi3":2,"./tracking/setup":5}],2:[function(t,e,n){var i=t("./util"),r=t("./tracking"),o=e.exports=function(t){function e(t){if("string"!=typeof t)throw new TypeError;var e=t.split(".");return e.length>1?{namespace:e[0],type:e[1]}:{namespace:"default",type:e[0]}}if(!(this instanceof o))return new o(t);var n=this,a={},s=t.q||[],c=t.t;t.sp=t.s?(~~new Date-t.s).toString():void 0,s.push=function(){for(var t=0;t<arguments.length;t++)Array.prototype.push.call(this,arguments[t]);n.execQueue()},this.execQueue=function(){if(0!==s.length){var t=["send","set","get","add","clear","create","debug","init"],i=s.shift();if(i.length>0){var r=i[0],o=e(r),a=o.type,c=o.namespace;-1!==t.indexOf(a)&&n[a](c,i[1],i[2],i[3])}n.execQueue()}},this.debug=function(t,e){return void 0===e&&(e=!0),i.setDebugMode(e),this},this.init=function(e,n){return t.i=t.i||n,this},this.create=function(e,n){var i=n||"default",o=t.i;return a[i]=new r(t,o,c),this},this.set=function(t,e,n){switch(e){case"common":a[t].set("common",n);break;case"detail":a[t].set("detail_cond",n);break;case"search":case"recommend":case"api":a[t].set("api_cond",n);break;case"purchase":a[t].set("purchase_cond",n)}return this},this.add=function(t,e,n){switch(e){case"detail":a[t].set("detail_cond",{items:[n]});break;case"search":case"recommend":case"api":a[t].set("api_cond",{items:[n]});break;case"purchase":a[t].set("purchase_cond",{items:[n]})}return this},this.clear=function(t,e){switch(e){case"detail":a[t].clearItems("detail_cond");break;case"search":case"recommend":case"api":a[t].clearItems("api_cond");break;case"purchase":a[t].clearItems("purchase_cond")}return this},this.get=function(t,e){var n=function(){var n=a[t].get();e(n)};return 0===a[t].stack_function_count?n():a[t].onUpdated=n,this},this.send=function(t,e,n,i){switch(e){case"view":a[t].view(n,i);break;case"show":a[t].show(n,i);break;case"click":a[t].click(n,i)}return this},n.execQueue()}},{"./tracking":6,"./util":8}],3:[function(t,e,n){var i=e.exports=function(){this.common={},this.view_cond={},this.api_cond={},this.detail_cond={},this.user_cond={},this.purchase_cond={},this.stack_function_count=0,this.onUpdated=function(){}},r={common:{date:"string",action:"string",option:"string",i3_service_code:"string",open_id:"string",session:"string",cookie:"string",view_type:"string",user_agent:"string",url:"string",datetime:"string",ip:"string",segment:"string",var1:"string",var2:"string",var3:"string",var4:"string",var5:"string"},view_cond:{referrer:"string",is_via_landing:"boolean",landing_class:"boolean"},api_cond:{hit_count:"number",page_number:"number",begin_number:"number",end_number:"number",limit:"number",show_count:"number",items:{content_id:"string",product_id:"string",price:"number",has_stock:"boolean"},type:"string",show_position:"string",parameters:"string",word:"string",category:"string",sort:"string",show_pattern:"string",is_retried:"boolean",api_response_time:"string",client_response_time:"string"},detail_cond:{content_id:"string",items:{content_id:"string",product_id:"string",price:"number",has_stock:"boolean",monthly_service_id:"number",monthly_service_is_subscribed:"boolean",monthly_service_due_date:"string",monthly_service_price:"number"},via_info:"string",via_option:"string",via_view_rank:"string",via_show_position:"string"},user_cond:{browser_lang:"string",ip:"string"},purchase_cond:{purchase_id:"string",purchase_id_type:"string",items:{content_id:"string",product_id:"string",price:"number",quantity:"number",via_conversion:"string",via_option:"string"},paytype:"string",monthly_service_id:"number",monthly_service_due_date:"string"}};i.prototype.getInputDataSchema=function(){return r},i.prototype.set=function(t,e){function n(e,s){if(0!==e.length){var c=e[0];"object"==typeof a[t][c]?i(a[t][c],s[c]):a[t][c]===typeof s[c]&&(o[t][c]=s[c]),r(function(){n(e.slice(1),s)})}}function i(e,n){if(null!==n&&"object"==typeof n&&0!==n.length){var a={},s=n[0];if(null!==s&&"object"==typeof s){for(var c in e)c in s&&e[c]===typeof s[c]&&(a[c]=s[c]);o[t].items=o[t].items||[],o[t].items.push(a)}var u="function"==typeof n.slice?n.slice(1):[];r(function(){i(e,u)})}}function r(t){o.stack_function_count++,("undefined"==typeof setImmediate?function(t){t()}:setImmediate)(function(){t(),o.stack_function_count--,0===o.stack_function_count&&o.onUpdated()})}var o=this,a=this.getInputDataSchema();if(t in a&&"object"==typeof e){var s=Object.keys(e);n(s,e)}return this},i.prototype.clearItems=function(t){var e=this.getInputDataSchema();return t in e&&(this[t].items=[]),this},i.prototype.setByObject=function(t){var e=this.getInputDataSchema();if("object"==typeof t){this.set("common",t);for(var n in e)n in t&&this.set(n,t[n])}return this},i.prototype.getData=function(){var t=this,e=t.common||{};return e.view_cond=t.view_cond,e.api_cond=t.api_cond,e.detail_cond=t.detail_cond,e.user_cond=t.user_cond,e.purchase_cond=t.purchase_cond,e}},{}],4:[function(t,e,n){function i(t,e,n,i,r){var o=new XDomainRequest;i.xdr_queue=i.xdr_queue||[],i.xdr_queue.push(o);try{o.open(t,s()),o.onprogress=function(){},o.onerror=function(){r()},o.timeout=n,o.ontimeout=function(){r()},o.onload=function(){r()};var a=JSON.stringify(e);o.send(a)}catch(c){r()}}function r(t,e,n,i){var r=new XMLHttpRequest;try{r.open(t,s()),r.withCredentials=!0,r.onreadystatechange=function(t){4===r.readyState&&(r.status>=200&&r.status<300,i())},r.timeout=n,r.ontimeout=function(){i()},r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.setRequestHeader("X-Requested-With","XMLHttpRequest");var o=JSON.stringify(e);r.send(o)}catch(a){i()}}function o(t){t="function"==typeof t?t:function(){};var e=function(){0===e.count&&t(),e.count++};return e.count=0,e}function a(){var t=!!window.ProgressEvent,e=!!window.FormData,n=window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;return t&&e&&n}function s(){if(c()){var t=new p(u.getTrackingApiUrl());for(var e in u.getTrackingHostDomains())if(location.hostname.indexOf(e)>-1)return u.getTrackingApiUrl().replace(t.hostname,u.getTrackingHostDomains()[e])}return u.getTrackingApiUrl()}function c(){var t=navigator.userAgent.toLowerCase(),e=t.indexOf("iphone")>-1,n=t.indexOf("ipod")>-1,i=t.indexOf("ipad")>-1,r=t.indexOf("safari")>-1,o=t.indexOf("chrome")>-1;return(e||n||i)&&r&&!o}var u=t("./util"),p=t("./url"),d=e.exports=function(t){this.i3Object=t};d.prototype.send=function(t,e,n,s){var c=o(s);return u.isDebugMode()?c():(setTimeout(function(){0===c.count&&c()},n),a()?r(t,e,n,c):"undefined"!=typeof window.XDomainRequest?i(t,e,n,this.i3Object,c):c())}},{"./url":7,"./util":8}],5:[function(t,e,n){e.exports=function(t){return window[t]=window[t]||function(){window[t].q.push(arguments)},window[t].q=window[t].q||[],window[t].v="v0.9",function(){window.console||(window.console={});for(var t=["log","info","warn","error","debug","trace","dir","group","groupCollapsed","groupEnd","time","timeEnd","profile","profileEnd","dirxml","assert","count","markTimeline","timeStamp","clear"],e=0;e<t.length;e++)window.console[t[e]]||(window.console[t[e]]=function(){})}(),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=n.length;return function(r){if("object"!=typeof r&&"function"!=typeof r||null===r)throw new TypeError("Object.keys called on non-object");var o=[];for(var a in r)t.call(r,a)&&o.push(a);if(e)for(var s=0;i>s;s++)t.call(r,n[s])&&o.push(n[s]);return o}}()),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){"use strict";if(null==this)throw new TypeError;var e=Object(this),n=e.length>>>0;if(0===n)return-1;var i=0;if(arguments.length>0&&(i=Number(arguments[1]),i!=i?i=0:0!=i&&i!=1/0&&i!=-(1/0)&&(i=(i>0||-1)*Math.floor(Math.abs(i)))),i>=n)return-1;for(var r=i>=0?i:Math.max(n-Math.abs(i),0);n>r;r++)if(r in e&&e[r]===t)return r;return-1}),window[t]}},{}],6:[function(t,e,n){function i(){return document.referrer||""}function r(){var t=document.getElementById(c.target_ids.open_id);return t?t.value:void 0}function o(){var t=document.getElementById(c.target_ids.view_type);return t?t.value:void 0}function a(){return navigator.languages?navigator.languages[0]:navigator.language||navigator.userLanguage}function s(){var t=document.documentElement?document.documentElement.lang:"";return"string"==typeof t?t:""}var c=t("./util"),u=t("./log"),p=t("./url"),d=t("./sender"),f=e.exports=function(t,e,n){var i=this;i.constructor.parent.constructor.call(i),i.url=new p(location.href),i.set("common",{i3_service_code:e,view_type:o(),open_id:r(),var1:t.sp,url:location.href}),i.set("user_cond",{browser_lang:a()}),document.domain&&document.domain.indexOf(".r18.com")>-1&&i.set("common",{var5:s()}),i.timeout=n||2e3,i.i3Object=t},m=function(){};m.prototype=new u,f.prototype=new m,f.prototype.constructor=f,f.parent=u.prototype,f.prototype.view=function(t,e){var n=this,r=["page"];n.set("common",{action:"view"}).set("view_cond",{referrer:i()}),-1!==r.indexOf(t)&&n.set("common",{option:t}),n.send(e)},f.prototype.show=function(t,e){var n=this,r=["recommend","purchase","search","detail"];switch(n.set("common",{action:"show"}).set("view_cond",{referrer:i()}),-1!==r.indexOf(t)&&n.set("common",{option:t}),t){case"detail":n.set("detail_cond",{via_info:n.url.getViaInfo(),via_option:n.url.getViaOption(),via_view_rank:n.url.getViaViewRank(),via_show_position:n.url.getViaShowPosition()});break;case"search":}n.send(e)},f.prototype.click=function(t,e){var n=this,i=["add_cart","add_favorite","recommend"];n.set("common",{action:"click"}),-1!==i.indexOf(t)&&(n.set("common",{option:t}),n.set("detail_cond",{via_info:n.url.getViaInfo(),via_option:n.url.getViaOption(),via_view_rank:n.url.getViaViewRank(),via_show_position:n.url.getViaShowPosition()})),n.send(e)},f.prototype.get=function(){return this.getData()},f.prototype.send=function(t){var e=this,n=function(){var n=new d(e.i3Object);n.send("post",e.getData(),e.timeout,t)};0===e.stack_function_count?n():e.onUpdated=n},f.prototype.set=function(t,e){var n=this;if(e.items)for(var i=0;i<e.items.length;i++){var r=e.items[i].app_id;"undefined"!=typeof r&&(r="number"==typeof r?String(r):r,"string"==typeof r&&(e.items[i].content_id=r))}var o=n.getData().detail_cond;if("detail_cond"===t&&o)for(var a=["via_info","via_option","via_view_rank","via_show_position"],i=0;i<a.length;i++)"undefined"==typeof e[a[i]]||c.isEmpty(o[a[i]])||(e[a[i]]=void 0);if("detail_cond"===t&&"undefined"!=typeof e.monthly_service_id&&(e.items=[e]),n.constructor.parent.set.call(n,t,e),"purchase_cond"===t){var s=n.getData().purchase_cond.purchase_id_type;c.isEmpty(s)&&n.set("purchase_cond",{purchase_id_type:"purchase"})}return n},f.prototype.getData=function(){var t=this,e=t.common||{};return c.isEmpty(t.view_cond)||(e.view_cond=t.view_cond),c.isEmpty(t.api_cond)||(e.api_cond=t.api_cond),c.isEmpty(t.detail_cond)||(e.detail_cond=t.detail_cond),c.isEmpty(t.user_cond)||(e.user_cond=t.user_cond),c.isEmpty(t.purchase_cond)||(e.purchase_cond=t.purchase_cond),e}},{"./log":3,"./sender":4,"./url":7,"./util":8}],7:[function(t,e,n){var i=t("./util"),r=e.exports=function(t){var e=document.createElement("a");e.href=t,this.protocol=e.protocol,this.hostname=e.hostname,this.port=e.port,this.pathname=e.pathname,this.query=e.search,this.hash=e.hash,this.host=e.host};r.prototype.getParameterByName=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e="[\\?&]"+t+"=([^&#]*)",n=new RegExp(e),i=n.exec(this.query);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))},r.prototype.getViaInfo=function(){return this.getParameterByName(i.target_ids.via_info)},r.prototype.getViaOption=function(){return this.getParameterByName("dmmref")},r.prototype.getViaViewRank=function(){return this.getParameterByName(i.target_ids.via_view_rank)},r.prototype.getViaShowPosition=function(){return this.getParameterByName(i.target_ids.via_show_position)}},{"./util":8}],8:[function(t,e,n){function i(t){if(t)try{return JSON.parse(t)}catch(e){}}var r=!1,o="//trac.i3.dmm.com/analytics/v0.9",a=i('{"dmm.co.jp":"trac.i3.dmm.co.jp","r18.com":"trac.i3.r18.com","dmm-news.com":"trac.i3.dmm-news.com"}');e.exports={setDebugMode:function(t){r=t},isDebugMode:function(){return r},setTrackingApiUrl:function(t){o=t},getTrackingApiUrl:function(){return o},setTrackingHostDomains:function(t){a=t},getTrackingHostDomains:function(){return a},target_ids:{open_id:"i3_opnd",view_type:"i3_vwtp",via_info:"i3_ref",via_view_rank:"i3_ord",via_show_position:"i3_pst"},isEmpty:function(t){var e=Object.prototype.hasOwnProperty;if(null===t||void 0===t)return!0;if("object"!=typeof t)return!1;if(t.length>0)return!1;if(0===t.length)return!0;for(var n in t)if(e.call(t,n))return!1;return!0},writeDebug:function(t){if(r){var e=document.getElementById("debug");e&&(e.innerHTML=e.innerHTML+"<p>"+t+"</p>")}},parseJSON:i}},{}]},{},[1]);