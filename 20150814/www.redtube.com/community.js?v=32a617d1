var aShowedReplies=new Array();function initComments(a){if(typeof a=="object"){for(key in a){initCommentReportHook(a[key]["iCommentID"],a[key]["iObjectID"],a[key]["iAuthorID"],a[key]["bIsDeleted"],a[key]["bUserPage"])}}$(".comment-shadow a").click(function(){$("div.initially-hidden").removeClass("initially-hidden");$("#commentsPager").removeClass("none");$(".comment-shadow").remove()})}function initCommentReportHook(e,c,d,a,b){$rt.hooks.addIfNotExists("comment_report_"+e,"login_success",function(g){if(false==a&&(g.iUserID==d||(g.iUserID==c&&b))){var f=document.createElement("a");f.appendChild(document.createTextNode(lang.get("Delete")));f.className="comment-delete";f.href="javascript:;";f.onclick=function(){deleteComment(e,c,d)};$("#deleteComment_"+e).append(f)}})}function activateAddComment(b,l,i){var h=commentsType+"_id";var a=$(i).find(".comment-button");var j=$(i).find(".comment-text");var g=j.data("placeholder");var d=$(i).find(".comment-error");var f=$(i).find(".commentError");var e=$(i).find(".add-comment");var c=$(i).find(".captchaControl");var k=$(i).find(".parentID").length==1?$(i).find(".parentID").val():0;if(j.val()!=g){j.val(g)}a.attr("disabled","disabled").addClass("disabled");j.focus(function(){a.removeAttr("disabled").removeClass("disabled");$(this).removeClass("hasplaceholder");if($.browser.msie){$(this).select()}if($(this).val()==g){$(this).val("")}$(this).autogrow()}).focusout(function(){if($.trim($(this).val())==""){$(this).val(g).addClass("hasplaceholder");a.attr("disabled","disabled").addClass("disabled");$(this).unbind("change").unbind("keyup").unbind("keydown").removeAttr("style")}});$rt.ajax({id:"addComment_"+commentsType,target:a,url:"/comments/add",busyType:"overlay",busyTarget:e,validate:function(){var m=$.trim(j.val());if(m.length<2){f.html(l).show();return false}d.hide();f.hide();return true},parameters:function(){var m={};m[h]=b;m.comment_text=$.trim(j.val());m.parent_id=k;if(c.is(":visible")){m.recaptcha_response_field=$(i).find("#recaptcha_response_field").val();m.recaptcha_challenge_field=$(i).find("#recaptcha_challenge_field").val()}return m},success:function(m){j.val("");d.hide();f.hide();$("#commentsCount").html(parseInt($("#commentsCount").html())+1);$("#all_comments").html(m.html);$(".comment").each(function(){var n=$(this).attr("id").replace("comment_","");if(!$(this).hasClass("none")||$.inArray(n,aShowedReplies)>-1||(k>0&&$(this).hasClass(".replyTo"+k))){$(this).removeClass("none")}});$(".comment").each(function(){var n=$(this).attr("id").replace("comment_","");var p=$(".replyTo"+n).length;var o=$(".replyTo"+n+".none").length;if(o>0){if(p==2){$("#show_more_replies_"+n).text(lang.get("Show All %d Comments"))}else{if(p>2){$("#show_more_replies_"+n).text(lang.get("Show more"))}}}else{if(o==0){$("#show_more_replies_"+n).hide()}}});iComments++;iPages=Math.ceil(iComments/12);if(iPages<currentPage){currentPage=iPages}offlinePagination("comments",k?currentPage:1,false);c.hide();j.trigger("focusout");$("#recaptcha_response_field").val("")},error:function(n){if("9099"==n[0].code){alert(requestState.get(n[0].code));location.assign("/");return true}if("captcha"==n[0].code&&k==0){c.show();getRecaptcha("recaptcha-widget");d.html("<span>"+n[0].message+"</span>").show()}else{if("ignore"==n[0].code){f.html(n[0].message).show()}else{if("blocked_by_user"==n[0].code){notifyBlockedUser()}else{var m=requestState.get(n[0].code);if(m!=n[0].code&&n[0].message==n[0].code){f.html(m).show()}else{f.html(n[0].message).show()}}}}}})}function deleteComment(a,d,b){var c=commentsType+"_id";$rt.ajax({id:"deleteComment_"+commentsType,url:"/comments/delete",parameters:function(){var e={};e[c]=d;e.comment_id=a;e.author_id=b;e.reason="deleted by user";return e},error:function(f){if("9099"==f[0].code){alert(requestState.get(f[0].code));location.assign("/");return true}var e=requestState.get(f[0].code);if(e!=f[0].code){alert(e)}},success:function(e){$("#all_comments").empty().html(e.html);$("#commentsCount").html($("#all_comments").find("div.comment").length);iComments=$("#all_comments").find("div.comment").length-$("#all_comments").find("div.comment.reply").length;iPages=Math.ceil(iComments/12);if(iPages<currentPage){currentPage=iPages}offlinePagination("comments",currentPage,false)}})}function reportComment(a,d,b){var c=commentsType+"_id";$rt.ajax({id:"deleteComment_"+commentsType,url:"/comments/report",parameters:function(){var e={};e[c]=d;e.comment_id=a;e.author_id=b;e.reason="spam";return e},error:function(f){if("9099"==f[0].code){alert(requestState.get(f[0].code));location.assign("/");return true}var e=requestState.get(f[0].code);if(e!=f[0].code){alert(e)}},success:function(e){$("#commentStatus_"+a).html('<span class="comment-report">'+lang.get("ReportedAsSpam")+"</span>")}})}function selectCommentsSorting(b,c,a){$($("#"+b+" li")[0]).click(function(){$(this).addClass("hover")});$("#"+b).mouseleave(function(){$(this).find("li").removeClass("hover")});$("#"+b+" li ul li a").click(function(j){j.stopPropagation();var f=$($("#"+b+" li a")[0]);var g=f.text();var h=f.data("sort");var i=$(this).text();var d=$(this).data("sort");$(this).text(g).data("sort",h);f.text(i).data("sort",d);$(this).parent("li").trigger("mouseleave");getCommentsList(c,a,d)})}function getCommentsList(c,a,b){$rt.ajax({id:"listComments",url:"/comments/list",busyType:"overlay",busyTarget:$(".commentDivNoPadding"),parameters:function(){var d={sort:b};d[c]=a;return d},success:function(d){$("#all_comments").html(d.html);$("#commentsCount").html($("#all_comments").find("div.comment").length);offlinePagination("comments",1,false)},error:function(d){}})}function showMoreReplies(a,b,e){var d=$(".replyTo"+a+".none");var c=d.length;d.each(function(f,g){c-=1;aShowedReplies.push($(this).attr("id").replace("comment_",""));$(this).removeClass("none");if(c>1){$(e).text(lang.get("Show more"))}else{if(!c){$(e).hide()}}if(f==(b-1)){return false}})}function likeComment(a,c,b){$rt.ajax({id:"listComment",url:"/comments/like",parameters:function(){var d={comment_id:a};d[c]=b;return d},success:function(){$("#comment_likes_"+a).text(parseInt($("#comment_likes_"+a).text())+1)},error:function(d){alert(d[0].message)}})}function commentsPagination(b,c,a){if($rt.ajax.isActive("commentsList")){return}offlinePagination(b,c,a)}function initAccountReportedCommentsHooks(a,b){$rt.hooks.add("account_reported_comments_hooks","show_login",function(c){c.contents().find('input[name="iObjectID"]').val(a);c.contents().find('input[name="iObjectType"]').val(b)})}function initCommentsTabber(c,b){var a;var c=c;var b=b;a=new Tabber({topContainer:$("#tabsParent"),mainContainer:$("#tabsContentHolder"),resizable:false,scrollable:false,autoExpand:0});a.init();$(".tabsElements li").click(function(){if($("#tagger_tags").is(":visible")){$("#pornstarsList").css("min-height",$("#catsAndStars").height())}});$rt.hooks.add("galleryAddToFavoritesSuccess","addToFavoritesSuccess",function(d){favoriteButtonBehavior(d.sButtonSelector,d.iObjectType,d.iObjectID,d.iObjectExtra,"removeFromFavorites","SuccessfullyAdded","DeleteFromFavorites","favDelButton");if(typeof(aPhotoData)!="undefined"&&typeof(aPhotoData.aFavorites)!="undefined"){aPhotoData.aFavorites[d.iObjectID]=1}});$rt.hooks.add("galleryRemoveFromFavoritesSuccess","removeFromFavoritesSuccess",function(d){favoriteButtonBehavior(d.sButtonSelector,d.iObjectType,d.iObjectID,d.iObjectExtra,"addToFavorites","SuccessfullyDeleted","AddToFavorites","favAddButton");if(typeof(aPhotoData)!="undefined"&&typeof(aPhotoData.aFavorites)!="undefined"){aPhotoData.aFavorites[d.iObjectID]=0}});$rt.hooks.add("galleryAddToFavoritesError","addToFavoritesError",function(d){if(d.aErrors[0].code=="AlreadyInFavorites"){favoriteButtonBehavior(d.sButtonSelector,d.iObjectType,d.iObjectID,d.iObjectExtra,"removeFromFavorites","AlreadyInFavorites","DeleteFromFavorites","favDelButton")}})}function initActivateAddSelectSortingComment(b,c,a,d,f,e){activateAddComment(b,c,a);if(d){selectCommentsSorting(f,e,b)}}function closeLightbox(){if(typeof $.fn.lightBox!="undefined"){if(typeof $.fn.lightBox.finish=="function"){typeof $.fn.lightBox.finish()}}}function addToFavorites(d,c,b,a,e){var f=d+"-"+c+"-"+b;var g=(typeof b!="undefined"&&b!==null)?"/"+b:"";a=a||"#favAddRemove";var e=e?true:false;$rt.ajax({id:"addToFavorites_"+f,url:"/addfavorite/add/"+d+"/"+c+g,error:function(h){if(h[0].code=="aje001"){trackByCookie("stats_comm_favoritelogin");closeLightbox();showLogin(function(){addToFavorites(d,c,b,a,e)},2);$rt.hooks.remove("favorite_video_on_login_success");return true}else{if(h[0].code!="aje021"&&h[0].code!="AlreadyInFavorites"){alert(requestState.get(h[0].code))}}$rt.hooks.execute("addToFavoritesError",{sButtonSelector:a,iObjectType:d,iObjectID:c,iObjectExtra:b,aErrors:h})},success:function(h){if(e){location.reload();return}$rt.hooks.execute("addToFavoritesSuccess",{sButtonSelector:a,iObjectType:d,iObjectID:c,iObjectExtra:b,oServerResponse:h})}})}var iForceRefresh=false;function removeFromFavorites(d,c,b,a,e){var f=d+"-"+c+"-"+b,e=e?true:false,a=a||"#favAddRemove";$rt.ajax({id:"removeFromFavorites"+f,url:"/addfavorite/remove/"+d+"/"+c,error:function(g){if(g[0].code=="aje001"){trackByCookie("stats_comm_favoritelogin");closeLightbox();showLogin(function(){removeFromFavorites(d,c,b,a,true)},2);$rt.hooks.remove("favorite_video_on_login_success");return true}else{if(g[0].code!="aje021"){alert(requestState.get(g[0].code))}}$rt.hooks.execute("removeFromFavoritesError",{sButtonSelector:a,iObjectType:d,iObjectID:c,iObjectExtra:b,aErrors:g})},success:function(g){if(e==1){location.reload();return}$rt.hooks.execute("removeFromFavoritesSuccess",{sButtonSelector:a,iObjectType:d,iObjectID:c,iObjectExtra:b,oServerResponse:g})}})}var favoriteButtonBehavior=function(h,d,a,f,g,e,b,i){var c=$(h);if(typeof c[0]!="undefined"){if(e){c.attr("class","text").text(lang.get(e))}c[0].onclick=function(){};setTimeout(function(){if($(".galleryDetails").find(h)){c.text(lang.get(b))}else{c.text("")}c.attr("class",i);c[0].onclick=function(){window[g](d,a,f,h)}},(e)?3000:1)}};function switchVideoFavButton(a){var b=".favAddRemove";var d=$(b);var c=$(b+".favorited");if(2==d.length&&1==c.length&&("add"==a||"remove"==a)){if(a=="add"){d.removeClass("none");c.addClass("none")}else{d.addClass("none");c.removeClass("none")}}}function closeFriendRequest(){$("#friendReqContainer").html("").hide()}function acceptFriendRequest(b,a,c){$rt.ajax({id:"acceptFriendRequest",url:"/message/"+b+"/accept",error:function(d){showLogin(function(){acceptFriendRequest(b,a,c)},false);return true},success:function(d){iFriendsStatus=2;$("#acceptFriend").css("display","none");$("#removeFriend").css("display","block")}})}function newFriendRequest(a){$rt.ajax({id:"newFriendRequest",url:"/addfriend/new/"+a,error:function(c,b){if(c[0].code=="aje001"){showLogin(function(){newFriendRequest(a)},false);return true}else{$("#friendReqContainer").html("").css("display","none");$("#infoBox").html(b.response.data.html).css("display","block");$rt.hooks.execute("new_friend_request_error",b.response)}},success:function(b){$("#friendReqContainer").html(b.html).css("display","block");if($.browser.msie){setTimeout("$('#friendReqContainer textarea').select()",500)}}})}function addFriend(a){$rt.ajax({id:"addFriend"+a,url:"/addfriend/add/"+a,error:function(c,b){if(c[0].code=="aje001"){showLogin(function(){addFriend(a)},false);return true}else{$("#infoBox").html(b.response.data.html).css("display","block");$rt.hooks.execute("add_friend_error",b.response)}},success:function(b){$("#addFriend").hide();$("#removeFriend").show();iFriendsStatus=2;b.iFriendID=a;$rt.hooks.execute("add_friend_success",b)}})}function removeFriend(a){$rt.ajax({id:"removeFriend"+a,url:"/addfriend/remove/"+a,error:function(b){if(b[0].code=="aje001"){showLogin(function(){removeFriend(a)},false);return true}},success:function(b){b.iFriendID=a;$rt.hooks.execute("remove_friend_success",b)}})}function sendFriendRequest(a){$rt.ajax({id:"sendFriendRequest",url:"/addfriend/send/"+a,parameters:{msg:$("#friendsReqMessage").val()},error:function(c,b){if(c[0].code=="aje001"){showLogin(function(){sendFriendRequest(a)},false);return true}else{$("#friendReqContainer").html("").css("display","none");$("#addFriend").hide();$("#infoBox").html(b.response.data.html).css("display","block");$rt.hooks.execute("send_friend_request_error",b.response)}},success:function(b){$("#friendReqContainer").html(b.html).css("display","block");$("#addFriend").hide();$("#friendText").html("Request sent").css("display","block");$rt.hooks.execute("send_friend_request_success",b)}})}function cancelFriendRequest(a){$rt.ajax({id:"cancelFriendRequest",url:"/addfriend/cancel/"+a,error:function(b){if(b[0].code=="aje001"){showLogin(function(){cancelFriendRequest(a)},false);return true}else{alert(requestState.get(b[0].code))}},success:function(b){location.reload()}})}function initFriendTooltip(a){$("#compose-new-message").hover(function(){if(isLogged()&&iFriendsStatus!=a){$("#sendMessageTooltip").show()}},function(){$("#sendMessageTooltip").hide()})}function initAddClick(){$("#addFriend").hover(function(){if(isLogged()){$("#addFriendTooltip").show()}},function(){$("#addFriendTooltip").hide()})}function updateSubscribeButton(a){$rt.hooks.add("checkFriendsStatus","show_login",function(b){b.contents().find("input[name=iFriendID]").val(a)});$rt.hooks.add("updateFriendButtons","login_success",function(c){if(c.iUserID==a){var b='<a id="editButton" class="site-button channelButton" href="/profile/edit">'+lang.get("Edit channel")+"</a>";$("#add-friend").empty().html(b)}else{if(c.iFriends==MESSAGE_FRIEND_REQUEST_ACCEPTED){$("#addFriend").hide();$("#removeFriend").show()}else{$("#addFriend").show();$("#removeFriend").hide()}}})}function setSubscribeButtonHandler(a,b,c){$rt.hooks.add("seUnsubscribeButtonHandler","add_friend_success",function(){$("#addFriend").hide();$("#removeFriend").show();unsubscribeRollOver()});$rt.hooks.add("add_friend_error","add_friend_error",function(d){if(d.error_code=="already_done"){$("#addFriend").hide();$("#removeFriend").show()}});$rt.hooks.add("remove_friend_success","remove_friend_success",function(){$("#addFriend").show();$("#removeFriend").hide()})}function subscribe(a,b){$rt.hooks.addIfNotExists("changeSubscribeButton_"+b+"_"+a,"subscribe_success",function(c){$(".unsubscribe_"+b+"_"+a).show();$(".subscribe_"+b+"_"+a).hide();unsubscribeRollOver();$rt.hooks.remove("changeSubscribeButton_"+b+"_"+a)});if(!isLogged()){$rt.hooks.addIfNotExists("subscribe","login_success",function(c){if(c.isConfirmed){$rt.hooks.remove("subscribe");subscribeRequest(a,b)}});showLogin(false,false)}else{subscribeRequest(a,b)}}function subscribeRequest(a,b){$rt.ajax({id:"subscribe_"+a,url:"/subscribe/add/"+a+"/"+b,error:function(d,c){if(d[0].code=="aje001"){showLogin(function(){subscribe(a,b)},false);return true}else{if(d[0].code=="already_done"){$rt.hooks.execute("subscribe_success",d)}else{return false}}},success:function(c){$rt.hooks.execute("subscribe_success",c)}})}function unsubscribe(a,b){$rt.hooks.addIfNotExists("changeUnsubscribeButton_"+b+"_"+a,"unsubscribe_success",function(){$(".unsubscribe_"+b+"_"+a).hide();$(".subscribe_"+b+"_"+a).show();$rt.hooks.remove("changeUnsubscribeButton_"+b+"_"+a)});$rt.ajax({id:"unsubscribe_"+a,url:"/subscribe/remove/"+a+"/"+b,error:function(c){if(c[0].code=="aje001"){showLogin(function(){unsubscribe(a,b)},false);return true}},success:function(){$rt.hooks.execute("unsubscribe_success",a)}})}function onRemoveFriendHook(){$rt.hooks.add("remove_friend_success","remove_friend_success",function(){$("#addFriend").show();$("#removeFriend").hide()})}function unsubscribeRollOver(){$(".unsubscribe-link").hover(function(){$(this).find("span").text(lang.get("Unsubscribe"))},function(){$(this).find("span").text(lang.get("Subscribed"))})}function initSubscribeButton(){unsubscribeRollOver()}function toggleMembersAdvancedSearchWindow(a){$("#advancedMemberSearch, #memberSearch").toggle();if($("#advancedMemberSearch").is(":visible")){sliderInitLabels($("#slider-range-age"))}}function initMembersSearch(b,a){styleCheckBox1({input:$("#male"),onClass:"checked"});styleCheckBox1({input:$("#female"),onClass:"checked"})}function initAdvancedMembersSearch(c,e,h,i,b){styleCheckBox1({input:$("#lookingForMen"),onClass:"checked"});styleCheckBox1({input:$("#lookingForWomen"),onClass:"checked"});styleCheckBox1({input:$("#interestedInMen"),onClass:"checked"});styleCheckBox1({input:$("#interestedInWomen"),onClass:"checked"});styleCheckBox1({input:$("#interestedInCouples"),onClass:"checked"});styleCheckBox1({input:$("#public"),onClass:"checked"});styleCheckBox1({input:$("#private"),onClass:"checked"});var d=$("#slider-range-age");d.slider({range:true,min:18,max:70,values:[18,70],create:function(j,k){sliderCreate(d,{topLabel:$("#sra-top"),botLabel:$("#sra-bottom"),topLabelCallback:function(l){return lang.get("advsearch.from")+" "+l},botLabelCallback:function(l){return lang.get("advsearch.to")+" "+(l>=70?"< ":"")+l}})},slide:function(j,k){sliderSlide(d,k)},change:function(j,k){$('input[name="minage"]').val(k.values[0]);$('input[name="maxage"]').val(k.values[1])}}).addTouch();function f(l,k){var j=h.filter(function(m){return $.inArray(m.name,k)==-1});l(j)}var a=$("#members_search_like_field").selectize({plugins:["remove_button"],create:false,preload:"focus",maxItems:6,hideSelected:true,closeAfterSelect:true,valueField:"name",labelField:"name",searchField:"name",render:{option_create:function(k,j){return""}},load:function(j,k){this.renderCache={};this.loadedSearches={};f(k,$("#members_search_dislike_field").val())},onItemRemove:function(j){g[0].selectize.loadedSearches={};g[0].selectize.lastValue=false;g[0].selectize.addOption(j);g[0].selectize.refreshOptions(false)},onItemAdd:function(k,j){g[0].selectize.loadedSearches={};g[0].selectize.lastValue=false;g[0].selectize.removeOption(k);g[0].selectize.refreshOptions(false)},onDropdownClose:function(){this.blur()}});var g=$("#members_search_dislike_field").selectize({plugins:["remove_button"],create:false,preload:"focus",maxItems:6,hideSelected:true,closeAfterSelect:true,valueField:"name",labelField:"name",searchField:"name",render:{option_create:function(k,j){return""}},load:function(j,k){this.renderCache={};this.loadedSearches={};f(k,$("#members_search_like_field").val())},onItemRemove:function(j){a[0].selectize.loadedSearches={};a[0].selectize.lastValue=false;a[0].selectize.addOption(j);a[0].selectize.refreshOptions(false)},onItemAdd:function(k,j){a[0].selectize.loadedSearches={};a[0].selectize.lastValue=false;a[0].selectize.removeOption(k);a[0].selectize.refreshOptions(false)},onDropdownClose:function(){this.blur()}})}$window=$(window);function messagesMarkNotRead(b,a,c){$rt.ajax({id:"markMessageNotRead"+b,url:"/message/"+b+"/unread",busyTarget:"#unreadButton_"+b,error:function(d){},success:function(d){if(c){messagesLoadLastFilter()}else{$("#unreadButton_"+b).hide();$("#separator_"+b+"_unread").hide();$("#messageContent_"+b).removeClass();$("#messageContent_"+b).addClass("messageContentNew");$(".id_unread_"+a).each(function(f){var e=$(this).html();$(this).html(parseInt(e)+1)})}}});return false}function messagesReportSpam(a){$rt.ajax({id:"messagesReportSpam"+a,url:"/message/"+a+"/spam",busyTarget:"#unreadButton_"+a,error:function(b){},success:function(c){var b=$("#separator_"+a+"_report").is(":visible");$("#reportButton_"+a).hide();$("#separator_"+a+"_report").hide();$("#reportedMessage_"+a).show();if(b){$("#separator_"+a+"_reported").show()}}})}function messagesProcessRequest(c,b){var a=$("#acceptButton_"+b);var d=$("#ignoreButton_"+b);$rt.ajax({id:"messagesProcessRequest"+b,url:"/message/"+b+"/"+c,busyTarget:"#messageContent_"+b,busyType:"overlay",error:function(e){},success:function(f){reloadInitTopNavigation();var e=$("#messageContent_"+b);if(e.hasClass("messageContentNew")){e.removeClass("messageContentNew");e.addClass("messageContent");$(".id_unread_request").each(function(h){var g=$(this).html();$(this).html(parseInt(g)-1)})}$("#requestButtons_"+b).remove();$("#messageIcon_"+b).removeClass();if("accept"==c){$("#title_"+b).html(msgRequestAccepted);$("#messageIcon_"+b).addClass("iconAcceptFriend");$("#reportButton_"+b).hide();$("#separator_"+b+"_report").hide()}else{$("#title_"+b).html(msgRequestIgnored);$("#messageIcon_"+b).addClass("iconIgnoreFriend")}}})}function messagesDeleteMessage(a){$rt.ajax({id:"messagesDeleteMessage"+a,url:"/message/"+a+"/delete",busyTarget:"#deleteButton_"+a,error:function(b){},success:function(b){messagesLoadLastFilter()}})}function messagesOpenCompose(b,a){$rt.ajax({id:"messagesOpenCompose",url:"/message/compose",parameters:{sRecipient:b,sMessageComposeContext:a},error:function(c){if(c[0].code=="aje001"){showLogin(function(){messagesOpenCompose(b,a)},false);return true}else{if(c[0].code="not_friends"){location.reload()}}},success:function(c){$("#loginContainer").remove();if($("#composeMessageContainer").length){$("#loginBackground").remove();$("#composeMessageContainer").remove()}$("body").append('<div id="loginBackground" class="loginBackground"></div><div id="composeMessageContainer" >'+c.html+"</div>")}});return false}function messagesCloseCompose(){clearTimeout(sendMessageSuccessFadeTimer);$("#loginBackground").remove();$("#composeMessageContainer").remove();composeMessageEnabled=true;return false}var sendMessageSuccessFadeTimer=null;function messagesSubmitCompose(){messagesComposeShowError("");var b=$("#friend_field").length>0?$("#friend_field").val():"";var a=$("#composeMessageText").hasClass("messageHintClass")?"":$("#composeMessageText").val();if(b==""||a==""){return}$rt.ajax({id:"messagesSubmitCompose",url:"/message/post",parameters:{sRecipient:b,sMessage:a},busyTarget:"#sendMsgBtn",validate:function(){return b!=""&&a!=""},error:function(c){messagesComposeShowError(c[0].message)},success:function(d){$("#composeMessageForm").hide();$(".sentSuccess").append(" "+b).show();$("#closeLink").focus();sendMessageSuccessFadeTimer=setTimeout("messagesCloseCompose()",3000);var c=messagesGetLastType();if(c==""||c=="all"||c=="friends"){messagesLoadLastFilter()}}});return false}function messagesComposeShowError(a){if(a==""){$("#composeErrorBoxDiv").hide()}else{$("#composeErrorBoxMessage").text(a);$("#composeErrorBoxDiv").show()}}var disableNextContentLoad=false;function messagesDisableNextContentLoad(){disableNextContentLoad=true}function messagesEnableNextContentLoad(){disableNextContentLoad=false}function messagesLoadContent(a,b){if(disableNextContentLoad){disableNextContentLoad=false;return}$rt.ajax({id:"messagesLoadContent",url:a,error:function(c){if(c[0].code=="outofrange"){$.history.load($errors[0].message)}},success:function(c){$("#ContentFrame").html(c.html);if(b!=undefined){b()}},complete:function(){deleteTrackCookie()}})}var messagesLastType="all";var messagesLastStatus="all";var messagesLastPage=1;function messagesGetLastType(){return messagesLastType}function messagesGetLastStatus(){return messagesLastStatus}function messagesGetLastPage(){return messagesLastPage}function messagesSetLastFilter(b,a,c){messagesLastType=b;messagesLastStatus=a;messagesLastPage=c}function messagesLoadLastFilter(){messagesDisableNextContentLoad();messagesLoadFilter(messagesLastType,messagesLastStatus,messagesLastPage);messagesEnableNextContentLoad();messagesCallFilter(messagesLastType,messagesLastStatus,messagesLastPage);return false}function messagesLoadFilter(b,a,c){if(b==""){b="all"}if(a==""){a="all"}if(!c){c=1}hash="list_"+b+"_"+a+"_"+c;messagesHistoryLoad(hash);return false}function messagesCallFilter(c,a,d){messagesSetLastFilter(c,a,d);var b="/message/"+c+"/"+a;if(d!=1){b+="?page="+d}messagesLoadContent(b,messagesInitInbox);return true}function messagesCallMessage(b){var a="/message/details/"+b;messagesLoadContent(a,messagesInitDetails);return true}function messagesCallThread(b){messagesStoreInboxScrollPosition();messagesResetThreadProgress();var a="/message/thread/"+b;messagesLoadContent(a,messagesInitConversation);return true}function messagesGetLastTypeCountClass(){return"id_unread_"+(messagesLastType==""?"all":messagesLastType)}function messagesSetUnreadCounts(a){$(".id_unread_request").text(a.request);$(".id_unread_system").text(a.system);$(".id_unread_friends").text(a.friends);$(".id_unread_all").text(a.all)}function messagesInit(){$.history.init(messagesLoadHash,{unescape:false})}function messagesLoadHash(e){data=e.split("_");if(data.length<2){return messagesHistoryLoad("list_all_all_1")}$rt.hooks.execute("messageLoad",{hash:data[0]});if("list"==data[0]){var c=data.length>1?data[1]:"";var a=data.length>2?data[2]:"";var d=data.length>3?parseInt(data[3]):NaN;if(d!==d||d==0||(["all","friends","system","request"].indexOf(c)==-1)||(["all","unread"].indexOf(a)==-1)){return messagesHistoryLoad("list_all_all_1")}else{return messagesCallFilter(c,a,d)}}else{if("message"==data[0]){if(data[1]==""||data[1]==undefined){return messagesHistoryLoad("list_all_all_1")}else{return messagesCallMessage(data[1])}}else{if("conversation"==data[0]){data.shift();var b=data.join("_");if(b==""||b==undefined){return messagesHistoryLoad("list_all_all_1")}else{return messagesCallThread(b)}}}}return messagesHistoryLoad("list_all_all_1")}function messagesHistoryLoad(a){messagesDisableNextContentLoad();$.history.load(a);messagesEnableNextContentLoad();messagesLoadHash(a)}var messagesThreadAccount="";var messagesThreadEnd=false;var messagesThreadTopMessage=0;var messagesThreadBottomMessage=0;function messagesSetThreadProgress(b,a,c,d){messagesThreadAccount=b;if(d!=null){messagesThreadEnd=d;messagesThreadTopMessage=a}if(messagesThreadBottomMessage<c){messagesThreadBottomMessage=c}}function messagesResetThreadProgress(){messagesThreadAccount="";messagesThreadEnd=true;messagesThreadTopMessage=0;messagesThreadBottomMessage=0}function messagesLoadThreadOlderMesasges(){if(""==messagesThreadAccount){return}if(messagesThreadEnd){return}var a="/message/thread/"+messagesThreadAccount+"/"+messagesThreadTopMessage;$rt.ajax({id:"loadThreadOlderMesasges",url:a,error:function(b){},success:function(b){var c=messagesGetThreadHeight();$(".contentMessageThread").prepend(b.html);messagesThreadInitScroll(messagesGetThreadHeight()-c)}})}function messagesGetThreadHeight(){return parseInt($(".contentMessageThread").css("height"))+18}var messagesThreadScrollBottomPosition=0;var messagesThreadScrollBottomPositionOriginal=0;function messagesThreadInitScroll(b){var d=messagesGetThreadHeight();var c=$window.height();var h=d+265+80-c;var e=parseInt($(".wrapperMessage").css("height"))+265-c;var g=$("#sendMessageBox").height()+20;messagesThreadScrollBottomPosition=h;if(messagesThreadScrollBottomPositionOriginal==0){messagesThreadScrollBottomPositionOriginal=h}$(".simpleHolder").css("height",d+g+37+($("body").hasClass("rt_tablet")?16:0));$(".openedThread .wrapperMessage").css("padding-bottom",g-20+"px");if($.browser.msie&&$.browser.version<7){$(".simpleHolder").css("height",(parseInt($("#testId").css("height")))+"px")}if(b!=undefined){$window.scrollTop(b)}else{if(e>=0){$window.scrollTop(h)}else{$window.scrollTop(0)}}var a=$("#as_4");if(a.length>0){var f=a.offset();a.removeClass("floating_top");a.removeClass("floating_bottom");a.css("position","relative").css("width","190px");a.offset({top:20,left:f.left})}}if($.browser.msie&&$.browser.version<9){messagesGetTopScrollPosition=function(){return document.documentElement.scrollTop}}else{messagesGetTopScrollPosition=function(){return $window.scrollTop()}}var messagesOldScroll=0;var messageBannerHeight=0;function messagesThreadScrollHandler(){if($("#composeMessageText").is(":focus")){}var b=messagesGetTopScrollPosition();var a=$("#as_4");if(messageBannerHeight==0){messageBannerHeight=a.height()}if(b==0){messagesLoadThreadOlderMesasges()}if(messagesThreadScrollBottomPosition<=b){$(".boxMessageThread").addClass("boxMessageThreadInside");$(".boxMessageThreadInside").removeClass("boxMessageThread")}else{$(".boxMessageThreadInside").addClass("boxMessageThread");$(".boxMessageThread").removeClass("boxMessageThreadInside")}if(messageBannerHeight>$window.height()){var d=a.offset();if(messagesOldScroll>b&&a.hasClass("floating_bottom")){a.removeClass("floating_bottom");if(messagesOldScroll-b>messageBannerHeight-$window.height()-20){var c=b}else{var c=messagesOldScroll+$window.height()-messageBannerHeight-20}a.css({position:"relative",top:c+"px",left:0+"px"})}if(messagesOldScroll<b&&a.hasClass("floating_top")){a.removeClass("floating_top");if(b-messagesOldScroll>messageBannerHeight-$window.height()+2){var c=b+$window.height()-messageBannerHeight-20}else{var c=messagesOldScroll}a.css({position:"relative",top:c+"px",left:0})}if(d.top-20>b){a.addClass("floating_top");a.css({position:"fixed",top:"2px",left:d.left+"px"})}if((d.top+messageBannerHeight+20)<($window.height()+b)){a.addClass("floating_bottom");a.css({position:"fixed",top:($window.height()-messageBannerHeight-20)+"px",left:d.left+"px"})}}messagesOldScroll=b}function messagesThreadResizeHandler(){messagesThreadInitScroll(messagesOldScroll);$("#as_4").removeClass("floating_top").removeClass("floating_bottom").css({position:"relative",left:0+"px"})}function messagesSubmitResponse(){messagesComposeShowError("");var a=$("#composeMessageText");var b=a.val();if(b==""||$("#composeMessageText").hasClass("messageHintClass")){return}messagesDelayedProcessSubmitResponse()}function messagesDelayedProcessSubmitResponse(){if($rt.ajax.isActive("messagesUpdateBottom")){setTimeout("messagesDelayedProcessSubmitResponse()",100)}else{messagesProcessSubmitResponse()}}function messagesProcessSubmitResponse(){var a=$("#composeMessageText");$rt.ajax({id:"messagesSubmitResponse",url:"/message/post",parameters:{sRecipient:messagesThreadAccount,sMessage:a.val(),sResponse:"html",iMessage:messagesThreadBottomMessage},error:function(b){messagesComposeShowError(b[0].message)},success:function(b){$(".contentMessageThread").append(b.html);messagesThreadInitScroll();a.val("");a.focus()}});return false}function messagesInitDetails(){messagesUninitConversation();$window.scrollTop(0)}function messagesInitConversation(){$("body").addClass("openedThread");messagesThreadInitScroll();$window.bind("scroll.thread",messagesThreadScrollHandler);$window.bind("resize.thread",messagesThreadResizeHandler);$window.bind("orientationchange",function(){$("#composeMessageText").blur();messagesThreadResizeHandler();messagesThreadScrollHandler()});messagesScheduleUpdateBottom();if($("#simpleMessageHolder").height()+510<$window.height()){$("body").removeClass("openedThread");$("#simpleMessageHolder").hide()}}function messagesUninitConversation(){messagesUnscheduleUpdateBottom();$window.unbind("scroll.thread");$window.unbind("resize.thread");$window.unbind("orientationchange");$("body").removeClass("openedThread");var a=$("#as_4");if(a.length>0){var b=a.offset().left;a.removeClass("floating_top");a.removeClass("floating_bottom");a.css("position","relative");a.offset({top:2,left:b})}}function messagesInitInbox(){messagesUninitConversation();messagesRestoreInboxScrollPosition()}var messagesInboxScrollPosition=0;function messagesStoreInboxScrollPosition(){messagesInboxScrollPosition=messagesGetTopScrollPosition()}function messagesRestoreInboxScrollPosition(){$window.scrollTop(messagesInboxScrollPosition);messagesInboxScrollPosition=0}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this===void 0||this===null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!==e){e=0}else{if(e!==0&&e!==Infinity&&e!==-Infinity){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}var messagesBottomUpdateTimer=null;var messagesBottomUpdateInterval=15000;function messagesScheduleUpdateBottom(){messagesUnscheduleUpdateBottom();messagesBottomUpdateTimer=setTimeout("messagesUpdateBottom()",messagesBottomUpdateInterval);return messagesBottomUpdateTimer}function messagesUnscheduleUpdateBottom(){if(messagesBottomUpdateTimer!=null){clearTimeout(messagesBottomUpdateTimer);messagesBottomUpdateTimer=null}}function messagesUpdateBottom(){messagesBottomUpdateTimer=null;if(""==messagesThreadAccount){return}var a="/message/thread_update/"+messagesThreadAccount+"/"+messagesThreadBottomMessage;$rt.ajax({id:"messagesUpdateBottom",url:a,complete:function(){messagesScheduleUpdateBottom()},success:function(c){var b=messagesThreadBottomMessage;$(".contentMessageThread").append(c.html);if(b!=messagesThreadBottomMessage){messagesThreadInitScroll()}}})}function setComposeNewMessageLink(b,a){$(document).ready(function(){if(isLogged()){$(b).unbind("click").click(function(){messagesOpenCompose(a,window.STATS_MESSAGES+"profile_success",window.STATS_MESSAGES+"profile_fail")})}else{$rt.hooks.addIfNotExists("composeNewMessageChannel","login_success",function(c){$(b).unbind("click").click(function(){messagesOpenCompose(a,window.STATS_MESSAGES+"profile_success",window.STATS_MESSAGES+"profile_fail")}).trigger("click")});$(b).unbind("click").click(function(){showLogin(false,false)})}})};