var sidebar={sideBar:null,sideBar_w970:null,sideBar_w970_custom:null,subEle:null,rightSidebar:null,closeIcon:null,subData:null,recData:null,isWide:!1,loadingImg:null,userInfoTip:null,sidebarMask:null,haveLoaded:!1,nHaveLoaded:!1,isNsidebarPopout:!1,init:function(){var e=this;e.initGlobalValue(),e.switchLinkOpen(),e.initSize(),e.checkToolSize(),e.hideNarrowBarInVpageInIE8AtLowWidth(),e.initGlobalEvents(),e.appendShowSubBtnInVpage()},initGlobalValue:function(){var e=this;e.sideBar=jQuery("#ykSideBar"),e.sideBar_w970=jQuery("#ykSidebar_w970"),e.sideBar_w970_custom=jQuery("#ykSidebar_w970_custom"),e.subEle=jQuery("#ykSideSub"),e.nSubEle=jQuery("#yknSideSub"),e.rightSidebar=jQuery("#rightSidebar"),e.closeIcon=e.rightSidebar.find(".closeIcon"),e.sidebarMask=jQuery("#sidebarMask"),e.loadingImg=jQuery('<img style="width: 64px;height: 62px;position: relative;top: 50%;left: 50%;margin:-31px 0 0 -32px; " src="http://static.youku.com/index/img/2013/loading_64.gif" alt="æ­£å¨å è½½"/>'),e.userInfoTip=jQuery('<div class="detailTip"><iframe class="detailTip_mask" frameBorder="0" scrolling="no"></iframe><img src=""/><h2 class="userName"></h2><div id="tipSub" class="sub-btn">è®¢é</div><div class="arrow"></div></div>'),e.miniSidebar=jQuery("#miniSidebar")},initSize:function(){var e=sidebar,i=e.sideBar.height(),a=i-330,s=e.subEle.find("#subscribeBody")[0];if(e.subEle.height(a),s){var t=e.subEle.height()-48;jQuery(s).height(t)}var r=e.sideBar_w970[0]?e.sideBar_w970:e.sideBar_w970_custom,o=r.height(),n=o-410,d=jQuery("#yknSideSub");d.height(n)},checkToolSize:function(){var e=this,i=i=window.innerWidth||"CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth,a=e.sideBar_w970[0],s=e.sideBar_w970[0]?e.sideBar_w970:e.sideBar_w970_custom;a&&(1400>i&&i>=1075?(e.isWide=!1,e.nHaveLoaded||e.loadSubDataToNsidebar(),e.sidebarMask.css({left:"-110px"})):i>=1400?(e.isWide=!0,e.haveLoaded||e.loadSubscribeData(),e.sidebarMask.css({left:"0px"})):1075>i&&(e.isWide=!1,e.sidebarMask.css({left:"-141px"}),s.css({display:"block",left:"-50px"})))},appendShowSubBtnInVpage:function(){var e=this,i=jQuery('<a class="showSubBtn"><p class = "text">è®¢é<br/>åè¡¨</p><div class="icon"></div></a>');if(e.sideBar_w970_custom[0]){var a=e.sideBar_w970_custom.find("#yknSideSub");i.on("click",function(){i.remove(),e.loadSubDataToNsidebar()}).appendTo(a)}},switchLinkOpen:function(){var e=this,i=document.location.href,a=/v\.youku\.com\/v_show/i,s=a.test(i);s?(e.sideBar.find("a:not(.subBtn)").attr("target","lsidetool"),e.sideBar_w970_custom.find("a").attr("target","lsidetool")):(e.sideBar.find("a:not(.subBtn)").attr("target","_self"),e.sideBar_w970.find("a").attr("target","_self"))},hideNarrowBarInVpageInIE8AtLowWidth:function(){var e=this,i=document.location.href,a=/v\.youku\.com\/v_show/i,s=a.test(i);if(s){var t=window.innerWidth;"number"!=typeof t&&(t="CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth,1100>t||t>1255&&1290>t?(e.sideBar_w970_custom.hide(),e.sidebarMask.css({left:"-160px"})):(e.sideBar_w970_custom.show(),e.sidebarMask.css({left:"-110px"})))}},switchLsideTool:function(){var e=this,i=jQuery(document.body),a=window.innerWidth,s=e.sideBar_w970.children().length,t=e.sideBar_w970[0]?e.sideBar_w970:e.sideBar_w970_custom;switch("number"!=typeof a&&(a="CSS1Compat"==document.compatMode?document.documentElement.clientWidth:document.body.clientWidth),!0){case 1075>a:e.isWide=!1,t.is(":animated")||t.css({display:"block"}).animate({left:"-50px"},200,function(){e.miniSidebar.show(),e.isNsidebarPopout=!0}),e.sideBar.is(":animated")||e.sidebarMask.is(":animated")||e.sideBar.animate({left:"-160px"},300),e.sidebarMask.css({left:"-141px"}),i.hasClass("body-offset-w1190")?i.removeClass("body-offset-w1190").addClass("body-offset-mini"):i.hasClass("body-offset-w970")?i.removeClass("body-offset-w970").addClass("body-offset-mini"):i.addClass("body-offset-mini");break;case 1400>a&&a>=1075:e.isWide=!1,t.is(":animated")||t.css({display:"block"}).animate({left:"0px"},200,function(){e.miniSidebar.hide(),e.isNsidebarPopout=!1}),e.sidebarMask.css({left:"-110px"}),s&&(e.nHaveLoaded||e.loadSubDataToNsidebar(),e.sideBar.is(":animated")||e.sidebarMask.is(":animated")||e.sideBar.animate({left:"-160px"},300)),i.hasClass("body-offset-w1190")?i.removeClass("body-offset-w1190").addClass("body-offset-w970"):i.hasClass("body-offset-mini")?i.removeClass("body-offset-mini").addClass("body-offset-w970"):i.addClass("body-offset-w970");break;case a>=1400:e.isNsidebarPopout=!1,s?(e.isWide=!0,i.hasClass("body-offset-w970")?i.removeClass("body-offset-w970").addClass("body-offset-w1190"):i.hasClass("body-offset-mini")?i.removeClass("body-offset-mini").addClass("body-offset-w1190"):i.addClass("body-offset-w1190"),e.sidebarMask.css({left:"0px"}),e.sideBar.is(":animated")||e.sidebarMask.is(":animated")||e.sideBar.css({display:"block"}).animate({left:"0px"},300,function(){e.sideBar_w970.css({display:"block",left:"-50px"}),e.haveLoaded||e.loadSubscribeData()})):(e.sidebarMask.css({left:"-110px"}),t.is(":animated")||"-50px"!=t.css("left")||t.css({display:"block"}).animate({left:"0px"},200,function(){e.miniSidebar.hide()}))}},switchNavTab:function(e){var i,a,s=jQuery(".ykSideMenu"),t=s.length;if(t)for(var r=0;t>r;r++)a=jQuery(s[r]),i=a.children(),jQuery(i[e]).find("a").addClass("selected")},initGlobalEvents:function(){var e=this,i=null,a=e.sideBar_w970[0]?e.sideBar_w970:e.sideBar_w970_custom;jQuery(window).resize(function(){e.initSize(),e.switchLsideTool(),e.hideNarrowBarInVpageInIE8AtLowWidth()}),e.miniSidebar.on("click",function(){e.sidebarMask.css({left:"-110px"}),a.css({display:"block",left:"-50px"}).animate({left:"0px"},300,function(){e.miniSidebar.hide(),e.isNsidebarPopout=!0,e.sideBar_w970[0]&&!e.nHaveLoaded&&e.loadSubDataToNsidebar()})}),a.on("mouseleave",function(){e.userInfoTip.remove(),e.isNsidebarPopout&&"0px"==a.css("left")&&(i=setTimeout(function(){e.sidebarMask.css({left:"-160px"}),a.is(":animated")||a.animate({left:"-50px"},200,function(){e.miniSidebar.show(),clearTimeout(i)})},3e3))}).on("mouseenter",function(){clearTimeout(i)}).on("click",function(e){e.stopPropagation()}),jQuery("body").on("click",function(){e.isNsidebarPopout&&"0px"==a.css("left")&&(e.sidebarMask.css({left:"-160px"}),a.is(":animated")||a.animate({left:"-50px"},200,function(){e.miniSidebar.show(),clearTimeout(i)}))})},loadSubDataToNsidebar:function(){var e=this,i=jQuery("#yknSideSub").height(),a=i/44;a=Math.floor(a),a=a>15?15:a,e.loadSubscribeData(a,2)},loadSubscribeData:function(e,i){var a=this,s={page_length:e||20,type:i||2};a.isWide?a.loadingImg.css({width:"64px",height:"62px",margin:"-31px 0 0 -32px"}).appendTo(a.subEle):a.loadingImg.css({width:"40px",height:"40px",margin:"-20px 0 0 -20px"}).appendTo(a.nSubEle),jQuery.ajax({url:"http://www.youku.com/index/getUserSubList",type:"GET",data:s,dataType:"JSONP",timeout:5e3,success:function(i){a.subData=i,0===i.length?(e-=1,a.getRecmmondData(e)):a.isWide?a.appendDataToSubArea():a.appendDataToNsubArea()},error:function(){a.subData=null,a.getRecmmondData()}})},getRecmmondData:function(e){var i=this,a=i.subData?i.subData.length:0,s=i.getUID(),t=encodeUid(s),r=i.getCookie("__ysuid"),o={guid:r,apptype:1,pg:8,module:6,site:1};i.isWide&&a>=20?i.appendDataToSubArea():(o.pl=e||15,jQuery.ajax({url:"http://ykrec.youku.com/uploader/packed/list.json",type:"GET",data:o,dataType:"JSONP",timeout:5e3,success:function(e){i.recData=e.data,i.checkFriendship(i.recData,t)},error:function(){i.recData=null,i.isWide?i.appendDataToSubArea():i.appendDataToNsubArea()}}))},checkFriendship:function(e,i){for(var a,s,t=this,r=e.length,o="[",n=0;r>n;n++)a=e[n].spaceUrl,s=a.substring(21),s=n!==r-1?'"'+s+'",':'"'+s+'"',o+=s;o+="]",jQuery.ajax({url:"http://yws.youku.com/friendships/js_show.json",type:"GET",data:{source_uid:i,target_array_uid:o},dataType:"JSONP",success:function(e){e=e.target;var i=t.getUA();if(i.ie>8){var a={};e.forEach(function(e,i){e.followed&&(a[i]=null)});var s=t.recData.filter(function(e,i){return!(i in a)});s.length>10&&(s=s.slice(0,10)),t.recData=s}t.isWide?sidebar.appendDataToSubArea():sidebar.appendDataToNsubArea()},error:function(){t.isWide?sidebar.appendDataToSubArea():sidebar.appendDataToNsubArea()}})},getUID:function(){var e=this,i=e.getCookie("yktk"),a=0;if(i)try{var s=decode64(decodeURIComponent(i).split("|")[3]);s.indexOf(",")>-1&&s.indexOf("nn:")>-1&&s.indexOf("id:")>-1&&(a=s.split(",")[0].split(":")[1])}catch(t){}return parseInt(a)},getCookie:function(e){var i=encodeURIComponent(e)+"=",a=document.cookie.indexOf(i),s=null;if(a>-1){var t=document.cookie.indexOf(";",a);-1==t&&(t=document.cookie.length),s=decodeURIComponent(document.cookie.substring(a+i.length,t))}return s},appendDataToNsubArea:function(){var e=this,i=e.subData?e.subData.length:0,a=e.recData?e.recData.length:0,s=jQuery("#yknSideSub"),t="";if(i){t+="<ul>";for(var r=0;i>r;r++)e.subData.icon=e.subData.icon||"http://static.youku.com/v1.0.1036/user/img/head/64/999.jpg",t+='<li><a uid = "'+e.subData[r].uid+'" href="http://i.youku.com/u/'+e.subData[r].uid_encode+'?from=sidebar"><img alt="'+e.subData[r].user_name+'" class="userImg" src="'+e.subData[r].icon+'"/></a></li>';t+="</ul>"}else if(a){t+='<h2 class="nSub-header">æ¨è</h2>',t+="<ul>";for(var r=0;a>r;r++)e.recData[r].picUrl=e.recData[r].picUrl||"http://static.youku.com/v1.0.1036/user/img/head/64/999.jpg",t+='<li><a uid = "'+e.recData[r].id+'"unsub = "1" class="info" href="'+e.recData[r].spaceUrl+'?from=sidebar_rec"><img alt="'+e.recData[r].username+'" class="userImg" src="'+e.recData[r].picUrl+'"/></a></li>';t+="</ul>"}e.loadingImg.remove(),(i||a)&&(e.nHaveLoaded=!0,s.html(t),e.hoverSubscribe(s))},hoverSubscribe:function(e){var i,a,s,t,r,o=this,n=o.userInfoTip;e.find("li").on("mouseenter",function(e){r=jQuery(e.target),i=r.find("img").attr("src"),a=r.find("img").attr("alt"),s=1*r.attr("unsub"),t=r.attr("uid"),t=encodeUid(t),n.find("img").attr("src",i),n.find("h2").text(a),s?n.attr("class","detailTip").find("#tipSub").attr("class","sub-btn").text("è®¢é").on("click",function(){QUcenter.follow(t,"13-1",function(i){(1===i||2===i)&&(n.find("#tipSub").unbind("click").attr("class","sub-btn-disable").text("å·²è®¢é"),e.target.setAttribute("unsub","0"))})}):n.attr("class","detailTip-sub"),o.userInfoTip.appendTo(jQuery(e.target).parent())})},appendDataToSubArea:function(){var e=this,i=e.subData?e.subData.length:0,a=e.recData?e.recData.length:0,s="";if(i?s='<div class="header"><h2>æè¿è®¢é</h2></div>':a&&(s='<div class="header"><h2>ä½ å¯è½åæ¬¢</h2></div>'),i){s+='<div id="subscribeBody" class="sub-bd">',s+='<div class="mySub">',s+='<ul class="mySub-list">';for(var t=0;i>t;t++)e.subData.icon=e.subData.icon||"http://static.youku.com/v1.0.1036/user/img/head/64/999.jpg",s+='<li><a href="http://i.youku.com/u/'+e.subData[t].uid_encode+'?from=sidebar"><img src="'+e.subData[t].icon+'"/>'+e.subData[t].user_name+"</a></li>";s+="</ul>",s+="</div>"}else s+='<div id="subscribeBody" class="sub-bd">';if(i&&a&&(s+='<div class="split-inner"></div>'),a){s+='<div class="recommend">',i&&(s+='<div class="header"> <h2>ä½ å¯è½åæ¬¢</h2></div>'),s+='<ul class="rec-list">';for(var t=0;a>t;t++)e.recData[t].picUrl=e.recData[t].picUrl||"http://static.youku.com/v1.0.1036/user/img/head/64/999.jpg",s+='<li><a class="info" href="'+e.recData[t].spaceUrl+'?from=sidebar_rec"><img src="'+e.recData[t].picUrl+'"/>'+e.recData[t].username+'</a><a class="subBtn">è®¢é</a></li>';s+="</ul>",s+="</div>",s+="</div>"}else s+="</div>";e.loadingImg.remove(),e.haveLoaded=!0,e.subEle.html(s);var r=e.subEle.height()-48;e.subEle.find("#subscribeBody").height(r),jQuery(".yk-side-sub li").hover(function(){jQuery(this).css("background","#e7e7e7"),jQuery(this).find(".subBtn").css("display","block")},function(){jQuery(this).css("background","transparent"),jQuery(this).find(".subBtn").css("display","none")}),jQuery("#subscribeBody .rec-list li .subBtn").click(function(){var e=jQuery(this).prev().attr("href").substring(21),i=jQuery(this);QUcenter.follow(e,"",function(e){(1===e||2===e)&&sidebar.sideBarSubFly(i)})}),e.switchLinkOpen(),e.addScrollbarObj();var o=jQuery("#subscribeBody");o.scroll(function(){var e=o.find(".mySub").height(),i=0;e&&(i=e+63);var a=o.scrollTop();o.prev().find("h2").text(a>=i?"ä½ å¯è½åæ¬¢":"æè¿è®¢é")})},addScrollbarObj:function(){var e=this,i=e.getUA();if(i.safari){var a=jQuery("#subscribeBody");a.css({"overflow-y":"scroll"})}else try{jQuery("<div></div>").niceScroll(),e.customScrollbar()}catch(s){var t=document.createElement("script"),r="http://r2.ykimg.com/0510000055081DBD6737B337E70C3CAB.js";t.type="text/javascript",t.src=r,document.getElementsByTagName("head")[0].appendChild(t),t.onload=function(){e.customScrollbar()}}},customScrollbar:function(){var e=jQuery("#subscribeBody");e.niceScroll({cursoropacitymax:.4,cursorwidth:"7px",cursorborderradius:"7px",background:"rgba(0,0,0,.2)"})},sideBarSubFly:function(e){var i=this,a=jQuery(e),s=a.prev(),t=s.attr("href"),r=s.find("img").attr("src"),o=s.text();a.parent().slideUp();var n=jQuery("#subscribeBody"),d=n.scrollTop();d*=-1;var c=i.getUA();c.safari?n.scrollTop(d):n.getNiceScroll(0).doScrollTop(d),setTimeout(function(){i.addNewSubAnimation(t,r,o)},300)},isExistInRecList:function(e){for(var i,a,s=jQuery("#subscribeBody .rec-list"),t=s.find("li"),r=t.length,o=0;r>o;o++)i=jQuery(t[o]).find("a").attr("href"),a=i.substring(21),a===e&&jQuery(t[o]).slideUp()},pageSubFly:function(e,i,a,s){var t=sidebar,r="http://i.youku.com/u/"+i;e=jQuery(e);var o=jQuery("#subscribeBody").scrollTop();o&&(o*=-1,jQuery("#subscribeBody").scrollTop(o));var n=t.getUA();if(n.ie&&1*n.ie<=9)t.addNewSubAnimation(r,a,s);else{var d,c,u,l,b=jQuery(document).scrollTop(),f=jQuery(document).scrollLeft(),p=e.offset().left-f,m=e.offset().top-b,h='<img src="'+a+'" />';t.isWide?(d=20,c=342):(d="10px",c="200px",u="30px",l="30px"),jQuery(h).css({position:"fixed",top:m,left:p,"z-index":"100000"}).appendTo("body").animate({top:c,left:d,width:u||"20px",height:l||"20px"},1e3,function(){if(t.isWide)jQuery(this).remove();else{jQuery(this).fadeOut(600);var e=t.sideBar_w970[0]?t.sideBar_w970:t.sideBar_w970_custom,i=e.find(".icon-3").parent(),a=["#f5f5f5","#e7e7e7","#f5f5f5","#e7e7e7","#f5f5f5","#e7e7e7","#f5f5f5"],s=0,r=a.length-1,o=setInterval(function(){i[0].style.background=a[s],r>s?s++:(i.hasClass("selected")&&(i[0].style.background="#06a7e1"),clearInterval(o))},100)}}),setTimeout(function(){t.addNewSubAnimation(r,a,s)},700)}},getUA:function(){var e,i={},a=navigator.userAgent.toLowerCase();return(e=a.match(/rv:([\d.]+)\) like gecko/))?i.ie=e[1]:(e=a.match(/msie ([\d.]+)/))?i.ie=e[1]:(e=a.match(/firefox\/([\d.]+)/))?i.firefox=e[1]:(e=a.match(/chrome\/([\d.]+)/))?i.chrome=e[1]:(e=a.match(/opera.([\d.]+)/))?i.opera=e[1]:(e=a.match(/version\/([\d.]+).*safari/))?i.safari=e[1]:0,i},addNewSubAnimation:function(e,i,a){var s='<li class="new-item"><div class="content-layer"><a target="_blank" href="'+e+'"><img src="'+i+'" alt="å¤´å"/>'+a+'</a></div><div class="bg-layer">åè®¢é</div></li>',t=jQuery(s),r=jQuery("#subscribeBody .mySub-list")[0];if(!r){var o=jQuery("#subscribeBody"),n=o.parent(),d=o.find(".recommend");n.find(".header h2").text("æè¿è®¢é"),d.prepend('<div class="header"><h2>ä½ å¯è½åæ¬¢</h2></div>'),o.prepend('<div class="mySub"><ul class="mySub-list"></ul></div><div class="split-inner"></div>')}t.prependTo("#subscribeBody .mySub-list").slideDown("normal",function(){setTimeout(function(){t.find(".bg-layer").fadeOut(300,function(){t.find(".content-layer a").css({color:"#555"})})},3e3)}).hover(function(){t.css("background","#e7e7e7")},function(){t.css("background","transparent")})}};if(window.jQuery)jQuery.noConflict(),jQuery(function(){sidebar.init()});else{var _script=document.createElement("script"),url="http://static.youku.com/js/jquery.js";_script.type="text/javascript",_script.src=url,document.getElementsByTagName("head")[0].appendChild(_script),_script.onload=function(){jQuery.noConflict(),jQuery(function(){sidebar.init()})}}