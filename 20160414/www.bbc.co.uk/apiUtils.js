define(["idcta/es6-promise"],function(d){var c={};var b=3600000;c.verifyEndpointUrl=function(e,g){if(g!==false){g=true}var h=new RegExp(/https?:\/\/(((www|ssl)(\.int|\.test|\.stage)?)|(pal\.sandbox\.dev))\.bbc\.(co\.uk|com)/);if(h.test(e)){if(new RegExp(/(\.com|\.co\.uk)\/.+/).test(e)){e=e.split(/(\.com|\.co\.uk)\/.+/)[0]+e.split(/(\.com|\.co\.uk)\/.+/)[1]}return e}var j="";if(e.slice(0,5)=="https"){j+=((g?"https://":"")+"ssl.");if(e.indexOf(".sandbox.")>-1){j+="sandbox.dev."}}else{j+=((g?"http://":""));if(e.indexOf(".sandbox.")>-1){j+="pal.sandbox.dev."}else{j+="www."}}var f=["int","test","stage"];for(i=0;i<f.length;i++){if(e.indexOf("."+f[i]+".")>-1){j+=f[i]+"."}}if(new RegExp(/\.co\.uk/).test(e)){j+="bbc.co.uk"}else{j+="bbc.com"}return j};c.modifyTLD=function(g,e){var j=e||window.location.hostname;var h=j.split(/(\.com|\.co\.uk)$/)[1];var f=g.split(/(\.com|\.co\.uk)\/.+/)[1];if(f!==h&&h!==undefined){g=g.replace(f,h)}return g};c.buildIdappResourceUrl=function(f,e){var h;var g;if(RegExp(/^https/).test(f)){h="https"}else{h="http"}if(new RegExp(/\.sandbox\./).test(f)){g="sandbox.dev."}else{if(new RegExp(/\.int\./).test(f)){g="int."}else{if(new RegExp(/\.test\./).test(f)){g="test."}else{if(new RegExp(/\.stage\./).test(f)){g="stage."}else{g=""}}}}return h+"://static."+g+(h==="https"?"bbc":"bbci")+".co.uk/idapp/"+e+"/modules/idapp/idapp-1"};function a(){if(typeof Promise!=="undefined"){return Promise}return d.Promise}c.Promise=a();c.loadUrlInHiddenIframe=function(g,f,e){return new c.Promise(function(k,j){var h=document.createElement("iframe");h.scrolling="no";h.frameborder="0";h.width="0px";h.height="0px";h.border="0px";h.style.display="none";h.style.frameBorder="0px";h.style.borderStyle="none";var n=null;var l=function(p){var o=p.message?"message":"data";if(!p.origin.match(/\.bbc\.(co\.uk|com)(:[0-9]+)*$/)||e.indexOf(p[o])==-1){return}m();return k(p[o])};var m=function(){if(n){clearTimeout(n)}if(e){c.removeEventListener("message",l)}document.body.removeChild(h)};if(e){c.addEventListener("message",l)}else{h.onload=function(){m();return k()}}if(f){n=setTimeout(function(){m();return j()},f)}h.src=g;document.body.appendChild(h)})};c.addEventListener=function(f,g,e){if(window.addEventListener){return window.addEventListener(f,g,e)}f=(f=="message")?"onmessage":f;return window.attachEvent(f,g)};c.removeEventListener=function(e,f){if(window.removeEventListener){return window.removeEventListener(e,f)}e=(e=="message")?"onmessage":e;return window.detachEvent(e,f)};c.getHardcodedUrl=function(){var e=window.location.href;if(e.indexOf(".sandbox.")>-1){return"https://ssl.sandbox.dev.bbc.co.uk"}else{if(e.indexOf(".int.")>-1){return"https://ssl.int.bbc.co.uk"}else{if(e.indexOf(".test.")>-1){return"https://ssl.test.bbc.co.uk"}else{if(e.indexOf(".stage.")>-1){return"https://ssl.stage.bbc.co.uk"}else{return"https://ssl.bbc.co.uk"}}}}};c.parseUrl=function(f){var e=document.createElement("a");e.href=f;e.query=(e.search)?c.parseQueryString(e.search):{};return e};c.parseQueryString=function(j){if(j.charAt(0)==="?"){j=j.substring(1)}var f={};var g=j.split("&");for(var e=0;e<g.length;e++){var h=g[e].split("=");f[decodeURIComponent(h[0])]=decodeURIComponent(h[1]||"")}return f};c.timestampInFuture=function(f){var e=(new Date()).getTime();return f>e};c.timestampExpired=function(f){var e=(new Date()).getTime();return f<e};c.generateFutureTimestamp=function(e){var e=e?e:b;var f=new Date();f.setTime(f.getTime()+e);return f.getTime()};return c});