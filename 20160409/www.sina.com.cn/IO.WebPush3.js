var IO=IO||{};!function(){function checkNative(){return"function"!=typeof WebSocket&&"object"!=typeof WebSocket||WebSocket.isNotNative||/version\/5[\s\S]*safari/i.test(navigator.userAgent)?!1:!0}function log(e){window.console&&window.console.log&&console.log(e)}function addEvent(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function removeEvent(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent("on"+t,n)}function getHashCode(e,t){t||(e=e.toLowerCase());var n,i,o=1315423911;for(n=e.length-1;n>=0;n--)i=e.charCodeAt(n),o^=(o<<5)+i+(o>>2);return 2147483647&o}function merge(e,t){for(var n in t)e[n]="object"==typeof e[n]&&"object"==typeof t[n]?arguments.callee(t[n],e[n]):t[n];return e}function fnBind(e,t,n){return function(){if(n&&arguments.length)for(var i=Array.prototype.slice.call(n,0),o=0;o<arguments.length;o++)Array.prototype.push.call(i,arguments[o]);return e.apply(t||this,i||n||arguments)}}function bindArg(e){return fnBind(e,null,Array.prototype.slice.call(arguments,1))}function getScript(e,t,n){var i=document.createElement("script");i.type="text/javascript",n&&(i.charset=n),i.src=e;var o=document.getElementsByTagName("head")[0],s=!1;i.onload=i.onreadystatechange=function(){s||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(s=!0,t&&setTimeout(t,1),i.onload=i.onreadystatechange=null,setTimeout(function(){o.removeChild(i)},1))},setTimeout(function(){o.appendChild(i)},1)}var swfobject=function(){function e(){if(!G){try{var e=x.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}G=!0;for(var n=D.length,i=0;n>i;i++)D[i]()}}function t(e){G?e():D[D.length]=e}function n(e){if(typeof j.addEventListener!=I)j.addEventListener("load",e,!1);else if(typeof x.addEventListener!=I)x.addEventListener("load",e,!1);else if(typeof j.attachEvent!=I)b(j,"onload",e);else if("function"==typeof j.onload){var t=j.onload;j.onload=function(){t(),e()}}else j.onload=e}function i(){K?o():s()}function o(){var e=x.getElementsByTagName("body")[0],t=m(N);t.setAttribute("type",A);var n=e.appendChild(t);if(n){var i=0;!function(){if(typeof n.GetVariable!=I){var o=n.GetVariable("$version");o&&(o=o.split(" ")[1].split(","),V.pv=[parseInt(o[0],10),parseInt(o[1],10),parseInt(o[2],10)])}else if(10>i)return i++,void setTimeout(arguments.callee,10);e.removeChild(t),n=null,s()}()}else s()}function s(){var e=$.length;if(e>0)for(var t=0;e>t;t++){var n=$[t].id,i=$[t].callbackFn,o={success:!1,id:n};if(V.pv[0]>0){var s=p(n);if(s)if(!g($[t].swfVersion)||V.wk&&V.wk<312)if($[t].expressInstall&&c()){var h={};h.data=$[t].expressInstall,h.width=s.getAttribute("width")||"0",h.height=s.getAttribute("height")||"0",s.getAttribute("class")&&(h.styleclass=s.getAttribute("class")),s.getAttribute("align")&&(h.align=s.getAttribute("align"));for(var f={},u=s.getElementsByTagName("param"),d=u.length,v=0;d>v;v++)"movie"!=u[v].getAttribute("name").toLowerCase()&&(f[u[v].getAttribute("name")]=u[v].getAttribute("value"));r(h,f,n,i)}else l(s),i&&i(o);else y(n,!0),i&&(o.success=!0,o.ref=a(n),i(o))}else if(y(n,!0),i){var m=a(n);m&&typeof m.SetVariable!=I&&(o.success=!0,o.ref=m),i(o)}}}function a(e){var t=null,n=p(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=I)t=n;else{var i=n.getElementsByTagName(N)[0];i&&(t=i)}return t}function c(){return!U&&g("6.0.65")&&(V.win||V.mac)&&!(V.wk&&V.wk<312)}function r(e,t,n,i){U=!0,C=i||null,E={success:!1,id:n};var o=p(n);if(o){"OBJECT"==o.nodeName?(w=h(o),k=null):(w=o,k=n),e.id=F,(typeof e.width==I||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==I||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),x.title=x.title.slice(0,47)+" - Flash Player Installation";var s=V.ie&&V.win?"ActiveX":"PlugIn",a="MMredirectURL="+j.location.toString().replace(/&/g,"%26")+"&MMplayerType="+s+"&MMdoctitle="+x.title;if(typeof t.flashvars!=I?t.flashvars+="&"+a:t.flashvars=a,V.ie&&V.win&&4!=o.readyState){var c=m("div");n+="SWFObjectNew",c.setAttribute("id",n),o.parentNode.insertBefore(c,o),o.style.display="none",function(){4==o.readyState?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}f(e,t,n)}}function l(e){if(V.ie&&V.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(h(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(h(e),e)}function h(e){var t=m("div");if(V.win&&V.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(N)[0];if(n){var i=n.childNodes;if(i)for(var o=i.length,s=0;o>s;s++)1==i[s].nodeType&&"PARAM"==i[s].nodeName||8==i[s].nodeType||t.appendChild(i[s].cloneNode(!0))}}return t}function f(e,t,n){var i,o=p(n);if(V.wk&&V.wk<312)return i;if(o)if(typeof e.id==I&&(e.id=n),V.ie&&V.win){var s="";for(var a in e)e[a]!=Object.prototype[a]&&("data"==a.toLowerCase()?t.movie=e[a]:"styleclass"==a.toLowerCase()?s+=' class="'+e[a]+'"':"classid"!=a.toLowerCase()&&(s+=" "+a+'="'+e[a]+'"'));var c="";for(var r in t)t[r]!=Object.prototype[r]&&(c+='<param name="'+r+'" value="'+t[r]+'" />');o.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+s+">"+c+"</object>",R[R.length]=e.id,i=p(e.id)}else{var l=m(N);l.setAttribute("type",A);for(var h in e)e[h]!=Object.prototype[h]&&("styleclass"==h.toLowerCase()?l.setAttribute("class",e[h]):"classid"!=h.toLowerCase()&&l.setAttribute(h,e[h]));for(var f in t)t[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&u(l,f,t[f]);o.parentNode.replaceChild(l,o),i=l}return i}function u(e,t,n){var i=m("param");i.setAttribute("name",t),i.setAttribute("value",n),e.appendChild(i)}function d(e){var t=p(e);t&&"OBJECT"==t.nodeName&&(V.ie&&V.win?(t.style.display="none",function(){4==t.readyState?v(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function v(e){var t=p(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function p(e){var t=null;try{t=x.getElementById(e)}catch(n){}return t}function m(e){return x.createElement(e)}function b(e,t,n){e.attachEvent(t,n),P[P.length]=[e,t,n]}function g(e){var t=V.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function _(e,t,n,i){if(!V.ie||!V.mac){var o=x.getElementsByTagName("head")[0];if(o){var s=n&&"string"==typeof n?n:"screen";if(i&&(W=null,O=null),!W||O!=s){var a=m("style");a.setAttribute("type","text/css"),a.setAttribute("media",s),W=o.appendChild(a),V.ie&&V.win&&typeof x.styleSheets!=I&&x.styleSheets.length>0&&(W=x.styleSheets[x.styleSheets.length-1]),O=s}V.ie&&V.win?W&&typeof W.addRule==N&&W.addRule(e,t):W&&typeof x.createTextNode!=I&&W.appendChild(x.createTextNode(e+" {"+t+"}"))}}}function y(e,t){if(J){var n=t?"visible":"hidden";G&&p(e)?p(e).style.visibility=n:_("#"+e,"visibility:"+n)}}function S(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=I?encodeURIComponent(e):e}{var w,k,C,E,W,O,I="undefined",N="object",T="Shockwave Flash",L="ShockwaveFlash.ShockwaveFlash",A="application/x-shockwave-flash",F="SWFObjectExprInst",B="onreadystatechange",j=window,x=document,M=navigator,K=!1,D=[i],$=[],R=[],P=[],G=!1,U=!1,J=!0,V=function(){var e=typeof x.getElementById!=I&&typeof x.getElementsByTagName!=I&&typeof x.createElement!=I,t=M.userAgent.toLowerCase(),n=M.platform.toLowerCase(),i=/win/.test(n?n:t),o=/mac/.test(n?n:t),s=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,a=!1,c=[0,0,0],r=null;if(typeof M.plugins!=I&&typeof M.plugins[T]==N)r=M.plugins[T].description,!r||typeof M.mimeTypes!=I&&M.mimeTypes[A]&&!M.mimeTypes[A].enabledPlugin||(K=!0,a=!1,r=r.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=parseInt(r.replace(/^(.*)\..*$/,"$1"),10),c[1]=parseInt(r.replace(/^.*\.(.*)\s.*$/,"$1"),10),c[2]=/[a-zA-Z]/.test(r)?parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof j.ActiveXObject!=I)try{var l=new ActiveXObject(L);l&&(r=l.GetVariable("$version"),r&&(a=!0,r=r.split(" ")[1].split(","),c=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)]))}catch(h){}return{w3:e,pv:c,wk:s,ie:a,win:i,mac:o}}();!function(){V.w3&&((typeof x.readyState!=I&&"complete"==x.readyState||typeof x.readyState==I&&(x.getElementsByTagName("body")[0]||x.body))&&e(),G||(typeof x.addEventListener!=I&&x.addEventListener("DOMContentLoaded",e,!1),V.ie&&V.win&&(x.attachEvent(B,function(){"complete"==x.readyState&&(x.detachEvent(B,arguments.callee),e())}),j==top&&!function(){if(!G){try{x.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),V.wk&&!function(){return G?void 0:/loaded|complete/.test(x.readyState)?void e():void setTimeout(arguments.callee,0)}(),n(e)))}(),function(){V.ie&&V.win&&window.attachEvent("onunload",function(){for(var e=P.length,t=0;e>t;t++)P[t][0].detachEvent(P[t][1],P[t][2]);for(var n=R.length,i=0;n>i;i++)d(R[i]);for(var o in V)V[o]=null;V=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}()}return{registerObject:function(e,t,n,i){if(V.w3&&e&&t){var o={};o.id=e,o.swfVersion=t,o.expressInstall=n,o.callbackFn=i,$[$.length]=o,y(e,!1)}else i&&i({success:!1,id:e})},getObjectById:function(e){return V.w3?a(e):void 0},embedSWF:function(e,n,i,o,s,a,l,h,u,d){var v={success:!1,id:n};V.w3&&!(V.wk&&V.wk<312)&&e&&n&&i&&o&&s?(y(n,!1),t(function(){i+="",o+="";var t={};if(u&&typeof u===N)for(var p in u)t[p]=u[p];t.data=e,t.width=i,t.height=o;var m={};if(h&&typeof h===N)for(var b in h)m[b]=h[b];if(l&&typeof l===N)for(var _ in l)typeof m.flashvars!=I?m.flashvars+="&"+_+"="+l[_]:m.flashvars=_+"="+l[_];if(g(s)){var S=f(t,m,n);t.id==n&&y(n,!0),v.success=!0,v.ref=S}else{if(a&&c())return t.data=a,void r(t,m,n,d);y(n,!0)}d&&d(v)})):d&&d(v)},switchOffAutoHideShow:function(){J=!1},ua:V,getFlashPlayerVersion:function(){return{major:V.pv[0],minor:V.pv[1],release:V.pv[2]}},hasFlashPlayerVersion:g,createSWF:function(e,t,n){return V.w3?f(e,t,n):void 0},showExpressInstall:function(e,t,n,i){V.w3&&c()&&r(e,t,n,i)},removeSWF:function(e){V.w3&&d(e)},createCSS:function(e,t,n,i){V.w3&&_(e,t,n,i)},addDomLoadEvent:t,addLoadEvent:n,getQueryParamValue:function(e){var t=x.location.search||x.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return S(t);for(var n=t.split("&"),i=0;i<n.length;i++)if(n[i].substring(0,n[i].indexOf("="))==e)return S(n[i].substring(n[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(U){var e=p(F);e&&w&&(e.parentNode.replaceChild(w,e),k&&(y(k,!0),V.ie&&V.win&&(w.style.display="block")),C&&C(E)),U=!1}}}}();if(WEB_SOCKET_SWF_LOCATION=window.WEB_SOCKET_SWF_LOCATION||"http://i2.sinaimg.cn/woocall/swf/sina_financews_20150514c.swf",checkNative()||!function(){var e;return e=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}},swfobject.getFlashPlayerVersion().major<10?(e.error("Flash Player >= 10.0.0 is required."),window.WebSocket=window.WebSocket||{},window.WebSocket.canUse=!1,void(window.WebSocket.isNotNative=!0)):("file:"==location.protocol&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(e,t,n,i,o){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?"string"==typeof t&&(t=[t]):t=[],s.__createTask=setTimeout(function(){WebSocket.__addTask(function(){s.__createTask=null,WebSocket.__flash.create(s.__id,e,t,n||null,i||0,o||null)})},0)},window.WebSocket.isNotNative=!0,WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return 0>t?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.initFlashLC=function(e,t){WebSocket.__flash.init(e,t)},WebSocket.prototype.close=function(){return this.__createTask?(clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=WebSocket.CLOSED)):void(this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)))},WebSocket.prototype.addEventListener=function(e,t){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t){if(e in this.__events)for(var n=this.__events[e],i=n.length-1;i>=0;--i)if(n[i]===t){n.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){for(var t=this.__events[e.type]||[],n=0;n<t.length;++n)t[n](e);var i=this["on"+e.type];i&&i.apply(this,[e])},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if("open"==e.type||"error"==e.type)t=this.__createSimpleEvent(e.type);else if("close"==e.type)t=this.__createSimpleEvent("close"),t.wasClean=e.wasClean?!0:!1,t.code=e.code,t.reason=e.reason;else{if("message"!=e.type)throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.canUse=!0,WebSocket.__initialize=function(){if(!WebSocket.__initialized){if(WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){RegExp.$1}var t=document.createElement("div");t.id="webSocketContainer",t.style.position="absolute",WebSocket.__isFlashLite()?(t.style.left="0px",t.style.top="0px"):(t.style.left="-100px",t.style.top="-100px");var n=document.createElement("div");n.id="webSocketFlash",t.appendChild(n),document.body.insertBefore(t,document.body.childNodes[0]),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||(WebSocket.canUse=!1,e.error("[WebSocket] swfobject.embedSWF failed"))})}},WebSocket.flashOK=!1,WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.flashOK=!0,WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var t=WebSocket.__flash.receiveEvents(),n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(i){e.error(i)}},0),!0},WebSocket.__log=function(e){},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return e&&e.enabledPlugin&&e.enabledPlugin.filename&&e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},void(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})))}(),!IO.WebPush3)if(IO.WebPush3=function(e,t,n,i){this.id="ws_"+getHashCode(e+t),this.host=e||"hq.sinajs.cn",this.list=(t+"").split(","),this.onmessage=n,this.cfg=merge({interval:3,format:"",local:!1,ondebug:function(){},onMode:function(){}},i||{}),this.cfg.interval<1&&(this.cfg.interval=1,log("Ë¢ÐÂÊ±¼ä¼ä¸ôÒÑÄ¬ÈÏÖÁ1Ãë")),this.init()},merge(IO.WebPush3.prototype,{socket:void 0,connection:void 0,localConn:void 0,mode:void 0,hasInit:!1,init:function(){if(!this.hasInit){if(!(this.tryNative()||this.tryFlash()||this.tryJS()))return this.tryInitLater(),!1;this.hasInit=!0,(this.tryNative()||this.tryFlash())&&(this.cfg.local?this.createLocalConn():this.subscribe())}},tryInitLater:function(){setTimeout(fnBind(this.init,this),100)},createLocalConn:function(){this.cfg.ondebug("Ê¹ÓÃlocalConn");var e=this;this.localConn=new IO.LocalConn({key:this.id,onmessage:function(t){e.listen(t)},onchange:function(){e.subscribe()}})},beMyaster:function(e){"master"==e?this.connection||this.subscribe():this.close()},subscribe:function(){},receive:function(){},close:function(){},onClose:function(){},listen:function(data){function _makeKV($0,$1,$2){try{_data[$1]="json"==_format?eval("("+$2+")"):$2,_hasData=!0}catch(e){}}if(data){for(var _messages=data.match(/^[\s\S]+?$/gm),_data={},_format=this.cfg.format,_hasData=!1,i=0,l=_messages.length;l>i;i++)/^sys_/.test(_messages[i])||_messages[i].replace(/([^=]*)=([\s\S]*)/,_makeKV);_hasData&&this.onmessage(_data)}},tryNative:function(){return this.cfg.ondebug("³¢ÊÔÔ­Éú"),checkNative()?(this.nativeOK(),this.tryNative=function(){return!0},!0):(this.tryNative=function(){return!1},!1)},nativeOK:function(){this.cfg.ondebug("Ô­Éú¿ÉÓÃ"),this.cfg.onMode("native"),this.socket=WebSocket,this.subscribe=this.subScribeNative,this.receive=this.receiveNative,this.close=this.closeNative,this.onClose=this.onCloseNative},subScribeNative:function(){if(this.cfg.ondebug("±äÖ÷£¬¿ªÊ¼¶©ÔÄ"),this.connection=new this.socket("ws://"+this.host+"/wskt?list="+this.list),!this.socket.isNotNative&&!this.connection.binaryType)return this.connection&&this.connection.close(),this.cfg.ondebug("webSocket²»ÍêÕû£¬²»¿ÉÓÃ"),void this.tryJS(!0);var e=this;this.connection.toLongToConnectTimer=setTimeout(function(){e.connection&&e.connection.close()},4e3/(this.closeTimes+1));var e=this;this.connection.onopen=function(){this.opened=!0,e.resetCloseTimesTimer=setTimeout(function(){e.closeTimes=0},6e5)};var e=this;this.connection.refresher=setInterval(function(){e.connection.opened&&e.connection.send("")},6e4),this.connection.onmessage=fnBind(this.receive,this),this.connection.onclose=fnBind(this.onClose,this)},receiveNative:function(e){clearTimeout(this.connection.toLongToConnectTimer),this.cfg.local?this.localConn.sendc(e.data.replace(/^sys_[\s\S]*?$(\r|\n)/gm,"")):this.listen(e.data.replace(/^sys_[\s\S]*?$(\r|\n)/gm,""))},closeTimes:0,maxRetryTimes:3,closeNative:function(){this.localConn&&this.localConn.close(),this.localConn=null,this.socket=null,this.subscribe=function(){},this.receive=null,this.connection&&(clearInterval(this.connection.refresher),this.connection.onclose=function(){},this.connection.close(),this.connection=null)},onCloseNative:function(){return clearTimeout(this.resetCloseTimesTimer),this.closeTimes++,this.cfg.ondebug("socket¶Ï¿ªÒ»´Î£¬Ä¿Ç°µÚ"+this.closeTimes+"´Î"),clearInterval(this.connection.refresher),this.connection.refresher=this.connection.onmessage=this.connection.onclose=null,this.connection=null,this.closeTimes>=this.maxRetryTimes?(this.cfg.ondebug("³¬¹ý³¢ÊÔ´ÎÊý£¬ÇÐ»»ÎªjsÄ£Ê½"),void this.tryJS(!0)):void this.subscribe()},tryFlash:function(){return this.cfg.ondebug("³¢ÊÔflash£¬»òµÈ´ýflashÖÐ"),WebSocket.flashOK?(this.flashOK(),this.tryFlash=function(){return!0},!0):(WebSocket.canUse||(this.tryFlash=function(){return!1}),!1)},flashOK:function(){this.cfg.ondebug("flash¿ÉÓÃ"),this.cfg.onMode("flash"),this.socket=WebSocket,this.subscribe=this.subScribeNative,this.receive=this.receiveNative,this.close=this.closeNative,this.onClose=this.onCloseNative},tryJS:function(e){return WebSocket.canUse&&!e?!1:window.loadHQ?(this.jsHQOK(),!0):(getScript("http://finance.sina.com.cn/basejs/hq.js",fnBind(this.jsHQOK,this)),!0)},jsHQOK:function(){this.cfg.ondebug("Ê¹ÓÃjsÄ£Ê½"),this.cfg.onMode("js"),this.tryJS=function(){return!0},this.subscribe=this.subScribeJS,this.receive=this.receiveJS,this.close=this.closeJS,this.subscribe()},subScribeJS:function(){var e=bindArg(loadHQ,this.list,fnBind(this.receive,this),{domain:this.host,type:this.cfg.format});e(),this.connection=setInterval(e,1e3*this.cfg.interval)},lastData:{},receiveJS:function(){for(var e,t={},n="json"==this.cfg.format?"hq_json_":"hq_str_",i=0,o=this.list.length;o>i;i++)this.lastData[this.list[i]]!==window[n+this.list[i]]&&(this.lastData[this.list[i]]=t[this.list[i]]=window[n+this.list[i]],e=!0);e&&this.onmessage(t)},closeJS:function(){this.subscribe=function(){},this.localConn&&this.localConn.close(),this.localConn=null,clearInterval(this.connection)}}),"object"==typeof localStorage&&checkNative()){var _iframeID="IO_WEBPUSH3_LOCALCONN_IFRAME",_iframe,_pWin,proxy=void 0;IO.LocalConn=function(e){if(_iframe||((_iframe=document.getElementById(_iframeID))||(_iframe=document.createElement("iframe"),_iframe.id=_iframeID,_iframe.style.display="none",_iframe.src="http://woocall.sina.com.cn/lib/iframe/IO.WebPush3.localConn.htm",document.body.insertBefore(_iframe,document.body.firstChild)),_pWin=_iframe.contentWindow,addEvent(window,"message",function(e){"M OK now!"==e.data&&(proxy={},proxy.postMessage=function(e){_pWin.postMessage(e,"*")},proxy.listen=function(e){addEvent(window,"message",e)})})),!proxy)return void setTimeout(fnBind(arguments.callee,this,arguments),100);this.id="lc"+Math.random(),this.id=this.id.replace("0.",""),this.cfg=merge({key:"",onmessage:function(){},onchange:function(){}},e);var t=this;proxy.listen(function(e){if(-1!=e.data.indexOf(t.id+":")){var n,i;switch(e.data.replace(/([^:]+):([\s\S]*)/,function(){n=arguments[1],i=arguments[2]}),n){case"IO_LOCALCONN_ONCHANGE_"+t.id:t.onchange(i);break;case"IO_LOCALCONN_ONMESSAGE_"+t.id:t.onmessage(i)}}}),proxy.postMessage(["newLocalConn(",this.cfg.key,",",this.id,")"].join(""))},merge(IO.LocalConn.prototype,{onchange:function(e){this.cfg.onchange&&this.cfg.onchange(e)},onmessage:function(e){this.cfg.onmessage&&this.cfg.onmessage(e)},sendc:function(e){e&&proxy.postMessage("IO_LOCALCONN_SEND_"+this.id+":"+e)},close:function(){proxy.postMessage("IO_LOCALCONN_CLOSE_"+this.id+":now!")}})}else IO.LocalConn=function(e){this.cfg=merge({key:"",onmessage:function(){},onchange:function(){}},e),IO.LocalConn.flash={init:function(){}},IO.LocalConn.prototype.sendc=function(e){this.onmessage(e)},this.onchange("master")},merge(IO.LocalConn.prototype,{flashID:"localConnFlash",onchange:function(e){this.cfg.onchange&&this.cfg.onchange(e)},onmessage:function(e){this.cfg.onmessage&&this.cfg.onmessage(e)},sendc:function(e){e&&this.constructor.flash.sendc(this.id,e)},close:function(){}}),IO.LocalConn.flash=!1,IO.LocalConn.objs={},IO.LocalConn.ready=function(){IO.LocalConn.flash=document.localConnFlash||window.localConnFlash},IO.LocalConn.onmessage=function(e,t){this.objs[e].onmessage(t)},IO.LocalConn.onchange=function(e,t){this.objs[e].onchange(t)}}();