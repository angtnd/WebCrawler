(function(){var h={};if(location.protocol==="http:"){h.uploadServer="http://graph.baidu.com/upload"}else{h.uploadServer="https://sp0.baidu.com/-aYHfD0a2gU2pMbgoY3K/upload"}var f=navigator.platform.toUpperCase();var c=$("#kw");var a=c.parent();var v=bds&&bds.comm&&bds.comm.newindex;var i=f.indexOf("MAC")!==-1;var s="result";if(v){s="newindex"}else{if(bds&&bds.comm&&bds.comm.ishome){s="index"}else{if(/^\/imgsearch/.test(location.pathname)){s="imgresult"}}}var u=function(B){B.stopPropagation();B.preventDefault()};var r=location.href.match(/sign=(\w{32})\b/);var y=r&&r[1]||"";function p(B){var C=new RegExp("(^|&)"+B+"=([^&]*)(&|$)","i");var D=window.location.search.substr(1).match(C);if(D!=null){return(D[2])}return null}var e=function(B){B.sign=y;B.fm="inlo";if(B.rsv_imageclick){B.rsv_imageclick=s+"_"+B.rsv_imageclick}window.ns_c(B)};var t=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];var n=t[0]&&t[0].v===1&&t[1]&&t[1].v<=3;var o=t[0]&&t[0].v===1;var d=function(B){return(/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/).test(B)
};var m=1024*1024*10;var g=1024*100;var z={"1":"æ±æ­ï¼æ¨ä¸ä¼ çæä»¶ä¸æ¯å¾çæ ¼å¼","2":"å¾çä¸ä¼ å¤±è´¥"};var q=function(E){var G=$.Deferred();function C(I,J){var H=new FileReader();H.onload=function(){var K=this.result.split("base64,")[1];J(K,this.result)};H.onerror=function(K){J()};H.readAsDataURL(I)}function F(R,I,J){I=I||"";J=J||512;var N=atob(R);var P=[];var M=N.length;for(var K=0;K<M;K+=J){var Q=N.slice(K,K+J);var O=new Array(Q.length);for(var L=0;L<Q.length;L++){O[L]=Q.charCodeAt(L)}var H=new Uint8Array(O);P.push(H)}return new Blob(P,{type:I})}function B(J){var M=J.width;var H=J.height;if(M>800||H>800){var L=Math.max(M/800,H/800);M/=L;H/=L}var K=document.createElement("canvas");K.width=M;K.height=H;var I=K.getContext("2d");I.fillRect(0,0,K.width,K.height);I.drawImage(J,0,0,M,H);var N=K.toDataURL("image/jpeg",1);return F(N.replace(/^.*?,/,""),"image/jpeg")}var D=E.size;C(E,function(H,J){var I=new Image();I.onload=function(){if(D<g&&I.width<800&&I.height<800){G.resolve(E);return}E=B(I);G.resolve(E)};I.src=J});
return G.promise()};var b=function(){var D;var B=function(F,E){if(F!==""){return F+E.slice(0,1).toUpperCase()+E.slice(1)}return E};var C=(function(){var E=false;if(typeof window.screenX==="number"){["webkit","moz","ms","o",""].forEach(function(F){if(E===false&&document[B(F,"hidden")]!==undefined){D=F;E=true}})}return E})();if(C){return document[B(D,"hidden")]}return undefined};function w(){if($(".soutu-newtab").length){$(".soutu-newtab").remove()}$(".soutu-url-error").hide()}function l(D,E,B){var C=['<div class="soutu-newtab">','<div class="soutu-newtab-cont">','<div class="soutu-newtab-img" style="background-image:url('+E+')">',"</div>",'<div class="soutu-newtab-text">',"<p>"+D+"</p>","<span></span>","</div>","</div>",'<a class="soutu-newtab-link" href="'+B+'" target="_blank">æ¥çæç´¢ç»æ</a>',"</div>"].join("");$tip=$(C);$(".soutu-wrap").append($tip);e({rsv_imageclick:"tipForNewTab"})}function k(C,D){var B=new FileReader();B.onload=function(){D(this.result)};B.onerror=function(E){D()};B.readAsDataURL(C)
}var x=function(B,D){var C=$("#form").attr("target");if(C==="_blank"){var E="å¾çä¸ä¼ å®æ¯ï¼æ ¹æ®æ¨çæç´¢ä¹ æ¯ï¼<br/>å°æå¼æ°çªå£å±ç¤ºæç´¢ç»æ";if(window.player&&player.config&&player.config.play.on){E="æ¨æ­£å¨å¬é³ä¹ï¼ä¸ºäºä¸ææ°æ¨ç»§ç»­å¬é³ä¹ï¼<br/>å°æå¼æ°çªå£æ¥çæç´¢ç»æ"}D.setState("normal");D.$wrap.find(".upload-wrap").hide();D.$wrap.find(".soutu-hr").hide();D.$wrap.find(".soutu-drop").hide();if(!$.isString(D.imgObj)){k(D.imgObj,function(F){l(E,F,B)})}else{l(E,D.imgObj,B)}}else{location.href=B;D.close()}};var A=function(B){$.extend(this,{wrap:null},B);this.state="normal"};$.extend(A.prototype,{init:function(){},clean:function(){this.wrap.find(".soutu-mask").remove()},setNormal:function(){this.clean();var B=this.wrap.find(".upload-pic");B.val("");w();this.wrap.find(".upload-wrap").show();this.wrap.find(".soutu-hr").show();this.wrap.find(".soutu-drop").show();this.state="normal"},setWaiting:function(){this.clean();this.state="waiting";var C='<div class="soutu-waiting"><div class="ball"><div class="b"></div><div class="b"></div><div class="b"></div></div><span>æ­£å¨å è½½å¾ç</span></div>';
this.wrap.append(this.getHtml(C));var D=[[0,40],[20,20],[40,0]];var B=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.wrap.find(".b").each(function(F,H){var G=0;$(H).css({"background-color":B[F]});(function E(){$(H).animate({left:D[F][G%2]},{duration:800,easing:"swing",progress:function(J,I){if(I>=0.5){$(H).css({"background-color":B[(G+F)%3]})}},complete:function(){E()}});G++})()})},setError:function(C){this.clean();this.state="error";C=C||z["2"];var B='<div class="soutu-error"><i class="soutu-icon soutu-error-icon"></i><p class="soutu-error-main">'+C+'ï¼è¯·<a href="#" class="soutu-error-upload">éæ°ä¸ä¼ </a></p><p class="soutu-error-tip">ä»æ¯æ10Mä»¥ä¸JPG,JPEG,PNG,BMP,GIFæ ¼å¼å¾ç</p></div>';this.wrap.append(this.getHtml(B))},setActiving:function(){if(this.state!=="activing"){this._setActive(1);this.state="activing"}},setActive:function(){if(this.state!=="active"){this._setActive();this.state="active"}},_setActive:function(B){this.clean();if(this.activeLayer){$(this.getHtml(this.activeLayer,"background-color:"+(B?"#ededed":"#f6f6f6")+";")).appendTo(this.wrap)
}},getHtml:function(C,B){B=B||"";return'<div class="soutu-mask" style="'+B+'">'+C+"</div>"},show:function(){},hide:function(){}});var j=function(B){this.config={};$.extend(this.config,h,B);this.state="normal";this.init();this.canDrop="ondrop" in document.body;this.canAjaxForm="FormData" in window};$.extend(j.prototype,{init:function(){var C=this;a.addClass(i?"soutu_mac":"soutu_nomac");var B=$('<link rel="stylesheet" href="http://s1.bdstatic.com/r/www/cache/static/soutu/css/soutu_c7b70bd5.css" type="text/css" data-for="result"/>');if(v){B.insertBefore(a.parent())}else{B.appendTo("head")}this.$Btn=$('<span class="ipt_photo"></span>').prependTo($("#kw").parent()).hover(function(){C.$Btn.addClass("ipt_photo_hover")},function(){C.$Btn.removeClass("ipt_photo_hover")}).on("click",function(D){D.stopPropagation();D.preventDefault();C.addPanel();C.$Btn.hide();if($(".soutu-newtab").length){$(".soutu-newtab").remove()}C.log({rsv_imageclick:"camerabtn"})});if(i){this.$Btn.addClass("ipt_photo_mac")}if(v){this.$Btn.parent().addClass("s_ipt_wr_newIndex")
}$(window).one("index_off",function(){C.$Btn.parent().removeClass("s_ipt_wr_newIndex")});if(!n){$("#kw").on("drop.soutu",function(D){if(D.originalEvent.dataTransfer&&D.originalEvent.dataTransfer.files&&D.originalEvent.dataTransfer.files.length){u(D);C.$Btn.trigger("click");C.handleDrop(D);C.log({rsv_imageclick:"iptdrop"})}}).on("dragover.soutu",function(D){return !o});if($(".soutu-input-image").length){$(".soutu-input-image").on("click",function(){C.log({rsv_imageclick:"delimg"})})}$(document).on("dragstart.soutu",function(I){var D=I.originalEvent.dataTransfer;var H=I.target||I.srcElement;var J=H.nodeName.toLowerCase();var F;if(J==="img"){F=H.src;try{D.setData("text/plain",F)}catch(G){D.setData("Text",F)}}else{if(J==="a"){var E=$(H).children("img");if(E.length){F=E[0].src;try{D.setData("text/plain",F)}catch(G){D.setData("Text",F)}}}}})}},hidePanel:function(){this.$wrap.hide();this.wrapHidden=true},show:function(){if(window.pageState===1&&!this.$wrap.hasClass("result")){this.$wrap.addClass("result")
}if(v&&bds.comm.ishome){this.$wrap.addClass("new");if(!window.s_session||!!s_session.userSkinName===false){this.$wrap.addClass("no-skin")}}this.$wrap.find(".upload-wrap").show();this.$wrap.find(".soutu-hr").show();this.$wrap.find(".soutu-drop").show();this.$wrap.show()},close:function(){this.$wrap.hide();this.$Btn.show();this.setState("normal");$(".soutu-newtab").remove();this.$urlErrorTip.hide();this.$kw.val("")},addPanel:function(){var B=this;this.wrapHidden=false;if(this.$wrap){this.show();return}this.$wrap=$('<div class="soutu-wrap"><div class="soutu-fake"><span class="soutu-fake-wrap"><input id="soutu-fake-kw" class="soutu-s-ipt" maxlength="255" autocomplete="off" placeholder="å¨æ­¤å¤ç²è´´å¾çç½å"/></span><span class="soutu-fake-btn"><i class="soutu-icon soutu-fake-btn-icon"></i></span><span class="soutu-url-error">è¯·è¾å¥æ­£ç¡®çå¾çç½å</span></div><div class="soutu-hr"><div class="soutu-drop" style="display:none;"><span class="soutu-drop-tip">ææ½å¾çå°è¿é</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" data-nolog="1" class="upload-pic" value="ä¸ä¼ å¾ç"/><i class="soutu-icon upload-icon"></i><span class="upload-text">æ¬å°ä¸ä¼ å¾ç</span></div></div><a class="soutu-icon soutu-close" data-nolog="1" href="javascript:void(0);"></a></div>').prependTo($("#form"));
this.$kw=this.$wrap.find("#soutu-fake-kw").on("focus",function(){B.$wrap.find(".soutu-fake-wrap").addClass("focus")}).on("blur",function(){B.$wrap.find(".soutu-fake-wrap").removeClass("focus")});this.$dropArea=this.$wrap.find(".soutu-drop");this.$kw.on("keydown",function(D){var C=D.keyCode;if(B.$urlErrorTip.css("display")!=="none"){B.$urlErrorTip.hide()}if(C===13){B.submit(this.value);D.stopPropagation();D.preventDefault();return false}});this.$urlErrorTip=this.$wrap.find(".soutu-url-error");this.$wrap.find(".soutu-fake-btn").on("click",function(){var C=B.$kw.val();B.submit(C,true)});this.$wrap.find(".soutu-fake-btn").on("mouseover",function(){$(this).addClass("btnhover")}).on("mouseout",function(){$(this).removeClass("btnhover")});if(!this.canAjaxForm){this.hackFlash()}this.$wrap.find(".soutu-close").on("click",function(){B.close(true);B.log({rsv_imageclick:"close"})});$(document).click(function(C){B.document_click(C)});this.$wrap.find(".upload-pic").on("change",function(){var C=this.files[0];
if(C){B.upload(C)}});this.$wrap.find(".upload-pic").on("click",function(){B.log({rsv_imageclick:"uploadbtn"})});if(this.canDrop&&!n){this.setDragAndDrop()}this.masks=[new A({wrap:this.$wrap})];this.show();$(window).one("index_off",function(){B.$wrap.removeClass("new");B.$wrap.removeClass("no-skin")})},setState:function(E){this.state=E;var B=this.masks[0];E=E.charAt(0).toUpperCase()+E.substring(1);var C=[].slice.call(arguments);[].shift.call(C);if(E==="Activing"){this.$dropArea.addClass("drag-over")}else{this.$dropArea.removeClass("drag-over")}B["set"+E].apply(B,C);if(E==="Error"){var D=this;this.$wrap.find(".soutu-error-upload").click(function(F){F.stopPropagation();F.preventDefault();D.setState("normal")})}},document_click:function(E){var D=this;var C=E.target;var B=true;do{if(C===D.$wrap[0]||C===D.$Btn[0]){B=false;break}}while(C=C.parentNode);if(B){D.close()}},doAjax:function(C){var B=this;if(this.state!=="waiting"){this.setState("waiting")}$.ajax({url:B.config.uploadServer,type:"POST",data:C,processData:false,contentType:false,success:function(D){B.uploadComplete(D)
},error:function(){B.setState("error")},always:function(){}})},uploadUrl:function(B){this.imgObj=B;var C=new FormData();C.append("image",B);this.doAjax(C);this.log({rsv_imageclick:"uploadurl"})},upload:function(B){var D=this;D.imgObj=B;w();var C=this.validate(B);if(C){this.setState("error",z[C]);return}this.setState("waiting");q(B).then(function(E){var F=new FormData();F.append("image",E);D.doAjax(F);D.log({rsv_imageclick:"uploadfile"})})},uploadComplete:function(B){var C=this;if(B&&B.command&&B.command.mode===2&&B.data){setTimeout(function(){var E=p("imgorigin")||s;var F="";var D=F+"/imgsearch?wd="+encodeURIComponent(B.data.wd)+"&sign="+encodeURIComponent(B.data.sign)+"&imgpre="+s+"&imgorigin="+E;x(D,C)},B.command.interval||3000)}else{this.setState("error")}},submit:function(C,B){this.setURL(C,B)},validate:function(C){var E=["jpg","jpeg","png","bmp","gif"];var B=C.name.split(".");var D=B.pop().toLowerCase();if(!C.type||!D||$.inArray(D,E)===-1){return 1}if(C.size>m){return 2}return 0},setURL:function(C,B){if(d(C)){this.$kw.val(C);
this.setState("normal");this.$urlErrorTip.hide();if(B){this.log({rsv_imageclick:"imgsearchbtn-success"})}this.uploadUrl(C)}else{this.setState("normal");this.$urlErrorTip.show();if(B){this.log({rsv_imageclick:"imgsearchbtn-error"})}}},handleDrop:function(G){var F=this;var B;if(G.originalEvent.dataTransfer){B=G.originalEvent.dataTransfer.files}if(!B||B.length===0){var C;try{C=G.originalEvent.dataTransfer.getData("text/plain")||G.originalEvent.dataTransfer.getData("text/uri-list")}catch(E){C=G.originalEvent.dataTransfer.getData("Text")||G.originalEvent.dataTransfer.getData("URL")}if(C){F.setURL(C)}else{F.setState("normal");F.$urlErrorTip.show()}return}var D=B[0];F.upload(D)},setDragAndDrop:function(){var B=this;this.$dropArea.show();B.$dropArea.on("dragover",function(C){B.setState("activing");u(C)}).on("dragleave",function(C){B.setState("normal");u(C)}).on("drop",function(C){u(C);B.handleDrop(C)});this.$kw.on("dragover.soutu dragleave.soutu",function(C){u(C)}).on("drop.soutu",function(C){u(C);
B.handleDrop(C)})},hackFlash:function(){var J=this;var B="11.1.0";var G="playerProductInstall.swf";var D={};var E={};var H="http://s1.bdstatic.com/r/www/cache/static/soutu/js/upload_ef39d94f.swf";E.quality="high";E.bgcolor="#ffffff";E.allowscriptaccess="always";E.allowfullscreen="false";E.wmode="transparent";D.uploadServer=this.config.uploadServer;var F={};F.id="upload_flash";F.name="upload_flash";F.align="middle";var C=null;var I=$.Deferred();this.$wrap.find(".upload-pic").parent().append('<div class="flash-wrap" style="position:absolute;"><div id="upload_flashContent"></div></div>').end().remove();swfobject.embedSWF(H,"upload_flashContent","100","23",B,G,D,E,F,function(K){C=K.ref});j.swfloaded=function(){I.resolve()};j.uploading=function(){J.setState("waiting")};j.complete=function(K){J.uploadComplete(K)};I.done(function(){})},log:e});if(typeof define==="function"){define("soutu.index",[],function(){window.__soutu=j;return new j()})}})();