window.Modernizr=function(e,t,r){function a(e){b.cssText=e}function n(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function s(e,t){for(var a in e){var n=e[a];if(!o(n,"-")&&b[n]!==r)return"pfx"==t?n:!0}return!1}function c(e,t,a){for(var o in e){var s=t[e[o]];if(s!==r)return a===!1?e[o]:n(s,"function")?s.bind(a||t):s}return!1}function i(e,t,r){var a=e.charAt(0).toUpperCase()+e.slice(1),o=(e+" "+w.join(a+" ")+a).split(" ");return n(t,"string")||n(t,"undefined")?s(o,t):(o=(e+" "+C.join(a+" ")+a).split(" "),c(o,t,r))}var d,l,u,f="2.6.2",_={},h=t.documentElement,p="modernizr",m=t.createElement(p),b=m.style,v=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),g="Webkit Moz O ms",w=g.split(" "),C=g.toLowerCase().split(" "),$={},k=[],y=k.slice,x=function(e,r,a,n){var o,s,c,i,d=t.createElement("div"),l=t.body,u=l||t.createElement("body");if(parseInt(a,10))for(;a--;)c=t.createElement("div"),c.id=n?n[a]:p+(a+1),d.appendChild(c);return o=["&#173;",'<style id="s',p,'">',e,"</style>"].join(""),d.id=p,(l?d:u).innerHTML+=o,u.appendChild(d),l||(u.style.background="",u.style.overflow="hidden",i=h.style.overflow,h.style.overflow="hidden",h.appendChild(u)),s=r(d,e),l?d.parentNode.removeChild(d):(u.parentNode.removeChild(u),h.style.overflow=i),!!s},T={}.hasOwnProperty;u=n(T,"undefined")||n(T.call,"undefined")?function(e,t){return t in e&&n(e.constructor.prototype[t],"undefined")}:function(e,t){return T.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var r=y.call(arguments,1),a=function(){if(this instanceof a){var n=function(){};n.prototype=t.prototype;var o=new n,s=t.apply(o,r.concat(y.call(arguments)));return Object(s)===s?s:o}return t.apply(e,r.concat(y.call(arguments)))};return a}),$.csstransforms3d=function(){var e=!!i("perspective");return e&&"webkitPerspective"in h.style&&x("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e};for(var S in $)u($,S)&&(l=S.toLowerCase(),_[l]=$[S](),k.push((_[l]?"":"no-")+l));return _.addTest=function(e,t){if("object"==typeof e)for(var a in e)u(e,a)&&_.addTest(a,e[a]);else{if(e=e.toLowerCase(),_[e]!==r)return _;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(h.className+=" "+(t?"":"no-")+e),_[e]=t}return _},a(""),m=d=null,_._version=f,_._prefixes=v,_._domPrefixes=C,_._cssomPrefixes=w,_.testProp=function(e){return s([e])},_.testAllProps=i,_.testStyles=x,_}(this,this.document),function(){"use strict";home.cleverString={};var e,t="â¦";e=function(e,t){var r=e.charCodeAt(),a=t.charCodeAt();return r>=55296&&56319>=r&&a>=56320&&57343>=a},home.cleverString.length=function(t){if("undefined"==typeof t||null===t)return 0;for(var r=0,a=t.length,n=0;a>r;)++r<a&&e(t[r-1],t[r])&&++r,++n;return n},home.cleverString.substring=function(t,r,a){if("string"!=typeof t)return t;"number"!=typeof r&&(r=0),a||0===a||(a=1/0);for(var n,o=[],s="",c=r+a,i=0,d=t.split(s),l=d.length,u=0;l>=i;)n=1,l>i+1&&e(t[i],t[i+1])&&(n=2),u>=r&&c>u&&o.push(d.slice(i,i+n).join(s)),i+=n,++u;return o.join(s)},home.cleverString.cutMiddleOfString=function(e,r,a){var n=home.cleverString.length(e);return"string"!=typeof e||3>n||"number"!=typeof r||"number"!=typeof a?e:-1===r||-1===a?"":n>=r+1+a?home.cleverString.substring(e,0,r)+t+home.cleverString.substring(e,n-a):e},home.cleverString.cutEndOfString=function(e,t){return home.cleverString.cutMiddleOfString(e,t-1,0)},home.cleverString.cutStartOfString=function(e,t){return home.cleverString.cutMiddleOfString(e,0,t-1)}}(),x.amd.require("statlog",function(e){var t=$.browser.msie&&"10.0"===$.browser.version,r=$("html").hasClass("i-ua_browser_msie11"),a=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("YaBrowser")>-1;$(function(){function n(){O(),Q||(lt.css({opacity:0,top:Y+K}).removeClass("i-hidden").animate({opacity:1,top:"-="+K+"px"},D,function(){Bt.sendShows(lt[0])}).click(function(){Bt.popupHandler()}),d($(".b-card__inside")))}function o(){$(".b-card_received").removeClass("b-card_received")}function s(){Bt.init(),X=!0,Q?k():(c(),Bt.moveCards(0,!1),l()),Bt.mainCard.show("front"),$(".b-cards__received").css({top:G}),Bt.showParanja(),Q=!0}function c(){$(".b-cards__list .b-card__wrap").each(function(e){$(this).attr("index",e)})}function i(e){if(e.length){var t=e[0].onclick().readUrl;mt[t]||(mt[t]=!0,$.get(t))}}function d(e){var t=e[0].onclick().showUrl;t&&$.get(t)}function l(){$(".b-card.i-hidden").css({opacity:0}).removeClass("i-hidden").addClass("b-card__fade").animate({opacity:1},D)}function u(){Z=!0,setTimeout(function(){Z=!1},W)}function f(e){var t=$(e).closest(".b-card__wrap");return t.hasClass("b-card__wrap-active")}function _(e){return e.hasClass("b-card_post")}function h(e,t){var r=U===J-1?U-1:U;e.closest(".b-card__wrap").remove(),Bt.moveCards(r,!0),c(),--J,$.get(t)}function p(e){var t={event_id:E.eventId,to_email:Ot.val(),design_id:wt,text:E.progressiveTextArea?Bt.getTextFromDom(Et):Et.val()};E.login||(t.from_name=Mt.val()),At&&(t.captcha_key=At,t.captcha_code=Tt.val()),yt.addClass("i-hidden"),kt.trigger("captcha",{show:!1}),$.post("/postcard.post/?sk="+E.sk,t,function(t){e(m(t))},"json").fail(function(){var e=$(".b-cards__lock"),t=$(),r=E.off;Bt.cp(E.stat.errorPost),w(e),e.remove(),Rt.show(r,t)})}function m(e){if(e.ok)return e.captcha&&y(),!0;var t=$(),r="";if(e.errors){if(Bt.cp(E.stat.errorWrite),e.errors.design_id)return r=E.unknown,Rt.show(r,t),!1;"invalid"===e.errors.captcha_code&&(r=E.captcha,t=t.add(Tt)),e.errors.text&&(r=E.fields,t=t.add(Et)),"not_yours"===e.errors.from_email&&(r=E.wrongName,t=t.add(Mt)),e.errors.to_email&&(r=E.fields,t=t.add(Ot)),e.errors.from_name&&(r=E.fields,t=t.add(Mt)),e.errors.post&&("sk"===e.errors.post?(r||(r=E.nologin),e.sk&&(E.sk=e.sk),E.login=""):(r=E.off,t=$()))}else r=E.off;return e.captcha&&y(),Rt.show(r,t),!1}function b(e,t){var r=$(".b-card_post .b-card__front .b-card__button-choose"),a=$(".b-card_post .b-card__front .b-card__design__choosen");e?r.removeClass("i-hidden"):(r.addClass("i-hidden"),"undefined"!=typeof t&&t||a.remove())}function v(){$(".b-card__choose__preview_selected").removeClass("b-card__choose__preview_selected"),$(".b-card__author").addClass("i-hidden")}function g(e){$(".b-spin",e).each(function(e,t){$(this).removeClass("b-spin_js_inited"),BEM.DOM.init($(this)),$(t).bem("b-spin").toggleMod("progress","yes","",!0)})}function w(e){$(".b-spin",e).each(function(e,t){$(t).bem("b-spin").toggleMod("progress","yes","",!1)})}function C(e){function t(){clearTimeout(bt),clearTimeout(vt),w(a),a.remove(),b(!0);var e=$(".b-card__design__choosen");o.hide().removeClass("i-hidden").addClass("b-card__design__choosen"),$(".b-card_post .b-card__front .b-card__design-bg").append(o),o.fadeIn(D/2),setTimeout(function(){e.fadeOut(D/2,function(){e.remove()})},D/2)}var r=$(".b-card_post");if(!$(".b-card__front .b-cards__lock",r).length){var a=$(".b-cards__lock").clone();v(),e.addClass("b-card__choose__preview_selected"),wt=e.data("img"),gt=new Image;var n="b-card__design_card_"+wt,o=$('<div class="i-hidden '+n+'"></div>');$("body").append(o);var s=o.css("backgroundImage").replace(/^url\(\"/,"").replace(/^url\(/,"").replace(/\"\)$/,"").replace(/\)$/,"");I=e.data("author")?e.data("author"):"none",R=$(".b-card__author"),F=$(".b-card__author__name"),"none"!==I&&(F.html(I),R.removeClass("i-hidden")),$(".b-card__front",r).append(a),bt&&clearTimeout(bt),vt&&clearTimeout(vt),bt=setTimeout(function(){a.removeClass("i-hidden"),g(a),b(!1,!0)},100),vt=setTimeout(function(){t()},5e3),gt.onload=function(){t()},gt.src=s}}function k(){if(E.logoShow&&X&&!U){var e=new Image;e.src=E.logoShow+"&"+String(Math.random()).substr(2,12)}}function y(e){$.get(E.reloadCaptcha,function(t){xt.attr("src",t.captcha.imgurl),Tt.prop("disabled",!1),yt.removeClass("i-hidden"),kt.trigger("captcha",{show:!0}),St.unbind("click").click(function(){$.get(E.reloadCaptcha,function(e){At=e.captcha.key,xt.attr("src",e.captcha.imgurl)},"json")}),At=t.captcha.key||"","undefined"!=typeof e&&e()},"json")}function x(){at.on("click",".b-cards__postcard",It.scrollToSend).on("click",".b-cards__viewcards",It.scrollToView).on("click",".b-card__front",It.switchOrRotateFront).on("click",".b-card__back",It.switchOrRotateBack).on("click",".b-card__sent",It.switchSentIfNotActive).on("click","#cardsMore",It.sendMoreCard).on("click","#cardsClose",It.closeSent).on("click","#cardsSend",It.sendCard).on("click","#cardsBack",It.resumeChoosing).on("click",".b-card__choose__preview",It.chooseCard).on("click","#cardsChoose",It.switchToSendForm).on("click",".b-card__controls__icon_bin",It.removeReceivedCard).on("click",".b-card__controls__icon_spam",It.removeSpamCard).on("click",".b-card:not(.b-card_post) .b-card__back .button",It.answerCard).on("click",".b-cards__received",It.closeOnReseavedClick).on("click",".b-cards__top",Bt.closeCards),nt.on("click",Bt.closeCards),st.on("submit",function(){return!1}),ot.on("click",".b-cards__switcher",It.switchUnsubscribe).on("click",function(e){$(e.target).hasClass("b-cards__bottom")&&Bt.closeCards()})}function T(e){$(".b-card__wrap").each(function(t){if(e>=t){var r=$(".img-deferred",this);r.attr("src",r.data("deferred")).removeClass("img-deferred")}})}function S(){var e;return window.innerHeight?e=window.innerHeight:document.documentElement&&document.documentElement.clientHeight?e=document.documentElement.clientHeight:document.body&&(e=document.body.clientHeight),e}function P(e){if(e.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var r=window.getSelection();r.removeAllRanges(),r.addRange(t)}else if("undefined"!=typeof document.body.createTextRange){var a=document.body.createTextRange();a.moveToElementText(e),a.collapse(!1),a.select()}}function M(e,t,r){$.browser.msie||$.browser.opera?$("textarea[maxlength]").on("focus keydown keyup blur paste cut",function(){var e=$(this),t=e.attr("maxlength"),r=e.val();r.length>t&&(e.val(r.substr(0,t)),Rt.show(E.maxlen,e))}):E.progressiveTextArea&&e.on("focus keydown keyup blur paste cut",function(){var n=$(this),o=e.text();o.length>t&&(e.text(o.slice(0,t)),Rt.show(E.maxlen,n),P(e[0])),a&&r.css("display",o?"none":"block")})}function O(){var e=$(".b-morda-search, .l-head-right, .search, .search2"),t=e.offset().top,r=e.height();Y=Math.floor(t+r)}var E=home.getData("cards.params"),A=home.getData("cards.settings"),B=Modernizr.csstransforms3d&&!E.isTabletAndroid&&!t;$("html").addClass(B?"m-transform3d":"m-no-transform3d");var j,R,F,I,L=$(".b-page"),H=L.hasClass("b-page_fadeheader"),N=286,z=400,D=B?500:50,W=B?1e3:50,U=0,J=$(".b-card").length,q=-300,V=200,Y=320,K=50,G=H?62:30,Q=!1,X=!1,Z=!1,et=$(".search2").offset().top+35,tt=$(".search2 .input").bem("input"),rt=$(window),at=$(".b-cards-wrapper"),nt=$(".b-cards__parandja"),ot=$(".b-cards__bottom"),st=$(".b-card__form .suggest2-form"),ct=ot.find(".b-cards__share"),it=$(".b-card_post"),dt=!1,lt=$(".b-cards__popup"),ut=$(".b-cards__postcard"),ft=$(".b-cards__viewcards"),_t=$(".b-card__fields__input .suggest2-form__input").bem("input"),ht=lt.find(".b-cards__close"),pt=!1,mt={},bt=null,vt=null,gt=null,wt=-1,Ct="",$t="",kt=$(".b-card__form form"),yt=$(".b-card__form .b-captcha"),xt=$(".b-card__form .b-captcha .b-captcha__image"),Tt=$(".b-card__form .b-captcha .b-captcha__input"),St=$(".b-card__form .b-captcha .b-link_captcha"),Pt=$(".b-card__form .b-card__errormessage"),Mt=$('.b-card__form [name="from_name"]'),Ot=$('.b-card__form [name="email_to"]'),Et=$('.b-card__form [name="text"]'),At=null,Bt={cp:function(e){e&&csh_ifgsid(e)},init:function(){var e=this;this.autoFocusCapture.off(),this._getShare(),this._initInputs(),setTimeout(function(){e.sendShows()},D)},sendShows:function(t){t||e.logByFragment({doc:ot[0]}),e.logByFragment({doc:t||at[0]})},sendShow:function(t){e.log(t)},mainCard:{show:function(e,t){return it.find(".b-card__"+e).removeClass("i-hidden"),t&&setTimeout(t,30),this},hide:function(e){return it.find(".b-card__"+e).addClass("i-hidden"),this}},getTextFromDom:function(e){var t=$("<pre />").html(e.html());return $.browser.webkit&&t.find("div").replaceWith(function(){return"\n"+this.innerHTML}),($.browser.msie||r)&&t.find("p").replaceWith(function(){return this.innerHTML+"<br>"}),($.browser.mozilla||$.browser.opera||$.browser.msie||r)&&t.find("br").replaceWith("\n"),t.text()},rotate:function(e,t){"front"===t?e.removeClass("b-card_back_enabled"):"back"===t&&(e.find(".b-card__back").removeClass("i-hidden"),setTimeout(function(){e.addClass("b-card_back_enabled"),Bt.sendShows()},30))},getExtraAuth:function(){"undefined"==typeof j&&E.logged&&!E.login&&E.extraAuth&&(j=null,$.get(E.extraAuth,function(e){e.name&&(Ct=e.name,j=Ct),e.email&&(Ct=Ct?Ct+" "+e.email:e.email,j=Ct)},"json"))},getCardIndex:function(e){var t=$(e).closest(".b-card__wrap");return Number(t.attr("index"))},repaintArrows:function(e){e?(ut.removeClass("i-hidden"),ft.addClass("i-hidden")):(ut.addClass("i-hidden"),$(".b-card:not(.b-card_post)").length&&ft.removeClass("i-hidden"))},autoFocusCapture:{on:function(){_t&&_t.setMod("listen","yes")},off:function(){_t&&_t.setMod("listen","no")}},hideCards:function(){$(".b-share-popup-wrap").addClass("b-share-popup-wrap_state_hidden"),Bt.autoFocusCapture.on(),at.fadeOut(D,function(){at.addClass("i-hidden").show()}),nt.fadeOut(D,function(){nt.addClass("i-hidden").show()}),ot.fadeOut(D,function(){ot.addClass("i-hidden").show()}),u(),tt.setMod("listen","yes")},closeCards:function(){return Bt.cp(E.stat.sendClose),Bt.hideCards(),window.home&&home.leftBanner&&home.leftBanner.showBanner&&home.leftBanner.showBanner("b-cards"),X=!1,$(".b-card_post").hasClass("b-card__sent-enabled")&&setTimeout(function(){Bt.moreCards()},D),v(),b(!1),clearTimeout(bt),clearTimeout(vt),gt&&(gt.onload=null),E.isTablet||$("#text").focus(),!1},moveCards:function(e,t){U=e,t?$(".b-cards__list").animate({left:27-50*U+"%"},D):$(".b-cards__list").css({left:27-50*U+"%"}),$(".b-card__wrap-active").removeClass("b-card__wrap-active"),$(".b-cards__list .b-card__wrap:eq("+U+")").addClass("b-card__wrap-active"),$(".b-card__wrap-next").removeClass("b-card__wrap-next"),$(".b-card__wrap-prev").removeClass("b-card__wrap-prev"),$(".b-card__wrap-active ~ .b-card__wrap").addClass("b-card__wrap-next"),$(".b-card__wrap:not(.b-card__wrap-active):not(.b-card__wrap-next)").addClass("b-card__wrap-prev"),Bt.repaintArrows(e),t?($(".b-card__wrap-active .b-card").animate({marginLeft:q},D),$(".b-card__wrap-prev .b-card").animate({marginLeft:q-V},D),$(".b-card__wrap-next .b-card").animate({marginLeft:q+V},D),setTimeout(function(){Bt.sendShows()},D)):($(".b-card__wrap-active .b-card").css({marginLeft:q}),$(".b-card__wrap-prev .b-card").css({marginLeft:q-V}),$(".b-card__wrap-next .b-card").css({marginLeft:q+V})),$(".b-card__design__choosen").length||k(),Bt.sendShows(),T(e+1)},addEnter:function(e){var t=$(".b-cards__enter");t.css("width","-=40px"),e.prepend(t),t.animate({width:"+=40px"},300,function(){t.css("width","")}),t.removeClass("i-hidden").click(function(){return Z?void 0:($(".b-card_ny2014 > .b-card__back").height(399),Bt.getExtraAuth(),setTimeout(function(){window.home&&home.leftBanner&&home.leftBanner.hideBanner&&home.leftBanner.hideBanner("b-cards")},100),rt.trigger("keyboardClose.lego"),Bt.isPopupShown()?void Bt.popupHandler():void s())})},isPopupShown:function(){return $(".b-card__inside").length&&!dt},showParanja:function(){at.css({opacity:0}).removeClass("i-hidden").animate({opacity:1},D),nt.css({opacity:0}).removeClass("i-hidden").animate({opacity:1},D),ot.css({opacity:0}).removeClass("i-hidden").animate({opacity:1},D),tt.setMod("listen","no")},popupHandler:function(){Bt.init(),lt.addClass("i-hidden"),$(".b-cards__received").removeClass("i-hidden").css({top:Y-(z-N)/2}).animate({top:G},D,function(){o()}),Bt.mainCard.show("front"),Bt.showParanja(),X=!0,c(),Bt.moveCards(1,!1),l();var e=$(".b-card__wrap-active .b-card");Bt.rotate(e,"back"),u(),i(e),Q=!0,dt=!0},closeCardsPopup:function(){return lt.fadeOut(D),window.home&&home.leftBanner&&home.leftBanner.showBanner&&home.leftBanner.showBanner("b-cards"),i($(".b-card:eq(1)")),o(),dt=!0,E.isTablet||$("#text").focus(),Bt.autoFocusCapture.on(),!1},moreCards:function(){var e=$(".b-card_post");v(),b(!1),e.addClass("b-card__front-enabled"),setTimeout(function(){Bt.mainCard.show("back",function(){e.removeClass("b-card__sent-enabled"),Bt.rotate(e,"front"),e.removeClass("b-card__front-enabled"),k(),u(),Bt.mainCard.hide("sent")})},D),u()},_getShare:function(){pt||$.getScript("//yastatic.net/share2/share.js").done(function(){var t=ct.bem("ya-share2");pt=!0,Lego.params.statRoot&&(E.shareJson.hooks=E.shareJson.hooks||{},E.shareJson.hooks.onready=function(){ct.find(".ya-share2__link").each(function(){var r=$(this).parent();$(this).attr("data-"+e.getParams().statDataAttr,E.stat.share+"."+t.getMod(r,"service")).attr("data-"+e.getParams().dataNoRedirKey,"true")}),Bt.sendShows($(".b-cards__share")[0])}),Ya.share2("cards__share",E.shareJson)})},_initInputs:function(){$(".b-card__fields__input").find(".input").each(function(){$(this).bem("input")}),st.bem("suggest2-form")}};$(document).keyup(function(e){27===e.keyCode&&(Bt.isPopupShown()?(Bt.cp(E.stat.closeReceivedPopup),Bt.closeCardsPopup()):X&&Bt.closeCards())}),ht.click(Bt.closeCardsPopup);var jt=null,Rt={show:function(e,t,r){Pt.html(e).fadeIn(),t.closest(".b-card__fields__input").addClass("b-card__errorfield"),r||this.hide(t,3e3)},hide:function(e,t){var r=function(){Pt.fadeOut(200,function(){Pt.html("")}),e.closest(".b-card__fields__input").removeClass("b-card__errorfield")};jt&&clearTimeout(jt),t?jt=setTimeout(r,t):r()}};kt.bind("captcha",function(e,t){t.show?kt.addClass("b-captcha__enabled"):kt.removeClass("b-captcha__enabled")});var Ft=!1,It={scrollToSend:function(){Bt.moveCards(0,!0)},scrollToView:function(){Bt.moveCards(1,!0)},switchOrRotateFront:function(){if(!Z)if(f(this)){var e=$(this).closest(".b-card");_(e)||(i(e),Bt.rotate(e,"back"),u(),Bt.cp(E.stat.rotate))}else{var t=Bt.getCardIndex(this);Bt.cp(t>U?E.stat.next:E.stat.prev),Bt.moveCards(t,!0)}},switchOrRotateBack:function(){if(!Z)if(f(this)){var e=$(this).closest(".b-card");_(e)||(Bt.rotate(e,"front"),u(),Bt.cp(E.stat.rotate))}else{var t=Bt.getCardIndex(this);Bt.cp(t>U?E.stat.next:E.stat.prev),Bt.moveCards(t,!0)}},switchSentIfNotActive:function(e){if(!Z){var t=$(e.target);if(t.is("#b-card-logo-replacer")||t.hasClass("b-card__logo")||t.parent().hasClass("b-card__logo"))return!0;if(f(this))return!1;var r=Bt.getCardIndex(this);Bt.cp(r>U?E.stat.next:E.stat.prev),Bt.moveCards(r,!0)}},sendMoreCard:function(){return Bt.moreCards(),!1},closeSent:function(){return Bt.closeCards(),!1},sendCard:function(){var e,t=$(".b-card_post");if(!this.disabled&&!$(".b-card__back .b-cards__lock",t).length){var r=$(".b-cards__lock").clone();r.removeClass("i-hidden"),$(".b-card__back",t).append(r),g(r),p(function(a){w(r),r.remove(),a&&(e=home.cleverString.cutEndOfString(Ot.val(),36),$(".b-card__sent .b-card__content__text_sent").html(E.sent.replace("s",e)),b(!1),Mt.val(""),Ot.val(""),Tt.val(""),$t="",At=null,Bt.mainCard.show("sent",function(){setTimeout(function(){k(),$(".b-card__front",t).removeClass("i-hidden"),$(".b-card__back",t).addClass("i-hidden"),E.progressiveTextArea?Et.empty():Et.val("")},D),t.addClass("b-card__sent-enabled"),u()}))}),Tt.val("")}},resumeChoosing:function(){var e=$(this).closest(".b-card");Bt.mainCard.hide("sent").show("front",function(){Bt.rotate(e,"front"),u()})},chooseCard:function(){C($(this))},switchToSendForm:function(){var e,a=$(this).closest(".b-card");Bt.mainCard.show("back",function(){setTimeout(function(){Bt.mainCard.hide("front")},D),Bt.rotate(a,"back"),u()}),Mt.val(Ct),Ot.val($t),Bt.cp(E.stat.sendPreviewWrite+wt);var n=$('[name="email_to"]');if($(".b-card__fields__auth").hasClass("i-hidden"))e=n.attr("value").length?$("#message"):n;else{var o=$('[name="from_name"]');e=o.attr("value").length?n:o}return Z?t?setTimeout(function(){e.focus()},1.3*W):r?setTimeout(function(){e.focus()},W):E.isTablet||e.focus():e.focus(),E.needCaptcha&&(Ft?(yt.removeClass("i-hidden"),kt.trigger("captcha",{show:!0})):y(function(){Ft=!0})),!1},closeOnReseavedClick:function(e){$(e.target).closest(".b-card, .b-cards__viewcards, .b-cards__postcard").length||Bt.closeCards()},removeReceivedCard:function(){var e=$(this).closest(".b-card");return h(e,this.href),!1},removeSpamCard:function(){var e=$(this).closest(".b-card");return h(e,this.href),!1},switchUnsubscribe:function(){var t=$(this),r=t.data(),a="b-cards__switcher_disabled",n=t.hasClass(a),o=e.getParams().statDataAttr,s=r.csl+"&"+r.cn+"="+Number(!n),c=t.data(n?"dontwant":"want");t.data("showed")||Bt.sendShow(c),t.data("showed",1).toggleClass(a).children().text(n?r.disabletext:r.enabletext),setTimeout(function(){t.data(o,c)},0),(new Image).src=s},answerCard:function(){var e=$(this).closest(".b-card"),t=$(this).closest(".b-card__wrap");return Bt.moveCards(0,Number(t.attr("index"))<2),$t=e[0].onclick().from,Ot.closest(".input").bem("input").val($t,{suggest:!1}),!1}},Lt=et,Ht=H?638:606,Nt=$(".b-cards__enter"),zt=E.isTouch?function(){Nt.css("top",Lt)}:function(){Nt.css("top",Lt-rt.scrollTop())},Dt=E.isTouch?function(){}:function(){S()+rt.scrollTop()>Ht?ot.addClass("b-cards__bottom_fixed"):ot.removeClass("b-cards__bottom_fixed")};E.isTouch||(rt.on("scroll resize orientationchange",function(){zt()}),rt.on("scroll resize orientationchange",$.throttle(Dt,50)));var Wt={showCardsPopup:n,addEnter:function(e){zt(),Dt(),setTimeout(function(){Bt.addEnter(e)},1500)},openEnter:function(){$("#text").blur(),s()}};if(x(),A.showPromo&&(Wt.addEnter($(".b-page")),A.openFlag&&setTimeout(Wt.openEnter,1e3)),A.popupFlag&&setTimeout(Wt.showCardsPopup,1e3),E.progressiveTextArea){var Ut=at.find(".b-cards__message"),Jt=at.find(".b-cards__message-placeholder"),qt=Ut.attr("maxlength");M(Ut,qt,Jt)}!function(){if(E.isTouch){var e,t,r,a,n,o=!1,s=!1,c=40;Nt.on({touchstart:function(s){s.stopPropagation(),e=home.getTouchEvent(s),t=rt.scrollTop(),a=0,r=!1,o=!1,n=e.y},touchmove:function(i){var d=home.getTouchEvent(i),l=d.x-e.x,u=rt.scrollTop();i.stopPropagation(),a+=Math.abs(d.y-n)+Math.abs(u-t),n=d.y,t=u,a>c&&a>l&&!r&&(o=!0),!o&&(l>c||s)&&l>a&&(r=!0,Nt.removeClass("b-cards__enter_opened").addClass("b-cards__enter_closed").off("touchstart touchmove"),i.preventDefault())}})}}()})});