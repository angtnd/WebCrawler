ï»¿(function(){var $d=document,gifNum1=0,gifNum2=0;var uniqueid=(new Date().getTime())*1000+Math.round(Math.random()*1000);var gamebox=$(".yplaym"),screenWidth=gamebox.width(),screenHeight=gamebox.height();var title=["ä¼ªåæ£","å¥½äººå¡è¢«è¿«æ¶éè","å¤±æçéæ¶©å°å¹´","äººçæ æä¹éå¹´","ç¾æä¸èçå±ä¸","æ¤æçå±ä¸ä¹ç","æ­»æ­»å¢èµæ·±ä¼å","æ­»æ­»å¢é¿","é©¬åæå£å®æè","å¨æ­¦çèæ³¥é©¬éªå£«","åæ£ä¾ çèº«"];function createRandomNum(n){return parseInt(Math.random()*n)}function bind(elem,evt,func){if(elem){return elem.addEventListener?elem.addEventListener(evt,func,false):elem.attachEvent("on"+evt,func)}}function isIe6(){return navigator.userAgent.toLowerCase().indexOf("MSIE 6")<0}var vp=null,ovp=null;function viewport(){if(!vp){var e=window,a="inner";if(!("innerWidth" in window)){a="client";e=$d.documentElement||$d.body}vp={width:e[a+"Width"],height:e[a+"Height"]}}if(!ovp){ovp=vp}return vp}function OriViewport(){return ovp}function changeViewport(){ovp=vp;vp=null}function hitTest(a,b){var topA=a.top+(a.collision_gapY||0),topB=b.top+(b.collision_gapY||0),bottomA=topA+(a.collision_height||a.height),bottomB=topB+(b.collision_height||b.height);if(topB>=bottomA||bottomB<=topA){return false}var leftA=a.left+(a.collision_gapX||0),leftB=b.left+(b.collision_gapX||0),rightA=leftA+(a.collision_width||a.width),rightB=leftB+(b.collision_width||b.width);if(rightB<=leftA-(a.speed||0)||leftB>=rightA){return false}return true}var Plane={ratio:[3,3,9],health:[1,1,1],width:[78,100,151],height:[53,72,108],deadWidth:[90,123,182],deadHeight:[58,77,112],collision_gapX:[5,8,10],collision_gapY:[12,17,32],collision_width:[47,58,100],collision_height:[30,44,62],speed:[20,25,18],score:[1,3,10],frames:["-262px -333px","-412px -333px","-648px -333px","-252px -184px","-451px -184","-632px -184px","-230px -38px","-431px -38px","-623px -38px"],getSize:function(){var t=0,r,i;for(i=0;i<Plane.ratio.length;i++){t+=Plane.ratio[i]}r=createRandomNum(t)+1;for(i=0;i<Plane.ratio.length;i++){if(r<=Plane.ratio[i]){return i}r-=Plane.ratio[i]}},createNew:function(){var size=Plane.getSize(),top=createRandomNum(screenHeight-Plane.height[size]-20),planeList=game.planes.planes;for(var i=0;i<planeList.length;i++){var p=planeList[i];if(p.left<screenWidth-Plane.width[2]){continue}if(!(top>=p.top+Plane.height[2]||top+Plane.height[2]<=p.top)){return null}}var plane={left:screenWidth,top:top,speed:Plane.speed[size],status:0,size:size,health:Plane.health[size],width:Plane.width[size],height:Plane.height[size],collision_gapX:Plane.collision_gapX[size],collision_gapY:Plane.collision_gapY[size],collision_width:Plane.collision_width[size],collision_height:Plane.collision_height[size],score:Plane.score[size]};plane.div=$('<div class="plane plane'+(size+1)+'">');plane.div.css({"left":plane.left,"top":plane.top});gamebox.append(plane.div);plane.die=function(){this.width=Plane.deadWidth[this.size];this.height=Plane.deadHeight[this.size];this.div.css({"width":this.width,"height":this.height,"backgroundPosition":Plane.frames[(this.status)+3*this.size]});this.div.css({"width":this.width,"height":this.height});this.status++;if(this.status>=3+1){game.topScore+=this.score}};plane.isDead=function(){return this.status>=3+1};plane.hit=function(){this.health--};plane.remove=function(){this.div.hide();this.div.remove();this.div=null};plane.outOfEdge=function(){return this.left<=-this.width};plane.move=function(){this.left-=this.speed;this.div.css("left",this.left)};return plane}};var Planes=function(){var game,man,seed=0;this.planes=[];this.INIT_SEED=-10;this.init=function(g){game=g;man=g.man};this.clear=function(){for(var i=0;i<this.planes.length;i++){var plane=this.planes[i];plane.remove()}this.planes=[]};this.createNew=function(){if(seed>0&&createRandomNum(10)<seed){this.planes.push(Plane.createNew());seed=this.INIT_SEED}seed++};this.update=function(){this.createNew();var tmp=[];for(var i=0;i<this.planes.length;i++){var plane=this.planes[i];if(!plane){break}if(plane.health<=0){plane.die()}else{plane.move()}if(plane.outOfEdge()||plane.isDead()){plane.remove()}else{tmp.push(plane)}}this.planes=tmp}};var Bullet={createNew:function(left,top){var bullet={left:left,top:top,speed:20,width:8,height:8};bullet.div=$('<div class="bullet">');bullet.div.css({"left":left,"top":top});gamebox.append(bullet.div);bullet.remove=function(){this.div.hide();this.div.remove();this.div=null};bullet.move=function(){this.left+=this.speed;this.div.css("left",this.left)};return bullet}};var Bullets=function(){var bullets=[],game,man,planes,step=20,validHeight=[35,43,65],gap=[23,29,43],width=[80,100,151],rate=2,seed=0;this.init=function(g){game=g;man=g.man;planes=g.planes};this.clear=function(){for(var i=0;i<bullets.length;i++){var bullet=bullets[i];bullet.remove()}bullets=[]};this.createNew=function(){seed++;if(seed==rate){bullets.push(Bullet.createNew(160,man.top+25));if(game.tripleBullet){bullets.push(Bullet.createNew(160,man.top+55));bullets.push(Bullet.createNew(160,man.top-5))}seed=0}};this.update=function(){this.createNew();var tmp=[];for(var i=0;i<bullets.length;i++){var bullet=bullets[i],planeList=planes.planes,isHit=false;bullet.move();for(var j=0;j<planeList.length;j++){if(hitTest(bullet,planeList[j])){hitTest(bullet,planeList[j]);planeList[j].hit();isHit=true;break}}if(isHit||bullet.left>=screenWidth){bullet.remove()}else{tmp.push(bullet)}}bullets=tmp}};var Cloud={createNew:function(){var cloud={left:15,speed:8,edge:650};cloud.update=function(){this.left-=this.speed;if(this.left<=-this.edge){this.left=screenWidth}$("#cloud").css("left",this.left)};return cloud}};var SingleMan=function(){this.left=180;this.top=45;this.status=0;this.collision_gapX=75;this.collision_gapY=10;this.collision_width=75;this.collision_height=45;var elem,play_elem,game,planes,isHit=false,run_speed=10,fly_speed=20,mount_pos=180,run_frames=["-16px -148px","-82px -148px"],mount_frames=["-209px -122px","-326px -122px","-455px -122px","-591px -122px","-722px -122px"],fly_frames=["-13px -20px","-213px -20px","-415px -20px"],hit_frames=["-53px -422px","-194px -422px","-355px -422px"],scene2=$(".yplay"),description=$(".g_text"),process=0;this.init=function(singleman,singleman_play,g){elem=singleman;play_elem=singleman_play;game=g;planes=g.planes};this.reset=function(){this.status=0;isHit=false};this.pos=function(div,frames,i){div.css({"left":this.left,"top":this.top})};this.setLeft=function(left){this.left=left;elem.css("left",left)};this.getLeft=function(){return this.left};this.isFlying=function(){return game.stage==1&&process==2};this.act=function(s){if(s==1){if(process==0){if(this.left<mount_pos){this.left+=run_speed;this.pos(elem,run_frames,this.status%2);this.status++}else{process=1;this.updateFrame(s,process)}}else{if(process==1){if(this.status<=4){this.pos(elem,mount_frames,this.status);this.status++}else{process=2;this.updateFrame(s,process)}}else{if(process==2){if(this.left<viewport().width-100){this.left+=fly_speed;if(this.top>-280){this.top-=5}this.pos(elem,fly_frames,this.status%3);this.status++;game.moveScene()}else{process=3}}}}}else{if(s==2){this.pos(play_elem,fly_frames,this.status%3);this.status++}else{if(s==3){this.pos(play_elem,fly_frames,this.status%3);this.status++}}}};this.updateFrame=function(s,p){this.status=0;p=p||0;if(s==1){elem.attr("class","people people_play cur_none");if(p==0){this.left=180;this.top=45;this.width=55;this.height=63}else{if(p==1){scene2.show();description.show();this.top=22;this.width=100;this.height=88}else{if(p==2){this.width=171;this.height=80}}}}else{if(s==2){elem.hide();this.left=0;this.top=200;this.width=171;this.height=80;play_elem.attr("class","people people_play cur_none").show();this.pos(play_elem,fly_frames,0);this.status=0}else{if(s==3){if(p==0){this.reset();elem.hide();this.left=0;this.width=171;this.height=80;play_elem.attr("class","people people_play cur_none").show()}else{if(p==1){this.left=0;this.width=115;this.height=80;play_elem.attr("class","people people_dead cur_none");this.pos(play_elem,hit_frames,0)}}}}}};this.die=function(){this.pos(play_elem,hit_frames,this.status);this.status++};this.isDead=function(){return game.stage==3&&this.status>=hit_frames.length};this.isAlive=function(){return !isHit};this.update=function(){if(game.stage==1){this.act(game.stage);if(process>=3){game.toStage(2)}}else{if(game.stage==2){this.act(game.stage)}else{if(game.stage==3){if(isHit){this.die();if(this.isDead()){game.toStage(4)}}else{this.act(game.stage);var planeList=planes.planes;for(var i=0;i<planeList.length;i++){if(hitTest(this,planeList[i])){if(planeList[i].size==0){if(planeList[i].health>0){$(".time span").eq(1).html(++gifNum1)}planeList[i].hit()}else{if(planeList[i].size==1){if(planeList[i].health>0){$(".time span").eq(0).html(++gifNum2)}planeList[i].hit()}else{hitTest(this,planeList[i]);isHit=true}}break}}if(game.legendhl){isHit=false}if(isHit){this.updateFrame(game.stage,1)}}}}}}};var Game=function(){this.stage=0;this.topScore=0;this.title="";this.rank=0;this.man=new SingleMan();this.cloud=Cloud.createNew();this.planes=new Planes();this.legendhl=false;this.nobullet=false;this.tripleBullet=false;var that=this,man=that.man,cloud=that.cloud,planes=that.planes,scene1=$("#index"),scene2=$(".yplay"),returnBtn=$(".return_icon"),startBtn=$("#click_start_btn"),difficulty=0,resizeTimer;var lastTop=0,dist=0,cheats="";this.posScene=function(){changeViewport();scene1.css({"height":(viewport().height>610?viewport().height-10:600),"width":viewport().width});scene2.css({"margin-top":(viewport().height>530?-265:-viewport().height/2)});if(man.isFlying()){var ratio=viewport().width/OriViewport().width;scene1.css("left",parseFloat(scene1.css("left"))*ratio);scene2.css("left",parseFloat(scene2.css("left"))*ratio);man.setLeft((man.getLeft()-252)*ratio+252)}else{if(that.stage<=1){scene1.css("left",(viewport().width-scene1.width())/2);scene2.css("left",(viewport().width+(viewport().width-scene2.width())/2))}else{scene1.css("left",-(viewport().width+scene1.width())/2);scene2.css("left",(viewport().width-scene2.width())/2)}}};this.moveScene=function(){var step=20*viewport().width/((viewport().width-460))+1,scene1Left=parseInt(scene1.css("left")),scene2Left=parseInt(scene2.css("left"));if(scene2Left>(viewport().width-scene2.width())/2){scene1.css("left",scene1Left-step);scene2.css("left",scene2Left-step)}else{scene1.css("left",-viewport().width);scene2.css("left",(viewport().width-scene2.width())/2)}if(window.scrollY>0){window.scrollTo(window.scrollX,window.scrollY-5)}};this.init=function(){var logo=$(".logo-box a"),singleman=$("#single_man"),singleman_play=$("#single_man_play");scene1.css({"position":"absolute","width":viewport().width});man.init(singleman,singleman_play,this);planes.init(this);bindActions();this.posScene();logo[0].onclick=singleman[0].onclick=startBtn[0].onclick=function(){sendCl($(this).data("cl"));singleman.css("background",'url("/logo/2015/shengdan/img/qidong2.gif") no-repeat center center');startBtn.hide();if(that.stage<=0){that.toStage(1);that.update();scene2.show()}return false};logo[0].onfocus=singleman[0].onfocus=startBtn[0].onfocus=singleman_play[0].onfocus=function(){this.blur();return false};returnBtn.click(function(){location.reload();sendCl("back")});logo.hover(function(){singleman.addClass("people_hover")},function(){singleman.removeClass("people_hover")});singleman_play.click(function(){return false});$(".y_t3").click(function(){that.toStage(3);that.reset();return false});$(".ka1").click(function(){});$(".ka2").click(function(){that.toStage(3);that.reset();return false});$(".y_x").click(function(){location.reload();return false});$("#homepage").click(function(){});$(window).resize(function(){window.clearTimeout(resizeTimer);resizeTimer=setTimeout(function(){that.posScene()},150)})};this.noCheats=function(){that.legendhl=false;that.nobullet=false;that.tripleBullet=false};this.updateScore=function(){$(".time p").text(this.topScore);var d=[60,150,300];if(difficulty<3&&this.topScore>=d[difficulty]){this.moreDifficult()}};this.moreDifficult=function(){difficulty++;var ratio=[[10,3,1],[10,5,2],[10,6,3],[10,7,4]],speed=[[20,25,18],[24,29,22],[27,32,25],[30,35,28]],seed=[-10,0,4,9];if(difficulty<ratio.length){Plane.ratio=ratio[difficulty];Plane.speed=speed[difficulty];planes.INIT_SEED=seed[difficulty]}};this.reset=function(){Plane.ratio=[9,3,1];Plane.speed=[20,25,18];planes.INIT_SEED=-10;difficulty=0;that.topScore=0;that.noCheats()};this.update=function(){man.update();if(this.stage==3){cloud.update();if(!that.nobullet){if(man.isAlive()){planes.update()}}}setTimeout(function(){that.update()},100)};this.toStage=function(s){this.stage=s;if(s==1){man.updateFrame(1)}else{if(s==2){scene1.hide();if(!isIe6()){returnBtn.fadeIn(1000)}returnBtn.show();man.updateFrame(2)}else{if(s==3){man.updateFrame(3);planes.clear();$(".g_text").hide();sendCl("shubiao");$("#cloud").show();$(".time").show();$(".y_cm").hide()}else{if(s==4){$(".jiesuan-box").show();$(".jiesuan-box .p2 span").html(gifNum1+gifNum2);$(".sd-tj").on("click",function(){var val=$.trim($(".sd-input").val()),isZw=(/^([\u4E00-\u9FA5]+ï¼?)+$/.test(val));if(!isZw&&val!=""){var jiesuan='{"num":'+(gifNum1+gifNum2)+',"text":'+$(".sd-input").val()+"}";$.ajax({url:"web/caidan/paintedegg?cmd=put&uid="+getCookie("SUV")+"&token="+encodeURIComponent(jiesuan)+"t="+Math.random(),async:true});alert("æäº¤æå")}else{alert("è¯·è¾å¥æ­£ç¡®çææºå·æqqé®ç®±")}sendCl("js-tijiao")});$(".sd-share").on("click",function(){var wbText="æ¬å®å®å¥½æ£ï¼å¨#å£è¯å©æ»æ±ª#å¸®å£è¯èäººæ¾å°"+(gifNum1+gifNum2)+"ä¸ªç¤¼ç©ï¼å¿«æ¥åä¸éªæ©è½¦æ¶éç¤¼ç©å§ï¼è¿æå£è¯ç¤¼ç©æ¿ï¼ @æçæç´¢ @æç",text="æ¬å®å®å¥½æ£ï¼å¨æçé¦é¡µå¸®å£è¯èäººæ¾å°"+(gifNum1+gifNum2)+"ä¸ªç¤¼ç©ï¼å¿«æ¥åä¸éªæ©è½¦æ¶éç¤¼ç©å§ï¼è¿æå£è¯ç¤¼ç©æ¿ï¼";shareresult($(this).data("id"),wbText,"","å£è¯æ¢æ¢æ¢",text,text);sendCl("js-"+$(this).data("id"))});$(".sd-zailai").on("click",function(){sendCl("zailai");location.reload();sendCl("js-zailai")});$(".sd-close").on("click",function(){location.reload();sendCl("js-close")})}}}}};function countScore(){var totalscore=0;window["sogouSingleMan"]=function(result){if(result&&result[0]!=""){totalscore=result[0];$(".y_t6 b").text(totalscore)}};var s=document.createElement("script");s.type="text/javascript";s.setAttribute("charset","utf-8");s.src="http://help.sogou.com/logo/singlesday2013/singleman.php?score="+encodeURIComponent(game.topScore);$d.body.appendChild(s)}function bindActions(){bind($d,"mousemove",that.mouseAction);bind($d,"click",function(){if(that.stage==2){that.toStage(3)}});$(document).keypress(pressAction)}function pressAction(e){if(that.stage!=2){return}e=e||event;var c=String.fromCharCode(e.keyCode||e.charCode);cheats+=c;if(cheats.length>20){cheats=cheats.substr(cheats.length-10,cheats.length)}if(cheats.indexOf("legendhl")>=0){that.legendhl=true}if(cheats.indexOf("ie6isgood")>=0){that.nobullet=true;difficulty=3}if(cheats.indexOf("helibravo")>=0){that.tripleBullet=true}if(cheats.indexOf("tohowmakefriend")>=0){that.topScore+=5000;cheats=""}}this.mouseAction=function(evt){if(that.stage==2||(that.stage==3&&man.isAlive())){var top=(evt.clientY||evt.pageY||0)-(viewport().height-screenHeight)/2;if(top>=screenHeight-man.height){top=screenHeight-man.height}if(top<=0){top=0}if(top-man.top>20){top=man.top+20}else{if(man.top-top>20){top=man.top-20}}man.top=top;if(that.stage==2){if(dist==0){lastTop=top;dist=1}else{if(dist<=2000){dist+=Math.abs(lastTop-top);lastTop=top}else{that.toStage(3)}}}}}};var game=new Game();game.init();function getRankByScore(score){var rank;if(score<1){rank=0}else{if(score<=30){rank=1}else{if(score<=60){rank=2}else{if(score<=90){rank=3}else{if(score<=120){rank=4}else{if(score<=150){rank=5}else{if(score<=200){rank=6}else{if(score<=250){rank=7}else{if(score<=300){rank=8}else{if(score<=350){rank=9}else{rank=10}}}}}}}}}}return rank}function getNameByRank(rank){return title[rank]}var shareText="éå¿åå®éï¼å£è¯çæ¬¢ç¤¼ç©æ¥ä¸åï¼æ±ªä»åä½ å¿«æ¥æçé¦é¡µç©æ¸¸æï¼èµ¢å¥åï¼";showShare();share(shareText,"","å£è¯æ¢æ¢æ¢",shareText,shareText);praise();function praise(){var parise=$("#praise"),getPariseOpt={type:"get",name:name};parise.on("click",function(){var $this=$(this);$this.parent().addClass("on");parise.off("click");sendCl("zan")})}function showShare(){var share=$("#share"),shareBox=$("#shareBox");share.on("mouseover",function(){shareBox.show()});share.on("mouseout",function(){shareBox.hide()})}function twshare(surl,params,w,h){var pa=[],_u;for(var i in params){if(params.hasOwnProperty(i)){pa.push("&",i,"=",encodeURIComponent(params[i]))}}pa=pa.join("");pa=pa.substr(1,pa.length);_u=surl+pa;window.open(_u,"","width="+w+", height="+h+", top=0, left=0, toolbar=no, menubar=no, scrollbars=yes, location=yes, resizable=no, status=no")}function shareresult(tname,content,imagelink,desc,summary,qq){var url;switch(tname){case"weibo":url="http://www.sogou.com/?s="+Math.random();twshare("http://service.weibo.com/share/share.php?appkey=1239861421&",{url:url,pic:imagelink,title:content},615,505);break;case"qzone":url="http://www.sogou.com/?t="+Math.random();twshare("http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?",{url:url,pics:imagelink,desc:desc||content,summary:summary||content.split(" ")[0]},615,505);break;case"qq":url="http://www.sogou.com/?t="+Math.random();twshare("http://connect.qq.com/widget/shareqq/index.html?",{showcount:0,url:url,pics:imagelink,desc:qq},750,600);break}}function getCookie(name){var cookieArr=document.cookie.split("; ");var cookieObject={};for(var i=0;i<cookieArr.length;i++){var thisCookie=cookieArr[i],num=thisCookie.indexOf("="),length=thisCookie.length;cookieObject[thisCookie.substring(0,num)]=thisCookie.substring(num+1,length)}if(cookieObject[name]){return cookieObject[name]}else{return""}}var uniqueid=(new Date().getTime())*1000+Math.round(Math.random()*1000),refer=document.referrer;function sendCl(id){var climg=new Image();climg.src=location.protocol.toLowerCase()+"//pb.sogou.com/cl.gif?uigs_productid=webapp&type=logo&sitetype=index&uniqueid="+uniqueid+"&uigs_refer="+refer+"&uigs_cl="+id}function sendPv(sitetype){var pvimg=new Image();pvimg.src=location.protocol.toLowerCase()+"//pb.sogou.com/pv.gif?uigs_productid=webapp&type=logo&sitetype="+sitetype+"&uniqueid="+uniqueid+"&uigs_refer="+refer}function share(content,imagelink,desc,summary,qq){var sText="åäº«å°",shareWeiBo=$("#shareWeiBo"),shareQzone=$("#shareQzone"),shareQFriend=$("#shareQFriend");shareWeiBo.on("click",function(){shareresult("weibo",content,imagelink);sendCl("WeiBo")});shareQzone.on("click",function(){shareresult("qzone",content,imagelink,desc,summary);sendCl("Qzone")});shareQFriend.on("click",function(){shareresult("qq",content,imagelink,desc,summary,qq);sendCl("QFriend")});shareWeiBo.attr("title",sText+"æ°æµªå¾®å");shareQzone.attr("title",sText+"QQç©ºé´");shareQFriend.attr("title",sText+"QQå¥½å")}sendPv("shengdan")})();