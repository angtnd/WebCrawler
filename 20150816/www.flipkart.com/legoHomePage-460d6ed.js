if(typeof(FKART)=="undefined"){FKART={}}FKART.AppOffer=new function(){var a=[],b=[];this.clearList=function(){a=[];b=[];fk_appoffer.updateTopBanner()};this.addAppOnly=function(c){if(a.indexOf(c)==-1){a.push(c);fk_appoffer.updateTopBanner()}};this.addOpenFsn=function(c){if(b.indexOf(c)==-1){b.push(c);fk_appoffer.updateTopBanner()}};this.updateTopBanner=function(){if(a.length===0){$("#fk-header").removeClass("banner-open");$(".fk-header-banner").slideUp("slow")}else{if(!$("#fk-header").hasClass("banner-open")){$("#fk-header").addClass("banner-open");$(".fk-header-banner").slideDown("slow")}if(b.length===0){$(".fk-header-banner .apponly-text-some").hide();$(".fk-header-banner .apponly-text-all").show()}else{$(".fk-header-banner .apponly-text-all").hide();$(".fk-header-banner .apponly-text-some").show()}}};this.updateUrl=function(){$(".fk-header-banner .app-link").data("url",window.location.pathname+window.location.search);$(".fk-header-banner .app-link").data("title",document.title)}};fk_appoffer=FKART.AppOffer;FKART.appOfferPopup=function(ac){var G=$(ac),n=$(".app-link",G),z=$(".app-offers-button",G),P=$(".app-offers-container",G),S=$(".appOnlyDialog-popup-content",G),H=$(".fk-question-mark",G),q,ab,Z,at,J,aw,aa,v,O,x,ak,aj,m,ar,b,N,h,an=false,ai,ad,e,p,al,d,I,f,L,am,F=false,D,ap,c,ah,K,r,t,u,w,A,M,C,j,y=false;function a(){z.click(function(){if(!y){aq("Opened");$(this).addClass("open");H.text("X");setTimeout(function(){P.slideDown(200);y=true},150)}else{aq("Closed");P.slideUp(200,function(){z.removeClass("open");H.text("?");y=false})}});n.click(function(ax){if(!n.hasClass("disabled")){aq("Clicked");l($(this));av();ax.preventDefault()}})}function av(){m=null;E();if(!FKART.login.isUserLoggedIn()){x.hide();ae()}else{if(an==true){x.show();q.hide();C=setTimeout(function(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:ap,lid:c,sid:ah,query:K,offerid:D,title:r,subtitle:t,vertical:u,url:w},type:"POST",dataType:"json",success:function(ax){if(ax.deviceFound&&ax.notificationSent){af()}else{W()}},error:function(){W()}})},7000)}else{ae()}}}function Q(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:ap,lid:c,sid:ah,query:K,offerid:D,title:r,subtitle:t,vertical:u,url:w},type:"POST",dataType:"json"})}function aq(ay){var ax={};if(ay=="Clicked"){ax.products=s.products}var az=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar50","prop1","prop2","prop3","prop4","prop35");for(i in az){if(typeof s[az[i]]!="undefined"){ax[az[i]]=s[az[i]]}}ax.prop21="OpenInApp_"+ay;FKART.omni.customEvent("App only offers",ax)}function af(){k();x.hide();if(A&&A.length>0){var ax=$("<img>");ax.attr("src",A);aw.append(ax)}else{aw.remove()}ab.show();V();aq("PNSent")}function W(){k();x.hide();aa.show();aq("PNFailed")}function E(){m=new FKART.ui.Dialog({showFooter:false,cssClass:"appOnlyDialog",body:S.html(),destroyOnHide:true,width:"620px"});b=m.getContainer();x=b.find(".loadingDiv");q=b.find(".smsDiv");ab=b.find(".successDiv");Z=q.find(".stitle");J=q.find(".footerLoggedIn");at=q.find(".footerNotLoggedIn");aw=ab.find(".phone-image span");ai=b.find(".smsForm");ar=b.find(".successPrefixDiv");aa=b.find(".errorDiv");ak=b.find(".send-sms-fake-link");aj=b.find(".send-sms-link");j=b.find(".timer");N=b.find(".retry-notification");m.show();if(!FKART.login.isUserLoggedIn()){at.show();J.hide()}else{at.hide();J.show()}Y()}function Y(){b.on("beforeHide",function(ax){g();k();F=false});aj.click(function(){ab.hide();ar.show();aa.hide();Z.remove();ae();aq("PNExpired")});N.click(function(){m.hide();an=true;av();aq("PNReTried")})}function T(){L=f.val();if(!(/^[789]\d{9}$/.test(L))){f.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendSMSForNumber",type:"POST",data:{pid:ap,lid:c,sid:ah,query:K,offerid:D,title:r,subtitle:t,vertical:u,url:w,phoneNumber:L,captchaText:al.val(),captchaId:d.attr("id")},dataType:"json",success:function(ax){if(ax.captchaStatus){if(ax.smsStatus){ag();Q()}else{X()}}else{au()}},error:function(){X()}})}}function au(){R();al.addClass("error").val("").attr("placeholder","Invalid code").focus()}function ag(){Z.hide();e.hide();ai.hide();I.html(L);v.show();aq("SMSSent")}function X(){Z.hide();e.hide();ai.hide();aa.hide();I.html(L);O.show();aq("SMSFailed")}function ae(){f=ai.find(".phoneNumber");L=FKART.login.userPhoneNumber;f.val(L);ad=ai.find("input[type=button]");e=q.find(".infoDiv");Z=q.find(".stitle");v=q.find(".smsSuccessDiv");O=q.find(".smsErrorDiv");h=q.find(".retry-sms");p=ai.find(".captchaDiv");al=ai.find(".captchaText");am=ai.find(".refreshCaptcha");I=q.find(".phone_number");if(/^\d{10}$/.test(L)){F=true;R()}q.show();m.reposition();B()}function B(){am.click(function(){R();al.val("").focus()});ad.click(function(ax){T();aq("SMSTried");ax.preventDefault()});h.click(function(){Z.show();v.hide();e.show();ai.show();O.hide();al.removeClass("error").val("").attr("placeholder","Enter code").focus();R();aq("SMSReTried")});f.focus(function(){aq("PhoneNumberFocused");if(!F){F=true;R()}})}function R(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(ax){if(ax.success){d=p.find("img");d.attr("src","data:image/png;base64,"+ax.captchaBytes);d.attr("id",ax.id);p.show();al.show();d.load(function(){if(this.complete){m.reposition()}})}else{p.find("img").attr("alt","Captcha failed to load")}},error:function(){p.find("img").attr("alt","Captcha failed to load")}})}function g(){clearInterval(M);M=null}function k(){clearInterval(C);C=null}function V(){M=setInterval(function(){var ax=parseInt(j.html());if(ax==0){g();ak.hide();aj.show()}j.html(ax-1)},1000)}function o(ay,ax){if(ay.indexOf("?")!==-1){var aB=ay.split("?")[1];var aA=aB.split("&");for(var az=0;az<aA.length;az++){var aC=aA[az].split("=");if(aC[0]==ax){return aC[1]}}}}function ao(){var ax=FKART.urlParser().get("sid");if(ax!="undefined"){return ax}}function l(ax){A=ax.data("image");if(ax.data("pid")){ap=ax.data("pid").toString();u=ax.data("vertical");if(ax.data("lid")){c=ax.data("lid").toString()}D=ax.data("offerid")}else{K=ax.data("query");ah=ao();if(ah){u=("BROWSE_"+ah).toUpperCase()}else{u="BROWSE_SEARCH"}ap=o(ax.data("url"),"pid");D=o(ax.data("url"),"offer");r=ax.data("title");t=ax.data("subtitle");w=ax.data("url")}an=false}function U(){a()}U()};register_controller("AppOffersCtrl",function(a){FKART.appOfferPopup(a)});