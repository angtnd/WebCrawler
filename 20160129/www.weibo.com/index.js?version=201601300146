STK.register("v6.lib.kit.io.ajax",function(a){var b=function(b,c,d){c=c|0||1;d=d||"fail";var e=b.args;e.__rnd&&delete e.__rnd;(new Image).src="http://weibolog.sinaapp.com/?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d;(new Image).src="http://s1.sinaedge.com/whb.gif?t="+c+"&u="+encodeURIComponent(b.url)+"&p="+encodeURIComponent(a.core.json.jsonToQuery(e))+"&m="+d};return function(c){var d={},e=[],f=null,g=!1,h=a.parseParam({url:"",method:"get",responseType:"json",timeout:3e4,onTraning:a.funcEmpty,isEncode:!0},c);h.onComplete=function(a){g=!1;c.onComplete(a,h.args);setTimeout(i,0)};h.onFail=function(a){g=!1;if(typeof c.onFail=="function")try{c.onFail(a,h.args)}catch(d){}setTimeout(i,0);try{b(h)}catch(d){}};h.onTimeout=function(a){try{b(h);c.onTimeout(a)}catch(d){}};var i=function(){if(!!e.length){if(g===!0)return;g=!0;h.args=e.shift();if(h.method.toLowerCase()=="post"){var b=a.core.util.URL(h.url);b.setParam("__rnd",+(new Date));h.url=b.toString()}f=a.ajax(h)}},j=function(a){while(e.length)e.shift();g=!1;if(f)try{f.abort()}catch(b){}f=null};d.request=function(a){a||(a={});c.noQueue&&j();if(!c.uniqueRequest||!f){e.push(a);a._t=0;i()}};d.abort=j;return d}});
STK.register("v6.lib.kit.io.jsonp",function(a){return function(b){var c=a.parseParam({url:"",method:"get",responseType:"json",varkey:"_v",timeout:3e4,onComplete:a.funcEmpty,onTraning:a.funcEmpty,onFail:a.funcEmpty,isEncode:!0},b),d=[],e={},f=!1,g=function(){if(!!d.length){if(f===!0)return;f=!0;e.args=d.shift();e.onComplete=function(a){f=!1;c.onComplete(a,e.args);setTimeout(g,0)};e.onFail=function(a){f=!1;c.onFail(a);setTimeout(g,0)};a.jsonp(a.core.json.merge(c,{args:e.args,onComplete:function(a){e.onComplete(a)},onFail:function(a){try{e.onFail(a)}catch(b){}}}))}},h={};h.request=function(a){a||(a={});d.push(a);a._t=1;g()};h.abort=function(a){while(d.length)d.shift();f=!1;e=null};return h}});
STK.register("v6.lib.kit.io.ijax",function(a){return function(b){var c=a.parseParam({url:"",timeout:3e4,isEncode:!0,abaurl:null,responseName:null,varkey:"callback",abakey:"callback"},b),d=[],e=null,f=!1;c.onComplete=function(a,d){f=!1;b.onComplete(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};c.onFail=function(a,d){f=!1;b.onFail(a,c.form,d);c.form=null;c.args=null;setTimeout(g,0)};var g=function(){var b;if(!!d.length){if(f===!0)return;f=!0;b=d.shift();c.args=b.args;c.form=b.form;e=a.ijax(c)}},h=function(a){while(d.length)d.shift();f=!1;if(e)try{e.abort()}catch(b){}e=null},i={};i.request=function(c,e){if(!a.isNode(c))throw"[lib.kit.io.ijax.request] need a form as first parameter";e||(e={});b.noQueue&&h();d.push({form:c,args:e});g()};i.abort=h;return i}});
STK.register("v6.lib.kit.io.inter",function(a){var b=a.core.json.merge;return function(){var c={},d={},e={},f=function(a,b){return function(c,d){try{b.onComplete(c,d)}catch(f){}try{c.code==="100000"?b.onSuccess(c,d):b.onError(c,d)}catch(f){}for(var g in e[a])try{e[a][g](c,d)}catch(f){}}},g=function(a,b,c){return function(d){try{b.onComplete(d,c)}catch(f){}try{d.code==="100000"?b.onSuccess(d,c):b.onError(d,c)}catch(f){}for(var g in e[a])try{e[a][g](d,c)}catch(f){}}};c.register=function(a,b){if(typeof d[a]!="undefined")throw a+" registered";b.url&&(b.url+=b.url.indexOf("?")>=0?"&ajwvr=6":"?ajwvr=6");d[a]=b;e[a]={}};c.addHook=function(b,c){var d=a.core.util.getUniqueKey();e[b][d]=c;return d};c.rmHook=function(a,b){e[a]&&e[a][b]&&delete e[a][b]};c.getTrans=function(c,e){var g=b(d[c],e);g.onComplete=f(c,e);var h=d[c].requestMode,i="ajax";if(h==="jsonp"||h==="ijax")i=h;return a.v6.lib.kit.io[i](g)};c.request=function(c,e,f){var h=b(d[c],e);h.onComplete=g(c,e,f);h=a.core.obj.cut(h,["noqueue"]);h.args=f;var i=d[c].requestMode;return i==="jsonp"?a.jsonp(h):i==="ijax"?a.ijax(h):a.ajax(h)};return c}});
STK.register("v6.conf.trans.register",function(a){var b=a.v6.lib.kit.io.inter(),c=b.register;c("checkform",{url:"/signup/v5/formcheck",method:"get"});c("sendsmsjsonp",{url:"http://weibo.com/signup/v5/formcheck"+($CONFIG.page?"?page="+$CONFIG.page:""),requestMode:"jsonp",method:"get"});c("get_pin_code",{url:"/signup/v5/getpincodev6",method:"get"});c("check_pin_code",{url:"/signup/v5/checkpincode",method:"post"});c("unlogin_page_fetch_feed",{url:"/a/aj/transform/loadingmoreunlogin",method:"get"});c("unlogin_page_follow",{url:"/a/aj/unlogin/follow",method:"post"});return b});
STK.register("v6.lib.kit.extra.language",function(a){window.$LANG||(window.$LANG={});return function(b){var c=[].splice.call(arguments,1,arguments.length),d=[b,$LANG].concat(c),e=a.core.util.language.apply(this,d);return e}});
STK.register("v6.pl.register.feed.source.init",function(a){function i(b,c){if(i.fatching!==!0){i.fatching=!0;a.v6.conf.trans.register.request("unlogin_page_fetch_feed",{onError:function(){i.fatching=!0},onFail:function(){i.fatching=!0},onSuccess:function(d){i.fatching=!1;var e=a.C("div");e.innerHTML=d.data.replace("onerror","_onerror");c(a.sizzle("[action-type=feed_list_item]",e),b)}},{page:b})}}var b=a.v6.lib.kit.extra.language,c=a.v6.conf.core.ui,d=b('<a href="javascript:void(0)">#L{ä½ ææ°å¾®åï¼ç¹å»æ¥ç}</a>'),e=b('<span class="wrap"><i class="W_loading"></i>#L{æ­£å¨å è½½ä¸­}</span>'),f='<div class="WB_cardwrap WB_notes">'+d+"</div>",g=b('<div class="WB_cardwrap S_bg2"> <div class="WB_empty" action-data="page_id=v6_content_home"> <div class="WB_innerwrap"> <div class="empty_con clearfix"> <p class="text"><i class="W_loading"></i>#L{æ­£å¨å è½½ä¸­ï¼è¯·ç¨å...}</p> </div> </div> </div> </div>'),h=b('<a class="W_btn_b W_btn_b_disable btn_22px" href="javascript(0);">#L{å·²å³æ³¨}</a>');return function(b){function u(b){a.v6.conf.trans.register.request("unlogin_page_follow",{onSuccess:function(){c.badge(b.el.parentNode,h)},onError:function(a){c.alert(a.msg,{icon:"warnB"})}},b.data)}function t(){m.parentNode&&m.getBoundingClientRect().top<a.winSize().height&&s()}function s(){n>=o?q():i(n+1,function(b,c){n=c;var d;while(d=b.shift())a.insertBefore(d,m);b=d=null;q()})}function r(){if(n>=o)q();else{l.innerHTML=e;i(n+1,function(b,e){n=e;var f;while(f=b.pop()){a.insertAfter(f,l);c.effect(f,"fadeInDown")}b=f=null;l.innerHTML=d;l.style.display="none";q();p()})}}function q(){if(n>=o){l.style.display="none";m.style.display="none"}}function p(){l.style.display="none";clearTimeout(p.timer);p.timer=setTimeout(function(){l&&(l.style.display="")},3e5)}var j=a.delegatedEvent(b),k=a.sizzle("[action-type=feed_list_item]"),l=a.builder(f).box.firstChild,m=a.builder(g).box.firstChild;a.insertBefore(l,k[0]);a.insertAfter(m,k[k.length-1]);var n=1,o=20;a.addEvent(l,"click",r);a.addEvent(window,"scroll",t);j.add("follow","click",u);p();t();return{destroy:function(){a.removeEvent(l,"click",r);a.removeEvent(window,"scroll",t);j.destroy()}}}});
STK.pageletM.register("pl_unlogin_home_feed",function(a,b){return a.v6.pl.register.feed.source.init(a.E(b))});
