define(["jquery-1"],function(a){if(window.bbcdotcom&&typeof bbcdotcom.objects!=="undefined"&&bbcdotcom.objects("bbcdotcom.av.emp.adverts","create")){bbcdotcom.av.emp.adverts=(function(){var v,u,x;v={mpu:{slot:"mpu",size:"300x250",type:"adi",domId:"bbccom_mpu"}};u={MAP:[v.mpu],media_asset:[v.mpu],"default":[],video:[v.mpu],blog:[v.mpu],homepage:[],none:[]};x=[];function y(E){var B=new RegExp(E+"=(.*?)(?:;|$)");var D=B.exec(document.cookie);var C=(D&&D.length?D[1]:false);return C}function t(){var B=document.createElement("script");B.async=true;B.type="text/javascript";B.src="http://s0.2mdn.net/instream/html5/gpt_proxy.js";var C=document.getElementsByTagName("script")[0];C.parentNode.insertBefore(B,C)}function n(D){var B=r();var C=new RegExp(/(ad_rule=)\d{1}/g);if(C.test(B)==false){B=B+"&ad_rule="+(D?D:1)}return B}function k(){var E,D=bbcdotcom.adverts.keyValues.getAll(),C="&cust_params=",B;for(E in D){if(D.hasOwnProperty(E)&&D[E]!==""){C+=E+"%3D"+D[E]+"%26"}}if(bbcdotcom.objects("bbcdotcom.adverts.adUnit.getPreviewUid")){B="uid="+bbcdotcom.adverts.adUnit.getPreviewUid();C+=encodeURIComponent(B)}return C}function r(E){var B,G="",C="",F,D=bbcdotcom.av.emp.adverts.getCompanionSlots(E);if(typeof D!=="undefined"){for(F in D){if(D.hasOwnProperty(F)){G+=D[F].size+","}}G=G.slice(0,-1)}if(typeof BBC!=="undefined"&&typeof BBC.adverts!=="undefined"&&typeof BBC.adverts.empCompanion==="function"){B=BBC.adverts.empCompanion(G)}else{if(typeof bbcdotcom!=="undefined"&&typeof bbcdotcom.advert!=="undefined"&&typeof bbcdotcom.advert.getPrerollAdTag==="function"){B=bbcdotcom.advert.getPrerollAdTag(bbcdotcom.adUnit)}else{if(typeof bbcdotcom!=="undefined"&&typeof bbcdotcom.objects!=="undefined"&&bbcdotcom.objects("bbcdotcom.adverts.adUnit.get")&&bbcdotcom.objects("bbcdotcom.adverts.keyValues.getAll")){C=(G!=="")?"&ciu_szs="+G:"";B="http://pubads.g.doubleclick.net/gampad/ads?sz=512x288&iu="+bbcdotcom.adverts.adUnit.get()+k()+C+"&env=vp&gdfp_req=1&impl=s&output=xml_vast2&unviewed_position_start=1&ord="+(Math.floor(Math.random()*1000000000))+"&url="+encodeURIComponent(encodeURIComponent(bbcdotcom.config.getWindowLocation().href))+"&ad_rule=1"}}}return B}function h(D){bbcdotcom.av.emp.adverts.enableCompanions();var C=bbcdotcom.av.emp.adverts.getCompanionSlotId(D);var B=bbcdotcom.av.emp.adverts.getCompanionSlots(C);bbcdotcom.av.emp.adverts.defineCompanionSlots(B)}function f(D){var C,B;C=D.split("-");if(C.length===1){C=D.split("_")}if(C.length>=2){B=C[1]}else{B=false}return B}function A(D){var B=[],C;for(C=0;C<D.length;C++){B[C]={};B[C].slot=D[C].slot;B[C].size=D[C].size;B[C].type=D[C].type;B[C].domId=D[C].domId}return B}function i(G){var F,E,D,C,B;if(typeof BBC!=="undefined"&&typeof BBC.adverts!=="undefined"&&typeof BBC.adverts.getZoneData!=="undefined"){B=BBC.adverts.getZoneData()}else{B={}}if(window.wwhomepage){F=A(u.homepage)}else{if(bbcdotcom.objects("bbcdotcom.config.isContinuousPlayPage")&&bbcdotcom.objects("config.asset.type")!=="MAP"){F=A(u.none)}else{if(bbcdotcom.objects("config.asset.type")==="MAP"&&(bbcdotcom.objects("bbcdotcom.getCurrentGroupId")===3||bbcdotcom.objects("bbcdotcom.getCurrentGroupId")===4)){F=A(u[config.asset.type])}else{if(bbcdotcom.objects("bbc.fmtj.page.assetType")&&BBC.adverts.isCreamDataPresent()){if(u[bbc.fmtj.page.assetType]!==undefined){F=A(u[bbc.fmtj.page.assetType])}else{F=A(u["default"])}}else{if(bbcdotcom.objects("zoneData.keyValues.asset_type")&&B.keyValues.asset_type==="video"){F=A(u[B.keyValues.asset_type])}else{if(bbcdotcom.objects("zoneData.keyValues.companion_slots")){D=B.keyValues.companion_slots.split(",");C=[];for(E=0;E<D.length;E++){C.push(v[D[E]])}F=A(C)}else{F=A(u["default"])}}}}}}if(G){for(E=0;E<F.length;E++){if(F[E].slot==="companion"){F[E].domId=F[E].domId+"_"+G}}}return F}function l(E){var B="",C,D;for(C=0;C<E.length;C++){D="";D+="slot:"+E[C].slot+"|";D+="size:"+E[C].size+"|";D+="type:"+E[C].type+"|";D+="domId:"+E[C].domId+";";B+=D}return B}function z(C){var B=[],G,F,D,H,E;G=C.split(";");for(F=0;F<G.length;F++){if(""!==G[F]){B[F]={};H=G[F].split("|");for(D=0;D<H.length;D++){E=H[D].split(":");B[F][E[0]]=E[1]}}}return B}function s(C,B){return function(){BBC.adverts.resetSlotForGpt(C,B)}}function e(C,B){return(" "+C.className+" ").indexOf(" "+B+" ")>-1}function m(D){var C,G,F,E,B;for(C=0;C<D.length;C++){G=D[C].slot;F=D[C].domId;E={slotDomId:F,size:D[C].size};B=document.getElementById(F);if(B&&x.join(",").indexOf(G)===-1){x.push(G);if(typeof BBC!=="undefined"&&typeof BBC.adverts!=="undefined"){if(!e(B,"bbccom_display_none")&&!e(B,"bbccom_visibility_hidden")){BBC.adverts.slideSlotClosed(G,E,s(G,E))}else{BBC.adverts.resetSlotForGpt(G,E)}}else{if(typeof bbcdotcom!=="undefined"&&typeof bbcdotcom.adverts!=="undefined"){w(G,E)}}}}}function w(H,G){var F=G.size,E=parseFloat(F.slice(0,F.indexOf("x"))),C=parseFloat(F.slice(F.indexOf("x")+1)),D,B;if(window.googletag){D=document.getElementById(G.slotDomId);if(D){B=G.slotDomId+"_inner";a("#"+G.slotDomId).html('<div class="bbccom_companion_inner"><a href="'+bbcdotcom.locale.get("advertInfoPageUrl")+'" class="bbccom_text">'+bbcdotcom.locale.get("advertisementText")+'</a><div class="bbccom_advert_inner" id="'+B+'"></div></div>');googletag.cmd.push(function(){googletag.defineSlot(bbcdotcom.adverts.adUnit.get(),[E,C],B).addService(googletag.companionAds()).addService(googletag.pubads());googletag.companionAds().setRefreshUnfilledSlots(false);googletag.pubads().disableInitialLoad();googletag.enableServices();googletag.display(B)});p(D,function(){o(G.slotDomId);if(typeof bbcdotcom!=="undefined"&&typeof bbcdotcom.utils!=="undefined"){bbcdotcom.utils.addBodyTagClass("bbccom_companion")}})}}}function p(E,G,C){var F,D,B;B={cur:0,max:5000};if(C===undefined){C=100}F=E.innerHTML;D=setInterval(function(){var H;H=(F!==E.innerHTML);if(H){G();clearInterval(D)}else{if(B.cur<B.max){B.cur++}else{clearInterval(D)}}},C)}var o=function(B){a("#"+B).addClass("bbccom_visibility_show").slideDown("slow")};function j(C,E){var D,B;if(E!==undefined&&E.length>0){D=l(E);C.set("companions",D);for(B=0;B<E.length;B++){C.set("companion"+(B+1)+"Size",E[B].size);C.set("companion"+(B+1)+"Type",E[B].type);C.set("companion"+(B+1)+"Id",E[B].domId)}}}function g(C){var D,B;C.set("preroll",r(D));D=f(C.getDomId());B=i(D);j(C,B);if(BBC.adverts.isNewsPage()){m(B)}}function c(H,E){var D=r()+"&ad_rule=1";var F=bbcdotcom.config.getAssetPrefix()+"vendor/smp/adsPlugin/css/AdsPlugin.css";var C=y("bbcdotcomHtml5AdsDebug");var B={name:"AdsPluginParameters",data:{playerDomId:H,adTag:D,bbcdotcom:bbcdotcom,debug:C,cssPath:F}};for(var G in E){B.data[G]=E[G]}return B}function d(C,B){var D=B.settings();D.suppressItemKind=C;B.settings(D);return B}function q(B,C,K){var H=C.bumpVersion.split("."),I=H[0],G=H[1],E=H[2],J,K=K||{},D,F;if(/(sandbox|int)(.dev)*.bbc.co*/.test(window.location.href)||/[?|&]ads-debug/.test(window.location.href)||document.cookie.indexOf("ads-debug=")!==-1){D=bbcdotcom.config.getAssetPrefix()+"vendor/smp/adsPlugin/js/AdsPlugin.js"}else{D=bbcdotcom.config.getAssetPrefix()+"vendor/smp/adsPlugin/js/AdsPlugin.min.js"}if(typeof BBC==="undefined"&&a(".bbcdotcom_desktop").length===0){b(B)}if(K&&K.html5PluginPath){D=bbcdotcom.config.getAssetPrefix()+K.html5PluginPath}F=bbcdotcom.config.getAssetPrefix()+"vendor/smp/adsPlugin/swf/AdsPlugin.swf";if(C.loadPlugin!==undefined&&typeof C.loadPlugin==="function"){J=c(B,K);C.loadPlugin({html:D,swf:F},J)}d(["ident"],C)}function b(C){var B=C.replace("media-","");if(typeof a!=="undefined"){a("#media-asset-page-video").after('<div id="bbccom_companion_'+B+'" class="bbccom_companion_outer"></div>');a(".media-feeds").prepend('<div id="bbccom_mpu" class="bbccom_mpu_outer"></div>');if(a("#"+C).width()>=300){a("#"+B+" .media-item").append('<div id="bbccom_companion_'+B+'" class="bbccom_companion_outer"></div>')}}}return{getPrerollAdTag:r,getPrerollAdTagWithAdRule:n,setupCompanionSlots:h,enableCompanions:t,getCompanionSlotId:f,getCompanionSlots:i,encodeCompanionSlots:l,decodeCompanionSlots:z,defineCompanionSlots:m,setCompanionFlashVars:j,playerBeforeEachWrite:g,addSmpPlugin:q}}());return bbcdotcom.av.emp.adverts}});