/**
 * @modified $Author: mushaofeng $
 * @version $Rev: d7eda241a2160232e8e374cc98ea249e94005a34 $
 */
!function(e){require.config({enable_ozma:true});define("page/find/main/model",["tui/event","tui/net","module/login/login"],function(e,t,n){var i=e.extend({initialize:function(){var e=this;i.superClass.initialize.call(e);this.uid=n.getUserInfo()&&n.getUserInfo().uid||0;this.cookie_id=n.guid();e.op={callbackName:"callback",charset:"utf-8"};e.config={currentRecommendStatus:0,tryJsonTime:3,recommendNumber:12,anonymousRecommendNumber:12,loginStatus:n.isLogin(),randomArray:[],req_id:e.randomStr(3),maxRefreshCount:3,lockRecommend:true,lockRecommendData:true}},getRecommendData:function(){var e=this,n;var i=e.config;if(i.loginStatus)n="http://ykrec.youku.com/personal/packed/list.json?apptype=1&pg=8&module=1&pl="+parseInt(i.recommendNumber)*parseInt(i.maxRefreshCount)+"&picSize=1&module=1&pz=30&req_id="+i.req_id+"&uid="+e.uid;else n="http://ykrec.youku.com/personal/packed/list.json?apptype=1&pg=8&module=1&pl="+parseInt(i.anonymousRecommendNumber)*parseInt(i.maxRefreshCount)+"&picSize=1&module=1&pz=30&req_id="+i.req_id;t.getJSON(n,{guid:e.cookie_id,timestamp:e.randomStr(10)},function(t){var n=t.data;if("undefined"==typeof n||n.length<i.recommendNumber)if(e.currentRecommendStatus<i.tryJsonTime){e.getRecommendData();e.currentRecommendStatus++}else return false;else e.trigger("recommend:success",[n])},e.op)},randomStr:function(e){var t="0123456789qwertyuioplkjhgfdsazxcvbnm";var n="";var i=(new Date).getTime();for(var r=0;r<e;r++)n+=t.charAt(Math.ceil(1e8*Math.random())%t.length);return i+n}});return i});define("page/find/main/recommend",["tui/net","module/login/login","tui/view","tui/art","tui/util/num","tui/util/date","page/find/main/model"],function(t,n,i,r,a,o,s){return i.extend({el:e("#ykRecommend"),events:{"click .yk-rec-refresh":"refreshDom"},initialize:function(){var e=this;this.refreshCount=0;this.recData=[];this.data=new s;this.config=this.data.config;this.data.bind("recommend:success",this.renderREC.bind(this));e.data["getRecommendData"].call(e.data)},renderREC:function(e){this.recData=e;e=this.recData.slice(0,this.config.recommendNumber);this.renderData(e)},renderData:function(t){var n='        <div class="yk-row">\n<% data.forEach(function(t, i){ %>\n<% if (config.loginStatus==true) { %>\n<% var module=1 %>\n<% }else { %>\n<% var module=3 %>\n<% } %>\n<% var pos=count+i %>\n<% var log=\'{"apt":"1","pg":"8","md":"\'+module+\'","id":"\'+ t.id +\'","abver":"A","dma":"\' + t.dma + \'","pos":"\' + pos + \'","ord":"0","algInfo":"\' + t.algInfo + \'","dct":"\' + t.dct + \'","req_id":"\'+config.req_id+\'"}\'%>\n<%log=encodeURIComponent(log)%>\n<% if (i%2==0){ %>\n<div class="yk-col4 <%if (i==6){%>  colx  <%}else if(i==4){%> colxx <%}%>">\n<% } %>\n<div class="yk-pack p-list <% if ((i+1)%2!=0){%>  mb20 <%}%>" taglog="<%=log%>">\n<div class="p-thumb">\n<a href="<%=t.playLink%>" title="<%=t.title%>" target="new"></a>\n<i class="bg"></i>\n<img class="quic" src="<%=t.picUrl%>">\n</div>\n<ul class="p-info pos-bottom">\n<li class="status">\n<span class="p-time hover-hide">\n<i class="ibg"></i>\n<span><%=sec(t.totalTime,false)%></span>\n</span>\n</li>\n</ul>\n<ul class="info-list">\n<li class="title" >\n<a href="<%=t.playLink%>" target="_blank"><%=t.title%></a>\n</li>\n<li class="num">\n<span class="num-play"><%=num(t.playAmount)%></span>\n<span class="num-comment"><%=num(t.commentCount)%></span>\n</li>\n</ul>\n</div>\n<%if ((i+1)%2==0){ %>\n</div>\n<% } %>\n<% }); %>\n</div>\n',i=r.compile(n)({data:t,num:a.field,sec:o.beautyTime,encodeURIComponent:encodeURIComponent,config:this.config,count:this.refreshCount*this.config.recommendNumber}),s=e("#ykRecommend");s.find(".c").append(i);s.removeClass("ajax-loading").css("display","block");this.trigger("refresh:success",[])},refreshDom:function(){var t=this;var n=e("#ykRecommend").addClass("ajax-loading").find(">.c").empty();this.refreshCount<this.config.maxRefreshCount-1?this.refreshCount++:this.refreshCount=0;var i=this.refreshCount*this.config.recommendNumber;var r=i+this.config.recommendNumber;var a=this.recData.slice(i,r);var o=setTimeout(function(){t.renderData(a);clearTimeout(o)},300)}})});define("page/find/main/fixmod",["tui/view","tui/art","tui/util/num"],function(t,n,i){var r=e(window);var a=t.extend({el:e("#FixMod"),initialize:function(t){var n=this,i;a.superClass.initialize.call(n);this.mods=e(".mod-fix");this.modPos=[];this.curIndex=-1;this.clickEvent=false;n.check();this.render();this.setCenter();r.scroll(function(){if(!n.clickEvent)n.initStatus()});r.bind("scroll resize",function(){i&&clearTimeout(i);i=setTimeout(function(){n.check.call(n)},100)})},events:{"click li":"goIndex"},render:function(){var t,n,i="";t=this;e.each(this.mods,function(t,n){i+='<li class="gray" data-stat-role="ck"><i class="fix-tip">'+e(n).attr("title")+'</i><img  src="'+e(n).attr("src")+'"/></li>'});this.$el.html(i);this.$el.find(">li").hover(function(){e(this).removeClass("gray")},function(){if(!e(this).hasClass("current"))e(this).addClass("gray")});this.initStatus();e("#sideBar").css("display","block")},check:function(){var t=e("body")[0];var n=t.className.match(/w(\d+)/)[1];var i=r.width();if(i-n<125||r.scrollTop()<350)e(this.el).fadeOut("fast");else e(this.el).fadeIn("fast");this.setCenter()},initStatus:function(){this.getCurIndex();this.setCurrent()},goIndex:function(t){var n,i,r;this.getPos();r=this;n=this.items.index(e(t.currentTarget));i=this.mods.eq(n).offset().top-200;this.clickEvent=true;e("body,html").animate({scrollTop:i},600,function(){r.curIndex=n;r.setCurrent();r.clickEvent=false})},getPos:function(){var t=this,n;this.items=this.$el.find("li");t.modPos=[];e.each(this.mods,function(i,r){n=e(r).parents(".mod").offset().top;t.modPos.push(n)})},getCurIndex:function(){var t=this,n,i,a=true;i=r.scrollTop();this.getPos();t.curIndex=-1;e.each(this.mods,function(e,n){if(t.modPos[e]>=i&&t.modPos[e]<=i+r.height()&&a){t.curIndex=e;a=false}})},setCurrent:function(){this.items.removeClass("current").addClass("gray");if(this.curIndex>=0)this.items.eq(this.curIndex).addClass("current").removeClass("gray")},setCenter:function(){var t=e("#sideBar"),n=e(".yk-header"),i=r.height()-e(n).height(),a=e(this.el).height(),o=parseInt((i-a)/2);if(o>135&&e(this.el).is(":visible"))e(this.el).css({bottom:o+"px"});else e(this.el).css({bottom:"135px"})}});return a});define("tui/slide2",["tui/event","tui/browser","tui/lazyImageLoader"],function(t,n){var i=t.extend({initialize:function(t){var o=this;o.box=t;o.panel=t.find(".panel");i.superClass.initialize.apply(o,arguments);o.current=0;var s=o.box.find(".lazyContent");if(s[0]){o.box.eq(0).html(s.val());n({imgs:o.box.find(".lazyImg")})}setTimeout(function(){o.setPos()},100);t.delegate(".mbtn a","click",function(t){t.preventDefault();o.setPos();var n=e(this).closest(".mbtn").hasClass("next");var i=n?o.current>=o.step?o.step:++o.current:o.current<=0?0:--o.current;a(o.panel,o.pos[i]);o.resetBtn();r(o.panel)});e(window).bind("resize",function(){if(o.panel.is(":visible"))o.setPos()})},resetBtn:function(){var e=this;var t=e.box.find(".prev, .next");switch(e.current){case 0:t.eq(1).show();t.eq(0).hide();break;case e.step-1:t.eq(0).show();t.eq(1).hide();break;default:t.show()}},setPos:function(){var t=this;var n=t.box;var i=t.box.width();var r=0;t.$item=t.panel.children();t.pos=[0];var a=t.box.attr("id");t.panel.css({width:5e4});e.each(t.$item,function(n){var a=e(this),o=a.width();r=a.position().left+o;if(a.position().left+o>i*t.pos.length)t.pos.push(a.position().left);if(n==t.$item.length-1&&r-i>0){var s=t.pos.length;if(1==s)t.pos.push(r-i);else{t.pos[s-1]=r-i;if(t.pos[s-1]==t.pos[s-2])t.pos.pop()}}});if(1==t.pos.length)n.find(".next").hide();if(r<400)r=5e4;else r+=20;t.panel.css({width:r});t.step=t.pos.length},reload:function(){var e=this;e.current=0;e.panel.css({left:0});e.resetBtn()}});function r(t){var n=t.find("img.lazyLoad");var i;n.each(function(t,n){i=e(n);i.attr("src",i.attr("alt"));i.removeAttr("alt").removeClass("lazyLoad")})}function a(e,t){e.animate({left:-t},300)}var o={};return function(t){var t=t||e(document);var n=e(".modPSlide",t);var r;if(n[0])n.each(function(t,n){r=e(n).attr("id");if(o[r])o[r].reload();else o[r]=new i(e("#"+r))})}});define("module/ui/switchtab",["tui/lazyImageLoader","tui/event"],function(t,n){jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{easeInOutQuad:function(e,t,n,i,r){if((t/=r/2)<1)return i/2*t*t*t+n;return i/2*((t-=2)*t*t+2)+n}});function i(t){if(t&&t.tagName){var n="a"==t.tagName.toLowerCase()?e(t):e(t).find("a");n=n.length?n:e(t);return(n.attr("rel")||n.attr("href").replace(/.*#(\d+)$/,"$1")||1)-1}else return 0}function r(e){var t=arguments;for(var n=0,i=t.length;n<i;n++){var e=t[n];if(e)clearTimeout(e)}return null}var a=n.extend({initialize:function(n){var o=this;a.superClass.initialize.apply(o,arguments);o.op=n||{};o.op.slide=n.slide||false;o.op.linktab=n.linktab||false;o.op.clicktab=n.clicktab||false;o.op.lazyContent=n.lazyContent||window.gLazyContent||false;var s=o.box=e(n.box);var l=o.tab=e(n.tab||".tab li",s);var u=o.panel=e(n.panel||".c",s);o.size=l.length||u.length;o.loop=n.loop||0;o.current=i(l.filter(".current")[0]);if(o.op.slide){o.scroll=u.parent().parent();o.scroll.scrollLeft(0);t({imgs:u.eq(o.current).find(".lazyImg")});u.parent().append(u.eq(0).clone());o.panel=e(n.panel||".c",s);o.width=u.width();o.delay=n.delay||700;o.loop=(o.loop||5e3)+o.delay;o.anilock=false}if(o.size<2)return;if(o.op.clicktab)l.click(function(e){e.preventDefault();o.go(i(this))});else{if(!o.op.linktab)l.click(function(e){e.preventDefault()});l.mouseenter(function(){r(o.timer,o.looptimer);var e=this;o.timer=setTimeout(function(){o.go(i(e))},30)}).mouseleave(function(){r(o.timer,o.looptimer);o.start()})}if(o.loop){o.check(o.op.clicktab?l:null);o.start()}l.parent().on("click","a",function(t){var n=e(this).attr("href");if(!n||"#"==n||n.length<5)t.preventDefault()})},on:function(e,t){this.box.eventProxy(e,t);return this},go:function(e,t){var n=this;e=t?e:Math.min(Math.max(e,0),n.size-1);n.trigger("before",[n.current,e,n]);if(n.op.slide){if(n.anilock){n.nextstep=function(){n.animate(e,t)};return}n.animate(e,t)}else{var i=n.current;n.current=e%n.size;n.trigger("change",[n.current,n]);n.tab.removeClass("current").eq(n.current).addClass("current");var r=n.op.fade;var a=n.panel;r?a.eq(i).stop().fadeOut(100):a.hide();a.eq(n.current)[r?"fadeIn":"show"](n.op.duration?n.op.duration:0);n.trigger("after",[n.current,n])}},prev:function(e){this.go(this.current-1,e)},next:function(e){this.go(this.current+1,e)},start:function(e){var t=this;if(t.loop){r(t.looptimer);if(e)t.start();t.looptimer=setTimeout(function(){t.start();t.next(true)},t.loop)}},stop:function(){r(this.looptimer)},check:function(e){var t=this;(e||t.panel).mouseenter(function(){r(t.looptimer)}).mouseleave(function(){r(t.looptimer);t.start()})},animate:function(e,n){var i=this;var a=i.current;if(i.anilock||a==e)return;r(i.looptimer);var o=i.size,s=i.width,l=i.panel,u=i.scroll;var c=a>e?0:s;var d=a>e?s:0;e%=n?o+1:o;t({imgs:l.eq(e).show().find(".lazyImg")});u.scrollLeft(d);i.tab.removeClass("current").eq(e%o).addClass("current");u.animate({scrollLeft:c},i.delay,"easeInOutQuad",function(){l.eq(a).hide();if(n&&e==o){e%=o;t({imgs:l.eq(0).show().find(".lazyImg")});l.eq(o).hide()}u.scrollLeft(0);i.current=e;i.anilock=false;i.trigger("after",[i.current,i]);if(i.nextstep){i.nextstep();i.nextstep=null}if(n)i.start()});i.anilock=true}});return a});define("page/find/main/switchtab",["module/ui/switchtab","tui/lazyImageLoader","tui/slide2"],function(t,n,i){return function(){var r=e(".modSwitch");r.delegate("a","click",function(t){var n=e(this).attr("href");if(!n||"#"==n)t.preventDefault()});if(r[0])r.each(function(r,a){var o=new t({box:a,tab:".t_tab li",panel:".tab-c",linktab:true});o.bind("change",function(t){var r=o.panel.eq(t);var a=r.children().eq(0);if(a.hasClass("lazyContent")){r.html(a.val());n({imgs:r.find(".lazyImg")});setTimeout(function(){i(r);e(document).trigger("domChanged")},200)}})})}});define("module/subscribe/curve-motion",[],function(){var t=.0017;var n=function(n,i,r){if(!e.isArray(n))return;if(e.isFunction(i)){r=i;i={}}this.options=i||(i={});if(i.easing)this._easing=i.easing;if(i.gravity)t=i.gravity;this.originX=n[0];this.originY=n[1];this.targetX=n[2];this.targetY=n[3];this.absX=Math.abs(this.targetX-this.originX);this.absY=Math.abs(this.targetY-this.originY);this.upward=this.targetY-this.originY<0;this.angle=180*Math.atan(this.absY/this.absX)/Math.PI;this.angle+=Math.cos(this.angle*Math.PI/180)*(i.elevationAngle||0);this.rad=this.angle*Math.PI/180;this.speed=Math.sqrt(t*this.absX*this.absX/(2*(this.absX*Math.tan(this.rad)-this.absY)),2)/Math.cos(this.rad);this.duration=this.absX/(this.speed*Math.cos(this.rad));this.draw=this.draw.bind(this);this._completeCallback=e.isFunction(r)&&r||function(){}};n.prototype={draw:function(){var e=+new Date-this.startTime;e=Math.min(e/this.duration,1);e=this._easing(e);if(e<1&&!this._paused)r(this.draw);var t=this._calcX(this.originX,this.targetX,e);var n=this._calcY(Math.abs(this.upward?t-this.originX:this.targetX-t));if(this._frameTimer)clearTimeout(this._frameTimer);var i=this;i._frameTimer=setTimeout(function(){if(i._useTransform)i._updateCallback(t-i.originX,i.upward?-n:i.absY-n);else i._updateCallback(t,i.upward?i.originY-n:i.targetY-n);if(1==e)i._completeCallback(t,n)},0)},start:function(){this._paused=false;this.startTime=+new Date;this.draw()},pause:function(){this._paused=true},updateFrame:function(e,t){this._updateCallback=e;this._useTransform=!!t},_calcX:function(e,t,n){return e+(t-e)*n},_calcY:function(e){return e*Math.tan(this.rad)-t*e*e/(2*Math.pow(this.speed*Math.cos(this.rad),2))},_easing:function(e){return e*e*(3-2*e)}};var i=!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame);var r=window.requestAnimationFrame||function(){var e=0;return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){var n=(new Date).getTime(),i;i=Math.max(0,16-(n-e));e=n+i;return setTimeout(function(){t(n+i)},i)}}();n.supportCSSTransform=i;return n});define("module/subscribe/curvefly",["tui/view","module/subscribe/curve-motion"],function(t,n){var i;var r=t.extend({initialize:function(){this._coords=this.options.coords;this._picurl=this.options.picurl||null;this._motion=new n(this._coords,{elevationAngle:this.options.elevationAngle||33},this._complete.bind(this));this._motion.updateFrame(this._update.bind(this),n.supportCSSTransform);this.render()},remove:function(){r.superClass.remove.call(this)},render:function(){var t=this._picurl;if(!(t&&t.indexOf("&#x")!==-1)){t=this._picurl?'<img src="'+this._picurl+'" />':'<i class="iconfont">&#xe637;</i>';var n=e('<div class="g-subs-ani">'+t+"</div>")}else var n=e('<div class="g-subs-ani g-curvefly-wrap">'+t+"</div>");n.css({left:this._coords[0],top:this._coords[1]});e(document.body).append(n);this.setElement(n)},start:function(){this.$el.show();this._motion.start()},pause:function(){this._motion.pause()},_update:function(e,t){if(n.supportCSSTransform)this.$el.get(0).style[a+"Transform"]="translate3d("+e+"px, "+t+"px, 0)";else this.$el.css({left:e,top:t})},_complete:function(){var e=this.$el;if(n.supportCSSTransform)e.get(0).style[a+"Transform"]="none";e.css({left:this._coords[2],top:this._coords[3]}).fadeOut(300)}});r.create=function(e,t,n,a,o,s){r.destory();i=new r({coords:[e,t,n,a],picurl:o,elevationAngle:s});return i};r.destory=function(){if(i){i.remove();i=null}};var a="";var o=document.createElement("div");e.each({Webkit:"webkit",Moz:"moz",O:"o",ms:"ms"},function(e,t){if(void 0!==o.style[e+"TransitionProperty"]){a=e;return false}});return r});define("module/subscribe/subscribe",["tui/event","module/login/login","tui/net","module/subscribe/curvefly"],function(t,n,i,r){var a=t.extend({initialize:function(t){var i=this;a.superClass.initialize.call(i);i.loading=false;if(!t.box)return;i.CACHE={};setTimeout(function(){i.checkSub(t.box)},0);e(document).bind("login",function(){i.checkSub(t.box)});if(t.update)i.bind("update:sucess",t.update.bind(i));e(".sub-action",t.box).bind("click",function(t){t.preventDefault();if(i.loading)return;i.loading=true;var r=e(this),a=r.attr("data-id"),o=r.attr("data-log"),s=r.attr("data-img"),l={addtion:o},u=i.CACHE[a];n.login(function(){if(r.hasClass("sub-done")){r.addClass("sub-done-loading").text("åæ¶ä¸­");l.unfollow=a}else{if(s)i.animate(s,r);l.follow=a}i.sub.apply(i,[r,l])});if(!n.isLogin())i.loading=false});e(".sub-action",t.box).hover(function(){var t=e(this);if(t.hasClass("sub-done")&&!t.hasClass("sub-done-loading"))t.addClass("sub-done-hover").text("åæ¶è®¢é")},function(){var t=e(this);if(t.hasClass("sub-done")&&!t.hasClass("sub-done-loading"))t.removeClass("sub-done-hover").text("å·²è®¢é");else if(!t.hasClass("sub-done-loading"))t.removeClass("sub-done-hover").removeClass("sub-add-hover").text("è®¢é")})},animate:function(t,n){var i=e("#qheader_sub_num").parent().offset();var a=i.left+8;var o=i.top;var s=n.offset();var l=s.left+8;var u=s.top-4;r.create(l,u,a,o,t,18).start()},checkSub:function(t){var n=this;var r=target_array_uid=[];var a={};if(!uid)return;e(t).find(".sub-action").each(function(t,i){var r=e(i).attr("data-id"),a=CHUDA.Common.encodeUid(r);target_array_uid.push('"'+a+'"');if(n.CACHE[a])n.CACHE[a].el.push(i);else n.CACHE[a]={follow:r,encodeUid:a,el:[i]}});if(!target_array_uid.length)return;url="http://yws.youku.com/friendships/js_show.json?source_uid="+CHUDA.Common.encodeUid(uid)+"&target_array_uid=["+target_array_uid.join(",")+"]&t="+1*new Date;i.getJSON(url,{},function(t){if(1==t.error)e(t.target).each(function(e,t){var i=n.CACHE[t.id];if(!i.el)return;if(t.followed)n.subed(i.el);else n.unsubed(i.el)})},{callbackName:"callback",traditional:true})},update:function(t){var n=this;e(t).each(function(t,i){if(e(i).hasClass("sub-done"))n.unsubed(i);else n.subed(i);n.trigger("update:sucess",[e(i)])})},subed:function(t){e(t).removeClass("sub-add-hover").addClass("sub-done").html("å·²è®¢é")},unsubed:function(t){e(t).removeClass("sub-done sub-done-loading").addClass("sub-add-hover").html("è®¢é")},sub:function(t,n){var r=this;i.getJSON("http://i.youku.com/u/subToUpdates",n,function(n){if(1==n){r.update(t);if(e(t).hasClass("sub-done"))e(t).removeClass("sub-done-hover")}r.loading=false},{callbackName:"callback",charset:"utf-8"})}});return a});require(["page/find/g","module/subscribe/subscribe","tui/slide2","page/find/main/switchtab","page/find/main/fixmod","page/find/main/recommend"],function(t,n,i,r,a,o){t.init();var s=new a;var l=new o;l.bind("refresh:success",function(){s.initStatus()});var u=new n({box:e(".yk-content")});i();r()})}(window.jQuery);;