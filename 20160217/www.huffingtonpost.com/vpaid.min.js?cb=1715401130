!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.DMVAST=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],2:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}return a}(),b.exports=d},{}],3:[function(a,b,c){var d,e,f;e=a("./parser"),f=a("./util"),d=function(){function a(){}return a.cappingFreeLunch=0,a.cappingMinimumTimeInterval=0,a.options={withCredentials:!1,timeout:0},a.get=function(a,b,d){var f,g,h;return g=+new Date,f=c.extend=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},d||("function"==typeof b&&(d=b),h={}),h=f(this.options,b),this.totalCallsTimeout<g?(this.totalCalls=1,this.totalCallsTimeout=g+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void d(null):g-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void d(null):e.parse(a,h,function(a){return function(a){return d(a)}}(this))},function(){var b,c;c=f.storage,b=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(d){b(a,d,{get:function(){return c.getItem(d)},set:function(a){return c.setItem(d,a)},configurable:!1,enumerable:!0})}),null==a.totalCalls&&(a.totalCalls=0),null==a.totalCallsTimeout&&(a.totalCallsTimeout=0)}(),a}(),b.exports=d},{"./parser":10,"./util":16}],4:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.companionClickThroughURLTemplate=null,this.trackingEvents={}}return a}(),b.exports=d},{}],5:[function(a,b,c){var d,e,f,g,h={}.hasOwnProperty,i=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=function(){function a(){this.trackingEvents={}}return a}(),f=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null}return i(b,a),b}(d),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return i(b,a),b}(d),e=function(a){function b(){this.type="companion",this.variations=[],this.videoClickTrackingURLTemplates=[]}return i(b,a),b}(d),b.exports={VASTCreativeLinear:f,VASTCreativeNonLinear:g,VASTCreativeCompanion:e}},{}],6:[function(a,b,c){var d;d=function(){function a(){this.attributes={},this.children=[]}return a}(),b.exports=d},{}],7:[function(a,b,c){var d;d=function(){function a(){this.name=null,this.value=null,this.attributes={}}return a}(),b.exports=d},{}],8:[function(a,b,c){b.exports={client:a("./client"),tracker:a("./tracker"),parser:a("./parser"),util:a("./util"),urlhandler:a("./urlhandler")}},{"./client":3,"./parser":10,"./tracker":12,"./urlhandler":13,"./util":16}],9:[function(a,b,c){var d;d=function(){function a(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}return a}(),b.exports=d},{}],10:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};e=a("./urlhandler"),n=a("./response"),f=a("./ad"),g=a("./extension"),h=a("./extensionchild"),o=a("./util"),k=a("./creative").VASTCreativeLinear,j=a("./creative").VASTCreativeCompanion,l=a("./mediafile"),i=a("./companionad"),d=a("events").EventEmitter,m=function(){function a(){}var b;return b=[],a.addURLTemplateFilter=function(a){"function"==typeof a&&b.push(a)},a.removeURLTemplateFilter=function(){return b.pop()},a.countURLTemplateFilters=function(){return b.length},a.clearUrlTemplateFilters=function(){return b=[]},a.parse=function(a,b,c){return c||("function"==typeof b&&(c=b),b={}),this._parse(a,null,b,function(a,b){return c(b)})},a.vent=new d,a.track=function(a,b){return this.vent.emit("VAST-error",b),o.track(a,b)},a.on=function(a,b){return this.vent.on(a,b)},a.once=function(a,b){return this.vent.once(a,b)},a._parse=function(a,c,d,f){var g,h,i;for(f||("function"==typeof d&&(f=d),d={}),h=0,i=b.length;i>h;h++)g=b[h],a=g(a);return null==c&&(c=[]),c.push(a),e.get(a,d,function(b){return function(e,g){var h,i,j,k,l,m,o,q,r,s,t;if(null!=e)return f(e);if(l=new n,null==(null!=g?g.documentElement:void 0)||"VAST"!==g.documentElement.nodeName)return f();for(s=g.documentElement.childNodes,m=0,q=s.length;q>m;m++)k=s[m],"Error"===k.nodeName&&l.errorURLTemplates.push(b.parseNodeText(k));for(t=g.documentElement.childNodes,o=0,r=t.length;r>o;o++)k=t[o],"Ad"===k.nodeName&&(h=b.parseAdElement(k),null!=h?l.ads.push(h):b.track(l.errorURLTemplates,{ERRORCODE:101}));for(i=function(a){var c,d,e;if(null==a&&(a=!1),l){for(e=l.ads,c=0,d=e.length;d>c;c++)if(h=e[c],null!=h.nextWrapperURL)return;return 0===l.ads.length&&(a||b.track(l.errorURLTemplates,{ERRORCODE:303}),l=null),f(null,l)}},j=l.ads.length;j--;)h=l.ads[j],null!=h.nextWrapperURL&&!function(e){var f,g;return c.length>=10||(g=e.nextWrapperURL,p.call(c,g)>=0)?(b.track(e.errorURLTemplates,{ERRORCODE:302}),l.ads.splice(l.ads.indexOf(e),1),void i()):(-1===e.nextWrapperURL.indexOf("://")&&(f=a.slice(0,a.lastIndexOf("/")),e.nextWrapperURL=""+f+"/"+e.nextWrapperURL),b._parse(e.nextWrapperURL,c,d,function(a,c){var d,f,g,h,j,k,m,n,o,p,q,r,s,t,u,v,w,x;if(f=!1,null!=a)b.track(e.errorURLTemplates,{ERRORCODE:301}),l.ads.splice(l.ads.indexOf(e),1),f=!0;else if(null==c)b.track(e.errorURLTemplates,{ERRORCODE:303}),l.ads.splice(l.ads.indexOf(e),1),f=!0;else for(l.errorURLTemplates=l.errorURLTemplates.concat(c.errorURLTemplates),h=l.ads.indexOf(e),l.ads.splice(h,1),u=c.ads,m=0,n=u.length;n>m;m++){if(j=u[m],j.errorURLTemplates=e.errorURLTemplates.concat(j.errorURLTemplates),j.impressionURLTemplates=e.impressionURLTemplates.concat(j.impressionURLTemplates),null!=e.trackingEvents)for(v=j.creatives,r=0,o=v.length;o>r;r++)if(d=v[r],"linear"===d.type)for(w=Object.keys(e.trackingEvents),s=0,p=w.length;p>s;s++)g=w[s],(k=d.trackingEvents)[g]||(k[g]=[]),d.trackingEvents[g]=d.trackingEvents[g].concat(e.trackingEvents[g]);if(null!=e.videoClickTrackingURLTemplates)for(x=j.creatives,t=0,q=x.length;q>t;t++)d=x[t],"linear"===d.type&&(d.videoClickTrackingURLTemplates=d.videoClickTrackingURLTemplates.concat(e.videoClickTrackingURLTemplates));l.ads.splice(h,0,j)}return delete e.nextWrapperURL,i(f)}))}(h);return i()}}(this))},a.childByName=function(a,b){var c,d,e,f;for(f=a.childNodes,d=0,e=f.length;e>d;d++)if(c=f[d],c.nodeName===b)return c},a.childsByName=function(a,b){var c,d,e,f,g;for(d=[],g=a.childNodes,e=0,f=g.length;f>e;e++)c=g[e],c.nodeName===b&&d.push(c);return d},a.parseAdElement=function(a){var b,c,d,e;for(e=a.childNodes,c=0,d=e.length;d>c;c++){if(b=e[c],b.id=a.getAttribute("id"),"Wrapper"===b.nodeName)return this.parseWrapperElement(b);if("InLine"===b.nodeName)return this.parseInLineElement(b)}},a.parseWrapperElement=function(a){var b,c,d,e,f,g,h;for(b=this.parseInLineElement(a),e=this.childByName(a,"VASTAdTagURI"),null!=e?b.nextWrapperURL=this.parseNodeText(e):(e=this.childByName(a,"VASTAdTagURL"),null!=e&&(b.nextWrapperURL=this.parseNodeText(this.childByName(e,"URL")))),d=null,h=b.creatives,f=0,g=h.length;g>f;f++)if(c=h[f],"linear"===c.type){d=c;break}return null!=d&&(null!=d.trackingEvents&&(b.trackingEvents=d.trackingEvents),null!=d.videoClickTrackingURLTemplates&&(b.videoClickTrackingURLTemplates=d.videoClickTrackingURLTemplates)),null!=b.nextWrapperURL?b:void 0},a.parseInLineElement=function(a){var b,c,d,e,g,h,i,j,k,l,m,n,o,p;for(b=new f,b.id=a.id,n=a.childNodes,h=0,k=n.length;k>h;h++)switch(g=n[h],g.nodeName){case"Error":this.isUrl(g)&&b.errorURLTemplates.push(this.parseNodeText(g));break;case"Impression":this.isUrl(g)&&b.impressionURLTemplates.push(this.parseNodeText(g));break;case"Creatives":for(o=this.childsByName(g,"Creative"),i=0,l=o.length;l>i;i++)for(d=o[i],p=d.childNodes,j=0,m=p.length;m>j;j++)switch(e=p[j],e.nodeName){case"Linear":c=this.parseCreativeLinearElement(e),c&&b.creatives.push(c);break;case"CompanionAds":c=this.parseCompanionAd(e),c&&b.creatives.push(c)}break;case"Extensions":this.parseExtension(b.extensions,this.childsByName(g,"Extension"))}return b},a.parseExtension=function(a,b){var c,d,e,f,i,j,k,l,m,n,o,p,q,r,s,t,u,v;for(v=[],k=0,o=b.length;o>k;k++){if(i=b[k],d=new g,i.attributes)for(s=i.attributes,l=0,p=s.length;p>l;l++)j=s[l],d.attributes[j.nodeName]=j.nodeValue;for(t=i.childNodes,m=0,q=t.length;q>m;m++)if(c=t[m],"#text"!==c.nodeName){if(e=new h,e.name=c.nodeName,e.value=this.parseNodeText(c),c.attributes)for(u=c.attributes,n=0,r=u.length;r>n;n++)f=u[n],e.attributes[f.nodeName]=f.nodeValue;d.children.push(e)}v.push(a.push(d))}return v},a.parseCreativeLinearElement=function(a){var b,c,d,e,f,g,h,i,j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;if(d=new k,d.duration=this.parseDuration(this.parseNodeText(this.childByName(a,"Duration"))),-1===d.duration&&"Wrapper"!==a.parentNode.parentNode.parentNode.nodeName)return null;if(p=a.getAttribute("skipoffset"),null==p?d.skipDelay=null:"%"===p.charAt(p.length-1)?(n=parseInt(p,10),d.skipDelay=d.duration*(n/100)):d.skipDelay=this.parseDuration(p),t=this.childByName(a,"VideoClicks"),null!=t){for(d.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(t,"ClickThrough")),H=this.childsByName(t,"ClickTracking"),v=0,z=H.length;z>v;v++)c=H[v],d.videoClickTrackingURLTemplates.push(this.parseNodeText(c));for(I=this.childsByName(t,"CustomClick"),w=0,A=I.length;A>w;w++)e=I[w],d.videoCustomClickURLTemplates.push(this.parseNodeText(e))}for(b=this.childByName(a,"AdParameters"),null!=b&&(d.adParameters=this.parseNodeText(b)),J=this.childsByName(a,"TrackingEvents"),x=0,B=J.length;B>x;x++)for(r=J[x],K=this.childsByName(r,"Tracking"),y=0,C=K.length;C>y;y++)if(q=K[y],f=q.getAttribute("event"),s=this.parseNodeText(q),null!=f&&null!=s){if("progress"===f){if(m=q.getAttribute("offset"),!m)continue;f="%"===m.charAt(m.length-1)?"progress-"+m:"progress-"+Math.round(this.parseDuration(m))}null==(u=d.trackingEvents)[f]&&(u[f]=[]),d.trackingEvents[f].push(s)}for(L=this.childsByName(a,"MediaFiles"),F=0,D=L.length;D>F;F++)for(j=L[F],M=this.childsByName(j,"MediaFile"),G=0,E=M.length;E>G;G++)i=M[G],h=new l,h.id=i.getAttribute("id"),h.fileURL=this.parseNodeText(i),h.deliveryType=i.getAttribute("delivery"),h.codec=i.getAttribute("codec"),h.mimeType=i.getAttribute("type"),h.apiFramework=i.getAttribute("apiFramework"),h.bitrate=parseInt(i.getAttribute("bitrate")||0),h.minBitrate=parseInt(i.getAttribute("minBitrate")||0),h.maxBitrate=parseInt(i.getAttribute("maxBitrate")||0),h.width=parseInt(i.getAttribute("width")||0),h.height=parseInt(i.getAttribute("height")||0),o=i.getAttribute("scalable"),o&&"string"==typeof o&&(o=o.toLowerCase(),"true"===o?h.scalable=!0:"false"===o&&(h.scalable=!1)),g=i.getAttribute("maintainAspectRatio"),g&&"string"==typeof g&&(g=g.toLowerCase(),"true"===g?h.maintainAspectRatio=!0:"false"===g&&(h.maintainAspectRatio=!1)),d.mediaFiles.push(h);return d},a.parseCompanionAd=function(a){var b,c,d,e,f,g,h,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;for(d=new j,A=this.childsByName(a,"Companion"),o=0,s=A.length;s>o;o++){for(c=A[o],b=new i,b.id=c.getAttribute("id")||null,b.width=c.getAttribute("width"),b.height=c.getAttribute("height"),B=this.childsByName(c,"HTMLResource"),p=0,t=B.length;t>p;p++)f=B[p],b.type=f.getAttribute("creativeType")||"text/html",b.htmlResource=this.parseNodeText(f);for(C=this.childsByName(c,"IFrameResource"),q=0,u=C.length;u>q;q++)g=C[q],b.type=g.getAttribute("creativeType")||0,b.iframeResource=this.parseNodeText(g);for(D=this.childsByName(c,"StaticResource"),r=0,v=D.length;v>r;r++)h=D[r],b.type=h.getAttribute("creativeType")||0,b.staticResource=this.parseNodeText(h);for(E=this.childsByName(c,"TrackingEvents"),y=0,w=E.length;w>y;y++)for(l=E[y],F=this.childsByName(l,"Tracking"),z=0,x=F.length;x>z;z++)k=F[z],e=k.getAttribute("event"),m=this.parseNodeText(k),null!=e&&null!=m&&(null==(n=b.trackingEvents)[e]&&(n[e]=[]),b.trackingEvents[e].push(m));b.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(c,"CompanionClickThrough")),d.variations.push(b)}return d},a.parseDuration=function(a){var b,c,d,e,f;return null==a?-1:(b=a.split(":"),3!==b.length?-1:(f=b[2].split("."),e=parseInt(f[0]),2===f.length&&(e+=parseFloat("0."+f[1])),d=parseInt(60*b[1]),c=parseInt(60*b[0]*60),isNaN(c||isNaN(d||isNaN(e||d>3600||e>60)))?-1:c+d+e))},a.parseNodeText=function(a){return a&&(a.textContent||a.text||"").trim()},a.isUrl=function(a){return/^https?:\/\/[^\s\/$\.\?#].*$/i.test(this.parseNodeText(a))},a}(),b.exports=m},{"./ad":2,"./companionad":4,"./creative":5,"./extension":6,"./extensionchild":7,"./mediafile":9,"./response":11,"./urlhandler":13,"./util":16,events:1}],11:[function(a,b,c){var d;d=function(){function a(){this.ads=[],this.errorURLTemplates=[]}return a}(),b.exports=d},{}],12:[function(a,b,c){var d,e,f,g,h,i={}.hasOwnProperty,j=function(a,b){function c(){this.constructor=a}for(var d in b)i.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("./client"),h=a("./util"),f=a("./creative").VASTCreativeLinear,d=a("events").EventEmitter,g=function(a){function b(a,b){var c,d,g;this.ad=a,this.creative=b,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],g=this.creative.trackingEvents;for(c in g)d=g[c],this.trackingEvents[c]=d.slice(0);this.creative instanceof f?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){e.lastSuccessfullAd=+new Date})}return j(b,a),b.prototype.setDuration=function(a){return this.assetDuration=a,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}},b.prototype.setProgress=function(a){var b,c,d,e,f,g,h,i,j;if(f=null===this.skipDelay?this.skipDelayDefault:this.skipDelay,-1===f||this.skipable||(f>a?this.emit("skip-countdown",f-a):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(c=[],a>0){c.push("start"),d=Math.round(a/this.assetDuration*100),c.push("progress-"+d+"%"),c.push("progress-"+Math.round(a)),j=this.quartiles;for(e in j)g=j[e],a>=g&&g+1>=a&&c.push(e)}for(h=0,i=c.length;i>h;h++)b=c[h],this.track(b,!0);a<this.progress&&this.track("rewind")}return this.progress=a},b.prototype.setMuted=function(a){return this.muted!==a&&this.track(a?"mute":"unmute"),this.muted=a},b.prototype.setPaused=function(a){return this.paused!==a&&this.track(a?"pause":"resume"),this.paused=a},b.prototype.setFullscreen=function(a){return this.fullscreen!==a&&this.track(a?"fullscreen":"exitFullscreen"),this.fullscreen=a},b.prototype.setSkipDelay=function(a){return"number"==typeof a?this.skipDelay=a:void 0},b.prototype.load=function(){return this.impressed?void 0:(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView"))},b.prototype.errorWithCode=function(a){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:a})},b.prototype.complete=function(){return this.track("complete")},b.prototype.stop=function(){return this.track(this.linear?"closeLinear":"close")},b.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},b.prototype.click=function(){var a,b,c;return(null!=(c=this.clickTrackingURLTemplates)?c.length:void 0)&&this.trackURLs(this.clickTrackingURLTemplates),null!=this.clickThroughURLTemplate?(this.linear&&(b={CONTENTPLAYHEAD:this.progressFormated()}),a=h.resolveURLTemplates([this.clickThroughURLTemplate],b)[0],this.emit("clickthrough",a)):void 0},b.prototype.track=function(a,b){var c,d;null==b&&(b=!1),"closeLinear"===a&&null==this.trackingEvents[a]&&null!=this.trackingEvents.close&&(a="close"),d=this.trackingEvents[a],c=this.emitAlwaysEvents.indexOf(a),null!=d?(this.emit(a,""),this.trackURLs(d)):-1!==c&&this.emit(a,""),b===!0&&(delete this.trackingEvents[a],c>-1&&this.emitAlwaysEvents.splice(c,1))},b.prototype.trackURLs=function(a,b){return null==b&&(b={}),this.linear&&(b.CONTENTPLAYHEAD=this.progressFormated()),h.track(a,b)},b.prototype.progressFormated=function(){var a,b,c,d,e;return e=parseInt(this.progress),a=e/3600,a.length<2&&(a="0"+a),b=e/60%60,b.length<2&&(b="0"+b),d=e%60,d.length<2&&(d="0"+b),c=parseInt(100*(this.progress-e)),""+a+":"+b+":"+d+"."+c},b}(d),b.exports=g},{"./client":3,"./creative":5,"./util":16,events:1}],13:[function(a,b,c){var d,e,f;f=a("./urlhandlers/xmlhttprequest"),e=a("./urlhandlers/flash"),d=function(){function b(){}return b.get=function(b,c,d){return d||("function"==typeof c&&(d=c),c={}),c.urlhandler&&c.urlhandler.supported()?c.urlhandler.get(b,c,d):"undefined"==typeof window||null===window?a("./urlhandlers/node").get(b,c,d):f.supported()?f.get(b,c,d):e.supported()?e.get(b,c,d):d()},b}(),b.exports=d},{"./urlhandlers/flash":14,"./urlhandlers/xmlhttprequest":15}],14:[function(a,b,c){var d;d=function(){function a(){}return a.xdr=function(){var a;return window.XDomainRequest&&(a=new XDomainRequest),a},a.supported=function(){return!!this.xdr()},a.get=function(a,b,c){var d,e;return(e="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(e.async=!1,d=this.xdr(),d.open("GET",a),d.timeout=b.timeout||0,d.withCredentials=b.withCredentials||!1,d.send(),d.onprogress=function(){},d.onload=function(){return e.loadXML(d.responseText),c(null,e)}):c()},a}(),b.exports=d},{}],15:[function(a,b,c){var d;d=function(){function a(){}return a.xhr=function(){var a;return a=new window.XMLHttpRequest,"withCredentials"in a?a:void 0},a.supported=function(){return!!this.xhr()},a.get=function(a,b,c){var d;try{return d=this.xhr(),d.open("GET",a),d.timeout=b.timeout||0,d.withCredentials=b.withCredentials||!1,d.send(),d.onreadystatechange=function(){return 4===d.readyState?c(null,d.responseXML):void 0}}catch(e){return c()}},a}(),b.exports=d},{}],16:[function(a,b,c){var d;d=function(){function a(){}return a.track=function(a,b){var c,d,e,f,g,h;for(d=this.resolveURLTemplates(a,b),h=[],f=0,g=d.length;g>f;f++)c=d[f],"undefined"!=typeof window&&null!==window&&(e=new Image,h.push(e.src=c));return h},a.resolveURLTemplates=function(a,b){var c,d,e,f,g,h,i,j,k;d=[],null==b&&(b={}),"CACHEBUSTING"in b||(b.CACHEBUSTING=Math.round(1e10*Math.random())),b.random=b.CACHEBUSTING;for(j=0,k=a.length;k>j;j++)if(c=a[j],h=c){for(e in b)i=b[e],f="["+e+"]",g="%%"+e+"%%",h=h.replace(f,i),h=h.replace(g,i);d.push(h)}return d},a.storage=function(){var a,b,c,d;try{c="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){d=e,c=null}return b=function(a){var b,c;try{if(c="__VASTUtil__",a.setItem(c,c),a.getItem(c)!==c)return!0}catch(d){return b=d,!0}return!1},(null==c||b(c))&&(a={},c={length:0,getItem:function(b){return a[b]},setItem:function(b,c){a[b]=c,this.length=Object.keys(a).length},removeItem:function(b){delete a[b],this.length=Object.keys(a).length},clear:function(){a={},this.length=0}}),c}(),a}(),b.exports=d},{}]},{},[8])(8)});var AltitudeDigital=AltitudeDigital||{};AltitudeDigital.Utils=AltitudeDigital.Utils||function(){var a=void 0!==window.ActiveXObject,b="alt-iframe-",c=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?"HTML"!==b.nodeName:!1},d=function(a){for(var b=[],c=a.length;c--;b.unshift(a[c]));return b},e=!1,f=function(a,b){try{var c=(new Error).stack.split("\n")}catch(d){return a}for(var e=/(?:^|\s|\.)AltitudeDigital\.(.*?)\.(.*)(\(.*)/,f=!1,h=3;h<c.length;h++)if(e.test(c[h])){var i=e.exec(c[h]),j=i[1];if("Utils"==j){f=!~c[h].indexOf(".log.");continue}return j=f?j+"::Utils":j,b?j:g(j,a)}return a},g=function(a,b){if(""==a)return b;var c=Array.prototype.slice.call(b);return c[0]="["+a+"] "+c[0],c},h=function(){return arguments&&e?console.log.apply(console,f(arguments)):void 0};h.constructor.prototype.raw=function(){if(e){if(1!=arguments.length){for(var a in arguments){if(c(arguments[a])&&console.dirxml)return console.dirxml.apply(console,arguments);if(arguments[a]instanceof Object)return console.log.apply(console,arguments)}return console.log.apply(console,arguments)}if("string"==typeof arguments[0])return console.log.apply(console,arguments);if(c(arguments[0])&&console.dirxml)return console.dirxml.apply(console,arguments);console.log("%O",arguments)}},h.constructor.prototype.warn=function(){e&&console.warn.apply(console,f(arguments))},h.constructor.prototype.info=function(){e&&console.info.apply(console,f(arguments))},h.constructor.prototype.error=function(){e&&console.error.apply(console,f(arguments))},h.constructor.prototype.table=function(){e&&console.table&&console.table.apply(console,arguments)},h.constructor.prototype.time=function(){e&&console.time&&console.time.apply(console,f(arguments))},h.constructor.prototype.endTime=function(){e&&console.timeEnd&&console.timeEnd.apply(console,f(arguments))},h.constructor.prototype.custom=function(a,b,c){e&&(c=c?c:"fff",h("%c "+a+" ","background:"+c+";color:"+b+";"))},h.constructor.prototype.tiny=function(){if(e){var a=Array.prototype.slice.call(arguments);a[0]="%c "+a[0],a.splice(1,0,"font-size:5pt;"),console.log.apply(console,a)}},h.constructor.prototype.notify=function(){if(e){var a=Array.prototype.slice.call(arguments);a[0]="%c "+a[0],a.splice(1,0,"background:silver;color:blue;"),console.log.apply(console,f(a))}},h.constructor.prototype.black=function(){if(e){var a=Array.prototype.slice.call(arguments);a[0]="%c "+a[0],a.splice(1,0,"background:#222;color:#bada55; padding:2px;"),console.log.apply(console,f(a))}},h.constructor.prototype.startGroup=function(a,b){e&&console.group&&(b=b?!0:!1,b?console.group("["+f(null,!0)+"] "+a):console.groupCollapsed("["+f(null,!0)+"] "+a))},h.constructor.prototype.endGroup=function(){e&&console.groupEnd&&console.groupEnd()};var i=function(a){return"bool"==typeof a?void(e=a):(e="silent"!=a?!0:!1,"undefined"==typeof console&&(e=!1),void(console.table||h.warn("Full console capabilities not present. Logging may not show all messages")))},j=function(a){return"undefined"==typeof a||null===a},k=function(a){return!j(a)&&Array.isArray(a)},l=function(a,b,c){var d=setTimeout(function(){b=function(){},c()},a),e=function(){clearTimeout(d),b.apply(this,arguments)};return e},m=function(){var a=function(a){return j(a)||""==a?!0:!1},b=function(a){return j(a)?"":a},c=function(a,b){return j(a)?b:a},d=function(a,b){return~a.indexOf(b)},e=function(b){return a(b)?!1:"1"==b||"true"==b||"t"==b?!0:!1},f=function(b){var c=b,d=!1,e=!1,f={trimResults:function(){return d=!0,f},omitEmptyStrings:function(){return e=!0,f},split:function(b){var f=new Array;if(!a(b)){var g=b.split(c);n.each(g,function(b){if(!a(b)&&d)try{b=b.trim()}catch(c){}e&&a(b)||f.push(b)})}return f}};return f},g=function(b){var c=b,d=!1,e=!1,f={skipNulls:function(){return d=!0,f},nullsToEmpty:function(){return e=!0,f},join:function(b){var f=new Array;return n.each(b,function(b){var c=b;d&&j(b)||(e&&a(b)&&(c=""),f.push(c))}),f.join(c)}};return f},h=function(a,c){var d=a,e=c,f=!1,g=!1,h=function(a){return g?b(a):a},i={skipNulls:function(){return f=!0,i},nullsToEmpty:function(){return g=!0,i},join:function(a){var b=new Array;return n.eachMap(a,function(a,c){if(!j(a)){if(f&&j(c))return;k(c)?n.each(c,function(c){f&&j(c)||b.push([a,h(c)].join(e))}):b.push([a,h(c)].join(e))}}),b.join(d)}};return i};return{isNullOrEmpty:a,nullToEmpty:b,nullTo:c,contains:d,toBoolean:e,Joiner:g,MapJoiner:h,Splitter:f}}(),n=function(){var a=function(){},b=function(b,c){if(!d(b))if(k(b)){if(b.length>0)for(var e=0;e<b.length;e++)try{c(b[e],e)}catch(f){if(f instanceof a)break}}else c(b,0)},c=function(b,c){if(!d(b))for(var e in b)if(b.hasOwnProperty(e))try{c(e,b[e])}catch(f){if(f instanceof a)break}},d=function(a){if(j(a))return!0;if(k(a))return!(a.length>0);try{return!Object.keys(a).length}catch(b){}return!0},e=function(a,b){return d(a)?!1:k(a)?a.indexOf(b)>-1:a.hasOwnProperty(b)&&!j(a[b])},f=function(a){for(var b,c,d=a.length;0!==d;)c=Math.floor(Math.random()*d),d-=1,b=a[d],a[d]=a[c],a[c]=b;return a};return{each:b,eachMap:c,Break:a,isNullOrEmpty:d,contains:e,shuffle:f}}(),o=function(){return Math.floor(9999999999*Math.random())+""},p=function(){return window.self!==window.top},q=p()&&window.name==b+"name",r=function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b.toUpperCase()},s=function(a,b){try{if("object"!=typeof a)throw"::mergeObjects() -- Invalid type Error ["+typeof a+"] given as 1st parameter.  Arguments must be of type 'object'";if("object"!=typeof b)throw"::mergeObjects() -- Invalid type Error ["+typeof b+"] given as 2nd parameter.  Arguments must be of type 'object'";var c={};for(var d in a)c[d]=a[d];for(var e in b)c[e]=b[e];return c}catch(f){return h.error(f),null}},t=function(a,b){var c=a();c||setTimeout(function(){t(a,b)},b)},u=function(){var a=5e3,b={},c={},d=function(b,c){var d=(new Date).getTime(),e=!1;return{success:function(){e||(e=!0,setTimeout(b,0))},fail:function(){e||(e=!0,setTimeout(c,0))},isValid:function(){var b=(new Date).getTime();return!e&&a>b-d}}},e=function(a){return!j(window[a])},f=function(a,b){var c=b[a];return j(c)&&(b[a]=c=new Array),c},g=function(a,b){n.isNullOrEmpty(a)&&n.isNullOrEmpty(b)||setTimeout(function(){n.each(a,function(a){a.success()}),n.each(b,function(a){a.fail()})},0)},h=function(a,c,h){var i=d(c,h);if(e(a))i.success();else{var j=f(a,b),k=!1;n.isNullOrEmpty(j)&&(k=!0),j.push(i),b[a]=j,k&&t(function(){var c=e(a),d=new Array,h=new Array,i=new Array,j=f(a,b);return n.each(j,function(a){a.isValid()?c?h.push(a):d.push(a):i.push(a)}),b[a]=d,g(h,i),n.isNullOrEmpty(d)},100)}},i=function(a,b,h){var i=d(b,h);if(e(a)){var j=f(a,c),k=!1;n.isNullOrEmpty(j)&&(k=!0),j.push(i),c[a]=j,k&&t(function(){var b=e(a),d=new Array,h=new Array,i=new Array,j=f(a,c);return n.each(j,function(a){a.isValid()?b?d.push(a):h.push(a):i.push(a)}),c[a]=d,g(h,i),n.isNullOrEmpty(d)},100)}else i.success()};return{whenExists:h,whenDoesntExist:i}}(),v=function(){var a=!1;try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");b&&(a=!0)}catch(c){void 0!=navigator.mimeTypes["application/x-shockwave-flash"]&&(a=!0)}return a},w=function(){var a;try{a=window.top.location.href}catch(b){h.error(b)}if(!a)try{a=window.location.href}catch(b){h.error(b)}return a||""},x=function(){var a=document.referrer;try{a=window.top.document.referrer}catch(b){if(window.parent)try{a=window.parent.document.referrer}catch(b){}}if(!a&&window.opener)try{a=window.opener.location.href}catch(b){}return a||""},y=function(){var a="",b=w();if(null!=b&&""!=b){var c=/:\/\/(.[^/]+)/;a=b.match(c)[1];for(var d,e=a.split(".").reverse(),f=new Array,g=0;g<e.length&&(d=e[g],f.push(d),2==d.length&&2==String(domParts[0]).length||!(f.length>1));g++);a=f.reverse().join(".")}return h("getRootDomain() -> final domain: "+a),a},z=function(){return m.nullToEmpty(document.title)},A=function(a,b,c){return a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):(b="on"+b,"function"==typeof a[b]&&(c=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}(a[b],c)),a[b]=c,!0)},B=function(a,b,c){return a.removeEventListener?(a.removeEventListener(b,c,!1),
!0):a.detachEvent?(a.detachEvent(b,c),!0):void 0},C=function(a,b,c){var d=function(e){B(a,b,d),c(e)};return A(a,b,d)},D=function(a){var b={};return n.each(a.split(";"),function(a){a=a.split(":"),b[a[0]]=a[1]}),b},E=function(a,c,d,e){e=e||"";var f=document.createElement("iframe");return f.src=e||"about:blank",f.id=b+d,f.name=b+"name",f.marginWidth="0",f.marginHeight="0",f.frameBorder="0",f.scrolling="no",f.style&&(f.style.margin="0px",f.style.padding="0px",f.style.border="0px none",f.style.width=a,f.style.height=c,f.style.overflow="hidden"),f},F=function(a,b,c,d){var e="";if(c){var f=a.id;a.style&&(a.style.border="0px none");var g=!1;d=d||1e3,e='<script type="text/javascript">parent.postMessage(\'event:ready;id:'+f+'\', "*");</script>';var i=l(d,function(a){if(!g){var b=D(a.data);if(h("Got iFrame MSG",b),b.id!=f)return;h.custom("iFrame loaded","white","silver"),g=!0,B(window,"message",i),c(!0)}},function(){g||(h("Timeout of iFrame"),g=!0,B(window,"message",i),c(!1))});A(window,"message",i)}var j="<!DOCTYPE html><html><head><title>Altitude Arena</title></head><body style='margin:0;padding:0'>"+b+e+"</body></html>";a=a.contentWindow?a.contentWindow:a.contentDocument.document?a.contentDocument.document:a.contentDocument,a.document.open(),a.document.write(j),a.document.close()},G=function(a){var a=a.replace(/\&amp\;/g,"&").replace(/\&/g,"&amp;");if(window.DOMParser)var b=new DOMParser,c=b.parseFromString(a,"text/xml");else{var c=new ActiveXObject("Microsoft.XMLDOM");c.async="false",c.loadXML(a)}var d=(new XMLSerializer).serializeToString(c);return d},H=function(a,b){if(!j(a)){var c=document.createElement("div");c.innerHTML=b,a.appendChild(c)}},I=function(a,b){return b.parentNode.insertBefore(a,b.nextSibling),!0},J=function(a){j(a)||j(a.parentNode)||a.parentNode.removeChild(a)},K=function(a){for(var b=a,c=0;b&&"body"!==b.tagName.toLowerCase()&&"documentElement"!==b.tagName.toLowerCase();)c+=b.offsetTop,b=b.offsetParent;return c},L=function(a){for(var b=a,c=0;b&&"body"!==b.tagName.toLowerCase()&&"documentElement"!==b.tagName.toLowerCase();)c+=b.offsetLeft,b=b.offsetParent;return c};return{posY:K,posX:L,hasActiveX:a,cb:o,inIframe:p,isOurIframe:q,getPageUrl:w,getRefererUrl:x,getRootDomain:y,getPageTitle:z,generateUUID:r,addEventListener:A,removeEventListener:B,addEventListenerOnce:C,createIframe:E,writeIframeContent:F,scrubXMLEncoding:G,enableLogging:i,Exists:u,whenExists:function(a,b,c,d){c?u.whenDoesntExist(a,b,d):u.whenExists(a,b,d)},flashAvailable:v,nl2r:d,log:h,mergeObjects:s,callbackTimeout:l,insertCode:H,appendAfter:I,removeElement:J,isNull:j,isArray:k,Strings:m,Iterable:n,"break":n.Break,each:n.each}}(),AltitudeDigital.Utils.Url=AltitudeDigital.Utils.Url||function(){var a=AltitudeDigital.Utils,b=a.log,c=a.Strings,d=a.Iterable,e=c.MapJoiner("&","="),f=c.Splitter("&").trimResults().omitEmptyStrings(),g=function(){function c(){}return c.xhr=function(a){a=a||{};var c=a.withCredentials||!1,d=a.timeout||0,e=new window.XMLHttpRequest;if(c)if(b("Looking to use CORS"),"withCredentials"in e)e.withCredentials=!0;else{if("undefined"==typeof XDomainRequest)throw"CORS not supported by browser";e=new XDomainRequest}return e.timeout=d,b("XHR: ",e),e},c.supported=function(){return!!this.xhr()},c.get=function(c,d,e){b("URL: ",c),b("Options: ",d);var f=this.xhr(d);return f.open("GET",c),f.send(),a.isNull(e)?void 0:f.onreadystatechange=function(){return 4===f.readyState?e(f.responseText,f.responseXML):void 0}},c.post=function(c,d,e,f){b("URL: ",c),b("Params: ",d),b("Options: ",e);var g=this.xhr(e);return g.open("POST",c),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(l(d)),a.isNull(f)?void 0:g.onreadystatechange=function(){return 4==g.readyState&&200==g.status?f(g.responseText,g.responseXML):void 0}},c}(),h=function(a,c,d,e){b.startGroup("POST");try{if(!g.supported())throw b.error("XHR not supported"),"XHR isn't supported";g.post(a,c,e,d)}catch(f){throw b.endGroup(),f}b.endGroup()},i=function(a,c,d,e){b.startGroup("GET");try{if(!g.supported())throw b.error("XHR not supported"),"XHR isn't supported";var f=k(a,c);g.get(f,e,d)}catch(h){throw b.endGroup(),h}b.endGroup()},j=function(a,b){var c=k(a,b),d=document.createElement("img");d.src=c},k=function(b,d){if(!a.isNull(d)){var e=l(d,!0);if(!c.isNullOrEmpty(e))return b.indexOf("?")>0?b+"&"+e:b+"?"+e}return b},l=function(b,f){if(!a.isNull(b)){var g={};return 0==f?g=b:d.eachMap(b,function(b,e){a.isArray(e)?(g[b]=new Array,d.each(e,function(a){c.isNullOrEmpty(a)||g[b].push(encodeURIComponent(a))})):c.isNullOrEmpty(e)||(g[b]=encodeURIComponent(e))}),e.join(g)}return""},m=function(b){var e=a.mergeObjects(b||{},{}),g=function(b,c){if(!a.isNull(b))if(d.contains(e,b)){if(!a.isArray(e[b])){var f=e[b];e[b]=new Array,e[b].push(f)}e[b]=e[b].concat(c)}else e[b]=c},h=function(a,b){e[a]=b};return{add:g,set:h,extend:function(a){d.eachMap(a,function(a,b){g(a,b)})},replace:function(a){d.eachMap(a,function(a,b){h(a,b)})},get:function(b){return a.isNull(b)?e:d.contains(e,b)?e[b]:null},toQueryString:function(){return l(e,!0)},remove:function(a){delete e[a]},fromQueryString:function(a){if(!c.isNullOrEmpty(a)){var b=f.split(a);d.each(b,function(a){if(!c.isNullOrEmpty(a)){var b=a.split("=",2);g(b[0],decodeURIComponent(b[1]))}})}}}};return{pixel:j,get:i,post:h,toQueryString:l,addQueryParams:k,ParamCollection:m,parse:function(a){var b={scheme:"",host:"",path:"",base:"",query:m()},d=a.split("//",2);2==d.length&&(b.scheme=d[0].replace(":",""),a=d[1]);var e="";if(d=a.split("/"),d.length>=2){b.host=d.shift();var f=d.join("/").split("?");2==f.length?(b.path=f[0],e=f[1]):b.path=d[1]}else{var f=a.split("?");2==f.length?(b.host=f[0],e=f[1]):b.host=a}b.query.fromQueryString(e);var g="";return c.isNullOrEmpty(b.scheme)||(g+=b.scheme+"://"),g+=b.host,c.isNullOrEmpty(b.path)||(g+="/"+b.path),b.base=g,b}}}(),AltitudeDigital.ThirdParty=AltitudeDigital.ThirdParty||function(a){var b=AltitudeDigital.Utils,c=b.log,d=b.Iterable,e=b.Strings,f=encodeURIComponent(b.getPageUrl()),g=encodeURIComponent(b.getRefererUrl()),h=(encodeURIComponent(b.getRootDomain()),encodeURIComponent(b.getPageTitle())),i=new Array,j=new Array,k=new Array,l=function(a){c("Loading Pixel: "+a);var b=document.createElement("img");b.src=a},m=function(b){c("Loading JS: "+b);try{var d=document.createElement("script");d.type="text/javascript",d.async=!0,d.src=b,a.appendChild(d)}catch(e){}},n=function(a,b,c){return b=encodeURIComponent(e.nullToEmpty(b)),c=encodeURIComponent(e.nullTo(c,b)),a.replace("[page_url]",f).replace("[page_title]",h).replace("[page_referer]",g).replace("[media_name]",c).replace("[media_guid]",b)};return{extendOppPixels:function(a){i=i.concat(a)},extendImpPixels:function(a){j=j.concat(a)},extendOppJS:function(a){k=k.concat(a)},callOps:function(){c("Loading Opp Pixels"),d.each(i,function(a){l(n(a))}),c("Loading Opp JS"),d.each(k,function(a){m(n(a))})},callImps:function(a,b){c("Loading Imp Pixels"),d.each(j,function(c){l(n(c,b,a))})}}},AltitudeDigital.Beacon=AltitudeDigital.Beacon||function(a){var b=null,c=AltitudeDigital.Utils,d=c.Strings,e=c.Iterable,f=c.Url,g=c.log,h={init:"init",trueFirstCall:"dfcl",trueFirstCallVideo:"tfcl",podFirstCall:"pfcl",imp:"rollimp",rollStart:"rollst",roll25:"roll25",roll50:"roll50",roll75:"roll75",roll100:"roll100",click:"rollck",passAway:"pba",passReceived:"pbr",allPartnersFailed:"apf",passToPublisher:"topub",noFlash:"nofl"},i={basic:1,debug:2};g.startGroup("BEACON Info");var j=i.basic,k=f.parse(a),l=k.base;g("Tracking URL: ",a),g("Base Domain: ",l),g("URI Parts: ",k);var m=k.query;g("Base Params from URL: ",m.toQueryString()),m.replace({vpaid:"js",loc:c.getPageUrl(),rr:c.getRefererUrl(),dm:c.getRootDomain(),px:1,v:-1}),g("Final Base Params: ",m.toQueryString()),g.endGroup();var n=function(a){var b=f.ParamCollection();if(!c.isNull(a)){g("Got a component of ",a),b.add("al",a.getAlignmentMeta());var e=a.getExtensions();c.isNull(e)||(g("Comp Exts: ",a.extensions),d.isNullOrEmpty(e.alignmentMeta)||b.add("al",e.alignmentMeta),d.isNullOrEmpty(e.rtbMeta)||b.add("rm",e.rtbMeta))}return g("Component Params: ",b.get()),b.get()},o=function(a,b){var d=f.ParamCollection(m.get());return c.isArray(a)||c.isNull(a)?b==h.trueFirstCallVideo&&c.isArray(a)&&e.each(a,function(a){c.isNull(a)||d.add("al",a.getAlignmentMeta())}):d.replace(n(a)),d.set("ev",b),g("Request Params: ",d.toQueryString()),d},p=function(a,b,d){if(g.startGroup("Beacon ("+b+")"),!r(b))return g("not tracking: ",b),void g.endGroup();var e=o(a,b).get();g("Domain: ",l),g("Params: ",e);var h=function(a,b){g("Beacon Response: ",a,b),c.isNull(d)||d(a,b)};try{f.get(l,e,h),g.endGroup()}catch(i){g.error("Post failed. Doing Pixel",i),f.pixel(l,e),g.endGroup(),c.isNull(d)||d()}},q=function(a){var b=o(null,a);return b.set("px",0),f.addQueryParams(l,b.get())},r=function(a){return j==i.basic?s(a):!0},s=function(a){switch(a){case h.trueFirstCall:case h.trueFirstCallVideo:case h.podFirstCall:case h.passReceived:case h.imp:case h.rollStart:case h.roll25:case h.roll50:case h.roll75:case h.roll100:case h.click:return!0}return!1};return{send:p,event:h,genClickURL:q,addParam:m.add,setParam:m.set,setAlignArray:function(a){b=a}}},AltitudeDigital.EventManager=AltitudeDigital.EventManager||function(){var a=AltitudeDigital.Utils,b=a.log,c={},d=function(a,b,d){"undefined"==typeof c[b]&&(c[b]=new Array),c[b].push({callback:a,scope:d})},e=function(a,b){if("undefined"!=typeof c[b])for(var d=0;d<c[b].length;d++)c[b][d].callback==a&&c[b].splice(d,1)},f=function(a,d){var e=c[a];if("undefined"!=typeof e)try{for(var f=0;f<e.length;f++)g(e[f],d)}catch(h){b.error("Error dispatching event",h)}else b("could not find subscriber '"+e+"' for ["+a+"]")},g=function(a,c){try{"undefined"!=typeof a.scope?a.callback.apply(a.scope,c):a.callback.apply(null,c)}catch(d){b.error("Error dispatching callback",d)}};return{subscribe:d,unsubscribe:e,dispatch:f,unload:function(){c={}}}},AltitudeDigital.Ads=AltitudeDigital.Ads||{ViewMode:{Normal:"normal",Thumbnail:"thumbnail",Fullscreen:"fullscreen"},Events:{AdLoaded:"AdLoaded",AdStarted:"AdStarted",AdStopped:"AdStopped",AdSkipped:"AdSkipped",AdSkippableStateChange:"AdSkippableStateChange",AdSizeChange:"AdSizeChange",AdLinearChange:"AdLinearChange",AdDurationChange:"AdDurationChange",AdExpandedChange:"AdExpandedChange",AdRemainingTimeChange:"AdRemainingTimeChange",AdVolumeChange:"AdVolumeChange",AdImpression:"AdImpression",AdVideoStart:"AdVideoStart",AdVideoFirstQuartile:"AdVideoFirstQuartile",AdVideoMidpoint:"AdVideoMidpoint",AdVideoThirdQuartile:"AdVideoThirdQuartile",AdVideoComplete:"AdVideoComplete",AdClickThru:"AdClickThru",AdInteraction:"AdInteraction",AdUserAcceptInvitation:"AdUserAcceptInvitation",AdUserMinimize:"AdUserMinimize",AdUserClose:"AdUserClose",AdPaused:"AdPaused",AdPlaying:"AdPlaying",AdLog:"AdLog",AdError:"AdError"},InternalEvents:{StartAd:"startAdInt",StopAd:"stopAdInt",PauseAd:"pauseAdInt",ResumeAd:"resumeAdInt",ExpandAd:"expandAdInt",SkipAd:"skipAdInt",ChangeVolume:"changeVolumeInt",AdErrorInit:"adErrorInit",AdError:"adErrorInt",ResizeAd:"resizeAdInt",Companions:"companionsInt",Progress:"progressInt"},Handlers:function(){var a={},b=function(b){return a[b]||null};return{register:function(b,c){a[b]=a[b]||c},get:b,has:function(a){return null!=b(a)}}}(),PlayerStatus:function(){var a=null,b=null,c=null,d=null,e=!1,f=null,g=null,h=null;return{getPlayerWidth:function(){return a},setPlayerWidth:function(b){a=b},getPlayerHeight:function(){return b},setPlayerHeight:function(a){b=a},getSlot:function(){return c},setSlot:function(a){c=a},getVideoSlot:function(){return d},setVideoSlot:function(a){d=a},getViewMode:function(){return f},setViewMode:function(a){f=a},getDesiredBitrate:function(){return g},setDesiredBitrate:function(a){g=a},videoCanAutoplay:function(){return e},setVideoCanAutoplay:function(a){e=a},getThirdParty:function(){return h},setThirdParty:function(a){h=a},getMacroObj:function(){return{adtid:transactionId,player_width:a,player_height:b,third_party:h,video_duration:30}}}}},AltitudeDigital.Ads.Filter=AltitudeDigital.Ads.Filter||function(a,b,c){var d=AltitudeDigital.Utils,e=d.Strings,f=d.Iterable,g=d.Url,h=d.log;h("Pasing Filter URI");var i=g.parse(a),j=i.base,k=i.query;h.startGroup("FILTER Info"),h("Base URL: ",a),h("Base Domain: ",j),h("URI Parts: ",i),k.replace({h:c,w:b,v:-1,vpaid:"js",u:d.getPageUrl()}),h("Final Base Params: ",k.toQueryString()),h.endGroup();var l=function(a){g.get(j,k.get(),function(b,c){h("Filter Response recieved. Getting ready to parse."),m(a,b,c)})},m=function(a,b,c){h.startGroup("Filter Response"),h(b);var d={thirdparty:"",filterCodes:"",components:new Array};if(e.isNullOrEmpty(b))h.warn("Response didn't exist");else try{var g=JSON.parse(b);d.thirdparty=e.nullToEmpty(g.tp),d.filterCodes=e.nullToEmpty(g.rcodes),h("Got Thirdparty data of ",d.thirdparty),h("Got Filter code of ",d.filterCodes);var i=g.vmedia,j=g.rmedia,k=function(a){var b=e.nullToEmpty(a.al),c=e.nullToEmpty(a.guid),f=e.nullToEmpty(a.name),g=e.nullToEmpty(a.uri),h=e.nullToEmpty(a.cpm),i=AltitudeDigital.Ads.Component(c,f,h,g);return i.setRtb(!1),i.addAlignmentMeta(b),d.components.push(i),i};f.each(i,k),f.each(j,function(){var a=k();a.setRtb(!0)})}catch(l){h.error("Error parsing Filter",l)}h("Callback Response is: ",d),h.endGroup(),setTimeout(function(){h("Calling Filter Callback"),a(d)},0)};return{call:l}},AltitudeDigital.Ads.JsVPaidHandler=AltitudeDigital.Ads.JsVPaidHandler||function(a,b,c,d,e,f,g){var h={creative:null,iFrame:null,version:""},i={vpaidLoaded:!1,vpaidStarted:!1,vpaidDestroy:!1},j=AltitudeDigital.Utils,k=j.log,l=AltitudeDigital.Ads,m=l.Events,n=l.InternalEvents,o=[m.AdSkipped,m.AdLinearChange,m.AdDurationChange,m.AdRemainingTimeChange,m.AdImpression,m.AdVideoStart,m.AdVideoFirstQuartile,m.AdVideoMidpoint,m.AdVideoThirdQuartile,m.AdVideoComplete,m.AdClickThru,m.AdInteraction,m.AdUserAcceptInvitation,m.AdUserMinimize,m.AdUserClose,m.AdPaused,m.AdPlaying,m.AdLog],p=[m.AdImpression,m.AdVideoStart,m.AdVideoFirstQuartile,m.AdVideoMidpoint,m.AdVideoThirdQuartile,m.AdVideoComplete],q=[],r=function(a){return a.handshakeVersion&&"function"==typeof a.handshakeVersion&&a.initAd&&"function"==typeof a.initAd&&a.startAd&&"function"==typeof a.startAd&&a.stopAd&&"function"==typeof a.stopAd&&a.skipAd&&"function"==typeof a.skipAd&&a.resizeAd&&"function"==typeof a.resizeAd&&a.pauseAd&&"function"==typeof a.pauseAd&&a.resumeAd&&"function"==typeof a.resumeAd&&a.expandAd&&"function"==typeof a.expandAd&&a.collapseAd&&"function"==typeof a.collapseAd&&a.subscribe&&"function"==typeof a.subscribe&&a.unsubscribe&&"function"==typeof a.unsubscribe?!0:!1},s=function(){k.custom("Vpaid Loaded","white","silver"),i.vpaidLoaded=!0,a.dispatch(m.AdLoaded),C()},t=function(){i.vpaidStarted=!0,a.dispatch(m.AdStarted)},u=function(){i.vpaidStarted=!1,a.dispatch(m.AdStopped)},v=function(b){k("VPaid reported an error with msg: "+b),i.vpaidStarted?(k("Was started"),a.dispatch(n.AdError,[b])):a.dispatch(n.AdErrorInit,[b])},w=function(){i.vpaidLoaded&&h.creative.pauseAd()},x=function(){i.vpaidLoaded&&h.creative.resumeAd()},y=function(a){i.vpaidLoaded&&(a?h.creative.expandAd():h.creative.collapseAd())},z=function(a,b,c){i.vpaidLoaded&&h.creative.resizeAd(a,b,c)},A=function(a){i.vpaidLoaded&&h.creative.setAdVolume(a)},B=function(){i.vpaidLoaded&&h.creative.getAdSkippableState()&&h.creative.skipAd()},C=function(){a.dispatch(m.AdSkippableStateChange,[h.creative.getAdSkippableState()])},D=function(){i.vpaidDestroy=!0,a.unsubscribe(w,n.PauseAd),a.unsubscribe(x,n.ResumeAd),a.unsubscribe(y,n.ExpandAd),a.unsubscribe(z,n.ResizeAd),a.unsubscribe(A,n.ChangeVolume),a.unsubscribe(B,n.SkipAd);var b=function(){h.iFrame&&(document.body.removeChild(h.iFrame),h.iFrame=null,h.creative=null)};if(i.vpaidStarted){h.creative.subscribe(function(){clearTimeout(b),b()},m.AdStopped);try{h.creative.stopAd(),setTimeout(b,100)}catch(c){b()}}else b()},E=function(b,c,d,e){var f=g.fileURL;h.iFrame=j.createIframe("100%","100%","vpaid-"+Math.floor(100*Math.random()+1)),h.iFrame.style.position="absolute",h.iFrame.style.left="0",h.iFrame.style.top="0",document.body.appendChild(h.iFrame);var i='<script src="'+f+'"></script><div class="ad-element"></div>';j.writeIframeContent(h.iFrame,i,function(f){if(f)try{G(b,c,d,e)}catch(g){a.dispatch(n.AdError,["Error attempting to init VPaid: "+g.message])}else a.dispatch(n.AdError,["iFrame failed to load in time"])},5e3)},F=function(a){return function(){i.vpaidDestroy||a.apply(this,arguments)}},G=function(e,g,i,l){var E=h.iFrame.contentWindow.getVPAIDAd;if(!E||"function"!=typeof E)throw D(),"VPaid is invalid: Can't find VPaid Creative in iFrame";h.creative=E();var G=r(h.creative);if(!G)throw"VPaid is invalid: Missing VPaid interface functions";h.version=h.creative.handshakeVersion("2.0"),k("Vpaid Versions: "+h.version),k("Subscribing to vpaid events"),h.creative.subscribe(F(s),m.AdLoaded),h.creative.subscribe(F(t),m.AdStarted),h.creative.subscribe(F(u),m.AdStopped),h.creative.subscribe(F(v),m.AdError),h.creative.subscribe(F(C),m.AdSkippableStateChange),h.creative.subscribe(F(function(){a.dispatch(n.AdExpandedChange,[h.creative.getAdExpanded()])}),m.AdExpandedChange),h.creative.subscribe(F(function(){a.dispatch(m.AdSizeChange,[h.creative.getAdWidth(),h.creative.getAdHeight()])}),m.AdSizeChange),h.creative.subscribe(F(function(){a.dispatch(m.AdVolumeChange,[h.creative.getAdVolume()])}),m.AdVolumeChange),q=[],j.each(o,function(b){h.creative.subscribe(F(function(){k("Sub VPaid Event: "+b),p.indexOf(b)>-1?q.indexOf(b)>-1?k.custom(b+" has already been dispatched.  Popping bubble.","blue","silver"):(q.push(b),a.dispatch(b,arguments)):a.dispatch(b,arguments)}),b)}),a.subscribe(F(w),n.PauseAd),a.subscribe(F(x),n.ResumeAd),a.subscribe(F(y),n.ExpandAd),a.subscribe(F(z),n.ResizeAd),a.subscribe(F(A),n.ChangeVolume),a.subscribe(F(B),n.SkipAd),k("Subscribing is done");var H={AdParameters:f.adParameters||null},I={slot:b,videoSlot:c,videoSlotCanAutoPlay:d};k("Initializing ad");try{h.creative.initAd(e,g,i,l,H,I),k("Initilized ad. Awaiting adLoaded event.")}catch(J){k("Failed to init js vpaid"),k.error(J)}};return{load:E,start:function(){if(!i.vpaidLoaded)throw"VPaid isn't loaded yet";h.creative.startAd()},destroy:D}},AltitudeDigital.Ads.Handlers.register("text/javascript",AltitudeDigital.Ads.JsVPaidHandler),AltitudeDigital.Ads.Handlers.register("application/javascript",AltitudeDigital.Ads.JsVPaidHandler),AltitudeDigital.Ads.Handlers.register("application/x-javascript",AltitudeDigital.Ads.JsVPaidHandler),AltitudeDigital.Ads.VideoHandler=AltitudeDigital.Ads.VideoHandler||function(a,b,c,d,e,f,g){var h={start:!1,first:!1,second:!1,third:!1,finish:!1},i=!1,j=!1,k=function(){h.finished||(a.dispatch(AltitudeDigital.Ads.Events.AdVideoComplete),h.finished=!0),t()},l=function(){var b="";if(null!=f.videoClickThroughURLTemplate){b=f.videoClickThroughURLTemplate,c.pause();var d=window.open(f.videoClickThroughURLTemplate,"_blank");d.focus()}a.dispatch(AltitudeDigital.Ads.Events.AdClickThru,[b,g.id,!1])},m=function(){a.dispatch(AltitudeDigital.Ads.Events.AdPaused)},n=function(){a.dispatch(AltitudeDigital.Ads.Events.AdPlaying)},o=function(){var b=Math.round(f.duration),d=Math.round(c.currentTime),e=b/4;a.dispatch(AltitudeDigital.Ads.InternalEvents.Progress,[d]),d!=Math.round(e)||h.first?d!=Math.round(2*e)||h.second?d!=Math.round(3*e)||h.third||(a.dispatch(AltitudeDigital.Ads.Events.AdVideoThirdQuartile),h.third=!0):(a.dispatch(AltitudeDigital.Ads.Events.AdVideoMidpoint),h.second=!0):(a.dispatch(AltitudeDigital.Ads.Events.AdVideoFirstQuartile),h.first=!0),null!=f.skipDelay&&f.skipDelay>=0&&!j&&f.skipDelay<=d&&a.dispatch(AltitudeDigital.Ads.Events.AdSkippableStateChange,[!0])},p=function(){c.pause()},q=function(){c.play()},r=function(){if(null!=f.skipDelay&&f.skipDelay>=0){var b=Math.round(c.currentTime);f.skipDelay<=b&&(t(!0),a.dispatch(AltitudeDigital.Ads.Events.AdSkipped))}},s=!1,t=function(b){s||(AltitudeDigital.Utils.removeEventListener(c,"click",l),AltitudeDigital.Utils.removeEventListener(c,"ended",k),AltitudeDigital.Utils.removeEventListener(c,"pause",m),AltitudeDigital.Utils.removeEventListener(c,"playing",n),AltitudeDigital.Utils.removeEventListener(c,"timeupdate",o),a.unsubscribe(p,AltitudeDigital.Ads.InternalEvents.PauseAd),a.unsubscribe(q,AltitudeDigital.Ads.InternalEvents.ResumeAd),a.unsubscribe(r,AltitudeDigital.Ads.InternalEvents.SkipAd),b||a.dispatch(AltitudeDigital.Ads.Events.AdStopped),s=!0)};return{load:function(b,d,e,h){c.src=g.fileURL,c.load(),a.dispatch(AltitudeDigital.Ads.Events.AdDurationChange,[f.duration]),a.subscribe(p,AltitudeDigital.Ads.InternalEvents.PauseAd),a.subscribe(q,AltitudeDigital.Ads.InternalEvents.ResumeAd),a.subscribe(r,AltitudeDigital.Ads.InternalEvents.SkipAd),AltitudeDigital.Utils.addEventListener(c,"click",l),AltitudeDigital.Utils.addEventListener(c,"ended",k),AltitudeDigital.Utils.addEventListener(c,"pause",m),AltitudeDigital.Utils.addEventListener(c,"playing",n),AltitudeDigital.Utils.addEventListener(c,"timeupdate",o),a.dispatch(AltitudeDigital.Ads.Events.AdLoaded)},start:function(){c.play(),a.dispatch(AltitudeDigital.Ads.Events.AdStarted),i||(a.dispatch(AltitudeDigital.Ads.Events.AdImpression),i=!0),h.start||(a.dispatch(AltitudeDigital.Ads.Events.AdVideoStart),h.start=!0)},destroy:t}},AltitudeDigital.Ads.Component=AltitudeDigital.Ads.Component||function(a,b,c,d){var e=AltitudeDigital.Utils,f=e.Strings,g=e.Iterable,h=e.log,i=null,j=null,k=new Array,l=new Array,m=!1,n={fullResponse:null,ad:null,creative:null,mediaFile:null},o=null,p=null,q={bidderPrice:null,bidderId:null,alignmentMeta:null,rtbMeta:null},r=function(){var a=d;try{var b=e.cb(),c=e.getPageUrl(),i=j.getMacroObj();i.media_file_title="",i.media_file_url="",i.media_description="",i.media_file_id="",i.video_duration=30,i.viewability=-1,i.page_url=encodeURIComponent(c),i.page_url_raw=c,i.random_number=b,i.timestamp=b,i.cb=b,i.bidder_id=f.Joiner(",").join(k),h("Override Macros: ",i),g.eachMap(i,function(b,c){var d=new RegExp("\\["+b+"\\]","g");a=a.replace(d,c)})}catch(l){h.error(l)}return a},s=function(){return e.isNull(p)&&(p=new DMVAST.tracker(n.ad,n.creative)),p},t=function(a,b){h.startGroup("Component::requestAd()");var c=this,f=r();h("Original Url: "+d),h("Formated Url: "+f),h.endGroup(),DMVAST.client.get(f,e.callbackTimeout(a,function(a){h.raw("Component::Response: ",a),h("Self: ",c),a?(c.setVastReponse(a),b(c)):b(null)},function(){h("Vast Response Timed out in "+a+"ms"),b(null)}))},u=function(){if(h("initAd()"),o=x(),!o)throw"No Handler. Init failed.";o.load(j.getPlayerWidth(),j.getPlayerHeight(),j.getViewMode(),j.getDesiredBitrate())},v=function(){o&&o.start()},w=function(){try{o.destroy()}catch(a){h.error(a)}},x=function(){if(h("getHandler()"),null==o)try{var a=AltitudeDigital.Ads.Handlers.get(n.mediaFile.mimeType);if(null==a)throw"Can't get handler for meda type";h("Found a handler. Creating instance."),o=a(i,j.getSlot(),j.getVideoSlot(),j.videoCanAutoplay(),n.ad,n.creative,n.mediaFile)}catch(b){throw h("Failed to getHandler()"),h.raw(b),b}return o};return{id:a,name:b,cpm:c,url:d,getExtensions:function(){return q},setExtensions:function(a){q=a},setEventManager:function(a){i=a},setCurrentPlayerStatus:function(a){j=a},getVastResponse:function(){return n.fullResponse},getAd:function(){return n.ad},getCreative:function(){return n.creative},getMediaFile:function(){return n.mediaFile},setVastReponse:function(a){n.fullResponse=a},setAdInfo:function(a,b,c){n.ad=a,n.creative=b,n.mediaFile=c},setRtb:function(a){m=a},isRtb:function(){return m},requestAd:t,initAd:u,start:v,destroy:w,getTracker:s,getViewability:function(){return e.checkvisible(videoSlot)},getPrice:function(){return null!=q.bidderPrice&&q.bidderPrice>0?q.bidderPrice:c},getAlignmentMeta:function(){return l},addAlignmentMeta:function(a){h("Adding AlignmentMeta: ",a),l.push(a)},extendAlignmentMeta:function(a){h("Extending AlignmentMeta: ",a),l=l.concat(a),h("Final Meta: ",l)},addBidderId:function(a){k.push(a)}}},AltitudeDigital.Ads.Manager=AltitudeDigital.Ads.Manager||function(a,b,c,d,e,f,g,h,i){var j=AltitudeDigital.Utils,k=j.Strings,l=j.Iterable,m=j.log,n=AltitudeDigital.Ads,o=n.Events;n.Component;m("AdsManager initializing...");var p="price",q=n.PlayerStatus();q.setPlayerWidth(f),q.setPlayerHeight(g),q.setSlot(c),q.setVideoSlot(d),q.setVideoCanAutoplay(e),a.subscribe(function(a,c,d){null!=y&&(y.getTracker().click(),b.send(y,b.event.click))},o.AdClickThru),a.subscribe(function(){null!=y&&b.send(y,b.event.rollStart)},o.AdVideoStart),a.subscribe(function(){null!=y&&b.send(y,b.event.roll25)},o.AdVideoFirstQuartile),a.subscribe(function(){null!=y&&b.send(y,b.event.roll50)},o.AdVideoMidpoint),a.subscribe(function(){null!=y&&b.send(y,b.event.roll75)},o.AdVideoThirdQuartile),a.subscribe(function(){null!=y&&(b.send(y,b.event.roll100),y.getTracker().complete())},o.AdVideoComplete),a.subscribe(function(){null!=y&&(b.send(y,b.event.imp),y.getTracker().load())},o.AdImpression),a.subscribe(function(a){if(null!=y&&null!=y.id){var b=a>0?!1:!0;y.getTracker().setMuted(b)}},o.AdVolumeChange),a.subscribe(function(){null!=y&&null!=y.id&&y.getTracker().setPaused(!0)},o.AdPaused),a.subscribe(function(){null!=y&&null!=y.id&&y.getTracker().setPaused(!1)},o.AdPlaying),a.subscribe(function(){null!=y&&null!=y.id&&y.getTracker().stop()},o.AdStopped),a.subscribe(function(){null!=y&&null!=y.id&&y.getTracker().skip()},o.AdSkipped),a.subscribe(function(a){null!=y&&null!=y.id&&y.getTracker().setFullscreen(a)},o.AdExpandedChange),a.subscribe(function(a){null!=y&&null!=y.id&&y.getTracker().setProgress(a)},n.InternalEvents.Progress);var r=function(a){null!=y&&null!=y.id&&y.getTracker().errorWithCode(a)};a.subscribe(r,n.InternalEvents.AdError),a.subscribe(r,n.InternalEvents.AdErrorInit),m("AdsManager initialized");var s={broadcast:5e3,requestAd:5e3,loadAd:1e4,startAd:5e3},t=!1,u=!0,v=new Array,w=new Array,x=-1,y=null,z=function(){return y},A=function(){return v};a.subscribe(function(){t=!0,E()},n.InternalEvents.StopAd),a.subscribe(function(){t=!0,m("Skipped. Destorying ad"),E()},o.AdSkipped),a.subscribe(function(){if(y)try{y.start()}catch(b){a.dispatch(o.AdError,["Failed to start ad: "+b.message])}else a.dispatch(o.AdError,["No Component to start"])},n.InternalEvents.StartAd);var B=null,C=function(a){m("Component errored: "+a),"string"!=typeof a&&m.raw(a),clearTimeout(B),E(),F()},D=function(){m("AdLoaded. UnSubing."),clearTimeout(B),u=!1,a.unsubscribe(C,n.InternalEvents.AdError),a.unsubscribe(C,n.InternalEvents.AdErrorInit),a.subscribe(function(b){m("Internal Ad Error: "+b),a.dispatch(o.AdError,[b])},n.InternalEvents.AdError)},B=function(){m("Timeout on component initAd()"),E(),F()},E=function(){m("Destorying last component"),y&&(y.destroy(),y=null)},F=function(){m("loadNextAd()");try{if(m("Should try again: "+u+"\nCurrent index: "+x),u&&w.length>++x)if(y=w[x],m.raw("currentComponent: ",y),y)try{B=setTimeout(B,s.loadAd),y.initAd(),m("Ad Init Done: "+s.loadAd+" -- "+B)}catch(b){m("comp.initAd() error"),m(b),F()}else m("Component was null: "+x),u=!1,a.dispatch(o.AdError,["No Ads (Tried all)"]);else m("Out of components: "+x),a.dispatch(o.AdError,["No Ads (Tried all)"])}catch(b){m.error(b),a.dispatch(o.AdError,["Failed to load next"])}};a.subscribe(D,o.AdLoaded),a.subscribe(C,n.InternalEvents.AdError),a.subscribe(C,n.InternalEvents.AdErrorInit);var G=function(){var b=new Array,c=!1,d=setTimeout(function(){c=!0,m("Broadcast timeout"),I(b)},s.broadcast);v&&v.length>0?l.each(v,function(a){try{a.requestAd(s.requestAd,function(a){c||(b.push(a),b.length==v.length&&(clearTimeout(d),I(b)))})}catch(e){m(e)}}):a.dispatch(o.AdError,["No Ads (Had None)"])},H=function(){var a=function(a,b){var c=null;return l.each(a.extensions,function(a){if(l.each(a.children,function(a){if(a.name==b)throw c=a.value,j["break"]()}),null!=c)throw j["break"]()}),k.nullToEmpty(c)},b=function(b,c){var d=a(b,"Price"),e=a(b,"Bidder"),f=a(b,"Alignment"),g=a(b,"RtbMeta");c.setExtensions({bidderPrice:d,bidderId:e,alignmentMeta:f,rtbMeta:g})};return{parseAndSetExtentions:b}}(),I=function(b){if(m.raw("adResponses ",b),m.endGroup(),!t)if(b.length<=0)m.warn("No Ads"),a.dispatch(o.AdError,["No Ads"]);else if(m.startGroup("Checking all responses"),l.each(b,function(a){if(m("Checking response for: "+a.id+"-"+a.name),m.notify("Component: ",a),a.getVastResponse()){var b=null;l.each(a.getVastResponse().ads,function(c){if(l.each(c.creatives,function(e){switch(e.type){case"linear":if(l.each(e.mediaFiles,function(f){try{var g=!1;if(n.Handlers.has(f.mimeType)?g=!0:""!=d.canPlayType(f.mimeType)&&(g=!0,n.Handlers.register(f.mimeType,n.VideoHandler)),g)throw m("Had Handler"),a.setAdInfo(c,e,f),H.parseAndSetExtentions(c,a),b=a,new AltitudeDigital.Utils["break"];m("No handler for media of type: "+f.mimeType)}catch(h){}}),b)throw new AltitudeDigital.Utils["break"];break;case"non-linear":break;case"companion":}}),b)throw new AltitudeDigital.Utils["break"]}),b?(m("We found an ad"),w.push(b)):m("No ad found")}else m("Had no response")}),m("Components Ready: "+w.length),l.isNullOrEmpty(w))m.endGroup();else{var c=J[p];null==c&&(c=J.price),w=c(w),m.notify("componentsReady:",w),m.endGroup(),F()}},J=function(){var a=function(a){return m("Sorting by price"),a.sort(function(a,b){return b.getPrice()-a.getPrice()}),a};return{price:a,rand:function(b){m("Doing a random sort"),b=a(b);var c=new Array;return b[0].isRtb()&&(m("RTB was highest component"),c.push(b.shift())),m("Sorting the rest randomly"),b=c.concat(l.shuffle(b))}}}(),K=function(b){m("addComponent("+b.url+")"),m("Status: ",q),b.setEventManager(a),b.setCurrentPlayerStatus(q),v.push(b)};return{addComponent:K,addComponents:function(a){l.each(a,function(a){K(a)})},setThirdParty:function(a){q.setThirdParty(a)},broadcast:G,getComponents:A,getCurrentComponent:z,setSortAlgo:function(a){k.isNullOrEmpty(a)||(m("Setting SortAlgo to "+a),p=a)}}},AltitudeDigital.VPaid=AltitudeDigital.VPaid||function(){var a=AltitudeDigital.EventManager(),b=AltitudeDigital.EventManager(),c=200,d=null,e=null,f=null,d=null,g=AltitudeDigital.Utils,h=g.Strings,i=g.Iterable,j=(g.Url,AltitudeDigital.Ads.Events),k=AltitudeDigital.Utils.log,l={width:0,height:0,viewMode:AltitudeDigital.Ads.ViewMode.Normal,desiredBitrate:0,slot:null,videoSlot:null,videoSlotCanAutoPlay:null},m={width:0,height:0,skippable:!1,duration:-2,remaingTime:-2,expanded:!1,viewMode:AltitudeDigital.Ads.ViewMode.Normal,volume:-1,companions:""},n=[j.AdLoaded,j.AdStarted,j.AdLinearChange,j.AdRemainingTimeChange,j.AdVolumeChange,j.AdImpression,j.AdVideoStart,j.AdVideoFirstQuartile,j.AdVideoMidpoint,j.AdVideoThirdQuartile,j.AdVideoComplete,j.AdClickThru,j.AdInteraction,j.AdUserAcceptInvitation,j.AdUserMinimize,j.AdUserClose,j.AdPaused,j.AdPlaying,j.AdLog,j.AdError];return k("Subing Int->Player bubble events"),i.each(n,function(c){a.subscribe(function(){k.notify("Bubbling ("+c+") with args: ",arguments),b.dispatch(c,arguments)},c)}),a.subscribe(function(a){k.error("VPaidJS Error from below",a)},j.AdError),a.subscribe(function(a,c){m.width=a,m.height=c,b.dispatch(j.AdSizeChange)},j.AdSizeChange),a.subscribe(function(a){m.expanded=a,b.dispatch(j.AdExpandedChange)},j.AdExpandedChange),a.subscribe(function(a){m.duration=a,b.dispatch(j.AdDurationChange)},j.AdDurationChange),a.subscribe(function(){setTimeout(function(){b.dispatch(j.AdSkipped),b.dispatch(j.AdStopped)},c)},j.AdSkipped),a.subscribe(function(a){m.skippable!=a&&(m.skippable=a,b.dispatch(j.AdSkippableStateChange))},j.AdSkippableStateChange),a.subscribe(function(){setTimeout(function(){b.dispatch(j.AdStopped)},c)},j.AdStopped),a.subscribe(function(a){m.companions=a},AltitudeDigital.Ads.InternalEvents.Companions),a.subscribe(function(){d&&d.callImps()},j.AdImpression),{getAdLinear:function(){return!0},getAdWidth:function(){return m.width},getAdHeight:function(){return m.height},getAdExpanded:function(){return m.expanded},getAdSkippableState:function(){return m.skippable},getAdRemainingTime:function(){return m.remaingTime},getAdVolume:function(){return m.volume},setAdVolume:function(b){
m.volume=b,a.dispatch(AltitudeDigital.Ads.InternalEvents.ChangeVolume,[b])},getAdCompanions:function(){return m.companions},getAdIcons:function(){return!1},handshakeVersion:function(a){return"2.0"},initAd:function(c,n,o,p,q,r){l.width=c,l.height=n,l.viewMode=o,l.desiredBitrate=p,m.width=c,m.height=n,m.viewMode=o,q=q||{},r=r||{},l.slot=r.slot||null,l.videoSlot=r.videoSlot||null,l.videoSlotCanAutoPlay=r.videoSlotCanAutoPlay||!0;var s=q.AdParameters||q.adParameters||null;if(h.isNullOrEmpty(s))return b.dispatch(j.AdError,["No AdParams provided"]),!1;-1!=s.indexOf("{{|}}")&&(s=s.substr(0,s.indexOf("{{|}}")));var t=JSON.parse(s),u=t.params;h.toBoolean(u.log)&&g.enableLogging(!0);var v=t.calls;d=AltitudeDigital.ThirdParty(l.slot),d.extendOppPixels(v.op),d.extendImpPixels(v.ip),d.extendOppJS(v.oj),d.callOps(),k.startGroup("VPaid INITAd"),k.black("Player Config",l),k.black("configJSON: ",t),k("Building out Beacon"),e=AltitudeDigital.Beacon(u.evuri),e.addParam("sw",c),e.addParam("sh",n),k.raw("Beacon: ",e),k("Creating Manager"),f=AltitudeDigital.Ads.Manager(a,e,l.slot,l.videoSlot,l.videoSlotCanAutoPlay,c,n,o,p),f.setSortAlgo(u.sort),k.endGroup(),k("Creating Filter Call");try{var w=AltitudeDigital.Ads.Filter(u.furi,c,n);k("Calling out to Filter"),w.call(function(a){k.startGroup("FilterResponse Callback");var b=a.thirdparty,c=a.filterCodes,d=a.components;k("Thirdparty: ",b),k("Filter Codes: ",c),k("Components: ",d),e.addParam("tp",b),e.addParam("fc",c),f.setThirdParty(b),i.each(d,function(a){f.addComponent(a)}),k.endGroup(),k("Sending TFCL"),e.send(d,e.event.trueFirstCallVideo),k("Starting Broadcast"),f.broadcast()})}catch(x){k.error("Failed to call Filter",x)}},resizeAd:function(b,c,d){l.width=b,l.height=c,l.viewMode=d,a.dispatch(AltitudeDigital.Ads.InternalEvents.ResizeAd,[b,c,d])},startAd:function(){k("startAd()"),a.dispatch(AltitudeDigital.Ads.InternalEvents.StartAd)},stopAd:function(){k("stopAd()"),a.dispatch(AltitudeDigital.Ads.InternalEvents.StopAd)},pauseAd:function(){k("pauseAd()"),a.dispatch(AltitudeDigital.Ads.InternalEvents.PauseAd)},resumeAd:function(){k("resumeAd()"),a.dispatch(AltitudeDigital.Ads.InternalEvents.ResumeAd)},expandAd:function(){a.dispatch(AltitudeDigital.Ads.InternalEvents.ExpandAd,[!0])},collapseAd:function(){a.dispatch(AltitudeDigital.Ads.InternalEvents.ExpandAd,[!1])},skipAd:function(){m.skippable&&a.dispatch(AltitudeDigital.Ads.InternalEvents.SkipAd)},subscribe:function(a,c,d){b.subscribe(a,c,d)},unsubscribe:function(a,c){b.unsubscribe(a,c)}}},window.getVPAIDAd=window.getVPAIDAd||function(){return AltitudeDigital.VPaid()};