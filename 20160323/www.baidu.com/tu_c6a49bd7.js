(function(){var h={};if(location.protocol==="http:"){h.uploadServer="http://graph.baidu.com/upload"}else{h.uploadServer="https://sp0.baidu.com/-aYHfD0a2gU2pMbgoY3K/upload"}var f=navigator.platform.toUpperCase();var c=$("#kw");var a=c.parent();var s=bds&&bds.comm&&bds.comm.newindex;var i=f.indexOf("MAC")!==-1;var p="result";if(s){p="newindex"}else{if(bds&&bds.comm&&bds.comm.ishome){p="index"}else{if(/^\/imgsearch/.test(location.pathname)){p="imgresult"}}}var r=function(x){x.stopPropagation();x.preventDefault()};var o=location.href.match(/sign=(\w{32})\b/);var u=o&&o[1]||"";var e=function(x){x.sign=u;x.fm="inlo";if(x.rsv_imageclick){x.rsv_imageclick=p+"_"+x.rsv_imageclick}window.ns_c(x)};var q=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];var l=q[0]&&q[0].v===1&&q[1]&&q[1].v<=3;var m=q[0]&&q[0].v===1;var d=function(x){return(/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/).test(x)
};var k=1024*1024*10;var g=1024*100;var v={"1":"æ±æ­ï¼æ¨ä¸ä¼ çæä»¶ä¸æ¯å¾çæ ¼å¼","2":"å¾çä¸ä¼ å¤±è´¥"};var n=function(A){var C=$.Deferred();function y(E,F){var D=new FileReader();D.onload=function(){var G=this.result.split("base64,")[1];F(G,this.result)};D.onerror=function(G){F()};D.readAsDataURL(E)}function B(N,E,F){E=E||"";F=F||512;var J=atob(N);var L=[];var I=J.length;for(var G=0;G<I;G+=F){var M=J.slice(G,G+F);var K=new Array(M.length);for(var H=0;H<M.length;H++){K[H]=M.charCodeAt(H)}var D=new Uint8Array(K);L.push(D)}return new Blob(L,{type:E})}function x(F){var I=F.width;var D=F.height;if(I>800||D>800){var H=Math.max(I/800,D/800);I/=H;D/=H}var G=document.createElement("canvas");G.width=I;G.height=D;var E=G.getContext("2d");E.fillRect(0,0,G.width,G.height);E.drawImage(F,0,0,I,D);var J=G.toDataURL("image/jpeg",1);return B(J.replace(/^.*?,/,""),"image/jpeg")}var z=A.size;y(A,function(D,F){var E=new Image();E.onload=function(){if(z<g&&E.width<800&&E.height<800){C.resolve(A);return}A=x(E);C.resolve(A)};E.src=F});
return C.promise()};var b=function(){var z;var x=function(B,A){if(B!==""){return B+A.slice(0,1).toUpperCase()+A.slice(1)}return A};var y=(function(){var A=false;if(typeof window.screenX==="number"){["webkit","moz","ms","o",""].forEach(function(B){if(A===false&&document[x(B,"hidden")]!==undefined){z=B;A=true}})}return A})();if(y){return document[x(z,"hidden")]}return undefined};var t=function(x){var y=$("#form").attr("target");if(y==="_blank"){window.open(x,"_blank");setTimeout(function(){if(!b()){location.href=x}},1000)}else{location.href=x}};var w=function(x){$.extend(this,{wrap:null},x);this.state="normal"};$.extend(w.prototype,{init:function(){},clean:function(){this.wrap.find(".soutu-mask").remove()},setNormal:function(){this.clean();var x=this.wrap.find(".upload-pic");x.val("");this.state="normal"},setWaiting:function(){this.clean();this.state="waiting";var y='<div class="soutu-waiting"><div class="ball"><div class="b"></div><div class="b"></div><div class="b"></div></div><span>æ­£å¨å è½½å¾ç</span></div>';
this.wrap.append(this.getHtml(y));var z=[[0,40],[20,20],[40,0]];var x=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.wrap.find(".b").each(function(B,D){var C=0;$(D).css({"background-color":x[B]});(function A(){$(D).animate({left:z[B][C%2]},{duration:800,easing:"swing",progress:function(F,E){if(E>=0.5){$(D).css({"background-color":x[(C+B)%3]})}},complete:function(){A()}});C++})()})},setError:function(y){this.clean();this.state="error";y=y||v["2"];var x='<div class="soutu-error"><i class="soutu-icon soutu-error-icon"></i><p class="soutu-error-main">'+y+'ï¼è¯·<a href="#" class="soutu-error-upload">éæ°ä¸ä¼ </a></p><p class="soutu-error-tip">ä»æ¯æ10Mä»¥ä¸JPG,JPEG,PNG,BMP,GIFæ ¼å¼å¾ç</p></div>';this.wrap.append(this.getHtml(x))},setActiving:function(){if(this.state!=="activing"){this._setActive(1);this.state="activing"}},setActive:function(){if(this.state!=="active"){this._setActive();this.state="active"}},_setActive:function(x){this.clean();if(this.activeLayer){$(this.getHtml(this.activeLayer,"background-color:"+(x?"#ededed":"#f6f6f6")+";")).appendTo(this.wrap)
}},getHtml:function(y,x){x=x||"";return'<div class="soutu-mask" style="'+x+'">'+y+"</div>"},show:function(){},hide:function(){}});var j=function(x){this.config={};$.extend(this.config,h,x);this.state="normal";this.init();this.canDrop="ondrop" in document.body;this.canAjaxForm="FormData" in window};$.extend(j.prototype,{init:function(){var y=this;a.addClass(i?"soutu_mac":"soutu_nomac");var x=$('<link rel="stylesheet" href="http://s1.bdstatic.com/r/www/cache/static/soutu/css/soutu_1815c820.css" type="text/css" data-for="result"/>');if(s){x.insertBefore(a.parent())}else{x.appendTo("head")}this.$Btn=$('<span class="ipt_photo"></span>').prependTo($("#kw").parent()).hover(function(){y.$Btn.addClass("ipt_photo_hover")},function(){y.$Btn.removeClass("ipt_photo_hover")}).on("click",function(z){z.stopPropagation();z.preventDefault();y.addPanel();y.$Btn.hide();y.log({rsv_imageclick:"camerabtn"})});if(i){this.$Btn.addClass("ipt_photo_mac")}if(s){this.$Btn.parent().addClass("s_ipt_wr_newIndex")}$(window).one("index_off",function(){y.$Btn.parent().removeClass("s_ipt_wr_newIndex")
});if(!l){$("#kw").on("drop.soutu",function(z){if(z.originalEvent.dataTransfer&&z.originalEvent.dataTransfer.files&&z.originalEvent.dataTransfer.files.length){r(z);y.$Btn.trigger("click");y.handleDrop(z);y.log({rsv_imageclick:"iptdrop"})}}).on("dragover.soutu",function(z){return !m});if($(".soutu-input-image").length){$(".soutu-input-image").on("click",function(){y.log({rsv_imageclick:"delimg"})})}$(document).on("dragstart.soutu",function(E){var z=E.originalEvent.dataTransfer;var D=E.target||E.srcElement;var F=D.nodeName.toLowerCase();var B;if(F==="img"){y.$Btn.trigger("click");B=D.src;try{z.setData("text/plain",B)}catch(C){z.setData("Text",B)}}else{if(F==="a"){var A=$(D).children("img");if(A.length){y.$Btn.trigger("click");B=A[0].src;try{z.setData("text/plain",B)}catch(C){z.setData("Text",B)}}}}})}},hidePanel:function(){this.$wrap.hide();this.wrapHidden=true},show:function(){if(window.pageState===1&&!this.$wrap.hasClass("result")){this.$wrap.addClass("result")}if(s&&bds.comm.ishome){this.$wrap.addClass("new");
if(!window.s_session||!!s_session.userSkinName===false){this.$wrap.addClass("no-skin")}}this.$wrap.show()},close:function(){this.$wrap.hide();this.$Btn.show();this.setState("normal");this.$urlErrorTip.hide();this.$kw.val("")},addPanel:function(){var x=this;this.wrapHidden=false;if(this.$wrap){this.show();return}this.$wrap=$('<div class="soutu-wrap"><div class="soutu-fake"><span class="soutu-fake-wrap"><input id="soutu-fake-kw" class="soutu-s-ipt" maxlength="255" autocomplete="off" placeholder="å¨æ­¤å¤ç²è´´å¾çç½å"/></span><span class="soutu-fake-btn"><i class="soutu-icon soutu-fake-btn-icon"></i></span><span class="soutu-url-error">è¯·è¾å¥æ­£ç¡®çå¾çç½å</span></div><div class="soutu-hr"><div class="soutu-drop" style="display:none;"><span class="soutu-drop-tip">ææ½å¾çå°è¿é</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" data-nolog="1" class="upload-pic" value="ä¸ä¼ å¾ç"/><i class="soutu-icon upload-icon"></i><span class="upload-text">æ¬å°ä¸ä¼ å¾ç</span></div></div><a class="soutu-icon soutu-close" data-nolog="1" href="javascript:void(0);"></a></div>').prependTo($("#form"));
this.$kw=this.$wrap.find("#soutu-fake-kw").on("focus",function(){x.$wrap.find(".soutu-fake-wrap").addClass("focus")}).on("blur",function(){x.$wrap.find(".soutu-fake-wrap").removeClass("focus")});this.$dropArea=this.$wrap.find(".soutu-drop");this.$kw.on("keydown",function(z){var y=z.keyCode;if(x.$urlErrorTip.css("display")!=="none"){x.$urlErrorTip.hide()}if(y===13){x.submit(this.value);z.stopPropagation();z.preventDefault();return false}});this.$urlErrorTip=this.$wrap.find(".soutu-url-error");this.$wrap.find(".soutu-fake-btn").on("click",function(){var y=x.$kw.val();x.submit(y,true)});this.$wrap.find(".soutu-fake-btn").on("mouseover",function(){$(this).addClass("btnhover")}).on("mouseout",function(){$(this).removeClass("btnhover")});if(!this.canAjaxForm){this.hackFlash()}this.$wrap.find(".soutu-close").on("click",function(){x.close(true);x.log({rsv_imageclick:"close"})});$(document).click(function(y){x.document_click(y)});this.$wrap.find(".upload-pic").on("change",function(){var y=this.files[0];
x.upload(y)});this.$wrap.find(".upload-pic").on("click",function(){x.log({rsv_imageclick:"uploadbtn"})});if(this.canDrop&&!l){this.setDragAndDrop()}this.masks=[new w({wrap:this.$wrap})];this.show();$(window).one("index_off",function(){x.$wrap.removeClass("new");x.$wrap.removeClass("no-skin")})},setState:function(A){this.state=A;var x=this.masks[0];A=A.charAt(0).toUpperCase()+A.substring(1);var y=[].slice.call(arguments);[].shift.call(y);if(A==="Activing"){this.$dropArea.addClass("drag-over")}else{this.$dropArea.removeClass("drag-over")}x["set"+A].apply(x,y);if(A==="Error"){var z=this;this.$wrap.find(".soutu-error-upload").click(function(B){B.stopPropagation();B.preventDefault();z.setState("normal")})}},document_click:function(A){var z=this;var y=A.target;var x=true;do{if(y===z.$wrap[0]||y===z.$Btn[0]){x=false;break}}while(y=y.parentNode);if(x){z.close()}},doAjax:function(y){var x=this;if(this.state!=="waiting"){this.setState("waiting")}$.ajax({url:x.config.uploadServer,type:"POST",data:y,processData:false,contentType:false,success:function(z){x.uploadComplete(z)
},error:function(){x.setState("error")},always:function(){}})},uploadUrl:function(x){var y=new FormData();y.append("image",x);this.doAjax(y);this.log({rsv_imageclick:"uploadurl"})},upload:function(x){var z=this;var y=this.validate(x);if(y){this.setState("error",v[y]);return}this.setState("waiting");n(x).then(function(A){var B=new FormData();B.append("image",A);z.doAjax(B);z.log({rsv_imageclick:"uploadfile"})})},uploadComplete:function(x){var y=this;if(x&&x.command&&x.command.mode===2&&x.data){setTimeout(function(){var A="";var z=A+"/imgsearch?wd="+encodeURIComponent(x.data.wd)+"&sign="+encodeURIComponent(x.data.sign);y.close();t(z)},x.command.interval||3000)}else{this.setState("error")}},submit:function(y,x){this.setURL(y,x)},validate:function(y){var A=["jpg","jpeg","png","bmp","gif"];var x=y.name.split(".");var z=x.pop().toLowerCase();if(!y.type||!z||$.inArray(z,A)===-1){return 1}if(y.size>k){return 2}return 0},setURL:function(y,x){if(d(y)){this.$kw.val(y);this.setState("normal");this.$urlErrorTip.hide();
if(x){this.log({rsv_imageclick:"imgsearchbtn-success"})}this.uploadUrl(y)}else{this.setState("normal");this.$urlErrorTip.show();if(x){this.log({rsv_imageclick:"imgsearchbtn-error"})}}},handleDrop:function(C){var B=this;var x;if(C.originalEvent.dataTransfer){x=C.originalEvent.dataTransfer.files}if(!x||x.length===0){var y;try{y=C.originalEvent.dataTransfer.getData("text/plain")||C.originalEvent.dataTransfer.getData("text/uri-list")}catch(A){y=C.originalEvent.dataTransfer.getData("Text")||C.originalEvent.dataTransfer.getData("URL")}if(y){B.setURL(y)}else{B.setState("normal");B.$urlErrorTip.show()}return}var z=x[0];B.upload(z)},setDragAndDrop:function(){var x=this;this.$dropArea.show();x.$dropArea.on("dragover",function(y){x.setState("activing");r(y)}).on("dragleave",function(y){x.setState("normal");r(y)}).on("drop",function(y){r(y);x.handleDrop(y)});this.$kw.on("dragover.soutu dragleave.soutu",function(y){r(y)}).on("drop.soutu",function(y){r(y);x.handleDrop(y)})},hackFlash:function(){var F=this;
var x="11.1.0";var C="playerProductInstall.swf";var z={};var A={};var D="http://s1.bdstatic.com/r/www/cache/static/soutu/js/upload_ef39d94f.swf";A.quality="high";A.bgcolor="#ffffff";A.allowscriptaccess="always";A.allowfullscreen="false";A.wmode="transparent";z.uploadServer=this.config.uploadServer;var B={};B.id="upload_flash";B.name="upload_flash";B.align="middle";var y=null;var E=$.Deferred();this.$wrap.find(".upload-pic").parent().append('<div class="flash-wrap" style="position:absolute;"><div id="upload_flashContent"></div></div>').end().remove();swfobject.embedSWF(D,"upload_flashContent","100","23",x,C,z,A,B,function(G){y=G.ref});j.swfloaded=function(){E.resolve()};j.uploading=function(){F.setState("waiting")};j.complete=function(G){F.uploadComplete(G)};E.done(function(){})},log:e});if(typeof define==="function"){define("soutu.index",[],function(){window.__soutu=j;return new j()})}})();