!function(t){t.extend(t.fn,{validate:function(e){if(!this.length)return void(e&&e.debug&&window.console&&console.warn("Nothing selected, can't validate, returning nothing."));var i=t.data(this[0],"validator");return i?i:(this.attr("novalidate","novalidate"),i=new t.validator(e,this[0]),t.data(this[0],"validator",i),i.settings.onsubmit&&(this.validateDelegate(":submit","click",function(e){i.settings.submitHandler&&(i.submitButton=e.target),t(e.target).hasClass("cancel")&&(i.cancelSubmit=!0),void 0!==t(e.target).attr("formnovalidate")&&(i.cancelSubmit=!0)}),this.submit(function(e){function s(){var s;return i.settings.submitHandler?(i.submitButton&&(s=t("<input type='hidden'/>").attr("name",i.submitButton.name).val(t(i.submitButton).val()).appendTo(i.currentForm)),i.settings.submitHandler.call(i,i.currentForm,e),i.submitButton&&s.remove(),!1):!0}return i.settings.debug&&e.preventDefault(),i.cancelSubmit?(i.cancelSubmit=!1,s()):i.form()?i.pendingRequest?(i.formSubmitted=!0,!1):s():(i.focusInvalid(),!1)})),i)},valid:function(){if(t(this[0]).is("form"))return this.validate().form();var e=!0,i=t(this[0].form).validate();return this.each(function(){e=e&&i.element(this)}),e},removeAttrs:function(e){var i={},s=this;return t.each(e.split(/\s/),function(t,e){i[e]=s.attr(e),s.removeAttr(e)}),i},rules:function(e,i){var s=this[0];if(e){var r=t.data(s.form,"validator").settings,n=r.rules,a=t.validator.staticRules(s);switch(e){case"add":t.extend(a,t.validator.normalizeRule(i)),delete a.messages,n[s.name]=a,i.messages&&(r.messages[s.name]=t.extend(r.messages[s.name],i.messages));break;case"remove":if(!i)return delete n[s.name],a;var u={};return t.each(i.split(/\s/),function(t,e){u[e]=a[e],delete a[e]}),u}}var o=t.validator.normalizeRules(t.extend({},t.validator.classRules(s),t.validator.attributeRules(s),t.validator.dataRules(s),t.validator.staticRules(s)),s);if(o.required){var l=o.required;delete o.required,o=t.extend({required:l},o)}return o}}),t.extend(t.expr[":"],{blank:function(e){return!t.trim(""+t(e).val())},filled:function(e){return!!t.trim(""+t(e).val())},unchecked:function(e){return!t(e).prop("checked")}}),t.validator=function(e,i){this.settings=t.extend(!0,{},t.validator.defaults,e),this.currentForm=i,this.init()},t.validator.format=function(e,i){return 1===arguments.length?function(){var i=t.makeArray(arguments);return i.unshift(e),t.validator.format.apply(this,i)}:(arguments.length>2&&i.constructor!==Array&&(i=t.makeArray(arguments).slice(1)),i.constructor!==Array&&(i=[i]),t.each(i,function(t,i){e=e.replace(new RegExp("\\{"+t+"\\}","g"),function(){return i})}),e)},t.extend(t.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:t([]),errorLabelContainer:t([]),onsubmit:!0,ignore:":hidden",ignoreTitle:!1,onfocusin:function(t){this.lastActive=t,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,t,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(t)).hide())},onfocusout:function(t){this.checkable(t)||!(t.name in this.submitted)&&this.optional(t)||this.element(t)},onkeyup:function(t,e){(9!==e.which||""!==this.elementValue(t))&&(t.name in this.submitted||t===this.lastElement)&&this.element(t)},onclick:function(t){t.name in this.submitted?this.element(t):t.parentNode.name in this.submitted&&this.element(t.parentNode)},highlight:function(e,i,s){"radio"===e.type?this.findByName(e.name).addClass(i).removeClass(s):t(e).addClass(i).removeClass(s)},unhighlight:function(e,i,s){"radio"===e.type?this.findByName(e.name).removeClass(i).addClass(s):t(e).removeClass(i).addClass(s)}},setDefaults:function(e){t.extend(t.validator.defaults,e)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:t.validator.format("Please enter no more than {0} characters."),minlength:t.validator.format("Please enter at least {0} characters."),rangelength:t.validator.format("Please enter a value between {0} and {1} characters long."),range:t.validator.format("Please enter a value between {0} and {1}."),max:t.validator.format("Please enter a value less than or equal to {0}."),min:t.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function e(e){var i=t.data(this[0].form,"validator"),s="on"+e.type.replace(/^validate/,"");i.settings[s]&&i.settings[s].call(i,this[0],e)}this.labelContainer=t(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||t(this.currentForm),this.containers=t(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var i=this.groups={};t.each(this.settings.groups,function(e,s){"string"==typeof s&&(s=s.split(/\s/)),t.each(s,function(t,s){i[s]=e})});var s=this.settings.rules;t.each(s,function(e,i){s[e]=t.validator.normalizeRule(i)}),t(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",e).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",e),this.settings.invalidHandler&&t(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),t.extend(this.submitted,this.errorMap),this.invalid=t.extend({},this.errorMap),this.valid()||t(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var t=0,e=this.currentElements=this.elements();e[t];t++)this.check(e[t]);return this.valid()},element:function(e){e=this.validationTargetFor(this.clean(e)),this.lastElement=e,this.prepareElement(e),this.currentElements=t(e);var i=this.check(e)!==!1;return i?delete this.invalid[e.name]:this.invalid[e.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),i},showErrors:function(e){if(e){t.extend(this.errorMap,e),this.errorList=[];for(var i in e)this.errorList.push({message:e[i],element:this.findByName(i)[0]});this.successList=t.grep(this.successList,function(t){return!(t.name in e)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){t.fn.resetForm&&t(this.currentForm).resetForm(),this.submitted={},this.lastElement=null,this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(t){var e=0;for(var i in t)e++;return e},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0===this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{t(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}},findLastActive:function(){var e=this.lastActive;return e&&1===t.grep(this.errorList,function(t){return t.element.name===e.name}).length&&e},elements:function(){var e=this,i={};return t(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&e.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in i||!e.objectLength(t(this).rules())?!1:(i[this.name]=!0,!0)})},clean:function(e){return t(e)[0]},errors:function(){var e=this.settings.errorClass.replace(" ",".");return t(this.settings.errorElement+"."+e,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=t([]),this.toHide=t([]),this.currentElements=t([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(t){this.reset(),this.toHide=this.errorsFor(t)},elementValue:function(e){var i=t(e).attr("type"),s=t(e).val();return"radio"===i||"checkbox"===i?t("input[name='"+t(e).attr("name")+"']:checked").val():"string"==typeof s?s.replace(/\r/g,""):s},check:function(e){e=this.validationTargetFor(this.clean(e));var i,s=t(e).rules(),r=!1,n=this.elementValue(e);for(var a in s){var u={method:a,parameters:s[a]};try{if(i=t.validator.methods[a].call(this,n,e,u.parameters),"dependency-mismatch"===i){r=!0;continue}if(r=!1,"pending"===i)return void(this.toHide=this.toHide.not(this.errorsFor(e)));if(!i)return this.formatAndAdd(e,u),!1}catch(o){throw this.settings.debug&&window.console&&console.log("Exception occurred when checking element "+e.id+", check the '"+u.method+"' method.",o),o}}return r?void 0:(this.objectLength(s)&&this.successList.push(e),!0)},customDataMessage:function(e,i){return t(e).data("msg-"+i.toLowerCase())||e.attributes&&t(e).attr("data-msg-"+i.toLowerCase())},customMessage:function(t,e){var i=this.settings.messages[t];return i&&(i.constructor===String?i:i[e])},findDefined:function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t];return void 0},defaultMessage:function(e,i){return this.findDefined(this.customMessage(e.name,i),this.customDataMessage(e,i),!this.settings.ignoreTitle&&e.title||void 0,t.validator.messages[i],"<strong>Warning: No message defined for "+e.name+"</strong>")},formatAndAdd:function(e,i){var s=this.defaultMessage(e,i.method),r=/\$?\{(\d+)\}/g;"function"==typeof s?s=s.call(this,i.parameters,e):r.test(s)&&(s=t.validator.format(s.replace(r,"{$1}"),i.parameters)),this.errorList.push({message:s,element:e}),this.errorMap[e.name]=s,this.submitted[e.name]=s},addWrapper:function(t){return this.settings.wrapper&&(t=t.add(t.parent(this.settings.wrapper))),t},defaultShowErrors:function(){var t,e;for(t=0;this.errorList[t];t++){var i=this.errorList[t];this.settings.highlight&&this.settings.highlight.call(this,i.element,this.settings.errorClass,this.settings.validClass),this.showLabel(i.element,i.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(t=0;this.successList[t];t++)this.showLabel(this.successList[t]);if(this.settings.unhighlight)for(t=0,e=this.validElements();e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return t(this.errorList).map(function(){return this.element})},showLabel:function(e,i){var s=this.errorsFor(e);s.length?(s.removeClass(this.settings.validClass).addClass(this.settings.errorClass),s.html(i)):(s=t("<"+this.settings.errorElement+">").attr("for",this.idOrName(e)).addClass(this.settings.errorClass).html(i||""),this.settings.wrapper&&(s=s.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(s).length||(this.settings.errorPlacement?this.settings.errorPlacement(s,t(e)):s.insertAfter(e))),!i&&this.settings.success&&(s.text(""),"string"==typeof this.settings.success?s.addClass(this.settings.success):this.settings.success(s,e)),this.toShow=this.toShow.add(s)},errorsFor:function(e){var i=this.idOrName(e);return this.errors().filter(function(){return t(this).attr("for")===i})},idOrName:function(t){return this.groups[t.name]||(this.checkable(t)?t.name:t.id||t.name)},validationTargetFor:function(t){return this.checkable(t)&&(t=this.findByName(t.name).not(this.settings.ignore)[0]),t},checkable:function(t){return/radio|checkbox/i.test(t.type)},findByName:function(e){return t(this.currentForm).find("[name='"+e+"']")},getLength:function(e,i){switch(i.nodeName.toLowerCase()){case"select":return t("option:selected",i).length;case"input":if(this.checkable(i))return this.findByName(i.name).filter(":checked").length}return e.length},depend:function(t,e){return this.dependTypes[typeof t]?this.dependTypes[typeof t](t,e):!0},dependTypes:{"boolean":function(t){return t},string:function(e,i){return!!t(e,i.form).length},"function":function(t,e){return t(e)}},optional:function(e){var i=this.elementValue(e);return!t.validator.methods.required.call(this,i,e)&&"dependency-mismatch"},startRequest:function(t){this.pending[t.name]||(this.pendingRequest++,this.pending[t.name]=!0)},stopRequest:function(e,i){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[e.name],i&&0===this.pendingRequest&&this.formSubmitted&&this.form()?(t(this.currentForm).submit(),this.formSubmitted=!1):!i&&0===this.pendingRequest&&this.formSubmitted&&(t(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(e){return t.data(e,"previousValue")||t.data(e,"previousValue",{old:null,valid:!0,message:this.defaultMessage(e,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},number:{number:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(e,i){e.constructor===String?this.classRuleSettings[e]=i:t.extend(this.classRuleSettings,e)},classRules:function(e){var i={},s=t(e).attr("class");return s&&t.each(s.split(" "),function(){this in t.validator.classRuleSettings&&t.extend(i,t.validator.classRuleSettings[this])}),i},attributeRules:function(e){var i={},s=t(e),r=s[0].getAttribute("type");for(var n in t.validator.methods){var a;"required"===n?(a=s.get(0).getAttribute(n),""===a&&(a=!0),a=!!a):a=s.attr(n),/min|max/.test(n)&&(null===r||/number|range|text/.test(r))&&(a=Number(a)),a?i[n]=a:r===n&&"range"!==r&&(i[n]=!0)}return i.maxlength&&/-1|2147483647|524288/.test(i.maxlength)&&delete i.maxlength,i},dataRules:function(e){var i,s,r={},n=t(e);for(i in t.validator.methods)s=n.data("rule-"+i.toLowerCase()),void 0!==s&&(r[i]=s);return r},staticRules:function(e){var i={},s=t.data(e.form,"validator");return s.settings.rules&&(i=t.validator.normalizeRule(s.settings.rules[e.name])||{}),i},normalizeRules:function(e,i){return t.each(e,function(s,r){if(r===!1)return void delete e[s];if(r.param||r.depends){var n=!0;switch(typeof r.depends){case"string":n=!!t(r.depends,i.form).length;break;case"function":n=r.depends.call(i,i)}n?e[s]=void 0!==r.param?r.param:!0:delete e[s]}}),t.each(e,function(s,r){e[s]=t.isFunction(r)?r(i):r}),t.each(["minlength","maxlength"],function(){e[this]&&(e[this]=Number(e[this]))}),t.each(["rangelength","range"],function(){var i;e[this]&&(t.isArray(e[this])?e[this]=[Number(e[this][0]),Number(e[this][1])]:"string"==typeof e[this]&&(i=e[this].split(/[\s,]+/),e[this]=[Number(i[0]),Number(i[1])]))}),t.validator.autoCreateRanges&&(e.min&&e.max&&(e.range=[e.min,e.max],delete e.min,delete e.max),e.minlength&&e.maxlength&&(e.rangelength=[e.minlength,e.maxlength],delete e.minlength,delete e.maxlength)),e},normalizeRule:function(e){if("string"==typeof e){var i={};t.each(e.split(/\s/),function(){i[this]=!0}),e=i}return e},addMethod:function(e,i,s){t.validator.methods[e]=i,t.validator.messages[e]=void 0!==s?s:t.validator.messages[e],i.length<3&&t.validator.addClassRules(e,t.validator.normalizeRule(e))},methods:{required:function(e,i,s){if(!this.depend(s,i))return"dependency-mismatch";if("select"===i.nodeName.toLowerCase()){var r=t(i).val();return r&&r.length>0}return this.checkable(i)?this.getLength(e,i)>0:t.trim(e).length>0},email:function(t,e){return this.optional(e)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},url:function(t,e){return this.optional(e)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(t)},date:function(t,e){return this.optional(e)||!/Invalid|NaN/.test(new Date(t).toString())},dateISO:function(t,e){return this.optional(e)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(t)},number:function(t,e){return this.optional(e)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},digits:function(t,e){return this.optional(e)||/^\d+$/.test(t)},creditcard:function(t,e){if(this.optional(e))return"dependency-mismatch";if(/[^0-9 \-]+/.test(t))return!1;var i=0,s=0,r=!1;t=t.replace(/\D/g,"");for(var n=t.length-1;n>=0;n--){var a=t.charAt(n);s=parseInt(a,10),r&&(s*=2)>9&&(s-=9),i+=s,r=!r}return i%10===0},minlength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||r>=s},maxlength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||s>=r},rangelength:function(e,i,s){var r=t.isArray(e)?e.length:this.getLength(t.trim(e),i);return this.optional(i)||r>=s[0]&&r<=s[1]},min:function(t,e,i){return this.optional(e)||t>=i},max:function(t,e,i){return this.optional(e)||i>=t},range:function(t,e,i){return this.optional(e)||t>=i[0]&&t<=i[1]},equalTo:function(e,i,s){var r=t(s);return this.settings.onfocusout&&r.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){t(i).valid()}),e===r.val()},remote:function(e,i,s){if(this.optional(i))return"dependency-mismatch";var r=this.previousValue(i);if(this.settings.messages[i.name]||(this.settings.messages[i.name]={}),r.originalMessage=this.settings.messages[i.name].remote,this.settings.messages[i.name].remote=r.message,s="string"==typeof s&&{url:s}||s,r.old===e)return r.valid;r.old=e;var n=this;this.startRequest(i);var a={};return a[i.name]=e,t.ajax(t.extend(!0,{url:s,mode:"abort",port:"validate"+i.name,dataType:"json",data:a,success:function(s){n.settings.messages[i.name].remote=r.originalMessage;var a=s===!0||"true"===s;if(a){var u=n.formSubmitted;n.prepareElement(i),n.formSubmitted=u,n.successList.push(i),delete n.invalid[i.name],n.showErrors()}else{var o={},l=s||n.defaultMessage(i,"remote");o[i.name]=r.message=t.isFunction(l)?l(e):l,n.invalid[i.name]=!0,n.showErrors(o)}r.valid=a,n.stopRequest(i,a)}},s)),"pending"}}}),t.format=t.validator.format}(jQuery),function(t){var e={};if(t.ajaxPrefilter)t.ajaxPrefilter(function(t,i,s){var r=t.port;"abort"===t.mode&&(e[r]&&e[r].abort(),e[r]=s)});else{var i=t.ajax;t.ajax=function(s){var r=("mode"in s?s:t.ajaxSettings).mode,n=("port"in s?s:t.ajaxSettings).port;return"abort"===r?(e[n]&&e[n].abort(),e[n]=i.apply(this,arguments),e[n]):i.apply(this,arguments)}}}(jQuery),function(t){t.extend(t.fn,{validateDelegate:function(e,i,s){return this.bind(i,function(i){var r=t(i.target);return r.is(e)?s.apply(r,arguments):void 0})}})}(jQuery);
/**
 * @license
 * Lo-Dash 2.4.1 (Custom Build) lodash.com/license | Underscore.js 1.5.2 underscorejs.org/LICENSE
 * Build: `lodash modern -o ./dist/lodash.js`
 */
;(function(){function n(n,t,e){e=(e||0)-1;for(var r=n?n.length:0;++e<r;)if(n[e]===t)return e;return-1}function t(t,e){var r=typeof e;if(t=t.l,"boolean"==r||null==e)return t[e]?0:-1;"number"!=r&&"string"!=r&&(r="object");var u="number"==r?e:m+e;return t=(t=t[r])&&t[u],"object"==r?t&&-1<n(t,e)?0:-1:t?0:-1}function e(n){var t=this.l,e=typeof n;if("boolean"==e||null==n)t[n]=true;else{"number"!=e&&"string"!=e&&(e="object");var r="number"==e?n:m+n,t=t[e]||(t[e]={});"object"==e?(t[r]||(t[r]=[])).push(n):t[r]=true
}}function r(n){return n.charCodeAt(0)}function u(n,t){for(var e=n.m,r=t.m,u=-1,o=e.length;++u<o;){var i=e[u],a=r[u];if(i!==a){if(i>a||typeof i=="undefined")return 1;if(i<a||typeof a=="undefined")return-1}}return n.n-t.n}function o(n){var t=-1,r=n.length,u=n[0],o=n[r/2|0],i=n[r-1];if(u&&typeof u=="object"&&o&&typeof o=="object"&&i&&typeof i=="object")return false;for(u=f(),u["false"]=u["null"]=u["true"]=u.undefined=false,o=f(),o.k=n,o.l=u,o.push=e;++t<r;)o.push(n[t]);return o}function i(n){return"\\"+U[n]
}function a(){return h.pop()||[]}function f(){return g.pop()||{k:null,l:null,m:null,"false":false,n:0,"null":false,number:null,object:null,push:null,string:null,"true":false,undefined:false,o:null}}function l(n){n.length=0,h.length<_&&h.push(n)}function c(n){var t=n.l;t&&c(t),n.k=n.l=n.m=n.object=n.number=n.string=n.o=null,g.length<_&&g.push(n)}function p(n,t,e){t||(t=0),typeof e=="undefined"&&(e=n?n.length:0);var r=-1;e=e-t||0;for(var u=Array(0>e?0:e);++r<e;)u[r]=n[t+r];return u}function s(e){function h(n,t,e){if(!n||!V[typeof n])return n;
t=t&&typeof e=="undefined"?t:tt(t,e,3);for(var r=-1,u=V[typeof n]&&Fe(n),o=u?u.length:0;++r<o&&(e=u[r],false!==t(n[e],e,n)););return n}function g(n,t,e){var r;if(!n||!V[typeof n])return n;t=t&&typeof e=="undefined"?t:tt(t,e,3);for(r in n)if(false===t(n[r],r,n))break;return n}function _(n,t,e){var r,u=n,o=u;if(!u)return o;for(var i=arguments,a=0,f=typeof e=="number"?2:i.length;++a<f;)if((u=i[a])&&V[typeof u])for(var l=-1,c=V[typeof u]&&Fe(u),p=c?c.length:0;++l<p;)r=c[l],"undefined"==typeof o[r]&&(o[r]=u[r]);
return o}function U(n,t,e){var r,u=n,o=u;if(!u)return o;var i=arguments,a=0,f=typeof e=="number"?2:i.length;if(3<f&&"function"==typeof i[f-2])var l=tt(i[--f-1],i[f--],2);else 2<f&&"function"==typeof i[f-1]&&(l=i[--f]);for(;++a<f;)if((u=i[a])&&V[typeof u])for(var c=-1,p=V[typeof u]&&Fe(u),s=p?p.length:0;++c<s;)r=p[c],o[r]=l?l(o[r],u[r]):u[r];return o}function H(n){var t,e=[];if(!n||!V[typeof n])return e;for(t in n)me.call(n,t)&&e.push(t);return e}function J(n){return n&&typeof n=="object"&&!Te(n)&&me.call(n,"__wrapped__")?n:new Q(n)
}function Q(n,t){this.__chain__=!!t,this.__wrapped__=n}function X(n){function t(){if(r){var n=p(r);be.apply(n,arguments)}if(this instanceof t){var o=nt(e.prototype),n=e.apply(o,n||arguments);return wt(n)?n:o}return e.apply(u,n||arguments)}var e=n[0],r=n[2],u=n[4];return $e(t,n),t}function Z(n,t,e,r,u){if(e){var o=e(n);if(typeof o!="undefined")return o}if(!wt(n))return n;var i=ce.call(n);if(!K[i])return n;var f=Ae[i];switch(i){case T:case F:return new f(+n);case W:case P:return new f(n);case z:return o=f(n.source,C.exec(n)),o.lastIndex=n.lastIndex,o
}if(i=Te(n),t){var c=!r;r||(r=a()),u||(u=a());for(var s=r.length;s--;)if(r[s]==n)return u[s];o=i?f(n.length):{}}else o=i?p(n):U({},n);return i&&(me.call(n,"index")&&(o.index=n.index),me.call(n,"input")&&(o.input=n.input)),t?(r.push(n),u.push(o),(i?St:h)(n,function(n,i){o[i]=Z(n,t,e,r,u)}),c&&(l(r),l(u)),o):o}function nt(n){return wt(n)?ke(n):{}}function tt(n,t,e){if(typeof n!="function")return Ut;if(typeof t=="undefined"||!("prototype"in n))return n;var r=n.__bindData__;if(typeof r=="undefined"&&(De.funcNames&&(r=!n.name),r=r||!De.funcDecomp,!r)){var u=ge.call(n);
De.funcNames||(r=!O.test(u)),r||(r=E.test(u),$e(n,r))}if(false===r||true!==r&&1&r[1])return n;switch(e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,u){return n.call(t,e,r,u)};case 4:return function(e,r,u,o){return n.call(t,e,r,u,o)}}return Mt(n,t)}function et(n){function t(){var n=f?i:this;if(u){var h=p(u);be.apply(h,arguments)}return(o||c)&&(h||(h=p(arguments)),o&&be.apply(h,o),c&&h.length<a)?(r|=16,et([e,s?r:-4&r,h,null,i,a])):(h||(h=arguments),l&&(e=n[v]),this instanceof t?(n=nt(e.prototype),h=e.apply(n,h),wt(h)?h:n):e.apply(n,h))
}var e=n[0],r=n[1],u=n[2],o=n[3],i=n[4],a=n[5],f=1&r,l=2&r,c=4&r,s=8&r,v=e;return $e(t,n),t}function rt(e,r){var u=-1,i=st(),a=e?e.length:0,f=a>=b&&i===n,l=[];if(f){var p=o(r);p?(i=t,r=p):f=false}for(;++u<a;)p=e[u],0>i(r,p)&&l.push(p);return f&&c(r),l}function ut(n,t,e,r){r=(r||0)-1;for(var u=n?n.length:0,o=[];++r<u;){var i=n[r];if(i&&typeof i=="object"&&typeof i.length=="number"&&(Te(i)||yt(i))){t||(i=ut(i,t,e));var a=-1,f=i.length,l=o.length;for(o.length+=f;++a<f;)o[l++]=i[a]}else e||o.push(i)}return o
}function ot(n,t,e,r,u,o){if(e){var i=e(n,t);if(typeof i!="undefined")return!!i}if(n===t)return 0!==n||1/n==1/t;if(n===n&&!(n&&V[typeof n]||t&&V[typeof t]))return false;if(null==n||null==t)return n===t;var f=ce.call(n),c=ce.call(t);if(f==D&&(f=q),c==D&&(c=q),f!=c)return false;switch(f){case T:case F:return+n==+t;case W:return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case z:case P:return n==oe(t)}if(c=f==$,!c){var p=me.call(n,"__wrapped__"),s=me.call(t,"__wrapped__");if(p||s)return ot(p?n.__wrapped__:n,s?t.__wrapped__:t,e,r,u,o);
if(f!=q)return false;if(f=n.constructor,p=t.constructor,f!=p&&!(dt(f)&&f instanceof f&&dt(p)&&p instanceof p)&&"constructor"in n&&"constructor"in t)return false}for(f=!u,u||(u=a()),o||(o=a()),p=u.length;p--;)if(u[p]==n)return o[p]==t;var v=0,i=true;if(u.push(n),o.push(t),c){if(p=n.length,v=t.length,(i=v==p)||r)for(;v--;)if(c=p,s=t[v],r)for(;c--&&!(i=ot(n[c],s,e,r,u,o)););else if(!(i=ot(n[v],s,e,r,u,o)))break}else g(t,function(t,a,f){return me.call(f,a)?(v++,i=me.call(n,a)&&ot(n[a],t,e,r,u,o)):void 0}),i&&!r&&g(n,function(n,t,e){return me.call(e,t)?i=-1<--v:void 0
});return u.pop(),o.pop(),f&&(l(u),l(o)),i}function it(n,t,e,r,u){(Te(t)?St:h)(t,function(t,o){var i,a,f=t,l=n[o];if(t&&((a=Te(t))||Pe(t))){for(f=r.length;f--;)if(i=r[f]==t){l=u[f];break}if(!i){var c;e&&(f=e(l,t),c=typeof f!="undefined")&&(l=f),c||(l=a?Te(l)?l:[]:Pe(l)?l:{}),r.push(t),u.push(l),c||it(l,t,e,r,u)}}else e&&(f=e(l,t),typeof f=="undefined"&&(f=t)),typeof f!="undefined"&&(l=f);n[o]=l})}function at(n,t){return n+he(Re()*(t-n+1))}function ft(e,r,u){var i=-1,f=st(),p=e?e.length:0,s=[],v=!r&&p>=b&&f===n,h=u||v?a():s;
for(v&&(h=o(h),f=t);++i<p;){var g=e[i],y=u?u(g,i,e):g;(r?!i||h[h.length-1]!==y:0>f(h,y))&&((u||v)&&h.push(y),s.push(g))}return v?(l(h.k),c(h)):u&&l(h),s}function lt(n){return function(t,e,r){var u={};e=J.createCallback(e,r,3),r=-1;var o=t?t.length:0;if(typeof o=="number")for(;++r<o;){var i=t[r];n(u,i,e(i,r,t),t)}else h(t,function(t,r,o){n(u,t,e(t,r,o),o)});return u}}function ct(n,t,e,r,u,o){var i=1&t,a=4&t,f=16&t,l=32&t;if(!(2&t||dt(n)))throw new ie;f&&!e.length&&(t&=-17,f=e=false),l&&!r.length&&(t&=-33,l=r=false);
var c=n&&n.__bindData__;return c&&true!==c?(c=p(c),c[2]&&(c[2]=p(c[2])),c[3]&&(c[3]=p(c[3])),!i||1&c[1]||(c[4]=u),!i&&1&c[1]&&(t|=8),!a||4&c[1]||(c[5]=o),f&&be.apply(c[2]||(c[2]=[]),e),l&&we.apply(c[3]||(c[3]=[]),r),c[1]|=t,ct.apply(null,c)):(1==t||17===t?X:et)([n,t,e,r,u,o])}function pt(n){return Be[n]}function st(){var t=(t=J.indexOf)===Wt?n:t;return t}function vt(n){return typeof n=="function"&&pe.test(n)}function ht(n){var t,e;return n&&ce.call(n)==q&&(t=n.constructor,!dt(t)||t instanceof t)?(g(n,function(n,t){e=t
}),typeof e=="undefined"||me.call(n,e)):false}function gt(n){return We[n]}function yt(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==D||false}function mt(n,t,e){var r=Fe(n),u=r.length;for(t=tt(t,e,3);u--&&(e=r[u],false!==t(n[e],e,n)););return n}function bt(n){var t=[];return g(n,function(n,e){dt(n)&&t.push(e)}),t.sort()}function _t(n){for(var t=-1,e=Fe(n),r=e.length,u={};++t<r;){var o=e[t];u[n[o]]=o}return u}function dt(n){return typeof n=="function"}function wt(n){return!(!n||!V[typeof n])
}function jt(n){return typeof n=="number"||n&&typeof n=="object"&&ce.call(n)==W||false}function kt(n){return typeof n=="string"||n&&typeof n=="object"&&ce.call(n)==P||false}function xt(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;)u[t]=n[e[t]];return u}function Ct(n,t,e){var r=-1,u=st(),o=n?n.length:0,i=false;return e=(0>e?Ie(0,o+e):e)||0,Te(n)?i=-1<u(n,t,e):typeof o=="number"?i=-1<(kt(n)?n.indexOf(t,e):u(n,t,e)):h(n,function(n){return++r<e?void 0:!(i=n===t)}),i}function Ot(n,t,e){var r=true;t=J.createCallback(t,e,3),e=-1;
var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&(r=!!t(n[e],e,n)););else h(n,function(n,e,u){return r=!!t(n,e,u)});return r}function Nt(n,t,e){var r=[];t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u;){var o=n[e];t(o,e,n)&&r.push(o)}else h(n,function(n,e,u){t(n,e,u)&&r.push(n)});return r}function It(n,t,e){t=J.createCallback(t,e,3),e=-1;var r=n?n.length:0;if(typeof r!="number"){var u;return h(n,function(n,e,r){return t(n,e,r)?(u=n,false):void 0}),u}for(;++e<r;){var o=n[e];
if(t(o,e,n))return o}}function St(n,t,e){var r=-1,u=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof u=="number")for(;++r<u&&false!==t(n[r],r,n););else h(n,t);return n}function Et(n,t,e){var r=n?n.length:0;if(t=t&&typeof e=="undefined"?t:tt(t,e,3),typeof r=="number")for(;r--&&false!==t(n[r],r,n););else{var u=Fe(n),r=u.length;h(n,function(n,e,o){return e=u?u[--r]:--r,t(o[e],e,o)})}return n}function Rt(n,t,e){var r=-1,u=n?n.length:0;if(t=J.createCallback(t,e,3),typeof u=="number")for(var o=Xt(u);++r<u;)o[r]=t(n[r],r,n);
else o=[],h(n,function(n,e,u){o[++r]=t(n,e,u)});return o}function At(n,t,e){var u=-1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a>o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e>u&&(u=e,o=n)});return o}function Dt(n,t,e,r){if(!n)return e;var u=3>arguments.length;t=J.createCallback(t,r,4);var o=-1,i=n.length;if(typeof i=="number")for(u&&(e=n[++o]);++o<i;)e=t(e,n[o],o,n);else h(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)
});return e}function $t(n,t,e,r){var u=3>arguments.length;return t=J.createCallback(t,r,4),Et(n,function(n,r,o){e=u?(u=false,n):t(e,n,r,o)}),e}function Tt(n){var t=-1,e=n?n.length:0,r=Xt(typeof e=="number"?e:0);return St(n,function(n){var e=at(0,++t);r[t]=r[e],r[e]=n}),r}function Ft(n,t,e){var r;t=J.createCallback(t,e,3),e=-1;var u=n?n.length:0;if(typeof u=="number")for(;++e<u&&!(r=t(n[e],e,n)););else h(n,function(n,e,u){return!(r=t(n,e,u))});return!!r}function Bt(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=-1;
for(t=J.createCallback(t,e,3);++o<u&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[0]:v;return p(n,0,Se(Ie(0,r),u))}function Wt(t,e,r){if(typeof r=="number"){var u=t?t.length:0;r=0>r?Ie(0,u+r):r||0}else if(r)return r=zt(t,e),t[r]===e?r:-1;return n(t,e,r)}function qt(n,t,e){if(typeof t!="number"&&null!=t){var r=0,u=-1,o=n?n.length:0;for(t=J.createCallback(t,e,3);++u<o&&t(n[u],u,n);)r++}else r=null==t||e?1:Ie(0,t);return p(n,r)}function zt(n,t,e,r){var u=0,o=n?n.length:u;for(e=e?J.createCallback(e,r,1):Ut,t=e(t);u<o;)r=u+o>>>1,e(n[r])<t?u=r+1:o=r;
return u}function Pt(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(e=J.createCallback(e,r,3)),ft(n,t,e)}function Kt(){for(var n=1<arguments.length?arguments:arguments[0],t=-1,e=n?At(Ve(n,"length")):0,r=Xt(0>e?0:e);++t<e;)r[t]=Ve(n,t);return r}function Lt(n,t){var e=-1,r=n?n.length:0,u={};for(t||!r||Te(n[0])||(t=[]);++e<r;){var o=n[e];t?u[o]=t[e]:o&&(u[o[0]]=o[1])}return u}function Mt(n,t){return 2<arguments.length?ct(n,17,p(arguments,2),null,t):ct(n,1,null,null,t)
}function Vt(n,t,e){function r(){c&&ve(c),i=c=p=v,(g||h!==t)&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null))}function u(){var e=t-(Ue()-f);0<e?c=_e(u,e):(i&&ve(i),e=p,i=c=p=v,e&&(s=Ue(),a=n.apply(l,o),c||i||(o=l=null)))}var o,i,a,f,l,c,p,s=0,h=false,g=true;if(!dt(n))throw new ie;if(t=Ie(0,t)||0,true===e)var y=true,g=false;else wt(e)&&(y=e.leading,h="maxWait"in e&&(Ie(t,e.maxWait)||0),g="trailing"in e?e.trailing:g);return function(){if(o=arguments,f=Ue(),l=this,p=g&&(c||!y),false===h)var e=y&&!c;else{i||y||(s=f);var v=h-(f-s),m=0>=v;
m?(i&&(i=ve(i)),s=f,a=n.apply(l,o)):i||(i=_e(r,v))}return m&&c?c=ve(c):c||t===h||(c=_e(u,t)),e&&(m=true,a=n.apply(l,o)),!m||c||i||(o=l=null),a}}function Ut(n){return n}function Gt(n,t,e){var r=true,u=t&&bt(t);t&&(e||u.length)||(null==e&&(e=t),o=Q,t=n,n=J,u=bt(t)),false===e?r=false:wt(e)&&"chain"in e&&(r=e.chain);var o=n,i=dt(o);St(u,function(e){var u=n[e]=t[e];i&&(o.prototype[e]=function(){var t=this.__chain__,e=this.__wrapped__,i=[e];if(be.apply(i,arguments),i=u.apply(n,i),r||t){if(e===i&&wt(i))return this;
i=new o(i),i.__chain__=t}return i})})}function Ht(){}function Jt(n){return function(t){return t[n]}}function Qt(){return this.__wrapped__}e=e?Y.defaults(G.Object(),e,Y.pick(G,A)):G;var Xt=e.Array,Yt=e.Boolean,Zt=e.Date,ne=e.Function,te=e.Math,ee=e.Number,re=e.Object,ue=e.RegExp,oe=e.String,ie=e.TypeError,ae=[],fe=re.prototype,le=e._,ce=fe.toString,pe=ue("^"+oe(ce).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),se=te.ceil,ve=e.clearTimeout,he=te.floor,ge=ne.prototype.toString,ye=vt(ye=re.getPrototypeOf)&&ye,me=fe.hasOwnProperty,be=ae.push,_e=e.setTimeout,de=ae.splice,we=ae.unshift,je=function(){try{var n={},t=vt(t=re.defineProperty)&&t,e=t(n,n,n)&&t
}catch(r){}return e}(),ke=vt(ke=re.create)&&ke,xe=vt(xe=Xt.isArray)&&xe,Ce=e.isFinite,Oe=e.isNaN,Ne=vt(Ne=re.keys)&&Ne,Ie=te.max,Se=te.min,Ee=e.parseInt,Re=te.random,Ae={};Ae[$]=Xt,Ae[T]=Yt,Ae[F]=Zt,Ae[B]=ne,Ae[q]=re,Ae[W]=ee,Ae[z]=ue,Ae[P]=oe,Q.prototype=J.prototype;var De=J.support={};De.funcDecomp=!vt(e.a)&&E.test(s),De.funcNames=typeof ne.name=="string",J.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:N,variable:"",imports:{_:J}},ke||(nt=function(){function n(){}return function(t){if(wt(t)){n.prototype=t;
var r=new n;n.prototype=null}return r||e.Object()}}());var $e=je?function(n,t){M.value=t,je(n,"__bindData__",M)}:Ht,Te=xe||function(n){return n&&typeof n=="object"&&typeof n.length=="number"&&ce.call(n)==$||false},Fe=Ne?function(n){return wt(n)?Ne(n):[]}:H,Be={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},We=_t(Be),qe=ue("("+Fe(We).join("|")+")","g"),ze=ue("["+Fe(Be).join("")+"]","g"),Pe=ye?function(n){if(!n||ce.call(n)!=q)return false;var t=n.valueOf,e=vt(t)&&(e=ye(t))&&ye(e);return e?n==e||ye(n)==e:ht(n)
}:ht,Ke=lt(function(n,t,e){me.call(n,e)?n[e]++:n[e]=1}),Le=lt(function(n,t,e){(me.call(n,e)?n[e]:n[e]=[]).push(t)}),Me=lt(function(n,t,e){n[e]=t}),Ve=Rt,Ue=vt(Ue=Zt.now)&&Ue||function(){return(new Zt).getTime()},Ge=8==Ee(d+"08")?Ee:function(n,t){return Ee(kt(n)?n.replace(I,""):n,t||0)};return J.after=function(n,t){if(!dt(t))throw new ie;return function(){return 1>--n?t.apply(this,arguments):void 0}},J.assign=U,J.at=function(n){for(var t=arguments,e=-1,r=ut(t,true,false,1),t=t[2]&&t[2][t[1]]===n?1:r.length,u=Xt(t);++e<t;)u[e]=n[r[e]];
return u},J.bind=Mt,J.bindAll=function(n){for(var t=1<arguments.length?ut(arguments,true,false,1):bt(n),e=-1,r=t.length;++e<r;){var u=t[e];n[u]=ct(n[u],1,null,null,n)}return n},J.bindKey=function(n,t){return 2<arguments.length?ct(t,19,p(arguments,2),null,n):ct(t,3,null,null,n)},J.chain=function(n){return n=new Q(n),n.__chain__=true,n},J.compact=function(n){for(var t=-1,e=n?n.length:0,r=[];++t<e;){var u=n[t];u&&r.push(u)}return r},J.compose=function(){for(var n=arguments,t=n.length;t--;)if(!dt(n[t]))throw new ie;
return function(){for(var t=arguments,e=n.length;e--;)t=[n[e].apply(this,t)];return t[0]}},J.constant=function(n){return function(){return n}},J.countBy=Ke,J.create=function(n,t){var e=nt(n);return t?U(e,t):e},J.createCallback=function(n,t,e){var r=typeof n;if(null==n||"function"==r)return tt(n,t,e);if("object"!=r)return Jt(n);var u=Fe(n),o=u[0],i=n[o];return 1!=u.length||i!==i||wt(i)?function(t){for(var e=u.length,r=false;e--&&(r=ot(t[u[e]],n[u[e]],null,true)););return r}:function(n){return n=n[o],i===n&&(0!==i||1/i==1/n)
}},J.curry=function(n,t){return t=typeof t=="number"?t:+t||n.length,ct(n,4,null,null,null,t)},J.debounce=Vt,J.defaults=_,J.defer=function(n){if(!dt(n))throw new ie;var t=p(arguments,1);return _e(function(){n.apply(v,t)},1)},J.delay=function(n,t){if(!dt(n))throw new ie;var e=p(arguments,2);return _e(function(){n.apply(v,e)},t)},J.difference=function(n){return rt(n,ut(arguments,true,true,1))},J.filter=Nt,J.flatten=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=typeof t!="function"&&r&&r[t]===n?null:t,t=false),null!=e&&(n=Rt(n,e,r)),ut(n,t)
},J.forEach=St,J.forEachRight=Et,J.forIn=g,J.forInRight=function(n,t,e){var r=[];g(n,function(n,t){r.push(t,n)});var u=r.length;for(t=tt(t,e,3);u--&&false!==t(r[u--],r[u],n););return n},J.forOwn=h,J.forOwnRight=mt,J.functions=bt,J.groupBy=Le,J.indexBy=Me,J.initial=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else r=null==t||e?1:t||r;return p(n,0,Se(Ie(0,u-r),u))},J.intersection=function(){for(var e=[],r=-1,u=arguments.length,i=a(),f=st(),p=f===n,s=a();++r<u;){var v=arguments[r];
(Te(v)||yt(v))&&(e.push(v),i.push(p&&v.length>=b&&o(r?e[r]:s)))}var p=e[0],h=-1,g=p?p.length:0,y=[];n:for(;++h<g;){var m=i[0],v=p[h];if(0>(m?t(m,v):f(s,v))){for(r=u,(m||s).push(v);--r;)if(m=i[r],0>(m?t(m,v):f(e[r],v)))continue n;y.push(v)}}for(;u--;)(m=i[u])&&c(m);return l(i),l(s),y},J.invert=_t,J.invoke=function(n,t){var e=p(arguments,2),r=-1,u=typeof t=="function",o=n?n.length:0,i=Xt(typeof o=="number"?o:0);return St(n,function(n){i[++r]=(u?t:n[t]).apply(n,e)}),i},J.keys=Fe,J.map=Rt,J.mapValues=function(n,t,e){var r={};
return t=J.createCallback(t,e,3),h(n,function(n,e,u){r[e]=t(n,e,u)}),r},J.max=At,J.memoize=function(n,t){function e(){var r=e.cache,u=t?t.apply(this,arguments):m+arguments[0];return me.call(r,u)?r[u]:r[u]=n.apply(this,arguments)}if(!dt(n))throw new ie;return e.cache={},e},J.merge=function(n){var t=arguments,e=2;if(!wt(n))return n;if("number"!=typeof t[2]&&(e=t.length),3<e&&"function"==typeof t[e-2])var r=tt(t[--e-1],t[e--],2);else 2<e&&"function"==typeof t[e-1]&&(r=t[--e]);for(var t=p(arguments,1,e),u=-1,o=a(),i=a();++u<e;)it(n,t[u],r,o,i);
return l(o),l(i),n},J.min=function(n,t,e){var u=1/0,o=u;if(typeof t!="function"&&e&&e[t]===n&&(t=null),null==t&&Te(n)){e=-1;for(var i=n.length;++e<i;){var a=n[e];a<o&&(o=a)}}else t=null==t&&kt(n)?r:J.createCallback(t,e,3),St(n,function(n,e,r){e=t(n,e,r),e<u&&(u=e,o=n)});return o},J.omit=function(n,t,e){var r={};if(typeof t!="function"){var u=[];g(n,function(n,t){u.push(t)});for(var u=rt(u,ut(arguments,true,false,1)),o=-1,i=u.length;++o<i;){var a=u[o];r[a]=n[a]}}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)||(r[e]=n)
});return r},J.once=function(n){var t,e;if(!dt(n))throw new ie;return function(){return t?e:(t=true,e=n.apply(this,arguments),n=null,e)}},J.pairs=function(n){for(var t=-1,e=Fe(n),r=e.length,u=Xt(r);++t<r;){var o=e[t];u[t]=[o,n[o]]}return u},J.partial=function(n){return ct(n,16,p(arguments,1))},J.partialRight=function(n){return ct(n,32,null,p(arguments,1))},J.pick=function(n,t,e){var r={};if(typeof t!="function")for(var u=-1,o=ut(arguments,true,false,1),i=wt(n)?o.length:0;++u<i;){var a=o[u];a in n&&(r[a]=n[a])
}else t=J.createCallback(t,e,3),g(n,function(n,e,u){t(n,e,u)&&(r[e]=n)});return r},J.pluck=Ve,J.property=Jt,J.pull=function(n){for(var t=arguments,e=0,r=t.length,u=n?n.length:0;++e<r;)for(var o=-1,i=t[e];++o<u;)n[o]===i&&(de.call(n,o--,1),u--);return n},J.range=function(n,t,e){n=+n||0,e=typeof e=="number"?e:+e||1,null==t&&(t=n,n=0);var r=-1;t=Ie(0,se((t-n)/(e||1)));for(var u=Xt(t);++r<t;)u[r]=n,n+=e;return u},J.reject=function(n,t,e){return t=J.createCallback(t,e,3),Nt(n,function(n,e,r){return!t(n,e,r)
})},J.remove=function(n,t,e){var r=-1,u=n?n.length:0,o=[];for(t=J.createCallback(t,e,3);++r<u;)e=n[r],t(e,r,n)&&(o.push(e),de.call(n,r--,1),u--);return o},J.rest=qt,J.shuffle=Tt,J.sortBy=function(n,t,e){var r=-1,o=Te(t),i=n?n.length:0,p=Xt(typeof i=="number"?i:0);for(o||(t=J.createCallback(t,e,3)),St(n,function(n,e,u){var i=p[++r]=f();o?i.m=Rt(t,function(t){return n[t]}):(i.m=a())[0]=t(n,e,u),i.n=r,i.o=n}),i=p.length,p.sort(u);i--;)n=p[i],p[i]=n.o,o||l(n.m),c(n);return p},J.tap=function(n,t){return t(n),n
},J.throttle=function(n,t,e){var r=true,u=true;if(!dt(n))throw new ie;return false===e?r=false:wt(e)&&(r="leading"in e?e.leading:r,u="trailing"in e?e.trailing:u),L.leading=r,L.maxWait=t,L.trailing=u,Vt(n,t,L)},J.times=function(n,t,e){n=-1<(n=+n)?n:0;var r=-1,u=Xt(n);for(t=tt(t,e,1);++r<n;)u[r]=t(r);return u},J.toArray=function(n){return n&&typeof n.length=="number"?p(n):xt(n)},J.transform=function(n,t,e,r){var u=Te(n);if(null==e)if(u)e=[];else{var o=n&&n.constructor;e=nt(o&&o.prototype)}return t&&(t=J.createCallback(t,r,4),(u?St:h)(n,function(n,r,u){return t(e,n,r,u)
})),e},J.union=function(){return ft(ut(arguments,true,true))},J.uniq=Pt,J.values=xt,J.where=Nt,J.without=function(n){return rt(n,p(arguments,1))},J.wrap=function(n,t){return ct(t,16,[n])},J.xor=function(){for(var n=-1,t=arguments.length;++n<t;){var e=arguments[n];if(Te(e)||yt(e))var r=r?ft(rt(r,e).concat(rt(e,r))):e}return r||[]},J.zip=Kt,J.zipObject=Lt,J.collect=Rt,J.drop=qt,J.each=St,J.eachRight=Et,J.extend=U,J.methods=bt,J.object=Lt,J.select=Nt,J.tail=qt,J.unique=Pt,J.unzip=Kt,Gt(J),J.clone=function(n,t,e,r){return typeof t!="boolean"&&null!=t&&(r=e,e=t,t=false),Z(n,t,typeof e=="function"&&tt(e,r,1))
},J.cloneDeep=function(n,t,e){return Z(n,true,typeof t=="function"&&tt(t,e,1))},J.contains=Ct,J.escape=function(n){return null==n?"":oe(n).replace(ze,pt)},J.every=Ot,J.find=It,J.findIndex=function(n,t,e){var r=-1,u=n?n.length:0;for(t=J.createCallback(t,e,3);++r<u;)if(t(n[r],r,n))return r;return-1},J.findKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),h(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.findLast=function(n,t,e){var r;return t=J.createCallback(t,e,3),Et(n,function(n,e,u){return t(n,e,u)?(r=n,false):void 0
}),r},J.findLastIndex=function(n,t,e){var r=n?n.length:0;for(t=J.createCallback(t,e,3);r--;)if(t(n[r],r,n))return r;return-1},J.findLastKey=function(n,t,e){var r;return t=J.createCallback(t,e,3),mt(n,function(n,e,u){return t(n,e,u)?(r=e,false):void 0}),r},J.has=function(n,t){return n?me.call(n,t):false},J.identity=Ut,J.indexOf=Wt,J.isArguments=yt,J.isArray=Te,J.isBoolean=function(n){return true===n||false===n||n&&typeof n=="object"&&ce.call(n)==T||false},J.isDate=function(n){return n&&typeof n=="object"&&ce.call(n)==F||false
},J.isElement=function(n){return n&&1===n.nodeType||false},J.isEmpty=function(n){var t=true;if(!n)return t;var e=ce.call(n),r=n.length;return e==$||e==P||e==D||e==q&&typeof r=="number"&&dt(n.splice)?!r:(h(n,function(){return t=false}),t)},J.isEqual=function(n,t,e,r){return ot(n,t,typeof e=="function"&&tt(e,r,2))},J.isFinite=function(n){return Ce(n)&&!Oe(parseFloat(n))},J.isFunction=dt,J.isNaN=function(n){return jt(n)&&n!=+n},J.isNull=function(n){return null===n},J.isNumber=jt,J.isObject=wt,J.isPlainObject=Pe,J.isRegExp=function(n){return n&&typeof n=="object"&&ce.call(n)==z||false
},J.isString=kt,J.isUndefined=function(n){return typeof n=="undefined"},J.lastIndexOf=function(n,t,e){var r=n?n.length:0;for(typeof e=="number"&&(r=(0>e?Ie(0,r+e):Se(e,r-1))+1);r--;)if(n[r]===t)return r;return-1},J.mixin=Gt,J.noConflict=function(){return e._=le,this},J.noop=Ht,J.now=Ue,J.parseInt=Ge,J.random=function(n,t,e){var r=null==n,u=null==t;return null==e&&(typeof n=="boolean"&&u?(e=n,n=1):u||typeof t!="boolean"||(e=t,u=true)),r&&u&&(t=1),n=+n||0,u?(t=n,n=0):t=+t||0,e||n%1||t%1?(e=Re(),Se(n+e*(t-n+parseFloat("1e-"+((e+"").length-1))),t)):at(n,t)
},J.reduce=Dt,J.reduceRight=$t,J.result=function(n,t){if(n){var e=n[t];return dt(e)?n[t]():e}},J.runInContext=s,J.size=function(n){var t=n?n.length:0;return typeof t=="number"?t:Fe(n).length},J.some=Ft,J.sortedIndex=zt,J.template=function(n,t,e){var r=J.templateSettings;n=oe(n||""),e=_({},e,r);var u,o=_({},e.imports,r.imports),r=Fe(o),o=xt(o),a=0,f=e.interpolate||S,l="__p+='",f=ue((e.escape||S).source+"|"+f.source+"|"+(f===N?x:S).source+"|"+(e.evaluate||S).source+"|$","g");n.replace(f,function(t,e,r,o,f,c){return r||(r=o),l+=n.slice(a,c).replace(R,i),e&&(l+="'+__e("+e+")+'"),f&&(u=true,l+="';"+f+";\n__p+='"),r&&(l+="'+((__t=("+r+"))==null?'':__t)+'"),a=c+t.length,t
}),l+="';",f=e=e.variable,f||(e="obj",l="with("+e+"){"+l+"}"),l=(u?l.replace(w,""):l).replace(j,"$1").replace(k,"$1;"),l="function("+e+"){"+(f?"":e+"||("+e+"={});")+"var __t,__p='',__e=_.escape"+(u?",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,'')}":";")+l+"return __p}";try{var c=ne(r,"return "+l).apply(v,o)}catch(p){throw p.source=l,p}return t?c(t):(c.source=l,c)},J.unescape=function(n){return null==n?"":oe(n).replace(qe,gt)},J.uniqueId=function(n){var t=++y;return oe(null==n?"":n)+t
},J.all=Ot,J.any=Ft,J.detect=It,J.findWhere=It,J.foldl=Dt,J.foldr=$t,J.include=Ct,J.inject=Dt,Gt(function(){var n={};return h(J,function(t,e){J.prototype[e]||(n[e]=t)}),n}(),false),J.first=Bt,J.last=function(n,t,e){var r=0,u=n?n.length:0;if(typeof t!="number"&&null!=t){var o=u;for(t=J.createCallback(t,e,3);o--&&t(n[o],o,n);)r++}else if(r=t,null==r||e)return n?n[u-1]:v;return p(n,Ie(0,u-r))},J.sample=function(n,t,e){return n&&typeof n.length!="number"&&(n=xt(n)),null==t||e?n?n[at(0,n.length-1)]:v:(n=Tt(n),n.length=Se(Ie(0,t),n.length),n)
},J.take=Bt,J.head=Bt,h(J,function(n,t){var e="sample"!==t;J.prototype[t]||(J.prototype[t]=function(t,r){var u=this.__chain__,o=n(this.__wrapped__,t,r);return u||null!=t&&(!r||e&&typeof t=="function")?new Q(o,u):o})}),J.VERSION="2.4.1",J.prototype.chain=function(){return this.__chain__=true,this},J.prototype.toString=function(){return oe(this.__wrapped__)},J.prototype.value=Qt,J.prototype.valueOf=Qt,St(["join","pop","shift"],function(n){var t=ae[n];J.prototype[n]=function(){var n=this.__chain__,e=t.apply(this.__wrapped__,arguments);
return n?new Q(e,n):e}}),St(["push","reverse","sort","unshift"],function(n){var t=ae[n];J.prototype[n]=function(){return t.apply(this.__wrapped__,arguments),this}}),St(["concat","slice","splice"],function(n){var t=ae[n];J.prototype[n]=function(){return new Q(t.apply(this.__wrapped__,arguments),this.__chain__)}}),J}var v,h=[],g=[],y=0,m=+new Date+"",b=75,_=40,d=" \t\x0B\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",w=/\b__p\+='';/g,j=/\b(__p\+=)''\+/g,k=/(__e\(.*?\)|\b__t\))\+'';/g,x=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,O=/^\s*function[ \n\r\t]+\w/,N=/<%=([\s\S]+?)%>/g,I=RegExp("^["+d+"]*0+(?=.$)"),S=/($^)/,E=/\bthis\b/,R=/['\n\r\t\u2028\u2029\\]/g,A="Array Boolean Date Function Math Number Object RegExp String _ attachEvent clearTimeout isFinite isNaN parseInt setTimeout".split(" "),D="[object Arguments]",$="[object Array]",T="[object Boolean]",F="[object Date]",B="[object Function]",W="[object Number]",q="[object Object]",z="[object RegExp]",P="[object String]",K={};
K[B]=false,K[D]=K[$]=K[T]=K[F]=K[W]=K[q]=K[z]=K[P]=true;var L={leading:false,maxWait:0,trailing:false},M={configurable:false,enumerable:false,value:null,writable:false},V={"boolean":false,"function":true,object:true,number:false,string:false,undefined:false},U={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},G=V[typeof window]&&window||this,H=V[typeof exports]&&exports&&!exports.nodeType&&exports,J=V[typeof module]&&module&&!module.nodeType&&module,Q=J&&J.exports===H&&H,X=V[typeof global]&&global;!X||X.global!==X&&X.window!==X||(G=X);
var Y=s();G._=Y}).call(this);
!function(){function e(e){return e.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," ").replace(/[.(),;:!?%#$'"_+=\/-]*/g,"")}jQuery.validator.addMethod("maxWords",function(t,a,d){return this.optional(a)||e(t).match(/\b\w+\b/g).length<=d},jQuery.validator.format("Please enter {0} words or less.")),jQuery.validator.addMethod("minWords",function(t,a,d){return this.optional(a)||e(t).match(/\b\w+\b/g).length>=d},jQuery.validator.format("Please enter at least {0} words.")),jQuery.validator.addMethod("rangeWords",function(t,a,d){var u=e(t),r=/\b\w+\b/g;return this.optional(a)||u.match(r).length>=d[0]&&u.match(r).length<=d[1]},jQuery.validator.format("Please enter between {0} and {1} words."))}(),jQuery.validator.addMethod("letterswithbasicpunc",function(e,t){return this.optional(t)||/^[a-z\-.,()'\"\s]+$/i.test(e)},"Letters or punctuation only please"),jQuery.validator.addMethod("alphanumeric",function(e,t){return this.optional(t)||/^\w+$/i.test(e)},"Letters, numbers, and underscores only please"),jQuery.validator.addMethod("lettersonly",function(e,t){return this.optional(t)||/^[a-z]+$/i.test(e)},"Letters only please"),jQuery.validator.addMethod("nowhitespace",function(e,t){return this.optional(t)||/^\S+$/i.test(e)},"No white space please"),jQuery.validator.addMethod("ziprange",function(e,t){return this.optional(t)||/^90[2-5]\d\{2\}-\d{4}$/.test(e)},"Your ZIP-code must be in the range 902xx-xxxx to 905-xx-xxxx"),jQuery.validator.addMethod("zipcodeUS",function(e,t){return this.optional(t)||/\d{5}-\d{4}$|^\d{5}$/.test(e)},"The specified US ZIP Code is invalid"),jQuery.validator.addMethod("integer",function(e,t){return this.optional(t)||/^-?\d+$/.test(e)},"A positive or negative non-decimal number please"),jQuery.validator.addMethod("vinUS",function(e){if(17!=e.length)return!1;var t,a,d,u,r,F,i=["A","B","C","D","E","F","G","H","J","K","L","M","N","P","R","S","T","U","V","W","X","Y","Z"],n=[1,2,3,4,5,6,7,8,1,2,3,4,5,7,9,2,3,4,5,6,7,8,9],o=[8,7,6,5,4,3,2,10,0,9,8,7,6,5,4,3,2],l=0;for(t=0;17>t;t++){if(u=o[t],d=e.slice(t,t+1),8==t&&(F=d),isNaN(d)){for(a=0;a<i.length;a++)if(d.toUpperCase()===i[a]){d=n[a],d*=u,isNaN(F)&&8==a&&(F=i[a]);break}}else d*=u;l+=d}return r=l%11,10==r&&(r="X"),r==F?!0:!1},"The specified vehicle identification number (VIN) is invalid."),jQuery.validator.addMethod("dateITA",function(e,t){var a=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/;if(d.test(e)){var u=e.split("/"),r=parseInt(u[0],10),F=parseInt(u[1],10),i=parseInt(u[2],10),n=new Date(i,F-1,r);a=n.getFullYear()==i&&n.getMonth()==F-1&&n.getDate()==r?!0:!1}else a=!1;return this.optional(t)||a},"Please enter a correct date"),jQuery.validator.addMethod("dateNL",function(e,t){return this.optional(t)||/^\d\d?[\.\/-]\d\d?[\.\/-]\d\d\d?\d?$/.test(e)},"Vul hier een geldige datum in."),jQuery.validator.addMethod("time",function(e,t){return this.optional(t)||/^([0-1]\d|2[0-3]):([0-5]\d)$/.test(e)},"Please enter a valid time, between 00:00 and 23:59"),jQuery.validator.addMethod("time12h",function(e,t){return this.optional(t)||/^((0?[1-9]|1[012])(:[0-5]\d){0,2}(\ [AP]M))$/i.test(e)},"Please enter a valid time, between 00:00 am and 12:00 pm"),jQuery.validator.addMethod("phoneUS",function(e,t){return e=e.replace(/\s+/g,""),this.optional(t)||e.length>9&&e.match(/^(\+?1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/)},"Please specify a valid phone number"),jQuery.validator.addMethod("phoneUK",function(e,t){return e=e.replace(/\(|\)|\s+|-/g,""),this.optional(t)||e.length>9&&e.match(/^(?:(?:(?:00\s?|\+)44\s?)|(?:\(?0))(?:(?:\d{5}\)?\s?\d{4,5})|(?:\d{4}\)?\s?(?:\d{5}|\d{3}\s?\d{3}))|(?:\d{3}\)?\s?\d{3}\s?\d{3,4})|(?:\d{2}\)?\s?\d{4}\s?\d{4}))$/)},"Please specify a valid phone number"),jQuery.validator.addMethod("mobileUK",function(e,t){return e=e.replace(/\s+|-/g,""),this.optional(t)||e.length>9&&e.match(/^(?:(?:(?:00\s?|\+)44\s?|0)7(?:[45789]\d{2}|624)\s?\d{3}\s?\d{3})$/)},"Please specify a valid mobile number"),jQuery.validator.addMethod("phonesUK",function(e,t){return e=e.replace(/\s+|-/g,""),this.optional(t)||e.length>9&&e.match(/^(?:(?:(?:00\s?|\+)44\s?|0)(?:1\d{8,9}|[23]\d{9}|7(?:[45789]\d{8}|624\d{6})))$/)},"Please specify a valid uk phone number"),jQuery.validator.addMethod("postcodeUK",function(e,t){return e=e.toUpperCase().replace(/\s+/g,""),this.optional(t)||e.match(/^([^QZ][^IJZ]{0,1}\d{1,2})(\d[^CIKMOV]{2})$/)||e.match(/^([^QV]\d[ABCDEFGHJKSTUW])(\d[^CIKMOV]{2})$/)||e.match(/^([^QV][^IJZ]\d[ABEHMNPRVWXY])(\d[^CIKMOV]{2})$/)||e.match(/^(GIR)(0AA)$/)||e.match(/^(BFPO)(\d{1,4})$/)||e.match(/^(BFPO)(C\/O\d{1,3})$/)},"Please specify a valid postcode"),jQuery.validator.addMethod("strippedminlength",function(e,t,a){return jQuery(e).text().length>=a},jQuery.validator.format("Please enter at least {0} characters")),jQuery.validator.addMethod("email2",function(e,t){return this.optional(t)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(e)},jQuery.validator.messages.email),jQuery.validator.addMethod("url2",function(e,t){return this.optional(t)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)*(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(e)},jQuery.validator.messages.url),jQuery.validator.addMethod("creditcardtypes",function(e,t,a){if(/[^0-9-]+/.test(e))return!1;e=e.replace(/\D/g,"");var d=0;return a.mastercard&&(d|=1),a.visa&&(d|=2),a.amex&&(d|=4),a.dinersclub&&(d|=8),a.enroute&&(d|=16),a.discover&&(d|=32),a.jcb&&(d|=64),a.unknown&&(d|=128),a.all&&(d=255),1&d&&/^(5[12345])/.test(e)?16==e.length:2&d&&/^(4)/.test(e)?16==e.length:4&d&&/^(3[47])/.test(e)?15==e.length:8&d&&/^(3(0[012345]|[68]))/.test(e)?14==e.length:16&d&&/^(2(014|149))/.test(e)?15==e.length:32&d&&/^(6011)/.test(e)?16==e.length:64&d&&/^(3)/.test(e)?16==e.length:64&d&&/^(2131|1800)/.test(e)?15==e.length:128&d?!0:!1},"Please enter a valid credit card number."),jQuery.validator.addMethod("ipv4",function(e,t){return this.optional(t)||/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(e)},"Please enter a valid IP v4 address."),jQuery.validator.addMethod("ipv6",function(e,t){return this.optional(t)||/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(e)},"Please enter a valid IP v6 address."),jQuery.validator.addMethod("pattern",function(e,t,a){return this.optional(t)?!0:("string"==typeof a&&(a=new RegExp("^(?:"+a+")$")),a.test(e))},"Invalid format."),jQuery.validator.addMethod("require_from_group",function(e,t,a){var d=this,u=a[1],r=$(u,t.form).filter(function(){return d.elementValue(this)}).length>=a[0];if(!$(t).data("being_validated")){var F=$(u,t.form);F.data("being_validated",!0),F.valid(),F.data("being_validated",!1)}return r},jQuery.format("Please fill at least {0} of these fields.")),jQuery.validator.addMethod("skip_or_fill_minimum",function(e,t,a){var d=this;numberRequired=a[0],selector=a[1];var u=$(selector,t.form).filter(function(){return d.elementValue(this)}).length,r=u>=numberRequired||0===u;if(!$(t).data("being_validated")){var F=$(selector,t.form);F.data("being_validated",!0),F.valid(),F.data("being_validated",!1)}return r},jQuery.format("Please either skip these fields or fill at least {0} of them.")),jQuery.validator.addMethod("accept",function(e,t,a){var d,u,r="string"==typeof a?a.replace(/,/g,"|"):"image/*",F=this.optional(t);if(F)return F;if("file"===$(t).attr("type")&&(r=r.replace("*",".*"),t.files&&t.files.length))for(d=0;d<t.files.length;d++)if(u=t.files[d],!u.type.match(new RegExp(".?("+r+")$","i")))return!1;return!0},jQuery.format("Please enter a value with a valid mimetype.")),jQuery.validator.addMethod("extension",function(e,t,a){return a="string"==typeof a?a.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(t)||e.match(new RegExp(".("+a+")$","i"))},jQuery.format("Please enter a value with a valid extension."));
/*! undermore - v1.7.0 - 2014-06-25
* https://github.com/atomantic/undermore
* Copyright (c) 2014 Adam Eivy (@antic); Licensed MIT */
!function(a){"use strict";var b=a._,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";b.mixin({base64_decode:function(a){if(atob)return b.utf8_decode(atob(a));if(Buffer)return new Buffer(a,"base64").toString("binary");a=a.replace(/=+$/,"");for(var d,e,f=0,g=0,h="";e=a.charAt(g++);~e&&(d=f%4?64*d+e:e,f++%4)?h+=String.fromCharCode(255&d>>(-2*f&6)):0)e=c.indexOf(e);return h},base64_encode:function(a){if(btoa)return btoa(b.utf8_encode(a));if(Buffer){var d=a instanceof Buffer?a:new Buffer(a.toString(),"binary");return d.toString("base64")}for(var e,f,g=0,h=c,i="";a.charAt(0|g)||(h="=",g%1);i+=h.charAt(63&e>>8-g%1*8))f=a.charCodeAt(g+=.75),e=e<<8|f;return i},eFn:function(a){a.preventDefault()},fn:function(){return!0},fnMore:function(a,b,c){return c?function(){a.apply(c,arguments),b.apply(c,arguments)}:function(){a(),b()}},get:function(a,c,d){return"string"==typeof c&&(c=c.split(".")),void 0===a?d:0===c.length?a:null===a?d:b.get(a[b.first(c)],b.rest(c),d)},getQuery:function(){var a,c=function(){a={};var c=function(a){return a&&a.length>0?a.replace(/^\?/,"").split("&"):[]}(window.location.search);b.map(c,function(b){var c=b.split("=");2===c.length&&(a[c[0]]=c[1])})};return function(b,d){return"undefined"==typeof a&&c(),"undefined"==typeof b?a:"undefined"==typeof a[b]?d:a[b]}}(),isValidDate:function(a){return b.isDate(a)&&!b.isNaN(a.valueOf())},ord:function(a){var b=["th","st","nd","rd"],c=a%100;return b[(c-20)%10]||b[c]||b[0]},set:function(a,b,c){"string"==typeof b&&(b=b.split("."));for(var d=a,e=b.length-1,f=0;e>f;f++)("undefined"==typeof d[b[f]]||null===d[b[f]])&&(d[b[f]]={}),d=d[b[f]];return d[b[e]]=c,a},utf8_decode:function(a){return decodeURIComponent(escape(a))},utf8_encode:function(a){return unescape(encodeURIComponent(a))},uuid:function(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===b?c:3&c|8).toString(16)})},version:function(a,b,c){var d=-1!==b.indexOf("="),e=/\+.*$/;if(a=a.replace(e),c=c.replace(e),d&&a===c)return!0;var f,g,h,i,j=/^(\d+).(\d+).(\d+)(?:-([a-z0-9.]+))?/i,k=a.match(j),l=c.match(j),m=k[4],n=l[4];for(f=1;4>f;f++)if(g=parseInt(k[f],10)||0,h=parseInt(l[f],10)||0,g!==h){i=!0;break}if(i||(m||(g=1/0,n&&(h=0,i=!0)),n||(h=1/0,m&&(g=0,i=!0)),m||n||(i=!0)),!i){var o=m.split("."),p=n.split("."),q=o.length,r=p.length,s=q>r?q:r;for(f=0;s>f&&(g=f>=q?-1:parseInt(o[f],10)||o[f].charCodeAt(),h=f>=r?-1:parseInt(p[f],10)||p[f].charCodeAt(),g===h);f++);}return d&&g===h||-1!==b.indexOf(">")&&g>h||-1!==b.indexOf("<")&&h>g?!0:!1}})}("object"==typeof exports&&exports||this);

!function(e,n,o){function r(e){return e}function t(e){return decodeURIComponent(e.replace(i," "))}var i=/\+/g,u=e.cookie=function(i,a,s){if(a!==o){if(s=e.extend({},u.defaults,s),null===a&&(s.expires=-1),"number"==typeof s.expires){var p=s.expires,c=s.expires=new Date;c.setDate(c.getDate()+p)}return a=u.json?JSON.stringify(a):String(a),n.cookie=[encodeURIComponent(i),"=",u.raw?a:encodeURIComponent(a),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}for(var f=u.raw?r:t,l=n.cookie.split("; "),d=0,m=l.length;m>d;d++){var x=l[d].split("=");if(f(x.shift())===i){var g=f(x.join("="));return u.json?JSON.parse(g):g}}return null};u.defaults={},e.removeCookie=function(n,o){return null!==e.cookie(n)?(e.cookie(n,null,o),!0):!1}}(jQuery,document);
(function(a,b){if(typeof exports==="object"&&exports){b(exports)}else{var c={};b(c);if(typeof define==="function"&&define.amd){define(c)}else{a.Mustache=c}}}(this,function(a){var e=/\s*/;var l=/\s+/;var j=/\S/;var h=/\s*=/;var n=/\s*\}/;var t=/#|\^|\/|>|\{|&|=|!/;var f=RegExp.prototype.test;function s(z,y){return f.call(z,y)}function g(y){return !s(j,y)}var v=Object.prototype.toString;var k=Array.isArray||function(y){return v.call(y)==="[object Array]"};function d(y){return y.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function m(y){return String(y).replace(/[&<>"'\/]/g,function(z){return c[z]})}function u(y){this.string=y;this.tail=y;this.pos=0}u.prototype.eos=function(){return this.tail===""};u.prototype.scan=function(z){var y=this.tail.match(z);if(y&&y.index===0){this.tail=this.tail.substring(y[0].length);this.pos+=y[0].length;return y[0]}return""};u.prototype.scanUntil=function(z){var y,A=this.tail.search(z);switch(A){case -1:y=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:y="";break;default:y=this.tail.substring(0,A);this.tail=this.tail.substring(A);this.pos+=A}return y};function r(y,z){this.view=y||{};this.parent=z;this._cache={}}r.make=function(y){return(y instanceof r)?y:new r(y)};r.prototype.push=function(y){return new r(y,this)};r.prototype.lookup=function(y){var B=this._cache[y];if(!B){if(y=="."){B=this.view}else{var A=this;while(A){if(y.indexOf(".")>0){B=A.view;var C=y.split("."),z=0;while(B&&z<C.length){B=B[C[z++]]}}else{B=A.view[y]}if(B!=null){break}A=A.parent}}this._cache[y]=B}if(typeof B==="function"){B=B.call(this.view)}return B};function p(){this.clearCache()}p.prototype.clearCache=function(){this._cache={};this._partialCache={}};p.prototype.compile=function(A,y){var z=this._cache[A];if(!z){var B=a.parse(A,y);z=this._cache[A]=this.compileTokens(B,A)}return z};p.prototype.compilePartial=function(z,B,y){var A=this.compile(B,y);this._partialCache[z]=A;return A};p.prototype.getPartial=function(y){if(!(y in this._partialCache)&&this._loadPartial){this.compilePartial(y,this._loadPartial(y))}return this._partialCache[y]};p.prototype.compileTokens=function(A,z){var y=this;return function(B,D){if(D){if(typeof D==="function"){y._loadPartial=D}else{for(var C in D){y.compilePartial(C,D[C])}}}return o(A,y,r.make(B),z)}};p.prototype.render=function(A,y,z){return this.compile(A)(y,z)};function o(F,z,y,I){var C="";var A,G,H;for(var D=0,E=F.length;D<E;++D){A=F[D];G=A[1];switch(A[0]){case"#":H=y.lookup(G);if(typeof H==="object"){if(k(H)){for(var B=0,K=H.length;B<K;++B){C+=o(A[4],z,y.push(H[B]),I)}}else{if(H){C+=o(A[4],z,y.push(H),I)}}}else{if(typeof H==="function"){var J=I==null?null:I.slice(A[3],A[5]);H=H.call(y.view,J,function(L){return z.render(L,y)});if(H!=null){C+=H}}else{if(H){C+=o(A[4],z,y,I)}}}break;case"^":H=y.lookup(G);if(!H||(k(H)&&H.length===0)){C+=o(A[4],z,y,I)}break;case">":H=z.getPartial(G);if(typeof H==="function"){C+=H(y)}break;case"&":H=y.lookup(G);if(H!=null){C+=H}break;case"name":H=y.lookup(G);if(H!=null){C+=a.escape(H)}break;case"text":C+=G;break}}return C}function x(E){var z=[];var D=z;var F=[];var B;for(var A=0,y=E.length;A<y;++A){B=E[A];switch(B[0]){case"#":case"^":F.push(B);D.push(B);D=B[4]=[];break;case"/":var C=F.pop();C[5]=B[2];D=F.length>0?F[F.length-1][4]:z;break;default:D.push(B)}}return z}function b(D){var A=[];var C,z;for(var B=0,y=D.length;B<y;++B){C=D[B];if(C){if(C[0]==="text"&&z&&z[0]==="text"){z[1]+=C[1];z[3]=C[3]}else{z=C;A.push(C)}}}return A}function q(y){return[new RegExp(d(y[0])+"\\s*"),new RegExp("\\s*"+d(y[1]))]}function w(O,E){O=O||"";E=E||a.tags;if(typeof E==="string"){E=E.split(l)}if(E.length!==2){throw new Error("Invalid tags: "+E.join(", "))}var I=q(E);var A=new u(O);var G=[];var F=[];var D=[];var P=false;var N=false;function M(){if(P&&!N){while(D.length){delete F[D.pop()]}}else{D=[]}P=false;N=false}var B,z,H,J,C;while(!A.eos()){B=A.pos;H=A.scanUntil(I[0]);if(H){for(var K=0,L=H.length;K<L;++K){J=H.charAt(K);if(g(J)){D.push(F.length)}else{N=true}F.push(["text",J,B,B+1]);B+=1;if(J=="\n"){M()}}}if(!A.scan(I[0])){break}P=true;z=A.scan(t)||"name";A.scan(e);if(z==="="){H=A.scanUntil(h);A.scan(h);A.scanUntil(I[1])}else{if(z==="{"){H=A.scanUntil(new RegExp("\\s*"+d("}"+E[1])));A.scan(n);A.scanUntil(I[1]);z="&"}else{H=A.scanUntil(I[1])}}if(!A.scan(I[1])){throw new Error("Unclosed tag at "+A.pos)}C=[z,H,B,A.pos];F.push(C);if(z==="#"||z==="^"){G.push(C)}else{if(z==="/"){if(G.length===0){throw new Error('Unopened section "'+H+'" at '+B)}var y=G.pop();if(y[1]!==H){throw new Error('Unclosed section "'+y[1]+'" at '+B)}}else{if(z==="name"||z==="{"||z==="&"){N=true}else{if(z==="="){E=H.split(l);if(E.length!==2){throw new Error("Invalid tags at "+B+": "+E.join(", "))}I=q(E)}}}}}var y=G.pop();if(y){throw new Error('Unclosed section "'+y[1]+'" at '+A.pos)}F=b(F);return x(F)}a.name="mustache.js";a.version="0.7.2";a.tags=["{{","}}"];a.Scanner=u;a.Context=r;a.Writer=p;a.parse=w;a.escape=m;var i=new p();a.clearCache=function(){return i.clearCache()};a.compile=function(z,y){return i.compile(z,y)};a.compilePartial=function(z,A,y){return i.compilePartial(z,A,y)};a.compileTokens=function(z,y){return i.compileTokens(z,y)};a.render=function(A,y,z){return i.render(A,y,z)};a.to_html=function(B,z,A,C){var y=a.render(B,z,A);if(typeof C==="function"){C(y)}else{return y}}}));
!function(e){function t(e){for(var t=e.offsetLeft,a=e.offsetTop;e.offsetParent&&e!=document.getElementsByTagName("body")[0];)t+=e.offsetParent.offsetLeft,a+=e.offsetParent.offsetTop,e=e.offsetParent;var l=[t,a];return l}e.infoBubble=function(a,l){this.init=function(a,l){l=e.extend({},e.infoBubble.defaultOptions,l);var i=e(a),n=i.offset().left,s=i.height(),o=i.offset().top,r=i.width(),d=i.children(".alertblock");if(l.placement=l.placement||i.data("alert-side"),"undefined"==typeof l.type&&(l.type="info"),$container=null,$container=i.is("input, select")?i.closest(".control-group, .messagetarget"):i,!$container.hasClass("alertblock-container-"+l.type)){if(l.manualOffsetY&&(o+=l.manualOffsetY),l.manualOffsetX&&(n+=l.manualOffsetX),l.anyClickHide?$container.addClass("hideonanyclick"):l.stickyAlert&&$container.addClass("persistalert"),"undefined"==typeof l.placement&&(l.placement="top"),d=0==d.length?e('<div class="alertblock"></div>'):d.clone(!0),l.alertAttributes&&d.attr(l.alertAttributes),"undefined"!=typeof l.addClass&&d.addClass(l.addClass),e("body").append(d),!d.is(":visible")){"undefined"!=typeof l.message&&null!=l.message&&(d.data("orig-html",d.html()),d.html(l.message),l.noAccessibleMessage||"error"!==l.type||Accessibility.validation.link(i[0],l.message));for(var c=0;5>=c;c++)if("top"===l.placement&&o-d.outerHeight()<0)l.placement="bottom";else if("top"===l.placement&&n+d.outerWidth()>window.innerWidth)l.placement="left";else if("right"===l.placement&&n+d.outerWidth()>window.innerWidth)l.placement="left";else if("left"===l.placement&&n-d.outerWidth()<0)l.placement="right";else{if(!("bottom"===l.placement&&o+d.outerHeight()>window.innerHeight))break;l.placement="top"}d.removeClass("top right left bottom"),d.show().css({visibility:"hidden"}),d.addClass("alertblock alertblock-"+l.type+" "+l.type+" "+l.placement),d.data("type",l.type),$container.addClass("alertblock-container-"+l.type),"undefined"==typeof i.attr("id")&&"undefined"!=typeof $container.attr("id")&&(i=$container),i.addClass("alert-element"),i.data("type",l.type);var f=d.outerWidth(),b=d.outerHeight();d.css({top:o+"px"});var p={};switch(l.placement){case"left":var u=n-f-20;p={left:u+"px",top:o-b/4-5+"px"},!0===l.debug&&(i.children("#alertside").html("data-alert-side:left"),i.data("alert-side","top"));break;case"right":var u=n+r-3;p={left:u+"px",top:o-b/4+"px"},!0===l.debug&&(i.children("#alertside").html("data-alert-side:right"),i.data("alert-side","bottom"));break;case"bottom":var h=o+s+5;p={top:h+"px",left:n+8+"px"},!0===l.debug&&(i.children("#alertside").html("data-alert-side:bottom"),i.data("alert-side","left"));break;case"top":var h=o-b-15;p={top:h+"px",left:n+8+"px"},!0===l.debug&&(i.children("#alertside").html("data-alert-side:top"),i.data("alert-side","right"))}d.css({visibility:"visible"}).hide().css(p).fadeIn(100,function(){var a=t(d[0]),n=a[1];$bubblearrow=e('<span class="bubblearrow"></span>');var o=0;switch(l.manualArrowOffsetX&&(o=l.manualArrowOffsetX),l.placement){case"left":a=t(i[0]);var r=a[1],c=r-n,p=c+s/4-2;0>c&&(p=5),$bubblearrow.css({top:p+"px",left:f-3+"px"}).addClass("left");break;case"right":$bubblearrow.css({top:b/4+5+"px",left:"-12px"}).addClass("right");break;case"top":$bubblearrow.css({top:b-3+"px",left:"15px"}).addClass("top");break;case"bottom":var p=n-13;p>r+s?p=n-r+s/4-2:p-=n,$bubblearrow.css({top:p+"px",left:15+o+"px"}).addClass("bottom")}$bubblearrow.addClass(l.type),d.append($bubblearrow)})}var m=d.clone(!0).css({display:"",visibility:"",top:"",left:"",opacity:""}).addClass("small-screen-alert").removeClass("alertblock"),y=!1;i.siblings(".small-screen-alert").each(function(){e(this).text()===d.text()&&(y=!0)}),y||(i.is("input, select, button")?i.parent().append(m):i.append(m));var v="undefined"!=typeof i.attr("id")?""+i.attr("id"):i.attr("name");d.addClass("alertblock-"+v),d.data("for",v),i.data("type",l.type),$container.hasClass("persistalert")||(l.hideOnFocus&&$container.children("input, select, button").focus(function(){e.infoBubble.hide(this)}),$container.hasClass("hideonanyclick")&&l.hideOnFocus&&e("body").one("mouseup",function(){window.mouseDown=0,e(".hideonanyclick .alert-element, .hideonanyclick.alert-element").each(function(){e.infoBubble.hide(this)})})),l.hideOnMouseup&&d.one("mouseup",function(){e.infoBubble.hide(this)}),l.hideOnFocus&&i.on("focus",function(){e.infoBubble.hide(this)}),l.hideOnBlur&&i.on("blur",function(){e.infoBubble.hide(this)})}},this.init(a,l)},e.infoBubble.hide=function(t,a){var l=e(t);l.hasClass("alertblock")&&(l=e("#"+l.data("for"))),l.removeClass("alert-element");var a=a?a:100,i=l.data("type"),n=null;n=l.hasClass("alertblock-container-"+i)?l:l.parents(".alertblock-container-"+i).first(),l.is("button")?n.parent().find(".small-screen-alert").remove():n.find(".small-screen-alert").remove(),n.removeClass("alertblock-container-"+i+" "+i),l.siblings(".bubblearrow").fadeOut(a),e(".alertblock-"+l.attr("id")).fadeOut(a,function(){return e(this).removeClass(i+" alertblock-"+i),e(this).siblings(".bubblearrow").remove(),"undefined"!=typeof e(this).data("orig-html")&&""!=e(this).data("orig-html")?void e(this).html(e(this).data("orig-html")):void e(this).remove()})},e.infoBubble.hideAll=function(){$alerts=e(".alertblock"),$alerts.each(function(){e.infoBubble.hide(this,0)})},e.fn.infoBubble=function(t){return new e.infoBubble(e(this),t)},e.infoBubble.defaultOptions={hideOnBlur:!1,hideOnFocus:!0,hideOnMouseup:!0}}(jQuery);
/*
 RequireJS 2.1.9 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details
*/
var requirejs,require,define;
(function(Z){function H(b){return"[object Function]"===L.call(b)}function I(b){return"[object Array]"===L.call(b)}function y(b,c){if(b){var e;for(e=0;e<b.length&&(!b[e]||!c(b[e],e,b));e+=1);}}function M(b,c){if(b){var e;for(e=b.length-1;-1<e&&(!b[e]||!c(b[e],e,b));e-=1);}}function t(b,c){return ga.call(b,c)}function l(b,c){return t(b,c)&&b[c]}function F(b,c){for(var e in b)if(t(b,e)&&c(b[e],e))break}function Q(b,c,e,h){c&&F(c,function(c,j){if(e||!t(b,j))h&&"string"!==typeof c?(b[j]||(b[j]={}),Q(b[j],
c,e,h)):b[j]=c});return b}function u(b,c){return function(){return c.apply(b,arguments)}}function aa(b){throw b;}function ba(b){if(!b)return b;var c=Z;y(b.split("."),function(b){c=c[b]});return c}function A(b,c,e,h){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+b);c.requireType=b;c.requireModules=h;e&&(c.originalError=e);return c}function ha(b){function c(a,f,b){var d,m,c,g,e,h,j,i=f&&f.split("/");d=i;var n=k.map,p=n&&n["*"];if(a&&"."===a.charAt(0))if(f){d=l(k.pkgs,f)?i=[f]:i.slice(0,i.length-
1);f=a=d.concat(a.split("/"));for(d=0;f[d];d+=1)if(m=f[d],"."===m)f.splice(d,1),d-=1;else if(".."===m)if(1===d&&(".."===f[2]||".."===f[0]))break;else 0<d&&(f.splice(d-1,2),d-=2);d=l(k.pkgs,f=a[0]);a=a.join("/");d&&a===f+"/"+d.main&&(a=f)}else 0===a.indexOf("./")&&(a=a.substring(2));if(b&&n&&(i||p)){f=a.split("/");for(d=f.length;0<d;d-=1){c=f.slice(0,d).join("/");if(i)for(m=i.length;0<m;m-=1)if(b=l(n,i.slice(0,m).join("/")))if(b=l(b,c)){g=b;e=d;break}if(g)break;!h&&(p&&l(p,c))&&(h=l(p,c),j=d)}!g&&
h&&(g=h,e=j);g&&(f.splice(0,e,g),a=f.join("/"))}return a}function e(a){z&&y(document.getElementsByTagName("script"),function(f){if(f.getAttribute("data-requiremodule")===a&&f.getAttribute("data-requirecontext")===i.contextName)return f.parentNode.removeChild(f),!0})}function h(a){var f=l(k.paths,a);if(f&&I(f)&&1<f.length)return f.shift(),i.require.undef(a),i.require([a]),!0}function $(a){var f,b=a?a.indexOf("!"):-1;-1<b&&(f=a.substring(0,b),a=a.substring(b+1,a.length));return[f,a]}function n(a,f,
b,d){var m,B,g=null,e=f?f.name:null,h=a,j=!0,k="";a||(j=!1,a="_@r"+(L+=1));a=$(a);g=a[0];a=a[1];g&&(g=c(g,e,d),B=l(r,g));a&&(g?k=B&&B.normalize?B.normalize(a,function(a){return c(a,e,d)}):c(a,e,d):(k=c(a,e,d),a=$(k),g=a[0],k=a[1],b=!0,m=i.nameToUrl(k)));b=g&&!B&&!b?"_unnormalized"+(M+=1):"";return{prefix:g,name:k,parentMap:f,unnormalized:!!b,url:m,originalName:h,isDefine:j,id:(g?g+"!"+k:k)+b}}function q(a){var f=a.id,b=l(p,f);b||(b=p[f]=new i.Module(a));return b}function s(a,f,b){var d=a.id,m=l(p,
d);if(t(r,d)&&(!m||m.defineEmitComplete))"defined"===f&&b(r[d]);else if(m=q(a),m.error&&"error"===f)b(m.error);else m.on(f,b)}function v(a,f){var b=a.requireModules,d=!1;if(f)f(a);else if(y(b,function(f){if(f=l(p,f))f.error=a,f.events.error&&(d=!0,f.emit("error",a))}),!d)j.onError(a)}function w(){R.length&&(ia.apply(G,[G.length-1,0].concat(R)),R=[])}function x(a){delete p[a];delete T[a]}function E(a,f,b){var d=a.map.id;a.error?a.emit("error",a.error):(f[d]=!0,y(a.depMaps,function(d,c){var g=d.id,
e=l(p,g);e&&(!a.depMatched[c]&&!b[g])&&(l(f,g)?(a.defineDep(c,r[g]),a.check()):E(e,f,b))}),b[d]=!0)}function C(){var a,f,b,d,m=(b=1E3*k.waitSeconds)&&i.startTime+b<(new Date).getTime(),c=[],g=[],j=!1,l=!0;if(!U){U=!0;F(T,function(b){a=b.map;f=a.id;if(b.enabled&&(a.isDefine||g.push(b),!b.error))if(!b.inited&&m)h(f)?j=d=!0:(c.push(f),e(f));else if(!b.inited&&(b.fetched&&a.isDefine)&&(j=!0,!a.prefix))return l=!1});if(m&&c.length)return b=A("timeout","Load timeout for modules: "+c,null,c),b.contextName=
i.contextName,v(b);l&&y(g,function(a){E(a,{},{})});if((!m||d)&&j)if((z||da)&&!V)V=setTimeout(function(){V=0;C()},50);U=!1}}function D(a){t(r,a[0])||q(n(a[0],null,!0)).init(a[1],a[2])}function J(a){var a=a.currentTarget||a.srcElement,b=i.onScriptLoad;a.detachEvent&&!W?a.detachEvent("onreadystatechange",b):a.removeEventListener("load",b,!1);b=i.onScriptError;(!a.detachEvent||W)&&a.removeEventListener("error",b,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function K(){var a;for(w();G.length;){a=
G.shift();if(null===a[0])return v(A("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));D(a)}}var U,X,i,N,V,k={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},p={},T={},Y={},G=[],r={},S={},L=1,M=1;N={require:function(a){return a.require?a.require:a.require=i.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=r[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,config:function(){var b=
l(k.pkgs,a.map.id);return(b?l(k.config,a.map.id+"/"+b.main):l(k.config,a.map.id))||{}},exports:r[a.map.id]}}};X=function(a){this.events=l(Y,a.id)||{};this.map=a;this.shim=l(k.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};X.prototype={init:function(a,b,c,d){d=d||{};if(!this.inited){this.factory=b;if(c)this.on("error",c);else this.events.error&&(c=u(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);this.errback=c;this.inited=!0;
this.ignore=d.ignore;d.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,b){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=b)},fetch:function(){if(!this.fetched){this.fetched=!0;i.startTime=(new Date).getTime();var a=this.map;if(this.shim)i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],u(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},load:function(){var a=
this.map.url;S[a]||(S[a]=!0,i.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var a,b,c=this.map.id;b=this.depExports;var d=this.exports,m=this.factory;if(this.inited)if(this.error)this.emit("error",this.error);else{if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(H(m)){if(this.events.error&&this.map.isDefine||j.onError!==aa)try{d=i.execCb(c,m,b,d)}catch(e){a=e}else d=i.execCb(c,m,b,d);this.map.isDefine&&((b=this.module)&&void 0!==b.exports&&b.exports!==
this.exports?d=b.exports:void 0===d&&this.usingExports&&(d=this.exports));if(a)return a.requireMap=this.map,a.requireModules=this.map.isDefine?[this.map.id]:null,a.requireType=this.map.isDefine?"define":"require",v(this.error=a)}else d=m;this.exports=d;if(this.map.isDefine&&!this.ignore&&(r[c]=d,j.onResourceLoad))j.onResourceLoad(i,this.map,this.depMaps);x(c);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=
!0)}}else this.fetch()}},callPlugin:function(){var a=this.map,b=a.id,e=n(a.prefix);this.depMaps.push(e);s(e,"defined",u(this,function(d){var m,e;e=this.map.name;var g=this.map.parentMap?this.map.parentMap.name:null,h=i.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(d.normalize&&(e=d.normalize(e,function(a){return c(a,g,!0)})||""),d=n(a.prefix+"!"+e,this.map.parentMap),s(d,"defined",u(this,function(a){this.init([],function(){return a},null,{enabled:!0,ignore:!0})})),
e=l(p,d.id)){this.depMaps.push(d);if(this.events.error)e.on("error",u(this,function(a){this.emit("error",a)}));e.enable()}}else m=u(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),m.error=u(this,function(a){this.inited=!0;this.error=a;a.requireModules=[b];F(p,function(a){0===a.map.id.indexOf(b+"_unnormalized")&&x(a.map.id)});v(a)}),m.fromText=u(this,function(d,c){var e=a.name,g=n(e),B=O;c&&(d=c);B&&(O=!1);q(g);t(k.config,b)&&(k.config[e]=k.config[b]);try{j.exec(d)}catch(ca){return v(A("fromtexteval",
"fromText eval for "+b+" failed: "+ca,ca,[b]))}B&&(O=!0);this.depMaps.push(g);i.completeLoad(e);h([e],m)}),d.load(a.name,h,m,k)}));i.enable(e,this);this.pluginMaps[e.id]=e},enable:function(){T[this.map.id]=this;this.enabling=this.enabled=!0;y(this.depMaps,u(this,function(a,b){var c,d;if("string"===typeof a){a=n(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[b]=a;if(c=l(N,a.id)){this.depExports[b]=c(this);return}this.depCount+=1;s(a,"defined",u(this,function(a){this.defineDep(b,
a);this.check()}));this.errback&&s(a,"error",u(this,this.errback))}c=a.id;d=p[c];!t(N,c)&&(d&&!d.enabled)&&i.enable(a,this)}));F(this.pluginMaps,u(this,function(a){var b=l(p,a.id);b&&!b.enabled&&i.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,b){var c=this.events[a];c||(c=this.events[a]=[]);c.push(b)},emit:function(a,b){y(this.events[a],function(a){a(b)});"error"===a&&delete this.events[a]}};i={config:k,contextName:b,registry:p,defined:r,urlFetched:S,defQueue:G,Module:X,makeModuleMap:n,
nextTick:j.nextTick,onError:v,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=k.pkgs,c=k.shim,d={paths:!0,config:!0,map:!0};F(a,function(a,b){d[b]?"map"===b?(k.map||(k.map={}),Q(k[b],a,!0,!0)):Q(k[b],a,!0):k[b]=a});a.shim&&(F(a.shim,function(a,b){I(a)&&(a={deps:a});if((a.exports||a.init)&&!a.exportsFn)a.exportsFn=i.makeShimExports(a);c[b]=a}),k.shim=c);a.packages&&(y(a.packages,function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,
location:a.location||a.name,main:(a.main||"main").replace(ja,"").replace(ea,"")}}),k.pkgs=b);F(p,function(a,b){!a.inited&&!a.map.unnormalized&&(a.map=n(b))});if(a.deps||a.callback)i.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var b;a.init&&(b=a.init.apply(Z,arguments));return b||a.exports&&ba(a.exports)}},makeRequire:function(a,f){function h(d,c,e){var g,k;f.enableBuildCallback&&(c&&H(c))&&(c.__requireJsBuild=!0);if("string"===typeof d){if(H(c))return v(A("requireargs",
"Invalid require call"),e);if(a&&t(N,d))return N[d](p[a.id]);if(j.get)return j.get(i,d,a,h);g=n(d,a,!1,!0);g=g.id;return!t(r,g)?v(A("notloaded",'Module name "'+g+'" has not been loaded yet for context: '+b+(a?"":". Use require([])"))):r[g]}K();i.nextTick(function(){K();k=q(n(null,a));k.skipMap=f.skipMap;k.init(d,c,e,{enabled:!0});C()});return h}f=f||{};Q(h,{isBrowser:z,toUrl:function(b){var f,e=b.lastIndexOf("."),g=b.split("/")[0];if(-1!==e&&(!("."===g||".."===g)||1<e))f=b.substring(e,b.length),b=
b.substring(0,e);return i.nameToUrl(c(b,a&&a.id,!0),f,!0)},defined:function(b){return t(r,n(b,a,!1,!0).id)},specified:function(b){b=n(b,a,!1,!0).id;return t(r,b)||t(p,b)}});a||(h.undef=function(b){w();var c=n(b,a,!0),f=l(p,b);e(b);delete r[b];delete S[c.url];delete Y[b];f&&(f.events.defined&&(Y[b]=f.events),x(b))});return h},enable:function(a){l(p,a.id)&&q(a).enable()},completeLoad:function(a){var b,c,d=l(k.shim,a)||{},e=d.exports;for(w();G.length;){c=G.shift();if(null===c[0]){c[0]=a;if(b)break;b=
!0}else c[0]===a&&(b=!0);D(c)}c=l(p,a);if(!b&&!t(r,a)&&c&&!c.inited){if(k.enforceDefine&&(!e||!ba(e)))return h(a)?void 0:v(A("nodefine","No define call for "+a,null,[a]));D([a,d.deps||[],d.exportsFn])}C()},nameToUrl:function(a,b,c){var d,e,h,g,i,n;if(j.jsExtRegExp.test(a))g=a+(b||"");else{d=k.paths;e=k.pkgs;g=a.split("/");for(i=g.length;0<i;i-=1)if(n=g.slice(0,i).join("/"),h=l(e,n),n=l(d,n)){I(n)&&(n=n[0]);g.splice(0,i,n);break}else if(h){a=a===h.name?h.location+"/"+h.main:h.location;g.splice(0,i,
a);break}g=g.join("/");g+=b||(/^data\:|\?/.test(g)||c?"":".js");g=("/"===g.charAt(0)||g.match(/^[\w\+\.\-]+:/)?"":k.baseUrl)+g}return k.urlArgs?g+((-1===g.indexOf("?")?"?":"&")+k.urlArgs):g},load:function(a,b){j.load(i,a,b)},execCb:function(a,b,c,d){return b.apply(d,c)},onScriptLoad:function(a){if("load"===a.type||ka.test((a.currentTarget||a.srcElement).readyState))P=null,a=J(a),i.completeLoad(a.id)},onScriptError:function(a){var b=J(a);if(!h(b.id))return v(A("scripterror","Script error for: "+b.id,
a,[b.id]))}};i.require=i.makeRequire();return i}var j,w,x,C,J,D,P,K,q,fa,la=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,ma=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,ea=/\.js$/,ja=/^\.\//;w=Object.prototype;var L=w.toString,ga=w.hasOwnProperty,ia=Array.prototype.splice,z=!!("undefined"!==typeof window&&"undefined"!==typeof navigator&&window.document),da=!z&&"undefined"!==typeof importScripts,ka=z&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,W="undefined"!==typeof opera&&
"[object Opera]"===opera.toString(),E={},s={},R=[],O=!1;if("undefined"===typeof define){if("undefined"!==typeof requirejs){if(H(requirejs))return;s=requirejs;requirejs=void 0}"undefined"!==typeof require&&!H(require)&&(s=require,require=void 0);j=requirejs=function(b,c,e,h){var q,n="_";!I(b)&&"string"!==typeof b&&(q=b,I(c)?(b=c,c=e,e=h):b=[]);q&&q.context&&(n=q.context);(h=l(E,n))||(h=E[n]=j.s.newContext(n));q&&h.configure(q);return h.require(b,c,e)};j.config=function(b){return j(b)};j.nextTick="undefined"!==
typeof setTimeout?function(b){setTimeout(b,4)}:function(b){b()};require||(require=j);j.version="2.1.9";j.jsExtRegExp=/^\/|:|\?|\.js$/;j.isBrowser=z;w=j.s={contexts:E,newContext:ha};j({});y(["toUrl","undef","defined","specified"],function(b){j[b]=function(){var c=E._;return c.require[b].apply(c,arguments)}});if(z&&(x=w.head=document.getElementsByTagName("head")[0],C=document.getElementsByTagName("base")[0]))x=w.head=C.parentNode;j.onError=aa;j.createNode=function(b){var c=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml",
"html:script"):document.createElement("script");c.type=b.scriptType||"text/javascript";c.charset="utf-8";c.async=!0;return c};j.load=function(b,c,e){var h=b&&b.config||{};if(z)return h=j.createNode(h,c,e),h.setAttribute("data-requirecontext",b.contextName),h.setAttribute("data-requiremodule",c),h.attachEvent&&!(h.attachEvent.toString&&0>h.attachEvent.toString().indexOf("[native code"))&&!W?(O=!0,h.attachEvent("onreadystatechange",b.onScriptLoad)):(h.addEventListener("load",b.onScriptLoad,!1),h.addEventListener("error",
b.onScriptError,!1)),h.src=e,K=h,C?x.insertBefore(h,C):x.appendChild(h),K=null,h;if(da)try{importScripts(e),b.completeLoad(c)}catch(l){b.onError(A("importscripts","importScripts failed for "+c+" at "+e,l,[c]))}};z&&!s.skipDataMain&&M(document.getElementsByTagName("script"),function(b){x||(x=b.parentNode);if(J=b.getAttribute("data-main"))return q=J,s.baseUrl||(D=q.split("/"),q=D.pop(),fa=D.length?D.join("/")+"/":"./",s.baseUrl=fa),q=q.replace(ea,""),j.jsExtRegExp.test(q)&&(q=J),s.deps=s.deps?s.deps.concat(q):
[q],!0});define=function(b,c,e){var h,j;"string"!==typeof b&&(e=c,c=b,b=null);I(c)||(e=c,c=null);!c&&H(e)&&(c=[],e.length&&(e.toString().replace(la,"").replace(ma,function(b,e){c.push(e)}),c=(1===e.length?["require"]:["require","exports","module"]).concat(c)));if(O){if(!(h=K))P&&"interactive"===P.readyState||M(document.getElementsByTagName("script"),function(b){if("interactive"===b.readyState)return P=b}),h=P;h&&(b||(b=h.getAttribute("data-requiremodule")),j=E[h.getAttribute("data-requirecontext")])}(j?
j.defQueue:R).push([b,c,e])};define.amd={jQuery:!0};j.exec=function(b){return eval(b)};j(s)}})(this);

!function(n,e){"$:nomunge";n.fn.serializeObject=function(){var r={};return n.each(this.serializeArray(),function(a,i){var c=i.name,t=i.value;r[c]=r[c]===e?t:n.isArray(r[c])?r[c].concat(t):[r[c],t]}),r}}(jQuery);
define("DID/Activity",["DID/Guest"],function(e){function r(n,r){var i=t.Callbacks().add(e.set).add(r.success).fire;DisneyID.Dispatch.checkOrRequestActivities(n,!0,!1,{success:i,error:function(e){switch(e.status){case 400:case 401:r.error(e);break;default:i(_.get(e,"responseJSON.raw"))}}})}function i(n,r,i){var s={compliance:{activities:n,credentials:r.credentials||undefined}};DisneyID.Dispatch.create(s,{success:t.Callbacks().add(e.set).add(i.success).fire,error:i.error})}function s(e){var r=null,i=null;t.each(e,function(e,t){if(r===null||(n[t]||-1)<r)r=n[t],i=t});if(!n.hasOwnProperty(i))throw new Error("Unknown activity state");return i}var t=window.jQuery,n={DENIED:1,NOT_REQUESTED:2,PENDING:3,APPROVED:4};return{getState:r,sendRequest:i,getBundleAggregateState:s}}),define("DID/Activity.js",function(){}),define("DID/Context",[],function(){var e={LIGHTBOX:"LIGHTBOX",ACCOUNT:"ACCOUNT"},t=e.LIGHTBOX;return window.location.pathname.indexOf("/account/")===0&&(t=e.ACCOUNT,window.DisneyID.redirectToLogin=function(){DisneyID.throwMessage(localeMap.getText("page_expired")),DisneyID.log("Unauthorized - token expired / invalid")},DisneyID.throwMessage=function(e){var t=$("form");t.hide(),$("#disneyid-messagediv").addClass("relative solidwhitebg nobgimage").css({top:0,height:"auto"}).html(e).show().siblings("#loader").hide(),scrollTo(0,0)}),{context:t}}),define("DID/Context.js",function(){}),define("DID/Family",["DID/Guest"],function(e){function i(n){var r=a(n.success);e.get({success:function(e){t.isEmptyObject(e.family)?DisneyID.Dispatch.getFamilyBySwid({success:r,error:n.error,unauthenticated:n.unauthenticated}):n.success(e)},error:function(e){n.error(e)}})}function s(e,t){var n=a(function(n){t.success(n.family.members[e||n.token.swid].activities)}),r=a(function(r){DisneyID.Dispatch.familyMemberGetActivities(r.family.familyGUID,e||r.token.swid,{success:n,error:t.error})});i({success:r,error:DisneyID.redirectToLogin})}function o(e){var n={};for(var r in e){if(!e.hasOwnProperty(r)||!e[r].product)continue;var i=e[r];n[i.product.code]||(n[i.product.code]=t.extend({},i.product,{activities:{}})),n[i.product.code].activities[r]=i}return n}function u(e,t,n,r,s){i({success:function(i){DisneyID.Dispatch.familyMemberUpdateActivityState(i.family.familyGUID,e,t,n,i.family.members[e].activitiesETag,r,{success:a(s.success),error:s.error,unauthenticated:DisneyID.redirectToLogin})},error:s.error})}function a(n){return t.Callbacks().add(e.set).add(n).fire}var t=window.jQuery,n={STATE_APPROVED:"APPROVED",STATE_PENDING:"PENDING",STATE_DENIED:"DENIED"},r={AB_CHILD:"CHILD",AB_TEEN:"TEEN",AB_ADULT:"ADULT"};return{cucumber:3,get:i,getMemberActivities:s,collateActivitiesByProduct:o,updateMemberActivityState:u,activityStates:n,ageBands:r}}),define("DID/Family.js",function(){}),define("DID/Guest",[],function(){function t(t){if(e||window.guest)return t.success(e||window.guest);DisneyID.Dispatch.decodeGuestData({success:$.Callbacks().add(n).add(t.success).fire,error:t.error})}function n(t){e=t,_.get(e,"token.swid")&&DisneyID.Dispatch._writeLoginCookies(e.token,e,{success:$.noop}),window.guest=e}function r(e){var t=$.trim([e.firstName,e.lastName].join(" "));return t||(t=e.username),t||(t=e.email),t}var e=window.guest||undefined;return{get:t,set:n,getName:r}}),define("DID/Guest.js",function(){}),define("DID",function(){});
!function(e,a,t){function l(e){var a={},l=/^jQuery\d+$/;return t.each(e.attributes,function(e,t){t.specified&&!l.test(t.name)&&(a[t.name]=t.value)}),a}function r(e,a){var l=this,r=t(l);if(l.value==r.attr("placeholder")&&r.hasClass("placeholder"))if(r.data("placeholder-password")){if(r=r.hide().next().show().attr("id",r.removeAttr("id").data("placeholder-id")),e===!0)return r[0].value=a;r.focus()}else l.value="",r.removeClass("placeholder"),l==d()&&l.select()}function o(){var e,a=this,o=t(a),d=this.id;if(""==a.value){if("password"==a.type){if(!o.data("placeholder-textinput")){try{e=o.clone().attr({type:"text"})}catch(c){e=t("<input>").attr(t.extend(l(this),{type:"text"}))}e.removeAttr("name").data({"placeholder-password":o,"placeholder-id":d}).bind("focus.placeholder",r),o.data({"placeholder-textinput":e,"placeholder-id":d}).before(e)}o=o.removeAttr("id").hide().prev().attr("id",d).show()}o.addClass("placeholder"),o[0].value=o.attr("placeholder")}else o.removeClass("placeholder")}function d(){try{return a.activeElement}catch(e){}}var c,n,i="[object OperaMini]"==Object.prototype.toString.call(e.operamini),p="placeholder"in a.createElement("input")&&!i,u="placeholder"in a.createElement("textarea")&&!i,h=t.fn,s=t.valHooks,v=t.propHooks;p&&u?(n=h.placeholder=function(){return this},n.input=n.textarea=!0):(n=h.placeholder=function(){var e=this;return e.filter((p?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":r,"blur.placeholder":o}).data("placeholder-enabled",!0).trigger("blur.placeholder"),e},n.input=p,n.textarea=u,c={get:function(e){var a=t(e),l=a.data("placeholder-password");return l?l[0].value:a.data("placeholder-enabled")&&a.hasClass("placeholder")?"":e.value},set:function(e,a){var l=t(e),c=l.data("placeholder-password");return c?c[0].value=a:l.data("placeholder-enabled")?(""==a?(e.value=a,e!=d()&&o.call(e)):l.hasClass("placeholder")?r.call(e,!0,a)||(e.value=a):e.value=a,l):e.value=a}},p||(s.input=c,v.value=c),u||(s.textarea=c,v.value=c),t(function(){t(a).delegate("form","submit.placeholder",function(){var e=t(".placeholder",this).each(r);setTimeout(function(){e.each(o)},10)})}),t(e).bind("beforeunload.placeholder",function(){t(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery);
"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};
if(typeof module!="undefined"&&module.exports)module.exports=sjcl;
sjcl.cipher.aes=function(a){this.h[0][0][0]||this.z();var b,c,d,e,f=this.h[0][4],g=this.h[1];b=a.length;var h=1;if(b!==4&&b!==6&&b!==8)throw new sjcl.exception.invalid("invalid aes key size");this.a=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(a%b===0||b===8&&a%b===4){c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255];if(a%b===0){c=c<<8^c>>>24^h<<24;h=h<<1^(h>>7)*283}}d[a]=d[a-b]^c}for(b=0;a;b++,a--){c=d[b&3?a:a-4];e[b]=a<=4||b<4?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^
g[3][f[c&255]]}};
sjcl.cipher.aes.prototype={encrypt:function(a){return this.I(a,0)},decrypt:function(a){return this.I(a,1)},h:[[[],[],[],[],[]],[[],[],[],[],[]]],z:function(){var a=this.h[0],b=this.h[1],c=a[4],d=b[4],e,f,g,h=[],i=[],k,j,l,m;for(e=0;e<0x100;e++)i[(h[e]=e<<1^(e>>7)*283)^e]=e;for(f=g=0;!c[f];f^=k||1,g=i[g]||1){l=g^g<<1^g<<2^g<<3^g<<4;l=l>>8^l&255^99;c[f]=l;d[l]=f;j=h[e=h[k=h[f]]];m=j*0x1010101^e*0x10001^k*0x101^f*0x1010100;j=h[l]*0x101^l*0x1010100;for(e=0;e<4;e++){a[e][f]=j=j<<24^j>>>8;b[e][l]=m=m<<24^m>>>8}}for(e=
0;e<5;e++){a[e]=a[e].slice(0);b[e]=b[e].slice(0)}},I:function(a,b){if(a.length!==4)throw new sjcl.exception.invalid("invalid aes block size");var c=this.a[b],d=a[0]^c[0],e=a[b?3:1]^c[1],f=a[2]^c[2];a=a[b?1:3]^c[3];var g,h,i,k=c.length/4-2,j,l=4,m=[0,0,0,0];g=this.h[b];var n=g[0],o=g[1],p=g[2],q=g[3],r=g[4];for(j=0;j<k;j++){g=n[d>>>24]^o[e>>16&255]^p[f>>8&255]^q[a&255]^c[l];h=n[e>>>24]^o[f>>16&255]^p[a>>8&255]^q[d&255]^c[l+1];i=n[f>>>24]^o[a>>16&255]^p[d>>8&255]^q[e&255]^c[l+2];a=n[a>>>24]^o[d>>16&
255]^p[e>>8&255]^q[f&255]^c[l+3];l+=4;d=g;e=h;f=i}for(j=0;j<4;j++){m[b?3&-j:j]=r[d>>>24]<<24^r[e>>16&255]<<16^r[f>>8&255]<<8^r[a&255]^c[l++];g=d;d=e;e=f;f=a;a=g}return m}};
sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.P(a.slice(b/32),32-(b&31)).slice(1);return c===undefined?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(a.length===0||b.length===0)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return d===32?a.concat(b):sjcl.bitArray.P(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;
if(b===0)return 0;return(b-1)*32+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(a.length*32<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b&=31;if(c>0&&b)a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1);return a},partial:function(a,b,c){if(a===32)return b;return(c?b|0:b<<32-a)+a*0x10000000000},getPartial:function(a){return Math.round(a/0x10000000000)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=
a[d]^b[d];return c===0},P:function(a,b,c,d){var e;e=0;if(d===undefined)d=[];for(;b>=32;b-=32){d.push(c);c=0}if(b===0)return d.concat(a);for(e=0;e<a.length;e++){d.push(c|a[e]>>>b);c=a[e]<<32-b}e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,b+a>32?c:d.pop(),1));return d},k:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}};
sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++){if((d&3)===0)e=a[d/4];b+=String.fromCharCode(e>>>24);e<<=8}return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++){d=d<<8|a.charCodeAt(c);if((c&3)===3){b.push(d);d=0}}c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};
sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\s|0x/g,"");d=a.length;a+="00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,d*4)}};
sjcl.codec.base64={F:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.F,g=0,h=sjcl.bitArray.bitLength(a);if(c)f=f.substr(0,62)+"-_";for(c=0;d.length*6<h;){d+=f.charAt((g^a[c]>>>e)>>>26);if(e<6){g=a[c]<<6-e;e+=26;c++}else{g<<=6;e-=6}}for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\s|=/g,"");var c=[],d=0,e=sjcl.codec.base64.F,f=0,g;if(b)e=e.substr(0,62)+"-_";for(b=0;b<a.length;b++){g=e.indexOf(a.charAt(b));
if(g<0)throw new sjcl.exception.invalid("this isn't base64!");if(d>26){d-=26;c.push(f^g>>>d);f=g<<32-d}else{d+=6;f^=g<<32-d}}d&56&&c.push(sjcl.bitArray.partial(d&56,f,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.a[0]||this.z();if(a){this.n=a.n.slice(0);this.i=a.i.slice(0);this.e=a.e}else this.reset()};sjcl.hash.sha256.hash=function(a){return(new sjcl.hash.sha256).update(a).finalize()};
sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.n=this.N.slice(0);this.i=[];this.e=0;return this},update:function(a){if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);var b,c=this.i=sjcl.bitArray.concat(this.i,a);b=this.e;a=this.e=b+sjcl.bitArray.bitLength(a);for(b=512+b&-512;b<=a;b+=512)this.D(c.splice(0,16));return this},finalize:function(){var a,b=this.i,c=this.n;b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.e/
4294967296));for(b.push(this.e|0);b.length;)this.D(b.splice(0,16));this.reset();return c},N:[],a:[],z:function(){function a(e){return(e-Math.floor(e))*0x100000000|0}var b=0,c=2,d;a:for(;b<64;c++){for(d=2;d*d<=c;d++)if(c%d===0)continue a;if(b<8)this.N[b]=a(Math.pow(c,0.5));this.a[b]=a(Math.pow(c,1/3));b++}},D:function(a){var b,c,d=a.slice(0),e=this.n,f=this.a,g=e[0],h=e[1],i=e[2],k=e[3],j=e[4],l=e[5],m=e[6],n=e[7];for(a=0;a<64;a++){if(a<16)b=d[a];else{b=d[a+1&15];c=d[a+14&15];b=d[a&15]=(b>>>7^b>>>18^
b>>>3^b<<25^b<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+d[a&15]+d[a+9&15]|0}b=b+n+(j>>>6^j>>>11^j>>>25^j<<26^j<<21^j<<7)+(m^j&(l^m))+f[a];n=m;m=l;l=j;j=k+b|0;k=i;i=h;h=g;g=b+(h&i^k&(h^i))+(h>>>2^h>>>13^h>>>22^h<<30^h<<19^h<<10)|0}e[0]=e[0]+g|0;e[1]=e[1]+h|0;e[2]=e[2]+i|0;e[3]=e[3]+k|0;e[4]=e[4]+j|0;e[5]=e[5]+l|0;e[6]=e[6]+m|0;e[7]=e[7]+n|0}};
sjcl.mode.ccm={name:"ccm",encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,i=h.bitLength(c)/8,k=h.bitLength(g)/8;e=e||64;d=d||[];if(i<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;f<4&&k>>>8*f;f++);if(f<15-i)f=15-i;c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.H(a,b,c,d,e,f);g=sjcl.mode.ccm.J(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),i=f.clamp(b,h-e),k=f.bitSlice(b,
h-e);h=(h-e)/8;if(g<7)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;b<4&&h>>>8*b;b++);if(b<15-g)b=15-g;c=f.clamp(c,8*(15-b));i=sjcl.mode.ccm.J(a,i,c,k,e,b);a=sjcl.mode.ccm.H(a,i.data,c,d,e,b);if(!f.equal(i.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return i.data},H:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,i=h.k;e/=8;if(e%2||e<4||e>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(d.length>0xffffffff||b.length>0xffffffff)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");
f=[h.partial(8,(d.length?64:0)|e-2<<2|f-1)];f=h.concat(f,c);f[3]|=h.bitLength(b)/8;f=a.encrypt(f);if(d.length){c=h.bitLength(d)/8;if(c<=65279)g=[h.partial(16,c)];else if(c<=0xffffffff)g=h.concat([h.partial(16,65534)],[c]);g=h.concat(g,d);for(d=0;d<g.length;d+=4)f=a.encrypt(i(f,g.slice(d,d+4).concat([0,0,0])))}for(d=0;d<b.length;d+=4)f=a.encrypt(i(f,b.slice(d,d+4).concat([0,0,0])));return h.clamp(f,e*8)},J:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.k;var i=b.length,k=h.bitLength(b);c=h.concat([h.partial(8,
f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!i)return{tag:d,data:[]};for(g=0;g<i;g+=4){c[3]++;e=a.encrypt(c);b[g]^=e[0];b[g+1]^=e[1];b[g+2]^=e[2];b[g+3]^=e[3]}return{tag:d,data:h.clamp(b,k)}}};
sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.B,i=sjcl.bitArray,k=i.k,j=[0,0,0,0];c=h(a.encrypt(c));var l,m=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4){l=b.slice(g,g+4);j=k(j,l);m=m.concat(k(c,a.encrypt(k(c,l))));c=h(c)}l=b.slice(g);b=i.bitLength(l);g=a.encrypt(k(c,[0,0,0,b]));l=i.clamp(k(l.concat([0,0,0]),g),b);j=k(j,k(l.concat([0,0,0]),g));j=a.encrypt(k(j,k(c,h(c))));
if(d.length)j=k(j,f?d:sjcl.mode.ocb2.pmac(a,d));return m.concat(i.concat(l,i.clamp(j,e)))},decrypt:function(a,b,c,d,e,f){if(sjcl.bitArray.bitLength(c)!==128)throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.B,h=sjcl.bitArray,i=h.k,k=[0,0,0,0],j=g(a.encrypt(c)),l,m,n=sjcl.bitArray.bitLength(b)-e,o=[];d=d||[];for(c=0;c+4<n/32;c+=4){l=i(j,a.decrypt(i(j,b.slice(c,c+4))));k=i(k,l);o=o.concat(l);j=g(j)}m=n-c*32;l=a.encrypt(i(j,[0,0,0,m]));l=i(l,h.clamp(b.slice(c),
m).concat([0,0,0]));k=i(k,l);k=a.encrypt(i(k,i(j,g(j))));if(d.length)k=i(k,f?d:sjcl.mode.ocb2.pmac(a,d));if(!h.equal(h.clamp(k,e),h.bitSlice(b,n)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return o.concat(h.clamp(l,m))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.B,e=sjcl.bitArray,f=e.k,g=[0,0,0,0],h=a.encrypt([0,0,0,0]);h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4){h=d(h);g=f(g,a.encrypt(f(h,b.slice(c,c+4))))}b=b.slice(c);if(e.bitLength(b)<128){h=f(h,d(h));b=e.concat(b,[2147483648|0,0,
0,0])}g=f(g,b);return a.encrypt(f(d(f(h,d(h))),g))},B:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^(a[0]>>>31)*135]}};sjcl.misc.hmac=function(a,b){this.M=b=b||sjcl.hash.sha256;var c=[[],[]],d=b.prototype.blockSize/32;this.l=[new b,new b];if(a.length>d)a=b.hash(a);for(b=0;b<d;b++){c[0][b]=a[b]^909522486;c[1][b]=a[b]^1549556828}this.l[0].update(c[0]);this.l[1].update(c[1])};
sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a,b){a=(new this.M(this.l[0])).update(a,b).finalize();return(new this.M(this.l[1])).update(a).finalize()};
sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1E3;if(d<0||c<0)throw sjcl.exception.invalid("invalid params to pbkdf2");if(typeof a==="string")a=sjcl.codec.utf8String.toBits(a);e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,i,k=[],j=sjcl.bitArray;for(i=1;32*k.length<(d||1);i++){e=f=a.encrypt(j.concat(b,[i]));for(g=1;g<c;g++){f=a.encrypt(f);for(h=0;h<f.length;h++)e[h]^=f[h]}k=k.concat(e)}if(d)k=j.clamp(k,d);return k};
sjcl.random={randomWords:function(a,b){var c=[];b=this.isReady(b);var d;if(b===0)throw new sjcl.exception.notReady("generator isn't seeded");else b&2&&this.U(!(b&1));for(b=0;b<a;b+=4){(b+1)%0x10000===0&&this.L();d=this.w();c.push(d[0],d[1],d[2],d[3])}this.L();return c.slice(0,a)},setDefaultParanoia:function(a){this.t=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=(new Date).valueOf(),g=this.q[c],h=this.isReady(),i=0;d=this.G[c];if(d===undefined)d=this.G[c]=this.R++;if(g===undefined)g=this.q[c]=
0;this.q[c]=(this.q[c]+1)%this.b.length;switch(typeof a){case "number":if(b===undefined)b=1;this.b[g].update([d,this.u++,1,b,f,1,a|0]);break;case "object":c=Object.prototype.toString.call(a);if(c==="[object Uint32Array]"){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else{if(c!=="[object Array]")i=1;for(c=0;c<a.length&&!i;c++)if(typeof a[c]!="number")i=1}if(!i){if(b===undefined)for(c=b=0;c<a.length;c++)for(e=a[c];e>0;){b++;e>>>=1}this.b[g].update([d,this.u++,2,b,f,a.length].concat(a))}break;case "string":if(b===
undefined)b=a.length;this.b[g].update([d,this.u++,3,b,f,a.length]);this.b[g].update(a);break;default:i=1}if(i)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.j[g]+=b;this.f+=b;if(h===0){this.isReady()!==0&&this.K("seeded",Math.max(this.g,this.f));this.K("progress",this.getProgress())}},isReady:function(a){a=this.C[a!==undefined?a:this.t];return this.g&&this.g>=a?this.j[0]>80&&(new Date).valueOf()>this.O?3:1:this.f>=a?2:0},getProgress:function(a){a=
this.C[a?a:this.t];return this.g>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.m){if(window.addEventListener){window.addEventListener("load",this.o,false);window.addEventListener("mousemove",this.p,false)}else if(document.attachEvent){document.attachEvent("onload",this.o);document.attachEvent("onmousemove",this.p)}else throw new sjcl.exception.bug("can't attach event");this.m=true}},stopCollectors:function(){if(this.m){if(window.removeEventListener){window.removeEventListener("load",
this.o,false);window.removeEventListener("mousemove",this.p,false)}else if(window.detachEvent){window.detachEvent("onload",this.o);window.detachEvent("onmousemove",this.p)}this.m=false}},addEventListener:function(a,b){this.r[a][this.Q++]=b},removeEventListener:function(a,b){var c;a=this.r[a];var d=[];for(c in a)a.hasOwnProperty(c)&&a[c]===b&&d.push(c);for(b=0;b<d.length;b++){c=d[b];delete a[c]}},b:[new sjcl.hash.sha256],j:[0],A:0,q:{},u:0,G:{},R:0,g:0,f:0,O:0,a:[0,0,0,0,0,0,0,0],d:[0,0,0,0],s:undefined,
t:6,m:false,r:{progress:{},seeded:{}},Q:0,C:[0,48,64,96,128,192,0x100,384,512,768,1024],w:function(){for(var a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}return this.s.encrypt(this.d)},L:function(){this.a=this.w().concat(this.w());this.s=new sjcl.cipher.aes(this.a)},T:function(a){this.a=sjcl.hash.sha256.hash(this.a.concat(a));this.s=new sjcl.cipher.aes(this.a);for(a=0;a<4;a++){this.d[a]=this.d[a]+1|0;if(this.d[a])break}},U:function(a){var b=[],c=0,d;this.O=b[0]=(new Date).valueOf()+3E4;for(d=
0;d<16;d++)b.push(Math.random()*0x100000000|0);for(d=0;d<this.b.length;d++){b=b.concat(this.b[d].finalize());c+=this.j[d];this.j[d]=0;if(!a&&this.A&1<<d)break}if(this.A>=1<<this.b.length){this.b.push(new sjcl.hash.sha256);this.j.push(0)}this.f-=c;if(c>this.g)this.g=c;this.A++;this.T(b)},p:function(a){sjcl.random.addEntropy([a.x||a.clientX||a.offsetX||0,a.y||a.clientY||a.offsetY||0],2,"mouse")},o:function(){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},K:function(a,b){var c;a=sjcl.random.r[a];
var d=[];for(c in a)a.hasOwnProperty(c)&&d.push(a[c]);for(c=0;c<d.length;c++)d[c](b)}};try{var s=new Uint32Array(32);crypto.getRandomValues(s);sjcl.random.addEntropy(s,1024,"crypto['getRandomValues']")}catch(t){}
sjcl.json={defaults:{v:1,iter:1E3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.c({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.c(f,c);c=f.adata;if(typeof f.salt==="string")f.salt=sjcl.codec.base64.toBits(f.salt);if(typeof f.iv==="string")f.iv=sjcl.codec.base64.toBits(f.iv);if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||typeof a==="string"&&f.iter<=100||f.ts!==64&&f.ts!==96&&f.ts!==128||f.ks!==128&&f.ks!==192&&f.ks!==0x100||f.iv.length<
2||f.iv.length>4)throw new sjcl.exception.invalid("json encrypt: invalid parameters");if(typeof a==="string"){g=sjcl.misc.cachedPbkdf2(a,f);a=g.key.slice(0,f.ks/32);f.salt=g.salt}if(typeof b==="string")b=sjcl.codec.utf8String.toBits(b);if(typeof c==="string")c=sjcl.codec.utf8String.toBits(c);g=new sjcl.cipher[f.cipher](a);e.c(d,f);d.key=a;f.ct=sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return e.encode(f)},decrypt:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.c(e.c(e.c({},e.defaults),e.decode(b)),
c,true);var f;c=b.adata;if(typeof b.salt==="string")b.salt=sjcl.codec.base64.toBits(b.salt);if(typeof b.iv==="string")b.iv=sjcl.codec.base64.toBits(b.iv);if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||typeof a==="string"&&b.iter<=100||b.ts!==64&&b.ts!==96&&b.ts!==128||b.ks!==128&&b.ks!==192&&b.ks!==0x100||!b.iv||b.iv.length<2||b.iv.length>4)throw new sjcl.exception.invalid("json decrypt: invalid parameters");if(typeof a==="string"){f=sjcl.misc.cachedPbkdf2(a,b);a=f.key.slice(0,b.ks/32);b.salt=f.salt}if(typeof c===
"string")c=sjcl.codec.utf8String.toBits(c);f=new sjcl.cipher[b.cipher](a);c=sjcl.mode[b.mode].decrypt(f,b.ct,b.iv,c,b.ts);e.c(d,b);d.key=a;return sjcl.codec.utf8String.fromBits(c)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+'"'+b+'":';d=",";switch(typeof a[b]){case "number":case "boolean":c+=a[b];break;case "string":c+='"'+escape(a[b])+'"';break;case "object":c+='"'+
sjcl.codec.base64.fromBits(a[b],1)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type");}}return c+"}"},decode:function(a){a=a.replace(/\s/g,"");if(!a.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");a=a.replace(/^\{|\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");b[d[2]]=
d[3]?parseInt(d[3],10):d[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4])}return b},c:function(a,b,c){if(a===undefined)a={};if(b===undefined)return a;var d;for(d in b)if(b.hasOwnProperty(d)){if(c&&a[d]!==undefined&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},W:function(a,b){var c={},d;for(d in a)if(a.hasOwnProperty(d)&&a[d]!==b[d])c[d]=a[d];return c},V:function(a,b){var c={},d;for(d=0;d<b.length;d++)if(a[b[d]]!==undefined)c[b[d]]=
a[b[d]];return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.S={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.S,d;b=b||{};d=b.iter||1E3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=b.salt===undefined?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};

!function(){function n(){function n(n,r,f){var c={fn:n,id:f,deferred:r};0===t(c.id)&&i.push(c),e()}function e(){r()&&i.length>1||0===i.length||(i[0].fn.call(),"object"!=typeof i[0]||i[0].deferred&&r()||(i.shift(),e()))}function r(){return i.length>0&&i[0].deferred===!0}function t(n){var e,r=0;for(e=0;e<i.length;e++)r+=i[e].id===n?1:0;return r}var f,i=[];return f={defer:function(e,r,t){return n(e,r,t),f},resolve:function(n){var r;if(i.length){for(r=0;r<i.length;r++)i[r].id===n&&(i=i.slice(0,r).concat(i.slice(r+1)));e()}return f}}}this.Kew=n}();
/* Modernizr 2.6.2 (Custom Build) | MIT & BSD
 * Build: http://modernizr.com/download/#-shiv-mq-teststyles
 */
;window.Modernizr=function(a,b,c){function v(a){i.cssText=a}function w(a,b){return v(prefixes.join(a+";")+(b||""))}function x(a,b){return typeof a===b}function y(a,b){return!!~(""+a).indexOf(b)}function z(a,b,d){for(var e in a){var f=b[a[e]];if(f!==c)return d===!1?a[e]:x(f,"function")?f.bind(d||b):f}return!1}var d="2.6.2",e={},f=b.documentElement,g="modernizr",h=b.createElement(g),i=h.style,j,k={}.toString,l={},m={},n={},o=[],p=o.slice,q,r=function(a,c,d,e){var h,i,j,k,l=b.createElement("div"),m=b.body,n=m||b.createElement("body");if(parseInt(d,10))while(d--)j=b.createElement("div"),j.id=e?e[d]:g+(d+1),l.appendChild(j);return h=["&#173;",'<style id="s',g,'">',a,"</style>"].join(""),l.id=g,(m?l:n).innerHTML+=h,n.appendChild(l),m||(n.style.background="",n.style.overflow="hidden",k=f.style.overflow,f.style.overflow="hidden",f.appendChild(n)),i=c(l,a),m?l.parentNode.removeChild(l):(n.parentNode.removeChild(n),f.style.overflow=k),!!i},s=function(b){var c=a.matchMedia||a.msMatchMedia;if(c)return c(b)&&c(b).matches||false;var d;return r("@media "+b+" { #"+g+" { position: absolute; } }",function(b){d=(a.getComputedStyle?getComputedStyle(b,null):b.currentStyle)["position"]=="absolute"}),d},t={}.hasOwnProperty,u;!x(t,"undefined")&&!x(t.call,"undefined")?u=function(a,b){return t.call(a,b)}:u=function(a,b){return b in a&&x(a.constructor.prototype[b],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(b){var c=this;if(typeof c!="function")throw new TypeError;var d=p.call(arguments,1),e=function(){if(this instanceof e){var a=function(){};a.prototype=c.prototype;var f=new a,g=c.apply(f,d.concat(p.call(arguments)));return Object(g)===g?g:f}return c.apply(b,d.concat(p.call(arguments)))};return e});for(var A in l)u(l,A)&&(q=A.toLowerCase(),e[q]=l[A](),o.push((e[q]?"":"no-")+q));return e.addTest=function(a,b){if(typeof a=="object")for(var d in a)u(a,d)&&e.addTest(d,a[d]);else{a=a.toLowerCase();if(e[a]!==c)return e;b=typeof b=="function"?b():b,typeof enableClasses!="undefined"&&enableClasses&&(f.className+=" "+(b?"":"no-")+a),e[a]=b}return e},v(""),h=j=null,function(a,b){function k(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function l(){var a=r.elements;return typeof a=="string"?a.split(" "):a}function m(a){var b=i[a[g]];return b||(b={},h++,a[g]=h,i[h]=b),b}function n(a,c,f){c||(c=b);if(j)return c.createElement(a);f||(f=m(c));var g;return f.cache[a]?g=f.cache[a].cloneNode():e.test(a)?g=(f.cache[a]=f.createElem(a)).cloneNode():g=f.createElem(a),g.canHaveChildren&&!d.test(a)?f.frag.appendChild(g):g}function o(a,c){a||(a=b);if(j)return a.createDocumentFragment();c=c||m(a);var d=c.frag.cloneNode(),e=0,f=l(),g=f.length;for(;e<g;e++)d.createElement(f[e]);return d}function p(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return r.shivMethods?n(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+l().join().replace(/\w+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(r,b.frag)}function q(a){a||(a=b);var c=m(a);return r.shivCSS&&!f&&!c.hasCSS&&(c.hasCSS=!!k(a,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),j||p(a,c),a}var c=a.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,e=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,f,g="_html5shiv",h=0,i={},j;(function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",f="hidden"in a,j=a.childNodes.length==1||function(){b.createElement("a");var a=b.createDocumentFragment();return typeof a.cloneNode=="undefined"||typeof a.createDocumentFragment=="undefined"||typeof a.createElement=="undefined"}()}catch(c){f=!0,j=!0}})();var r={elements:c.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:c.shivCSS!==!1,supportsUnknownElements:j,shivMethods:c.shivMethods!==!1,type:"default",shivDocument:q,createElement:n,createDocumentFragment:o};a.html5=r,q(b)}(this,b),e._version=d,e.mq=s,e.testStyles=r,e}(this,this.document);
window.LocaleMapping=function(t){this.data=t||{};var e,a=window.jQuery,n=!1;this.addData=function(t,e){e?(this.data.collection||(this.data.collection={}),a.extend(!0,this.data.collection,t)):a.extend(!0,this.data,t)},this.getText=function(t){var e="";return this.data.json&&"undefined"!=typeof this.data.json[t]?e=this.data.json[t]:"undefined"!=typeof this.data[t]?e=this.data[t]:DisneyID.log('Error: no value found in client-side JSON for name: "'+t+'"'),e},this.getAlertText=function(t,e){var n=a("body").hasClass("branded"),i=this.getText("clnt_oops"),s=this.getText(t),r='<b class="icon"></b><strong>'+i+"</strong>"+(n?" ":"<br />")+s;return void 0!==e&&(r+=e),{message:r}};try{n=!!JSON.parse(DisneyID.getParameterByName("debug")).l10n.includeTraceData}catch(i){}if(n){e=this.getText;var s=function(){var t,e=(new Error).stack.split(" at "),a=3;return e[a].indexOf("getAlertText")>=0&&a++,"undefined"!=typeof e[a]&&(t=(e[a].match(/\((.*)\)/)||e[a].match(/(.*)/))[1].match(/.*\/([^/:?]*)(\?[^:]*)?:(\d*)(:(\d*))?$/)),t[1]+":"+t[3]};this.getText=function(){var t=e.apply(this,arguments);return"string"==typeof t&&(t=t.replace("</t>"," <br /><b>JS:</b> "+s()+"</t>")),t}}};
var DID_Address={};DID_Address.ADDRESS_FIELD="addresses",DID_Address.HOME_STR="HOME",DID_Address.NOT_ALLOWED="NOT_ALLOWED",DID_Address.DEFAULT_TYPE=DID_Address.HOME_STR,DID_Address.subfields=["line1","line2","line3","city","stateProvince","postalCode","country","preferred"],DID_Address.addressList={},DID_Address.addressOrderTypes={JP:"alt1"},DID_Address.createListToDisplay=function(e,s){"use strict";var d,r,a,i,n,t,l,o=0,p=!0;if($(".region").remove(),DID_Address.$parent=DID_Address.getAddressesParent(),DID_Address.$parent.empty(),_.get(s,"profile.addresses")?l=$.extend(!0,{},s.profile.addresses):(l={},p=!1),_.get(s,"fieldsRequired.profile.addresses.add")){for(d in s.fieldsRequired.profile.addresses.add)if(s.fieldsRequired.profile.addresses.add.hasOwnProperty(d))for(r=s.fieldsRequired.profile.addresses.add[d].quantity,a=1;r>=a;a+=1)l[o]=DID_Address.createBlankAddressObject(o,d),o+=1}else if(e)for(d in e)e.hasOwnProperty(d)&&"use"!==d&&(i=e[d],n=DID_Subfields.isRequired(d,i,l),t=DID_Subfields.typeAlreadyExists(l,d),n&&!t&&(l[o]=DID_Address.createBlankAddressObject(o,d),o+=1));return p||0!==o||_.get(DID_Subfields,"use.addresses.use")===DID_Address.NOT_ALLOWED||(d=DID_Address.DEFAULT_TYPE,l[0]=DID_Address.createBlankAddressObject(0,d)),l},DID_Address.getDisplayRules=function(e){"use strict";return DID_Subfields.getDisplayRules(e,DID_Address.ADDRESS_FIELD,DID_Address.subfields)},DID_Address.display=function(e,s){"use strict";var d,r,a;r=DID_Address.getDisplayRules(e),a=DID_Address.createListToDisplay(r,s);for(d in a)a.hasOwnProperty(d)&&DID_Address.addAddressElementToForm(a[d],s)},DID_Address.createBlankAddressObject=function(e,s){"use strict";return{addressGuid:e,city:"",country:"",eTag:"",line1:"",line2:"",line3:"",postalCode:"",preferred:"",stateProvince:"",type:s}},DID_Address.addAddressElementToForm=function(e,s){"use strict";var d,r,a,i,n,t=e.type,l=e.addressGuid;if(d=_.get(DID_Subfields,"use.addresses."+t+".use")?DID_Subfields.use.addresses[t].use:_.get(DID_Subfields,"use.addresses.use")?DID_Subfields.use.addresses.use:DID_Fields.OPTIONAL_STR,d!==DID_Address.NOT_ALLOWED){i=this.createAddressElement(e,s),i.addClass(d),r=_.get(DID_Subfields,"use.addresses."+t+".fields")?DID_Subfields.use.addresses[t].fields:_.get(DID_Subfields,"use.addresses.DEFAULT.fields")?DID_Subfields.use.addresses.DEFAULT.fields:{};for(a in r)r.hasOwnProperty(a)&&(n=i.find("#addresses_"+l+"_"+a),r[a]===DID_Fields.NOT_ALLOWED_STR?n.parent().remove():r[a]===DID_Fields.REQUIRED_STR&&(n.addClass("required"),"type"!==a&&n.parent().find("label").addClass("required"),"stateProvince"===a&&n.parent().attr("data-required","true")))}void 0===DID_Address.$parent&&(DID_Address.$parent=DID_Address.getAddressesParent()),DID_Address.$parent.append(i)},DID_Address.createAddressElement=function(e,s,d){"use strict";var r,a,i=e.addressGuid,n=s,t="DEFAULT"===e.type?DID_Address.DEFAULT_TYPE:e.type,l=localeMap.getText("clnt_address"),r=localeMap.data.profileAddressType[t]+" "+localeMap.getText("clnt_address"),o=localeMap.getText("clnt_address_delete"),p=localeMap.getText("clnt_country"),c=localeMap.getText("countryAlpha2"),D=localeMap.getText("clnt_city"),u=localeMap.getText("clnt_postal_code"),f=_.get(DisneyID,"uiConfig.brandedExperience.enabled")===!0,A=$("body").hasClass("page-update-profile"),y=f&&A,I=$('<div class="addresses_container" id="addresses_'+i+'_container"></div>'),v=$("<address></address>"),g=$('<input type="hidden" id="addresses_'+i+'_eTag" name="addresses_'+i+'_eTag" />').val(e.eTag),h=$('<input type="hidden" id="addresses_'+i+'_type" name="addresses_'+i+'_type" />').val(t),C=d?"":'<span class="delete_address_span" style="float:right; cursor:pointer;"><a href="javascript:void(0);" class="delete_address_link show-when-editing" data-guid="'+i+'">'+o+"</a></span>",b="<h3>"+r+"</h3>",T=$("<div></div>").addClass("address_country control-group col hideonanyclick").append('<label for="addresses_'+i+'_country" class="inline-label">'+p+"</label>"),O=$("<select></select>",{id:"addresses_"+i+"_country",name:"addresses_"+i+"_country"}).addClass("colored"),L=$("<div></div>").addClass("cols cols-halfs countryCodeContainer"),E=$("<div></div>").addClass("cols cols-halfs stateProvinceContainer"),P=$("<div></div>").addClass("cols cols-halfs postalCodeContainer"),F=$('<div class="col control-group address_city hideonanyclick"><label for="addresses_'+i+'_city" class="inline-label">'+D+"</label></div>"),m=$('<input type="text" id="addresses_'+i+'_city" name="addresses_'+i+'_city" maxlength="100" '+(DisneyID.uiConfig.inlineLabels?'placeholder="'+D+'"':"")+"/>").val(e.city),S=$("<div></div>").addClass("control-group col address_stateProvince hideonanyclick"),x=$('<div class="col control-group address_postalCode hideonanyclick"><label for="addresses_'+i+'_postalCode" class="inline-label">'+u+"</label></div>"),R=$('<input type="text" id="addresses_'+i+'_postalCode" name="addresses_'+i+'_postalCode" maxlength="20" '+(DisneyID.uiConfig.inlineLabels?'placeholder="'+u+'"':"")+"/>").val(e.postalCode),k=_.get(s,"geolocation.countryAlpha2");I.append(C+b),v.append(g),v.append(h),DisneyID.uiConfig.inlineLabels&&O.append('<option value="">'+localeMap.getText("clnt_country")+"</option>"),O.append('<option value=""> -- </option>');for(var M in c)c.hasOwnProperty(M)&&O.append($("<option></option>").val(M).text(c[M]));O.val(e.country),T.append(O);var w=DID_Address.buildAddressLineField(e,t,i,l,"line1","OPTIONAL"===_.get(n,"compliance.fields.profile.addresses.type."+e.type+".fields.line1.use")),U=DID_Address.buildAddressLineField(e,t,i,l,"line2","OPTIONAL"===_.get(n,"compliance.fields.profile.addresses.type."+e.type+".fields.line2.use")),q=DID_Address.buildAddressLineField(e,t,i,l,"line3","OPTIONAL"===_.get(n,"compliance.fields.profile.addresses.type."+e.type+".fields.line3.use"));F.append(m),CountryRegionView.render(s,S,e);var N=_.get(DisneyID.uiConfig,"geoLocationAddressFieldOrder"),j=_.get(DisneyID.uiConfig,"defaultAddressFieldOrder"),W=N?k:"DEFAULT";switch($(document.body).on("change","#addresses_"+i+"_country",function(){e={country:$(this).val(),stateProvince:"",addressGuid:i},CountryRegionView.render(s,S,e),DID_Address.orderAddressFields(void 0===j||N?$(this).val():j,$(this).parent().parent().parent())}),x.append(R),y===!1&&L.append(T),E.append(F),E.append(S),P.append(x),""!==e.country&&N?W=DID_Address.addressOrderTypes[e.country]:void 0!==j?W=DID_Address.addressOrderTypes[j]:N&&(W=DID_Address.addressOrderTypes[k]),W){case"alt1":v.append(L),v.append(P),v.append(E),v.append(w),v.append(U),v.append(q);break;default:v.append(L),v.append(w),v.append(U),v.append(q),v.append(E),v.append(P)}return y===!0&&(a=$("<div></div>").addClass("cols cols-halfs"),a.append(T),v.append(a)),I.append(v),I},DID_Address.orderAddressFields=function(e,s){var d="DEFAULT",r=_.get(DisneyID.uiConfig,"geoLocationAddressFieldOrder"),a=_.get(DisneyID.uiConfig,"defaultAddressFieldOrder");switch(a&&!r?d=DID_Address.addressOrderTypes[a]:r&&(d=DID_Address.addressOrderTypes[e]),d){case"alt1":s.children(".postalCodeContainer").insertAfter(s.children(".countryCodeContainer")),s.children(".stateProvinceContainer").insertAfter(s.children(".postalCodeContainer")),s.children(".address_line1").insertAfter(s.children(".stateProvinceContainer")),s.children(".address_line2").insertAfter(s.children(".address_line1")),s.children(".address_line3").insertAfter(s.children(".address_line2"));break;default:s.children(".address_line1").insertAfter(s.children(".countryCodeContainer")),s.children(".address_line2").insertAfter(s.children(".address_line1")),s.children(".address_line3").insertAfter(s.children(".address_line2")),s.children(".stateProvinceContainer").insertAfter(s.children(".address_line3")),s.children(".postalCodeContainer").insertAfter(s.children(".stateProvinceContainer"))}},DID_Address.buildAddressLineField=function(e,s,d,r,a,i){var n=$('<div class="cols cols-halfs address_'+a+'"></div>'),t=$('<div class="col control-group hideonanyclick"></div>'),l=$("<input />",{type:"text",id:"addresses_"+d+"_"+a,name:"addresses_"+d+"_"+a,maxlength:"100","aria-label":r});switch(a){case"line1":t.append($('<label for="addresses_'+d+'_line1" class="inline-label">'+r+"</label>")),l.addClass("street_line_1").prop("placeholder",DisneyID.uiConfig.inlineLabels?r:"").val(e.line1);break;case"line2":l.addClass("street_line_2").val(e.line2),i&&l.prop("placeholder","("+localeMap.getText("clnt_optional")+")");break;case"line3":l.addClass("street_line_3").val(e.line3),i&&l.prop("placeholder","("+localeMap.getText("clnt_optional")+")")}return t.append(l),n.append(t),n},DID_Address.getAddressesParent=function(){var e;return e=$("#addresses > address"),0===e.length&&(e=$("#addresses .addresses_container")),0===e.length?$("#addresses"):e.parent()},DID_Address.cleanFields=function(e,s){"use strict";var d=["country","line1","line2","line3","city","stateProvince","postalCode"];return DID_Subfields.prepareSubfieldsForUpdate(e,s,"addresses",d)},DID_Address.isEmptyAddress=function(e){"use strict";var s,d=0;for(s in e)e.hasOwnProperty(s)&&"type"!==s&&(d+=1);return 0===d},DID_Address.noChangedFields=function(e,s,d){"use strict";return void 0!==e.preferred&&""!==e.preferred||void 0!==e.country&&""!==e.country||void 0!==e.line1&&""!==e.line1||void 0!==e.line2&&""!==e.line2||void 0!==e.line3&&""!==e.line3||void 0!==e.city&&""!==e.city||void 0!==e.stateProvince&&""!==e.stateProvince||void 0!==e.postalCode&&""!==e.postalCode||_.get(s,"addresses."+d)?!1:!0};
var CountryRegionView=function(e){"use strict";function n(e){var n=s+'<input type="text" id="addresses_{{addressGuid}}_stateProvince" name="addresses_{{addressGuid}}_stateProvince" maxlength="200" value="{{stateProvince}}" '+(e.inlineLabels?'placeholder="'+localeMap.getText("clnt_region")+'"':"")+">";return a(n,e)}function t(e){var n=s+'<select id="addresses_{{addressGuid}}_stateProvince" name="addresses_{{addressGuid}}_stateProvince" class="colored">';return a(n,e)}function a(e,n){return e.replace(/{{addressGuid}}/g,n.addressGuid).replace("{{label}}",n.label).replace("{{stateProvince}}",n.stateProvince||"")}function r(e){var n=$.Deferred();return CountryRegions.getRegions(e.country).done(function(t){var a='<option value="{{code}}">{{name}}</option>',r="";t=t.slice(0),t.unshift(e.inlineLabels?{code:"",name:e.label}:{code:"",name:" -- "});for(var s=0;s<t.length;s++)r+=a.replace("{{code}}",t[s].code||"").replace("{{name}}",t[s].name||"");n.resolve(r)}).fail(function(){n.reject()}),n.promise()}var s='<label for="addresses_{{addressGuid}}_stateProvince" class="inline-label">{{label}}</label>';return e.render=function(e,a,s){var i=CountryRegions.getDefaultCountry(_.get(e,"geolocation.countryAlpha2"),s),d={country:i,addressGuid:s.addressGuid,label:CountryRegions.getRegionTypeLabel(i),inlineLabels:DisneyID.uiConfig.inlineLabels,stateProvince:_.get(s,"stateProvince")},o="true"===a.attr("data-required");CountryRegions.hasRegions(i)?(a.html(t(d)).find("select:first").attr("disabled",!0),r(d).done(function(e){a.find("select:first").html(e).attr("disabled",!1).val(s.stateProvince)})):a.html(n(d)),o&&a.children().addClass("required")},e}({});
var CountryRegions=function(e){function n(e,n){for(var r,t=n.collections[e].strings,P=J[e].split(","),i=0;i<P.length;i++)r=P[i],P[i]={code:r,name:t[r]};return P}function r(e){var n;for(n in J)if(-1!==_.indexOf(J[n].split(","),e))return _.invert(P)[n]}var t={DEFAULT:"clnt_region",US:"clnt_state",CA:"clnt_province",JP:"clnt_prefecture"},P={US:"states",CA:"provinces",JP:"prefectures"},J={states:"AL,AK,AZ,AR,CA,CO,CT,DE,DC,FL,GA,HI,ID,IL,IN,IA,KS,KY,LA,ME,MD,MA,MI,MN,MS,MO,MT,NE,NV,NH,NJ,NM,NY,NC,ND,OH,OK,OR,PA,RI,SC,SD,TN,TX,UT,VT,VA,WA,WV,WI,WY",provinces:"AB,BC,MB,NB,NL,NT,NS,NU,ON,PC,QC,SK,YT",prefectures:"JP-01,JP-02,JP-03,JP-04,JP-05,JP-06,JP-07,JP-08,JP-09,JP-10,JP-11,JP-12,JP-13,JP-14,JP-15,JP-16,JP-17,JP-18,JP-19,JP-20,JP-21,JP-22,JP-23,JP-24,JP-25,JP-26,JP-27,JP-28,JP-29,JP-30,JP-31,JP-32,JP-33,JP-34,JP-35,JP-36,JP-37,JP-38,JP-39,JP-40,JP-41,JP-42,JP-43,JP-44,JP-45,JP-46,JP-47"},i={};return e.getDefaultCountry=function(e,n){var t,P=n.stateProvince;return P&&(t=r(P))?t:n.country?n.country:"JP"===e||"CA"===e?e:"US"},e.hasRegions=function(e){return void 0!==P[e]},e.getRegions=function(e){var r,t=P[e],J=i[t]?i[t].deferred:$.Deferred(),o=i[t]?i[t].promise:J.promise();return t?i[t]||(r=[DisneyID.l10n.serviceUrl,t,DisneyID.l10n.language,DisneyID.getParameterByName("client_id")].join("/")+"?jsonFormat=nested",$.ajax(r,{dataType:"jsonp"}).done(function(e){var r=n(t,e);J.resolve(r)}).fail(function(e){J.reject(e)}),i[t]={deferred:J,promise:o}):J.reject(),o},e.getRegionTypeLabel=function(e){var n=t[e]||t.DEFAULT;return localeMap.getText(n)},e}({});
var DID_Phones={};DID_Phones.FIELD_PHONE="phones",DID_Phones.NIGHT_STR="NIGHT",DID_Phones.DEFAULT_TYPE=DID_Phones.NIGHT_STR,DID_Phones.subfields=["number","internationalPrefix","extension","preferred"],DID_Phones.phoneList={},DID_Phones.createListToDisplay=function(e,n){"use strict";var s,i,o,t,l,a,r,p=0,d=!0;if(DID_Phones.$phonesParent=$("#phones"),DID_Phones.$phonesParent.empty(),_.get(n,"profile.phones")?t=$.extend(!0,{},n.profile.phones):(d=!1,t={}),_.get(n,"fieldsRequired.profile.phones.add")){for(s in n.fieldsRequired.profile.phones.add)if(n.fieldsRequired.profile.phones.add.hasOwnProperty(s))for(i=n.fieldsRequired.profile.phones.add[s].quantity,r=1;i>=r;r+=1)t[p]=DID_Phones.createBlankPhoneObject(p,s),p+=1}else if(e)for(s in e)e.hasOwnProperty(s)&&"use"!==s&&(o=e[s],l=DID_Subfields.isRequired(s,o,t),a=DID_Subfields.typeAlreadyExists(t,s),l&&!a&&(t[p]=DID_Phones.createBlankPhoneObject(p,s),p+=1));return d||0!==p||_.get(e,"use")===DID_Fields.NOT_ALLOWED_STR||(s=DID_Phones.DEFAULT_TYPE,t[0]=DID_Phones.createBlankPhoneObject(0,s)),t},DID_Phones.getDisplayRules=function(e){"use strict";return DID_Subfields.getDisplayRules(e,DID_Phones.FIELD_PHONE,DID_Phones.subfields)},DID_Phones.display=function(e,n){"use strict";var s,i,o;i=DID_Phones.getDisplayRules(e),o=DID_Phones.createListToDisplay(i,n);for(s in o)o.hasOwnProperty(s)&&DID_Phones.addPhoneElementToForm(o[s])},DID_Phones.addHandlersForToggling=function(e,n){"use strict";var s=$(".contact-information"),i=["#phones_"+e+"_internationalPrefix","#phones_"+e+"_number","#phones_"+e+"_extension"].join(",");n=_.map(n,function(n){return"phones_"+e+"_"+n}),s.on("keyup",i,{fieldsSelector:i,toggleRequiredFields:n},function(e){var s=0,i=$(e.data.fieldsSelector);i.not(_.map(n,function(e){return"#"+e}).join(",")).each(function(){s+=this.value.length}),_.each(n,function(e){s>0?DID_Fields.markAsRequired(e):DID_Fields.markAsOptional(e)})})},DID_Phones.createBlankPhoneObject=function(e,n){"use strict";return{type:n,extension:"",internationalPrefix:"",number:"",phoneGuid:e,preferred:"",isNew:!0}},DID_Phones.addPhoneElementToForm=function(e){"use strict";var n,s,i,o,t,l,a=[];if(i=e.type,l=e.phoneGuid,n=DID_Phones.getFieldDisplayRules(i),n.required!==DID_Fields.NOT_ALLOWED_STR){t=this.createPhoneElement(e),t.addClass(n.required);for(s in n.subfields)n.subfields.hasOwnProperty(s)&&(o=t.find("#phones_"+l+"_"+s),n.subfields[s]===DID_Fields.NOT_ALLOWED_STR?o.parent().remove():n.subfields[s]===DID_Fields.NOT_SETTABLE_STR?DID_Fields.markAsNotSettable(s):n.subfields[s]===DID_Fields.REQUIRED_STR&&n.required===DID_Fields.REQUIRED_STR?(o.addClass("required"),"type"!==s&&o.parent().find("label").addClass("required")):n.subfields[s]===DID_Fields.REQUIRED_STR&&n.required===DID_Fields.OPTIONAL_STR&&a.push(s));a.length&&DID_Phones.addHandlersForToggling(l,a),DID_Phones.$phonesParent.append(t)}},DID_Phones.getFieldDisplayRules=function(e){"use strict";var n,s,i;return s=_.get(DID_Subfields,"use.phones."+DID_Phones.DEFAULT_TYPE+".use")?DID_Subfields.use.phones[DID_Phones.DEFAULT_TYPE].use:_.get(DID_Subfields,"use.phones.use")?DID_Subfields.use.phones.use:DID_Fields.OPTIONAL_STR,n=_.get(DID_Subfields,"use.phones."+e+".fields")?DID_Subfields.use.phones[e].fields:_.get(DID_Subfields,"use.phones.DEFAULT.fields")?DID_Subfields.use.phones.DEFAULT.fields:{},i={required:s,subfields:n}},DID_Phones.createPhoneElement=function(e){"use strict";var n,s,i,o,t,l,a,r,p;return n=e.phoneGuid,"DEFAULT"===e.type&&(e.type=DID_Phones.DEFAULT_TYPE),p=$('<div class="control-group cols phone"></div>'),p.append("<h3>"+localeMap.data.profilePhoneType[e.type]+" "+localeMap.getText("clnt_phone")+"</h3>"),p.append($('<input type="hidden" id="phones_'+n+'_type" name="phones_'+n+'_type" />').val(e.type)),p.append($('<input type="hidden" id="phones_'+n+'_phoneGuid" name="phones_'+n+'_phoneGuid" />').val(n)),p.append($('<input type="hidden" id="phones_'+n+'_eTag" name="phones_'+n+'_eTag" />').val(e.eTag)),s=$('<div class="col"></div>'),i=$('<label class="internationPrefixLabel inline-label"for="phones_'+n+'_internationPrefix">'+localeMap.getText("clnt_phone_international_prefix")+"</label>"),o=$('<input type="tel"class="internationalPrefix"id="phones_'+n+'_internationalPrefix"name="phones_'+n+'_internationalPrefix"maxlength="3"aria-label="'+localeMap.getText("clnt_phone_international_prefix")+'"placeholder="'+localeMap.getText("country_dialing_code")+'" />').val(e.internationalPrefix),s.append(i).append(o),p.append(s),s=$('<div class="col"></div>'),t=$('<label class="phoneNumberLabel inline-label"for="phones_'+n+'_number">'+localeMap.getText("clnt_phone_number")+"</label>"),l=$('<input type="tel"id="phones_'+n+'_number"name="phones_'+n+'_number"class="phone-number"maxlength="16"'+(DisneyID.uiConfig.inlineLabels?'placeholder="'+localeMap.getText("clnt_phone_number")+'"':"")+" />").val(e.number),s.append(t).append(l),p.append(s),s=$('<div class="col"></div>'),a=$('<label class="extensionLabel inline-label" for="phones_'+n+'_extension">'+localeMap.getText("clnt_phone_extension")+"</label>"),r=$('<input type="tel"class="extension"id="phones_'+n+'_extension"name="phones_'+n+'_extension"maxlength="6"'+(DisneyID.uiConfig.inlineLabels?'placeholder="'+localeMap.getText("clnt_phone_ext")+'"':"")+" />").val(e.extension),s.append(a).append(r),p.append(s),p},DID_Phones.noChangedFields=function(e){"use strict";return void 0!==e.preferred&&""!==e.preferred||void 0!==e.internationalPrefix&&""!==e.internationalPrefix||void 0!==e.number&&""!==e.number||void 0!==e.extension&&""!==e.extension?!1:!0},DID_Phones.cleanFields=function(e,n){"use strict";var s=["number","internationalPrefix","extension"];return DID_Subfields.prepareSubfieldsForUpdate(e,n,"phones",s)};
var DID_Fields={};DID_Fields.NOT_ALLOWED_STR="NOT_ALLOWED",DID_Fields.NOT_SETTABLE_STR="NOT_SETTABLE",DID_Fields.OPTIONAL_STR="OPTIONAL",DID_Fields.REQUIRED_STR="REQUIRED",DID_Fields.WRITE_ONCE_STR="WRITE_ONCE",DID_Fields.DEFAULT_STR="DEFAULT",DID_Fields.markAsRequired=function(e){"use strict";var r=$("gender"===e?"#"+e.replace(".","\\."):"#"+e.replace(".","\\.")+":not([type='hidden'])");if(r.length>0)if(r.addClass("required").prop("aria-required",!0),$('label[for="'+e+'"]').addClass("required"),"dateOfBirth"===e)$("body").addClass("dob-required"),$("#birthdate-month").prop("aria-required",!0),$("#birthdate-day").prop("aria-required",!0),$("#birthdate-year").prop("aria-required",!0);else if("gender"===e){r.parent().addClass("required").prop("aria-required",!0);try{$("#gender").rules("add",{min:1,messages:{min:_.get($,"validator.messages.required","")}})}catch(s){DisneyID.log('Failed to set gender rule "min: 1"... Validate not initialized yet?')}}else r.parent().addClass("required").prop("aria-required",!0);else $('label[for="'+e+'"]').addClass("required")},DID_Fields.markAsOptional=function(e){"use strict";var r=$("#"+e.replace(".","\\.")+":not([type='hidden'])");r.length>0?"dateOfBirth"===e?(r.removeClass("required"),$('label[for="'+e+'"]').removeClass("required"),$("body").removeClass("dob-required")):(r.removeClass("required"),$('label[for="'+e+'"]').removeClass("required"),r.parent().removeClass("required")):$('label[for="'+e+'"]').removeClass("required")},DID_Fields.markAsNotSettable=function(e){"use strict";var r,s=$("#"+e.replace(".","\\.")+":not([type='hidden'])");s.length>0&&(r=!!s.val(),r?s.attr("disabled","disabled"):s.closest(".control-group, .control-wrap").remove())},DID_Fields.removeFromForm=function(e,r){"use strict";var s,d,i,a;DisneyID.log(e+" not allowed. Removing from form."),a=$("#"+e.replace(".","\\.")),i="legalRequirements"===r,s=!!a.val(),d=DisneyID.isFeatureEnabled("invokedFromEmail"),"gender"===e&&"0"===a.val()&&(s=!1),!i&&d&&s||a.closest(".control-group, .control-wrap").remove()},DID_Fields.display=function(e,r){"use strict";var s,d,i,a,l;l=$("body").hasClass("page-update-profile");for(s in e)e.hasOwnProperty(s)&&(DisneyID.isFeatureEnabled("invokedFromEmail")&&(a=$("#"+s.replace(".","\\.")),d=!!a.val(),i="legalRequirements"===e[s].source,d&&!i&&(e[s].use=DID_Fields.OPTIONAL_STR,e[s].editable=e[s].legalRequirementsEditable),e[s].use===DID_Fields.NOT_ALLOWED_STR&&e[s].legalRequirementsUse===DID_Fields.NOT_SETTABLE_STR&&(e[s].use=DID_Fields.NOT_SETTABLE_STR)),l&&d&&e[s].editable===DID_Fields.WRITE_ONCE_STR&&a.attr("disabled","disabled"),e[s].use===DID_Fields.NOT_ALLOWED_STR?DID_Fields.removeFromForm(s,e[s].source):e[s].use===DID_Fields.REQUIRED_STR?DID_Fields.markAsRequired(s):e[s].use===DID_Fields.NOT_SETTABLE_STR&&DID_Fields.markAsNotSettable(s),s===DID_Address.ADDRESS_FIELD&&e[s].use!==DID_Fields.NOT_ALLOWED_STR?DID_Address.display(e[DID_Address.ADDRESS_FIELD],r):s===DID_Phones.FIELD_PHONE&&e[s].use!==DID_Fields.NOT_ALLOWED_STR&&DID_Phones.display(e[DID_Phones.FIELD_PHONE],r))},DID_Fields.prepareForUpdate=function(e,r,s){"use strict";var d,i,a;return e["original-password"]&&e.password?d={username:s.username,password:e["original-password"]}:delete e.password,delete e["original-password"],delete e["password-check"],delete e["show-password"],delete e["more-info"],delete e["birthdate-day"],delete e["birthdate-month"],delete e["birthdate-year"],delete e.checkbox,i=DID_Fields.getUpdateFieldsObj(e,s),"undefined"!=typeof d&&(i.profile.originalCredentials=d),DID_Address.cleanFields(i,s),DID_Phones.cleanFields(i,s),0===_.size(i.profile)&&(delete i.profile,DisneyID.log("Deleted empty profile")),r===!1&&(a=DID_GoKart.getGoKartObjectFromForm(),$.isEmptyObject(a)||(i.goKart=a)),$.each(i,function(e){e.toLowerCase().indexOf("securityquestions")>-1&&delete i[e]}),(r===!0&&$(".security-questions").hasClass("editing")||r===!1)&&(i.grx=SecurityQuestions.getAnswers(),$.isEmptyObject(i.grx)&&delete i.grx),i},DID_Fields.getUpdateFieldsObj=function(e,r){"use strict";var s,d,i={};for(d in e)e.hasOwnProperty(d)&&(s=d.split("_"),s.length>1?DID_Subfields.addIfUpdated(r,i,e,d):DID_Fields.addIfUpdated(r,i,e,d));return i},DID_Fields.addIfUpdated=function(e,r,s,d){"use strict";var i,a;return i=s[d],a=_.get(e,d),!a&&""===i||i===a?void DisneyID.log("Not updating "+d+": "+e[d]+"::"+i):(DisneyID.log("Changing "+d),_.get(r,"profile")||(r.profile={},_.get(e,"eTag")&&(r.profile.eTag=e.eTag)),void(r.profile[d]=i))};
var DID_Subfields={};DID_Subfields.DEFAULT_MIN=0,DID_Subfields.DEFAULT_MAX=1e3,DID_Subfields.DEFAULT_STR="DEFAULT",DID_Subfields.DEFAULT_USE="OPTIONAL",DID_Subfields.use={},DID_Subfields.typesFound=0,DID_Subfields.getDisplayRules=function(e,s,t){"use strict";var i,u,D,f,l,n,r;if(_.get(DID_Subfields,"use."+s))return DID_Subfields.use[s];for(DID_Subfields.use[s]={},n=$.extend(!0,{},e),f=_.get(n,"type.DEFAULT.use")?n.type.DEFAULT.use:_.get(n,"use")?n.use:DID_Fields.OPTIONAL_STR,DID_Subfields.use[s].use=f,_.get(n,"type.DEFAULT.use")||(_.get(n,"type")||(n.type={}),_.get(n,"type.DEFAULT")||(n.type.DEFAULT={}),n.type.DEFAULT.use=f),_.get(n,"type.DEFAULT.fields")||(n.type.DEFAULT.fields={}),r=0;r<t.length;r+=1)_.get(n,"type.DEFAULT.fields."+t[r])||(n.type.DEFAULT.fields[t[r]]={use:DID_Subfields.DEFAULT_USE});if(D=n.type,_.get(n,"type.DEFAULT.fields"))for(u in D)D.hasOwnProperty(u)&&DID_Subfields.createNewTypeConfig(n.type.DEFAULT.fields,u,s,n.type.DEFAULT.use);DID_Subfields.typesFound=1;for(u in D)if(D.hasOwnProperty(u)&&u!==DID_Subfields.DEFAULT_STR){DID_Subfields.typesFound+=1,_.get(DID_Subfields,"use."+s+"."+u)||(DID_Subfields.use[s][u]={},DID_Subfields.use[s][u].fields={},DID_Subfields.use[s][u].use=f),DID_Subfields.use[s][u].use=_.get(D,u+".use")?D[u].use:f,l=D[u].fields;for(i in l)l.hasOwnProperty(i)&&(DID_Subfields.use[s][u].fields[i]=D[u].fields[i].use)}return DID_Subfields.typesFound>1&&_.get(DID_Subfields,"use."+s+"."+DID_Fields.DEFAULT_STR)&&delete DID_Subfields.use[s][DID_Fields.DEFAULT_STR],_.get(DID_Subfields,"use."+s)},DID_Subfields.createNewTypeConfig=function(e,s,t,i){"use strict";var u;_.get(DID_Subfields,"use."+t+"."+s)||(DID_Subfields.use[t][s]={},DID_Subfields.use[t][s].fields={},DID_Subfields.typesFound+=1),DID_Subfields.use[t][s].use=i;for(u in e)e.hasOwnProperty(u)&&(DID_Subfields.use[t][s].fields[u]=e[u].use)},DID_Subfields.getMinMax=function(e,s){"use strict";var t,i,u,D;_.get(DID_Subfields,"use.fieldName")||(DID_Subfields.use[s]={}),t=_.get(e,"type.DEFAULT.quantityMin")?e.type.DEFAULT.quantityMin:_.get(e,"quantityMin")?e.quantityMin:DID_Subfields.DEFAULT_MIN,i=_.get(e,"type.DEFAULT.quantityMax")?e.type.DEFAULT.quantityMax:_.get(e,"quantityMax")?e.quantityMax:DID_Subfields.DEFAULT_MAX,DID_Subfields.use[s].min=parseInt(t,10),DID_Subfields.use[s].max=parseInt(i,10),u=e.type;for(D in u)u.hasOwnProperty(D)&&"DEFAULT"!==D&&(_.get(DID_Subfields,"use."+s+"."+D)||(DID_Subfields.use[s][D]={}),DID_Subfields.use[s][D].min=t,DID_Subfields.use[s][D].max=i);for(D in u)u.hasOwnProperty(D)&&"DEFAULT"!==D&&(_.get(u,D+".quantityMin")&&(DID_Subfields.use[s][D].min=parseInt(u[D].quantityMin,10)),_.get(u,D+".quantityMax")&&(DID_Subfields.use[s][D].max=parseInt(u[D].quantityMax,10)))},DID_Subfields.isRequired=function(e,s,t){"use strict";var i,u=!1,D=0;if((_.get(s,"use")===DID_Fields.REQUIRED_STR||_.get(s,"use")===DID_Fields.OPTIONAL_STR)&&(u=!0),u&&e===DID_Fields.DEFAULT_STR){for(i in t)t.hasOwnProperty(i)&&(D+=1);D>0&&(u=!1)}return u},DID_Subfields.typeAlreadyExists=function(e,s){"use strict";var t,i;for(i in e)if(e.hasOwnProperty(i)&&(t=e[i],_.get(t,"type")===s))return!0;return!1},DID_Subfields.addIfUpdated=function(e,s,t,i){"use strict";var u,D,f,l,n,r;if(r=i.split("_"),u=r[0],n=r[1],l=r[2],D=_.get(t,i,""),f=_.get(e,u+"."+n+"."+l,""),D=null===D?"":D,f=null===f?"":f,"legal"===u)_.get(s,u)||(s[u]=[]),s[u]=D.split(",");else if("addresses"===u||"phones"===u){var d=D!==f,p="profile."+u+"."+n;_.get(s,p)||_.set(s,p,{}),d&&""!==D||"type"===l||"eTag"===l?s.profile[u][n][l]=D:d&&""===D&&(s.profile[u][n][l]=null)}else _.get(s,u)||(s[u]={}),s[u][n]=D},DID_Subfields.prepareSubfieldsForUpdate=function(e,s,t,i){function u(e){for(var s=0;s<i.length;s+=1){if("undefined"==typeof e[i[s]])return!1;if(""!==e[i[s]]&&null!==e[i[s]])return!1}return!0}function D(e){for(var s=0;s<i.length;s+=1)if("undefined"!=typeof e[i[s]])return!1;return!0}function f(e,s){var t,u={};for(t=0;t<i.length;t+=1)s.hasOwnProperty(i[t])&&(u[i[t]]=s[i[t]]),e.hasOwnProperty(i[t])&&(u[i[t]]=e[i[t]]);return u}var l;if("undefined"==typeof _.get(e,"profile."+t))return e;for(var n in e.profile[t])e.profile[t].hasOwnProperty(n)&&(l=null!==_.get(s,t,null)&&_.get(s,t,{}).hasOwnProperty(n)?f(e.profile[t][n],s[t][n]):e.profile[t][n],D(e.profile[t][n])?delete e.profile[t][n]:u(l)?e.profile[t][n]=null:_.get(e,"profile."+t+"."+n+".phoneGuid")&&e.profile[t][n].phoneGuid.length<=2&&delete e.profile[t][n].phoneGuid);return 0===_.size(e.profile[t])&&delete e.profile[t],e};
DisneyID.SharedStorage={isEnabled:DisneyID.isFeatureEnabled("sharedStorage"),hasFallback:DisneyID.isFeatureEnabled("sharedStorageFallback"),writeData:function(e,a,D,n){return DisneyID.log("Within DisneyID.SharedStorage.writeData"),!DisneyID.xhr||DisneyID.SharedStorage.isEnabled&&!DisneyID.SharedStorage.hasFallback?DisneyID.writeLocalData(e,a,null,D,null,null,n):DisneyID.xhr.writeLocalData(e,a,D,n)},readData:function(e,a){return DisneyID.log("Within DisneyID.SharedStorage.readData"),!DisneyID.xhr||DisneyID.SharedStorage.isEnabled&&!DisneyID.SharedStorage.hasFallback?DisneyID.readLocalData(e,null,a):DisneyID.xhr.readLocalData(e,a)},deleteData:function(e,a){return DisneyID.xhr&&!DisneyID.SharedStorage.isEnabled||DisneyID.xhr&&DisneyID.SharedStorage.isEnabled&&DisneyID.thirdPartyCookiesDisabled&&DisneyID.SharedStorage.hasFallback?DisneyID.xhr.deleteLocalData(e,a):DisneyID.deleteLocalData(e,null,null,a)}};
DisneyID.Notify=function(e){var s=this,n=$(s);s.trigger=function(){n.trigger.call(n,arguments[0],Array.prototype.slice.call(arguments,1))},s.on=function(e,o){n.on(e,function(){o.apply(s,Array.prototype.slice.call(arguments,1))})},s.buildCallbacks=function(e){return{success:"function"==typeof e?e:$.noop}},s.on("guest-login",function(n,o){e.postMessageTransport.send("syncDIDLoggedIn",{loggedin:!0}),s.onLogin(n,o)}),s.on("guest-logout",function(s){var n=this.buildCallbacks(s);e.postMessageTransport.send("syncDIDLoggedIn",{loggedin:!1}),e.log("Calling postMessageTransport.send('onLogout')"),e.postMessageTransport.send("onLogout",null,n)}),s.on("guest-create-login",function(n,o){e.postMessageTransport.send("syncDIDLoggedIn",{loggedin:!0}),s.onCreate(n,function(){s.createSuccess(n.profile,n,function(){s.onLogin(n,o)})})}),s.on("guest-create",function(e,n){s.onCreate(e,function(){s.createSuccess(e.profile,e,n)})}),s.on("guest-update",function(e,n){s.onUpdate(e,function(){s.updateSuccess(e.profile,e,n)})}),this.createSuccess=function(s,n,o){var t=this.buildCallbacks(o);e.isEventEnabled("createSuccess")?(e.log("checkMask passed. Calling createSuccess."),e.postMessageTransport.send("createSuccessFunction",{profile:s,guest:n},t)):t.success(n)},this.updateSuccess=function(s,n,o){var t=this.buildCallbacks(o);e.isEventEnabled("updateSuccess")?(e.log("checkMask passed. Calling updateSuccess."),e.postMessageTransport.send("updateSuccessFunction",{profile:s,guest:n},t)):t.success(n)},this.onCreate=function(s,n){var o=this.buildCallbacks(n);e.isEventEnabled("onCreate")?(e.log("checkMask passed. Calling onCreate."),e.postMessageTransport.send("onCreate",s,o)):o.success(s)},this.onUpdate=function(s,n){var o=this.buildCallbacks(n);e.isEventEnabled("onUpdate")?(e.log("checkMask passed. Calling onUpdate."),e.postMessageTransport.send("onUpdate",s,o)):o.success(s)},this.onLogin=function(s,n){var o=this.buildCallbacks(n),t=e.getParameterByNameFromString("sharedStoragePrefix",document.location.search);e.log("Calling postMessageTransport.send('onLogin')"),e.postMessageTransport.send("onLogin",{guest:s,sharedStoragePrefix:t},o)},this.onReady=function(s,n){var o=this.buildCallbacks(n);e.isEventEnabled("onReady")?(e.log("DisneyID.Notify.onReady"),e.postMessageTransport.send("onReady",s,o)):o.success(s)},this.onTokenRefresh=function(s,n){e.isEventEnabled("onTokenRefresh")&&e.postMessageTransport.send("onTokenRefresh",s),n&&n()},this.doTealium=function(s,n){e.postMessageTransport.send("doTealium",s),n&&n()}},DisneyID.Notify=new DisneyID.Notify(DisneyID);
DisneyID.Dispatch={},DisneyID.controllerPath="/controller/v1/",DisneyID.Dispatch._getDebugOptions=function(){var e=DisneyID.Dispatch.getParameterString("debug"),i=e?$.parseJSON(e):!1,t={};return"object"==typeof i&&(t=i),t.debugEnable=!!i,DisneyID.Dispatch._loadDebugOptions(t),t},DisneyID.Dispatch._loadDebugOptions=function(e){var i=DisneyID.getParameterByName("countryPref"),t=DisneyID.getParameterByName("continentPref");(i||t)&&(e.geolocation={},i&&(e.geolocation.countryAlpha2=i),t&&(e.geolocation.continentAlpha2=t))},DisneyID.Dispatch.getParameterString=function(e){var i=DisneyID.getParameterByName(e);return i||(i=DisneyID[e]?DisneyID[e].toString():""),i},DisneyID.Dispatch._buildData=function(e){var i={client_id:DisneyID.Dispatch.getParameterString("client_id"),env:DisneyID.Dispatch.getParameterString("env"),langPref:DisneyID.Dispatch.getParameterString("langPref"),debug:DisneyID.toJSON(DisneyID.Dispatch._getDebugOptions()),guest:DisneyID.toJSON(window.guest),UGAgeBand:_.get(window,"guest.profile.ageBand"),behavior:DisneyID.Dispatch.getParameterString("behavior_id")};return $.extend(i,e)},DisneyID.Dispatch.passwordLogin=function(e,i,t,n){DisneyID.log("Logging in...");var s=DisneyID.Dispatch._buildData({action:"passwordLogin",username:e,password:i,loadLoginInformation:t});DisneyID.Dispatch._doAJAX(s,n,"login")},DisneyID.Dispatch._readGuestData=function(e,i,t){DisneyID.log("DisneyID.Dispatch._readGuestData"),DisneyID.log(e),t=t||{writeWindow:!0};var n,s,a={};if(!e.SWID||!e.guest)return!1;try{s=sjcl.decrypt(e.SWID,"string"==typeof e.guest?e.guest:DisneyID.toJSON(e.guest))}catch(D){return DisneyID.log("DisneyID.Dispatch._readGuestData: "+D.message),!1}return s?(n=$.parseJSON(s),DisneyID.log(n),n.dataByClient?($.extend(a,n.dataShared),n.dataByClient&&n.dataByClient[i]&&$.extend(a,n.dataByClient[i]),$.isEmptyObject(a.token)&&(a.token=$.extend(!0,{},n.ssoToken))):a=n,t.writeWindow!==!1&&(window.guest=a),a):(DisneyID.log("DisneyID.Dispatch._readGuestData: failed to decrypt guest"),!1)},DisneyID.Dispatch._writeGuestData=function(e,i){function t(e,i){for(var t=$.extend(!0,{},i),n=t.token.clientId,s=0;s<D.length;s++)t.hasOwnProperty(D[s])&&(e.dataShared[D[s]]=t[D[s]]);for(var s=0;s<o.length;s++)t.hasOwnProperty(o[s])&&delete t[o[s]];e.ssoToken.swid=e.ssoToken.swid||_.get(i,"profile.swid"),e.ssoToken.ssoAssertion=e.ssoToken.ssoAssertion||_.get(i,"token.ssoAssertion"),e.dataByClient[n]=t}var n,s=i.token.swid,a={dataByClient:{},dataShared:{},dataSpecial:{},ssoToken:{swid:null,ssoAssertion:null}},D=["profile","grx","geolocation"],o=["legal","goKart","displayNameCreated","profile","grx","geolocation"];try{n=$.parseJSON("string"==typeof e.guest?sjcl.decrypt(e.SWID,e.guest):sjcl.decrypt(e.SWID,DisneyID.toJSON(e.guest))),n.dataByClient?n.ssoToken.swid===s?$.extend(a,n):DisneyID.log("New swid login overridding existing swid login."):n.token&&t(a,n)}catch(r){DisneyID.log("SharedGuestData Decode Error:",r)}return t(a,i),sjcl.encrypt(s,DisneyID.toJSON(a))},DisneyID.Dispatch.tokenLogin=function(e,i){function t(e,i,t){DisneyID.log("DisneyID.Dispatch.tokenLogin: Original tokens: ",e),DisneyID.Dispatch._getGuestByToken(i,{success:t.success,error:function(e){return DisneyID.log("DisneyID.Dispatch.tokenLogin: Couldn't retrieve guest data using a good token."),t&&t.error&&t.error(e),!1}},!0)}DisneyID.log("DisneyID.Dispatch.tokenLogin: Attempting tokenLogin...");var n={guest:1,SWID:1};DisneyID.SharedStorage.readData(n,function(n){var s,a,D=DisneyID.getParameterByName("client_id");if(null==n.SWID)return DisneyID.log("DisneyID.Dispatch.tokenLogin: Cannot retrieve SWID. Token login failed."),e&&e.error&&e.error("No data present"),!1;if(a=DisneyID.Dispatch._readGuestData(n,D),!a)return DisneyID.log("DisneyID.Dispatch.tokenLogin: Could not decrypt the guest object."),e&&e.error&&e.error(),!1;if(s=a.token,null!=s&&null!=s.access_token&&null!=s.ttl&&null!=s.creationTime&&i!==!0){var o=Math.round(_.now()/1e3);if(null!=a&&a.profile&&s.clientId==D&&parseInt(s.creationTime,10)+parseInt(s.ttl,10)-300>=o){if(DisneyID.log("DisneyID.Dispatch.tokenLogin: Good guest object, token time ok"),DisneyID.log("DisneyID.Dispatch.tokenLogin: Token ttl: "+s.ttl+"; Creation time: "+s.creationTime+"; Current time: "+o+"; Time left: "+(s.ttl-(o-s.creationTime))+"s"),_.get(e,"success"))return e.success(a),!0}else t(s,a,e)}else if(DisneyID.useTDS&&s.ssoAssertion||i)i&&delete a.profile,t(s,a,e);else if(DisneyID.log("DisneyID.Dispatch.tokenLogin: No guest data. Token information bad."),_.get(e,"error"))return e.error(),!1})},DisneyID.Dispatch.externalLogin=function(e,i,t,n,s){DisneyID.log("EXTERNAL-LOGIN: logging in...");var a=DisneyID.Dispatch._buildData({action:"externalLogin",namespace:e,external_id:i,external_token:t,username:n});DisneyID.log(a),DisneyID.Dispatch._doAJAX(a,s,"externalLogin")},DisneyID.Dispatch.getProfile=function(e,i,t){DisneyID.log("Getting guest information...",e);var n=DisneyID.Dispatch._buildData({action:"get",getFields:DisneyID.toJSON(e),tokenObj:DisneyID.toJSON(i)});DisneyID.Dispatch._doAJAX(n,t,"getProfile")},DisneyID.Dispatch.update=function(e,i,t){DisneyID.log("Updating guest information...");var n=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(e),guest:DisneyID.toJSON(i)});DisneyID.Dispatch._doAJAX(n,t,"updateProfile")},DisneyID.Dispatch.forceTokenRefresh=function(e){DisneyID.log("DisneyID.Dispatch.forceTokenRefresh refreshing access token..."),DisneyID.Dispatch.decodeGuestData({success:function(i){for(var t=["refresh_token","blueCookie","ssoAssertion"],n={action:"authorization",authorizationFields:{validateToken:{allowRefresh:!0}},env:DisneyID.env,client_id:DisneyID.client_id},s=!1,a=0;a<t.length;a++)i.token[t[a]]&&(s=!0,n[t[a]]=i.token[t[a]]);if(!s){var D="forceTokenRefresh called with no "+t.split(",")+" in the user token object";return DisneyID.log(D),void e.error(D)}var o=DisneyID.Dispatch._buildData(n);delete o.guest;var r={success:e.success,error:function(t){e.error({xhr:t,guest:i})}};DisneyID.Dispatch._doAJAX(o,r,"forceTokenRefresh")},error:e.error})},DisneyID.Dispatch.recoverUsername=function(e,i,t,n){DisneyID.log("DisneyID.Dispatch.recoverUsername attempting to recover username...");var s={emails:{}};s.emails[i]={specifyWho:"BOTH",id:e};var a=DisneyID.Dispatch._buildData({action:"sendEmail",emailFields:DisneyID.toJSON(s)});t=$.extend({success:function(){DisneyID.throwMessage("resetPassword"===i?'<div class="padleft"><h2 class="green-check">'+window.localeMap.getText("clnt_ar_check_email")+"</h2>"+window.localeMap.getText("clnt_fup_sent_email_instructions")+"</div>":'<div class="padleft"><h2 class="green-check">'+window.localeMap.getText("clnt_ar_check_email")+"</h2>"+window.localeMap.getText("clnt_ar_email_sent")+"</div>")},error:function(i){var t="";try{t=$.parseJSON(i.responseText)}catch(s){}GCException.check({response:t,overrides:{},sourcePage:n,fieldValues:{username:e,email:e}})}},t),DisneyID.Dispatch._doAJAX(a,t,"recoverUsername")},DisneyID.Dispatch.setPrimaryUser=function(e,i){DisneyID.log("accountRecovery");var t={action:"accountRecovery",env:DisneyID.env,client_id:DisneyID.client_id,tokenObj:DisneyID.token,recoveryFields:{makeDidPrimary:{swid:e}}};DisneyID.Dispatch._doAJAX(t,i,"setPrimaryUser")},DisneyID.Dispatch.nrtUpgrade=function(e,i){DisneyID.log("Attempting to upgrade NRT account");var t={action:"update",env:DisneyID.env,client_id:DisneyID.client_id,tokenObj:DisneyID.token,updateFields:DisneyID.toJSON({nrt:{password:e.password,swid:e.swid,email:e.email,username:e.username.replace(/NRT_DUM/gi,"NRT_UPGRADED")}})};DisneyID.Dispatch._doAJAX(t,i,"nrtUpgrade")},DisneyID.Dispatch.answerSecurityQuestions=function(e,i,t){DisneyID.log("Attempting to answer security questions");var n={changePasswordByQuestions:{credentials:{username:e},answers:i}},s=DisneyID.Dispatch._buildData({action:"accountRecovery",recoveryFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"accountRecovery")},DisneyID.Dispatch.resetPasswordWithChangeCode=function(e,i,t){var n={changePasswordByQuestions:{credentials:{password:i},changeCode:e}},s=DisneyID.Dispatch._buildData({action:"accountRecovery",recoveryFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"resetPasswordWithChangeCode")},DisneyID.Dispatch._getGuestByToken=function(e,i,t){DisneyID.log("Retrieving profile...");var n=DisneyID.Dispatch._buildData({action:"tokenLogin",guest:DisneyID.toJSON(e),loadLoginInformation:t?!0:!1});DisneyID.Dispatch._doAJAX(n,i,"_getGuestByToken")},DisneyID.Dispatch._blueCookieLogin=function(e,i){var t=$.cookie("BLUE");if("undefined"==typeof e&&(e=$.cookie("SWID")),null!==t){var n=DisneyID.Dispatch._buildData({action:"getBlueCookieToken",BLUE:t,SWID:e});DisneyID.Dispatch._doAJAX(n,i,"_blueCookieLogin")}else DisneyID.log("Disney.Dispatch._blueCookieLogin: No BLUE cookie found."),_.get(i,"error")&&i.error({error:"MISSING_BLUE_COOKIE"})},DisneyID.Dispatch.buildAnonSWID=function(e){var i=DisneyID.Dispatch._buildData({action:"authorization",authorizationFields:{buildAnonSWID:{requestId:null}}});DisneyID.Dispatch._doAJAX(i,e,"buildAnonSWID")},DisneyID.Dispatch._writeLoginCookies=function(e,i,t){var n={SWID:1,guest:1};DisneyID.SharedStorage.readData(n,function(n){if(!i.profile){var s=DisneyID.Dispatch._readGuestData(n,DisneyID.getParameterByName("client_id"));s&&(i=s,i.token=e)}DisneyID.postMessageTransport&&DisneyID.postMessageTransport.send("writeTokenCookie",{token:i.token});var a={SWID:_.get(i,"token.swid")||n.SWID,loggedin:1,guest:DisneyID.Dispatch._writeGuestData(n,i),UGAgeBand:DisneyID.Dispatch._writeGuestData(n,i)},D=_.get(i,"profile.ageBand",null);$.cookie("UGAgeBand",D,{path:"/",domain:"go.com"}),DisneyID.SharedStorage.writeData(a,null,null,function(){var e=_.get(i,"token.blueCookie"),n=_.get(i,"token.swid"),s=$.cookie("SWID");return $.cookie.raw=!0,null!==s&&s.replace(/[{}]/g,"")!==n.replace(/[{}]/g,"")&&($.cookie("SWID",null,{path:"/",domain:"go.com"}),$.cookie("BLUE",null,{path:"/",domain:"go.com"}),t&&t.error)?(t.error(),!0):(e&&$.cookie("BLUE",e,{path:"/",domain:"go.com"}),n&&$.cookie("SWID",n,{expires:30,path:"/",domain:"go.com"}),t&&t.success&&t.success(i),!0)})})},DisneyID.Dispatch.decodeGuestData=function(e,i){DisneyID.log("DisneyID.Dispatch.decodeGuestData: Retrieving information for decode...");var t={SWID:1,guest:1};DisneyID.SharedStorage.readData(t,function(t){var n,s=(t.SWID,DisneyID.getParameterByName("client_id"));return(n=DisneyID.Dispatch._readGuestData(t,s,i))?void(e&&e.success&&e.success(n)):(DisneyID.log("DisneyID.Dispatch.decodeGuestData: Could not decrypt the guest object."),void(e&&e.error&&e.error()))})},DisneyID.Dispatch.validateToken=function(e,i,t){var n=DisneyID.Dispatch._getDebugOptions(),s={action:"validateToken",access_token:e.token.access_token,refresh_token:e.token.refresh_token,authorizationFields:{},client_id:DisneyID.Dispatch.getParameterString("client_id"),langPref:DisneyID.Dispatch.getParameterString("langPref"),env:DisneyID.Dispatch.getParameterString("env"),debug:DisneyID.toJSON(n)};i&&(s.authorizationFields.allow_refresh=i),DisneyID.Dispatch._doAJAX(s,t,"validateToken")},DisneyID.Dispatch.getInformationForUpdate=function(e,i){var t=(DisneyID.Dispatch._getDebugOptions(),DisneyID.Dispatch._buildData({action:"getInformationForUpdate",ageBand:e.profile.ageBand}));DisneyID.Dispatch._doAJAX(t,i,"getInformationForUpdate")},DisneyID.Dispatch.getInformationForCreate=function(e,i,t,n){var s=(DisneyID.Dispatch._getDebugOptions(),DisneyID.Dispatch._buildData({action:"getInformationForCreate"}));e&&i&&t&&(s.birthYear=e,s.birthMonth=i,s.birthDay=t),DisneyID.Dispatch._doAJAX(s,n,"getInformationForCreate")},DisneyID.Dispatch.check=function(e,i,t){var n=DisneyID.Dispatch._getDebugOptions(),s={action:"check",checkFields:DisneyID.toJSON(e),client_id:DisneyID.Dispatch.getParameterString("client_id"),env:DisneyID.Dispatch.getParameterString("env"),langPref:DisneyID.Dispatch.getParameterString("langPref"),debug:DisneyID.toJSON(n)};"undefined"!=typeof window.guest&&(s.guest=DisneyID.toJSON(window.guest)),DisneyID.Dispatch._doAJAX(s,i,"check","undefined"!=typeof t?t:!0)},DisneyID.Dispatch.create=function(e,i){var t=DisneyID.Dispatch._getDebugOptions(),n=DisneyID.getParameterByName("profileContext");n&&(n=$.parseJSON(n),e.profile&&(e.profile.profileContext=n)),DisneyID.isFeatureEnabled("createTestAccounts")&&e.profile&&(e.profile.testProfileFlag="Y"),DisneyID.log(e),DisneyID.log(DisneyID.toJSON(e));var s={action:"create",createFields:DisneyID.toJSON(e),client_id:DisneyID.Dispatch.getParameterString("client_id"),env:DisneyID.Dispatch.getParameterString("env"),langPref:DisneyID.Dispatch.getParameterString("langPref"),debug:DisneyID.toJSON(t)};"object"==typeof window.guest&&(s.guest=DisneyID.toJSON(window.guest)),DisneyID.Dispatch._doAJAX(s,i,"create")},DisneyID.Dispatch.getGuestDataForUpdate=function(e){var i={redirect:document.URL};return DisneyID.isFeatureEnabled("invokedFromEmail")||(i["login-expired"]=1),e&&e.success?void DisneyID.Dispatch.decodeGuestData({success:function(t){DisneyID.log("decodeGuestData success:"),DisneyID.Dispatch.getInformationForUpdate(t,{success:function(i){window.guest=i,i.token.access_token!=t.token.access_token?DisneyID.Dispatch._writeLoginCookies(i.token,i,{success:function(){e.success(i)}}):e.success(i)},error:function(t){DisneyID.log("decodeGuestData::getInformationForUpdate error"),DisneyID.log(t),e.error&&e.error(t),DisneyID.navigate("login",{queryUpsert:i})}})},error:function(t){DisneyID.log("decodeGuestData error:"),DisneyID.log(t),e.error&&e.error(t),DisneyID.navigate("login",{queryUpsert:i})}}):void DisneyID.log("Missing required callbacks")},DisneyID.Dispatch.notifyOnRefresh=function(e,i,t){var n,s=_.get(i,"token"),a=_.get(i,"token.access_token");if(_.get(i,"nrt")||!s||!s.swid)return DisneyID.log("notifyOnRefresh: Token not refreshed - not a valid user"),t(!1);try{if(e.access_token)n=e.access_token;else{var D=_.get(e,"guest");"string"==typeof D&&(D=$.parseJSON(D)),n=_.get(D,"token.access_token")}}catch(o){return DisneyID.log("notifyOnRefresh: Token not found."),t(!1)}return n||e.ssoAssertion||e.blueCookie||e.refresh_token?n!=a&&DisneyID.SharedStorage?(DisneyID.log("notifyOnRefresh: "+n+" -> "+a),DisneyID.Dispatch._writeLoginCookies(s,i,{success:function(){DisneyID.Notify.onTokenRefresh(s,function(){DisneyID.log("notifyOnRefresh: Token refreshed and client onTokenRefresh called."),t(!0)})}}),void("undefined"!=typeof _.get(window,"guest.token")&&(window.guest.token=s))):(DisneyID.log("notifyOnRefresh: Token not refreshed."),void t(!1)):(DisneyID.log("notifyOnRefresh: Not a refresh scenario"),t(!1))},DisneyID.Dispatch.getGoKartLists=function(e,i){var t=DisneyID.Dispatch._buildData({action:"get",getFields:{goKart:e||null}});DisneyID.Dispatch._doAJAX(t,i,"getGoKartLists")},DisneyID.Dispatch._notifyAndWriteCookiesOnRefresh=function(e,i,t){DisneyID.Dispatch.notifyOnRefresh(e,i,function(e){e?DisneyID.Dispatch._writeLoginCookies(i.token,i,{success:function(){t(e)}}):t(e)})},DisneyID.Dispatch.sendConfirmationEmail=function(e,i,t){var n=DisneyID.Dispatch._buildData({action:"sendEmail",emailFields:DisneyID.toJSON({credentials:e,emails:{verify:i}})});DisneyID.Dispatch._doAJAX(n,t,"sendConfirmationEmail")},DisneyID.Dispatch.checkOrRequestActivities=function(e,i,t,n){var s;if("string"==typeof e)s=[e];else{if("[object Array]"!=Object.prototype.toString.call(e))throw"Incorrect format for activityCodeOrArray";s=e}var a=DisneyID.Dispatch._buildData({action:"checkOrRequestActivities",checkOrRequestFields:DisneyID.toJSON({activityCodes:s,checkOnly:i,reRequest:t})});DisneyID.Dispatch._doAJAX(a,n,"checkOrRequestActivities")},DisneyID.Dispatch.getSecurityQuestions=function(e,i,t){var n={grx:{what:e}};"string"==typeof i?n.grx.login=i:"object"==typeof i&&(t=i);var s=DisneyID.Dispatch._buildData({action:"get",getFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"checkOrRequestActivities")},DisneyID.Dispatch.getFamilyBySwid=function(e){var i={family:{action:"GET_FAMILY_BY_MEMBER_SWID"}},t=DisneyID.Dispatch._buildData({action:"get",getFields:DisneyID.toJSON(i)});DisneyID.Dispatch._doAJAX(t,e,"getFamily")},DisneyID.Dispatch.createFamily=function(e){var i={family:{}},t=DisneyID.Dispatch._buildData({action:"create",createFields:DisneyID.toJSON(i)});DisneyID.Dispatch._doAJAX(t,e,"createFamily")},DisneyID.Dispatch.sendAdultTeenInvitation=function(e,i,t,n){var s=(DisneyID.Dispatch._getDebugOptions(),{family:{action:"ADD_ADULT_REQUEST",emailAddress:e,role:i?"ADMIN":"MEMBER",forceInvite:t}}),a=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(s)});DisneyID.Dispatch._doAJAX(a,n,"sendAdultTeenInvitation")},DisneyID.Dispatch.addFamilyChildViaCredentials=function(e,i,t){var n=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON({family:{action:"ADD_CHILD",credentials:{username:e,password:i},familyGUID:_.get(window.guest,"family.familyGUID")}})});DisneyID.Dispatch._doAJAX(n,t,"addFamilyChildViaCredentials")},DisneyID.Dispatch.familyMemberUpdateRole=function(e,i,t,n){var s={family:{action:"ADMINISTRATE_MEMBER",familyGUID:e,swid:i,role:t}},a=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(s)});DisneyID.Dispatch._doAJAX(a,n,"familyMemberUpdateRole")},DisneyID.Dispatch.familyMemberUpdate=function(e,i,t,n){var s={family:$.extend(t,{action:"UPDATE_MEMBER",familyGUID:e,swid:i})},a=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(s)});DisneyID.Dispatch._doAJAX(a,n,"familyMemberUpdate")},DisneyID.Dispatch.familyMemberRemove=function(e,i,t){var n=(DisneyID.Dispatch._getDebugOptions(),{family:{action:"DELETE_MEMBER",familyGUID:e,swid:i}}),s=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"familyMemberRemove")},DisneyID.Dispatch.familyDeleteFamily=function(e,i){var t={family:{action:"DELETE_FAMILY",familyGUID:e}},n=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(t)});DisneyID.Dispatch._doAJAX(n,i,"familyDeleteFamily")},DisneyID.Dispatch.familyCreateChild=function(e,i){DisneyID.isFeatureEnabled("createTestAccounts")&&e.profile&&(e.profile.testProfileFlag="Y"),DisneyID.log(e),DisneyID.log(DisneyID.toJSON(e));var t=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON({family:$.extend(e,{action:"CREATE_CHILD",familyGUID:_.get(window,"guest.family.familyGUID")})})});DisneyID.Dispatch._doAJAX(t,i,"familyCreateChild")},DisneyID.Dispatch.familyMemberGetActivities=function(e,i,t){var n={family:{action:"GET_MEMBER_ACTIVITIES",familyGUID:e,swid:i}},s=DisneyID.Dispatch._buildData({action:"get",getFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"familyMemberGetActivites")},DisneyID.Dispatch.familyMemberUpdateActivityState=function(e,i,t,n,s,a,D){var o={family:{action:"UPDATE_MEMBER",swid:i,familyGUID:e,compliance:{activitiesETag:s,activityPermissions:[{code:t,activityPermissionGuid:n,state:a}]}}},r=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(o)});DisneyID.Dispatch._doAJAX(r,D,"familyMemberUpdateActivityState")},DisneyID.Dispatch.familyMemberCancelAccount=function(e,i,t){var n={family:{action:"UPDATE_MEMBER",swid:e,familyGUID:i,profile:{disable:!0}}},s=DisneyID.Dispatch._buildData({action:"update",updateFields:DisneyID.toJSON(n)});DisneyID.Dispatch._doAJAX(s,t,"familyMemberCancelAccount")},DisneyID.Dispatch._timers={},DisneyID.Dispatch._doAJAX=function(e,i,t,n){"undefined"==typeof t&&(t="_doAJAX"),"undefined"==typeof n&&(n=!0),"undefined"==e.guest&&delete e.guest;var s=DisneyID.Dispatch._timers,a=_.getQuery("client_id");"undefined"!=typeof e.action&&(s[e.action]=(new Date).getTime()),$.ajax({url:DisneyID.controllerPath+"GuestController.php",type:"post",data:e,headers:{"X-Requested-By":"DID_UX"},async:n,dataType:"json",success:function(n,D,o){if("direct"===DisneyID.flow&&"function"==typeof DisneyID.mobileCallbacks.onDispatch&&DisneyID.mobileCallbacks.onDispatch({status:o.status,method:t,data:n}),"undefined"!=typeof e.action){var r=(new Date).getTime()-s[e.action];NewRelic.send({name:"DisneyIDDispatchTimer",clientId:a,action:e.action,timing:r,status:200,result:"SUCCESS"})}DisneyID.log("DisneyID.Dispatch."+t+" success...",n),DisneyID.Dispatch.notifyOnRefresh(e,n,function(){_.get(i,"success",_.noop)(n)})},error:function(n){if(0!==n.status){if("direct"===DisneyID.flow&&DisneyID.mobileCallbacks.onDispatch({status:n.status,method:t,data:n.responseJSON}),"undefined"!=typeof e.action){var D=(new Date).getTime()-s[e.action];NewRelic.send({name:"DisneyIDDispatchTimer",clientId:a,action:e.action,timing:D,status:n.status,result:"ERROR"})}DisneyID.log("DisneyID.Dispatch."+t+" error...",n),DisneyID.Dispatch.notifyOnRefresh(e,n,function(){var e=_.get(i,"unauthenticated",_.get(i,"error",_.noop));401===n.status?e(n):400===n.status&&"invalid_grant"===_.get(n,"raw.result.error")?e(n):_.get(i,"error",_.noop)(n)})}}})};
var GCException=function(){var e={},t={initialized:!1,init:function(){this.initialized||(e=GCExceptionConstants(),this.initialized=!0)},filterDuplicateExceptions:function(e){var t,o,n,r,i={};for(n in e)if(e.hasOwnProperty(n))for(t={},r=0;r<e[n].length;r++)o=[e[n][r].fieldName,e[n][r].category,e[n][r].type,e[n][r].code].join("_"),t.hasOwnProperty(o)||(i.hasOwnProperty(n)||(i[n]=[]),t[o]=1,i[n].push(e[n][r]));return i},applyErrorCodeOverrides:function(e,t){e=e||{},t=t||{};for(var o in t)if(e.hasOwnProperty(o))for(var n in t[o])e[o][n]=t[o][n];else e[o]=t[o]},mergeDetailsAndCodes:function(e,t){e.fieldName=_.get(t,"inputName")||e.fieldName,e.action=_.get(t,"action")||e.action,e.target=_.get(t,"target")||e.target,e.infoBubbleOptions=_.get(t,"infoBubbleOptions")||e.infoBubbleOptions,e.navigateParams=_.get(t,"navigateParams")||e.navigateParams},getGatingExceptions:function(t,o,n){DisneyID.log("In GCException.getGatingExceptions...");var r=_.get(t,"type","UNKNOWN");return Gating.check(r,t,n)?[{category:e.categories.GATING,code:r,type:void 0,fieldName:void 0,message:void 0,action:e.actions.GATE}]:[]},getExceptions:function(o,n){DisneyID.log("In GCException.getExceptions...");var r,i={category:e.categories.EXCEPTION,code:_.get(o,"type","UNKNOWN"),action:e.actions.SHOW_SERVICE_ERROR,type:void 0,fieldName:void 0,target:void 0,message:void 0};return t.applyErrorCodeOverrides(e.GCECodes,n),e.GCECodes.hasOwnProperty(i.code)&&(t.mergeDetailsAndCodes(i,e.GCECodes[i.code]),r=_.get(e.GCECodes[i.code],"localizedMessage"),i.message=r?r:i.action===e.actions.SHOW_INFO_BUBBLE||i.action===e.actions.SHOW_INFO_BUBBLE_FORM_ERROR?window.localeMap.getAlertText(e.GCECodes[i.code].localizationKey).message:window.localeMap.getText(e.GCECodes[i.code].localizationKey)),[i]},getInputExceptions:function(o,n){DisneyID.log("In GCException.getInputExceptions...");var r=[],i=_.get(o,"error_description.result.category"),a=_.get(o,"error_description.result.details");if(i||(i=_.get(o,"error_description.profile.error_description.result.category")),a||(a=_.get(o,"error_description.profile.error_description.result.details",[])),i!==e.categories.INPUT)return r;t.applyErrorCodeOverrides(e.GCEInputCodes,n);for(var s=0;s<a.length;s++){var c,l=_.get(a[s],"code"),g={category:e.categories.INPUT,code:l,type:_.get(a[s],"type"),fieldName:_.get(a[s],"inputName"),target:void 0,message:void 0,action:e.actions.SHOW_INFO_BUBBLE};if(e.GCEInputCodes.hasOwnProperty(l)){var p="getAlertText";t.mergeDetailsAndCodes(g,e.GCEInputCodes[l]),g.action!==e.actions.SHOW_INFO_BUBBLE&&g.action!==e.actions.SHOW_INFO_BUBBLE_FORM_ERROR&&(p="getText"),c=_.get(e.GCEInputCodes[l],"localizedMessage"),g.message=c?c:"getAlertText"===p?window.localeMap.getAlertText(e.GCEInputCodes[l].localizationKey).message:window.localeMap.getText(e.GCEInputCodes[l].localizationKey)}else l.indexOf("USERNAME")>=0?g.message=window.localeMap.getAlertText("clnt_username_or_password_invalid").message:l.indexOf("EMAIL")>=0?g.message=window.localeMap.getAlertText("clnt_email_unusable").message:l.indexOf("PASSWORD")>=0?(g.message=window.localeMap.getText("clnt_password_unknown_error"),g.action=e.actions.SHOW_PASSWORD_RULES):(g.message="MISSING"===g.type?$.validator.messages.required:window.localeMap.getAlertText("clnt_generic_chars_invalid").message,g.action=e.actions.SHOW_INFO_BUBBLE_FORM_ERROR);r.push(g)}return r},throwInfoBubble:function(e,t){try{$(e).infoBubble(t)}catch(o){}},throwInlineMessage:function(e,t){DisneyID.log(t),$(e).html(t)},throwServiceError:function(t){var o=e.GCECResponses.generalServiceError();DisneyID.throwMessage(o,t)},doAction:function(o,n){DisneyID.log("In GCException.doAction..."),t.init(),n=n||{},n.generalInfoBubbleMessage=n.generalInfoBubbleMessage||"",n.generalInfoBubbleTarget||(n.generalInfoBubbleTarget=_.get(DisneyID,"options.generalErrorTarget"));var r=o.target?o.target:"#"+o.fieldName,i=o.infoBubblePlacement||i,a=(o.infoBubbleType||"error",o.infoBubbleOptions||{}),s=$.extend({message:o.message,type:"error",placement:i},a);"parent"===n.errorBubblePlacement&&(r=$(r).parent());var c={name:"ExceptionHandler",client_id:DisneyID.getParameterByName("client_id",null),error_category:o.category,error_code:o.code,error_type:o.type,message:o.message,handled:!0,swid:_.get(window,"guest.token.swid")};o.action===e.actions.SHOW_INFO_BUBBLE?this.throwInfoBubble(r,s):o.action===e.actions.SHOW_INFO_BUBBLE_FORM_ERROR?(this.throwInfoBubble(r,s),n.generalInfoBubbleTarget&&this.throwInfoBubble(n.generalInfoBubbleTarget,{message:n.generalInfoBubbleMessage,type:"error",anyClickHide:!0})):o.action===e.actions.SHOW_WINDOW?DisneyID.throwMessage(o.message):o.action===e.actions.SHOW_PASSWORD_RULES?showPasswordRules(r,{placement:i}):o.action===e.actions.NAVIGATE?DisneyID.navigate(_.get(o,"navigateParams.page"),_.get(o,"navigateParams.options")):o.action===e.actions.SHOW_SERVICE_ERROR?(c.handled=!1,this.throwServiceError()):o.action===e.actions.SHOW_INLINE&&this.throwInlineMessage(r,o.message),NewRelic.send(c)}},o={categories:{},actions:{},getResponseText:function(e){var t={};try{t=void 0!==e.responseText?"string"==typeof e.responseText?$.parseJSON(e.responseText):e.responseText:"string"==typeof e.error_description?$.parseJSON(e.error_description):e.error_description}catch(o){DisneyID.log(o.message)}return t},checkErrorResponse:function(o){DisneyID.log("In GCException.checkErrorResponse...");var n,r={};t.init(),o.overrides=o.overrides||{},o.fieldValues=o.fieldValues||{};var i=[[e.categories.INPUT,t.getInputExceptions],[e.categories.GATING,t.getGatingExceptions],[e.categories.EXCEPTION,t.getExceptions]];if(!o.response)return!1;if("string"==typeof o.response){try{n=$.parseJSON(o.response)}catch(a){}if(!n)return!1}else n=o.response;for(var s=0;s<i.length;s++){var c=i[s][0],l=i[s][1],g=_.get(o.overrides,c);if(r[c]=l.call(t,n,g,o.sourcePage,o.fieldValues),r[c].length>0)return DisneyID.log(r),t.filterDuplicateExceptions(r);delete r[c]}return{}},performDefaultAction:function(o,n){if(DisneyID.log("In GCException.performDefaultAction..."),t.init(),o.EXCEPTION)t.doAction(o.EXCEPTION[0],n);else if(o.GATING)t.doAction(o.GATING[0],n);else if(o.INPUT)for(var r=0;r<o.INPUT.length;r++)t.doAction(o.INPUT[r],n);else t.doAction({action:e.actions.SHOW_SERVICE_ERROR})},check:function(e){var t=this.checkErrorResponse(e);return this.performDefaultAction(t,e.options),t},hasException:function(e,t){for(var o in e)if(e.hasOwnProperty(o))for(var n=0;n<e[o].length;n++)if(e[o][n].code===t)return!0;return!1},hasExceptionType:function(e,t){return e.hasOwnProperty(t)&&e[t].length>0}};return o}();
var GCExceptionConstants=function(){var e,a,t,o;return t={UNKNOWN:"UNKNOWN",EXCEPTION:"EXCEPTION",GATING:"GATING",INPUT:"INPUT"},o={NOOP:"NOOP",GATE:"GATE",SHOW_INFO_BUBBLE:"SHOW_INFO_BUBBLE",SHOW_INFO_BUBBLE_FORM_ERROR:"SHOW_INFO_BUBBLE_FORM_ERROR",SHOW_WINDOW:"SHOW_WINDOW",SHOW_PASSWORD_RULES:"SHOW_PASSWORD_RULES",SHOW_SERVICE_ERROR:"SHOW_SERVICE_ERROR",SHOW_INLINE:"SHOW_INLINE",NAVIGATE:"NAVIGATE"},a={generalServiceError:function(){return'<div id="service-error"><h3>'+localeMap.getText("clnt_service_down1")+"</h3><h2>"+localeMap.getText("clnt_service_down2")+"</h2></div>"},accountLockedOutMsg:function(){return("<h2>"+localeMap.getText("clnt_account_locked")+"</h2>"+localeMap.getText("clnt_account_locked_desc")+"<p>"+localeMap.getText("clnt_account_locked_action")+"</p>").replace("<a>","<a href=\"javascript:void(0);\" onclick=\"DisneyID.navigate('forgot-username-password', {queryUpsert:{prop:'password'}})\">")},profileDisabledMsg:function(e){var a="<h2>"+localeMap.getText("clnt_aa_account_deactivated")+"</h2>"+localeMap.getText("clnt_aa_account_deactivated_message");return a=a.replace("{email}","<strong>"+e+"</strong>"),a=a.replace("{link}",'<a href="javascript:void(0);" onclick="DisneyID.navigate(\'login\')">'+localeMap.getText("clnt_aa_account_deactivated_link")+"</a>"),a=a.replace(".",".<br/>")},forgotPasswordMsg:function(){return"<p><strong>"+localeMap.getText("clnt_oops")+"</strong><br />"+localeMap.getText("clnt_username_or_password_invalid")+"<br /><br /><strong><a href=\"javascript:void(0);\" onclick=\"DisneyID.navigate('forgot-username-password',{queryUpsert:{prop:'password',redirect:'login'}})\">"+localeMap.getText("clnt_forgot_password")+"</a></strong>"},emailNotFound:function(){return'<div class="padleft"><h2 class="app-error">'+localeMap.getText("clnt_gate_were_sorry")+"</h2>"+localeMap.getText("clnt_ar_email_not_found")+"</div>"},profileNotFound:function(){return'<div class="padleft"><h2 class="app-error">'+localeMap.getText("clnt_ar_error")+"</h2>"+localeMap.getText("clnt_ar_email_not_found")+"</div>"},notificationSendFailure:function(){return'<div class="padleft"><h2 class="app-error">'+localeMap.getText("clnt_oops")+"</h2><p>"+localeMap.getText("clnt_ar_email_not_sent")+"</p></div>"},authorizationChildEmailError:function(){return"<p><strong>"+localeMap.getText("clnt_oops")+"</strong><br />"+localeMap.getText("clnt_username_or_password_invalid")+"<br /><br /><strong><a href=\"javascript:void(0);\" onclick=\"DisneyID.navigate('forgot-username-password',{queryUpsert:{prop:'username'}})\">"+localeMap.getText("clnt_forgot_password")+"</a></strong>"},accountMappingNotMappedProfileMase:function(){return'<div class="padleft"><p><h2>'+localeMap.getText("clnt_oops")+"</h2>"+localeMap.getText("clnt_rms_create_masex")+'<a class="sendMASEMsgLink" href="javascript:void(0);"><br/><br/>'+localeMap.getText("clnt_rms_send_me_email")+"</a></p></div>"},accountMaseErrorResolvable:function(){return""},authorizationMaseError:function(){return"<strong>"+localeMap.getText("clnt_oops")+"</strong><br />"+localeMap.getText("clnt_rms_create_masex")+'<a class="sendMASEMsgLink" href="javascript:void(0);"><br/><br/>'+localeMap.getText("clnt_rms_send_me_email")+"</a>"},profileAccountIsChilded:function(){return'<div class="error"><b class="icon left"></b><h3 class="error padleft30">'+localeMap.getText("clnt_aa_account_childed_sorry")+'</h3></div><div class="update-msg-div disneyid-text-color">'+localeMap.getText("clnt_aa_account_childed_message")+'</div><div class="padtop20"><a href="#" onclick="return DisneyID.navigate(\'login\');">'+localeMap.getText("clnt_aa_account_childed_please")+" &#187;</a></div>"},multipleAccountsSameEmail:function(){return"<strong>"+localeMap.getText("clnt_oops")+"</strong><br />"+localeMap.getText("clnt_rms_create_masex")+'<a class="sendMASEMsgLink" href="javascript:void(0);"><br/><br/>'+localeMap.getText("clnt_rms_send_me_email")+"</a>"},networkConnectAddError:function(){return'<span class="ac_error">'+localeMap.getText("clnt_ac_err_add")+"</span>"},networkConnectMappedError:function(){return'<span class="ac_error">'+localeMap.getText("clnt_ac_err_mapped")+"</span>"}},e={GCECodes:{AUTHORIZATION_BAD_USERNAME_PASSWORD:{inputName:"username",action:o.SHOW_INFO_BUBBLE,localizedMessage:a.forgotPasswordMsg()},AUTHORIZATION_MISSING_USERNAME:{inputName:"username",action:o.SHOW_INFO_BUBBLE,localizedMessage:a.forgotPasswordMsg()},AUTHORIZATION_MISSING_PASSWORD:{inputName:"username",action:o.SHOW_INFO_BUBBLE,localizedMessage:a.forgotPasswordMsg()},PROFILE_ACCOUNT_IS_CHILDED:{action:o.SHOW_WINDOW,localizedMessage:a.profileAccountIsChilded()},AUTHORIZATION_MASE_ERROR:{action:o.SHOW_INFO_BUBBLE,target:"#username",infoBubbleOptions:{addClass:"alertblock-wide"},localizedMessage:a.authorizationMaseError()},AUTHORIZATION_MASE_ERROR_RESOLVABLE:{action:o.NOOP},ACCOUNT_MAPPING_NOT_MAPPED_PROFILE_MASE:{action:o.SHOW_WINDOW,localizedMessage:a.accountMappingNotMappedProfileMase()},AUTHORIZATION_CHILD_EMAIL_ERROR:{action:o.SHOW_INFO_BUBBLE,target:"#username",localizedMessage:a.authorizationChildEmailError()},PROFILE_DISABLED:{action:o.SHOW_WINDOW,localizedMessage:a.profileDisabledMsg(_.get(window.credentials,"username"))},AUTHORIZATION_ACCOUNT_LOCKED_OUT:{action:o.SHOW_WINDOW,localizedMessage:a.accountLockedOutMsg()},ACCOUNT_MAPPING_NOT_MAPPED_PROFILE_DELETE_REQUESTED:{action:o.SHOW_WINDOW,localizedMessage:a.profileDisabledMsg(_.get(window.credentials,"username"))},NOTIFICATION_SEND_FAILURE:{action:o.SHOW_WINDOW,localizedMessage:a.notificationSendFailure()},EMAIL_NOT_FOUND:{action:o.SHOW_WINDOW,localizedMessage:a.emailNotFound()},PROFILE_NOT_FOUND:{action:o.SHOW_WINDOW,localizedMessage:a.profileNotFound()},ILLEGAL_MODIFICATION_PROFILE_DATEOFBIRTH:{action:o.SHOW_INFO_BUBBLE,target:".birthdate",localizationKey:"clnt_birthdate_invalid"},AUTHORIZATION_INSECURE_SESSION:{action:o.NAVIGATE,navigateParams:{page:"login"}},NETWORK_CONNECT_ALREADY_MAPPED:{action:o.SHOW_INLINE,target:".network-user",localizedMessage:a.networkConnectMappedError()},NETWORK_CONNECT_MAPPING_ERROR:{action:o.SHOW_INLINE,target:".network-user",localizedMessage:a.networkConnectAddError()}},GCEInputCodes:{INVALID_FIRST_NAME:{localizationKey:"clnt_generic_chars_invalid",action:"SHOW_INFO_BUBBLE_FORM_ERROR"},INVALID_MIDDLE_NAME:{localizationKey:"clnt_generic_chars_invalid",action:"SHOW_INFO_BUBBLE_FORM_ERROR"},INVALID_LAST_NAME:{localizationKey:"clnt_generic_chars_invalid",action:"SHOW_INFO_BUBBLE_FORM_ERROR"},"INPUT.FIELD.MISSING.PROFILE_DATEOFBIRTH":{localizationKey:"clnt_birthdate_rqd"},DATE_OF_BIRTH_INVALID:{localizationKey:"clnt_birthdate_invalid"},NRT_ACCOUNT_FOR_CHILD:{localizationKey:"clnt_birthdate_invalid"},EMAIL_ADDRESS_EXISTS:{localizationKey:"clnt_email_not_unique"},"EMAIL.ADDRESS.EXISTS":{localizationKey:"clnt_email_not_unique"},EMAIL_REQUIRED:{localizationKey:"clnt_email_rqd"},INVALID_EMAIL_FORMAT:{localizationKey:"clnt_email_invalid"},NRT_EMAIL_ADDRESS_EXISTS:{localizationKey:"clnt_email_not_unique"},"INPUT.FIELD.MISSING.PROFILE_PARENTEMAIL":{localizationKey:"clnt_parent_email_rqd"},INVALID_USERNAME:{localizationKey:"clnt_username_or_password_invalid"},"INPUT.FIELD.INVALID.PROFILE_INVALID_USERNAME_FOR_CHILD":{localizationKey:"clnt_username_chars_invalid"},INVALID_USERNAME_SIZE:{localizationKey:"clnt_username_length_invalid"},USERNAME_EMPTY:{localizationKey:"clnt_username_length_invalid"},USERNAME_EXISTS:{localizationKey:"clnt_username_used"},"USERNAME.EXISTS":{localizationKey:"clnt_username_used"},INVALID_PASSWORD:{localizationKey:"clnt_password_unknown_error",inputName:"password",action:o.SHOW_PASSWORD_RULES},PASSWORD_EMPTY:{localizationKey:"clnt_password_unknown_error",inputName:"password",action:o.SHOW_PASSWORD_RULES},FILTHY_WORD_VALIDATION_FAILED:{localizationKey:"clnt_generic_chars_invalid"},INVALID_PROFILE_INTERNATIONAL_PREFIX_SIZE:{localizationKey:"clnt_generic_chars_invalid",action:"SHOW_INFO_BUBBLE_FORM_ERROR"},MULTIPLE_ACCOUNTS_SAME_EMAIL:{action:o.SHOW_INFO_BUBBLE,target:"#username",infoBubbleOptions:{addClass:"alertblock-wide"},localizedMessage:a.multipleAccountsSameEmail()}},categories:t,actions:o,GCECResponses:a}};
var Gating={requestPermissions:function(e,t){"use strict";"undefined"==typeof t&&(t={});var a={username:$("#username").val(),password:$("#password").val()};a.username||(a.username=$("#email").val()),DisneyID.navigate("request-permission",{inputName:"credentials",inputData:a,queryUpsert:{params:{activityCodes:e,hideEmailParent:t.hideEmailParent||!1}}})},check:function(e,t,a){"use strict";var l,n,i,s,o,c,r,g,p,d,T,b=!0;switch(e){case"AGEBAND_BAD_INPUT_ERROR":n=localeMap.getText("clnt_gate_dob_in_future"),l=""===n?"Date of birth can not be in the future":n,$("#dateOfBirth").infoBubble({type:"error",message:l});break;case"AUTHORIZATION_PARENTAL_AUTHORIZATION_REQUIRED_NO_BUTTON":o={hideEmailParent:!0},DisneyID.deleteCookie("did_dob");case"AUTHORIZATION_PARENTAL_AUTHORIZATION_REQUIRED":s=[],i=_.get(t,"error_description.activityCode"),"undefined"!=typeof i&&s.push(i),DisneyID.deleteCookie("did_dob"),this.requestPermissions(s,o);break;case"GUEST_GATED_EMAIL_VERIFICATION":DisneyID.log("email gate: GUEST_GATED_EMAIL_VERIFICATION"),l="<h2>"+localeMap.getText("clnt_gate_verif_email")+"</h2>",l+="<p>"+localeMap.getText("clnt_gate_adult_email_verif")+"<p>",l+='<div class="full-width"><button type="button" id="btn_send_email_verif_email" class="btn btn-primary btn-large" style="display:inline;">'+localeMap.getText("clnt_gate_btn_send_email")+"</button></div>",DisneyID.throwMessage(l),$("#btn_send_email_verif_email").on("click",function(){sendConfirmationEmail("USER")});break;case"GUEST_GATED_PARENT_EMAIL_VERIFICATION":DisneyID.log("email gate: GUEST_GATED_PARENT_EMAIL_VERIFICATION"),l="<h2>"+localeMap.getText("clnt_gate_verif_email")+"</h2>",l+="<p>"+localeMap.getText("clnt_gate_child_email_verif")+"<p>",l+='<div class="full-width"><button type="button" id="btn_send_email_verif_email" class="btn btn-primary btn-large" style="display:inline;">'+localeMap.getText("clnt_gate_btn_send_email")+"</button></div>",DisneyID.throwMessage(l),DisneyID.deleteCookie("did_dob"),$("#btn_send_email_verif_email").on("click",function(){sendConfirmationEmail("PARENT")});break;case"GUEST_GATED_BOTH_EMAIL_VERIFICATION":DisneyID.log("email gate: GUEST_GATED_BOTH_EMAIL_VERIFICATION"),l="<h2>"+localeMap.getText("clnt_gate_verif_emails")+"</h2>",l+="<p>"+localeMap.getText("clnt_gate_multi_email_verif")+"<p>",l+='<div class="full-width"><button type="button" id="btn_send_email_verif_email" class="btn btn-primary btn-large" style="display:inline;">'+localeMap.getText("clnt_gate_btn_send_emails")+"</button></div>",DisneyID.throwMessage(l),$("#btn_send_email_verif_email").on("click",function(){sendConfirmationEmail("BOTH")});break;case"GUEST_GATED_EMAIL":l="<h2>"+localeMap.getText("clnt_gate_were_sorry")+"</h2>",l+="<p>"+localeMap.getText("clnt_gate_email")+"</p>",DisneyID.throwMessage(l);break;case"GUEST_GATED_AGEBAND":l="<h2>"+localeMap.getText("clnt_gate_were_sorry")+"</h2>",l+="create-profile"==a?"<p>"+localeMap.getText("clnt_gate_age_band_reg")+"</p>":"<p>"+localeMap.getText("clnt_gate_age_band_login")+"</p>",DisneyID.throwMessage(l);break;case"GUEST_GATED_LOCATION":l="<h2>"+localeMap.getText("clnt_gate_were_sorry")+"</h2>",l+="create-profile"==a?"<p>"+localeMap.getText("clnt_gate_location_reg")+"</p>":"<p>"+localeMap.getText("clnt_gate_location_login")+"</p>",DisneyID.throwMessage(l);break;case"GUEST_GATED_EMBARGOED":l="<h2>"+localeMap.getText("clnt_gate_were_sorry")+"</h2>",l+="create-profile"==a?"<p>"+localeMap.getText("clnt_gate_age_band_reg")+"</p>":"<p>"+localeMap.getText("clnt_gate_age_band_login")+"</p>",DisneyID.throwMessage(l);break;case"GUEST_GATED_UNKNOWN":l="<h2>"+localeMap.getText("clnt_gate_were_sorry")+"</h2>",l+="create-profile"==a?"<p>"+localeMap.getText("clnt_gate_age_band_reg")+"</p>":"<p>"+localeMap.getText("clnt_gate_age_band_login")+"</p>",DisneyID.throwMessage(l);break;case"PROFILE_USER_BANNED":$("#disneyid-messagediv").removeClass("loader").addClass("relative solidwhitebg nobgimage").css({top:0,height:"auto"}),c=_.get(t,"raw"),c&&c[0]&&(g="local","GLOBAL"===c[0].banLocationType&&(g="global"),p=c[0].banType,r=c[0].banRemainingDurationHours,r>2&&(r=Math.round(r)),2>=r&&(r=Math.round(10*r)/10),0===r&&(r=.1)),"global"===g?p&&"TEMPORARY"===p&&r?(d=localeMap.getText("clnt_ban_acct_temp_blocked"),T=localeMap.getText("clnt_ban_temp_suspended_start_global")+" <strong>"+r+"</strong> "+localeMap.getText("clnt_ban_temp_suspended_end")):(d=localeMap.getText("clnt_ban_acct_perm_blocked"),T=localeMap.getText("clnt_ban_acct_perm_blocked_desc_global")):p&&"TEMPORARY"===p&&r?(d=localeMap.getText("clnt_ban_acct_temp_blocked"),T=localeMap.getText("clnt_ban_temp_suspended_start")+" <strong>"+r+"</strong> "+localeMap.getText("clnt_ban_temp_suspended_end")):(d=localeMap.getText("clnt_ban_acct_perm_blocked"),T=localeMap.getText("clnt_ban_acct_perm_blocked_desc")),DisneyID.throwMessage('<div id="service-error"><h3 class="app-error">'+d+"</h3><p>"+T+'</p><div class="full-width"><button id="ban_close_button" class="btn btn-primary btn-large" type="button">'+localeMap.getText("clnt_message_close")+"</button></div></div>"),$("#ban_close_button").on("click",function(){DisneyID.postMessageTransport.send("closeTopIFrame")});break;default:b=!1}return b}};
function getGokartDisplay(e,t,a){if(e.goKart&&e.goKart.lists){var n,o,i,r,l,c,d=$("<div>"),p=[],s=[];a=a||1;for(var _ in e.goKart.lists)e.goKart.lists.hasOwnProperty(_)&&(n=$.extend({id:_},e.goKart.lists[_]),s.push(n));s.sort(function(e,t){return e.order<t.order?-1:e.order>t.order?1:0});for(var g=0;g<s.length;g++){o=$('<div class="gokartOptItem"></div>'),i=$('<label class="inline"></label>'),r=$("<span></span>"),c=Math.floor(g/a),p[c]||(p[c]=$('<div class="row"></div>')),l="undefined"!=typeof t&&t&&s[g].defaultChecked?!0:"GUEST"==s[g].source&&s[g].defaultChecked?!0:!1;var u=$("<input />",{type:"checkbox",name:"checkbox","data-source":s[g].source,value:s[g].id,checked:l}),T=s[g].text;if(null===T&&(T=""),"undefined"==typeof s[g].displayCheckbox||s[g].displayCheckbox)o.addClass("checkbox"),r.append(T),i.append(u).append(r),o.html(i);else{u.addClass("disneyid-hidden");var f,k,h=$("<a></a>",{name:T,href:"#","class":"clickHereLink"}).text(CLICK_HERE_TEXT);"undefined"!=typeof t&&t&&s[g].defaultChecked||"GUEST"===s[g].source&&s[g].defaultChecked?(f=GOKART_OPT_OUT_PREFIX,k=GOKART_OPT_OUT_SUFFIX):(f=GOKART_OPT_IN_PREFIX,k=GOKART_OPT_IN_SUFFIX),r.append((""!==T?T+" ":"")+f).append(" ").append(h).append(k),o.append(u).append(r)}a>1?p[c].append(o):d.append(o)}return a>1&&d.append(p),d.html()}return""}$(function(){"undefined"!=typeof localeMap&&(window.GOKART_OPT_OUT_PREFIX=localeMap.getText("clnt_gokart_opt_out_prefix"),window.GOKART_OPT_OUT_SUFFIX=localeMap.getText("clnt_gokart_opt_out_suffix"),window.GOKART_OPT_IN_PREFIX=localeMap.getText("clnt_gokart_opt_in_prefix"),window.GOKART_OPT_IN_SUFFIX=localeMap.getText("clnt_gokart_opt_in_suffix"),window.CLICK_HERE_TEXT=localeMap.getText("clnt_click_here")),$("#marketingOptions").on("click",".clickHereLink",function(e){e.stopPropagation();var t=$(this).attr("name");(null===t||"undefined"==typeof t)&&(t="");var a=$(this).parents(".gokartOptItem").first(),n=$("<a></a>",{name:t,href:"#","class":"clickHereLink"}).text(CLICK_HERE_TEXT);return a.find("input[type=checkbox]").prop("checked",function(){var e,o,i=!$(this).prop("checked");return i===!0?(e=GOKART_OPT_OUT_PREFIX,o=GOKART_OPT_OUT_SUFFIX):(e=GOKART_OPT_IN_PREFIX,o=GOKART_OPT_IN_SUFFIX),DisneyID.log("Hidden marketing item checked: "+i),a.find("span").html(t+" "+e).append(n).append(o),i}),!1})});var DID_GoKart={};DID_GoKart.getGoKartObjectFromForm=function(){var e=$(".more-info input[name='checkbox']"),t={};return e.each(function(){var e=$(this);guest.goKart.lists&&guest.goKart.lists[e.val()]?(DisneyID.log("Guest has existing gokart info"),"GUEST"===guest.goKart.lists[e.val()].source&&guest.goKart.lists[e.val()].defaultChecked||e.prop("checked")!==!0?guest.goKart.lists[e.val()].defaultChecked&&e.prop("checked")!==!0&&(DisneyID.log("Marketing: Adding to decline list - "+e.val()),t[e.val()]="decline"):(DisneyID.log("Marketing: Adding to accept list - "+e.val()),t[e.val()]="accept")):e.prop("checked")===!0&&(DisneyID.log("Marketing: No existing list state for guest, accepting "+e.val()),t[e.val()]="accept")}),t};
var LegalView=function(e){function t(e){var t,n=[],a={};for(t in e.documentTypeOrder)e.documentTypeOrder.hasOwnProperty(t)&&(a[e.documentTypeOrder[t]]=parseInt(t,10));for(t in e.documents)if(e.documents.hasOwnProperty(t)){n.push([t,e.documents[t]]);var i=e.documents[t].type.split("-");i.length>1&&(e.documents[t].type=i[0],e.documents[t].subtype=i[1])}return n.sort(function(e,t){e=e[1],t=t[1];var n=_.get(e,"displayStyle")!==_.get(t,"displayStyle")&&"inline"===_.get(t,"displayStyle");return n+10*(a[e.type]-a[t.type])}),n}function n(e){function t(e){for(var t=0;t<e.length;t++)e[t][0].length>0&&s.push(e[t][0]),_.get(e[t][1],"displayHTML")&&_.get(e[t][1],"displayHTML").length>0?(a.push(_.get(e[t][1],"displayHTML")),n=""):a.push('<a target="_blank" href="'+_.escape(_.get(e[t][1],"link","#"))+'">'+_.escape(_.get(e[t][1],"displayName"))+"</a>")}for(var n,a=[],i="",r=!1,s=[],l=_.get(e[0][1],"displayStyle","separate").toLowerCase(),p=_.get(DisneyID,"uiConfig.brandedExperience.enabled",!1),o=_.get(e[0][1],"type"),c="inline"===l,h=0;h<e.length;h++)_.get(e[h][1],"displayCheckbox",!0)!==!1&&(r=!0);return n=localeMap.getText(r&&!c&&p?"srvr_read_terms":"clnt_i_agree_to"),"privacy"===o?(string=localeMap.getText("clnt_privacy_policy_message"),n=string,t(e)):(n=n,t(e)),r&&(i='<input type="checkbox" value="'+s.join(",")+'" name="terms" class="required">'),'<div class="checkbox marginbottom5"><span><label class="inline">'+i+n+" "+a.join(", ")+"</label></span></div>"}function a(e){function t(){a.length>0&&(n.push(a),a=[])}for(var n=[],a=[],i=0;i<e.length;i++)"inline"!==e[i][1].displayStyle?(t(),n.push([e[i]])):(e[i][1].type!==e[i][1].type&&t(),a.push(e[i]));return t(),n}this.data=e,this.html="",this.getHTML=function(){return this.html};for(var i,r=a(t(this.data)),s=[],i=0;i<r.length;i++)for(var l=r[i],p=0;p<l.length;p++)l.hasOwnProperty(p)&&s.push(l[p][0]);for(this.html='<input type="hidden" name="legal_accept" id="legalAccept" value="'+_.escape(s.join(","))+'" />',i=0;i<r.length;i++)this.html+=n(r[i])};
var LoginHelper={finishSignin:function(e,n){var i,o={"AM-FACEBOOK":"fb","AM-GOOGLE":"google"};DisneyID.log("LOGIN: In finish sign-in"),DisneyID.log(e);var t=e.profile;t.facebookId=_.get(e,"accountMapping.AM-FACEBOOK.externalId"),t.googleId=_.get(e,"accountMapping.AM-GOOGLE.externalId"),DisneyID.log(e),DisneyID.log(DisneyID.toJSON(e));var a=DisneyID.getParameterByName("redirect");!e.loginAuthorized||e.displayNameCreated?e.banning.banned===!0?(DisneyID.log("User banned!"),DisneyID.throwMessage('<div id="service-error"><h3>'+localeMap.getText("clnt_user_banned")+"</h3><h2>"+localeMap.getText("clnt_user_banned_message")+"</h2></div>")):(DisneyID.log("Some profile fields or legal documents are needed."),DisneyID.navigate("update-partial-profile",{inputData:e})):(DisneyID.log("Finalizing sign-in"),DisneyID.Dispatch._writeLoginCookies(e.token,e,{success:function(){DisneyID.log("Completed writing cookies. Now calling doTealium."),i={form_logins:"true",t_login_type:"default_form_flow",swid:_.get(e,"profile.swid"),sequence:"1"},"string"==typeof n&&(i.t_login_type=o[n]),doTealium(i,function(){DisneyID.log("Tealium finished. Calling onLogin or loginSuccess function"),DisneyID.Notify.trigger("guest-login",e,function(){""!==a?(DisneyID.log("Redirecting..."),document.location.href=a):DisneyID.isFeatureEnabled("invokedFromEmail")?DisneyID.navigate("update-profile"):"1"===DisneyID.getParameterByName("marketingonly")?DisneyID.throwMessage('<div class="padleft"><h2 class="green-check">'+localeMap.getText("clnt_thank_you")+"</h2>"+localeMap.getText("clnt_all_set")+'</div><div class="padleft padtop"><input type="submit" id="ppu-ok-button" value="'+localeMap.getText("clnt_button_ok")+'" class="btn btn-primary btn-large"/></div>'):(DisneyID.log("Closing frame"),DisneyID.postMessageTransport.send("closeTopIFrame"))})})}}))}};
var SecurityQuestions={getQuestionsHTML:function(e,t,s){var i=9,n=s?" required":"",o=[],a=!1,r=0,u=this,c="",l=$("body").hasClass("branded-management");if(c=_.get(DisneyID,"uiConfig.brandedExperience.enabled")===!0?"<header><h3>"+window.localeMap.getText("srvr_security_questions")+"</h3>"+(l?'<div class="action hide-when-editing"><a href="#" class="edit" data-toggle="editing"><i class="icon-edit"></i> <b class="dotted">'+window.localeMap.getText("srvr_edit_this_section")+'</b></a></div><div class="action show-when-editing"><a href="#" class="branded-warning dotted cancel" data-toggle="editing">'+window.localeMap.getText("srvr_cancel")+'</a> <a href="#" class="btn btn-primary btn-large done" data-toggle="editing">'+window.localeMap.getText("srvr_done")+"</a></div>":"")+"</header>"+(l?'<form><div class="padme">':"")+'<p class="show-when-editing">'+window.localeMap.getText("srvr_security_questions_info")+"</p>":"<h3>"+window.localeMap.getText("srvr_security_questions")+'</h3><p class="marginbottom20">'+window.localeMap.getText("srvr_security_questions_info")+"</p>",!_.get(e,"grx.questions"))return"";_.get(e,"grx.guestQuestions")&&!$.isEmptyObject(_.get(e,"grx.guestQuestions"))&&(a=!0,$.each(e.grx.guestQuestions,function(e){o.push(e)}));for(var d=1;t>=d;d++){var p='<div class="cols"><div class="securityQuestions_question'+d+"_group control-group"+n+'"><label for="securityQuestions_question'+d+'" class="inline-label">'+window.localeMap.getText("srvr_question_"+d)+'</label><select id="securityQuestions_question'+d+'" data-question-number="'+d+'" name="securityQuestions_question'+d+'" class="security-question'+n+'" class="colored">';p+=(a?u.buildSecurityQuestionOptions(e.grx,o,o[r]):u.buildSecurityQuestionOptions(e.grx))+'</select></div></div><div class="cols cols-halfs show-when-editing"><div class="securityQuestions_answer'+d+"_group control-group col"+n+'"><label for="securityQuestions_answer'+d+'" class="inline-label">'+window.localeMap.getText("srvr_answer_"+d)+'</label><input type="'+(a?"password":"text")+'" data-question-number="'+d+'" id="securityQuestions_answer'+d+'" name="securityQuestions_answer'+d+'" class="security-question-answer'+n+'" '+(a?'value="**********"':"")+(DisneyID.uiConfig.inlineLabels?'placeholder="'+window.localeMap.getText("srvr_answer_"+d)+'"':"")+"/></div></div>",c+=p,r++}return $("body").on("change","select.security-question",function(){{var t,s=[];$("input[data-question-number="+$(this).attr("data-question-number")+"]")}$("select.security-question").each(function(){$(this).val()&&s.push($(this).val())}),$("select.security-question").each(function(){t=$(this).val(),$(this).find("option").remove(),$(this).append(u.buildSecurityQuestionOptions(e.grx,s,t))}),$("input.security-question-answer[type=password]").each(function(){$(this).val(""),u.convertSecurityQuestionAnswerBox($(this),!0)}),u.convertSecurityQuestionAnswerBox($("input[data-question-number="+$(this).attr("data-question-number")+"]"))}),$("body").on("focus click","input[type=password].security-question-answer",function(){var e=$(this);setTimeout(function(){e.select()},50)}),$("body").on("keyup","input[type=password].security-question-answer",function(e){var t=$(this);(e.keyCode||e.which)!=i&&(e.preventDefault(),u.convertSecurityQuestionAnswerBox(t),$("input[type=password].security-question-answer").each(function(){$(this)!=t&&($(this).val(""),u.convertSecurityQuestionAnswerBox($(this),!0))}))}),_.get(DisneyID,"uiConfig.brandedExperience.enabled")===!0&&l&&(c+="</form></div>"),c},buildSecurityQuestionOptions:function(e,t,s){var i='<option value="">'+window.localeMap.getText("srvr_choose_a_question")+"</option>";return $.each(e.questions,function(e,n){($.inArray(e,t)<0||e==s||"undefined"==typeof t&&"undefined"==typeof s)&&(i+='<option value="'+e+'"'+(s==e?" selected":"")+">"+n.text+"</option>")}),i},convertSecurityQuestionAnswerBox:function(e,t){var s,i=e.attr("data-question-number"),n=e.val();t="undefined"==typeof t?!1:t,s=$('<input type="text" data-question-number="'+i+'" id="securityQuestions_answer'+i+'" name="securityQuestions_answer'+i+'" class="security-question-answer '+(e.hasClass("required")?"required":"")+'"/>'),e.replaceWith(s),setTimeout(function(){t===!1&&s.focus(),s.val(n)},1)},changeSecurityQuestionAnswerBoxesBack:function(){$("input.security-question-answer").each(function(){var e=$(this),t=e.attr("data-question-number"),s=$('<input type="password" data-question-number="'+t+'" id="securityQuestions_answer'+t+'" name="securityQuestions_answer'+t+'" class="security-question-answer '+(e.hasClass("required")?"required":"")+'"/>');s.val("**********"),e.replaceWith(s)})},getAnswers:function(){var e={};return $("select.security-question").each(function(){var t=$("input[data-question-number="+$(this).attr("data-question-number")+"]");"password"!=t.attr("type")&&(e[$(this).val()]=t.val())}),e}};
function checkUsernameForUpdate(e){checkUsername(e,{success:function(s){s?$(e).hasClass("success")?$(e).stop(!0,!0):$(e).addClass("success").removeClass("success",1500):$(e).infoBubble({type:"error",message:localeMap.getAlertText("clnt_username_used").message})},error:function(){$(e).infoBubble({type:"error",message:localeMap.getAlertText("clnt_username_chars_invalid").message})}})}function populateGenders(){"use strict";DisneyID.log("In populateGenders...");var e,s=_.get(DisneyID,"uiConfig.useGenderRadioButtons",!1),t=_.get(DisneyID,"uiConfig.genderDefault",!1),n=window.localeMap.getText("profileGender"),a=$(s?"#gender-btn-set":"#gender");if(a.length)if(s){var o,r,l=0;t===!1&&(t="1");for(e in n)n.hasOwnProperty(e)&&"0"!==e&&"9"!==e&&(r="gender-"+e,$("label[for="+r+"]").remove(),o=$('<label class="btn-set-label btn-set-gender-label"/>').prop("for",r).prop("role","button").text(n[e]),0===l&&o.addClass("btn-set-label-first"),e===t&&o.addClass("btn-set-label-active"),a.append(o),l++);o.addClass("btn-set-label-last"),setGenderValue(t)}else{t===!1&&(t="");for(e in n)"0"!==e&&"9"!==e&&n.hasOwnProperty(e)&&a.append('<option value="'+e+'">'+n[e]+"</option>");a.val(t)}}function populatePrefix(){"use strict";var e,s=window.localeMap.getText("profilePrefix"),t=$("#prefix");for(e in s)s.hasOwnProperty(e)&&t.append('<option value="'+e+'">'+s[e]+"</option>")}function populateSuffix(){"use strict";var e,s=window.localeMap.getText("profileSuffix"),t=$("#suffix");for(e in s)s.hasOwnProperty(e)&&t.append('<option value="'+e+'">'+s[e]+"</option>")}
var UpdateHelper=function(){"use strict";var e=this;e.LIGHTBOX_BRANDED_WIDTH=752,e.childedErrorMsg="<div class='error'><b class='icon left'></b><h3 class='error padleft30'>"+localeMap.getText("clnt_aa_account_childed_sorry")+"</h3></div><div class='update-msg-div disneyid-text-color'>"+localeMap.getText("clnt_aa_account_childed_message")+"</div><div class='padtop20'><a href='#' onclick='return DisneyID.navigate(\"login\");'>"+localeMap.getText("clnt_aa_account_childed_please")+" &#187;</a></div>",this.init=function(t){e.defaults={},e.changesOccurred=!1,e.brandedExperience=!1,e.statusMessages={PENDING:{iconClass:"yellow-alert",message:window.localeMap.getText("clnt_dn_the_display_name")+" <span id='proposedDisplayName'></span> "+window.localeMap.getText("clnt_dn_is_under_moderation")},REJECTED:{iconClass:"red-alert",message:"<strong>"+window.localeMap.getText("clnt_dn_sorry")+"</strong> "+window.localeMap.getText("clnt_dn_the_display_name")+" <span id='proposedDisplayName'></span> "+window.localeMap.getText("clnt_dn_not_approved")}},e.options=$.extend({},e.defaults,t),_.get(DisneyID,"uiConfig.brandedExperience.enabled")===!0&&(e.brandedExperience=!0),DisneyID.Dispatch.getGuestDataForUpdate({success:function(t){DisneyID.log(t),e.guest=t,e._processAndShowForm(t)}}),populateGenders(),attachGenderEventHandlers(),this._attachEventHandlers()},this.update=function(t,s){return e.brandedExperience||(""!==$("#password").val()&&""!==$("#password-check").val()?$("#original-password").attr("required","true"):$("#original-password").removeAttr("required")),e._doUpdate(t,s),e.changesOccurred=!1,DisneyID.postMessageTransport.send("addCloseEvent",null),!1},this._attachEventHandlers=function(){$("#username").blur(function(){this.value&&this.value!==window.guest.profile.username&&checkUsernameForUpdate(this)}),$("#firstName, #middleName, #lastName, #pronunciationName").change(function(){$.infoBubble.hide($(this).parent())}),$("body").on("click",".delete_address_link",function(t){t.preventDefault();var s=$(t.target).attr("data-guid");e.deleteAddress(s)}),_.get(DisneyID.uiConfig,"passwordRulesValidate")===!1&&$(".password-info-alert").hide(),$("#show-password").on("change",function(){$("#password").get(0).type=this.checked?"text":"password",$("#original-password").get(0).type=this.checked?"text":"password"}),$(".password-info-alert").on("click",function(){return showPasswordRules("#password"),!1}),$("#password").on("show-password-rules",function(){return showPasswordRules("#password"),!1}),$("#displayNameStatus").on("click",function(){return $("#current-display-name").infoBubble({type:"information",anyClickHide:!0}),!1}),$("#deleteAccount").on("click",function(){var e=$("#deleteConfirmationPopup").css({padding:"20px"}).show();return did_centerPopup(e),$("#bgCover").show(),DisneyID.postMessageTransport.send("scrollTop",{offsetY:150}),!1}),$("#confirm-delete-button").on("click",function(){e._disableGuestAccount()}),$("#cancel-delete-button").on("click",function(){$("#deleteConfirmationPopup").hide(),$("#bgCover").hide()}),$("#delete-ack-button").on("click",function(){$("#deleteDonePopup").hide(),DisneyID.postMessageTransport.send("doLogout")}),$("#custServiceLink").on("click",function(){return window.top.location.href="http://"+_.get(window.localeMap.getText("product"),"support_link","disney.go.com/guestservices/"),!1}),attachNameFieldKeypressHandlers()},this._disableGuestAccount=function(){var e={profile:{disable:"true"}};DisneyID.Dispatch.update(e,window.guest,{success:function(e){DisneyID.Notify.onUpdate(e);var t=$("#deleteDonePopup");did_centerPopup(t),$("#deleteConfirmationPopup").hide(),t.show()},error:function(e){DisneyID.log("update error"),DisneyID.log(e),DisneyID.throwServiceError()}})},this._processAndShowForm=function(t){var s=_.get(DisneyID,"uiConfig.useGenderRadioButtons",!1);$("#twdc_form").validate();for(var i in t.profile)if("dateOfBirth"===i)if(null!==t.profile[i]){var a,n=t.profile.dateOfBirth.split("-"),o=n[0],r=n[1],d=n[2],l=o,p=localeMap.getText("clnt_month_"+(r.length<2?"0"+r:r)),c=localeMap.getText("clnt_day_"+(d.length<2?"0"+d:d));switch(_.get(localeData,"locale",_.get(localeMap,"locale"))){case"en-US":a=p+" "+c+", "+l;break;case"ja-JP":a=p+" "+c+" "+l;break;default:a=c+" "+p+" "+l}$("#dateOfBirth").val(_.escape(a))}else $("#dateOfBirth").parents(".control-group").remove();else if("gender"===i&&s)setGenderValue(t.profile[i]);else{var u=$("[name="+i+"]");u.length>0&&(u.is("input")?u.val(t.profile[i]):u.is("select")&&u.children('option[value="'+t.profile[i]+'"]').prop("selected",!0),u.data("orig",t.profile[i]))}if("CHILD"!==t.profile.ageBand){var g="_";(t.profile.username===t.profile.email||null!==t.displayName.displayName||!_.get(DisneyID,"displayName.enabled")&&-1!==t.profile.username.indexOf(g,t.profile.username.length-g.length))&&$("#username").parents(".control-group").remove()}if("ADULT"===t.profile.ageBand&&$("#parentEmail").parents(".control-group").remove(),null!==t.displayName.displayName&&"undefined"!=typeof t.displayName.displayName?($("#displayName").text(t.displayName.displayName),("PENDING"===t.displayName.proposedStatus||"REJECTED"===t.displayName.proposedStatus)&&($("#displayNameStatus").addClass(e.statusMessages[t.displayName.proposedStatus].iconClass),$(".alertblock").html(e.statusMessages[t.displayName.proposedStatus].message),$("#proposedDisplayName").text(_.get(t.displayName,"proposedDisplayName")))):$("#displayName").parents(".control-group").remove(),$.isEmptyObject(_.get(t,"goKart.lists")))$("#marketingOptions").parent().next("hr").hide();else{var f=localeMap.getText("valueProposition"),h=_.get(f,"marketing_value_proposition");h?$("#marketingValueProp").html(h).show():$("#marketingValueProp").hide();var m=getGokartDisplay(t);$("#marketingOptions").html(m)}"CHILD"===t.profile.ageBand?($("#username").removeAttr("disabled"),$("#parentEmail").attr("disabled","disabled")):$("#username").attr("disabled","disabled"),$("section.security-questions").append(SecurityQuestions.getQuestionsHTML(t,2,!0)),DisneyID.isFeatureEnabled("invokedFromEmail")&&($("#twdc_form").append(getContinueToLinkHTML()),$("#lightboxContinueLink").on("click",function(){DisneyID.log("About to set top URL to "+DisneyID.getParameterByName("siteURL")),DisneyID.postMessageTransport.send("setTopUrl",{url:DisneyID.getParameterByName("siteURL")})})),DID_Fields.display(t.compliance.fields.profile,t),DID_Fields.display(t.compliance.fields.GRX),DID_Fields.display(t.compliance.fields.displayName),$("section").each(function(){1===$(this).children().length&&"HR"===$(this).children()[0].tagName&&$(this).find("hr").hide()}),e._showForm()},this._showForm=function(){$("#loader").hide(),$("#twdc_form").show(),e.brandedExperience===!0&&$("#aria-focus").focus(),this._finishStartup()},this._finishStartup=function(){$("input[type!=checkbox], select").on("change",function(){e.changesOccurred||_.get(DisneyID,"uiConfig.brandedExperience.enabled")!==!0||DisneyID.postMessageTransport.send("addCloseConfirmationEvent",null,{success:confirmLightboxClose})}),DisneyID.postMessageTransport.send("addCloseEvent",null),"function"==typeof e.options.onFormLoad&&e.options.onFormLoad(e.guest)},this._doUpdate=function(t,s){function i(e){DisneyID.log("update success"),DisneyID.log(e),window.guest=e,DisneyID.Dispatch._writeLoginCookies(e.token,e,{success:function(){window.updatePosted=!1,DisneyID.Notify.trigger("guest-update",e),DID_Address.display(_.get(window,"guest.compliance.fields.profile.addresses"),e),DID_Phones.display(_.get(window,"guest.compliance.fields.profile.phones"),e),$("#password").val(""),$("#original-password").val(""),$("#password-check").val(""),"function"==typeof _.get(s,"success")&&s.success()}})}function a(t){var n={};_.get(t,"responseText")&&(n=$.parseJSON(t.responseText)),"PROFILE_ETAG_MISMATCH"===_.get(n,"type")&&3>l?(l++,_.set(window,"guest.profile",_.get(n,"error_description.profile.error_description.profile")),_.set(r,"profile.eTag",_.get(window,"guest.profile.eTag")),DisneyID.Dispatch.update(r,window.guest,{success:i,error:a})):e.handleUpdateError(t,s)}var n,o,r,d,l=0;if(t.validate(),!t.valid())return DisneyID.log("form not valid!"),$("#disneyid-messagediv").hide(),$(".wait").hide(),$("#disneyid-loaderdiv").remove(),e.brandedExperience||$("#update-account").infoBubble({message:localeMap.getText("clnt_form_error"),type:"error",noAccessibleMessage:!0,anyClickHide:!0}),"function"==typeof _.get(s,"formInvalid")&&s.formInvalid(),!1;DisneyID.log("form valid"),DisneyID.log("Continuing account update..."),"function"==typeof _.get(s,"formValid")&&s.formValid(),d=t,o=$("address:hidden"),o.show(),n=$("#phones input:hidden"),n.show();var p=d.serializeObject();return o.hide(),n.hide(),r=DID_Fields.prepareForUpdate(p,e.brandedExperience,window.guest.profile),DisneyID.log(DisneyID.toJSON(r)),$.isEmptyObject(r)?(DisneyID.log("Nothing to update."),$("#disneyid-messagediv").hide(),$(".wait").hide(),$("#disneyid-loaderdiv").remove(),$("#submitbutton-message").html('<b class="app-success-small"></b> '+window.localeMap.getText("clnt_profile_updated")).show().fadeOut(3e3),s&&s.cancelEdit&&s.cancelEdit(),!1):(DisneyID.log(r),window.updatePosted=!0,DisneyID.Dispatch.update(r,window.guest,{success:i,error:a}),!1)},this.handleUpdateError=function(t,s){function i(){DisneyID.throwServiceError(),"function"==typeof _.get(s,"error")&&s.error(t)}var a,n;DisneyID.log("update error"),DisneyID.log(t);try{n=$.parseJSON(t.responseText)}catch(o){return i()}var r=$("#email").val()||$("#username").val(),d=GCException.checkErrorResponse({response:n,overrides:{EXCEPTION:{AUTHORIZATION_BAD_USERNAME_PASSWORD:{inputName:"original-password",localizationKey:"clnt_original_password_error"}}},sourcePage:"update-profile",fieldValues:{email:r,username:r}});if(a=GCException.hasExceptionType(d,"GATING"),a||401!==n.code){if(a||$("#disneyid-messagediv").hide(),GCException.hasException(d,"UNKNOWN"))return i();if(GCException.hasExceptionType(d,"EXCEPTION")&&_.get(d.EXCEPTION[0],"code","").indexOf("ProfileException")>=0)return i();GCException.performDefaultAction(d,{generalInfoBubbleTarget:_.get(e,"options.generalErrorTarget","#update-account"),generalInfoBubbleMessage:localeMap.getText("clnt_form_error"),errorBubblePlacement:e.brandedExperience===!0?"parent":"element"}),$(".wait").hide(),$("#disneyid-loaderdiv").remove()}else DisneyID.log("Bad or incorrect access token. User must re-validate"),DisneyID.navigate("login",{queryUpsert:{"login-expired":1}});"function"==typeof _.get(s,"error")&&s.error(t)},this.shouldOverrideCompliance=function(t,s){var i=_.get(t,s);return e.brandedExperience===!0&&!$.isEmptyObject(i)},this.deleteAddress=function(t){$.infoBubble.hideAll();var s=$("#addresses_"+t+"_container");s.find("input:not([name$=eTag]), select").val(""),s.children("address").hide(500,function(){var i=s.find(".delete_address_link");i.html(localeMap.getText("clnt_cancel_delete")).one("click",function(s){s.stopPropagation(),e._undeleteAddress(t)}).addClass("undelete");var a=s.children(".legend");a.after('<div class="address_awaiting_update">'+localeMap.getText("clnt_address_awaiting_update")+"</div>")})},this._undeleteAddress=function(e){$.infoBubble.hideAll(),$("#addresses_"+e+"_container").children(".address_awaiting_update").remove(),DID_Address.display(DID_Address.createListToDisplay(_.get(window,"guest.compliance.fields.profile.addresses"),guest),guest)}};
function addDelayedMethod(e,a){var s,t;$.validator.addMethod(e,function(r,i){var n,o=this;return this.optional(i)?"dependency-mismatch":"undefined"!=typeof s&&"undefined"!=typeof t&&r===s?t:(n=a.call(o,{valid:function(){setTimeout(function(){t=!0;var e=o.formSubmitted;o.prepareElement(i),o.formSubmitted=e,o.successList.push(i),delete o.invalid[i.name],o.showErrors(),o.stopRequest(i,!0),o.settings.unhighlight&&o.settings.unhighlight.call(o,i,o.settings.errorClass,o.settings.validClass)},1)},invalid:function(a){setTimeout(function(){t=!1;var s={},n=a||o.defaultMessage(i,e);s[i.name]=$.isFunction(n)?n(r):n,o.invalid[i.name]=!0,o.showErrors(s),_.get(o,"settings.messages."+i.name+"."+e)||("undefined"==typeof o.settings.messages[i.name]&&(o.settings.messages[i.name]={}),o.settings.messages[i.name][e]=s[i.name]),o.stopRequest(i,!0)},1)}},r,i),"undefined"!=typeof n?(s=r,t=n,n):(o.startRequest(i),s=r,t="pending","pending"))})}function setValidatorDefaults(e){function a(){$("#disneyid-messagediv").hide(),$(".wait").hide(),$("#disneyid-loaderdiv").remove()}var s=".page-create-profile, .page-update-profile, .page-update-profile-branded";$.validator.setDefaults(_.get(DisneyID,"uiConfig.brandedExperience.enabled")===!0?{highlight:function(e,a,s){$(e).closest(".control-group").removeClass(s).addClass(a+" alertblock-container-error")},unhighlight:function(e,a,t){var r=$(e),i=r.closest(".control-group");return i.removeClass(a+" alertblock-container-error"),this.pending[e.name]?void r.parent().find("label.error").hide():void($("body").is(s)&&r.is("#original-password, #password, #password-check, #email")&&(i.addClass(t).removeClass(t,1500),r.addClass("greencheck"),setTimeout(function(){r.removeClass("greencheck")},1500)))},errorClass:"error",validClass:"success",onkeyup:!1,onclick:!1,focusInvalid:!1,ignore:"input:hidden[name!=gender]",showErrors:function(e,s){this.defaultShowErrors(),(e["birthdate-day"]||e["birthdate-month"]||e["birthdate-year"])&&$('label[for="birthdate-day"], label[for="birthdate-month"], label[for="birthdate-year"]').filter(".error").hide(),$.isEmptyObject(s)||($("#errorbar").is(":visible")&&$("label.error").hide(),a())}}:{highlight:function(e,a,s){$(e).closest(".control-group").removeClass(s).addClass(a+" alertblock-container-error")},unhighlight:function(e,a,t){var r=$(e),i=r.closest(".control-group");return i.removeClass(a+" alertblock-container-error"),this.pending[e.name]?void r.parent().find("label.error").hide():void(""!==e.value&&$("body").is(s)&&r.is("#original-password, #password, #password-check, #email")&&i.addClass(t).removeClass(t,1500))},errorClass:"error",validClass:"success",onkeyup:!1,onclick:!1,focusInvalid:!1,ignore:"input:hidden[name!=gender]",showErrors:function(s,t){for(var r in t)if(t.hasOwnProperty(r)){var i=$(t[r].element),n=i.closest(".control-group, .messagetarget"),o=s[t[r].element.name];if(-1==o.indexOf('<b class="icon"></b>')&&(o='<b class="icon"></b><strong>'+localeMap.getText("clnt_oops")+"</strong><br /> "+o),"gender"===i.prop("name")&&_.get(DisneyID,"uiConfig.useGenderRadioButtons",!1))$("#gender-btn-set").infoBubble({message:o,type:"error"});else{var l=_.merge({message:o,type:"error"},_.get(e,"infoBubbleOptions",{}));i.infoBubble(l),"password"==i.attr("id")&&(i.focus(function(){$("#password-check").parents(".control-group").first().removeClass("error")}),n.addClass("error"))}}var d;for(r=0,d=this.validElements();d[r];r++)_.get(e,"noHideOnShowErrors")!==!0&&$.infoBubble.hide(d[r]),_.get(e,"noUnhighlightOnShowErrors")!==!0&&this.settings.unhighlight.call(this,d[r],this.settings.errorClass,this.settings.validClass);$.isEmptyObject(t)||a()}}),$.validator.setDefaults({rules:{username:{maxlength:128,minlength:4,pattern_not_for_login:/^((?![-@\.\s]).)*$/},email:{maxlength:128,pattern:/^[-a-z0-9_+.]+@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,email_parentemail_same:!0,email_valid:!0,onfocusout:!1},parentEmail:{maxlength:128,pattern:/^[-a-z0-9_+.]+@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i,email_parentemail_same:!0},lastName:{maxlength:64},firstName:{maxlength:64},middleName:{maxlength:20},pronunciationName:{maxlength:64},suffix:{maxlength:20},"original-password":{original_password_required:!0,original_password_valid:!0},password:{minlength:6,maxlength:25,password_valid:!0},"password-check":{minlength:6,maxlength:25,password_match:!0},displayName_proposedDisplayName:{minlength:4,maxlength:100},displayName:{minlength:4,maxlength:100},terms:{required:!1,all_terms:!0,all_terms_policies:!0},securityQuestions_answer1:{security_answers_match:!0},securityQuestions_answer2:{security_answers_match:!0}},messages:{username:{minlength:window.localeMap.getAlertText("clnt_username_length_invalid").message,required:window.localeMap.getAlertText("clnt_username_and_password_missing").message,pattern_not_for_login:window.localeMap.getAlertText("clnt_username_chars_invalid").message},middleName:{},email:{email:window.localeMap.getAlertText("clnt_email_invalid").message,required:window.localeMap.getAlertText("clnt_email_rqd").message,email_parentemail_same:window.localeMap.getAlertText("clnt_email_parentemail_same").message,pattern:window.localeMap.getAlertText("clnt_email_invalid").message},parentEmail:{required:window.localeMap.getAlertText("clnt_parent_email_rqd").message,email_parentemail_same:window.localeMap.getAlertText("clnt_email_parentemail_same").message,pattern:window.localeMap.getAlertText("clnt_email_invalid").message},"original-password":{original_password_required:window.localeMap.getAlertText("clnt_password_rqd").message,original_password_valid:window.localeMap.getAlertText("clnt_original_password_error").message},password:{minlength:window.localeMap.getAlertText("clnt_password_too_short").message,required:window.localeMap.getAlertText("clnt_password_rqd").message,pattern:window.localeMap.getAlertText("clnt_password_bad_char").message,password_match:window.localeMap.getAlertText("clnt_passwords_different").message},"password-check":{minlength:window.localeMap.getAlertText("clnt_password_too_short").message,required:window.localeMap.getAlertText("clnt_password_rqd").message,pattern:window.localeMap.getAlertText("clnt_password_bad_char").message,password_match:window.localeMap.getAlertText("clnt_passwords_different").message},dateOfBirth:{required:window.localeMap.getAlertText("clnt_birthdate_rqd").message},"birthdate-year":{required:window.localeMap.getAlertText("clnt_birthdate_rqd").message},"birthdate-month":{required:window.localeMap.getAlertText("clnt_birthdate_rqd").message},"birthdate-day":{required:window.localeMap.getAlertText("clnt_birthdate_rqd").message},displayName_proposedDisplayName:{minlength:window.localeMap.getAlertText("clnt_dn_name_invalid").message},displayName:{minlength:window.localeMap.getAlertText("clnt_dn_name_invalid").message},terms:{all_terms:window.localeMap.getAlertText("clnt_terms_of_use_rqd").message,all_terms_policies:window.localeMap.getAlertText("clnt_terms_of_use_cookies_rqd").message},securityQuestions_question1:{required:window.localeMap.getAlertText("clnt_security_question_rqd").message},securityQuestions_question2:{required:window.localeMap.getAlertText("clnt_security_question_rqd").message},securityQuestions_answer1:{required:window.localeMap.getAlertText("clnt_security_answer_rqd").message,security_answers_match:window.localeMap.getAlertText("clnt_security_err_answers_same").message},securityQuestions_answer2:{required:window.localeMap.getAlertText("clnt_security_answer_rqd").message,security_answers_match:window.localeMap.getAlertText("clnt_security_err_answers_same").message}}})}function updateValidatorMessages(e){$.validator.defaults.messages=$.extend(!0,$.validator.defaults.messages,e)}function checkUsername(e,a,s){if(DisneyID.log("Checking username unique."),""===e.value)return void a.error("USERNAME_BLANK");DisneyID.Dispatch.check({profile:{checkLoginStatus:e.value}},{success:function(e){var s=_.get(e,"profile.accountStatus");"ACCOUNT_NOT_FOUND"===s?(DisneyID.log("Username is unique."),a.success(!0)):(DisneyID.log("Username is not unique."),a.success(!1))},error:function(e){DisneyID.log(e),a.error(e)}},"undefined"==typeof s?!0:s)}function checkDisplayName(e,a,s){if(DisneyID.log("Checking displayName."),""===e.value)return void a.error("INPUT_BLANK");DisneyID.Dispatch.check({displayName:e.value},{success:function(e){DisneyID.log(e.displayName),e.displayName.displayNameOk?(DisneyID.log("Displayname is OK."),a.success(!0)):(DisneyID.log("Displayname is bad."),a.success(!1,_.get(e,"displayName.displayNameStatus")))},error:function(e){DisneyID.log(e),a.error(e)}},"undefined"==typeof s?!0:s)}function checkEmail(e,a,s){return DisneyID.log("Checking email unique."),""===e.value?void a.error("EMAIL_BLANK"):void DisneyID.Dispatch.check({profile:{checkLoginStatus:e.value}},{success:function(e){var s=_.get(e,"profile.accountStatus");"ACCOUNT_NOT_FOUND"===s?(DisneyID.log("Email is unique."),a.success(!0)):(DisneyID.log("Email is not unique."),a.success(!1,s))},error:function(e){DisneyID.log(e),a.error(e)}},"undefined"==typeof s?!0:s)}function checkPassword(e,a,s){if(DisneyID.log("Checking password rules."),""===e.password)return void a.error("PASSWORD_BLANK");var t={profile:{validatePassword:{}}};$.each(e,function(e,a){t.profile.validatePassword[e]=a}),DisneyID.Dispatch.check(t,{success:function(e){DisneyID.log("Password check success"),DisneyID.log(e),e.profile&&"undefined"!=typeof e.profile.passwordValid?e.profile.passwordValid===!0?a.success(!0):a.error(e.profile.passwordValidErrorCodes?e.profile.passwordValidErrorCodes[0]:"UNKNOWN_ERROR_NO_CODE"):a.error("UNKNOWN_ERROR_NO_PROPERTY")},error:function(e){DisneyID.log("Password check fail"),DisneyID.log(e),a.error("UNEXPECTED_ERROR")}},"undefined"==typeof s?!0:s)}function checkOriginalPassword(e,a){return DisneyID.log("Checking password."),""===e.password?void a.error("PASSWORD_BLANK"):""===e.username?void a.error("USERNAME_BLANK"):void DisneyID.Dispatch.passwordLogin(e.username,e.password,!1,{success:function(e){a.success(e)},error:function(){a.error("PASSWORD_ERROR")}})}function setupPasswordValidation(e){$("#password"),$("#password-check");setValidatorDefaults(e),_.get(DisneyID.uiConfig,"passwordRulesValidate")===!1&&$(".password-info-alert").hide(),$("#show-password").on("change",function(){$(this).is(":checked")?$("#password").attr("type","text"):$("#password").attr("type","password")}),$(".password-info-alert").on("click",function(e){return showPasswordRules(e.target.parentNode),!1}),$(".password-info-alert-offset").on("click",function(e){return showPasswordRules(e.target.parentNode,null,!0),!1})}function checkForValidPassword(e){var a={password:e.val()};_.get(DisneyID.uiConfig,"passwordRulesValidate")!==!1&&checkPassword(a,{success:function(a){DisneyID.log("Password validate success"),a&&""!==e.val()&&(e.hasClass("success")?e.stop(!0,!0):(e.parent().removeClass("alertblock-container-error"),e.addClass("success").removeClass("success",1500)),$(".alertblock").each(function(){$(this).hasClass("password-rule-list")||$(this).fadeOut(100)}))},error:function(a){DisneyID.log("Password validate fail - "+a),e.parent().infoBubble({type:"error",message:localeMap.getAlertText("clnt_password_unknown_error").message}),showPasswordRules(e.parent())}})}function isValidDate(e,a,s){if(e=parseInt(e,10),a=parseInt(a,10),s=parseInt(s,10),isNaN(e)||isNaN(a)||isNaN(s))return!1;var t=new Date(e,a-1,s),r=""+t.getFullYear()+(t.getMonth()+1)+t.getDate(),i=""+e+a+s;return i===r}function checkDateOfBirth(e){var a=$("#birthdate-year"),s=a.parents(".control-group").attr("aria-describedby"),t=a.parents("form:first").attr("id");s&&Accessibility.validation.clearByEntryId(t,s);var r=a.val(),i=$("#birthdate-month").val(),n=$("#birthdate-day").val(),o=$("#birthdateSelectors"),l=function(){$(".alertblock").each(function(){$(this).fadeOut(100)})};if(0===o.length&&(o=$("#birthdate-month").parent().parent().closest(".controls")),$("body").one("click",function(){l()}),"undefined"!=typeof event&&"function"==typeof event.stopPropagation&&event.stopPropagation(),"undefined"!=typeof e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),!isValidDate(r,i,n))return o.infoBubble({message:localeMap.getAlertText("clnt_birthdate_invalid").message,type:"error",anyClickHide:!1}),!1;if(""===r||""===i||""===n)return o.infoBubble({message:localeMap.getAlertText("clnt_birthdate_rqd").message,type:"error",anyClickHide:!1}),!1;if(!/^\d+$/.test(r)||!/^\d+$/.test(i)||!/^\d+$/.test(n))return 0===$(".alertblock-dateOfBirth:visible").length&&o.infoBubble({message:localeMap.getAlertText("clnt_birthdate_invalid").message,type:"error",anyClickHide:!1}),!1;var d=new Date(r,i-1,n,0,0,0,0),c=new Date;return d>c?(0===$(".alertblock-dateOfBirth:visible").length&&o.infoBubble({message:localeMap.getAlertText("clnt_birthdate_not_in_past").message,type:"error",anyClickHide:!1}),!1):!0}function removeAllErrors(e){$("label",e).parents().removeClass("error"),$("label",e).parents().removeClass("alertblock-container-error"),$("label.error",e).hide()}function showPasswordRules(e,a,s){if(window.openPasswordRulesBubble)return void window.openPasswordRulesBubble();var t={heading:window.localeMap.getText("clnt_password_help_heading"),rule1:window.localeMap.getText("clnt_password_rule1"),rule2:window.localeMap.getText("clnt_password_rule2")},r="<p><strong>{{heading}}</strong></p><ul><li>{{rule1}}</li><li>{{rule2}}</li></ul>",i="{{heading}}:\n{{rule1}}.\n{{rule2}}.";$.each(t,function(e,a){var s=new RegExp("{{"+e+"}}","g");r=r.replace(s,a),i=i.replace(s,a)});var n=$.extend({message:r,placement:"bottom",type:"information",addClass:"wide-alert password-rule-list",anyClickHide:!0,alertAttributes:{"aria-hidden":!0}},a);s&&(n.manualOffsetX=-200,n.manualArrowOffsetX=370),setTimeout(function(){Accessibility.generalAlert("passwordRules",i)},5500),$(e).infoBubble(n)}$.validator.addMethod("email",function(e,a){return this.optional(a)||/^.+@.+$/i.test(e)}),$.validator.addMethod("all_terms",function(){var e,a=$("#twdc_form").find("input[name=terms]");if(a.length<2)for(e=0;e<a.length;e++)if(a[e].checked===!1)return!1;return!0}),$.validator.addMethod("all_terms_policies",function(){var e,a=$("#twdc_form").find("input[name=terms]");if(a.length>1)for(e=0;e<a.length;e++)if(a[e].checked===!1)return!1;return!0}),$.validator.addMethod("original_password_required",function(e){return""!==e||""===e&&""===$("#password").val()&&(""===window.showPasswordConfirmation||""===$("#password-check").val())}),addDelayedMethod("original_password_valid",function(e,a){if(""===a)return!0;var s={username:window.guest.profile.username,password:a};checkOriginalPassword(s,{success:function(){DisneyID.log("original password validate success"),e.valid()},error:function(a){DisneyID.log("Password validate fail "+a),e.invalid()}})}),addDelayedMethod("password_valid",function(e,a,s){if(""===a)return!0;if(_.get(DisneyID.uiConfig,"passwordRulesValidate")===!1)return!0;var t={password:a};_.get(window,"guest.profile")&&(t.username=_.get(window.guest.profile,"username"),t.firstName=_.get(window.guest.profile,"firstName"),t.lastName=_.get(window.guest.profile,"lastName"),t.middleName=_.get(window.guest.profile,"middleName"),t.pronunciationName=_.get(window.guest.profile,"pronunciationName")),checkPassword(t,{success:function(){DisneyID.log("Password validate success"),e.valid()},error:function(a){DisneyID.log("Password validate fail - "+a),e.invalid(localeMap.getAlertText("clnt_password_unknown_error").message),$(s).trigger("show-password-rules")}})}),addDelayedMethod("email_valid",function(e,a,s){return a&&a!==_.get(window,"guest.profile.email")?void checkEmail(s,{success:function(a){a?e.valid():e.invalid(localeMap.getAlertText("clnt_email_not_unique").message)},error:function(a){DisneyID.log("Email validate fail - "+a),e.invalid(localeMap.getAlertText("clnt_email_unusable").message)}}):!0}),$.validator.addMethod("password_match",function(e,a){var s=$(a),t=$("#password"),r=$("#password-check");return t.length+r.length<=1?!0:t.hasClass("required")||""!==t.val()||""!==r.val()?s.is("#password")&&""===r.val()?!0:t.val()==r.val():!0}),$.validator.addMethod("email_parentemail_same",function(e,a){var s,t=$(a).attr("id");"email"==t?s="parentEmail":"parentEmail"==t&&(s="email");var r=$("#"+s).val();return""===e||""===r?!0:e==r?!1:!0}),$.validator.addMethod("security_answers_match",function(){for(var e,a=$("#securityQuestions_answer1").val(),s=$("#securityQuestions_answer2").val(),t=0,e=$(".security-questions input");e[t];t++)this.settings.unhighlight.call(this,e[t],this.settings.errorClass,this.settings.validClass),$.infoBubble.hide(e[t]);return a===s?!1:!0}),$.validator.addMethod("pattern_not_for_login",function(e,a,s){var t=$(a);return t.hasClass("login-input")?!0:s.test(e)}),$.validator.addMethod("dob_valid",function(){return checkDateOfBirth()}),$(function(){var e=$(document.body);e.hasClass("inline-labels")&&!$("body").hasClass("page-login")&&e.on("focus","#password",function(e){showPasswordRules(e.target,{anyClickHide:!1,hideOnFocus:!1,hideOnBlur:!0})})});
var Accessibility={};Accessibility.alert=function(){"use strict";var t,e=function(e){t||(t=$("#screenreader-alerts > li"));var r=t.filter("[data-inuse=false]").eq(0);return 0===r.length?!1:(e=e.replace(/<\//g," </"),e=$("<div>"+e+"</div>").text(),r.attr("data-inuse",!0),r.html(" ").html('<div role="alert" aria-live="rude">'+e+"</div>"),{$li:r,destroy:function(){this.$li.html("").attr("data-inuse",!1)}})};return e.clearAll=function(){this.validation.clearAll(),t.filter("[data-inuse=true]").html("").attr("data-inuse",!1)},e}(),Accessibility.generalAlert=function(){"use strict";function t(t){e[t]&&e[t].destroy(),delete e[t]}var e={};return function(r,i,n){n=n||5e3,e[r]&&t(r);var a=Accessibility.alert(i);return a?(e[r]=a,void setTimeout(function(){t(r)},n)):!1}}(),Accessibility.formLogs=function(){function t(){var t=$("ul.screenreader[role=log]").filter("[data-inuse=false]").eq(0);return t.length?t:!1}var e={};return{getFormLog:function(r){if(e[r])return e[r];var i=t();return i?(i.attr("data-inuse",!0),e[r]={id:r,$ul:i,refresh:function(){var t=this.$ul.html();this.$ul.html(" ").html(t)},entries:[]},e[r].entries.indexOfById=function(t){for(var e=0;e<this.length;e+=1)if(this[e].$li.attr("id")===t)return e;return-1},e[r]):!1}}}(),Accessibility.validation=function(){"use strict";function t(t){var e=localeMap.getText("clnt_ar_error"),r=$("<div>"+t+"</div>");return r.children("strong").remove(),t=e+": "+r.text()}function e(t){var e=t.input.getAttribute("aria-describedby");e&&Accessibility.validation.clearByEntryId(t.formId,e)}return{clearForm:function(t){var e=Accessibility.formLogs.getFormLog(t);if(e)for(;e.entries.length;)e.entries[0].destroy()},clearByEntryId:function(t,e){var r=Accessibility.formLogs.getFormLog(t);if(r){var i=r.entries.indexOfById(e);-1!==i&&r.entries[i].destroy()}},link:function(r,i){var n=$(r).parents("form:first").attr("id");if(!n)return!1;var a=Accessibility.formLogs.getFormLog(n);if(a){var l="sr-e-"+String(a.entries.length+1);i=t(i);var s=$("<li>"+i+"</li>").attr("id",l),u={log:a,input:r,$li:s,formId:n,currentAriaLabelledBy:s.attr("aria-labelledby"),destroy:function(){var t=this.input;t.removeAttribute("aria-invalid"),t.removeAttribute("aria-describedby"),this.currentAriaLabelledBy?t.setAttribute("aria-labelledby",this.currentAriaLabelledBy):t.removeAttribute("aria-labelledby");var e=this.log.entries.indexOfById(l);this.log.entries.splice(e,1),this.$li.remove()}};return e(u),s.appendTo(a.$ul),r.setAttribute("aria-invalid","true"),r.setAttribute("aria-describedby",l),r.setAttribute("aria-labelledby",l),a.entries.push(u),u}}}}(),Accessibility.setAriaFocus=function(t){var e=$(t).attr("tabindex","0").focus();setTimeout(function(){e.focus(),e[0].removeAttribute("tabindex")},1e3)};
!function(e){function r(){this.$form.validate(this.config.validate),this.attachFormHandlers()}function t(){var e=this;e.$form.on("submit",function(e){e.preventDefault()}),e.config.submitButton&&e.$form.find(e.config.submitButton).on("click",function(r){r.preventDefault(),e.$form.submit()})}function o(){if(this.$form.valid()){DisneyID.showLoader();var r=this;this.config.onSubmit({success:function(e){var t=r.config.onSuccess(e);DisneyID.postMessageTransport.send("scrollTop"),t!==!1&&DisneyID.hideLoader()},error:function(t){try{r.handleResponseError(e.parseJSON(t.responseText))}catch(o){DisneyID.log("Error while displaying the error!",o.name,o.message),r.handleResponseError()}DisneyID.hideLoader()},unauthenticated:DisneyID.redirectToLogin})}}function i(e){var r,t=_.get(e,"raw."+this.config.requestSection+".raw.result")||_.get(e,"raw.result"),o=_.get(e,"type");o||(o=_.get(t,"code")||_.get(t,"error")||_.get(e,"code")||_.get(e,"error")||"UNKNOWN",DisneyID.log('README: Is this a service error or expected error? Expected errors should be in "type"',o)),r=_.get(this.config.requestErrorMessages,o)||this.config.requestErrorMessages.DEFAULT,DisneyID.log(o,_.get(t,"optionalDeveloperMessage")||_.get(e,"optionalDeveloperMessage")),"function"==typeof r&&(r=r(e)),r&&this.showResponseError(r)}function s(r){var t,o={},i=window.localeMap.getAlertText(r).message;if("function"==typeof this.config.getMessageTokens&&i.indexOf("<token: ")>=0){t=this.config.getMessageTokens();for(var s in t)i=i.replace(new RegExp("<token: "+s+">","g"),_.escape(t[s]))}if(this.config.requestError.highlight)for(var n=0;n<this.config.requestError.highlight.length;n++)o[this.config.requestError.highlight[n]]="";o[this.config.requestError.messageOn]=i,this.$form.validate().showErrors(o);var a=e("#"+this.config.requestError.messageOn).closest(".control-group").find("label.error");a.attr("for",a.find("a:first").length?"":this.config.requestError.messageOn)}var n=function(r){var t=this,o={validate:{submitHandler:function(){t.handleSubmit()}}};this.config=e.extend(!0,o,r),this.$form=e(r.formTag)};e.extend(n.prototype,{init:r,handleSubmit:o,handleResponseError:i,showResponseError:s,attachFormHandlers:t}),e.formWiring=function(e){var r=new n(e);r.init()}}(window.jQuery);
function showDomainError(e){window.location="domainError.php?client_id="+encodeURIComponent(e)}function showGeneralMessage(e){"undefined"==typeof e&&(e='<div id="service-error" class="padme center"><h3>'+localeMap.getText("clnt_service_down1")+"</h3><h2>"+localeMap.getText("clnt_service_down2")+"</h2></div>");var t=$("#disneyid-messagediv");t.siblings("#loader").hide(),t.empty().html(e).show()}function parseDateString(e){var t,i;if(/^\d{4}-\d{2}-\d{2}$/.test(e)&&(t=e.split("-"),i=new Date(Date.UTC(parseInt(t[0],10),parseInt(t[1],10)-1,parseInt(t[2],10))),!isNaN(i.getTime())))return i}function getContinueToLinkHTML(){"use strict";var e="<div id='lightboxContinueLink'><a href='"+DisneyID.getParameterByName("siteURL")+"'>"+localeMap.getText("clnt_ma_continue_to")+" "+DisneyID.getParameterByName("siteName")+" &raquo;</a></div>";return e}function getDOBTextFields(e){var t="",i=e.split("-");if(3!=i.length)throw"Date of birth is not yyyy-mm-dd format: "+e;var n=i[0],a=i[1],r=i[2];return t+='<input type="text" id="dateOfBirth" name="dateOfBirth" disabled="disabled" class="required" value="'+encodeURI(e)+'" />',t+='<input type="hidden" id="birthdate-year" name="birthdate-year" value="'+encodeURI(n)+'" />',t+='<input type="hidden" id="birthdate-month" name="birthdate-month" value="'+encodeURI(a)+'" />',t+='<input type="hidden" id="birthdate-day" name="birthdate-day" value="'+encodeURI(r)+'" />'}function attachGenderEventHandlers(){_.get(DisneyID,"uiConfig.useGenderRadioButtons",!1)&&$("label.btn-set-gender-label").click(function(){var e=$(this).prop("for"),t=e.split("-").slice(-1);setGenderValue(t)})}function setGenderValue(e){var t=$("#gender");t.val(e),_.get(DisneyID,"uiConfig.useGenderRadioButtons",!1)&&($("label.btn-set-gender-label").removeClass("btn-set-label-active"),$("label[for=gender-"+e+"]").addClass("btn-set-label-active"),0!==e&&"0"!==e&&t.valid())}function attachNameFieldKeypressHandlers(){$("#firstName, #middleName, #lastName, #pronunciationName").on("keypress",function(e){return 37===(e.charCode?e.charCode:e.which)?(e.preventDefault(),!1):void 0})}function populateFromParameters(e,t){var i=new DisneyID.Hash,e=e||null;if(i.keyExists("createFields")&&null===e)e=i.get("createFields");else if(i.keyExists("guest")&&null===e)return e=i.get("guest"),void populateFromParameters(flattenGuestForForm(e),t);for(var n in e){var a=e[n];if(n=n.replace(/^profile_/,""),n=n.replace(/^nrt_/,""),"gender"==n)"male"==a&&(a="1"),"female"==a&&(a="2"),setGenderValue(a);else if("dateOfBirth"==n){var r=$.cookie("did_dob"),o=a.split("-"),s=3===o.length,d=parseInt(o[0],10);if(s&&d||(a=null),r||"CHILD"==t&&a){var l=$("fieldset.birthdate");l.children("label").siblings().remove(),l.append(getDOBTextFields(r||a))}else s&&(d&&$("#birthdate-year").val(o[0]),$("#birthdate-month").val(o[1]),$("#birthdate-day").val(o[2]))}else"password"==n||"original-password"==n?$("input[name="+n+"]").val(a):a&&$("#"+n).val(a)}}function flattenGuestForForm(e,t,i){var n=t?t:{};for(var a in e)e.hasOwnProperty(a)&&("[object Array]"!==Object.prototype.toString.call(e[a])&&"object"==typeof e[a]?n=flattenGuestForForm(e[a],n,i?i+"_"+a:a):i?n[i+"_"+a]=e[a]:n[a]=e[a]);return n}function showInterstitial(e,t){var i=$("#pageValuePropHeader"),n=$('<footer class="interstitial-footer"></footer>'),a=$("#disneyid-messagediv").removeClass("loader").addClass("center interstitial-content relative solidwhitebg nobgimage").html("<h2>"+e+"</h2>"+t).css({height:"auto",top:0});i.hide(),$("#twdc_form").hide(),a.siblings("#loader").hide(),a.parent().append(n)}function hideInterstitial(){var e=$("footer.interstitial-footer"),t=$("#disneyid-messagediv"),i=$("#twdc_form");e.hide(),t.hide(),i.show()}function sendConfirmationEmail(e){var t={username:window.credentials.username,password:window.credentials.password},i={success:function(e){DisneyID.log(e)},error:function(e){DisneyID.log(e)}};DisneyID.Dispatch.sendConfirmationEmail(t,e,i);var n="";n="BOTH"==e?"<h2>"+localeMap.getText("clnt_gate_emails_sent")+"</h2>":"<h2>"+localeMap.getText("clnt_gate_email_sent")+"</h2>",n+="<p>"+localeMap.getText("clnt_gate_adult_confirm")+"</p>";var a=localeMap.getText("clnt_resend_email");return n+='<p class="resend_link"><a href="" onclick="return sendConfirmationEmail(\''+e+"');\">"+(a?a:"Resend email")+"</a></p>",DisneyID.throwMessage(n),!1}function getFirstAddress(e){for(var t in e||{})if(e.hasOwnProperty(t))return e[t]}function _doCreateSuccess(e){DisneyID.log("inCreateSuccess");var t=e.profile||{},i=getFirstAddress(t.addresses);if("undefined"!=typeof _.get(e,"displayName.type")){var n=$.extend({},e.displayName);e.displayName=null}DisneyID.postMessageTransport.send("doTealium",$.extend(window.utag_data,{swid:_.get(e,"profile.swid"),page_name:"create-profile-success-background",t_registration_type:DisneyID.getParameterByName("mode","default_form_flow"),form_name:"registration",region:i&&i.stateProvince?i.stateProvince:"",dob:t.dateOfBirth||"",gender:t.gender||""})),DisneyID.Dispatch._writeLoginCookies(e.token,e,{success:function(){var t=_.get(n,"type"),i=!1,a="";switch(t){case"DISPLAYNAME_TOKEN_MISSING_SWID":DisneyID.log("DISPLAYNAME ERROR: "+t),i=!1;break;case"DISPLAYNAME_EXISTS":i=!0,a="DISPLAY_NAME_EXISTS";break;case"DISPLAYNAME_FORBIDDEN_VALUE":i=!0,a="FORBIDDEN_VALUE";break;default:i=!1}if(i){DisneyID.postMessageTransport.send("scrollTop"),DisneyID.Notify.onCreate(e);var r={mode:"create"};return""!==a&&(r.reason=a),DisneyID.navigate("update-displayname",{inputData:e,queryUpsert:r}),!1}if(DisneyID.isFeatureEnabled("successPageAfterCreate")||DisneyID.isFeatureEnabled("invokedFromEmail"))DisneyID.postMessageTransport.send("scrollTop"),DisneyID.log("Appending form redirect..."),"direct"!==DisneyID.flow&&DisneyID.Notify.onCreate(e),DisneyID.navigate("create-profile-success",{inputData:e});else{if(window.guest=e,!e.loginAuthorized)return void DisneyID.navigate("update-partial-profile",{inputData:e});DisneyID.Notify.trigger("guest-create-login",e,function(){DisneyID.postMessageTransport.send("closeTopIFrame")})}}})}function check3rdPartyCookies(){$.cookie("did_3POd_test");$.cookie("did_3POd_test",null)}function loadPageValueProp(){DisneyID.log("loadPageValueProp");var e=DisneyID.getParameterByName("page"),t=$("#pageValuePropHeader"),i=$("#loader");if("undefined"!=typeof e&&"silentlogin"!=e&&"silent-client-functions"!=e){var n=DisneyID.getParameterArray();if(DisneyID.Notify.onReady({page:e,params:n}),"direct"!==DisneyID.flow)var a=window.setInterval(function(){var e=$("input[type=text],input[type=email]").first();e.length>0&&!e.is(":hidden")&&(e.focus(),window.clearInterval(a))},100)}if(t.size()>0)if(0===i.size()||i.is(":visible")===!1)t.show();else var r=setInterval(function(){i.is(":visible")===!1&&(t.show(),clearInterval(r))},100)}function doTealium(e,t){var i=DisneyID.utagPath;if(_.extend(window.utag_data,e),"undefined"!=typeof window.utag)if(DisneyID.log("doTealium",e),t){var n={page_name:window.utag_data.page_name,url:window.utag_data.url,server_name:window.utag_data.server_name,client_id:window.utag_data.client_id};$.extend(window.utag_data,n),$.extend(n,e),DisneyID.Notify.doTealium(n,t)}else window.utag.view(e);else DisneyID.log("doTealium: loading tealium script"),$.ajax({url:i,type:"GET",dataType:"script",cache:!0,complete:t||$.noop});return DisneyID.postMessageTransport.send("logUtagData",{utag_data:window.utag_data}),!0}DisneyID.renderWidgets=function(){var e,t=new Date,i=$("select#birthdate-year");if(i.length){var n,a="",r=t.getFullYear(),o=i.data("selected");if(i.children("option").length<=1){for(e=0;130>e;e++)n=r-e,a+='<option value="'+n+'"'+(n===o?' selected="selected"':"")+">"+localeMap.getText("clnt_year_pattern").replace("%Y",n)+"</option>";i.append(a)}DisneyID.manageDOBCookieDisplay()}},DisneyID.manageDOBCookieDisplay=function(){var e,t=DisneyID.readCookie("did_dob"),i=$("#birthdate"),n=$('#dob-locked input[type="hidden"]');t?(i.hasClass("dob-cookieset")||(i.addClass("dob-cookieset"),n.attr("disabled",!1),$('#dob-locked input[type="text"]').val(L10n.utils.toLocaleDateString({date:L10n.utils.fromDateString(t,"YYYY-MM-DD"),locale:_.get(window,"localeData.locale","en-US"),opts:{month:"long",day:"numeric",year:"numeric"}}))),e=t.split("-"),$('[name="birthdate-year"]',i).val(e[0]),$('[name="birthdate-month"]',i).val(e[1]),$('[name="birthdate-day"]',i).val(e[2])):(i.removeClass("dob-cookieset"),n.attr("disabled",!0))};var setupPlaceholderShims=function(){"use strict";function e(e,t){""!==e.val()?t.hide():t.show()}function t(t){var i=$("label[for="+t.prop("name")+"]"),n=t.data("hasPlaceholderShim");if(n||!a||t.prop("placeholder")){if(n)return void e(t,i);if(t.is(":disabled"))return void i.hide();0===i.length&&(i=$("<label>").prop("for",t.prop("id")).insertBefore(t)),i.text(t.prop("placeholder")),t.removeAttr("placeholder"),i.show(),i.addClass("simulate-placeholder").css({"line-height":t.css("height")}),t.on("keydown keyup",function(){_.defer(e,t,i)}),t.on("blur change",function(){e(t,i)}),t.data("hasPlaceholderShim",!0),e(t,i)}}var i=navigator.userAgent.toLowerCase(),n=-1!==i.indexOf("msie")||-1!==i.indexOf("trident"),a="placeholder"in document.createElement("input");return function(){!_.get(DisneyID,"uiConfig.inlineLabels")||a&&!n||($("input, textarea").not("[type=checkbox]").not("[type=hidden]").each(function(){t($(this))}),$("label[for=dateOfBirth]").hide())}}();"undefined"==typeof DisneyID&&(window.DisneyID={}),DisneyID.navigate=function(e,t){$(".alertblock").hide();var t=t||{},i=$.extend(DisneyID.queryStringToObj(),{page:e},t.queryUpsert||{});if(t.queryDelete)for(var n=0;n<t.queryDelete.length;n++)delete i[t.queryDelete[n]];var a=("direct"===DisneyID.flow?"?":"/DisneyID.php?")+DisneyID.buildQueryStringFromObj(i)+(t.hash?"#"+t.hash:"");if(t.formID||t.inputData){var r=t.formID?$(t.formID):!1;r&&r.length||(r=$("<form>",{id:"form-redirect",method:t.method||"post",action:a}).css({display:"none"}).append($("<input>",{type:"hidden",name:t.inputName||"Guest",value:encodeURIComponent(DisneyID.toJSON(t.inputData))})).appendTo("body")),DisneyID.getDebugRedirects()?window.confirm(a+"\n\n"+r.serialize())&&r.submit():r.submit()}else DisneyID.getDebugRedirects()?window.confirm(a)&&(window.location.href=a):window.location.href=a},DisneyID.resizeLightbox=function(){var e,t,i,n=25,a=660,r=Math.round(1e3/n),o=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,r)},s=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(e){window.clearTimeout(e)};return function(n,d,l){var c,u,p,D=_.now(),h=function(){u=_.now(),p=u-D,p>=r&&(i=d||l.clientHeight,i!==c&&(DisneyID.postMessageTransport.send("resizeFrame",{size:t+","+i}),c=i),D=u),e=o(h)};l=l||document.getElementById("disneyid-content")||document.body,t=n||t||a,s(e),h()}}(),DisneyID.throwMessage=function(e,t){var i=$(t),n="disneyid-messagediv",a=$("#"+n);$("#pageValuePropHeader").remove(),i.length||(i=$("form")),a.length||(a=$('<div id="'+n+'"/>'),i.parent().append(a)),i.hide(),a.addClass("relative nobgimage").css({top:0,height:"auto"}).html(e).show(),$("#loader").hide(),a.removeClass("loader"),DisneyID.postMessageTransport.send("scrollTop")},DisneyID.throwServiceError=function(e){var t='<div id="service-error"><h3>'+localeMap.getText("clnt_service_down1")+"</h3><h2>"+localeMap.getText("clnt_service_down2")+"</h2></div>";DisneyID.throwMessage(t,e||"#twdc_form")},DisneyID.showLoader=function(){var e=$("#disneyid-messagediv.loader");0===e.length?(e=$("<div>").addClass("loader"),$("body").append(e)):e.show()},DisneyID.hideLoader=function(){DisneyID.loader(!1),$(".loader").hide(),$("#loader").hide(),$(".wait").hide(),$("#disneyid-loaderdiv").remove(),$("#twdc_form").show()},DisneyID.redirectToLogin=function(){DisneyID.navigate("login",{queryUpsert:{"login-expired":1,redirect:document.URL}})},DisneyID.initViewModeListener=function(){function e(e){var t;try{t=$.parseJSON(e.data)}catch(i){return}t&&t.viewMode&&$("body").attr("data-view-mode",t.viewMode)}window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("message",e)},DisneyID.getDomain=function(){var e=DisneyID.parseUrl(document.referrer);return e.protocol+"//"+e.host},DisneyID.generatePassword=function(e){var t,i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n="1234567890",a="$%&#!",r="",o=e/2,o=o-1,s=e-o-o;for(t=0;o>t;t++)r+=i.charAt(Math.floor(Math.random()*i.length));for(t=0;s>t;t++)r+=a.charAt(Math.floor(Math.random()*a.length));for(t=0;o>t;t++)r+=n.charAt(Math.floor(Math.random()*n.length));return r=r.split("").sort(function(){return.5-Math.random()}).join("")},DisneyID.loader=function(e,t){var i,n,a;return t||(t="#disneyid-page-content"),t.jquery?(i=t,t=i.selector):i=DisneyID.cache[t]||$(t),i.length?(a=i.find("> .loader").not("#disneyid-messagediv"),a.length&&(a.remove(),i.data("disabled",!1),delete DisneyID.cache[t]),e?(DisneyID.cache[t]=i,n=i.css("position"),i.data("disabled",!0),n&&"static"!==n||i.css({position:"relative"}),i.append('<div class="loader"></div>'),!0):!0):!1},DisneyID.clearDIDStorage=function(){DisneyID.deleteCookie("did.token"),DisneyID.isLocalStorageEnabled()&&localStorage.clear()};
function did_centerPopup(e){var t=30;e.css({top:$(".disneyid-modal-header").height()+t,left:Math.round(($("#disneyid-content").outerWidth()-$(e).outerWidth())/2)}),DisneyID.postMessageTransport.send("scrollTop")}function confirmLightboxClose(){var e=$(".bg-cover"),t=$("#closeConfirmationPopup"),i=$("#close-warning-close"),n=$("#close-warning-cancel");did_centerPopup(t),t.show(),e.show(),i.unbind("click").bind("click",function(){DisneyID.postMessageTransport.send("closeTopIFrame")}),n.unbind("click").bind("click",function(){t.hide(),e.hide()}),DisneyID.postMessageTransport.send("addCloseConfirmationEvent",null,{success:confirmLightboxClose})}function setBrandedGuestText(e){if(""!==(_.get(e,"profile.firstName")||"")){var t=$(".branded-management .welcome"),i=$(".branded-management header.top h1 span"),n=window.localeMap.getText("srvr_hello").replace("<guestFname>",'<a href="#" class="gray dotted">'+e.profile.firstName+"</a>");t.html(n),i.text((_.get(e,"profile.firstName")||"")+" "+(_.get(e,"profile.lastName")||""))}}function startRefreshingRequests(){var e=15;window.setInterval(refreshPendingRequestsCount,1e3*e)}function refreshPendingRequestsCount(){var e=_.get(window,"guest.family");e&&("OWNER"===_.get(e,"thisMember.role")||"ADMIN"===_.get(e,"thisMember.role"))&&familyHasChildren(window.guest)&&(DisneyID.log("Refreshing requests..."),loadAllMembersActivities(window.guest,{success:function(e){var t=collateAllMembersActivities(e,!0);$.isEmptyObject(t)||setPendingRequestsCount(Object.size(t))}}))}function setPendingRequestsCount(e){var t=$("#requests-link .nav-badge");e>0?t.text(e).css("display","inline-block"):t.hide()}function decrementPendingRequestsCount(e){var t=$("#requests-link .nav-badge"),e=e||1,i=parseInt(t.html(),10)-e;setPendingRequestsCount(i)}function loadAllMembersActivities(e,t){DisneyID.Dispatch.getProfile({family:{action:"GET_ALL_MEMBERS_ACTIVITIES",familyGUID:e.family.familyGUID}},e.token,{success:t.success||$.noop,error:t.error||$.noop})}function collateAllMembersActivities(e,t){var i={};for(var n in e.family.members)if(e.family.members.hasOwnProperty(n)){var s=e.family.members[n];if("CHILD"===s.ageBand&&s.activities)for(var a in s.activities)if(s.activities.hasOwnProperty(a)){var o=s.activities[a],r=o.activityPermissionGuid;t&&"PENDING"!==o.state||(i[r]=o)}}return DisneyID.log("Collated requests:",i),i}function familyHasChildren(e){var t=_.get(e,"family.members");for(var i in t)if("CHILD"===t[i].ageBand)return!0;return!1}DisneyID.attachToggleHandlers=function(e){var t=$(e);t.find("[data-toggle]").unbind("click").bind("click",function(){var e=$(this);return e.closest("[data-toggle-catch]").toggleClass(e.attr("data-toggle")),!1}),t.find("[data-toggle-on]").unbind("click").bind("click",function(){var e=$(this);return e.closest("[data-toggle-catch]").addClass(e.attr("data-toggle-on")),!1}),t.find("[data-toggle-off]").unbind("click").bind("click",function(){var e=$(this);return e.closest("[data-toggle-catch]").removeClass(e.attr("data-toggle-off")),!1})};
!function(e){DisneyID=DisneyID||{};var o={apiVersion:"v2.2",namespace:"AM-FACEBOOK",_scope:"email,public_profile,user_friends,user_birthday",_oauthUrl:"https://www.facebook.com/dialog/oauth",_loginStatus:"UNKNOWN",_fbAuthResponse:null,_facebookId:null,_facebookToken:null,_mappingGuid:null,_userProfile:null,init:function(n){DisneyID.log("FBUTIL: In init facebook"),DisneyID.log(n),o._loginStatus="LOGGED_IN",o._facebookId=n.accountMapping[o.namespace].id,o._facebookToken=n.accountMapping[o.namespace].auth.accessToken,o._userProfile=e.extend({},n.profile),DisneyID.SharedStorage.writeData("facebookId",n.accountMapping[o.namespace].id,30)},login:function(e){var n=new DisneyID.Hash;if("facebook-login"===n.get("state"))return n.deleteItem("state"),void o._loginCallback({authResponse:FB.getAuthResponse()},e);var i={scope:o._scope};"true"!==DisneyID.getParameterByName("socialRedirect")?FB.login(function(n){o._loginCallback(n,e)},i):DisneyID.postMessageTransport.send("getTopUrl",null,{success:function(e){var n=o._oauthUrl+"?"+DisneyID.buildQueryStringFromObj({client_id:DisneyID.facebookSettings.applicationId,response_type:"token",state:"facebook-login",scope:i.scope,redirect_uri:e})+"#";DisneyID.log(n),DisneyID.postMessageTransport.send("setTopUrl",{url:n})}})},_loginCallback:function(e,n){DisneyID.log("FBUTIL Response:"),DisneyID.log(DisneyID.toJSON(e)),e.authResponse?(DisneyID.log("FBUTIL: Logged in to Facebook"),o._loginStatus="LOGGED_IN",o._facebookId=e.authResponse.userID,o._facebookToken=e.authResponse.accessToken,DisneyID.SharedStorage.writeData("facebookId",e.authResponse.userID,30,function(){n(e)})):(DisneyID.log("User cancelled login or did not fully authorize."),n(e))},getProfileForConnect:function(e){var n={};if(e&&e.id){if(n.profile||(n.profile={}),n.accountMapping={},n.accountMapping[o.namespace]={},!e.profile){if(n.profile.firstName=e.first_name||null,n.profile.lastName=e.last_name||null,e.birthday){var i=e.birthday.split("/");n.profile.dateOfBirth=i[2]+"-"+i[0]+"-"+i[1]}n.profile.email=e.email||null,n.profile.gender="male"==e.gender?1:2,n.profile.languagePreference=e.locale||null}n.accountMapping[o.namespace].id=e.id,n.accountMapping[o.namespace].auth=e.authResponse,DisneyID.navigate("social-login",{queryUpsert:{namespace:o.namespace},hash:"guest="+encodeURIComponent(DisneyID.toJSON(n))})}else DisneyID.log("Facebook flow cannot continune.")},logout:function(e){FB.logout(function(n){DisneyID.log("User is logged out."),DisneyID.log(n),o._loginStatus="LOGGED_OUT",e(n)})},getLoginStatus:function(e){FB.getLoginStatus(function(n){DisneyID.log("FB.getLoginStatus"),DisneyID.log(DisneyID.toJSON(n)),"connected"===n.status?(DisneyID.log("Logged in"),o._loginStatus="LOGGED_IN",o._facebookId=n.authResponse.userID,o._facebookToken=n.authResponse.accessToken,DisneyID.SharedStorage.writeData("facebookId",n.authResponse.userID,30,function(){e(o._loginStatus)})):"not_authorized"===n.status?(DisneyID.log("Logged in but not authorized."),o._loginStatus="NOT_AUTHORIZED",DisneyID.deleteLocalData(["facebookId","facebookLogin"]),e(o._loginStatus)):(DisneyID.log("Not Logged in."),o._loginStatus="LOGGED_OUT",DisneyID.deleteLocalData(["facebookId","facebookLogin"]),e(o._loginStatus))})},getProfile:function(e){function n(e){return e&&e.id&&e.birthday&&e.email?!0:!1}n(o._userProfile)?(DisneyID.log("FBUTIL: Get User Profile from object"),e(o._userProfile)):(DisneyID.log("FBUTIL: Get User Profile from FB"),FB.api("/me",function(n){n.error?(DisneyID.log("FBUTIL-ERROR: Getting User Profile from FB"),DisneyID.log(n),e(null)):(DisneyID.log("FBUTIL: Success"),DisneyID.log(DisneyID.toJSON(n)),o._userProfile=n,delete n.bio,delete n.quotes,e(n))}))},deleteApp:function(e){DisneyID.log("FBUTIL: deleting app association from FB"),FB.api("/me/permissions","DELETE",function(o){DisneyID.log(o),"function"==typeof e&&e(o)})},getFacebookId:function(e){return"function"!=typeof e?void DisneyID.log("FBUTIL: getFacebookId error"):(DisneyID.log("FBUTIL: Getting facebook ID"),void(o._facebookId?(DisneyID.log("FB.getLoginStatus : facebookId="+o._facebookId+" from object"),e(o._facebookId)):DisneyID.SharedStorage.readData("facebookId",function(o){o&&o.length>0?(DisneyID.log("FB.getLoginStatus : facebookId="+o+" from cache"),e(o)):window.FB?window.FB.getLoginStatus(function(o){"connected"===o.status?(DisneyID.log("FB.getLoginStatus : facebookId="+o.authResponse.userID),DisneyID.SharedStorage.writeData("facebookId",o.authResponse.userID,30,function(){}),e(o.authResponse.userID)):(DisneyID.log("FB.getLoginStatus - not connected"),e(null))}):(DisneyID.log("FB object not present. Could be the async load lagging."),e(null))})))},checkFacebookLogin:function(e){DisneyID.log("FBUTIL:checking for active login"),this.getFacebookId(e)},checkLink:function(){DisneyID.log("FBUTIL: Checking FB Account Mapping for user "+o._facebookId)},createLink:function(e){if(DisneyID.log("FBUTIL: Creating FB Account Mapping..."),DisneyID.log(e),o._facebookId){var n={accountMapping:{action:"UPDATE",namespace:o.namespace,externalId:o._facebookId}};o.getProfile(function(o){o&&(n.accountMapping.externalDisplayName=o.email),DisneyID.log("FBUTIL: Facebook add"),DisneyID.log(n),DisneyID.Dispatch.update(n,e.data,{success:function(o){DisneyID.log("FBUTIL: Successful update!"),DisneyID.log(o),e.success&&e.success(o)},error:function(o){DisneyID.log("FBUTIL: Error in update!"),DisneyID.log(o),e.error&&e.error(o)}})})}else DisneyID.log("FBUTIL: ERROR No facebook id set"),e.error&&e.error({error:"FBUTIL: No facebook id set - call status first"})},facebookLogin:function(e,n){o.login(function(i){i.authResponse&&o.doFacebookConnect(i.authResponse,e,n)})},doFacebookConnect:function(e,n,i){o.getProfile(function(o){var t={},a=new DisneyID.Hash,s={};if(o&&o.id){if(t.profile={firstName:o.first_name||null,lastName:o.last_name||null,email:o.email||null,gender:"male"===o.gender?1:2,languagePreference:o.locale||null},t.accountMapping={"AM-FACEBOOK":{id:o.id,auth:e}},o.birthday){var c=o.birthday.split("/");t.profile.dateOfBirth=c[2]+"-"+c[0]+"-"+c[1]}s.guest=t,s.socialWorkflow=n,n===DisneyID.socialWorkflow.STREAMLINED&&i&&(s.legal=i.legal,s.goKart=i.goKart),DisneyID.navigate("social-login",{queryUpsert:{namespace:"AM-FACEBOOK"},hash:a.build(s)})}else DisneyID.log("Facebook flow cannot continune.")})}};DisneyID.fbUtil={apiVersion:o.apiVersion,namespace:o.namespace,init:o.init,login:o.login,getProfileForConnect:o.getProfileForConnect,logout:o.logout,getLoginStatus:o.getLoginStatus,tryAssert:o.tryAssert,getFacebookId:o.getFacebookId,getId:o.getFacebookId,checkFacebookLogin:o.checkFacebookLogin,getProfile:o.getProfile,deleteApp:o.deleteApp,checkLink:o.checkLink,createLink:o.createLink,facebookLogin:o.facebookLogin}}(jQuery);
DisneyID.googleUtil=function(){if(!DisneyID.googleSettings)return!1;var e="AM-GOOGLE",o=["https://www.googleapis.com/auth/plus.login","profile","email"],n="http://go.com",i="",t="UNKNOWN",l=null,g=null,a=null,s=null,r={client_id:DisneyID.googleSettings.clientId,immediate:!1,scope:DisneyID.googleSettings.scope?DisneyID.googleSettings.scope:o,cookie_policy:DisneyID.googleSettings.cookiePolicy?DisneyID.googleSettings.cookiePolicy:n,requestvisibleactions:DisneyID.googleSettings.requestVisibleActions?DisneyID.googleSettings.requestVisibleActions:i},D={plus:"v1",oauth2:"v2"},u=!1;return{init:function(e){DisneyID.googleSettings&&DisneyID.googleSettings.enabled===!0&&"undefined"!=typeof gapi&&gapi.auth&&gapi.auth.init(function(){DisneyID.log("Google init"),DisneyID.googleUtil.setTokenFromHash(),"function"==typeof window.setupGoogleConnect&&window.setupGoogleConnect(e)})},manualInit:function(o){return DisneyID.log("GOOGLEUTIL: In manualInit"),o?(DisneyID.log(o),t="LOGGED_IN",a=_.get(o,"accountMapping."+e+".id"),g=_.get(o,"accountMapping."+e+".auth"),s=_.get(o,"accountMapping."+e+".auth.access_token"),l=$.extend({},o.profile),!0):(t="NOT_AUTHORIZED",DisneyID.deleteLocalData(["googleId","googleLogin"]),!1)},login:function(e,o,n,i){DisneyID.log("GOOGLEUTIL: logging in...");var t=$.extend({},r);gapi.auth.authorize(t,function(t){DisneyID.googleUtil.loginCallback(t,function(t){var l=jQuery.grep(t.emails,function(e){return"account"===e.type});t.email=l.length?l[0].value:null,e?"function"==typeof n&&n(t):DisneyID.googleUtil._doLoginFlow(o,i)})})},silentLogin:function(e){DisneyID.log("GOOGLEUTIL: Silent login");var o=$.extend({},r);o.immediate=!0,gapi.auth.authorize(o,function(o){DisneyID.googleUtil.loginCallback(o,function(){DisneyID.log("GOOGLEUTIL: Silent login success"),"function"==typeof e&&e(o)})})},loginCallback:function(e,o){var n=_.get(e,"error");if(void 0!==n)switch(n){case"immediate_failed":return;default:return DisneyID.log("GOOGLEUTIL: login error: "+n),void DisneyID.log(e)}_.get(e,"access_token")?(DisneyID.log("GOOGLEUTIL: login success"),g=e,t="LOGGED_IN",DisneyID.googleUtil.loadLibraries(null,function(){DisneyID.log("GOOGLEUTIL: libraries loaded"),DisneyID.googleUtil.loadProfile(function(e){DisneyID.log("GOOGLEUTIL: profile loaded"),"function"==typeof o&&o(e)})})):DisneyID.log("GOOGLEUTIL: login failed")},_doLoginFlow:function(o,n){DisneyID.googleUtil.getProfile(function(i){if(i){var t=DisneyID.googleUtil.setupCreateFields(i),l=new DisneyID.Hash,g={};t!==!1&&(g.guest=t,g.socialWorkflow=o,o===DisneyID.socialWorkflow.STREAMLINED&&(g.legal=n.legal,g.goKart=n.goKart),DisneyID.navigate("social-login",{queryUpsert:{namespace:e},hash:l.build(g)}))}})},setTokenFromHash:function(){var o=new DisneyID.Hash,n=o.get("guest");if(!n)return!1;var i=_.get(n,"accountMapping."+e+".auth");return _.get(i,"access_token")?(DisneyID.log("GOOGLEUTIL: Setting token from hash"),g=i,gapi.auth.setToken(g),!0):!1},setProfileFromHash:function(){var e=new DisneyID.Hash,o=e.get("guest");return o?DisneyID.googleUtil.manualInit(o):!1},loadProfile:function(e){DisneyID.log("GOOGLEUTIL: get userinfo");var o=gapi.client.plus.people.get({userId:"me"});o.execute(function(o){return DisneyID.log(o),_.get(o,"id")?(l=o,void("function"==typeof e&&e(o))):(DisneyID.log("GOOGLEUTIL: userinfo error"),!1)})},getProfile:function(e){return"function"!=typeof e?void DisneyID.log("GOOGLEUTIL: getProfile error - missing callback"):void(l?(DisneyID.log("GOOGLEUTIL: got profile from object"),e(l)):DisneyID.googleUtil.loadLibraries(null,function(){DisneyID.googleUtil.loadProfile(function(o){o.id?(DisneyID.log("GOOGLEUTIL: got profile from google"),e(o)):(DisneyID.log("GOOGLEUTIL: get profile from google failed"),e(null))})}))},getId:function(e){return"function"!=typeof e?void DisneyID.log("GOOGLEUTIL: getId error - missing callback"):void(a?(DisneyID.log("GOOGLEUTIL: got googleId from object: "+a),e(a)):DisneyID.SharedStorage.readData("googleId",function(o){o&&o.length>0?(DisneyID.log("GOOGLEUTIL: got googleId from cache: "+o),e(o)):DisneyID.googleUtil.loadLibraries(null,function(){DisneyID.googleUtil.loadProfile(function(o){o.id?(DisneyID.log("GOOGLEUTIL: got googleId from google: "+o.id),e(o.id)):(DisneyID.log("GOOGLEUTIL: get googleId from google failed"),e(null))})})}))},getAuthResult:function(){return null!==g&&"undefined"!=typeof g["g-oauth-window"]&&(g["g-oauth-window"]=!0),null!==g&&"undefined"!=typeof g.access_token&&(g.accessToken=g.access_token),g},getNamespace:function(){return e},validateToken:function(e){if(null===gapi.auth.getToken())return DisneyID.log("GOOGLEUTIL: Token not loaded"),e("NOT_AUTHORIZED"),void DisneyID.deleteLocalData(["googleId","googleLogin"]);var o=function(){DisneyID.log("GOOGLEUTIL: Validating token...");var o=gapi.client.oauth2.tokeninfo({access_token:gapi.auth.getToken().access_token});o.execute(function(o){DisneyID.log(o),_.get(o,"audience")===_.get(DisneyID,"googleSettings.clientId")?(DisneyID.log("GOOGLEUTIL: Token valid"),t="LOGGED_IN"):(DisneyID.log("GOOGLEUTIL: Token invalid"),t="NOT_AUTHORIZED",DisneyID.deleteLocalData(["googleId","googleLogin"])),e(t)})};u?o():DisneyID.googleUtil.loadLibraries(null,o)},setupCreateFields:function(o){var n={},i=DisneyID.googleUtil.getAuthResult();return o&&o.id?(n.profile={},n.accountMapping={},n.accountMapping["AM-GOOGLE"]={},n.profile.firstName=o.name.givenName||null,n.profile.lastName=o.name.familyName||null,o.birthday&&-1===o.birthday.indexOf("0000")&&(n.profile.dateOfBirth=o.birthday),n.profile.email=o.email,"male"===o.gender&&(n.profile.gender=1),"female"===o.gender&&(n.profile.gender=2),n.profile.languagePreference=o.language||null,n.accountMapping[e].id=o.id,n.accountMapping[e].auth=i,n):(DisneyID.log("GOOGLEUTIL: Google flow cannot continune."),!1)},createLink:function(o){if(DisneyID.log("GOOGLEUTIL: Creating Google Account Mapping..."),DisneyID.log(o),a){var n={accountMapping:{action:"UPDATE",namespace:e,externalId:a}};DisneyID.googleUtil.loadProfile(function(e){e&&(n.accountMapping.externalDisplayName=e.email),DisneyID.log("GOOGLEUTIL: Google add"),DisneyID.log(n),DisneyID.Dispatch.update(n,o.data,{success:function(e){DisneyID.log("GOOGLEUTIL: Successful AM update!"),DisneyID.log(e),o.success&&o.success(e)},error:function(e){DisneyID.log("GOOGLEUTIL: Error in AM update!"),DisneyID.log(e),o.error&&o.error(e)}})})}else DisneyID.log("GOOGLEUTIL: ERROR No google id set"),o.error&&o.error({error:"GOOGLEUTIL: No google id set - call status first"})},loadLibraries:function(e,o){DisneyID.log("GOOGLEUTIL: Loading libraries");var n=e?e:D,i=!1,t=function(e){if(e)return!!_.get(gapi.client,e);for(e in n)if(!_.get(gapi.client,e))return!1;return!0},l=function(){t()&&!i&&(u=!0,"function"==typeof o&&(i=!0,o()))};for(var g in n)t(g)||gapi.client.load(g,n[g],l)},deauth:function(e){$.ajax({type:"GET",url:"https://accounts.google.com/o/oauth2/revoke?token="+gapi.auth.getToken().access_token,async:!1,contentType:"application/json",dataType:"jsonp",success:function(){DisneyID.log("GOOGLEUTIL: deauth revoke success"),DisneyID.deleteLocalData(["googleId","googleLogin"]),l=g=a=s=null,gapi.auth.setToken(null),"function"==typeof e&&e(!0)},error:function(o){DisneyID.log("GOOGLEUTIL: deauth revoke error"),DisneyID.log(o),"function"==typeof e&&e(!1)}})}}}(),window.initGoogleConnect=function(e){DisneyID.googleUtil.init(e)};
!function(e){var t=e();"object"==typeof exports&&(module.exports=t),"undefined"!=typeof window&&(window.L10n=window.L10n||{},window.L10n.utils=t)}(function(){var e=function(){try{(new Date).toLocaleDateString("i")}catch(e){return"RangeError"===e.name}return!1}();return{fromDateString:function(e,t){if(t.length===e.length){var n="",r="",a="";t=t.toUpperCase();for(var o=0;o<t.length;o++)"Y"===t[o]?n+=e[o]:"M"===t[o]?r+=e[o]:"D"===t[o]&&(a+=e[o]);return new Date(Date.UTC(parseInt(n,10),parseInt(r,10)-1,parseInt(a,10)))}},toLocaleDateString:function(t){t=t||{};var n=t.date||new Date,r=t.fallbackPattern||"",a=t.locale,o=t.opts||{};return o.timeZone="UTC",e&&a?Date.prototype.toLocaleDateString.apply(n,[a,o]):r.replace("%Y",n.getUTCFullYear()).replace("%l",n.getUTCMonth()+1).replace("%e",n.getUTCDate())}}});