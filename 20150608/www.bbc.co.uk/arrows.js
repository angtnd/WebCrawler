define(["jquery-1","h4base","h4discoveryzone/carousel"],function(G,P,c){var t=79,aa=34,s=20,ac=null,o=0,g=G(window).width(),e=h4.discoveryzone.staticPrefix+"/img/",E,p,N,l,q=[],O=[],i="domestic",f=P.getAudience(),d=G("#h4discoveryzone"),z="dz-arrow-previous",v="dz-arrow-next",j=G("#"+z),k=G("#"+v),B=G("#"+z+", #"+v),b="large",Y="smallArrow",F="moving",ab="large-moving",X=".arrow-label",A=(F+" "+ab),W=1,y={previous:{left:j.css("left"),top:parseInt(j.css("top"),10),width:parseInt(j.css("width"),10),height:parseInt(j.css("height"),10)},next:{right:k.css("right"),top:parseInt(k.css("top"),10),width:parseInt(k.css("width"),10),height:parseInt(k.css("height"),10)}},H={previous:{left:"-"+t,top:(y.previous.top-(t-y.previous.height)/2),width:t,height:t},next:{right:"-"+t,top:(y.next.top-(t-y.next.height)/2),width:t,height:t}},V="",D=null,x=false;if((G.browser.msie)&&(G.browser.version<=7)){N=e+"navigation_arrow_previous.png";l=e+"navigation_arrow_next.png"}else{N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABPBAMAAABYGoW1AAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAAOdAAADnQBaySz1gAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAADtSURBVEiJ7dS9DcJADAXgSwihpYN01NDQ02QAGAGJCRATJGICxARILIAEAzACDdR0UKZC4v8IsVO/V9Bxr/4U2bF9xri4uPwqEenCjHOVraWcl1oODi0H25aDtYyDwc5S0FtYDo7F3ZDriXvGwDXEvSfAVY8C58D5K3F7VGAi7oxcX9y9BVwk7hUDF2Zcw/kKFlmiAlNxF+TKCuFIjBnokOtQ6l88QehrOxsoy0lPoWzq7oyg1G18dKHUhq6w9fJiDvCTgTa0hlKumrnrDguLl4eC3oyEspoMLBqi4Hc5OZgvJwlNwkKfhS4uf5QPlP7bRzgxDtUAAAAASUVORK5CYII=";l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAABPBAMAAABYGoW1AAAAA3NCSVQICAjb4U/gAAAAMFBMVEX///////////////////////////////////////////////////////////////9Or7hAAAAAEHRSTlMAESIzRFVmd4iZqrvM3e7/dpUBFQAAAAlwSFlzAAAOdAAADnQBaySz1gAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNAay06AAAADfSURBVEiJ7dQ9DoJAFARgiEQKY7DUjiPY23AET2A4gl6AxBMYT2DiEfQANvY0egUtLf1BeBJG6pnYulN/ednNzj7Pc3Fx+TWBCqOtCqu5CO2diNAeAxHaRYW2U6EtVFgmFPYbaK+YQX8FeaUjOwfII5XdG+SSyiFglVI5gSxiKjPIO31LfwN5oiODHJKXM8TVhXKOMJKXsx2ZiodcEydfOxOboT7N97HLKXFqfdpC7omTKz6De7Lm9Ez8hpFaBkBhVTTwzF0DpXVWw2IsuBqKKzeiFWwh/3lIKDoXl3/OB6lt29BmFBP5AAAAAElFTkSuQmCC"}E=G("<img />").attr({src:N,alt:j.find(".pane-text").text()}).hide();p=G("<img />").attr({src:l,alt:k.find(".pane-text").text()}).hide();function M(ad){var ae=ad.children("img");if(ae.length!==0){ad.removeClass("animate");ad.find("img").hide()}}function U(){x=false;var ad=G(this);M(ad);ad.removeClass(b);ad.css("overflow","visible");ad.addClass(Y);if(D){G(".arrow-label",D).fadeIn("fast")}}function C(){x=false;var ad=G(this);ad.removeClass(Y);ad.css("overflow","visible");ad.addClass(b);if(D){G(".arrow-label",D).fadeIn("fast")}}function S(){g=G(window).width();var ad=false;var af=false;var ag=j.attr("class").indexOf(b);var ae=j.attr("class").indexOf(Y);if((g<o)&&(ag!==-1)){ad=true}if((g>=o)&&(ae!==-1)){af=true}if(ad===true||af===true){j.stop();k.stop();G(".pane-numbers").stop();G(".arrow-label").hide();x=true}if(ad===true){j.animate(y.previous,{complete:U});k.animate(y.next,{complete:U});G(".pane-numbers").animate({top:s})}else{if(af===true){E.show();j.addClass("animate");j.animate(H.previous,{complete:C});p.show();k.addClass("animate");k.animate(H.next,{complete:C});G(".pane-numbers").animate({top:aa})}}}function n(ad){W+=ad;W=(W<=0)?3:W;W=(W>=4)?1:W;G(".pane-number").removeClass("active");G("#dz-arrow-next .pane-number").eq(W-1).addClass("active");G("#dz-arrow-previous .pane-number").eq(W-1).addClass("active");G(".pane-text span").text(W);p.attr("alt",k.find(".pane-text").text());E.attr("alt",j.find(".pane-text").text())}function K(){W=1;n(0)}function J(ae){var ad=(ae==="previous")?j:k;if(ad.hasClass(b)){ad.addClass(ab)}else{ad.addClass(F)}}function L(){G(document).keydown(function(ak){var ad=ak.which;var aj=[37,39];var ag=ak.shiftKey;if((G.inArray(ad,aj)>-1)&&!ag){var ah=(d.offset().top)+(parseInt(d.css("padding-top").replace("px",""),10)||0)+(parseInt(d.css("margin-top").replace("px",""),10)||0);var ae=G(window).scrollTop();var af=(ae<ah)?true:false;var ai=G('input[type="text"]:focus, textarea:focus').length;if(af&&!ai){switch(ad){case 37:j.click();break;case 39:k.click();break;default:break}ak.preventDefault()}}})}function u(af){var ad=(af.keyCode?af.keyCode:(af.which?af.which:af.charCode));if((af.type==="click"||af.type==="touchend")||(af.type==="keydown"&&ad===13)){af.preventDefault();var ah=G(this).attr("id"),ag=(ah===z)?"previous":"next",ae=(ag==="previous")?-1:1;B.blur();G(P).triggerHandler("carousel_scroll_initiated",["relative",ag,af.type,"Carousel_Arrow_Click"])}}function r(ad){W=parseInt(G(".pane-number.active").first().text(),10)+1;B.bind("click keydown touchend",u);B.mouseenter(function(){var af=G(this).attr("id");var ae=(af===z)?"previous":"next";c.peekPanes(ae)}).mouseleave(function(){c.peekPanes()});j.append(E);k.append(p);j.attr("href","#");k.attr("href","#");S();G(window).resize(S)}function R(ae){if(!ae){ae=V}var ad=G.inArray(ae,q)-1;if(ad<0){ad=q.length-1}return q[ad]}function m(ae){if(!ae){ae=V}var ad=G.inArray(ae,q)+1;if(ad===q.length){ad=0}return q[ad]}function w(ad){return O[R(ad)]}function Z(ad){return O[m(ad)]}function h(ad){if(f===i){B.find(X).removeClass(V);V=ad;B.find(X).addClass(V);j.find(X).text(w());k.find(X).text(Z())}}function Q(ad){D=G(this);ad.preventDefault();if(!x){G(this).find(X).show()}}function I(ad){D=null;ad.preventDefault();G(this).find(X).hide()}function a(ae,ad){V=ad;q=[];O={};G.each(ae,function(af){q.push(af);O[af]=ae[af].linkText})}function T(){ac=G("#h4-main");o=ac.width()+(t*2);G(P).bind("attach_arrows_events",r);G(P).bind("reset_pagination_event",function(ad){K()});G(P).bind("update_pagination",function(ad,ae){n(ae)});G(P).bind("carousel_animate_start",function(ae,af,ad){J(af);if(!ad){if(af==="previous"){j.find(X).show()}else{k.find(X).show()}}});G(P).bind("carousel_animate_stop",function(ad,ae){B.find(X).hide();if(D){D.find(X).show()}B.removeClass(A)});G(P).bind("flavour_titles_received",function(af,ae,ag,ad){a(ae,ag,ad)});G(P).bind("carousel_pane_changed",function(ae,ad){h(ad)});B.bind("mouseover",Q);B.bind("mouseout",I);L()}return{init:T}});