define(["jquery-1","h4base","locator/locator"],function(d,g,f){var a=d("#h4weather");var i="error";var j=d("#h4weather .state-container");var e=h4.weather.ajaxRoute;var c=g.getAudience();var b=g.getLang();function h(){j.hide();a.addClass(i)}return{init:function(){a.delegate("a.location-name.change","click",function(m){m.preventDefault();var k=(j.offset().top+j.outerHeight()-6);var n=j.offset().left+j.innerWidth();var l={right:d(document).width()-n,top:k};g.showLocator("h4weather",l,"center")});d(f).bind("location_changed",function(l,m){if(!m||!m.weather||!m.location||!m.location.id||!m.location.name){h()}var n={audience:c||"domestic",locationid:m.location.id,locationname:m.location.name,lang:b||"en-GB"};var k=g.interpolateRoute(e,n);d.ajax({url:k,success:function(p){if(!p||typeof p!=="string"||p.length<=0){h()}if(j.css("display")==="none"){d("."+i,a).remove();j.show()}var o=d(p).html();a.html(o);j=d("#h4weather .state-container")},error:function(p){if(p.status>=400){if(d("."+i,a).length>0){return}var o=d(p.responseText);o.removeAttr("id");j.hide();a.append(o)}else{h()}}})})}}});