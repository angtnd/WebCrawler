define(["jquery-1","h4base","h4discoveryzone/animationflag"],function(d,b,t){var a=d("#dz-flavouriser li"),u=a.find("a"),r="selected",e="anim-selected",f=8,h=4,v=100,i=400,g=[],j=[],c={};function p(){if(a.length===0){return false}return true}function q(){var F="<div class='anim-con'></div>",A=d("#dz-flavouriser-inner"),z="<div class='anim-item'></div>",x="<div class='anim-divider'></div>",E,D,C=2,I=2;var B=d("#dz-flavouriser li.selected a");B.addClass(e);E=(a.length*u.width())+(u.length*I);A.width(E);A.append(F);var J=d("#dz-flavouriser .anim-con");J.width(E-I);J.hide();J.append(z);var y=d("#dz-flavouriser .anim-item");y.addClass("selected");var w=d("#dz-flavouriser li.selected");var H=w.position().left;y.css({width:u.innerWidth()+"px",left:H+"px"});for(D=0;D<a.length;D++){J.append(x)}var G=d("#dz-flavouriser .anim-divider");G.each(function(K){var L=d("#dz-flavouriser li:eq("+K+")").find("a").position();L=parseInt(L.left,10)-C;d(this).css("left",L+"px")})}function l(K,C){var G=d("#dz-flavouriser .anim-con"),z=d("#dz-flavouriser .anim-item"),y=d("#dz-flavouriser li.selected").index(),H=d("#dz-flavouriser li.selected"),M=c[K],A=d("#dz-flavouriser li:eq("+M+")"),N=A.position().left,B=false,F="";function w(){H.removeClass(e);A.addClass(r);A.find("a").addClass(e);G.hide();t.setIsFlavouriserAnimating(false)}t.setIsFlavouriserAnimating(true);G.show();a.removeClass(r);if(typeof C==="undefined"){C=false}if(C){var D=Math.abs(M-y);var L=y-M;if(L<0){L=a.length+L;F="previous"}else{L=a.length-L;F="next"}if(L<D){B=true}}if(C&&B){var E,x,I,J;if(F==="previous"){E=0;x=-z.width();I=G.width()}else{E=a.last().position().left;x=G.width();I=-z.width()}J=i/2;z.animate({height:h+"px"},v,function(){z.animate({left:E},J,function(){var O=z.clone();G.append(O);z.css("left",I+"px");O.animate({left:x},J,function(){O.remove()});z.animate({left:N},J,function(){z.animate({height:f+"px"},v,w)})})})}else{z.animate({height:h+"px"},v,function(){z.animate({left:N},i,function(){z.animate({height:f+"px"},v,w)})})}}function s(y){var w=(y.keyCode?y.keyCode:(y.which?y.which:y.charCode));if(y.type!=="click"&&y.type!=="touchend"&&!(y.type==="keydown"&&w===13)){return}y.preventDefault();var x=d(this).parent().index();var z=g[x];d(b).triggerHandler("carousel_scroll_initiated",["absolute",z,y.type,"Set_Flavouriser_"+z]);u.blur()}function o(B,x,w){var y=d("#dz-flavouriser li.selected").index(),A=y,C,z=false;if(x==="relative"){if(w==="next"){A++;if(A>=g.length){A=0}}else{A--;if(A<0){A=g.length-1}}C=g[A];z=true}else{C=w}l(C,z)}function n(y,w){if(p()){if(false===d("#"+w).hasClass(r)){a.removeClass(r);d("#"+w).addClass(r)}d.each(a,function(A,B){var z=d(B).attr("id"),C=y[z].inactive;if(d(B).hasClass(r)){d(B).children("a").removeAttr("title")}else{d(B).children("a").attr("title",C)}})}var x=0;g=[];j=[];c={};d.each(y,function(z){g.push(z);j.push(y[z].linkText);c[z]=x;x++})}function k(){d(b).unbind("carousel_ready",k);q();u.bind("click keydown touchend",s);if(b.isTouchDevice()){u.addClass("no-hover")}d(b).bind("flavour_changed",function(z,x,w,y){o(z,x,w)})}function m(){if(!p()){return}d(b).bind("carousel_ready",k);d(b).bind("flavour_titles_received",function(x,y,w){n(y,w)})}return{init:m,updateFlavourLinks:n,flavouriserExists:p}});