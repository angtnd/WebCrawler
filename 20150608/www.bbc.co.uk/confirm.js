define(["jquery-1","locator/utils","locator/cookies"],function(c,v,q){var x="/locator/:client/:lang/confirm.json",i,s="locator-confirm",e,h,l=false,k,u,t=false,b=false,w={component:"locator-component",error:"locator-error"},j={component:null,form:null,cancel:null,error:null},m;function p(y){if(v.isFunction(y)){k=y}}function g(y){if(v.isFunction(y)){u=y}}function r(A,z){var y=true;i=c("#locator").find("."+w.component);if(A&&A.locationData){e=A.locationData}else{e={location_id:i.find("#locator-form-location_id").val(),local_region:i.find("#locator-form-local_region").val()}}t=false;if(e.geolocation===true){t=true}h=i.find("div."+s);if(!h.length){if(A&&A.html){h=c(A.html)}else{h=null}}if(h){o()}else{f()}}function a(){var y=v.interpolateRoute(x);if(j.error){j.error.remove();j.error=null}v.setLocation(e.location_id,e.local_region,function(C,B){var D,z,A;if(C){if(q.areAllowed()===true){z=new Date();z.setTime(B.expires);A="locserv="+B.cookie+";expires="+z.toGMTString()+";domain=.bbc.co.uk;path=/";bbccookies.set(A)}D={location_id:B.location.id,location_name:B.location.name,location_nation:B.location.nation,geo_location:(t===true)};if(B.newsLocalRegions&&B.newsLocalRegions[0]){D.location_news_region=B.newsLocalRegions[0].id}v.doIStatsAction("confirm",D);if(v.isFunction(u)){u(B)}c(m).trigger("location_changed",B);b=false}else{j.form.before('<div class="'+w.error+'"><p>'+window.locator.error.confirm+"</p></div>");j.error=j.component.find("."+w.error)}})}function o(y){var z={location_id:e.location_id,location_name:e.location_name,geo_location:(t===true)};if(e.local_region){z.news_region=e.local_region}i.html(h.clone());j.component=i.find("div."+s);j.form=j.component.find("form");j.cancel=i.find("a.cancel");j.form.bind("submit",function(A){if(b){A.preventDefault();return false}a();A.preventDefault();b=true});l=false;j.cancel.bind("click",function(A){if(false===l){l=true;v.doIStatsAction("cancel",z);if(v.isFunction(k)){k();A.preventDefault()}}else{A.preventDefault()}});if(y){j.component.hide();v.fadeIn(j.component,function(){c("#locator-form-submit").focus()})}else{c("#locator-form-submit").focus()}}function f(){var y;y=v.interpolateRoute(x);if(t===true){y+="&geolocation=1"}v.ajax(y,function(A,B,z){if(A){if("confirm"===A.component){h=c(A.html);o(true)}else{c(m).trigger("locator_component_change",A)}}},function(z,B,A){},{data:e})}function d(y){v.fadeOut(j.component,function(){n(y)})}function n(z){var y;if(j.component){j.component.remove();j.component=null}for(y in j){if(j.hasOwnProperty(y)){j[y]=null}}h=null;v.safeCallback(z)}m={init:r,clear:n,fadeOutAndClear:d,setCancelHandler:p,setSuccessHandler:g};return m});