/*
 countdown_timer-1.3.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-08-31 12:26:28
*/
(function(){if(void 0!==window.jQuery){var d=jQuery,h=function(a){this.$config=a;this.targetSelector=this.$config.attr("data-target")||this.defaults.selectors.target;this.daySelector=this.$config.attr("data-day")||this.defaults.selectors.day;this.hourSelector=this.$config.attr("data-hour")||this.defaults.selectors.hour;this.minuteSelector=this.$config.attr("data-minute")||this.defaults.selectors.minute;this.secondSelector=this.$config.attr("data-second")||this.defaults.selectors.second;this.apiURL=
this.$config.attr("data-apiURL")||this.defaults.apiURL;this.updateInterval=+this.$config.attr("data-updateInterval")||this.defaults.updateInterval;this.isTestMode=this.checkTestMode(location.search);this.hasSessionStorage=this.isSessionStorageSupported();this.hasJSON=this.isJSONSupported();this.serverTimeOffset=this.serverTime=0;this.$targets=void 0};h.prototype={defaults:{selectors:{target:".countDownBlock",day:".day",hour:".hour",minute:".minute",second:".second"},apiURL:"http://gettime.r10s.jp/",
updateInterval:1E3,sessionStorageKey:"RJSCountDownTimer"},initialize:function(){this.isTestMode?(this.serverTime=this.getTimeValueFromString(location.search.split("countdowntimertest=")[1]),this.serverTimeOffset=this.serverTime-(new Date).getTime(),this.getElements()):this.hasSessionStorage&&this.hasJSON?this.checkSessionStorage():this.getTimeFromServer()},checkSessionStorage:function(){if(this.hasJSON){var a=sessionStorage.getItem(this.defaults.sessionStorageKey);a?(a=JSON.parse(a),"number"===typeof a.offset?
(this.serverTimeOffset=a.offset,this.serverTime=(new Date).getTime()+this.serverTimeOffset,this.getElements()):this.getTimeFromServer()):this.getTimeFromServer()}else this.getTimeFromServer()},getTimeFromServer:function(){var a=this;d.ajax({url:this.apiURL,dataType:"jsonp",scriptCharset:"utf-8",cache:!0,error:function(){},success:function(c){var b=new Date;b.setTime(1E3*c.epoch);a.serverTime=b.getTime();a.serverTimeOffset=a.serverTime-(new Date).getTime();a.hasSessionStorage&&a.hasJSON&&sessionStorage.setItem(a.defaults.sessionStorageKey,
JSON.stringify({offset:a.serverTimeOffset}));a.getElements()}})},getElements:function(){this.$targets=d(this.targetSelector);this.setTimer()},setTimer:function(){var a=this;this.$targets.each(function(c){var b=a.$targets.eq(c),d={day:b.find(a.daySelector),hour:b.find(a.hourSelector),minute:b.find(a.minuteSelector),second:b.find(a.secondSelector)},f=0<d.day.length,c=b.attr("data-startDate"),e=b.attr("data-endDate"),h="true"===b.attr("data-hideAfterEnd"),k="false"!==b.attr("data-autoStart"),l=a.getTimeValueFromString(c,
0),i=a.getTimeValueFromString(e,0),m=i-a.serverTime,j={day:0,hour:0,minute:0,second:0},g=!1,n=0;l<=a.serverTime&&a.serverTime<=i?(g=!0,b.show()):(g=!1,b.hide());c=function(){var c=(new Date).getTime()+a.serverTimeOffset;m=i-c;l<=c&&c<=i?g||(g=!0,k&&b.show()):g&&(g=!1,h&&b.hide(),clearInterval(n));c=j;j=a.getRemainingTime(f,m);for(var e in c)c[e]!==j[e]&&a.updateElements(j[e],d[e])};c();n=setInterval(c,a.updateInterval)})},updateElements:function(a,c){for(var b=""+a,d=b.length,f=0,e=c.children().length;f<
e;f++)c.children().eq(e-f-1).children().eq(b.charAt(d-1-f)).show().siblings().hide()},getRemainingTime:function(a,c){var b={};b.day=a?c/864E5|0:0;b.hour=a?c%864E5/36E5|0:c/36E5|0;b.minute=c%36E5/6E4|0;b.second=c%6E4/1E3|0;return b},getTimeValueFromString:function(a,c){if(a){var b=a.split(/-|:|\s/);return(new Date(Date.UTC(+b[0],+b[1]-1,+b[2],+b[3],+b[4],+b[5])-324E5)).getTime()}return c},checkTestMode:function(a){return/(\?|\&)countdowntimertest/.test(a)},fireEvent:function(a,c,b){c=d.Event(c);c.customData=
b||{};a.trigger(c)},isSessionStorageSupported:function(){try{return sessionStorage.setItem("test","test"),sessionStorage.removeItem("test"),!0}catch(a){return!1}},isJSONSupported:function(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}};var k=d("#RJSCountDownTimerConfig");0<k.length&&(new h(k)).initialize()}})();
