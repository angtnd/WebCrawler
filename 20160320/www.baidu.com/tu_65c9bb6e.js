(function(){var h={};if(location.protocol==="http:"){h.uploadServer="http://graph.baidu.com/upload"}else{h.uploadServer="https://sp0.baidu.com/-aYHfD0a2gU2pMbgoY3K/upload"}var f=navigator.platform.toUpperCase();var c=$("#kw");var a=c.parent();var r=bds&&bds.comm&&bds.comm.newindex;var i=f.indexOf("MAC")!==-1;var q=function(w){w.stopPropagation();w.preventDefault()};var o=location.href.match(/sign=(\w{32})\b/);var t=o&&o[1]||"";var e=function(w){w.sign=t;w.fm="inlo";window.c(w)};var p=window.bds&&bds.se&&bds.se.upn&&bds.se.upn.cookieset||[];var l=p[0]&&p[0].v===1&&p[1]&&p[1].v<=3;var m=p[0]&&p[0].v===1;var d=function(w){return(/^(((http[s]?:\/\/)|(ftp:\/\/))?([\w-]+\.)+(com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv|al|dz|af|ar|ae|aw|om|az|eg|et|ie|ee|ad|ao|ai|ag|at|au|mo|bb|pg|bs|pk|py|ps|bh|pa|br|by|bm|bg|mp|bj|be|is|pr|ba|pl|bo|bz|bw|bt|bf|bi|bv|kp|gq|dk|de|tl|tp|tg|dm|do|ru|ec|er|fr|fo|pf|gf|tf|va|ph|fj|fi|cv|fk|gm|cg|cd|co|cr|gg|gd|gl|ge|cu|gp|gu|gy|kz|ht|kr|nl|an|hm|hn|ki|dj|kg|gn|gw|ca|gh|ga|kh|cz|zw|cm|qa|ky|km|ci|kw|cc|hr|ke|ck|lv|ls|la|lb|lt|lr|ly|li|re|lu|rw|ro|mg|im|mv|mt|mw|my|ml|mk|mh|mq|yt|mu|mr|us|um|as|vi|mn|ms|bd|pe|fm|mm|md|ma|mc|mz|mx|nr|np|ni|ne|ng|nu|no|nf|na|za|zq|aq|gs|eu|pw|pn|pt|jp|se|ch|sv|ws|yu|sl|sn|cy|sc|sa|cx|st|sh|kn|lc|sm|pm|vc|lk|sk|si|sj|sz|sd|sr|sb|so|tj|tw|th|tz|to|tc|tt|tn|tv|tr|tm|tk|wf|vu|gt|ve|bn|ug|ua|uy|uz|es|eh|gr|hk|sg|nc|nz|hu|sy|jm|am|ac|ye|iq|ir|il|it|in|id|uk|vg|io|jo|vn|zm|je|td|gi|cl|cf|cn)(:\d+)?(\/[^\s]*)?)$/).test(w)
};var k=1024*1024*10;var g=1024*100;var u={"1":"æ±æ­ï¼æ¨ä¸ä¼ çæä»¶ä¸æ¯å¾çæ ¼å¼","2":"å¾çä¸ä¼ å¤±è´¥"};var n=function(z){var B=$.Deferred();function x(D,E){var C=new FileReader();C.onload=function(){var F=this.result.split("base64,")[1];E(F,this.result)};C.onerror=function(F){E()};C.readAsDataURL(D)}function A(M,D,E){D=D||"";E=E||512;var I=atob(M);var K=[];var H=I.length;for(var F=0;F<H;F+=E){var L=I.slice(F,F+E);var J=new Array(L.length);for(var G=0;G<L.length;G++){J[G]=L.charCodeAt(G)}var C=new Uint8Array(J);K.push(C)}return new Blob(K,{type:D})}function w(E){var H=E.width;var C=E.height;if(H>800||C>800){var G=Math.max(H/800,C/800);H/=G;C/=G}var F=document.createElement("canvas");F.width=H;F.height=C;var D=F.getContext("2d");D.fillRect(0,0,F.width,F.height);D.drawImage(E,0,0,H,C);var I=F.toDataURL("image/jpeg",1);return A(I.replace(/^.*?,/,""),"image/jpeg")}var y=z.size;x(z,function(C,E){var D=new Image();D.onload=function(){if(y<g&&D.width<800&&D.height<800){B.resolve(z);return}z=w(D);B.resolve(z)};D.src=E});
return B.promise()};var b=function(){var y;var w=function(A,z){if(A!==""){return A+z.slice(0,1).toUpperCase()+z.slice(1)}return z};var x=(function(){var z=false;if(typeof window.screenX==="number"){["webkit","moz","ms","o",""].forEach(function(A){if(z===false&&document[w(A,"hidden")]!==undefined){y=A;z=true}})}return z})();if(x){return document[w(y,"hidden")]}return undefined};var s=function(w){var x=$("#form").attr("target");if(x==="_blank"){window.open(w,"_blank");setTimeout(function(){if(!b()){location.href=w}},1000)}else{location.href=w}};var v=function(w){$.extend(this,{wrap:null},w);this.state="normal"};$.extend(v.prototype,{init:function(){},clean:function(){this.wrap.find(".soutu-mask").remove()},setNormal:function(){this.clean();var w=this.wrap.find(".upload-pic");w.val("");this.state="normal"},setWaiting:function(){this.clean();this.state="waiting";var x='<div class="soutu-waiting"><div class="ball"><div class="b"></div><div class="b"></div><div class="b"></div></div><span>æ­£å¨å è½½å¾ç</span></div>';
this.wrap.append(this.getHtml(x));var y=[[0,40],[20,20],[40,0]];var w=["rgb(55,137,250)","rgb(99,99,99)","rgb(235,67,70)"];this.wrap.find(".b").each(function(A,C){var B=0;$(C).css({"background-color":w[A]});(function z(){$(C).animate({left:y[A][B%2]},{duration:800,easing:"swing",progress:function(E,D){if(D>=0.5){$(C).css({"background-color":w[(B+A)%3]})}},complete:function(){z()}});B++})()})},setError:function(x){this.clean();this.state="error";x=x||u["2"];var w='<div class="soutu-error"><i class="soutu-icon soutu-error-icon"></i><p class="soutu-error-main">'+x+'ï¼è¯·<a href="#" class="soutu-error-upload">éæ°ä¸ä¼ </a></p><p class="soutu-error-tip">ä»æ¯æ10Mä»¥ä¸JPG,JPEG,PNG,BMP,GIFæ ¼å¼å¾ç</p></div>';this.wrap.append(this.getHtml(w))},setActiving:function(){if(this.state!=="activing"){this._setActive(1);this.state="activing"}},setActive:function(){if(this.state!=="active"){this._setActive();this.state="active"}},_setActive:function(w){this.clean();if(this.activeLayer){$(this.getHtml(this.activeLayer,"background-color:"+(w?"#ededed":"#f6f6f6")+";")).appendTo(this.wrap)
}},getHtml:function(x,w){w=w||"";return'<div class="soutu-mask" style="'+w+'">'+x+"</div>"},show:function(){},hide:function(){}});var j=function(w){this.config={};$.extend(this.config,h,w);this.state="normal";this.init();this.canDrop="ondrop" in document.body;this.canAjaxForm="FormData" in window};$.extend(j.prototype,{init:function(){var x=this;a.addClass(i?"soutu_mac":"soutu_nomac");var w=$('<link rel="stylesheet" href="http://s1.bdstatic.com/r/www/cache/static/soutu/css/soutu_1815c820.css" type="text/css" data-for="result"/>');if(r){w.insertBefore(a.parent())}else{w.appendTo("head")}this.$Btn=$('<span class="ipt_photo"></span>').prependTo($("#kw").parent()).hover(function(){x.$Btn.addClass("ipt_photo_hover")},function(){x.$Btn.removeClass("ipt_photo_hover")}).on("click",function(y){y.stopPropagation();y.preventDefault();x.addPanel();x.$Btn.hide();x.log({rsv_soutu:"camerabtn"})});if(i){this.$Btn.addClass("ipt_photo_mac")}if(r){this.$Btn.parent().addClass("s_ipt_wr_newIndex")}$(window).one("index_off",function(){x.$Btn.parent().removeClass("s_ipt_wr_newIndex")
});if(!l){$("#kw").on("drop.soutu",function(y){if(y.originalEvent.dataTransfer&&y.originalEvent.dataTransfer.files&&y.originalEvent.dataTransfer.files.length){q(y);x.$Btn.trigger("click");x.handleDrop(y);x.log({rsv_soutu:"iptdrop"})}}).on("dragover.soutu",function(y){return !m});$(document).on("dragstart.soutu",function(D){var y=D.originalEvent.dataTransfer;var C=D.target||D.srcElement;var E=C.nodeName.toLowerCase();var A;if(E==="img"){x.$Btn.trigger("click");A=C.src;try{y.setData("text/plain",A)}catch(B){y.setData("Text",A)}}else{if(E==="a"){var z=$(C).children("img");if(z.length){x.$Btn.trigger("click");A=z[0].src;try{y.setData("text/plain",A)}catch(B){y.setData("Text",A)}}}}})}},hidePanel:function(){this.$wrap.hide();this.wrapHidden=true},show:function(){if(window.pageState===1&&!this.$wrap.hasClass("result")){this.$wrap.addClass("result")}if(r&&bds.comm.ishome){this.$wrap.addClass("new");if(!window.s_session||!!s_session.userSkinName===false){this.$wrap.addClass("no-skin")}}this.$wrap.show()
},close:function(){this.$wrap.hide();this.$Btn.show();this.setState("normal");this.$urlErrorTip.hide();this.$kw.val("")},addPanel:function(){var w=this;this.wrapHidden=false;if(this.$wrap){this.show();return}this.$wrap=$('<div class="soutu-wrap"><div class="soutu-fake"><span class="soutu-fake-wrap"><input id="soutu-fake-kw" class="soutu-s-ipt" maxlength="255" autocomplete="off" placeholder="å¨æ­¤å¤ç²è´´å¾çç½å"/></span><span class="soutu-fake-btn"><i class="soutu-icon soutu-fake-btn-icon"></i></span><span class="soutu-url-error">è¯·è¾å¥æ­£ç¡®çå¾çç½å</span></div><div class="soutu-hr"><div class="soutu-drop" style="display:none;"><span class="soutu-drop-tip">ææ½å¾çå°è¿é</span><i class="soutu-icon soutu-drop-icon"></i></div><div class="upload-wrap"><input type="file" class="upload-pic" value="ä¸ä¼ å¾ç"/><i class="soutu-icon upload-icon"></i><span class="upload-text">æ¬å°ä¸ä¼ å¾ç</span></div></div><a class="soutu-icon soutu-close" href="javascript:void(0);"></a></div>').prependTo($("#form"));this.$kw=this.$wrap.find("#soutu-fake-kw").on("focus",function(){w.$wrap.find(".soutu-fake-wrap").addClass("focus")
}).on("blur",function(){w.$wrap.find(".soutu-fake-wrap").removeClass("focus")});this.$dropArea=this.$wrap.find(".soutu-drop");this.$kw.on("keydown",function(y){var x=y.keyCode;if(w.$urlErrorTip.css("display")!=="none"){w.$urlErrorTip.hide()}if(x===13){w.submit(this.value);y.stopPropagation();y.preventDefault();return false}});this.$urlErrorTip=this.$wrap.find(".soutu-url-error");this.$wrap.find(".soutu-fake-btn").on("click",function(){var x=w.$kw.val();w.submit(x);w.log({rsv_soutu:"fakebtn"})});this.$wrap.find(".soutu-fake-btn").on("mouseover",function(){$(this).addClass("btnhover")}).on("mouseout",function(){$(this).removeClass("btnhover")});if(!this.canAjaxForm){this.hackFlash()}this.$wrap.find(".soutu-close").on("click",function(){w.close(true)});$(document).click(function(x){w.document_click(x)});this.$wrap.find(".upload-pic").on("change",function(){var x=this.files[0];w.upload(x);w.log({rsv_soutu:"uploadbtn"})});if(this.canDrop&&!l){this.setDragAndDrop()}this.masks=[new v({wrap:this.$wrap})];
this.show();$(window).one("index_off",function(){w.$wrap.removeClass("new");w.$wrap.removeClass("no-skin")})},setState:function(z){this.state=z;var w=this.masks[0];z=z.charAt(0).toUpperCase()+z.substring(1);var x=[].slice.call(arguments);[].shift.call(x);if(z==="Activing"){this.$dropArea.addClass("drag-over")}else{this.$dropArea.removeClass("drag-over")}w["set"+z].apply(w,x);if(z==="Error"){var y=this;this.$wrap.find(".soutu-error-upload").click(function(A){A.stopPropagation();A.preventDefault();y.setState("normal")})}},document_click:function(z){var y=this;var x=z.target;var w=true;do{if(x===y.$wrap[0]||x===y.$Btn[0]){w=false;break}}while(x=x.parentNode);if(w){y.close()}},doAjax:function(x){var w=this;if(this.state!=="waiting"){this.setState("waiting")}$.ajax({url:w.config.uploadServer,type:"POST",data:x,processData:false,contentType:false,success:function(y){w.uploadComplete(y)},error:function(){w.setState("error")},always:function(){}})},uploadUrl:function(w){var x=new FormData();x.append("image",w);
this.doAjax(x);this.log({rsv_soutu:"uploadurl"})},upload:function(w){var y=this;var x=this.validate(w);if(x){this.setState("error",u[x]);return}this.setState("waiting");n(w).then(function(z){var A=new FormData();A.append("image",z);y.doAjax(A);y.log({rsv_soutu:"uploadfile"})})},uploadComplete:function(w){var x=this;if(w&&w.command&&w.command.mode===2&&w.data){setTimeout(function(){var z="";var y=z+"/imgsearch?wd="+encodeURIComponent(w.data.wd)+"&sign="+encodeURIComponent(w.data.sign);x.close();s(y)},w.command.interval||3000)}else{this.setState("error")}},submit:function(w){this.setURL(w)},validate:function(x){var z=["jpg","jpeg","png","bmp","gif"];var w=x.name.split(".");var y=w.pop().toLowerCase();if(!x.type||!y||$.inArray(y,z)===-1){return 1}if(x.size>k){return 2}return 0},setURL:function(w){if(d(w)){this.$kw.val(w);this.setState("normal");this.$urlErrorTip.hide();this.uploadUrl(w)}else{this.setState("normal");this.$urlErrorTip.show()}},handleDrop:function(B){var A=this;var w;if(B.originalEvent.dataTransfer){w=B.originalEvent.dataTransfer.files
}if(!w||w.length===0){var x;try{x=B.originalEvent.dataTransfer.getData("text/plain")||B.originalEvent.dataTransfer.getData("text/uri-list")}catch(z){x=B.originalEvent.dataTransfer.getData("Text")||B.originalEvent.dataTransfer.getData("URL")}if(x){A.setURL(x)}else{A.setState("normal");A.$urlErrorTip.show()}return}var y=w[0];A.upload(y)},setDragAndDrop:function(){var w=this;this.$dropArea.show();w.$dropArea.on("dragover",function(x){w.setState("activing");q(x)}).on("dragleave",function(x){w.setState("normal");q(x)}).on("drop",function(x){q(x);w.handleDrop(x)});this.$kw.on("dragover.soutu dragleave.soutu",function(x){q(x)}).on("drop.soutu",function(x){q(x);w.handleDrop(x)})},hackFlash:function(){var E=this;var w="11.1.0";var B="playerProductInstall.swf";var y={};var z={};var C="http://s1.bdstatic.com/r/www/cache/static/soutu/js/upload_ef39d94f.swf";z.quality="high";z.bgcolor="#ffffff";z.allowscriptaccess="always";z.allowfullscreen="false";z.wmode="transparent";y.uploadServer=this.config.uploadServer;
var A={};A.id="upload_flash";A.name="upload_flash";A.align="middle";var x=null;var D=$.Deferred();this.$wrap.find(".upload-pic").parent().append('<div class="flash-wrap" style="position:absolute;"><div id="upload_flashContent"></div></div>').end().remove();swfobject.embedSWF(C,"upload_flashContent","100","23",w,B,y,z,A,function(F){x=F.ref});j.swfloaded=function(){D.resolve()};j.uploading=function(){E.setState("waiting")};j.complete=function(F){E.uploadComplete(F)};D.done(function(){})},log:e});if(typeof define==="function"){define("soutu.index",[],function(){window.__soutu=j;return new j()})}})();