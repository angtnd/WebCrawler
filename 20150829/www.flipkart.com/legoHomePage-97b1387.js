if(typeof(FKART)=="undefined"){FKART={}}FKART.AppOffer=new function(){var a=[],b=[];this.clearList=function(){a=[];b=[];fk_appoffer.updateTopBanner()};this.addAppOnly=function(c){if(a.indexOf(c)==-1){a.push(c);fk_appoffer.updateTopBanner()}};this.addOpenFsn=function(c){if(b.indexOf(c)==-1){b.push(c);fk_appoffer.updateTopBanner()}};this.updateTopBanner=function(){if(a.length===0){$("#fk-header").removeClass("banner-open");$(".fk-header-banner").slideUp("slow")}else{if(!$("#fk-header").hasClass("banner-open")){$("#fk-header").addClass("banner-open");$(".fk-header-banner").slideDown("slow")}if(b.length===0){$(".fk-header-banner .apponly-text-some").hide();$(".fk-header-banner .apponly-text-all").show()}else{$(".fk-header-banner .apponly-text-all").hide();$(".fk-header-banner .apponly-text-some").show()}}};this.updateUrl=function(){$(".fk-header-banner .app-link").data("url",window.location.pathname+window.location.search);$(".fk-header-banner .app-link").data("title",document.title)}};fk_appoffer=FKART.AppOffer;FKART.appOfferPopup=function(ad){var H=$(ad),n=$(".app-link",H),A=$(".app-offers-button",H),Q=$(".app-offers-container",H),T=$(".appOnlyDialog-popup-content",H),I=$(".fk-question-mark",H),q,ac,aa,au,K,ax,ab,w,P,y,al,ak,m,at,b,t=false,O,h,ao=false,aj,ae,e,p,am,d,J,f,M,an,G=false,E,aq,c,ai,L,r,u,v,x,B,N,D,j,z=false;if(T.length==0){T=$(".fk-mainfooter .appOnlyDialog-popup-content")}if(T.length==0){T=$(".appOnlyDialog-popup-content.forcedView")}function a(){A.on("click",function(){if(!z){ar("Opened");$(this).addClass("open");I.text("X");setTimeout(function(){Q.slideDown(200);z=true},150)}else{ar("Closed");Q.slideUp(200,function(){A.removeClass("open");I.text("?");z=false})}});n.on("click",function(ay){if(!n.hasClass("disabled")){ar("Clicked");l($(this));aw();ay.preventDefault()}})}function aw(){m=null;F();if(!FKART.login.isUserLoggedIn()){y.hide();af()}else{if(ao==true){y.show();q.hide();D=setTimeout(function(){t=true;$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:aq,lid:c,sid:ai,query:L,offerid:E,title:r,subtitle:u,vertical:v,url:x},type:"POST",dataType:"json",success:function(ay){if(ay.deviceFound&&ay.notificationSent){ag()}else{X()}},error:function(){X()}})},7000)}else{af()}}}function R(){$.ajax({url:"/lc/sendPushNotificationForAccount",data:{pid:aq,lid:c,sid:ai,query:L,offerid:E,title:r,subtitle:u,vertical:v,url:x},type:"POST",dataType:"json"})}function ar(az){var ay={};if(az=="Clicked"){ay.products=s.products}var aA=new Array("eVar1","eVar2","eVar3","eVar4","eVar5","eVar50","prop1","prop2","prop3","prop4","prop35");for(i in aA){if(typeof s[aA[i]]!="undefined"){ay[aA[i]]=s[aA[i]]}}ay.prop21="OpenInApp_"+az;FKART.omni.customEvent("App only offers",ay)}function ag(){k();y.hide();if(B&&B.length>0){var ay=$("<img>");ay.attr("src",B);ax.append(ay)}else{ax.remove()}ac.show();W();ar("PNSent")}function X(){k();y.hide();ab.show();ar("PNFailed")}function F(){m=new FKART.ui.Dialog({showFooter:false,cssClass:"appOnlyDialog",body:T.html(),destroyOnHide:true,width:"620px"});b=m.getContainer();y=b.find(".loadingDiv");q=b.find(".smsDiv");ac=b.find(".successDiv");aa=q.find(".stitle");K=q.find(".footerLoggedIn");au=q.find(".footerNotLoggedIn");ax=ac.find(".phone-image span");aj=b.find(".smsForm");at=b.find(".successPrefixDiv");ab=b.find(".errorDiv");al=b.find(".send-sms-fake-link");ak=b.find(".send-sms-link");j=b.find(".timer");O=b.find(".retry-notification");m.show();if(!FKART.login.isUserLoggedIn()){au.show();K.hide()}else{au.hide();K.show()}Z()}function Z(){b.on("beforeHide",function(ay){g();k();G=false});ak.on("click",function(){ac.hide();at.show();ab.hide();aa.remove();af();ar("PNExpired")});O.on("click",function(){m.hide();ao=true;aw();$status="PNTried";if(t){$status="PNReTried"}ar($status)})}function U(){M=f.val();if(!(/^[789]\d{9}$/.test(M))){f.addClass("error").val("").attr("placeholder","Invalid Number").focus();return}else{$.ajax({url:"/lc/sendSMSForNumber",type:"POST",data:{pid:aq,lid:c,sid:ai,query:L,offerid:E,title:r,subtitle:u,vertical:v,url:x,phoneNumber:M,captchaText:am.val(),captchaId:d.attr("id")},dataType:"json",success:function(ay){if(ay.captchaStatus){if(ay.smsStatus){ah();R()}else{Y()}}else{av()}},error:function(){Y()}})}}function av(){S();am.addClass("error").val("").attr("placeholder","Invalid code").focus()}function ah(){aa.hide();e.hide();aj.hide();J.html(M);w.show();ar("SMSSent")}function Y(){aa.hide();e.hide();aj.hide();ab.hide();J.html(M);P.show();ar("SMSFailed")}function af(){f=aj.find(".phoneNumber");M=FKART.login.userPhoneNumber;f.val(M);ae=aj.find("input[type=button]");e=q.find(".infoDiv");aa=q.find(".stitle");w=q.find(".smsSuccessDiv");P=q.find(".smsErrorDiv");h=q.find(".retry-sms");p=aj.find(".captchaDiv");am=aj.find(".captchaText");an=aj.find(".refreshCaptcha");J=q.find(".phone_number");if(/^\d{10}$/.test(M)){G=true;S()}q.show();m.reposition();C()}function C(){an.on("click",function(){S();am.val("").focus()});ae.on("click",function(ay){U();ar("SMSTried");ay.preventDefault()});h.on("click",function(){aa.show();w.hide();e.show();aj.show();P.hide();am.removeClass("error").val("").attr("placeholder","Enter code").focus();S();ar("SMSReTried")});f.focus(function(){ar("PhoneNumberFocused");if(!G){G=true;S()}})}function S(){$.ajax({url:"/lc/generateCaptcha",type:"POST",dataType:"json",success:function(ay){if(ay.success){d=p.find("img");d.attr("src","data:image/png;base64,"+ay.captchaBytes);d.attr("id",ay.id);p.show();am.show();d.load(function(){if(this.complete){m.reposition()}})}else{p.find("img").attr("alt","Captcha failed to load")}},error:function(){p.find("img").attr("alt","Captcha failed to load")}})}function g(){clearInterval(N);N=null}function k(){clearInterval(D);D=null}function W(){N=setInterval(function(){var ay=parseInt(j.html());if(ay==0){g();al.hide();ak.show()}j.html(ay-1)},1000)}function o(az,ay){if(az.indexOf("?")!==-1){var aC=az.split("?")[1];var aB=aC.split("&");for(var aA=0;aA<aB.length;aA++){var aD=aB[aA].split("=");if(aD[0]==ay){return aD[1]}}}}function ap(){var ay=FKART.urlParser().get("sid");if(ay!="undefined"){return ay}}function l(ay){B=ay.data("image");if(ay.data("pid")){aq=ay.data("pid").toString();v=ay.data("vertical");if(ay.data("lid")){c=ay.data("lid").toString()}E=ay.data("offerid")}else{L=ay.data("query");ai=ap();if(ai){v=("BROWSE_"+ai).toUpperCase()}else{v="BROWSE_SEARCH"}aq=o(ay.data("url"),"pid");E=o(ay.data("url"),"offer");r=ay.data("title");u=ay.data("subtitle");x=ay.data("url")}ao=false;t=false}function V(){a()}V()};register_controller("AppOffersCtrl",function(a){FKART.appOfferPopup(a)});FKART.showShutDownPopup=function(c){var b=(new Date()).getTime(),e=FKART.utils.localStorage.getObject("sdPopDetails")||{};function d(g){var f=new FKART.ui.Dialog({header:"Flipkart System Message",showFooter:false,body:c,cssClass:"desk-shut"});FKART.utils.localStorage.setObject("sdPopDetails",{timeStamp:g});f.show()}if(!jQuery.isEmptyObject(e)){var a=e.timeStamp+(24*60*60*1000);if(a<b){d(b)}}else{d(b)}};register_controller("ShutDownPopCtrl",function(a){FKART.showShutDownPopup(a)});