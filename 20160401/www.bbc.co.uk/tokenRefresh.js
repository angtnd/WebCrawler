define(["idcta/id-config","idcta/idCookie","idcta/apiUtils"],function(h,f,d){var n=5000;var j=15000;var g=3600000;var c="idapp_end";var u="error";var o="invalid";var s=[c,u,o];var r=f.getInstance();function p(y){if(r.isHybridApp()){return d.Promise.reject(new e())}var x=r.getError();if(x&&d.timestampInFuture(x.retryAfter)){return d.Promise.reject(x)}if(r.hasJwtTokenExpired()){return t().then(function(){throw new m()})}if(y!==true&&!r.hasAccessTokenExpired()){return d.Promise.resolve()}return d.loadUrlInHiddenIframe(h.tokenRefresh_url,n,s).then(null,l).then(k).then(i).then(null,b).then(null,w)}var l=function(){var x=(new Date()).getTime()+(h.tokenRefresh?j:g);var y=new q(x);r.setCknsIdCookieProperty("ec",y);throw y};var k=function(x){if(x!==o){return x}throw new m()};var i=function(x){if(x===c){return x}throw r.getError()};var b=function(x){if(x){throw x}x=new a();r.setCknsIdCookieProperty("ec",x);throw x};var w=function(x){if(x.code!=(new m()).code){throw x}return t().then(function(){throw x})};var t=function(){return d.loadUrlInHiddenIframe(h.signout_url,n).then(function(){if(r.getUserDetailsFromCookie()){r.unsetCookie("ckns_id")}},function(){r.unsetCookie("ckns_id")})};function m(){this.code=401;this.message="Invalid session"}function e(){this.code=401;this.message="Unauthorised"}function a(x){this.code=500;this.message="Unauthorised";this.retryAfter=x?x:(new Date()).getTime()+j}function q(x){this.code=408;this.message="Request timeout";this.retryAfter=x?x:(new Date()).getTime()+j}var v={};v.refreshAccessToken=p;v.RETRY_AFTER_SHORT=j;v.RETRY_AFTER_LONG=g;v.MESSAGE_SUCCESS=c;v.MESSAGE_ERROR=u;v.MESSAGE_INVALID=o;v.RETRY_AFTER_SHORT=j;v.RETRY_AFTER_LONG=g;return v});